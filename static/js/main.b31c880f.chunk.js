(this.webpackJsonpdojo=this.webpackJsonpdojo||[]).push([[0],{100:function(e,t,a){e.exports=a(204)},105:function(e,t,a){},204:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),i=a.n(s),o=(a(105),a(17)),c=a(1),l=a(2),u=a(4),m=a(3),p=a(212),d=a(226),h=a(210),f=a(59),v=a.n(f),g=["blinded","charmed","deafened","exhaustion","frightened","grappled","incapacitated","invisible","paralyzed","petrified","poisoned","prone","restrained","stunned","unconscious"],b=["tiny","small","medium","large","huge","gargantuan"],y=["aberration","beast","celestial","construct","dragon","elemental","fey","fiend","giant","humanoid","monstrosity","ooze","plant","undead"],E=["artillery","boss","controller","skirmisher","sneak","soldier","tank"],k=["trait","action","bonus","reaction","legendary","mythic","lair"],w=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"getTypicalHP",value:function(e){var t=(N.hitDieType(e.size)+1)/2+N.modifierValue(e.abilityScores.con);return Math.floor(e.hitDice*t)}},{key:"getTypicalHPString",value:function(e){var t=N.hitDieType(e.size),a=N.modifierValue(e.abilityScores.con)*e.hitDice,n="";return a>0&&(n=" + "+a),a<0&&(n=" - "+Math.abs(a)),e.hitDice+"d"+t+n}},{key:"nudgeValue",value:function(t,a,n){var r,s=t,i=null,o=a.split(".");switch(o.forEach((function(e){e===o[o.length-1]?i=s[e]:s=s[e]})),a){case"challenge":r=N.nudgeChallenge(i,n);break;case"size":r=N.nudgeSize(i,n);break;default:r=(i||0)+n,r=Math.max(r,0)}e.changeValue(t,a,r)}},{key:"changeValue",value:function(e,t,a){var n=e,r=t.split(".");r.forEach((function(e){e===r[r.length-1]?n[e]=a:n=n[e]}))}},{key:"clear",value:function(e){e.name="",e.size="medium",e.role="",e.category="beast",e.tag="",e.alignment="",e.challenge=1,e.abilityScores.str=10,e.abilityScores.dex=10,e.abilityScores.con=10,e.abilityScores.int=10,e.abilityScores.wis=10,e.abilityScores.cha=10,e.ac=10,e.hitDice=1,e.damage.resist="",e.damage.vulnerable="",e.damage.immune="",e.savingThrows="",e.speed="",e.skills="",e.senses="",e.languages="",e.equipment="",e.traits=[],e.conditionImmunities="",e.portrait="",e.legendaryActions=0}},{key:"clone",value:function(e,t){return{id:N.guid(),type:"monster",name:t||e.name+" copy",size:e.size,role:e.role,category:e.category,tag:e.tag,alignment:e.alignment,challenge:e.challenge,abilityScores:{str:e.abilityScores.str,dex:e.abilityScores.dex,con:e.abilityScores.con,int:e.abilityScores.int,wis:e.abilityScores.wis,cha:e.abilityScores.cha},ac:e.ac,hitDice:e.hitDice,damage:{resist:e.damage.resist,vulnerable:e.damage.vulnerable,immune:e.damage.immune},savingThrows:e.savingThrows,speed:e.speed,skills:e.skills,senses:e.senses,languages:e.languages,equipment:e.equipment,traits:e.traits.map((function(e){return{id:N.guid(),name:e.name,usage:e.usage,type:e.type,text:e.text,uses:0}})),conditionImmunities:e.conditionImmunities,portrait:e.portrait,legendaryActions:e.legendaryActions}}},{key:"createFromJSON",value:function(e){var t=this,a=C.createMonster();a.type="monster",a.name=e.name,a.size=e.size.toLowerCase(),a.role="",a.category=e.type,a.tag=e.subtype,a.alignment=e.alignment,a.challenge=N.parseChallenge(e.challenge_rating),a.ac=e.armor_class,a.speed=e.speed,a.senses=e.senses,a.languages=e.languages;var n=e.hit_dice.indexOf("d");a.hitDice=parseInt(e.hit_dice.substring(0,n),10),a.abilityScores.str=e.strength,a.abilityScores.dex=e.dexterity,a.abilityScores.con=e.constitution,a.abilityScores.int=e.intelligence,a.abilityScores.wis=e.wisdom,a.abilityScores.cha=e.charisma,a.damage.resist=e.damage_resistances,a.damage.vulnerable=e.damage_vulnerabilities,a.damage.immune=e.damage_immunities,a.conditionImmunities=e.condition_immunities,a.legendaryActions=0;[{field:"strength_save",text:"Strength"},{field:"dexterity_save",text:"Dexterity"},{field:"constitution_save",text:"Constitution"},{field:"intelligence_save",text:"Intelligence"},{field:"wisdom_save",text:"Wisdom"},{field:"charisma_save",text:"Charisma"}].forEach((function(t){if(e[t.field]){var n=t.text+" "+e[t.field];a.savingThrows+=""===a.savingThrows?n:", "+n}}));return[{field:"acrobatics",text:"Acrobatics"},{field:"animal_handling",text:"Animal handling"},{field:"arcana",text:"Arcana"},{field:"athletics",text:"Athletics"},{field:"deception",text:"Deception"},{field:"history",text:"History"},{field:"insight",text:"Insight"},{field:"intimidation",text:"Intimidation"},{field:"investigation",text:"Investigation"},{field:"medicine",text:"Medicine"},{field:"nature",text:"Nature"},{field:"perception",text:"Perception"},{field:"performance",text:"Performance"},{field:"persuasion",text:"Persuasion"},{field:"religion",text:"Religion"},{field:"sleight_of_hand",text:"Sleight of hand"},{field:"stealth",text:"Stealth"},{field:"survival",text:"Survival"}].forEach((function(t){if(e[t.field]){var n=t.text+" "+e[t.field];a.skills+=""===a.skills?n:", "+n}})),e.special_abilities&&e.special_abilities.forEach((function(e){var n=t.buildTrait(e,"trait");a.traits.push(n)})),e.actions&&e.actions.forEach((function(e){var n=t.buildTrait(e,"action");a.traits.push(n)})),e.reactions&&e.reactions.forEach((function(e){var n=t.buildTrait(e,"reaction");a.traits.push(n)})),e.legendary_actions&&e.legendary_actions.forEach((function(e){var n=t.buildTrait(e,"legendary");a.traits.push(n)})),a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(a.legendaryActions=3),a.role=this.getRole(a),a}},{key:"buildTrait",value:function(e,t){var a="",n="",r=e.name.indexOf("(");if(-1===r)a=e.name;else{var s=e.name.indexOf(")");a=e.name.substring(0,r-1),n=e.name.substring(r+1,s).toLowerCase()}var i=e.desc.replace(/\u2022/g,"*"),o=t;return"Lair Actions"===a&&(o="lair"),0===i.indexOf("As a bonus action")&&(o="bonus"),{id:N.guid(),type:o,name:a,usage:n,text:i,uses:0}}},{key:"import",value:function(t,a){e.clear(a);var n=(new DOMParser).parseFromString(t,"text/html");try{a.name=n.getElementsByClassName("mon-stat-block__name")[0].innerText.trim();var r=n.getElementsByClassName("mon-stat-block__meta")[0].innerText.toLowerCase().trim(),s=r.indexOf(" ");a.size=r.substring(0,s).trim();var i=(r=r.substring(s+1).trim()).indexOf(",");a.alignment=r.substring(i+1).trim();var o=(r=r.substring(0,i).trim()).indexOf("("),c=r.indexOf(")");-1!==o&&-1!==c&&(a.tag=r.substring(o+1,c).trim(),r=r.substring(0,o).trim()),a.category=r}catch(B){console.error(B)}try{for(var l=n.getElementsByClassName("mon-stat-block__attribute"),u=0;u!==l.length;++u){var m=l[u],p=m.getElementsByClassName("mon-stat-block__attribute-label")[0].innerText.toLowerCase().trim(),d=m.getElementsByClassName("mon-stat-block__attribute-data-value")[0].innerText.toLowerCase().trim();switch(p){case"armor class":a.ac=Number.parseInt(d,10);break;case"hit points":var h=m.getElementsByClassName("mon-stat-block__attribute-data-extra")[0].innerText.toLowerCase().trim();a.hitDice=Number.parseInt(h.substring(1,h.indexOf("d")),10);break;case"speed":a.speed=d}}}catch(B){console.error(B)}try{for(var f=n.getElementsByClassName("ability-block__stat"),v=0;v!==f.length;++v){var g=f[v],b=g.getElementsByClassName("ability-block__heading")[0].innerText.toLowerCase().trim(),y=g.getElementsByClassName("ability-block__score")[0].innerText.toLowerCase().trim(),E=Number.parseInt(y,10);a.abilityScores[b]=E}}catch(B){console.error(B)}try{for(var k=n.getElementsByClassName("mon-stat-block__tidbit"),w=0;w!==k.length;++w){var N=k[w],x=N.getElementsByClassName("mon-stat-block__tidbit-label")[0].innerText.toLowerCase().trim(),S=N.getElementsByClassName("mon-stat-block__tidbit-data")[0].innerText.toLowerCase().trim();switch(x){case"saving throws":a.savingThrows=S;break;case"skills":a.skills=S;break;case"damage vulnerabilities":a.damage.vulnerable=S;break;case"damage resistances":a.damage.resist=S;break;case"damage immunities":a.damage.immune=S;break;case"condition immunities":a.conditionImmunities=S;break;case"senses":a.senses=S;break;case"languages":a.languages=S;break;case"challenge":var M=S.indexOf(" ");a.challenge=Number.parseInt(S.substring(0,M),10)}}}catch(B){console.error(B)}try{for(var O=n.getElementsByClassName("mon-stat-block__description-block"),I=0;I!==O.length;++I){var D=O[I],j="trait",T=D.getElementsByClassName("mon-stat-block__description-block-heading");if(T.length>0)switch(T[0].innerText.toLowerCase().trim()){case"actions":j="action";break;case"bonus actions":j="bonus";break;case"reactions":j="reaction";break;case"legendary actions":j="legendary";break;case"mythic actions":j="mythic";break;case"lair actions":j="lair"}for(var V=D.getElementsByTagName("p"),P=0;P!==V.length;++P){var A=V[P].innerText.trim(),z=C.createTrait();z.type=j;var R=A.indexOf(".");z.text=A.substring(R+1).trim();var L=(A=A.substring(0,R)).indexOf("("),G=A.indexOf(")");if(-1!==L&&-1!==G&&(z.usage=A.substring(L+1,G).trim(),A=A.substring(0,L).trim()),z.name=A,z.name)a.traits.push(z);else{var F=a.traits[a.traits.length-1];F.text+="\n",F.text+=z.text}}}}catch(B){console.error(B)}a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(a.legendaryActions=3),a.role=this.getRole(a)}},{key:"copyTrait",value:function(e,t){var a=JSON.parse(JSON.stringify(t));a.id=N.guid(),e.traits.push(a)}},{key:"addTrait",value:function(e,t){var a=C.createTrait();a.type=t,a.name="New "+N.traitType(t,!1).toLowerCase(),e.traits.push(a)}},{key:"moveTrait",value:function(e,t,a){var n,r=e.traits.splice(t,1);(n=e.traits).splice.apply(n,[a,0].concat(Object(o.a)(r)))}},{key:"removeTrait",value:function(e,t){var a=e.traits.indexOf(t);e.traits.splice(a,1)}},{key:"swapTraits",value:function(e,t,a){var n=e.traits.indexOf(t),r=e.traits.indexOf(a);e.traits[r]=t,e.traits[n]=a}},{key:"spliceMonsters",value:function(e,t){var a=this;["size","category","tag","alignment","challenge","speed","senses","languages","equipment","abilityScores.str","abilityScores.dex","abilityScores.con","abilityScores.int","abilityScores.wis","abilityScores.cha","savingThrows","skills","ac","hitDice","damage.resist","damage.vulnerable","damage.immune","conditionImmunities"].forEach((function(n){a.setRandomValue(e,n,t)})),e.traits=[],k.forEach((function(n){var r=[];t.forEach((function(e){e.traits.filter((function(e){return e.type===n})).forEach((function(e){return r.push(e)}))}));var s=[];r.forEach((function(e){var t=s.find((function(t){return t.trait.name===e.name}));t?t.count+=1:s.push({trait:e,count:1})}));var i=[];s.filter((function(e){return e.count===t.length})).forEach((function(t){a.copyTrait(e,t.trait),i.push(t.trait.id)})),i.forEach((function(e){var t=s.findIndex((function(t){return t.trait.id===e}));s.splice(t,1)}));for(var o=r.length/t.length;e.traits.filter((function(e){return e.type===n})).length<o;){var c=Math.floor(Math.random()*s.length),l=s[c].trait;a.copyTrait(e,l),s.splice(c,1)}})),e.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(e.legendaryActions=3),e.role=this.getRole(e)}},{key:"setRandomValue",value:function(e,t,a){var n=a[Math.floor(Math.random()*a.length)],r=null,s=t.split(".");s.forEach((function(e){e===s[s.length-1]?r=n[e]:n=n[e]})),this.changeValue(e,t,r)}},{key:"addRandomTrait",value:function(e,t,a){var n=[];a.forEach((function(e){e.traits.filter((function(e){return e.type===t})).forEach((function(e){n.push(e)}))}));var r=Math.floor(Math.random()*n.length),s=n[r];this.copyTrait(e,s)}},{key:"getToHitExpressions",value:function(e){return Array.from(e.text.matchAll(/([+-])\s*(\d+)\s*to hit/g)).map((function(e){var t=e[0],a=parseInt(e[2],10);return"-"===e[1]&&(a*=-1),{expression:t,bonus:a}}))}},{key:"getDiceExpressions",value:function(e){return Array.from(e.text.matchAll(/(\d*)[dD](\d+)\s*(([+-])\s*(\d*))?/g)).map((function(e){var t,a=e[0],n=null!==(t=parseInt(e[1],10))&&void 0!==t?t:1,r=parseInt(e[2],10),s=0;return e[3]&&e[4]&&e[5]&&(s=parseInt(e[5],10),"-"===e[4]&&(s*=-1)),{expression:a,count:n,sides:r,bonus:s}}))}},{key:"getSaveExpressions",value:function(e){return Array.from(e.text.matchAll(/(dc|DC)\s*(\d+)/g)).map((function(e){return{expression:e[0],dc:parseInt(e[2],10)}}))}},{key:"getRole",value:function(t){var a=this;if(t.legendaryActions>0)return"boss";if(t.traits.some((function(e){return e.text.toLowerCase().includes("teleport")})))return"skirmisher";var n=t.skills.toLowerCase();if(n.includes("deception")||n.includes("stealth"))return"sneak";if(t.traits.some((function(e){return e.text.toLowerCase().includes("indistinguishable")})))return"sneak";var r=N.challengeDetails().find((function(e){return e.cr===t.challenge}));if(r){if(e.getTypicalHP(t)>r.hpMax)return"tank";var s=t.traits.filter((function(e){var t=a.getToHitExpressions(e),n=a.getDiceExpressions(e).map((function(e){return e.count*(e.sides+1)/2+e.bonus})),s=a.getSaveExpressions(e);return t.some((function(e){return e.bonus>r.attack}))||n.some((function(e){return e>r.dmgMax}))||s.some((function(e){return e.dc>r.save}))}));if(s.length>0){var i=s.filter((function(e){var t=e.text.toLowerCase();return t.includes("ranged")&&t.includes("attack")})).length;return i>=s.length-i?"artillery":"soldier"}}var o=0;return g.forEach((function(e){t.traits.some((function(t){return t.text.toLowerCase().includes(e.toLowerCase())}))&&(o+=1)})),o>=2?"controller":"skirmisher"}}]),e}(),N=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"getMonsterGroup",value:function(e,t){var a=this.monsterIdToGroup[e.id];if(!a){var n=t.find((function(t){return t.monsters.includes(e)}));n&&(a=n,this.monsterIdToGroup[e.id]=a)}return a}},{key:"guid",value:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===t.length&&(t=[{field:"name",dir:"asc"}]);var a=function(e,t,a){if(void 0!==e[a]&&void 0!==t[a]){if(e[a]<t[a])return-1;if(e[a]>t[a])return 1}return 0};return e.sort((function(e,n){var r=0;return t.forEach((function(t){0===r&&(r=a(e,n,t.field)*("asc"===t.dir?1:-1))})),r})),e}},{key:"debounce",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){clearTimeout(t),t=setTimeout(e,a)}}},{key:"toData",value:function(e){var t=e/1073741824;if(t>=1)return t.toFixed(2)+" GB";var a=e/1048576;if(a>=1)return a.toFixed(2)+" MB";var n=e/1024;return n>=1?n.toFixed(2)+" KB":e+" B"}},{key:"saveFile",value:function(e,t){var a=JSON.stringify(t,null,"\t"),n=new Blob([a],{type:"application/json"}),r=document.createElement("a");r.download=e,r.href=window.URL.createObjectURL(n),r.click()}},{key:"modifierValue",value:function(e){return Math.floor((e-10)/2)}},{key:"modifier",value:function(e){var t=this.modifierValue(e),a=t.toString();return t>=0&&(a="+"+a),a}},{key:"randomNumber",value:function(e){return Math.floor(Math.random()*e)}},{key:"randomBoolean",value:function(){return 0===e.randomNumber(2)}},{key:"dieRoll",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,r=0;r!==a;++r)n+=e.randomNumber(t)+1;return n}},{key:"miniSize",value:function(e){switch(e){case"tiny":return.4;case"small":return.6;case"medium":return 1;case"large":return 2;case"huge":return 3;case"gargantuan":return 4;default:return 1}}},{key:"hitDieType",value:function(e){switch(e){case"tiny":return 4;case"small":return 6;case"medium":return 8;case"large":return 10;case"huge":return 12;case"gargantuan":return 20;default:return 8}}},{key:"proficiency",value:function(e){return e<5?2:e<9?3:e<13?4:e<17?5:6}},{key:"challenge",value:function(e){switch(e){case.125:return"1/8";case.25:return"1/4";case.5:return"1/2";default:return e.toString()}}},{key:"parseChallenge",value:function(e){switch(e){case"1/8":return.125;case"1/4":return.25;case"1/2":return.5;default:return parseInt(e,10)}}},{key:"challengeDetails",value:function(){return[{cr:0,ac:13,hpMin:1,hpMax:6,attack:3,dmgMin:0,dmgMax:1,save:13},{cr:.125,ac:13,hpMin:7,hpMax:35,attack:3,dmgMin:2,dmgMax:3,save:13},{cr:.25,ac:13,hpMin:36,hpMax:49,attack:3,dmgMin:4,dmgMax:5,save:13},{cr:.5,ac:13,hpMin:50,hpMax:70,attack:3,dmgMin:6,dmgMax:8,save:13},{cr:1,ac:13,hpMin:71,hpMax:85,attack:3,dmgMin:9,dmgMax:14,save:13},{cr:2,ac:13,hpMin:86,hpMax:100,attack:3,dmgMin:15,dmgMax:20,save:13},{cr:3,ac:13,hpMin:101,hpMax:115,attack:4,dmgMin:21,dmgMax:26,save:13},{cr:4,ac:14,hpMin:116,hpMax:130,attack:5,dmgMin:27,dmgMax:32,save:14},{cr:5,ac:15,hpMin:131,hpMax:145,attack:6,dmgMin:33,dmgMax:38,save:15},{cr:6,ac:15,hpMin:146,hpMax:160,attack:6,dmgMin:39,dmgMax:44,save:15},{cr:7,ac:15,hpMin:161,hpMax:175,attack:6,dmgMin:45,dmgMax:50,save:15},{cr:8,ac:16,hpMin:176,hpMax:190,attack:7,dmgMin:51,dmgMax:56,save:16},{cr:9,ac:16,hpMin:191,hpMax:205,attack:7,dmgMin:57,dmgMax:62,save:16},{cr:10,ac:17,hpMin:206,hpMax:220,attack:7,dmgMin:63,dmgMax:68,save:16},{cr:11,ac:17,hpMin:221,hpMax:235,attack:8,dmgMin:69,dmgMax:74,save:17},{cr:12,ac:17,hpMin:236,hpMax:250,attack:8,dmgMin:75,dmgMax:80,save:17},{cr:13,ac:18,hpMin:251,hpMax:265,attack:8,dmgMin:81,dmgMax:86,save:18},{cr:14,ac:18,hpMin:266,hpMax:280,attack:8,dmgMin:87,dmgMax:92,save:18},{cr:15,ac:18,hpMin:281,hpMax:295,attack:8,dmgMin:93,dmgMax:98,save:18},{cr:16,ac:18,hpMin:296,hpMax:310,attack:9,dmgMin:99,dmgMax:104,save:18},{cr:17,ac:19,hpMin:311,hpMax:325,attack:10,dmgMin:105,dmgMax:110,save:19},{cr:18,ac:19,hpMin:326,hpMax:340,attack:10,dmgMin:111,dmgMax:116,save:19},{cr:19,ac:19,hpMin:341,hpMax:355,attack:10,dmgMin:117,dmgMax:122,save:19},{cr:20,ac:19,hpMin:356,hpMax:400,attack:10,dmgMin:123,dmgMax:140,save:19},{cr:21,ac:19,hpMin:401,hpMax:445,attack:11,dmgMin:141,dmgMax:158,save:20},{cr:22,ac:19,hpMin:446,hpMax:490,attack:11,dmgMin:159,dmgMax:176,save:20},{cr:23,ac:19,hpMin:491,hpMax:535,attack:11,dmgMin:177,dmgMax:194,save:20},{cr:24,ac:19,hpMin:536,hpMax:580,attack:12,dmgMin:195,dmgMax:212,save:21},{cr:25,ac:19,hpMin:581,hpMax:625,attack:12,dmgMin:213,dmgMax:230,save:21},{cr:26,ac:19,hpMin:626,hpMax:670,attack:12,dmgMin:231,dmgMax:248,save:21},{cr:27,ac:19,hpMin:671,hpMax:715,attack:13,dmgMin:249,dmgMax:266,save:22},{cr:28,ac:19,hpMin:716,hpMax:760,attack:13,dmgMin:267,dmgMax:284,save:22},{cr:29,ac:19,hpMin:761,hpMax:805,attack:13,dmgMin:285,dmgMax:302,save:22},{cr:30,ac:19,hpMin:806,hpMax:850,attack:14,dmgMin:303,dmgMax:320,save:23}]}},{key:"experience",value:function(e){switch(e){case 0:return 10;case.125:return 25;case.25:return 50;case.5:return 100;case 1:return 200;case 2:return 450;case 3:return 700;case 4:return 1100;case 5:return 1800;case 6:return 2300;case 7:return 2900;case 8:return 3900;case 9:return 5e3;case 10:return 5900;case 11:return 7200;case 12:return 8400;case 13:return 1e4;case 14:return 11500;case 15:return 13e3;case 16:return 15e3;case 17:return 18e3;case 18:return 2e4;case 19:return 22e3;case 20:return 25e3;case 21:return 33e3;case 22:return 41e3;case 23:return 5e4;case 24:return 62e3;case 30:return 155e3;default:return 0}}},{key:"experienceFactor",value:function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 1.5;case 3:case 4:case 5:case 6:return 2;case 7:case 8:case 9:case 10:return 2.5;case 11:case 12:case 13:case 14:return 3;default:return 4}}},{key:"pcExperience",value:function(e,t){switch(t){case"easy":switch(e){case 1:return 25;case 2:return 50;case 3:return 75;case 4:return 125;case 5:return 250;case 6:return 300;case 7:return 350;case 8:return 450;case 9:return 550;case 10:return 600;case 11:return 800;case 12:return 1e3;case 13:return 1100;case 14:return 1250;case 15:return 1400;case 16:return 1600;case 17:return 2e3;case 18:return 2100;case 19:return 2400;case 20:return 2800;default:return 0}case"medium":switch(e){case 1:return 50;case 2:return 100;case 3:return 150;case 4:return 250;case 5:return 500;case 6:return 600;case 7:return 750;case 8:return 900;case 9:return 1100;case 10:return 1200;case 11:return 1600;case 12:return 2e3;case 13:return 2200;case 14:return 2500;case 15:return 2800;case 16:return 3200;case 17:return 3900;case 18:return 4200;case 19:return 4900;case 20:return 5700;default:return 0}case"hard":switch(e){case 1:return 75;case 2:return 150;case 3:return 225;case 4:return 375;case 5:return 750;case 6:return 900;case 7:return 1100;case 8:return 1400;case 9:return 1600;case 10:return 1900;case 11:return 2400;case 12:return 3e3;case 13:return 3400;case 14:return 3800;case 15:return 4300;case 16:return 4800;case 17:return 5900;case 18:return 6300;case 19:return 7300;case 20:return 8500;default:return 0}case"deadly":switch(e){case 1:return 100;case 2:return 200;case 3:return 400;case 4:return 500;case 5:return 1100;case 6:return 1400;case 7:return 1700;case 8:return 2100;case 9:return 2400;case 10:return 2800;case 11:return 3600;case 12:return 4500;case 13:return 5100;case 14:return 5700;case 15:return 6400;case 16:return 7200;case 17:return 8800;case 18:return 9500;case 19:return 10900;case 20:return 12700;default:return 0}default:return 0}}},{key:"traitType",value:function(e,t){var a="";switch(e){case"trait":a="trait";break;case"action":a="action";break;case"reaction":a="reaction";break;default:a=e+" action"}return t&&(a+="s"),a}},{key:"nudgeChallenge",value:function(e,t){var a=0;switch(e){case 0:-1===t&&(a=0),1===t&&(a=.125);break;case.125:-1===t&&(a=0),1===t&&(a=.25);break;case.25:-1===t&&(a=.125),1===t&&(a=.5);break;case.5:-1===t&&(a=.25),1===t&&(a=1);break;case 1:-1===t&&(a=.5),1===t&&(a=2);break;default:a=e+t}return a}},{key:"nudgeSize",value:function(e,t){var a=["tiny","small","medium","large","huge","gargantuan"],n=a.indexOf(e)+t;return n<0&&(n=0),n>=a.length&&(n=a.length-1),a[n]}},{key:"conditionText",value:function(e){switch(e.name){case"blinded":return["a blinded creature can\u2019t see and automatically fails any ability check that requires sight","attack rolls against the creature have advantage, and the creature\u2019s attack rolls have disadvantage"];case"charmed":return["a charmed creature can\u2019t attack the charmer or target the charmer with harmful abilities or magical effects","the charmer has advantage on any ability check to interact socially with the creature"];case"deafened":return["a deafened creature can\u2019t hear and automatically fails any ability check that requires hearing."];case"exhaustion":switch(e.level){case 1:return["disadvantage on ability checks"];case 2:return["disadvantage on ability checks","speed halved"];case 3:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws"];case 4:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved"];case 5:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0"];case 6:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0","death"];default:return[]}case"frightened":return["a frightened creature has disadvantage on ability checks and attack rolls while the source of its fear is within line of sight","the creature can\u2019t willingly move closer to the source of its fear"];case"grappled":return["a grappled creature\u2019s speed becomes 0, and it can\u2019t benefit from any bonus to its speed","the condition ends if the grappler is incapacitated","the condition also ends if an effect removes the grappled creature from the reach of the grappler or grappling effect"];case"incapacitated":return["an incapacitated creature can\u2019t take actions or reactions","being incapacitated breaks concentration"];case"invisible":return["an invisible creature is impossible to see without the aid of magic or a special sense","for the purpose of hiding, the creature is heavily obscured","the creature\u2019s location can be detected by any noise it makes or any tracks it leaves","attack rolls against the creature have disadvantage, and the creature\u2019s attack rolls have advantage"];case"paralyzed":return["a paralyzed creature is incapacitated (can\u2019t take actions or reactions) and can\u2019t move or speak","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];case"petrified":return["a petrified creature is transformed, along with any nonmagical objects it is wearing or carrying, into a solid inanimate substance (usually stone)","its weight increases by a factor of ten, and it ceases aging","the creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move or speak, and is unaware of its surroundings","attack rolls against the creature have advantage","the creature automatically fails strength and dexterity saving throws","the creature has resistance to all damage","the creature is immune to poison and disease, although a poison or disease already in its system is suspended, not neutralized"];case"poisoned":return["a poisoned creature has disadvantage on attack rolls and ability checks"];case"prone":return["a prone creature\u2019s only movement option is to crawl, unless it stands up (using half its speed) and thereby ends the condition","the creature has disadvantage on attack rolls","an attack roll against the creature has advantage if the attacker is Within 5 feet of the creature; otherwise, the attack roll has disadvantage"];case"restrained":return["a restrained creature\u2019s speed becomes 0, and it can\u2019t benefit from any bonus to its speed","attack rolls against the creature have advantage, and the creature\u2019s attack rolls have disadvantage","the creature has disadvantage on dexterity saving throws"];case"stunned":return["a stunned creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move, and can speak only falteringly","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage"];case"unconscious":return["an unconscious creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move or speak, and is unaware of its surroundings","the creature drops whatever its holding and falls prone","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];default:return[]}}},{key:"conditionDurationText",value:function(e,t){if(null!==e.duration)switch(e.duration.type){case"saves":var a=e.duration,n=a.saveType.toString();"death"!==n&&(n=n.toUpperCase());var r=a.count>1?"saves":"save";return"until you make "+a.count+" "+n+" "+r+" at dc "+a.saveDC;case"combatant":var s=e.duration,i=s.point,o=t.find((function(e){return e.id===s.combatantID}));return"until the "+i+" of "+(o?(o.displayName||o.name||"unnamed monster")+"'s":"their")+" next turn";case"rounds":var c=e.duration,l=c.count>1?"rounds":"round";return"for "+c.count+" "+l;default:return null}return null}},{key:"getCombatSlotData",value:function(t,a){var n=[];return t&&t.slots.forEach((function(t){var r=a.find((function(e){return e.name===t.monsterGroupName}));if(r){var s=r.monsters.find((function(e){return e.name===t.monsterName}));if(s){var i=C.createCombatSlotInfo();i.id=t.id,i.init=e.dieRoll()+e.modifierValue(s.abilityScores.dex),i.hp=w.getTypicalHP(s);for(var o=0;o!==t.count;++o){var c=C.createCombatSlotMember();c.init=i.init,c.hp=i.hp,c.name=t.monsterName,i.members.push(c)}if(t.count>1)for(var l=0;l!==t.count;++l)i.members[l].name=t.monsterName+" "+(l+1);n.push(i)}}})),n}},{key:"getTagTitle",value:function(e){if(e.startsWith("engaged"))return"engaged";switch(e){case"conc":return"concentrating";case"bane":return"affected by bane";case"bless":return"affected by bless";default:return e}}},{key:"getTagDescription",value:function(e){if(e.startsWith("engaged"))return e.split(":")[1];switch(e){case"conc":return"if damaged, must make con save (dc is half damage taken or 10, whichever is higher) or lose concentration";case"bane":return"subtract d4 from attack rolls and saving throws";case"bless":return"add d4 to attack rolls and saving throws";default:return e}}}]),e}();N.monsterIdToGroup={};var C=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"createParty",value:function(){return{id:N.guid(),name:"",pcs:[]}}},{key:"createPC",value:function(){return{id:N.guid(),type:"pc",active:!0,player:"",name:"",size:"medium",race:"",classes:"",level:1,languages:"Common",passiveInsight:10,passiveInvestigation:10,passivePerception:10,portrait:"",url:"",companions:[]}}},{key:"createCompanion",value:function(){return{id:N.guid(),name:"",monsterID:null}}},{key:"createMonsterGroup",value:function(){return{id:N.guid(),name:"",monsters:[]}}},{key:"createMonster",value:function(){return{id:N.guid(),type:"monster",name:"",size:"medium",role:"",category:"humanoid",tag:"",alignment:"",challenge:1,abilityScores:{str:10,dex:10,con:10,int:10,wis:10,cha:10},ac:10,hitDice:1,damage:{resist:"",vulnerable:"",immune:""},savingThrows:"",speed:"",skills:"",senses:"",languages:"",equipment:"",traits:[],conditionImmunities:"",portrait:"",legendaryActions:0}}},{key:"createTrait",value:function(){return{id:N.guid(),name:"",usage:"",type:"action",text:"",uses:0}}},{key:"createEncounter",value:function(){return{id:N.guid(),name:"",slots:[],waves:[],notes:""}}},{key:"createEncounterSlot",value:function(){return{id:N.guid(),monsterGroupName:"",monsterName:"",roles:[],count:1,faction:"foe"}}},{key:"createEncounterWave",value:function(){return{id:N.guid(),name:"",slots:[]}}},{key:"createMonsterFilter",value:function(){return{name:"",challengeMin:0,challengeMax:5,category:"all types",size:"all sizes",role:"all roles"}}},{key:"createMap",value:function(){return{id:N.guid(),name:"",items:[],notes:[]}}},{key:"createMapItem",value:function(){return{id:N.guid(),type:"tile",x:0,y:0,width:4,height:4,terrain:"",customBackground:"",content:null,size:"medium",color:"",opacity:255,style:null}}},{key:"createMapNote",value:function(){return{id:N.guid(),targetID:"",text:""}}},{key:"createCombatSetup",value:function(){return{party:null,encounter:null,waveID:null,map:null,fog:[],combatants:[],slotInfo:[]}}},{key:"createCombatSlotInfo",value:function(){return{id:"",useGroupHP:!0,useGroupInit:!0,hp:0,init:0,members:[]}}},{key:"createCombatSlotMember",value:function(){return{id:N.guid(),name:"",hp:0,init:0}}},{key:"createCombat",value:function(){return{id:N.guid(),name:"",encounter:e.createEncounter(),combatants:[],map:null,fog:[],round:1,notifications:[],issues:[],report:[]}}},{key:"createNotification",value:function(){return{id:N.guid(),type:"condition-save",data:null,combatant:null}}},{key:"createCombatReportEntry",value:function(){return{id:N.guid(),type:"combat-start",timestamp:Date.now(),combatantID:"",value:0}}},{key:"createCondition",value:function(){return{id:N.guid(),name:"",level:1,text:"",duration:null}}},{key:"createConditionDurationSaves",value:function(){return{type:"saves",count:1,saveType:"str",saveDC:10,point:"start"}}},{key:"createConditionDurationCombatant",value:function(){return{type:"combatant",point:"start",combatantID:null}}},{key:"createConditionDurationRounds",value:function(){return{type:"rounds",count:1}}}]),e}(),x=["default","cavern","dirt","flagstone","floorboard","grassland","pit","sand","snow","water","custom"],S=["single","double","arch","bars"],M=["stairs","spiral","ladder"],O=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"scatterCombatants",value:function(t,a){if(t.map&&(t.map.items=t.map.items.filter((function(e){return e.type!==a})),t.map.items.filter((function(e){return"tile"===e.type})).length>0)){var n=e.mapDimensions(t.map);if(n)t.combatants.filter((function(e){return e.type===a})).forEach((function(r){for(var s=[],i=n.minX;i<=n.maxX;++i)for(var o=n.minY;o<=n.maxY;++o){e.canAddMonsterHere(t.map,r,i,o)&&s.push({x:i,y:o})}if(s.length>0&&t.map){var c=s[Math.floor(Math.random()*s.length)],l=N.miniSize(r.displaySize),u=C.createMapItem();u.id=r.id,u.type=a,u.x=c.x,u.y=c.y,u.height=l,u.width=l,t.map.items.push(u)}}))}}},{key:"mapDimensions",value:function(e){var t=e.items.filter((function(e){return"tile"===e.type}));if(t.length>0){var a=t[0].x,n=t[0].y,r=t[0].x+t[0].width-1,s=t[0].y+t[0].height-1;return t.forEach((function(e){a=Math.min(a,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x+e.width-1),s=Math.max(s,e.y+e.height-1)})),{minX:a,minY:n,maxX:r,maxY:s}}return null}},{key:"canAddTileHere",value:function(t,a,n,r,s,i){for(var o=[],c=n-s,l=r-i,u=n+(a.width-1)+s,m=r+(a.height-1)+i,p=c;p<=u;++p)for(var d=l;d<=m;++d){var h=e.itemsAt(t,p,d).every((function(e){return"tile"!==e.type}));o.push(h)}return o.every((function(e){return e}))}},{key:"canAddMonsterHere",value:function(t,a,n,r){for(var s=[],i=N.miniSize(a.displaySize),o=n+Math.max(1,i)-1,c=r+Math.max(1,i)-1,l=n;l<=o;++l)for(var u=r;u<=c;++u){var m=e.itemsAt(t,l,u),p=m.length>0&&m.every((function(e){return"tile"===e.type}));s.push(p)}return s.every((function(e){return e}))}},{key:"itemsAt",value:function(e,t,a){return e.items.filter((function(e){var n=e.x,r=e.x+e.width-1,s=e.y,i=e.y+e.height-1;return t>=n&&t<=r&&a>=s&&a<=i}))}},{key:"rotateMap",value:function(e){e.items.forEach((function(e){var t=-1*(e.y+e.height-1),a=e.x,n=e.height,r=e.width;e.x=t,e.y=a,e.width=n,e.height=r,e.content&&(e.content.orientation="horizontal"===e.content.orientation?"vertical":"horizontal")}))}},{key:"mapSize",value:function(t){return t.items.filter((function(e){return"tile"===e.type})).reduce((function(t,a){return t+e.mapTileSize(a)}),0)}},{key:"mapTileSize",value:function(e){return"tile"===e.type?e.width*e.height:0}},{key:"getNote",value:function(e,t){return e.notes.find((function(e){return e.targetID===t.id}))||null}},{key:"generate",value:function(t,a){switch(t){case"dungeon":for(var n=0;n<10;)e.addRoom(a)&&(n+=1);break;case"delve":for(var r=0;r<3;)e.addRoom(a)&&(r+=1);break;case"room":for(var s=!1;!s;)s=e.addRoom(a)}}},{key:"addRoom",value:function(t){var a=C.createMapItem();a.type="tile",a.terrain="default",a.style="square",a.width=N.dieRoll(4,2)+2,a.height=N.dieRoll(4,2)+2;var n=e.mapDimensions(t);if(n){n.minX-=a.width+2,n.minY-=a.height+2,n.maxX+=2,n.maxY+=2;for(var r=[],s=n.minX;s!==n.maxX;++s)for(var i=n.minY;i!==n.maxY;++i){e.canAddTileHere(t,a,s,i,1,1)&&r.push({x:s,y:i})}if(!(r.length>0))return!1;var o=Math.floor(Math.random()*r.length);a.x=r[o].x,a.y=r[o].y;var c=[];if(t.items.filter((function(e){return"tile"===e.type})).forEach((function(n){var r=Math.max(a.x,n.x),s=Math.min(a.x+a.width-1,n.x+n.width-1);if(s-r+1>=2)for(var i=Math.min(a.y+a.height-1,n.y+n.height-1)+1,o=Math.max(a.y,n.y)-1,l=r;l<=s-1;++l){var u=C.createMapItem();u.type="tile",u.terrain="default",u.style="square",u.x=l,u.y=i,u.width=2,u.height=o-i+1,e.canAddTileHere(t,u,u.x,u.y,1,0)&&c.push({tile:u,horizontal:!1})}var m=Math.max(a.y,n.y),p=Math.min(a.y+a.height-1,n.y+n.height-1);if(p-m+1>=2)for(var d=Math.min(a.x+a.width-1,n.x+n.width-1)+1,h=Math.max(a.x,n.x)-1,f=m;f<=p-1;++f){var v=C.createMapItem();v.type="tile",v.terrain="default",v.style="square",v.x=d,v.y=f,v.width=h-d+1,v.height=2,e.canAddTileHere(t,v,v.x,v.y,0,1)&&c.push({tile:v,horizontal:!0})}})),!(c.length>0))return!1;var l=Math.floor(Math.random()*c.length),u=c[l];if(!u.horizontal&&1===u.tile.height||u.horizontal&&1===u.tile.width)2===N.dieRoll(2)&&(u.tile.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:u.horizontal?"vertical":"horizontal"});else{if(!u.horizontal&&u.tile.height>=4||u.horizontal&&u.tile.width>=4){if(2===N.dieRoll(2)){var m=C.createMapItem();m.type="tile",m.terrain="default",m.style="square",m.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:""},u.horizontal?(m.x=u.tile.x,m.y=u.tile.y,m.width=1,m.height=2,m.content.orientation="vertical",u.tile.x+=1,u.tile.width-=1):(m.x=u.tile.x,m.y=u.tile.y,m.width=2,m.height=1,m.content.orientation="horizontal",u.tile.y+=1,u.tile.height-=1),t.items.push(m)}if(2===N.dieRoll(2)){var p=C.createMapItem();p.type="tile",p.terrain="default",p.style="square",p.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:""},u.horizontal?(p.x=u.tile.x+u.tile.width-1,p.y=u.tile.y,p.width=1,p.height=2,p.content.orientation="vertical",u.tile.width-=1):(p.x=u.tile.x,p.y=u.tile.y+u.tile.height-1,p.width=2,p.height=1,p.content.orientation="horizontal",u.tile.height-=1),t.items.push(p)}}(!u.horizontal&&u.tile.height<=4||u.horizontal&&u.tile.width<=4)&&3===N.dieRoll(3)&&(u.tile.content={type:"stairway",style:"stairs",orientation:u.horizontal?"vertical":"horizontal"})}t.items.push(u.tile),t.items.push(a)}else t.items.push(a);return!0}},{key:"getRandomDoorwayStyle",value:function(){var e=Math.floor(Math.random()*S.length);return S[e]}}]),e}(),I=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"matchParty",value:function(t,a){return!!e.match(t,a.name)||a.pcs.some((function(a){return e.matchPC(t,a)}))}},{key:"matchPC",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.player)||(!!e.match(t,a.race)||(!!e.match(t,a.classes)||a.companions.some((function(a){return e.matchCompanion(t,a)})))))}},{key:"matchCompanion",value:function(t,a){return!!e.match(t,a.name)}},{key:"matchGroup",value:function(t,a){return!!e.match(t,a.name)||a.monsters.some((function(a){return e.matchMonster(t,a)}))}},{key:"matchMonster",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.category)||(!!e.match(t,a.tag)||(!!e.match(t,a.senses)||(!!e.match(t,a.languages)||(!!e.match(t,a.equipment)||a.traits.some((function(a){return e.matchTrait(t,a)})))))))}},{key:"matchTrait",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.usage)||!!e.match(t,a.text))}},{key:"matchEncounter",value:function(t,a){return!!e.match(t,a.name)||(!!a.waves.some((function(a){return e.matchEncounterWave(t,a)}))||a.slots.some((function(a){return e.matchEncounterSlot(t,a)})))}},{key:"matchEncounterWave",value:function(t,a){return!!e.match(t,a.name)||a.slots.some((function(a){return e.matchEncounterSlot(t,a)}))}},{key:"matchEncounterSlot",value:function(t,a){return!!e.match(t,a.monsterName)}},{key:"matchMap",value:function(t,a){return!!e.match(t,a.name)||a.notes.some((function(a){return e.matchMapNote(t,a)}))}},{key:"matchMapNote",value:function(t,a){return!!e.match(t,a.text)}},{key:"match",value:function(e,t){if(!e)return!0;var a=!0;return e.toLowerCase().split(" ").forEach((function(e){-1===t.toLowerCase().indexOf(e)&&(a=!1)})),a}}]),e}(),D=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"getMonsterCount",value:function(e){var t=0,a=[];return a=a.concat(e.slots),e.waves.forEach((function(e){a=a.concat(e.slots)})),a.filter((function(e){return"foe"===e.faction})).forEach((function(e){t+=e.count})),t}},{key:"getEncounterXP",value:function(e,t){var a=0,n=[];return n=n.concat(e.slots),e.waves.forEach((function(e){n=n.concat(e.slots)})),n.filter((function(e){return"foe"===e.faction})).forEach((function(e){var n=t(e.monsterName,e.monsterGroupName);n&&(a+=N.experience(n.challenge)*e.count)})),a}},{key:"getAdjustedEncounterXP",value:function(e,t){var a=this.getMonsterCount(e);return this.getEncounterXP(e,t)*N.experienceFactor(a)}},{key:"getCombatXP",value:function(e){var t=0;return e.combatants.filter((function(e){return"monster"===e.type})).filter((function(e){return"foe"===e.faction})).forEach((function(e){var a=e;t+=N.experience(a.challenge)})),t}},{key:"getFilterDescription",value:function(e){var t="";"all sizes"!==e.size&&(t+=t?" "+e.size:e.size),"all types"!==e.category&&(t+=t?" "+e.category:e.category),"all roles"!==e.role&&(t+=t?" "+e.role:e.role);var a=N.challenge(e.challengeMin),n=N.challenge(e.challengeMax);return t+=" monsters of cr "+(e.challengeMin===e.challengeMax?a:a+" to "+n)}},{key:"buildEncounter",value:function(t,a,n,r,s){for(;e.getAdjustedEncounterXP(t,(function(e,t){return s(e,t)}))<=a;)if(t.slots.length>0&&N.dieRoll(3)>1){var i=Math.floor(Math.random()*t.slots.length);t.slots[i].count+=1}else{if("break"===function(){var a=[];if(r.forEach((function(r){r.monsters.filter((function(t){return e.matchMonster(t,n)})).filter((function(e){return!t.slots.find((function(t){return t.monsterGroupName===r.name&&t.monsterName===e.name}))})).forEach((function(e){return a.push({groupName:r.name,monsterName:e.name})}))})),a.length>0){var s=Math.floor(Math.random()*a.length),i=C.createEncounterSlot();i.monsterGroupName=a[s].groupName,i.monsterName=a[s].monsterName,t.slots.push(i)}else if(0===t.slots.length)return"break"}())break}for(var o=function(){var e=Math.floor(Math.random()*t.slots.length),a=t.slots[e];t.slots=t.slots.filter((function(e){return e.id!==a.id}));var n=C.createEncounterWave();n.name="wave "+(t.waves.length+2),n.slots.push(a),t.waves.push(n)};t.slots.length>1&&10===N.dieRoll(10);)o()}},{key:"matchMonster",value:function(e,t){return!(e.challenge<t.challengeMin)&&(!(e.challenge>t.challengeMax)&&(!(""!==t.name&&!I.match(t.name,e.name))&&(("all types"===t.category||e.category===t.category)&&(("all sizes"===t.size||e.size===t.size)&&("all roles"===t.role||e.role===t.role)))))}},{key:"sortCombatants",value:function(e){e.combatants.sort((function(e,t){return e.initiative&&t.initiative&&e.initiative<t.initiative?1:e.initiative&&t.initiative&&e.initiative>t.initiative||e.displayName<t.displayName?-1:e.displayName>t.displayName?1:0}))}},{key:"combatHasLairActions",value:function(e){var t=!1;return e.combatants.filter((function(e){return!e.pending&&e.active&&!e.defeated})).forEach((function(e){var a=e;a&&a.traits&&a.traits.some((function(e){return"lair"===e.type}))&&(t=!0)})),t}},{key:"convertPCToCombatant",value:function(e){var t=JSON.parse(JSON.stringify(e));return t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e.name,t.displaySize=e.size,t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.altitude=0,t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t}},{key:"convertMonsterToCombatant",value:function(e,t,a,n,r){var s=JSON.parse(JSON.stringify(e));return s.id=N.guid(),s.current=!1,s.pending=!1,s.active=!0,s.defeated=!1,s.faction=r,s.displayName=n,s.displaySize=e.size,s.showOnMap=!0,s.initiative=t,s.hpMax=a,s.hpCurrent=a,s.hpTemp=0,s.conditions=[],s.tags=[],s.note="",s.altitude=0,s.aura={radius:0,style:"rounded",color:"#005080"},s.mountID=null,s.mountType="controlled",s}},{key:"convertCompanionToCombatant",value:function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return t.id=e?e.id:N.guid(),t.type="companion",t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e?e.name:"companion",t.displaySize="medium",t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.altitude=0,t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t}},{key:"convertPlaceholderToCombatant",value:function(){return{id:N.guid(),type:"placeholder",current:!1,pending:!1,active:!0,defeated:!1,faction:"neutral",displayName:"lair actions",displaySize:"medium",showOnMap:!0,initiative:20,hpMax:null,hpCurrent:null,hpTemp:null,conditions:[],tags:[],note:"",altitude:0,aura:{radius:0,style:"rounded",color:"#005080"},mountID:null,mountType:"controlled"}}},{key:"encounterTemplates",value:function(){return[{name:"battlefield control",slots:[{roles:["controller"],count:1},{roles:["skirmisher","sneak"],count:5}]},{name:"commander and troops",slots:[{roles:["controller","soldier"],count:1},{roles:["soldier","tank"],count:5}]},{name:"dragon's den",slots:[{roles:["boss"],count:1}]},{name:"double line",slots:[{roles:["soldier","tank"],count:3},{roles:["artillery","controller"],count:2}]},{name:"wolf pack",slots:[{roles:["skirmisher"],count:6}]}]}}]),e}(),j=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.onChecked(!this.props.checked)}},{key:"render",value:function(){var e=this;try{var t="checkbox "+this.props.display;this.props.checked&&(t+=" checked"),this.props.disabled&&(t+=" disabled");var a=null;return"switch"===this.props.display&&(a=r.a.createElement("div",{className:"toggle-container"},r.a.createElement("div",{className:"toggle"}))),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)}},r.a.createElement("div",{className:"checkbox-label"},this.props.label),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);j.defaultProps={display:"switch",disabled:!1};var T=a(252),V=a(238),P=a(207),A=a(244),z=a(243),R=a(229),L=a(216),G=a(253),F=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={visible:!1},n}return Object(l.a)(a,[{key:"onClick",value:function(e){e.stopPropagation(),this.setState({visible:!0})}},{key:"onClose",value:function(e,t){e.stopPropagation(),t&&this.props.onConfirm(),this.setState({visible:!1})}},{key:"render",value:function(){var e=this;try{return r.a.createElement(G.a,{content:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement(L.a,{style:{color:"red"}}),r.a.createElement("span",{style:{marginLeft:"10px"}},this.props.prompt)),this.props.info,r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(t){return e.onClose(t,!0)}},"confirm"),r.a.createElement("button",{onClick:function(t){return e.onClose(t,!1)}},"cancel")),trigger:"click",visible:this.state.visible},r.a.createElement("button",{className:this.props.disabled?"danger disabled":"danger",onClick:function(t){return e.onClick(t)}},this.props.text))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);F.defaultProps={prompt:"are you sure you want to do this?",info:null,disabled:!1};var B=a(251),q=a(60),H=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t="";return this.props.disabled&&(t="disabled"),this.props.noMargins&&(t+=" no-margins"),this.props.multiLine?r.a.createElement(q.DebounceInput,{element:"textarea",minLength:this.props.minLength,debounceTimeout:500,className:t,value:this.props.text,placeholder:this.props.placeholder,rows:10,onChange:function(t){return e.props.onChange(t.target.value)}}):r.a.createElement(q.DebounceInput,{minLength:this.props.minLength,debounceTimeout:500,className:t,value:this.props.text,placeholder:this.props.placeholder,onChange:function(t){return e.props.onChange(t.target.value)}})}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);H.defaultProps={placeholder:"",multiLine:!1,minLength:0,disabled:!1,noMargins:!1};var W=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={open:!1,filterText:""},n}return Object(l.a)(a,[{key:"toggleOpen",value:function(e){e.stopPropagation(),this.setState({open:!this.state.open})}},{key:"setFilterText",value:function(e){this.setState({filterText:e})}},{key:"select",value:function(e){this.setState({open:!1}),this.props.onSelect(e)}},{key:"clear",value:function(e){e.stopPropagation(),this.props.onClear()}},{key:"render",value:function(){var e=this;try{if(0===this.props.options.length)return null;var t,a=this.props.disabled?"dropdown disabled":"dropdown",n=[];this.props.selectedID&&(t=this.props.options.find((function(t){return t.id===e.props.selectedID})));var s=t&&this.props.onClear;if(n.push(r.a.createElement("div",{key:"selection",className:"dropdown-top",title:t?t.text:this.props.placeholder},t?t.display:null,r.a.createElement("div",{className:"item-text"},t?t.text:this.props.placeholder),s?r.a.createElement(T.a,{onClick:function(t){return e.clear(t)}}):r.a.createElement(B.a,null))),this.state.open){a+=" open";var i=null;this.props.options.length>15&&(i=r.a.createElement("div",{className:"dropdown-filter",onClick:function(e){return e.stopPropagation()}},r.a.createElement(H,{text:this.state.filterText,placeholder:"search this list...",onChange:function(t){return e.setFilterText(t)}})));var o=this.props.options.map((function(t){return null===t.text?r.a.createElement("hr",{key:t.id}):I.match(e.state.filterText,t.text)?r.a.createElement(_,{key:t.id,option:t,selected:t.id===e.props.selectedID,select:function(t){return e.select(t)}}):null})).filter((function(e){return!!e}));n.push(r.a.createElement("div",{key:"options",className:"dropdown-options"},i,o))}return r.a.createElement("div",{className:a,onClick:function(t){return e.toggleOpen(t)}},n)}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);W.defaultProps={selectedID:null,placeholder:"select...",disabled:!1,onClear:null,onDisplay:null};var _=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.select(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="dropdown-option";return this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled"),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)}},this.props.option.display,this.props.option.text)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),J=a(250),Y=a(211),U=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){try{var e="expander";return this.props.disabled&&(e+=" disabled"),r.a.createElement(Y.a,{className:e,bordered:!1,defaultActiveKey:[],expandIcon:function(e){return r.a.createElement(J.a,{rotate:e.isActive?-180:0})},expandIconPosition:"right"},r.a.createElement(Y.a.Panel,{key:"one",header:r.a.createElement("div",{className:"collapse-header-text"},this.props.text)},this.props.children))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);U.defaultProps={disabled:!1};var X=a(249),K=a(248),Z=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"click",value:function(e,t){e.stopPropagation(),this.props.onNudgeValue(t)}},{key:"touchEnd",value:function(e,t){e.preventDefault(),e.stopPropagation(),this.props.onNudgeValue(t)}},{key:"render",value:function(){var e=this;try{var t="info-value";0===this.props.value&&(t+=" disabled");var a=[],n=[],s=this.props.factors||[1];s.forEach((function(t){a.push(r.a.createElement("div",{key:"minus"+t,className:1===t?"spin-button":"spin-button multiple",onTouchEnd:function(a){return e.touchEnd(a,-1*t)},onClick:function(a){return e.click(a,-1*t)}},1===t?r.a.createElement(X.a,null):r.a.createElement("div",null,t))),n.push(r.a.createElement("div",{key:"plus"+t,className:1===t?"spin-button":"spin-button multiple",onTouchEnd:function(a){return e.touchEnd(a,1*t)},onClick:function(a){return e.click(a,1*t)}},1===t?r.a.createElement(K.a,null):r.a.createElement("div",null,t)))})),a.reverse();var i="minus",o="plus";return this.props.downEnabled||(i+=" disabled"),this.props.upEnabled||(o+=" disabled"),r.a.createElement("div",{className:this.props.disabled?"number-spin disabled":"number-spin"},r.a.createElement("div",{className:i},a),r.a.createElement("div",{className:"info",style:{width:"calc(100% - "+60*s.length+"px)"}},r.a.createElement("div",{className:"info-label"},this.props.label),r.a.createElement("div",{className:t},this.props.value)),r.a.createElement("div",{className:o},n))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Z.defaultProps={label:null,upEnabled:!0,downEnabled:!0,disabled:!1,factors:null};var Q=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={showAbilityScores:!1},n}return Object(l.a)(a,[{key:"toggleAbilityScores",value:function(){this.setState({showAbilityScores:!this.state.showAbilityScores})}},{key:"roll",value:function(e,t){e.stopPropagation();var a=this.props.combatant.abilityScores[t],n=N.modifierValue(a);this.props.onRollDice(1,20,n)}},{key:"getAbilityScore",value:function(e){var t=this,a=this.props.combatant.abilityScores[e],n=N.modifier(a),s=r.a.createElement("div",null,r.a.createElement("div",{className:"ability-heading"},e),r.a.createElement("div",{className:"ability-value"},r.a.createElement("div",null,this.state.showAbilityScores?a:n)));return this.props.showRollButtons?r.a.createElement("div",{className:"ability-score link",onClick:function(a){return t.roll(a,e)}},s):r.a.createElement("div",{className:"ability-score"},s)}},{key:"render",value:function(){var e=this;try{return this.props.edit?r.a.createElement("div",null,r.a.createElement(Z,{value:this.props.combatant.abilityScores.str,label:"strength",downEnabled:this.props.combatant.abilityScores.str>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.str",t)}}),r.a.createElement(Z,{value:this.props.combatant.abilityScores.dex,label:"dexterity",downEnabled:this.props.combatant.abilityScores.dex>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.dex",t)}}),r.a.createElement(Z,{value:this.props.combatant.abilityScores.con,label:"constitution",downEnabled:this.props.combatant.abilityScores.con>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.con",t)}}),r.a.createElement(Z,{value:this.props.combatant.abilityScores.int,label:"intelligence",downEnabled:this.props.combatant.abilityScores.int>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.int",t)}}),r.a.createElement(Z,{value:this.props.combatant.abilityScores.wis,label:"wisdom",downEnabled:this.props.combatant.abilityScores.wis>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.wis",t)}}),r.a.createElement(Z,{value:this.props.combatant.abilityScores.cha,label:"charisma",downEnabled:this.props.combatant.abilityScores.cha>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.cha",t)}})):r.a.createElement("div",{className:"ability-scores",onClick:function(){return e.toggleAbilityScores()}},this.getAbilityScore("str"),this.getAbilityScore("dex"),this.getAbilityScore("con"),this.getAbilityScore("int"),this.getAbilityScore("wis"),this.getAbilityScore("cha"))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Q.defaultProps={edit:!1,showRollButtons:!1,onNudgeValue:null,onRollDice:null};var $=a(247),ee=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getEditor",value:function(){var e=this,t=null;this.props.source.portrait&&(t=r.a.createElement(T.a,{className:"clear",onClick:function(){return e.props.clear()}}));var a=null,n=window.localStorage.getItem("image-"+this.props.source.portrait);if(n){var s=JSON.parse(n);a=r.a.createElement("img",{className:"circle",src:s.data,alt:"portrait",onClick:function(){return e.props.edit()}})}else a=r.a.createElement($.a,{className:"circle",style:{opacity:.5},onClick:function(){return e.props.edit()}});return r.a.createElement("div",{className:"portrait editing"},r.a.createElement("div",{className:"section centered"},a,t))}},{key:"getDisplay",value:function(){if(!this.props.source.portrait)return null;var e=window.localStorage.getItem("image-"+this.props.source.portrait);if(!e)return null;var t=JSON.parse(e);if(!t.data)return null;var a="portrait";return this.props.inline?a+=" inline":a+=" section centered",r.a.createElement("div",{className:a},r.a.createElement("img",{className:"circle",src:t.data,alt:"portrait"}))}},{key:"render",value:function(){try{return null!==this.props.edit?this.getEditor():this.getDisplay()}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ee.defaultProps={inline:!1,edit:null,clear:null};var te=a(246),ae=a(245),ne=a(20),re=a.n(ne),se=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){try{var e="note";return this.props.white&&(e+=" white"),r.a.createElement("div",{className:e},this.props.children)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);se.defaultProps={white:!1};var ie=new re.a.Converter;ie.setOption("tables",!0);var oe=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"createSection",value:function(e,t){var a=e[t];if(0===a.length)return null;var n=null;if("legendary"===this.props.mode||"lair"===this.props.mode)switch(t){case"legendary":case"mythic":var s=null,i=null;if(this.props.combatant.legendaryActions>0&&(s=r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round"),r.a.createElement("hr",null)),"legendary"===this.props.mode)){var o=0;this.props.combatant.traits.filter((function(e){return("legendary"===e.type||"mythic"===e.type)&&e.uses>0})).forEach((function(e){var t=1;if(e.usage){var a=e.usage.toLowerCase().match(/\D*(\d*)\D*/);a&&(t=parseInt(a[1],10))}o+=t})),o=Math.min(o,this.props.combatant.legendaryActions);for(var c=Math.max(this.props.combatant.legendaryActions-o,0),l=[],u=0;u!==o;++u)l.push(r.a.createElement(te.a,{key:"used "+u}));for(var m=0;m!==c;++m)l.push(r.a.createElement(ae.a,{key:"unused "+m}));i=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section centered legendary-usage"},l))}"legendary"===t&&(n=r.a.createElement(se,{white:!0},s,r.a.createElement("div",null,"one legendary action can be used at the end of each other combatant's turn; spent actions are refreshed at the start of the monster's turn"),i)),"mythic"===t&&(n=r.a.createElement(se,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));break;case"lair":n=r.a.createElement(se,{white:!0},"one lair action can be taken each round on initiative 20")}else"legendary"===t&&(n=r.a.createElement(se,{white:!0},r.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round")),"mythic"===t&&(n=r.a.createElement(se,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));return r.a.createElement("div",null,r.a.createElement("div",{className:"section subheading"},N.traitType(t,!0)),n,a)}},{key:"render",value:function(){var e=this;try{var t={};return k.forEach((function(a){t[a]=e.props.combatant.traits.filter((function(e){return e.type===a})).map((function(t){return r.a.createElement(ce,{key:t.id,trait:t,mode:e.props.mode,showRollButtons:e.props.showRollButtons,copyTrait:function(t){return e.props.copyTrait(t)},useTrait:function(t){return e.props.useTrait(t)},rechargeTrait:function(t){return e.props.rechargeTrait(t)},onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}})}))})),0===this.props.combatant.traits.length?r.a.createElement("div",null,r.a.createElement("i",null,"no traits or actions")):"combat"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"trait"),this.createSection(t,"action"),this.createSection(t,"bonus"),this.createSection(t,"reaction")):"legendary"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"legendary"),this.createSection(t,"mythic")):"lair"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"lair")):r.a.createElement("div",null,this.createSection(t,"trait"),this.createSection(t,"action"),this.createSection(t,"bonus"),this.createSection(t,"reaction"),this.createSection(t,"legendary"),this.createSection(t,"mythic"),this.createSection(t,"lair"))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);oe.defaultProps={mode:"view",showRollButtons:!1,copyTrait:null,useTrait:null,rechargeTrait:null,onRollDice:null};var ce=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=0,a=this.props.trait.name||"unnamed "+N.traitType(this.props.trait.type,!1);if(this.props.trait.usage){var n="";this.props.trait.usage.toLowerCase().startsWith("recharge ")&&(t=1,this.props.trait.uses>0&&(n="; used"));var s=this.props.trait.usage.toLowerCase().match(/(\d+)\s*\/\s*day/);s&&(t=parseInt(s[1],10),this.props.trait.uses>0&&(n="; used "+this.props.trait.uses)),a+=" *("+this.props.trait.usage+n+")*"}"legendary"!==this.props.trait.type&&"mythic"!==this.props.trait.type||(t=1,this.props.trait.uses>0&&(a+=" *(used)*"));var i="**"+a+"** "+this.props.trait.text;switch(this.props.mode){case"view":return r.a.createElement("div",{key:this.props.trait.id,className:"section trait"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ie.makeHtml(i)}}));case"template":return r.a.createElement("div",{key:this.props.trait.id,className:"section trait trait-template",onClick:function(){return e.props.copyTrait(e.props.trait)}},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ie.makeHtml(i)}}));case"combat":case"legendary":case"lair":var o="",c=[];t>0&&(this.props.trait.uses>=t?(o="strikethrough",c.push(r.a.createElement("button",{key:"use",className:"link",onClick:function(){return e.props.rechargeTrait(e.props.trait)}},"recharge"))):c.push(r.a.createElement("button",{key:"use",className:"link",onClick:function(){return e.props.useTrait(e.props.trait)}},"use"))),this.props.showRollButtons&&(w.getToHitExpressions(this.props.trait).forEach((function(t){c.push(r.a.createElement("button",{key:t.expression,className:"link",onClick:function(){return e.props.onRollDice(1,20,t.bonus)}},t.expression))})),w.getDiceExpressions(this.props.trait).forEach((function(t){c.push(r.a.createElement("button",{key:t.expression,className:"link",onClick:function(){return e.props.onRollDice(t.count,t.sides,t.bonus)}},t.expression))})));var l=null;return c.length>0&&(l=r.a.createElement("div",{className:"trait-buttons"},c)),r.a.createElement("div",{key:this.props.trait.id,className:"section trait"},r.a.createElement("div",{className:o,dangerouslySetInnerHTML:{__html:ie.makeHtml(i)}}),l)}}catch(u){return console.error(u),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),le=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={cloneName:e.monster.name+" copy"},n}return Object(l.a)(a,[{key:"setCloneName",value:function(e){this.setState({cloneName:e})}},{key:"canSelect",value:function(){return-1!==this.props.mode.indexOf("template")||-1!==this.props.mode.indexOf("candidate")}},{key:"monsterIsInWave",value:function(e){var t=this;return e.slots.some((function(e){var a=t.props.library.find((function(e){return e.monsters.includes(t.props.monster)}));return!!a&&e.monsterGroupName===a.name&&e.monsterName===t.props.monster.name}))}},{key:"getHP",value:function(){var e,t,a,n=this.props.monster;if(null===n.hpCurrent||void 0===n.hpCurrent)return w.getTypicalHP(this.props.monster)+" ("+w.getTypicalHPString(this.props.monster)+")";var r=null!==(e=n.hpCurrent)&&void 0!==e?e:0,s=null!==(t=n.hpMax)&&void 0!==t?t:0,i=null!==(a=n.hpTemp)&&void 0!==a?a:0,o=r.toString();return i>0&&(o+="+"+i),s>0&&r!==s&&(o+=" / "+s),o}},{key:"statSection",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return null;var s=!0,i=null;if(n&&-1!==this.props.mode.indexOf("combat")){var o=t,c=[];Array.from(t.matchAll(/([^,;:/]*)\s+([+-]?)\s*(\d+)/g)).forEach((function(e){var t=e[0],n=e[2]||"+",s=parseInt(e[3],10)*("+"===n?1:-1);c.push(r.a.createElement("button",{key:t,className:"link",onClick:function(){return a.props.onRollDice(1,20,s)}},t)),o=o.replace(t,"")})),s=!!o.match(/[a-zA-Z]/),i=r.a.createElement("div",{className:"roll-buttons"},c)}return r.a.createElement("div",{className:"section"},r.a.createElement("b",null,e)," ",s?t:null,i)}},{key:"getTags",value:function(){var e=[],t=this.props.monster.size,a=this.props.monster;a&&(t=a.displaySize||t);var n=(t+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(n+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(r.a.createElement(R.a,{key:"tag-main"},n)),this.props.monster.alignment&&e.push(r.a.createElement(R.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(r.a.createElement(R.a,{key:"tag-cr"},"cr ",N.challenge(this.props.monster.challenge))),e}},{key:"getButtons",value:function(){var e=this,t=[];if(-1!==this.props.mode.indexOf("editable")){t.push(r.a.createElement("button",{key:"view",onClick:function(){return e.props.viewMonster(e.props.monster)}},"statblock")),t.push(r.a.createElement("button",{key:"edit",onClick:function(){return e.props.editMonster(e.props.monster)}},"edit monster")),t.push(r.a.createElement("button",{key:"export",onClick:function(){return e.props.exportMonster(e.props.monster)}},"export monster")),t.push(r.a.createElement(U,{key:"clone",text:"clone monster"},r.a.createElement(H,{text:this.state.cloneName,placeholder:"monster name",onChange:function(t){return e.setCloneName(t)}}),r.a.createElement("button",{onClick:function(){return e.props.cloneMonster(e.props.monster,e.state.cloneName)}},"create copy")));var a=[];this.props.library.forEach((function(t){-1===t.monsters.indexOf(e.props.monster)&&a.push({id:t.id,text:t.name})})),t.push(r.a.createElement(W,{key:"move",options:a,placeholder:"move to group...",onSelect:function(t){return e.props.moveToGroup(e.props.monster,t)}})),t.push(r.a.createElement(F,{key:"remove",text:"delete monster",onConfirm:function(){return e.props.removeMonster(e.props.monster)}}))}return t}},{key:"getStats",value:function(){var e=this,t=null;if(-1===this.props.mode.indexOf("template")){var a=null;-1===this.props.mode.indexOf("full")&&-1===this.props.mode.indexOf("combat")||(a=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(Q,{combatant:this.props.monster,showRollButtons:this.props.showRollButtons,onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}})),this.statSection("ac",this.props.monster.ac.toString()),this.statSection("hp",this.getHP()),this.statSection("saving throws",this.props.monster.savingThrows,this.props.showRollButtons),this.statSection("skills",this.props.monster.skills,this.props.showRollButtons),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment),r.a.createElement("hr",null),r.a.createElement(oe,{combatant:this.props.monster,mode:-1!==this.props.mode.indexOf("combat")?"combat":"view",showRollButtons:this.props.showRollButtons,useTrait:function(t){return e.props.useTrait(t)},rechargeTrait:function(t){return e.props.rechargeTrait(t)},onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}}))),t=r.a.createElement("div",{className:"stats"},r.a.createElement(ee,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),a)}else-1!==this.props.mode.indexOf("overview")&&(t=r.a.createElement("div",{className:"stats"},r.a.createElement(ee,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),r.a.createElement("hr",null),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment))),-1!==this.props.mode.indexOf("abilities")&&(t=r.a.createElement("div",{className:"stats"},r.a.createElement("div",{className:"section"},r.a.createElement(Q,{combatant:this.props.monster})),this.statSection("saving throws",this.props.monster.savingThrows),this.statSection("skills",this.props.monster.skills))),-1!==this.props.mode.indexOf("cbt-stats")&&(t=r.a.createElement("div",{className:"stats"},this.statSection("ac",this.props.monster.ac.toString()),this.statSection("hp",this.getHP()),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities))),-1!==this.props.mode.indexOf("actions")&&(t=r.a.createElement(oe,{combatant:this.props.monster,mode:"template",copyTrait:function(t){return e.props.copyTrait(t)}}));return t}},{key:"getIcon",value:function(){var e=this;return this.canSelect()?-1!==this.props.mode.indexOf("selected")?r.a.createElement(A.a,{onClick:function(){return e.props.deselectMonster(e.props.monster)}}):r.a.createElement(z.a,{onClick:function(){return e.props.selectMonster(e.props.monster)}}):null}},{key:"render",value:function(){try{var e=this.getButtons(),t=(this.props.monster?this.props.monster.displayName:null)||this.props.monster.name||"unnamed monster";return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:t},t),this.getIcon()),r.a.createElement("div",{className:"card-content"},this.getStats(),r.a.createElement("div",{style:{display:e.length>0?"":"none"}},r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},e))))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);le.defaultProps={mode:"full",showRollButtons:!1,library:null,nudgeValue:null,viewMonster:null,editMonster:null,removeMonster:null,exportMonster:null,cloneMonster:null,moveToGroup:null,copyTrait:null,selectMonster:null,deselectMonster:null,combat:null,makeCurrent:null,makeActive:null,makeDefeated:null,endTurn:null,mapAdd:null,mapMove:null,mapRemove:null,removeCombatant:null,changeHP:null,addCondition:null,editCondition:null,removeCondition:null,nudgeConditionValue:null,toggleTag:null,toggleCondition:null,useTrait:null,rechargeTrait:null,onRollDice:null};var ue=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{for(var t=this.props.itemsPerRow?this.props.itemsPerRow:this.props.options.length,a=Math.ceil(this.props.options.length/t),n=[],s=0;s!==a;++s)n.push([]);this.props.options.forEach((function(a){var s=e.props.options.indexOf(a),i=Math.floor(s/t);n[i].push(r.a.createElement(me,{key:a.id,option:a,selected:a.id===e.props.selectedID,onSelect:function(t){return e.props.onSelect(t)}}))}));var i=n.map((function(e){var t=n.indexOf(e);return r.a.createElement("div",{key:t,className:"selector-row"},e)}));return r.a.createElement("div",{className:this.props.disabled?"selector disabled":"selector"},i)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ue.defaultProps={itemsPerRow:null,disabled:!1};var me=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="option";return this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled"),r.a.createElement("div",{key:this.props.option.id,className:t,title:this.props.option.text,onClick:function(t){return e.click(t)}},this.props.option.text)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),pe=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={selectedPartyID:e.party?e.party.id:null},n}return Object(l.a)(a,[{key:"selectParty",value:function(e){this.setState({selectedPartyID:e})}},{key:"render",value:function(){var e=this;try{var t,a,n=D.getMonsterCount(this.props.encounter),s=D.getEncounterXP(this.props.encounter,this.props.getMonster),i=D.getAdjustedEncounterXP(this.props.encounter,this.props.getMonster),o=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"xp for this encounter"),r.a.createElement(d.a,{span:8,className:"statistic-value"},s," xp"))),r.a.createElement("div",{className:"section",style:{display:i===s?"none":""}},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"effective xp for ",n," monster(s)"),r.a.createElement(d.a,{span:8,className:"statistic-value"},i," xp")))),c=this.props.parties.find((function(t){return t.id===e.state.selectedPartyID}));if(c){var l=0,u=0,m=0,h=0,f=c.pcs.filter((function(e){return e.active}));f.forEach((function(e){l+=N.pcExperience(e.level,"easy"),u+=N.pcExperience(e.level,"medium"),m+=N.pcExperience(e.level,"hard"),h+=N.pcExperience(e.level,"deadly")}));var v="trivial",g="trivial";if(i>0&&(i>=l&&(v="easy",g="easy"),i>=u&&(v="medium",g="medium"),i>=m&&(v="hard",g="hard"),i>=h&&(v="deadly",g="deadly"),h>0&&i>=10*h&&(v="tpk",g="tpk"),h>0&&i>=100*h&&(v="dm with a grudge",g="dm with a grudge"),h>0&&i>=1e3*h&&(v="now you're just being silly",g="now you're just being silly"),f.length<3||f.length>5)){var b=f.length<3;switch(v){case"trivial":g=b?"easy":"trivial";break;case"easy":g=b?"medium":"trivial";break;case"medium":g=b?"hard":"easy";break;case"hard":g=b?"deadly":"medium";break;case"deadly":g=b?"deadly":"hard";break;default:g=""}}t=r.a.createElement("div",{className:"table"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell easy"},r.a.createElement("b",null,"easy")),r.a.createElement("div",{className:"table-cell medium"},r.a.createElement("b",null,"medium")),r.a.createElement("div",{className:"table-cell hard"},r.a.createElement("b",null,"hard")),r.a.createElement("div",{className:"table-cell deadly"},r.a.createElement("b",null,"deadly"))),r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell"},l," xp"),r.a.createElement("div",{className:"table-cell"},u," xp"),r.a.createElement("div",{className:"table-cell"},m," xp"),r.a.createElement("div",{className:"table-cell"},h," xp")));var y=function(e){return 100*e/Math.max(i,1.2*h)},E=function(e){return 100-y(e)};a=r.a.createElement("div",null,r.a.createElement("div",{className:"difficulty-gauge"},r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar trivial",style:{left:"0",right:E(l)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar easy",style:{left:y(l)+"%",right:E(u)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar medium",style:{left:y(u)+"%",right:E(m)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar hard",style:{left:y(m)+"%",right:E(h)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar deadly",style:{left:y(h)+"%",right:"0"}})),r.a.createElement("div",{className:"encounter-container"},r.a.createElement("div",{className:"encounter",style:{left:y(i)-.5+"%"}}))),o,r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"difficulty for this party"),r.a.createElement(d.a,{span:8,className:"statistic-value"},v))),r.a.createElement("div",{className:"section",style:{display:g===v?"none":""}},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"effective difficulty for ",f.length," pc(s)"),r.a.createElement(d.a,{span:8,className:"statistic-value"},g))))}else a=o;var k=null;if(!this.props.party){var w=[];if(this.props.parties)for(var C=0;C!==this.props.parties.length;++C){var x=this.props.parties[C];w.push({id:x.id,text:x.name})}k=r.a.createElement(W,{options:w,placeholder:"select party...",selectedID:this.state.selectedPartyID?this.state.selectedPartyID:void 0,onSelect:function(t){return e.selectParty(t)},onClear:function(){return e.selectParty(null)}})}return k?r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"subheading"},"difficulty"),k,t,a):r.a.createElement("div",null,t,a)}catch(S){return console.error(S),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);pe.defaultProps={party:null};var de=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;t=r.a.createElement(P.a,{range:!0,min:0,max:30,value:[this.props.filter.challengeMin,this.props.filter.challengeMax],onChange:function(t){return e.props.changeValue("challenge",t)}});var a=null,n=["all sizes"].concat(b).map((function(e){return{id:e,text:e}}));a=r.a.createElement(W,{options:n,placeholder:"filter by size...",selectedID:this.props.filter.size,onSelect:function(t){return e.props.changeValue("size",t)}});var s=null,i=["all types"].concat(y).map((function(e){return{id:e,text:e}})),o=i.find((function(e){return"aberration"===e.id}));o&&(o.text="aberr.");var c=i.find((function(e){return"celestial"===e.id}));c&&(c.text="celest.");var l=i.find((function(e){return"construct"===e.id}));l&&(l.text="const.");var u=i.find((function(e){return"elemental"===e.id}));u&&(u.text="elem.");var m=i.find((function(e){return"humanoid"===e.id}));m&&(m.text="human.");var p=i.find((function(e){return"monstrosity"===e.id}));p&&(p.text="monst."),s=r.a.createElement(ue,{options:i,selectedID:this.props.filter.category,itemsPerRow:3,onSelect:function(t){return e.props.changeValue("category",t)}});var d=null;if(this.props.showRoles){var h=["all roles"].concat(E).map((function(e){return{id:e,text:e}}));d=r.a.createElement(ue,{options:h,selectedID:this.props.filter.role,itemsPerRow:2,onSelect:function(t){return e.props.changeValue("role",t)}})}return r.a.createElement("div",null,r.a.createElement(H,{key:"search",text:this.props.filter.name,placeholder:"filter by name",noMargins:!0,onChange:function(t){return e.props.changeValue("name",t)}}),r.a.createElement(U,{text:"showing "+D.getFilterDescription(this.props.filter)},t,a,s,d,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.resetFilter()}},"clear filter"))))}catch(f){return console.error(f),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);de.defaultProps={showRoles:!0};var he=a(242),fe=a(241),ve=a(240),ge=a(239),be=a(33),ye=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){try{var e=this.props.combatant.hpCurrent||0,t=this.props.combatant.hpMax||0,a=this.props.combatant.hpTemp||0,n=t/2,s=100*Math.max(e,0)/(t+a),i="";i=e>=t?"bar unhurt":e<=n?"bar bloodied":"bar injured";var o=null;if(null!==this.props.combatant.hpTemp&&this.props.combatant.hpTemp>0){var c=100*Math.max(this.props.combatant.hpTemp,0)/(t+a);o=r.a.createElement("div",{className:"bar temp",style:{width:c+"%"}})}return r.a.createElement("div",{className:"hp-gauge"},r.a.createElement("div",{className:i,style:{width:s+"%"}}),o)}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ee=new re.a.Converter;Ee.setOption("tables",!0);var ke=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={showControls:!1,size:"thumbnail"===e.mode?15:45,selectionStartSquare:null,selectionEndSquare:null},n}return Object(l.a)(a,[{key:"gridSquareMouseDown",value:function(e,t){this.setState({selectionStartSquare:{x:e,y:t},selectionEndSquare:null})}},{key:"gridSquareEntered",value:function(e,t){this.state.selectionStartSquare?this.setState({selectionEndSquare:{x:e,y:t}}):this.props.gridSquareEntered&&this.props.gridSquareEntered(e,t)}},{key:"gridSquareMouseUp",value:function(e,t){var a=this;if(this.state.selectionStartSquare){var n=this.state.selectionStartSquare.x,r=this.state.selectionStartSquare.y;this.setState({selectionStartSquare:null,selectionEndSquare:null},(function(){if(n===e&&r===t)a.props.gridSquareClicked&&a.props.gridSquareClicked(e,t);else if(a.props.gridRectangleSelected){var s=Math.min(n,e),i=Math.min(r,t),o=Math.max(n,e),c=Math.max(r,t);a.props.gridRectangleSelected(s,i,o,c)}}))}}},{key:"isSelected",value:function(e,t){if(this.state.selectionStartSquare&&this.state.selectionEndSquare){var a=Math.min(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),n=Math.min(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y),r=Math.max(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),s=Math.max(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y);return e>=a&&e<=r&&t>=n&&t<=s}return!1}},{key:"toggleShowControls",value:function(){this.setState({showControls:!this.state.showControls})}},{key:"nudgeSize",value:function(e){var t=Math.max(this.state.size+e,3);this.setState({size:t})}},{key:"getMapDimensions",value:function(){var e=this,t=this.props.viewport;t||this.props.map.items.filter((function(t){return"edit"!==e.props.mode||"tile"===t.type})).forEach((function(e){t?(t.minX=Math.min(t.minX,e.x),t.maxX=Math.max(t.maxX,e.x+e.width-1),t.minY=Math.min(t.minY,e.y),t.maxY=Math.max(t.maxY,e.y+e.height-1)):t={minX:e.x,maxX:e.x+e.width-1,minY:e.y,maxY:e.y+e.height-1}}));if(this.props.combatants&&this.props.combatants.filter((function(e){return e.aura.radius>0})).forEach((function(a){var n=e.props.map.items.find((function(e){return e.id===a.id}));if(n){var r=a.aura.radius/5,s=1,i=a;i&&(s=Math.max(N.miniSize(i.size),1));var o=n.x-r,c=n.x+(s-1)+r,l=n.y-r,u=n.y+(s-1)+r;t&&(t.minX=Math.min(t.minX,o),t.maxX=Math.max(t.maxX,c),t.minY=Math.min(t.minY,l),t.maxY=Math.max(t.maxY,u))}})),!t){if("thumbnail"===this.props.mode)return null;t={minX:0,maxX:0,minY:0,maxY:0}}return t.minX-=this.props.paddingSquares,t.maxX+=this.props.paddingSquares,t.minY-=this.props.paddingSquares,t.maxY+=this.props.paddingSquares,t}},{key:"getStyle",value:function(e,t,a,n,r,s){var i=0,o=0;a<1&&(i=(1-a)/2),n<1&&(o=(1-n)/2);var c="0";switch(r){case"rounded":c=this.state.size+"px";break;case"circle":c="50%"}return{left:"calc("+this.state.size+"px * "+(e+i-s.minX)+")",top:"calc("+this.state.size+"px * "+(t+o-s.minY)+")",width:"calc(("+this.state.size+"px * "+a+") + 1px)",height:"calc(("+this.state.size+"px * "+n+") + 1px)",borderRadius:c,backgroundSize:this.state.size+"px"}}},{key:"menuClick",value:function(e){e.stopPropagation(),this.toggleShowControls()}},{key:"render",value:function(){var e=this;try{var t=this.getMapDimensions();if(!t)return r.a.createElement("div",{className:"section centered"},"(blank map)");var a=[];a=a.concat(this.props.map.items),this.props.floatingItem&&a.push(this.props.floatingItem);var n=a.filter((function(e){return"tile"===e.type})).map((function(a){var n=e.getStyle(a.x,a.y,a.width,a.height,a.style,t);return r.a.createElement(Ne,{key:a.id,tile:a,note:"combat-player"!==e.props.mode?O.getNote(e.props.map,a):null,style:n,selectable:"edit"===e.props.mode,selected:e.props.selectedItemIDs.includes(a.id),select:function(t,a){return"edit"===e.props.mode?e.props.itemSelected(t,a):null}})})),s=[];"edit"!==this.props.mode&&(s=this.props.fog.map((function(a){var n=e.getStyle(a.x,a.y,1,1,"square",t);return r.a.createElement(we,{key:a.x+","+a.y,x:a.x,y:a.y,style:n,mode:"fog"})})));var i=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(i=a.filter((function(e){return"overlay"===e.type})).map((function(a){var n=e.getStyle(a.x,a.y,a.width,a.height,a.style,t);return n.backgroundColor=a.color+a.opacity.toString(16),r.a.createElement(Ce,{key:a.id,overlay:a,note:"combat-player"!==e.props.mode?O.getNote(e.props.map,a):null,style:n,selected:e.props.selectedItemIDs.includes(a.id),select:function(t,a){return e.props.itemSelected(t,a)}})})));var o=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(o=this.props.combatants.filter((function(e){return e.aura.radius>0})).filter((function(t){return t.showOnMap||"combat-player"!==e.props.mode})).map((function(n){var s=a.find((function(e){return e.id===n.id}));if(s){var i=n.aura.radius/5,o=2*i+Math.max(N.miniSize(n.displaySize),1),c=e.getStyle(s.x-i,s.y-i,o,o,n.aura.style,t);return c.backgroundColor=n.aura.color,r.a.createElement("div",{key:n.id+" aura",className:"aura",style:c})}return null})).filter((function(e){return null!==e})));var c=[];if("edit"!==this.props.mode){var l=this.props.combatants.map((function(e){return e.mountID||""})).filter((function(e){return""!==e}));c=a.filter((function(e){return"monster"===e.type||"pc"===e.type||"companion"===e.type||"token"===e.type})).filter((function(e){return!l.includes(e.id)})).map((function(a){var n=N.miniSize(a.size),s=O.getNote(e.props.map,a),i=!1,o=e.props.combatants.find((function(e){return e.id===a.id}));if(o){var c=o.displaySize;if(o.mountID){var l=e.props.combatants.find((function(e){return e.id===o.mountID}));l&&(c=l.displaySize)}n=N.miniSize(c),!s&&o.note&&((s=C.createMapNote()).targetID=o.id,s.text=o.note),i="pc"===o.type}var u=e.getStyle(a.x,a.y,n,n,"circle",t);return r.a.createElement(xe,{key:a.id,token:a,note:"combat-player"!==e.props.mode?s:null,combatant:o||null,style:u,simple:"thumbnail"===e.props.mode,showGauge:"combat"===e.props.mode,showHidden:"combat"===e.props.mode||i,selectable:"combat"===e.props.mode||"combat-player"===e.props.mode,selected:e.props.selectedItemIDs.includes(a.id),select:function(t,a){return e.props.itemSelected(t,a)}})})).filter((function(e){return null!==e}))}var u=[];if(this.props.showGrid)for(var m=t.minY;m!==t.maxY+1;++m)for(var p=t.minX;p!==t.maxX+1;++p){var d=this.getStyle(p,m,1,1,"square",t);u.push(r.a.createElement(we,{key:p+","+m,x:p,y:m,style:d,mode:"cell",selected:this.isSelected(p,m),onMouseDown:function(t,a){return e.gridSquareMouseDown(t,a)},onMouseUp:function(t,a){return e.gridSquareMouseUp(t,a)},onMouseEnter:function(t,a){return e.gridSquareEntered(t,a)}}))}var h=null;"thumbnail"!==this.props.mode&&(h=this.state.showControls?r.a.createElement("div",{className:"map-menu"},r.a.createElement(he.a,{className:"menu-icon rotate",onClick:function(t){return e.menuClick(t)}}),r.a.createElement(Z,{value:"zoom",downEnabled:this.state.size>3,onNudgeValue:function(t){return e.nudgeSize(3*t)}})):r.a.createElement("div",{className:"map-menu"},r.a.createElement(he.a,{className:"menu-icon",onClick:function(t){return e.menuClick(t)}})));var f="map-panel "+this.props.mode,v=1+t.maxX-t.minX,g=1+t.maxY-t.minY;return r.a.createElement("div",{className:f,onClick:function(){return e.props.itemSelected?e.props.itemSelected(null,!1):null}},r.a.createElement("div",{className:"grid",style:{width:this.state.size*v+2+"px",height:this.state.size*g+2+"px"}},n,s,i,o,c,u),h)}catch(b){return console.error(b),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ke.defaultProps={mode:"thumbnail",viewport:null,paddingSquares:0,floatingItem:null,combatants:[],showGrid:!1,selectedItemIDs:[],fog:[],itemSelected:null,gridSquareEntered:null,gridSquareClicked:null,gridRectangleUpdated:null,gridRectangleSelected:null};var we=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"mouseDown",value:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(this.props.x,this.props.y)}},{key:"mouseUp",value:function(e){e.stopPropagation(),this.props.onMouseUp&&this.props.onMouseUp(this.props.x,this.props.y)}},{key:"mouseEnter",value:function(e){e.stopPropagation(),this.props.onMouseEnter&&this.props.onMouseEnter(this.props.x,this.props.y)}},{key:"doubleClick",value:function(e){e.stopPropagation(),this.props.onDoubleClick&&this.props.onDoubleClick(this.props.x,this.props.y)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"grid-square "+this.props.mode+(this.props.selected?" selected":""),style:this.props.style,onMouseDown:function(t){return e.mouseDown(t)},onMouseUp:function(t){return e.mouseUp(t)},onMouseEnter:function(t){return e.mouseEnter(t)},onDoubleClick:function(t){return e.doubleClick(t)}})}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);we.defaultProps={selected:!1,onMouseDown:null,onMouseUp:null,onMouseEnter:null,onDoubleClick:null};var Ne=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"select",value:function(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.tile.id,e.ctrlKey))}},{key:"getNoteText",value:function(){return this.props.note?this.props.note.text.trim():""}},{key:"render",value:function(){var e=this;try{var t="tile "+this.props.tile.terrain;this.props.selected&&(t+=" selected");var a=null;if("custom"===this.props.tile.terrain){var n=window.localStorage.getItem("image-"+this.props.tile.customBackground);if(n){var s=JSON.parse(n);a=r.a.createElement("img",{className:"custom-image",alt:"map tile",src:s.data})}}var i=null;if(this.props.tile.content)switch(this.props.tile.content.type){case"doorway":switch(this.props.tile.content.style){case"single":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}))}break;case"double":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"25%",x2:"50%",y2:"75%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}),r.a.createElement("line",{className:"thin",x1:"25%",y1:"50%",x2:"75%",y2:"50%"}))}break;case"arch":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"20%",y2:"50%"}),r.a.createElement("line",{className:"thick",x1:"80%",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"20%",y2:"80%"}),r.a.createElement("line",{className:"medium",x1:"80%",y1:"20%",x2:"80%",y2:"80%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"20%"}),r.a.createElement("line",{className:"thick",x1:"50%",y1:"80%",x2:"50%",y2:"100%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"80%",y2:"20%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"80%",x2:"80%",y2:"80%"}))}break;case"bars":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"10%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"30%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"70%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"90%",cy:"50%",r:"5%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"10%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"30%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"70%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"90%",r:"5%"}))}}break;case"stairway":switch(this.props.tile.content.style){case"stairs":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thin",x1:"0",y1:"12.5%",x2:"100%",y2:"12.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"25%",x2:"100%",y2:"25%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"37.5%",x2:"100%",y2:"37.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"62.5%",x2:"100%",y2:"62.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"75%",x2:"100%",y2:"75%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"87.5%",x2:"100%",y2:"87.5%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thin",x1:"12.5%",y1:"0",x2:"12.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"25%",y1:"0",x2:"25%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"37.5%",y1:"0",x2:"37.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"62.5%",y1:"0",x2:"62.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"75%",y1:"0",x2:"75%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"87.5%",y1:"0",x2:"87.5%",y2:"100%"}))}break;case"spiral":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("ellipse",{className:"thin outline",cx:"50%",cy:"50%",rx:"40%",ry:"40%"}),r.a.createElement("ellipse",{className:"thin filled",cx:"50%",cy:"50%",rx:"10%",ry:"10%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"10%",x2:"50%",y2:"90%"}),r.a.createElement("line",{className:"thin",x1:"10%",y1:"50%",x2:"90%",y2:"50%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"20%",x2:"80%",y2:"80%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"80%",x2:"80%",y2:"20%"}));break;case"ladder":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"20%",cy:"50%",r:"7%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"50%",x2:"80%",y2:"50%"}),r.a.createElement("circle",{className:"thin filled",cx:"80%",cy:"50%",r:"7%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"20%",r:"7%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"20%",x2:"50%",y2:"80%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"80%",r:"7%"}))}}}var o=r.a.createElement("div",{className:t,style:this.props.style,onClick:function(t){return e.select(t)}},a,i),c=this.getNoteText();return c?r.a.createElement(be.a,{placement:"bottom",title:r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Ee.makeHtml(c)}})},o):o}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ce=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"select",value:function(e){e.stopPropagation(),this.props.select(this.props.overlay.id,e.ctrlKey)}},{key:"getNoteText",value:function(){return this.props.note?this.props.note.text.trim():""}},{key:"render",value:function(){var e=this;try{var t="overlay";this.props.selected&&(t+=" selected");var a=r.a.createElement("div",{className:t,style:this.props.style,onClick:function(t){return e.select(t)}}),n=this.getNoteText();return n?r.a.createElement(be.a,{placement:"bottom",title:r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Ee.makeHtml(n)}})},a):a}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),xe=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"select",value:function(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.token.id,e.ctrlKey))}},{key:"getNoteText",value:function(){var e=this.props.combatant?"**"+this.props.combatant.displayName+"**":"";return this.props.combatant&&(this.props.combatant.showOnMap||(e+="\n\n",e+="**hidden**"),this.props.combatant.tags.forEach((function(t){e+="\n\n",e+="**"+N.getTagTitle(t)+"**",e+="\n\n",e+="* "+N.getTagDescription(t)})),this.props.combatant.conditions.forEach((function(t){e+="\n\n",e+="**"+t.name+"**",N.conditionText(t).forEach((function(t){e+="\n\n",e+="* "+t}))}))),this.props.note&&this.props.note.text&&(e+="\n\n",e+=this.props.note.text),e.trim()}},{key:"render",value:function(){var e=this;try{var t="token",a="token";if(this.props.selected&&(a+=" selected"),this.props.combatant&&(t=this.props.combatant.displayName||"combatant",a+=" "+this.props.combatant.faction,this.props.combatant.current&&(a+=" current"),!this.props.combatant.showOnMap)){if(!this.props.showHidden)return null;a+=" hidden"}var n=null,s=null,i=null,o=null;if(this.props.combatant&&!this.props.simple){var c="",l=this.props.combatant;if(l&&l.portrait){var u=window.localStorage.getItem("image-"+l.portrait);if(u)c=JSON.parse(u).data}if(c)n=r.a.createElement("img",{className:"portrait",src:c,alt:t});else{var m=t.toUpperCase().replace(/[^A-Z0-9 ]/,"").split(" ").map((function(e){return e[0]})).join("");n=r.a.createElement("div",{className:"initials"},m)}if("monster"===this.props.combatant.type&&this.props.showGauge)(this.props.combatant.hpCurrent||0)<(this.props.combatant.hpMax||0)&&(s=r.a.createElement(ye,{combatant:this.props.combatant}));this.props.combatant.altitude>0&&(i=r.a.createElement("div",{className:"badge"},r.a.createElement(fe.a,{twoToneColor:"#3c78dc"}))),this.props.combatant.altitude<0&&(i=r.a.createElement("div",{className:"badge"},r.a.createElement(ve.a,{twoToneColor:"#3c78dc"})));var p=0;this.props.combatant.conditions&&(p+=this.props.combatant.conditions.length),this.props.combatant.tags&&(p+=this.props.combatant.tags.filter((function(e){return!e.startsWith("engaged")})).length),p>0&&(o=r.a.createElement("div",{className:"conditions"},r.a.createElement(ge.a,{twoToneColor:"#3c78dc"})))}var d=r.a.createElement("div",{className:a,style:this.props.style,onClick:function(t){return e.select(t)}},n,s,i,o),h=this.getNoteText();return h?r.a.createElement(be.a,{placement:"bottom",title:r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Ee.makeHtml(h)}})},d):d}catch(f){return console.error(f),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Se=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={combatSetup:e.combatSetup,partyFixed:!!e.combatSetup.party,encounterFixed:!!e.combatSetup.encounter,mapFixed:!!e.combatSetup.map},n}return Object(l.a)(a,[{key:"setPartyID",value:function(e){var t=this,a=this.state.combatSetup,n=this.props.parties.find((function(t){return t.id===e}));a.party=n?JSON.parse(JSON.stringify(n)):null,this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"setEncounterID",value:function(e){var t=this,a=this.state.combatSetup,n=this.props.encounters.find((function(t){return t.id===e}));a.encounter=n?JSON.parse(JSON.stringify(n)):null,a.slotInfo=N.getCombatSlotData(a.encounter,this.props.library),this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"setMapID",value:function(e){var t=this.props.maps.find((function(t){return t.id===e})),a=this.state.combatSetup;a.map=t||null,this.setState({combatSetup:a})}},{key:"setWaveID",value:function(e){var t=this,a=this.state.combatSetup;if(a.waveID=e,a.encounter){var n=a.encounter.waves.find((function(t){return t.id===e}));n&&(a.slotInfo=N.getCombatSlotData(n,this.props.library))}this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"generateEncounter",value:function(e){var t=this,a=C.createEncounter();a.name="new encounter";var n=C.createMonsterFilter(),r=0,s=0;if(this.state.combatSetup.party){var i=this.state.combatSetup.party.pcs.filter((function(e){return e.active}));i.forEach((function(t){r+=N.pcExperience(t.level,e),s+=t.level}));var o=s/i.length;n.challengeMax=Math.max(o,5)}D.buildEncounter(a,r,n,this.props.library,this.props.getMonster);var c=this.state.combatSetup;c.encounter=a,c.slotInfo=N.getCombatSlotData(a,this.props.library),this.setState({combatSetup:c},(function(){return t.props.notify()}))}},{key:"generateMap",value:function(e){var t=this,a=C.createMap();a.name="new map",O.generate(e,a);var n=this.state.combatSetup;n.map=a,this.setState({combatSetup:n},(function(){return t.props.notify()}))}},{key:"changeValue",value:function(e,t,a){e[t]=a;var n=e;n.members&&("init"===t&&n.members.forEach((function(e){return e.init=a})),"hp"===t&&n.members.forEach((function(e){return e.hp=a}))),this.setState({combatSetup:this.state.combatSetup})}},{key:"nudgeCount",value:function(e,t){var a=this.state.combatSetup;if(a.encounter){var n=a.encounter.slots.find((function(t){return t.id===e}));n&&(n.count=Math.max(0,n.count+t),a.slotInfo=N.getCombatSlotData(a.encounter,this.props.library),this.setState({combatSetup:a}))}}},{key:"render",value:function(){var e=this;try{var t=null,a=null;switch(this.props.type){case"start":t=r.a.createElement("div",null,r.a.createElement(Me,{combatSetup:this.state.combatSetup,parties:this.props.parties,fixed:this.state.partyFixed,setPartyID:function(t){return e.setPartyID(t)}}),r.a.createElement(Oe,{combatSetup:this.state.combatSetup,encounters:this.props.encounters,fixed:this.state.encounterFixed,setEncounterID:function(t){return e.setEncounterID(t)},generateEncounter:function(t){return e.generateEncounter(t)}}),r.a.createElement(Ie,{combatSetup:this.state.combatSetup,maps:this.props.maps,fixed:this.state.mapFixed,setMapID:function(t){return e.setMapID(t)},generateMap:function(t){return e.generateMap(t)}})),a=r.a.createElement("div",null,r.a.createElement(Te,{combatSetup:this.state.combatSetup,parties:this.props.parties,encounters:this.props.encounters,getMonster:function(t,a){return e.props.getMonster(t,a)}}),r.a.createElement(Ve,{type:this.props.type,combatSetup:this.state.combatSetup,parties:this.props.parties,getMonster:function(t,a){return e.props.getMonster(t,a)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeCount:function(t,a){return e.nudgeCount(t,a)}}));break;case"add-wave":t=r.a.createElement("div",null,r.a.createElement(De,{combatSetup:this.state.combatSetup,setWaveID:function(t){return e.setWaveID(t)}})),a=r.a.createElement("div",null,r.a.createElement(Ve,{type:this.props.type,combatSetup:this.state.combatSetup,parties:this.props.parties,getMonster:function(t,a){return e.props.getMonster(t,a)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeCount:function(t,a){return e.nudgeCount(t,a)}}));break;case"add-combatants":t=r.a.createElement("div",null,r.a.createElement(je,{combatSetup:this.state.combatSetup,library:this.props.library,addMonster:function(t){return e.props.addMonster(t)}})),a=r.a.createElement("div",null,r.a.createElement(Ve,{type:this.props.type,combatSetup:this.state.combatSetup,parties:this.props.parties,getMonster:function(t,a){return e.props.getMonster(t,a)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeCount:function(t,a){return e.nudgeCount(t,a)}}))}return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},t),r.a.createElement(d.a,{span:12,className:"scrollable"},a))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Se.defaultProps={parties:null,encounters:null,maps:null,addMonster:null};var Me=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;if(0===this.props.parties.length)return r.a.createElement("div",{className:"section"},"you have not defined any parties");var t=null;if(!this.props.combatSetup.party){var a=this.props.parties.map((function(e){return{id:e.id,text:e.name||"unnamed party"}}));t=r.a.createElement(W,{options:a,placeholder:"select a party",onSelect:function(t){return e.props.setPartyID(t)}})}var n=null;if(this.props.combatSetup.party){var s=this.props.combatSetup.party.pcs.filter((function(e){return e.active})).map((function(e){return r.a.createElement("div",{key:e.id,className:"group-panel"},e.name||"unnamed pc"," (level ",e.level,")")}));0===s.length&&s.push(r.a.createElement(se,{key:"empty"},"no pcs")),n=r.a.createElement("div",null,s)}var i=null;return this.props.combatSetup.party&&!this.props.fixed&&(i=r.a.createElement(T.a,{onClick:function(){return e.props.setPartyID(null)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"party",i),t,n)}}]),a}(r.a.Component),Oe=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=null;if(!this.props.combatSetup.encounter){var a=null;if(this.props.encounters.length>0){var n=this.props.encounters.map((function(e){return{id:e.id,text:e.name||"unnamed encounter"}}));a=r.a.createElement(W,{options:n,placeholder:"select an encounter",onSelect:function(t){return e.props.setEncounterID(t)}})}var s=null;this.props.combatSetup.party&&(s=r.a.createElement("button",{onClick:function(){return e.props.generateEncounter("medium")}},"generate a random encounter")),t=r.a.createElement("div",null,a,s)}var i=null;if(this.props.combatSetup.encounter){var o=this.props.combatSetup.encounter.slots.map((function(e){var t=e.monsterName||"unnamed monster";return e.count>1&&(t+=" (x"+e.count+")"),r.a.createElement("div",{key:e.id,className:"group-panel"},t)}));0===o.length&&o.push(r.a.createElement(se,{key:"empty"},"no monsters"));var c=this.props.combatSetup.encounter.waves.map((function(e){if(0===e.slots.length)return null;var t=e.slots.map((function(e){var t=e.monsterName||"unnamed monster";return e.count>1&&(t+=" x"+e.count),r.a.createElement("div",{key:e.id,className:"group-panel"},t)}));return r.a.createElement("div",{key:e.id},r.a.createElement("div",{className:"subheading"},e.name||"unnamed wave"),t)}));i=r.a.createElement("div",null,o,c)}var l=null;return this.props.combatSetup.encounter&&!this.props.fixed&&(l=r.a.createElement(T.a,{onClick:function(){return e.props.setEncounterID(null)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"encounter",l),t,i)}}]),a}(r.a.Component),Ie=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=null;if(!this.props.combatSetup.map){var a=null;if(this.props.maps.length>0){var n=this.props.maps.map((function(e){return{id:e.id,text:e.name||"unnamed map",display:r.a.createElement(ke,{map:e})}}));a=r.a.createElement(W,{options:n,placeholder:"select a map",onSelect:function(t){return e.props.setMapID(t)}})}t=r.a.createElement("div",null,r.a.createElement(se,null,"this is optional - you don't have to use a map to run an encounter"),a,r.a.createElement("button",{onClick:function(){return e.props.generateMap("delve")}},"generate a random delve"))}var s=null;this.props.combatSetup.map&&(s=r.a.createElement(ke,{map:this.props.combatSetup.map,combatants:this.props.combatSetup.combatants}));var i=null;return this.props.combatSetup.map&&!this.props.fixed&&(i=r.a.createElement(T.a,{onClick:function(){return e.props.setMapID(null)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"map",i),t,s)}}]),a}(r.a.Component),De=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;if(null===this.props.combatSetup.encounter)return r.a.createElement("div",{className:"section"},"you have not selected an encounter");if(0===this.props.combatSetup.encounter.waves.length)return r.a.createElement("div",{className:"section"},"you have not defined any waves");var t=this.props.combatSetup.encounter.waves.map((function(e){return{id:e.id,text:e.name||"unnamed wave"}})),a=null;if(this.props.combatSetup.waveID){var n=this.props.combatSetup.encounter.waves.find((function(t){return t.id===e.props.combatSetup.waveID}));if(n){var s=n.slots.map((function(e){var t=e.monsterName||"unnamed monster";return e.count>1&&(t+=" (x"+e.count+")"),r.a.createElement("div",{key:e.id,className:"group-panel"},t)}));0===s.length&&s.push(r.a.createElement(se,{key:"empty"},"no monsters")),a=r.a.createElement("div",null,s)}}return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"wave"),r.a.createElement(W,{options:t,placeholder:"select wave",selectedID:this.props.combatSetup.waveID?this.props.combatSetup.waveID:void 0,onSelect:function(t){return e.props.setWaveID(t)},onClear:function(){return e.props.setWaveID(null)}}),a)}}]),a}(r.a.Component),je=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={filter:C.createMonsterFilter()},n}return Object(l.a)(a,[{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:C.createMonsterFilter()})}},{key:"matchMonster",value:function(e){return D.matchMonster(e,this.state.filter)}},{key:"render",value:function(){var e=this,t=[];this.props.library.forEach((function(a){a.monsters.forEach((function(a){e.matchMonster(a)&&t.push(a)}))})),t.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var a=this.props.combatSetup.slotInfo.map((function(e){return e.id})),n=t.filter((function(e){return!a.includes(e.id)})).map((function(t){return r.a.createElement(le,{key:t.id,monster:t,mode:"candidate",selectMonster:function(t){return e.props.addMonster(t)}})}));return 0===n.length&&(n=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"there are no monsters that match the above criteria (or you have already selected them all)"))),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement(de,{filter:this.state.filter,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}}),n)}}]),a}(r.a.Component),Te=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return this.props.combatSetup.party&&this.props.combatSetup.encounter?r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"encounter difficulty"),r.a.createElement(pe,{parties:this.props.parties,party:this.props.combatSetup.party,encounter:this.props.combatSetup.encounter,getMonster:function(t,a){return e.props.getMonster(t,a)}})):r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"encounter difficulty"),r.a.createElement("div",{className:"section"},"select a party and an encounter on the left to see difficulty information."))}}]),a}(r.a.Component),Ve=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:"initiative"},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"render",value:function(){var e,t=this;if("start"===this.props.type&&!this.props.combatSetup.encounter)return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement("div",{className:"section"},"select an encounter to see monster information here."));if("add-wave"===this.props.type&&!this.props.combatSetup.waveID)return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement("div",{className:"section"},"select a wave to see monster information here."));if("add-combatants"===this.props.type&&0===(null===(e=this.props.combatSetup.encounter)||void 0===e?void 0:e.slots.length))return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement("div",{className:"section"},"add monsters to see their information here."));if(this.props.combatSetup.encounter){var a=this.props.combatSetup.encounter;if(this.props.combatSetup.waveID){var n=this.props.combatSetup.encounter.waves.find((function(e){return e.id===t.props.combatSetup.waveID}));n&&(a=n)}if(0===a.slots.length)return null;var s=["initiative","hit points","names","advanced"].map((function(e){return{id:e,text:e}})),i=this.props.combatSetup.slotInfo.map((function(e){var n=a.slots.find((function(t){return t.id===e.id}));if(!n)return null;var s=t.props.getMonster(n.monsterName,n.monsterGroupName);return s?r.a.createElement(Pe,{key:e.id,slotInfo:e,encounterSlot:n,monster:s,view:t.state.view,changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeCount:function(e,a){return t.props.nudgeCount(e,a)}}):null}));return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement(ue,{options:s,selectedID:this.state.view,onSelect:function(e){return t.setView(e)}}),r.a.createElement("hr",null),r.a.createElement("div",null,i))}return null}}]),a}(r.a.Component),Pe=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"rollInit",value:function(e){var t=N.dieRoll(),a=N.modifierValue(this.props.monster.abilityScores.dex);this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"init",t+a)}},{key:"rollHP",value:function(e){var t=N.hitDieType(this.props.monster.size),a=N.dieRoll(t,this.props.monster.hitDice),n=N.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice;this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"hp",a+n)}},{key:"getValueSection",value:function(e,t,a,n,s){var i=this;return r.a.createElement(p.a,{align:"middle"},r.a.createElement(d.a,{span:20},r.a.createElement(P.a,{min:e,max:t,value:a[n],onChange:function(e){return i.props.changeValue(a,n,e)}})),r.a.createElement(d.a,{span:4},r.a.createElement("div",{className:"combatant-value"},a[n],r.a.createElement(V.a,{onClick:function(){return s()}}))))}},{key:"getInitSection",value:function(){var e=this,t=null;this.props.encounterSlot.count>1&&(t=r.a.createElement(j,{label:"roll initiative once for this group",checked:this.props.slotInfo.useGroupInit,onChecked:function(t){return e.props.changeValue(e.props.slotInfo,"useGroupInit",t)}}));var a=N.modifierValue(this.props.monster.abilityScores.dex),n=1+a,s=20+a,i=[];return this.props.slotInfo.useGroupInit?i.push(r.a.createElement("div",{key:"init"},this.getValueSection(n,s,this.props.slotInfo,"init",(function(){return e.rollInit(null)})))):this.props.slotInfo.members.forEach((function(t){i.push(r.a.createElement("div",{key:t.id},r.a.createElement("div",{className:"combatant-name"},t.name),e.getValueSection(n,s,t,"init",(function(){return e.rollInit(t)}))))})),r.a.createElement("div",null,t,i)}},{key:"getHPSection",value:function(){var e=this,t=null;this.props.encounterSlot.count>1&&(t=r.a.createElement(j,{label:"roll hit points once for this group",checked:this.props.slotInfo.useGroupHP,onChecked:function(t){return e.props.changeValue(e.props.slotInfo,"useGroupHP",t)}}));var a=w.getTypicalHP(this.props.monster),n=N.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice,s=this.props.monster.hitDice+n,i=this.props.monster.hitDice*N.hitDieType(this.props.monster.size)+n,o=[];return this.props.slotInfo.useGroupHP?o.push(r.a.createElement("div",{key:"hp"},this.getValueSection(s,i,this.props.slotInfo,"hp",(function(){return e.rollHP(null)})),r.a.createElement("button",{className:this.props.slotInfo.hp!==a?"":"disabled",onClick:function(){return e.props.changeValue(e.props.slotInfo,"hp",a)}},"reset to average hp"))):this.props.slotInfo.members.forEach((function(t){o.push(r.a.createElement("div",{key:t.id},r.a.createElement("div",{className:"combatant-name"},t.name),e.getValueSection(s,i,t,"hp",(function(){return e.rollHP(t)})),r.a.createElement("button",{className:t.hp!==a?"":"disabled",onClick:function(){return e.props.changeValue(t,"hp",a)}},"reset to average hp")))})),r.a.createElement("div",null,t,o)}},{key:"getNameSection",value:function(){var e=this;return this.props.slotInfo.members.map((function(t){return r.a.createElement(H,{key:t.id,text:t.name,onChange:function(a){return e.props.changeValue(t,"name",a)}})}))}},{key:"getCountSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(Z,{value:"count: "+this.props.encounterSlot.count,downEnabled:this.props.encounterSlot.count>1,onNudgeValue:function(t){return e.props.nudgeCount(e.props.encounterSlot.id,t)}}),r.a.createElement(W,{options:["foe","neutral","ally"].map((function(e){return{id:e,text:"faction: "+e}})),selectedID:this.props.encounterSlot.faction,onSelect:function(t){return e.props.changeValue(e.props.encounterSlot,"faction",t)}}))}},{key:"render",value:function(){var e=this.props.encounterSlot.monsterName,t=null;switch(this.props.view){case"initiative":e+=" (1d20 "+N.modifier(this.props.monster.abilityScores.dex)+")",t=this.getInitSection();break;case"hit points":e+=" ("+w.getTypicalHPString(this.props.monster)+")",t=this.getHPSection();break;case"names":t=this.getNameSection();break;case"advanced":t=this.getCountSection()}return r.a.createElement("div",{className:"group-panel combatant-setup"},r.a.createElement("div",{className:"subheading"},e),r.a.createElement("hr",null),t)}}]),a}(r.a.Component),Ae=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.items.map((function(t){return r.a.createElement(ze,{key:t.id,item:t,selected:e.props.selectedItemID===t.id,onSelect:function(t){return e.props.onSelect(t)}})}));return r.a.createElement("div",{className:"radio-group"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ze=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.onSelect(this.props.item.id)}},{key:"render",value:function(){var e=this;try{var t="radio-item",a=null;return this.props.selected&&(t+=" selected",this.props.item.details&&(a=r.a.createElement("div",{className:"radio-item-details"},this.props.item.details))),this.props.item.disabled&&(t+=" disabled"),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)}},r.a.createElement("div",{className:"radio-item-top"},r.a.createElement("div",{className:"radio-item-text"},this.props.item.text),r.a.createElement("div",{className:"radio-item-info"},this.props.item.info)),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Re=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={condition:e.condition},n}return Object(l.a)(a,[{key:"setCondition",value:function(e){if(this.state.condition.name!==e){var t=this.state.condition;t.name=e,t.level=1,t.text="",this.setState({condition:t})}}},{key:"setDuration",value:function(e){var t=null;switch(e){case"saves":t=C.createConditionDurationSaves();break;case"combatant":t=C.createConditionDurationCombatant();break;case"rounds":t=C.createConditionDurationRounds()}var a=this.state.condition;a.duration=t,this.setState({condition:a})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({condition:this.state.condition})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t]+a;"level"===t&&(n=Math.max(n,1),n=Math.min(n,6)),"count"===t&&(n=Math.max(n,1)),"saveDC"===t&&(n=Math.max(n,0)),e[t]=n,this.setState({condition:this.state.condition})}},{key:"render",value:function(){var e=this;try{var t=g.map((function(t){var a=[],n=[];if(t===e.state.condition.name){"exhaustion"===t&&a.push(r.a.createElement(Z,{key:"exhaustion-spin",value:e.props.condition.level,label:"exhaustion",downEnabled:e.props.condition.level>1,upEnabled:e.props.condition.level<6,onNudgeValue:function(t){return e.nudgeValue(e.props.condition,"level",t)}}));for(var s=N.conditionText(e.state.condition),i=0;i!==s.length;++i)n.push(r.a.createElement("li",{key:i,className:"section"},s[i]))}var o=e.props.combatants.filter((function(e){return"monster"===e.type})).some((function(e){return!!e&&-1!==e.conditionImmunities.indexOf(t)}));return{id:t,text:t,details:r.a.createElement("div",{key:t},a,r.a.createElement("ul",null,n)),disabled:o}})),a=["str","dex","con","int","wis","cha","death"].map((function(e){return{id:e,text:e}})),n=[{id:"start",text:"start of turn"},{id:"end",text:"end of turn"}],s=this.props.allCombatants.filter((function(e){return"placeholder"!==e.type})).map((function(e){var t=e;return{id:t.id,text:t.displayName||t.name||"unnamed monster"}}));N.sort(s,[{field:"text",dir:"asc"}]);var i=[{id:"none",text:"until removed (default)",details:r.a.createElement("div",{className:"section"},r.a.createElement("div",null,"the condition persists until it is manually removed"))},{id:"saves",text:"until a successful save",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"number of saves required"),r.a.createElement(Z,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"count",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"save dc"),r.a.createElement(Z,{value:this.props.condition.duration?"dc "+this.props.condition.duration.saveDC:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.saveDC>0,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"saveDC",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"type of save"),r.a.createElement(ue,{options:a,selectedID:this.props.condition.duration?this.props.condition.duration.saveType:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"saveType",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"make the save at the start or end of the turn"),r.a.createElement(ue,{options:n,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"point",t)}})))},{id:"combatant",text:"until someone's next turn",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"start or end of the turn"),r.a.createElement(ue,{options:n,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"point",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"combatant"),r.a.createElement(W,{options:s,selectedID:this.props.condition.duration&&this.props.condition.duration.combatantID||void 0,onSelect:function(t){return e.changeValue(e.props.condition.duration,"combatantID",t)}})))},{id:"rounds",text:"for a number of rounds",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"number of rounds"),r.a.createElement(Z,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"count",t)}})))}];return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"heading"},"condition"),r.a.createElement(Ae,{items:t,selectedItemID:this.state.condition.name,onSelect:function(t){return e.setCondition(t)}})),r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"heading"},"duration"),r.a.createElement(Ae,{items:i,selectedItemID:this.state.condition.duration?this.state.condition.duration.type:"none",onSelect:function(t){return e.setDuration(t)}})))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Le=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{if(0===this.props.data.length)return null;var t,a=Math.max.apply(Math,Object(o.a)(this.props.data.map((function(e){return e.value}))));if(this.props.collapse)t=this.props.data.filter((function(e){return e.value>0}));else{var n=this.props.data.find((function(e){return e.value>0}));this.props.data.reverse();var s=this.props.data.find((function(e){return e.value>0}));this.props.data.reverse();var i=n?this.props.data.indexOf(n):0,c=s?this.props.data.indexOf(s):this.props.data.length-1;t=this.props.data.slice(i,c+1)}var l=t.map((function(t){return r.a.createElement("div",{key:t.text,className:"bar-container"},r.a.createElement("div",{className:"bar",style:{width:"calc((100% - 1px) * "+t.value+" / "+a+")"}},r.a.createElement("div",{className:"label"},t.text,": ",e.props.onFormatValue(t.value))))}));return r.a.createElement("div",{className:"plot"},l)}catch(u){return console.error(u),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Le.defaultProps={collapse:!1,onFormatValue:function(e){return e.toString()}};var Ge=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={chart:"challenge"},n}return Object(l.a)(a,[{key:"selectChart",value:function(e){this.setState({chart:e})}},{key:"render",value:function(){var e=this;try{var t=[];if(this.props.groups.forEach((function(e){return e.monsters.forEach((function(e){return t.push(e)}))})),0===t.length)return null;var a=[];switch(this.state.chart){case"challenge":a=[0,.125,.25,.5,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30].map((function(e){return{text:"cr "+N.challenge(e),value:t.filter((function(t){return t.challenge===e})).length}}));break;case"size":a=b.map((function(e){return{text:e,value:t.filter((function(t){return t.size===e})).length}}));break;case"type":a=y.map((function(e){return{text:e,value:t.filter((function(t){return t.category===e})).length}}))}return r.a.createElement("div",{className:"scrollable padded"},r.a.createElement(ue,{options:[{id:"challenge",text:"challenge rating"},{id:"size",text:"size"},{id:"type",text:"type"}],selectedID:this.state.chart,onSelect:function(t){return e.selectChart(t)}}),r.a.createElement(Le,{data:a}))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Fe=a(254),Be=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t="monster",a=null,n=[];if(this.props.monster){t=this.props.monster.name;var s=[],i=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();this.props.monster.tag&&(i+=" ("+this.props.monster.tag.toLowerCase()+")"),s.push(r.a.createElement(R.a,{key:"tag-main"},i)),this.props.monster.alignment&&s.push(r.a.createElement(R.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),s.push(r.a.createElement(R.a,{key:"tag-cr"},"cr ",N.challenge(this.props.monster.challenge))),a=r.a.createElement("div",{className:"stats"},r.a.createElement(ee,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},s)),n.push(r.a.createElement("button",{key:"view",onClick:function(){return e.props.viewMonster(e.props.monster)}},"statblock"))}else a=r.a.createElement(se,{white:!0},r.a.createElement("div",{className:"section"},"this empty slot has been added because you are creating an encounter from a template"),r.a.createElement("div",{className:"section"},"when you press ",r.a.createElement("b",null,"choose a monster")," you will be able to select a monster of this type:"),r.a.createElement("div",{className:"section centered"},r.a.createElement("b",null,this.props.slot.roles.join(", ")))),n.push(r.a.createElement("button",{key:"select",onClick:function(){return e.props.select(e.props.slot)}},"choose a monster"));if(this.props.encounter.waves.length>0){var o=this.props.encounter.slots,c=[];this.props.encounter.slots.includes(this.props.slot)||c.push({id:"",text:"main encounter"}),this.props.encounter.waves.forEach((function(t){t.slots.includes(e.props.slot)?o=t.slots:c.push({id:t.id,text:t.name})})),n.push(r.a.createElement(W,{key:"move",placeholder:"move to...",options:c,onSelect:function(t){return e.props.moveToWave(e.props.slot,o,t)}}))}return n.push(r.a.createElement(W,{key:"faction",options:["foe","neutral","ally"].map((function(e){return{id:e,text:e}})),selectedID:this.props.slot.faction,onSelect:function(t){return e.props.changeValue(e.props.slot,"faction",t)}})),n.push(r.a.createElement("button",{key:"remove",onClick:function(){return e.props.remove(e.props.slot)}},"remove")),r.a.createElement("div",{className:"card "+this.props.slot.faction},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},t)),r.a.createElement("div",{className:"card-content"},a,r.a.createElement("hr",null),r.a.createElement(Z,{value:this.props.slot.count,label:"count",downEnabled:this.props.slot.count>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.slot,"count",t)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},n)))}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),qe=a(237),He=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={showContent:!0},n}return Object(l.a)(a,[{key:"toggleContentVisible",value:function(){this.setState({showContent:!this.state.showContent})}},{key:"render",value:function(){var e=this;try{var t=this.props.content.filter((function(e){return!!e}));if(0===t.length)return null;var a=null;if(this.props.heading){var n=null;this.props.controls&&this.state.showContent&&(n=r.a.createElement(G.a,{content:this.props.controls,trigger:"click",placement:"bottomRight"},r.a.createElement(qe.a,null)));var s=null;this.props.showToggle&&(s=r.a.createElement(J.a,{className:this.state.showContent?"rotate":"",onClick:function(){return e.toggleContentVisible()}})),a=r.a.createElement("div",{className:"heading fixed-top"},r.a.createElement("div",{className:"title"},this.props.heading),n,s)}var i=null;if(this.state.showContent){var o={xs:24,sm:24,md:12,lg:8,xl:6};switch(this.props.columns){case 1:o={xs:24,sm:24,md:24,lg:24,xl:24};break;case 2:o={xs:24,sm:24,md:12,lg:12,xl:12};break;case 3:o={xs:24,sm:24,md:8,lg:8,xl:8}}i=r.a.createElement(p.a,{align:"top",gutter:10},t.map((function(e){return r.a.createElement(d.a,{key:t.indexOf(e),xs:o.xs,sm:o.sm,md:o.md,lg:o.lg,xl:o.xl},e)})))}return r.a.createElement("div",{className:"grid-panel"},a,i)}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);He.defaultProps={columns:0,heading:null,showToggle:!1,controls:null};var We=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=[];-1!==this.props.mode.indexOf("edit")&&(t.push(r.a.createElement("button",{key:"edit",onClick:function(){return e.props.editPC(e.props.pc)}},"edit pc")),this.props.pc.url&&t.push(r.a.createElement("button",{key:"import",onClick:function(){return e.props.updatePC(e.props.pc)}},"update pc from d&d beyond")),t.push(r.a.createElement("button",{key:"export",onClick:function(){return e.props.exportPC(e.props.pc)}},"export pc")),this.props.pc.active?t.push(r.a.createElement("button",{key:"toggle-active",onClick:function(){return e.props.changeValue(e.props.pc,"active",!1)}},"mark pc as inactive")):t.push(r.a.createElement("button",{key:"toggle-active",onClick:function(){return e.props.changeValue(e.props.pc,"active",!0)}},"mark pc as active")),t.push(r.a.createElement(F,{key:"remove",text:"delete pc",onConfirm:function(){return e.props.removePC(e.props.pc)}})));var a=null;this.props.pc.companions.length>0&&(a=this.props.pc.companions.map((function(e){return r.a.createElement("div",{key:e.id},e.name)})));var n=(this.props.pc?this.props.pc.displayName:null)||this.props.pc.name||"unnamed pc";return r.a.createElement("div",{className:"card pc"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:n},n)),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"stats"},r.a.createElement(ee,{source:this.props.pc}),r.a.createElement("div",{className:"section centered lowercase"},r.a.createElement(R.a,null,this.props.pc.race||"unknown race"),r.a.createElement(R.a,null,this.props.pc.classes||"unknown class"),r.a.createElement(R.a,null,"level "+this.props.pc.level)),r.a.createElement("div",{className:"section centered",style:{display:this.props.pc.url?"":"none"}},r.a.createElement("a",{href:this.props.pc.url,target:"_blank",rel:"noopener noreferrer"},"d&d beyond sheet")),r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"size"),r.a.createElement("div",{className:"section"},this.props.pc.size),r.a.createElement("div",{className:"section subheading"},"languages"),r.a.createElement("div",{className:"section"},this.props.pc.languages||"-"),r.a.createElement("div",{className:"section subheading"},"passive skills"),r.a.createElement("div",{className:"section"},r.a.createElement("div",null,r.a.createElement("b",null,"insight")," ",this.props.pc.passiveInsight),r.a.createElement("div",null,r.a.createElement("b",null,"investigation")," ",this.props.pc.passiveInvestigation),r.a.createElement("div",null,r.a.createElement("b",null,"perception")," ",this.props.pc.passivePerception)),r.a.createElement("div",{style:{display:this.props.pc.companions.length>0?"":"none"}},r.a.createElement("div",{className:"section subheading"},"companions"),r.a.createElement("div",{className:"section"},a))),r.a.createElement("div",{style:{display:t.length>0?"":"none"}},r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},t))))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);We.defaultProps={changeValue:null,nudgeValue:null,removePC:null,editPC:null,updatePC:null,exportPC:null};var _e=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){try{if(!this.props.source)return null;var e=null;switch(this.props.source.type){case"pc":e=r.a.createElement(We,{pc:this.props.source,mode:"view"});break;case"monster":e=r.a.createElement(le,{monster:this.props.source,mode:"full"})}return r.a.createElement("div",{className:"scrollable padded"},e)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Je=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={encounter:e.encounter,view:"monsters",filter:C.createMonsterFilter(),selectedWaveID:null,selectedSlotID:null,showLibrary:!1,selectedMonster:null,randomEncounterXP:1e3},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"openSlot",value:function(e,t){this.setState({filter:C.createMonsterFilter(),selectedWaveID:e,selectedSlotID:t,showLibrary:!0})}},{key:"setShowLibrary",value:function(e){this.setState({showLibrary:e,selectedMonster:null})}},{key:"setSelectedMonster",value:function(e){this.setState({selectedMonster:e})}},{key:"setRandomEncounterXP",value:function(e){this.setState({randomEncounterXP:Math.max(0,e)})}},{key:"addWave",value:function(){var e=C.createEncounterWave();e.name="wave "+(this.state.encounter.waves.length+2),this.state.encounter.waves.push(e),this.setState({encounter:this.state.encounter})}},{key:"removeWave",value:function(e){var t=this.state.encounter.waves.indexOf(e);this.state.encounter.waves.splice(t,1),this.setState({encounter:this.state.encounter})}},{key:"buildEncounter",value:function(){var e=this,t=this.state.encounter;t.slots=[],t.waves=[],D.buildEncounter(t,this.state.randomEncounterXP,this.state.filter,this.props.library,this.props.getMonster),this.sortEncounterSlots(t),t.waves.forEach((function(t){return e.sortEncounterSlots(t)})),this.setState({encounter:t})}},{key:"clearEncounter",value:function(){var e=this.state.encounter;e.slots=[],e.waves=[],this.setState({encounter:e})}},{key:"addToEncounterSlot",value:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.state.encounter.slots;if(this.state.selectedWaveID){var r=this.state.encounter.waves.find((function(e){return e.id===t.state.selectedWaveID}));r&&(n=r.slots)}var s,i=null;this.state.selectedSlotID&&(i=null!==(s=n.find((function(e){return e.id===t.state.selectedSlotID})))&&void 0!==s?s:null);i||(i=C.createEncounterSlot(),n.push(i));var o=this.props.library.find((function(t){return t.monsters.includes(e)}));o&&(i.monsterGroupName=o.name,i.monsterName=e.name,this.sortEncounterSlots(this.state.encounter),this.state.encounter.waves.forEach((function(e){return t.sortEncounterSlots(e)})),this.setState({encounter:this.state.encounter,selectedWaveID:null,selectedSlotID:null,showLibrary:!a,selectedMonster:null}))}},{key:"sortEncounterSlots",value:function(e){var t=[];e.slots.forEach((function(e){var a=t.find((function(t){return t.monsterGroupName===e.monsterGroupName&&t.monsterName===e.monsterName&&t.roles.join(",")===e.roles.join(",")}));a?a.count+=e.count:(a=e,t.push(e))})),e.slots=t,e.slots.sort((function(e,t){var a=e.monsterName.toLowerCase(),n=t.monsterName.toLowerCase();return a<n?-1:a>n?1:0}))}},{key:"removeEncounterSlot",value:function(e,t){if(t){var a=this.state.encounter.waves.find((function(e){return e.id===t}));if(a){var n=a.slots.indexOf(e);a.slots.splice(n,1)}}else{var r=this.state.encounter.slots.indexOf(e);this.state.encounter.slots.splice(r,1)}this.setState({encounter:this.state.encounter})}},{key:"moveToWave",value:function(e,t,a){var n=t.indexOf(e);if(t.splice(n,1),a){var r=this.state.encounter.waves.find((function(e){return e.id===a}));r&&(r.slots.push(e),this.sortEncounterSlots(r))}else this.state.encounter.slots.push(e),this.sortEncounterSlots(this.state.encounter);this.setState({encounter:this.state.encounter})}},{key:"useTemplate",value:function(e){var t=D.encounterTemplates().find((function(t){return t.name===e}));if(t){var a=this.state.encounter;a.slots=t.slots.map((function(e){var t=C.createEncounterSlot();return t.roles=e.roles,t.count=e.count,t})),a.waves=[],this.setState({encounter:a})}}},{key:"fillTemplate",value:function(){var e=this,t=[];this.props.library.forEach((function(a){a.monsters.forEach((function(n){e.state.encounter.slots.some((function(e){return e.monsterName===n.name&&e.monsterGroupName===a.name}))||t.push(n)}))})),this.state.encounter.slots.filter((function(e){return e.roles.length>0})).forEach((function(a){var n=t.filter((function(e){return a.roles.includes(e.role)}));if(n.length>0){var r=n[N.randomNumber(n.length)],s=e.props.library.find((function(e){return e.monsters.includes(r)}));s&&(a.monsterName=r.name,a.monsterGroupName=s.name)}})),this.setState({encounter:this.state.encounter})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({encounter:this.state.encounter})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t];n+=a,"count"===t&&(n=Math.max(n,1)),this.changeValue(e,t,n)}},{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:C.createMonsterFilter()})}},{key:"getMonsterCards",value:function(e,t){var a=this,n=[];return e.forEach((function(e){n.push(r.a.createElement(Be,{slot:e,monster:a.props.getMonster(e.monsterName,e.monsterGroupName),encounter:a.props.encounter,library:a.props.library,changeValue:function(e,t,n){return a.changeValue(e,t,n)},nudgeValue:function(e,t,n){return a.nudgeValue(e,t,n)},select:function(e){return a.openSlot(t,e.id)},remove:function(e){return a.removeEncounterSlot(e,t)},moveToWave:function(e,t,n){return a.moveToWave(e,t,n)},viewMonster:function(e){return a.setSelectedMonster(e)}}))})),0===e.length&&(t?n.push(r.a.createElement(se,null,"there are no monsters in this wave")):n.push(r.a.createElement(se,null,r.a.createElement("p",null,"there are no monsters in this encounter"),r.a.createElement("p",null,"you can click the button below to add a monster, or try ",r.a.createElement("b",null,"build a random encounter")," or ",r.a.createElement("b",null,"use an encounter template"))))),n}},{key:"getCandidateSection",value:function(){var e=this,t=this.state.encounter.slots;if(this.state.selectedWaveID){var a=this.state.encounter.waves.find((function(t){return t.id===e.state.selectedWaveID}));a&&(t=a.slots)}var n,s=null;this.state.selectedSlotID&&(s=null!==(n=t.find((function(t){return t.id===e.state.selectedSlotID})))&&void 0!==n?n:null);var i=[];this.props.library.forEach((function(a){a.monsters.forEach((function(n){var r=D.matchMonster(n,e.state.filter),o=!s||s.roles.includes(n.role),c=t.some((function(e){return e.monsterName===n.name&&e.monsterGroupName===a.name}));r&&o&&!c&&i.push(n)}))})),i.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var o=!!s&&s.roles.length>0,c=r.a.createElement(Ae,{items:i.map((function(e){return{id:e.id,text:e.name,info:"cr "+N.challenge(e.challenge)}})),selectedItemID:this.state.selectedMonster?this.state.selectedMonster.id:null,onSelect:function(t){var a;return e.setSelectedMonster(null!==(a=i.find((function(e){return e.id===t})))&&void 0!==a?a:null)}});if(0===i.length){var l=D.getFilterDescription(this.state.filter);c=r.a.createElement(se,{key:"empty"},"there are no monsters that meet the criteria ",r.a.createElement("i",null,l)," (or they are all already part of the encounter)")}var u=r.a.createElement(se,null,"select a monster from the list at the left to see its statblock here");this.state.selectedMonster&&(u=r.a.createElement(_e,{source:this.state.selectedMonster}));var m=null;return m=o?r.a.createElement("button",{className:this.state.selectedMonster?"":"disabled",onClick:function(){return e.addToEncounterSlot(e.state.selectedMonster)}},"add this monster to the encounter"):r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{className:this.state.selectedMonster?"":"disabled",onClick:function(){return e.addToEncounterSlot(e.state.selectedMonster,!1)}},"add this monster to the encounter")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.setShowLibrary(!1)}},"close"))),r.a.createElement("div",{className:"full-height"},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},"choose a monster")),r.a.createElement("div",{className:"drawer-content"},r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:10,className:"scrollable"},r.a.createElement("div",{className:"section"},r.a.createElement(de,{filter:this.state.filter,showRoles:!o,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}})),r.a.createElement("hr",null),c),r.a.createElement(d.a,{span:14,className:"scrollable"},u))),r.a.createElement("div",{className:"drawer-footer"},m))}},{key:"getStatblockSection",value:function(){return r.a.createElement("div",{className:"full-height"},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},"statblock")),r.a.createElement("div",{className:"drawer-content"},r.a.createElement("div",{className:"scrollable"},r.a.createElement(_e,{source:this.state.selectedMonster}))),r.a.createElement("div",{className:"drawer-footer"}))}},{key:"render",value:function(){var e=this;try{var t=null,a=null;switch(this.state.view){case"monsters":var n=this.props.encounter.waves.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement(H,{text:t.name,placeholder:"wave name",onChange:function(a){return e.changeValue(t,"name",a)}}),r.a.createElement(F,{text:"delete wave",onConfirm:function(){return e.removeWave(t)}}))})),s=null;this.state.encounter.slots.some((function(e){return e.roles.length>0}))&&(s=r.a.createElement("button",{onClick:function(){return e.fillTemplate()}},"choose monsters")),t=r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"waves"),n,r.a.createElement("button",{onClick:function(){return e.addWave()}},"add a new wave")),r.a.createElement("hr",null),r.a.createElement(pe,{encounter:this.props.encounter,parties:this.props.parties,getMonster:function(t,a){return e.props.getMonster(t,a)}}),r.a.createElement("hr",null),r.a.createElement(U,{text:"build a random encounter"},r.a.createElement("p",null,"add random monsters to this encounter until its (effective) xp value is at least the following value"),r.a.createElement(Fe.a,{value:this.state.randomEncounterXP,min:0,step:1e3,onChange:function(t){var a=parseInt((null!==t&&void 0!==t?t:0).toString(),10);e.setRandomEncounterXP(a)}}),r.a.createElement("button",{onClick:function(){return e.buildEncounter()}},"build encounter")),r.a.createElement(U,{text:"use an encounter template"},r.a.createElement("p",null,"select one of these options to create an encounter based on a predefined template"),r.a.createElement(Ae,{items:D.encounterTemplates().map((function(e){return{id:e.name,text:e.name}})),selectedItemID:null,onSelect:function(t){return e.useTemplate(t)}})),s,r.a.createElement("hr",null),r.a.createElement(F,{text:"clear encounter",onConfirm:function(){return e.clearEncounter()}}));var i=this.props.encounter.waves.map((function(t){return r.a.createElement("div",{key:t.id},r.a.createElement(He,{heading:t.name||"unnamed wave",content:e.getMonsterCards(t.slots,t.id),columns:3}),r.a.createElement(p.a,null,r.a.createElement(d.a,{xs:24,sm:24,md:8,lg:8,xl:8},r.a.createElement("button",{onClick:function(){return e.openSlot(t.id,null)}},"add a monster to this wave"))))}));a=r.a.createElement("div",null,r.a.createElement(He,{heading:"encounter",content:this.getMonsterCards(this.props.encounter.slots,null),columns:3}),r.a.createElement(p.a,null,r.a.createElement(d.a,{xs:24,sm:24,md:8,lg:8,xl:8},r.a.createElement("button",{onClick:function(){return e.openSlot(null,null)}},"add a monster to the encounter"))),i);break;case"notes":t=null,a=r.a.createElement("div",null,r.a.createElement(He,{columns:1,content:[r.a.createElement(H,{key:"notes",text:this.props.encounter.notes,placeholder:"notes",multiLine:!0,onChange:function(t){return e.changeValue(e.props.encounter,"notes",t)}})],heading:"notes"}))}return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement("div",{className:"section subheading"},"encounter name"),r.a.createElement(H,{text:this.props.encounter.name,placeholder:"encounter name",onChange:function(t){return e.changeValue(e.props.encounter,"name",t)}}),r.a.createElement(ue,{options:["monsters","notes"].map((function(e){return{id:e,text:e}})),selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),t),r.a.createElement(d.a,{span:18,className:"scrollable"},a),r.a.createElement(h.a,{visible:this.state.showLibrary,width:"50%",closable:!1,maskClosable:!1,onClose:function(){return e.setShowLibrary(!1)}},this.getCandidateSection()),r.a.createElement(h.a,{visible:!this.state.showLibrary&&!!this.state.selectedMonster,width:"50%",closable:!1,onClose:function(){return e.setSelectedMonster(null)}},this.getStatblockSection()))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ye=a(236),Ue=a(235),Xe=a(234),Ke=a(233),Ze=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"click",value:function(e,t){e.stopPropagation(),this.props.onClick(t)}},{key:"render",value:function(){var e=this;try{var t="radial "+this.props.mode;this.props.disabled&&(t+=" disabled");var a="eight"===this.props.mode;return r.a.createElement("div",{className:t},r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"NW")}},r.a.createElement(Ye.a,{rotate:-45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow vertical",onClick:function(t){return e.click(t,"N")}},r.a.createElement(Ye.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"NE")}},r.a.createElement(Ye.a,{rotate:45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow horizontal",onClick:function(t){return e.click(t,"W")}},r.a.createElement(Ue.a,null))),r.a.createElement("div",{className:"cell"}),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow horizontal",onClick:function(t){return e.click(t,"E")}},r.a.createElement(Xe.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"SW")}},r.a.createElement(Ke.a,{rotate:45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow vertical",onClick:function(t){return e.click(t,"S")}},r.a.createElement(Ke.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"SE")}},r.a.createElement(Ke.a,{rotate:-45}))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ze.defaultProps={mode:"eight",disabled:!1};var Qe=a(232),$e=a(209),et=a(208),tt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={images:n.listImages(),filter:""},n}return Object(l.a)(a,[{key:"listImages",value:function(){for(var e=[],t=0;t!==window.localStorage.length;++t){var a=window.localStorage.key(t);if(a&&a.startsWith("image-")){var n=window.localStorage.getItem(a);if(n){var r=JSON.parse(n);e.push({id:r.id,name:r.name,data:r.data})}}}return N.sort(e,[{field:"name",dir:"asc"}])}},{key:"setFilter",value:function(e){this.setState({filter:e})}},{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target){var n=a.target.result,r={id:N.guid(),name:e.name,data:n};try{var s=JSON.stringify(r);window.localStorage.setItem("image-"+r.id,s),t.setState({images:t.listImages()})}catch(i){$e.a.open({message:"can't upload this image",description:"not enough storage space; try reducing the resolution or removing unused images"})}}},a.readAsDataURL(e),!1}},{key:"delete",value:function(e){window.localStorage.removeItem("image-"+e),this.setState({images:this.listImages()})}},{key:"render",value:function(){var e=this;try{var t=this.state.images.filter((function(t){return I.match(e.state.filter,t.name)})).map((function(t){var a=null;if(e.props.parties.length+e.props.library.length+e.props.maps.length+e.props.combats.length>0){var n=!1;e.props.parties.forEach((function(e){e.pcs.find((function(e){return e.portrait===t.id}))&&(n=!0)})),e.props.library.forEach((function(e){e.monsters.find((function(e){return e.portrait===t.id}))&&(n=!0)})),e.props.maps.forEach((function(e){e.items.find((function(e){return e.customBackground===t.id}))&&(n=!0)})),e.props.combats.forEach((function(e){e.map&&e.map.items.find((function(e){return e.customBackground===t.id}))&&(n=!0)})),n||(a=r.a.createElement("div",null,r.a.createElement(se,null,"not used (",N.toData(t.data.length),")"),r.a.createElement("button",{onClick:function(){return e.delete(t.id)}},"delete this image")))}var s=r.a.createElement("img",{className:"section nonselectable-image",src:t.data,alt:t.name});return e.props.select&&(s=r.a.createElement("img",{className:"section selectable-image",src:t.data,alt:t.name,onClick:function(){return e.props.select?e.props.select(t.id):null}})),r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"subheading"},t.name),s,a)}));0===t.length&&t.push(r.a.createElement(se,{key:"empty"},"no images")),this.state.images.length>0&&t.unshift(r.a.createElement(H,{key:"search",text:this.state.filter,placeholder:"search for an image",onChange:function(t){return e.setFilter(t)}}));var a=null;return this.props.cancel&&(a=r.a.createElement("button",{onClick:function(){return e.props.cancel?e.props.cancel():null}},"cancel")),r.a.createElement("div",{className:"full-height"},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},"select image")),r.a.createElement("div",{className:"drawer-content"},r.a.createElement("div",{className:"scrollable"},r.a.createElement("div",null,r.a.createElement(et.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(Qe.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),t)),r.a.createElement("div",{className:"drawer-footer"},a))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);tt.defaultProps={parties:[],library:[],maps:[],combats:[],select:null,cancel:null};var at=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={map:e.map,selectedTileID:null,addingTile:null,showImageSelection:!1},n}return Object(l.a)(a,[{key:"setSelectedTileID",value:function(e){this.setState({selectedTileID:e})}},{key:"setAddingTile",value:function(e){var t=null;switch(e){case"room":(t=C.createMapItem()).terrain="default",t.width=6,t.height=6,t.style="square";break;case"corridor":(t=C.createMapItem()).terrain="default",t.width=6,t.height=2,t.style="square";break;case"door":(t=C.createMapItem()).terrain="default",t.width=2,t.height=1,t.style="square",t.content={type:"doorway",style:"single",orientation:"horizontal"};break;case"stairs":(t=C.createMapItem()).terrain="default",t.width=4,t.height=2,t.style="square",t.content={type:"stairway",style:"stairs",orientation:"vertical"}}t&&0===this.state.map.items.length?(t.x=0,t.y=0,this.state.map.items.push(t),this.setState({map:this.state.map,selectedTileID:t.id})):this.setState({addingTile:t})}},{key:"moveAddedTile",value:function(e,t){var a=this.state.addingTile;a&&(a.x=e,a.y=t,this.setState({addingTile:a}))}},{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"addMapTile",value:function(e,t){if(this.state.addingTile){var a=this.state.addingTile;a.x=e,a.y=t,this.state.map.items.push(a),this.setState({map:this.state.map,selectedTileID:a.id,addingTile:null})}}},{key:"moveMapItem",value:function(e,t){switch(t){case"N":e.y-=1;break;case"NE":e.x+=1,e.y-=1;break;case"E":e.x+=1;break;case"SE":e.x+=1,e.y+=1;break;case"S":e.y+=1;break;case"SW":e.x-=1,e.y+=1;break;case"W":e.x-=1;break;case"NW":e.x-=1,e.y-=1}this.setState({map:this.state.map})}},{key:"bigMapItem",value:function(e,t){switch(t){case"N":e.y-=1,e.height+=1;break;case"E":e.width+=1;break;case"S":e.height+=1;break;case"W":e.x-=1,e.width+=1}this.setState({map:this.state.map})}},{key:"smallMapItem",value:function(e,t){switch(t){case"N":e.height>1&&(e.y+=1,e.height-=1);break;case"E":e.width>1&&(e.width-=1);break;case"S":e.height>1&&(e.height-=1);break;case"W":e.width>1&&(e.x+=1,e.width-=1)}this.setState({map:this.state.map})}},{key:"rotateMapItem",value:function(e){var t=e.width;e.width=e.height,e.height=t;var a=Math.floor((e.width-e.height)/2);e.x-=a,e.y+=a,e.content&&(e.content.orientation="horizontal"===e.content.orientation?"vertical":"horizontal"),this.setState({map:this.state.map,addingTile:this.state.addingTile})}},{key:"sendToBack",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.state.map.items.unshift(e),this.setState({map:this.state.map})}},{key:"bringToFront",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.state.map.items.push(e),this.setState({map:this.state.map})}},{key:"cloneMapItem",value:function(e){var t=JSON.parse(JSON.stringify(e));t.id=N.guid(),t.x+=1,t.y+=1,this.state.map.items.push(t),this.setState({map:this.state.map,selectedTileID:t.id})}},{key:"pickUpMapItem",value:function(e){var t=this.state.map,a=t.items.indexOf(e);t.items.splice(a,1),this.setState({map:t,selectedTileID:null,addingTile:e})}},{key:"removeMapItem",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.setState({map:this.state.map,selectedTileID:null})}},{key:"setCustomImage",value:function(e){var t=this,a=this.state.map.items.find((function(e){return e.id===t.state.selectedTileID}));a&&this.changeValue(a,"customBackground",e)}},{key:"rotateMap",value:function(){O.rotateMap(this.state.map),this.setState({map:this.state.map})}},{key:"clearMap",value:function(){var e=this.state.map;e.items=[],this.setState({map:e,selectedTileID:null})}},{key:"generate",value:function(e){O.generate(e,this.state.map),this.setState({map:this.state.map})}},{key:"addNote",value:function(e){var t=C.createMapNote();t.targetID=e,this.state.map.notes.push(t),this.setState({map:this.state.map})}},{key:"removeNote",value:function(e){var t=this.state.map.notes.findIndex((function(t){return t.targetID===e}));this.state.map.notes.splice(t,1),this.setState({map:this.state.map})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({map:this.state.map,showImageSelection:!1})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t];n+=a,"width"!==t&&"height"!==t||(n=Math.max(n,1)),this.changeValue(e,t,n)}},{key:"render",value:function(){var e=this;try{var t=null;if(this.state.selectedTileID){var a=this.state.map.items.find((function(t){return t.id===e.state.selectedTileID}));if(a){var n=O.getNote(this.state.map,a);t=r.a.createElement(nt,{tile:a,note:n,toggleImageSelection:function(){return e.toggleImageSelection()},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},move:function(t,a){return e.moveMapItem(t,a)},clone:function(t){return e.cloneMapItem(t)},pickUp:function(t){return e.pickUpMapItem(t)},remove:function(t){return e.removeMapItem(t)},rotate:function(t){return e.rotateMapItem(t)},sendToBack:function(t){return e.sendToBack(t)},bringToFront:function(t){return e.bringToFront(t)},addNote:function(t){return e.addNote(t)},removeNote:function(t){return e.removeNote(t)}})}}else t=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(H,{text:this.state.map.name,placeholder:"map name",onChange:function(t){return e.changeValue(e.state.map,"name",t)}}),r.a.createElement("hr",null),r.a.createElement(se,null,r.a.createElement("p",null,"to add a new tile to the map, click on one of the buttons below"),r.a.createElement("p",null,"to edit an existing tile, click on it to select it")),r.a.createElement("hr",null),this.state.addingTile?r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.setAddingTile(null)}},"click somewhere on the map to lock the tile in place, or click here to remove it from the map"),r.a.createElement("button",{onClick:function(){return e.rotateMapItem(e.state.addingTile)}},"rotate tile")):r.a.createElement("div",null,r.a.createElement("div",{className:"section subheading"},"add a... "),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("button",{onClick:function(){return e.setAddingTile("room")}},"room tile")),r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("button",{onClick:function(){return e.setAddingTile("corridor")}},"corridor tile")),r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("button",{onClick:function(){return e.setAddingTile("door")}},"door tile")),r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("button",{onClick:function(){return e.setAddingTile("stairs")}},"stairs tile"))),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.generate("room")}},"add a random room"),r.a.createElement("button",{onClick:function(){return e.rotateMap()}},"rotate the map"),r.a.createElement(F,{text:"clear all tiles",onConfirm:function(){return e.clearMap()}})));return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:6,className:"scrollable sidebar sidebar-left"},t),r.a.createElement(d.a,{span:18,className:"scrollable both-ways"},r.a.createElement(ke,{map:this.state.map,mode:"edit",paddingSquares:4,selectedItemIDs:this.state.selectedTileID?[this.state.selectedTileID]:[],showGrid:!!this.state.addingTile,floatingItem:this.state.addingTile,itemSelected:function(t,a){return e.setSelectedTileID(t)},gridSquareEntered:function(t,a){return e.moveAddedTile(t,a)},gridSquareClicked:function(t,a){return e.addMapTile(t,a)}})),r.a.createElement(h.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(tt,{select:function(t){return e.setCustomImage(t)},cancel:function(){return e.toggleImageSelection()}})))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),nt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:"position"},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"getPositionSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement(Ze,{onClick:function(t){return e.props.move(e.props.tile,t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},5*this.props.tile.width," ft x ",5*this.props.tile.height," ft"),r.a.createElement("div",{className:"section"},r.a.createElement(Z,{value:this.props.tile.width+" sq",label:"width",downEnabled:this.props.tile.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.tile,"width",t)}}),r.a.createElement(Z,{value:this.props.tile.height+" sq",label:"height",downEnabled:this.props.tile.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.tile,"height",t)}})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.sendToBack(e.props.tile)}},"send to back"),r.a.createElement("button",{onClick:function(){return e.props.bringToFront(e.props.tile)}},"bring to front"))}},{key:"getStyleSection",value:function(){var e=this,t=x.map((function(e){return{id:e,text:e}})),a=null;"custom"===this.props.tile.terrain&&(a=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"custom image"),r.a.createElement("button",{onClick:function(){return e.props.toggleImageSelection()}},"select image"),r.a.createElement("button",{onClick:function(){return e.props.changeValue(e.props.tile,"customBackground","")}},"clear image")));var n=["square","rounded","circle"].map((function(e){return{id:e,text:e}}));return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"terrain"),r.a.createElement(W,{options:t,placeholder:"select terrain",selectedID:this.props.tile.terrain?this.props.tile.terrain:void 0,onSelect:function(t){return e.props.changeValue(e.props.tile,"terrain",t)}}),a,r.a.createElement("div",{className:"subheading"},"shape"),r.a.createElement(ue,{options:n,selectedID:this.props.tile.style,onSelect:function(t){return e.props.changeValue(e.props.tile,"style",t)}}),r.a.createElement("div",{className:"subheading"},"content"),r.a.createElement(Ae,{items:[{id:"none",text:"none"},{id:"doorway",text:"doorway",details:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,"style")),r.a.createElement(ue,{options:S.map((function(e){return{id:e,text:e}})),itemsPerRow:2,selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"style",t)}}),r.a.createElement("div",null,r.a.createElement("b",null,"orientation")),r.a.createElement(ue,{options:["horizontal","vertical"].map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"orientation",t)}}))},{id:"stairway",text:"stairway",details:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,"style")),r.a.createElement(ue,{options:M.map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"style",t)}}),r.a.createElement("div",null,r.a.createElement("b",null,"orientation")),r.a.createElement(ue,{options:["horizontal","vertical"].map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"orientation",t)}}))}],selectedItemID:this.props.tile.content?this.props.tile.content.type:"none",onSelect:function(t){var a=null;if("none"!==t){var n="";switch(t){case"doorway":n=S[0];break;case"stairway":n=M[0]}a={type:t,orientation:"horizontal",style:n}}e.props.changeValue(e.props.tile,"content",a)}}))}},{key:"getNotesSection",value:function(){var e=this;return this.props.note?r.a.createElement("div",null,r.a.createElement(H,{text:this.props.note.text,placeholder:"details",multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.note,"text",t)}}),r.a.createElement("button",{onClick:function(){return e.props.removeNote(e.props.tile.id)}},"remove note from this tile")):r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addNote(e.props.tile.id)}},"add a note to this tile"))}},{key:"render",value:function(){var e=this;try{var t=["position","style","notes"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"position":a=this.getPositionSection();break;case"style":a=this.getStyleSection();break;case"notes":a=this.getNotesSection()}return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map tile")),r.a.createElement("div",{className:"card-content"},r.a.createElement(ue,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),r.a.createElement("hr",null),a,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.rotate(e.props.tile)}},"rotate tile"),r.a.createElement("button",{onClick:function(){return e.props.clone(e.props.tile)}},"clone tile"),r.a.createElement("button",{onClick:function(){return e.props.pickUp(e.props.tile)}},"pick up tile"),r.a.createElement("button",{onClick:function(){return e.props.remove(e.props.tile)}},"remove tile"))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),rt=a(231),st=a(230),it=a(94),ot=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"initModel",value:function(t){var a=[],n=0;t.forEach((function(t){t.split(/\r?\n/).forEach((function(t){t&&(e.addLineToModel(t,a),n=Math.max(n,t.length))}))})),e.model=a,e.maxLength=n}},{key:"addLineToModel",value:function(e,t){e=String.fromCharCode(0,1)+e+String.fromCharCode(2);for(var a=function(a){var n=e.substr(a-2,2),r=e.substr(a,1),s=t.find((function(e){return e.prev===n}));s||(s={prev:n,freq:[]},t.push(s));var i=s.freq.find((function(e){return e.char===r}));i||(i={char:r,count:0},s.freq.push(i)),i.count+=1},n=2;n!==e.length;++n)a(n)}},{key:"generate",value:function(t){for(var a=[],n=0;a.length<t&&n<100;){var r=e.extractLine();if(r&&!a.map((function(e){return e.line})).includes(r)&&r.length<=e.maxLength){var s=e.fit(r);a.push({line:r,fit:s})}else n+=1}return a}},{key:"extractLine",value:function(){for(var t=String.fromCharCode(0,1),a=function(){var a=t.substr(t.length-2,2),n=e.model.find((function(e){return e.prev===a}));if(!n)return{v:null};var r="";n.freq.forEach((function(e){r+=e.char.repeat(e.count)}));var s=Math.floor(Math.random()*r.length),i=r[s];if(i===String.fromCharCode(2))return{v:t=t.substr(2)};if(1===N.dieRoll()){["bdg","ptk","sz","aeiouy","lr","ckq","vf"].forEach((function(e){if(e.includes(i)){var t=Math.floor(Math.random()*e.length);i=e[t]}}))}t+=i};;){var n=a();if("object"===typeof n)return n.v}}},{key:"fit",value:function(t){t=String.fromCharCode(0,1)+t+String.fromCharCode(2);for(var a=[],n=function(n){var r=t.substr(n-2,2),s=t[n],i=e.model.find((function(e){return e.prev===r}));if(i){var o=i.freq.find((function(e){return e.char===s}));if(o){var c=i.freq.reduce((function(e,t){return Math.max(e,t.count)}),0),l=o.count/c;a.push(l)}else a.push(0)}},r=2;r!==t.length;++r)n(r);return a.reduce((function(e,t){return e+t}),0)/a.length}},{key:"startsWithVowel",value:function(e){var t=!1;return["a","e","i","o","u"].forEach((function(a){e.toLowerCase().startsWith(a)&&(t=!0)})),t}},{key:"getMultipleValues",value:function(e){var t=1;switch(N.randomNumber(10)){case 0:case 1:case 2:case 3:case 4:t=1;break;case 5:case 6:case 7:t=2;break;case 8:case 9:t=3}for(var a=[];a.length<t;){var n=e[N.randomNumber(e.length)];a.includes(n)||a.push(n)}return a.join(", ")}},{key:"generateName",value:function(e){var t=["As Has Khe Zash Gl Ig Iv Kos Miv Pav Ser Dar Even Gor Rand Sto Tam Barer Keth Mum","Mar Burg Al Hel Wrayt S Eag Eath Joan Answ L Ot Ced At Tal Ham Jasm Mail Yash Row","Adr Alber Ba Bar Gar Kildr Kath Dies Eld Gurd Har Morg Or Rur Mar Vis Jen Torg Tak Thor End Ris Em Gunn","Ad All Aram Berri Car Enial Gann Im Per Sorvi Var Adr An Beth Bir Jelen Key Lesh Mer Mia Naiv Quel Sar Shan","Al An C Cor Eld Er Finn Gar Lin Mer Os Per Ros An Cal Cor Kith Lav Ned Pae Seraph T V Chen","Are Bala Bhar Don Gh Hesk Med Meh Nad Pand Patr Sham Shed Ak Bir Farid Fla Ka Ko Mish Thav Uad Eder Hener","Alu Stos Fa Ravay Leo Stok Vic El Yeng Car Ric Ar Guir Es My Pey"].join(" ").toLowerCase().split(" "),a=["Eir Eid Eed El Ar An Or Ef Al Vin Orn Dur Stag Elm Ur Us","Ik Ich Ern End Tor Nor In Rak Gen Sik Gran Linn Vok Brek Dal Gar","An Ar Il Rian Ric Is Dan Arai Meral Cian En Rion Ialis Ior Nan Kas","Ton Der Ade Rin Don Rich Nan Ret Al Born Coe By Fire Yas Dal Yle","Han Asar Ash Aar Esch An Rash En Arr Jed Rin Gar Ash Dinn Hun Rek","Orel Aadi Ahn Aver Eiros Kain Retor Lannan Pet Ikos","Er Ey A E Il Elia Ya Ed Eue Ild Oane Yne Orna Ie Ala Erri Ea Ia","Ber Tin Hild Dryn A Eth Runn Ellen Loda Dis Ja Lin Ra Tyrd De Rasa","Rie Aea Striana Inua Rynna Ilia Na Neth Leth Iel Lee Qui Astra Ia Ania Ynn","Dry Ree Lie Ora Emia Ian Ri Inia Ina Aena Ani Erna Lyse La Da Aela","Ra Ir Eh Ann Ilar Rinn Ann La Ra A Ina Va Hit Ederei Ere Eila","Ina Ceryn Vyn Ella Aella Vyre"].join(" ").toLowerCase().split(" "),n=Math.floor(Math.random()*t.length),r=Math.floor(Math.random()*a.length),s="";if(1===N.dieRoll(10)){var i=["-","'"," "];s=i[Math.floor(Math.random()*i.length)]}var o=t[n]+s+a[r];return e&&(o=o.split(" ").map((function(e){return e[0].toUpperCase()+(e.length>1?e.substring(1):"")})).join(" ")),o}},{key:"generatePotion",value:function(){var t="",a=e.potionColour(!0),n=e.potionLiquid(),r=e.potionAdjective(),s=e.potionFeature();switch(N.randomNumber(5)){case 0:t=a+" "+n;break;case 1:t=a+" "+n+" "+s;break;case 2:t=r+" "+a+" "+n;break;case 3:t=r+" "+a+" "+n+" "+s;break;case 4:t=r+" "+n+", "+a+" "+s}switch(t=(e.startsWithVowel(t)?"an":"a")+" "+t+" in "+e.potionContainer(),N.randomNumber(6)){case 0:t+="; it smells "+e.potionSmell();break;case 1:t+="; it tastes "+e.potionSmell();break;case 2:t+="; it smells "+e.potionSmell()+" but tastes "+e.potionSmell();break;case 3:t+="; it smells and tastes "+e.potionSmell()}return t}},{key:"generateBookTitle",value:function(){var t="",a=e.bookNounPhrase(N.randomBoolean(),N.randomBoolean());switch(N.randomNumber(5)){case 0:t=a+"'s "+e.bookNounPhrase(N.randomBoolean(),!1);break;case 1:t=a+" "+e.bookPreposition()+" "+e.bookNounPhrase(N.randomBoolean(),!0);break;case 2:t=e.bookGerund()+" "+e.bookNounPhrase(N.randomBoolean(),!0);break;case 3:t=e.bookAbout()+" "+a;break;case 4:t=a}if(0===N.randomNumber(10)&&(t+=": "+e.bookAbout()+" "+e.bookNounPhrase(N.randomBoolean(),N.randomBoolean())),0===N.randomNumber(10)){var n="";switch(N.randomNumber(3)){case 0:n="volume";break;case 1:n="part";break;case 2:n="book"}switch(N.randomNumber(5)){case 0:t+=", "+n+" one";break;case 1:t+=", "+n+" two";break;case 2:t+=", "+n+" three";break;case 3:t+=", "+n+" four";break;case 4:t+=", "+n+" five"}}return t}},{key:"generateNPC",value:function(){var t=["elderly","middle-aged","teenage","youthful","young","old"],a=t[N.randomNumber(t.length)],n=["apothecary","architect","armourer","arrowsmith","astrologer","baker","barber","lawyer","beggar","bellfounder","blacksmith","bookbinder","brewer","bricklayer","butcher","carpenter","carter","cartwright","chandler","peddler","clerk","clockmaker","cobbler","cook","cooper","merchant","embroiderer","engraver","fisherman","fishmonger","forester","furrier","gardener","gemcutter","glassblower","goldsmith","grocer","haberdasher","stableman","courtier","herbalist","innkeeper","ironmonger","labourer","painter","locksmith","mason","messenger","miller","miner","minstrel","ploughman","farmer","porter","sailor","scribe","seamstress","shepherd","shipwright","soapmaker","tailor","tinker","vintner","weaver"],r=n[N.randomNumber(n.length)],s="";switch(N.randomNumber(3)){case 0:case 1:s=r;break;case 2:s=a+" "+r}s=(e.startsWithVowel(s)?"an":"a")+" "+s;var i=["gangly","gigantic","hulking","lanky","short","small","stumpy","tall","tiny","willowy"],o=i[N.randomNumber(i.length)],c=["broad-shouldered","fat","gaunt","heavy-set","obese","plump","pot-bellied","rotund","skinny","slender","slim","statuesque","stout","thin"],l=c[N.randomNumber(c.length)],u="";switch(N.randomNumber(4)){case 0:case 1:u=o+" and "+l;break;case 2:u=o;break;case 3:u=l}var m=["short","cropped","long","braided","dreadlocked","shoulder-length","wiry","balding","receeding","curly","tightly-curled","straight","greasy","limp","sparse","thinning","wavy"],p=["black","brown","dark brown","light brown","red","ginger","strawberry blonde","blonde","ash blonde","graying","silver","white","gray","auburn"],d=m[N.randomNumber(m.length)]+" "+p[N.randomNumber(p.length)],h="";switch(N.randomNumber(4)){case 0:case 1:h=s+", "+u+" with "+d+" hair";break;case 2:h=s+" with "+d+" hair";break;case 3:h=s+", "+u}return h}},{key:"generateNPCPhysical",value:function(){return e.getMultipleValues(["bearded","buck-toothed","chiselled","doe-eyed","fine-featured","florid","gap-toothed","goggle-eyed","grizzled","jowly","jug-eared","pock-marked","broken nose","red-cheeked","scarred","squinting","thin-lipped","toothless","weather-beaten","wrinkled"])}},{key:"generateNPCMental",value:function(){return e.getMultipleValues(["hot-tempered","overbearing","antagonistic","haughty","elitist","proud","rude","aloof","mischievous","impulsive","lusty","irreverent","madcap","thoughtless","absent-minded","insensitive","brave","craven","shy","fearless","obsequious","inquisitive","prying","intellectual","perceptive","keen","perfectionist","stern","harsh","punctual","driven","trusting","kind-hearted","forgiving","easy-going","compassionate","miserly","hard-hearted","covetous","avaricious","thrifty","wastrel","spendthrift","extravagant","kind","charitable","gloomy","morose","compulsive","irritable","vengeful","honest","truthful","innocent","gullible","bigoted","biased","narrow-minded","cheerful","happy","diplomatic","pleasant","foolhardy","affable","fatalistic","depressing","cynical","sarcastic","realistic","secretive","retiring","practical","level-headed","dull","reverent","scheming","paranoid","cautious","deceitful","nervous","uncultured","boorish","barbaric","graceless","crude","cruel","sadistic","immoral","jealous","belligerent","argumentative","arrogant","careless","curious","exacting","friendly","greedy","generous","moody","naive","opinionated","optimistic","pessimistic","quiet","sober","suspicious","uncivilised","violent","peaceful"])}},{key:"generateNPCSpeech",value:function(){return e.getMultipleValues(["accented","articulate","garrulous","breathless","crisp","gutteral","high-pitched","lisping","loud","nasal","slow","fast","squeaky","stuttering","wheezy","whiny","whispery","soft-spoken","laconic","blustering"])}},{key:"generateTreasure",value:function(){var t="",a=["diamond","ruby","sapphire","emerald","amethyst","garnet","topaz","pearl","black pearl","opal","fire opal","amber","coral","agate","carnelian","jade","peridot","moonstone","alexandrite","aquamarine","jacinth","marble"];switch(N.randomNumber(12)){case 0:case 1:case 2:var n=a[N.randomNumber(a.length)];switch(N.randomBoolean()){case!0:n+=" gemstone";break;case!1:n="piece of "+n}switch(N.randomNumber(12)){case 0:n="well cut "+n;break;case 1:n="rough-cut "+n;break;case 2:n="poorly cut "+n;break;case 3:n="small "+n;break;case 4:n="large "+n;break;case 5:n="oddly shaped "+n;break;case 6:n="highly polished "+n}t=n;break;case 3:case 4:case 5:var r=["medal","statuette","sculpture","idol","chalice","goblet","dish","bowl"],s=r[N.randomNumber(r.length)],i=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];t=i[N.randomNumber(i.length)]+" "+s;break;case 6:case 7:case 8:var o=["ring","necklace","crown","circlet","bracelet","anklet","torc","brooch","pendant","locket","diadem","tiara","earring"],c=o[N.randomNumber(o.length)],l=["gold","silver","bronze","platinum","electrum","mithral","orium","adamantine"];switch(t=l[N.randomNumber(l.length)]+" "+c,N.randomNumber(5)){case 0:t=(N.randomBoolean()?"enamelled":"laquered")+" "+t;break;case 1:t=l[N.randomNumber(l.length)]+"-"+(N.randomBoolean()?"plated":"filigreed")+" "+t}switch(N.randomNumber(10)){case 0:t="delicate "+t;break;case 1:t="intricate "+t;break;case 2:t="elegant "+t;break;case 3:t="simple "+t;break;case 4:t="plain "+t}break;case 9:case 10:var u="";switch(N.randomBoolean()){case!0:switch(u="painting",N.randomBoolean()){case!0:u="oil "+u;break;case!1:u="watercolour "+u}break;case!1:switch(u="drawing",N.randomNumber(3)){case 0:u="pencil "+u;break;case 1:u="charcoal "+u;break;case 2:u="pastel "+u}}var m=["small","large","delicate","fragile","elegant","detailed"],p=["canvas","paper","parchment","wood panels","fabric"];t=m[N.randomNumber(m.length)]+" "+u+" on "+p[N.randomNumber(p.length)];break;case 11:var d=["lute","lyre","mandolin","violin","drum","flute","clarinet","accordion","banjo","bodhran","ocarina","zither","djembe","shawm"],h=d[N.randomNumber(d.length)],f=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];t=f[N.randomNumber(f.length)]+" "+h}switch(N.randomNumber(5)){case 0:var v=["feywild","shadowfell","elemental chaos","astral plane","abyss","distant north","distant east","distant west","distant south"];t+=" from the "+v[N.randomNumber(v.length)];break;case 1:var g=["decorated with","inscribed with","engraved with","embossed with","carved with"],b=["indecipherable","ancient","curious","unusual","dwarven","eladrin","elven","draconic","gith"],y=["script","designs","sigils","runes","glyphs","patterns"];t+=" "+g[N.randomNumber(g.length)]+" "+b[N.randomNumber(b.length)]+" "+y[N.randomNumber(y.length)];break;case 2:var E=["glowing with","suffused with","infused with","humming with","pulsing with"],k=["arcane","divine","primal","psionic","dark","shadow","elemental","ethereal","unknown"],w=["energy","power","magic"];t+=" "+E[N.randomNumber(E.length)]+" "+k[N.randomNumber(k.length)]+" "+w[N.randomNumber(w.length)];break;case 4:var C=a[N.randomNumber(a.length)];N.randomBoolean()?C+="s":C="a single "+C;var x=["set with","inlaid with","studded with","with shards of"];t+=" "+x[N.randomNumber(x.length)]+" "+C}return(e.startsWithVowel(t)?"an ":"a ")+t}},{key:"generateRoomName",value:function(){var e=["antechamber","arena","armoury","aviary","audience chamber","banquet hall","bath chamber","barracks","bedroom","boudoir","bestiary","burial chamber","cells","chamber","chantry","chapel","classroom","closet","court","crypt","dining room","dormitory","dressing room","dumping ground","entrance hall","gallery","game room","great hall","guard post","hall","harem","hoard","infirmary","kennels","kitchens","laboratory","lair","library","mausoleum","meditation room","museum","nursery","observatory","office","pantry","prison","quarters","reception room","refectory","ritual chamber","shrine","smithy","stable","storeroom","study","temple","throne room","torture chamber","trophy room","training area","treasury","waiting room","workroom","workshop","vault","vestibule"];return e[N.randomNumber(e.length)]}},{key:"potionColour",value:function(e){var t=["red","scarlet","crimson","carmine","vermillion","pink","blue","royal blue","sky blue","light blue","dark blue","midnight blue","indigo","yellow","lemon yellow","amber","green","light green","dark green","sea green","turquoise","aquamarine","emerald","purple","lavender","lilac","mauve","orange","brown","maroon","ochre","black","dark grey","grey","light grey","off-white","white","golden","silver"];return e&&(t=t.concat(["blood red","cherry red","ruby-coloured","rose-coloured","sapphire-coloured","straw-coloured","olive-coloured","plum-coloured","mud-coloured","cream-coloured","ivory-coloured","bronze-coloured","colourless","clear","transparent"])),t[N.randomNumber(t.length)]}},{key:"potionAdjective",value:function(){var e=["watery","syrupy","thick","viscous","gloopy","thin","runny","translucent","effervescent","fizzing","bubbling","foaming","volatile","smoking","fuming","vaporous","steaming","cold","icy cold","hot","sparkling","iridescent","cloudy","opalescent","luminous","phosphorescent","glowing"];return e[N.randomNumber(e.length)]}},{key:"potionFeature",value:function(){switch(N.randomNumber(5)){case 0:return"with "+this.potionColour(!0)+" specks";case 1:return"with flecks of "+this.potionColour(!1);case 2:var t=this.potionColour(!0);return"with "+(e.startsWithVowel(t)?"an":"a")+" "+t+" suspension";case 3:return"with a floating "+this.potionColour(!0)+" layer";case 4:return"with a ribbon of "+this.potionColour(!1)}return""}},{key:"potionLiquid",value:function(){var e=["liquid","solution","draught","oil","elixir","potion"];return e[N.randomNumber(e.length)]}},{key:"potionContainer",value:function(){var t=["small","rounded","tall","square","irregularly-shaped","long-necked","cylindrical","round-bottomed"],a=["glass","metal","ceramic","crystal"],n=["vial","jar","bottle","flask"],r=t[N.randomNumber(t.length)],s=a[N.randomNumber(a.length)],i=n[N.randomNumber(n.length)];0===N.randomNumber(3)&&(s=this.potionColour(!0)+" "+s);var o="";switch(N.randomBoolean()){case!0:o=s+" "+i;break;case!1:o=r+" "+s+" "+i}return(e.startsWithVowel(o)?"an":"a")+" "+o}},{key:"potionSmell",value:function(){var e=["acidic","acrid","of ammonia","of apples","bitter","brackish","buttery","of cherries","delicious","earthy","of earwax","of fish","floral","of lavender","lemony","of honey","fruity","meaty","metallic","musty","of onions","of oranges","peppery","of perfume","rotten","salty","sickly sweet","starchy","sugary","smokey","sour","spicy","of sweat","sweet","unpleasant","vile","vinegary"];return e[N.randomNumber(e.length)]}},{key:"bookNounPhrase",value:function(t,a){var n=e.bookNoun(t),r=!1;(t&&0===N.randomNumber(5)&&(n+="s",r=!0),0===N.randomNumber(3))&&(n=e.bookAdjective()+" "+n);if(a&&N.randomBoolean())switch(N.randomBoolean()){case!0:n="the "+n;break;case!1:if(r)switch(N.randomNumber(6)){case 0:n="two "+n;break;case 1:n="three "+n;break;case 2:n="four "+n;break;case 3:n="five "+n;break;case 4:n="six "+n;break;case 5:n="seven "+n}else switch(N.randomBoolean()){case!0:n=(e.startsWithVowel(n)?"an":"a")+" "+n;break;case!1:n="one "+n}}return n}},{key:"bookNoun",value:function(e){var t=["elf","halfling","dwarf","gnome","tiefling","dragonborn","goliath","changeling","drow","minotaur","beast","orc","goblin","hobgoblin","dragon","demon","devil","angel","god","gith","night","day","eclipse","shadow","sky","sun","moon","star","void","battle","war","brawl","fist","blade","arrow","spell","prayer","eye","wing","army","legion","brigade","galleon","warship","frigate","potion","jewel","ring","amulet","cloak","sword","spear","helm","wizard","king","queen","prince","princess","warlock","barbarian","sorcerer","thief","mage","child","wayfarer","adventurer","pirate","spy","sage","assassin","mountain","forest","peak","cave","cavern","lake","swamp","marshland","island","shore","city","town","village","tower","arena","castle","citadel","bridge","game","wager","quest","challenge","rose","lily","thorn","leaf","word","snake","serpent","song","lament","dirge","elegy","storm","tempest"];return e||(t=t.concat(["darkness","light","dusk","twilight","revenge","vengeance","blood","earth","water","ice","wood","metal","lightning","thunder","mist","snow","flame","fire","wind","stone","destruction","life","death","time","end","danger","luck","chaos","truth","untruth","lie","deception","music","sound","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"])),t[N.randomNumber(t.length)]}},{key:"bookAdjective",value:function(){var e=["dark","bright","tyrannous","devout","noble","eldritch","mystical","magical","sorcerous","savage","silent","lonely","violent","peaceful","black","white","gold","silver","red","pale","dying","living","ascending","defiled","mythical","legendary","heroic","empty","mighty","despairing","spellbound","enchanted","soaring","falling","visionary","bold","perilous"];return e[N.randomNumber(e.length)]}},{key:"bookGerund",value:function(){var e=["killing","murdering","watching","examining","enchanting","destroying","defying","betraying","protecting","silencing","bearing","fighting"];return e[N.randomNumber(e.length)]}},{key:"bookPreposition",value:function(){var e=["and","in","of","with","against","for","to","towards"];return e[N.randomNumber(e.length)]}},{key:"bookAbout",value:function(){var t=["treatise","essay","monograph","discourse","dissertation","primer","history","enchiridion"],a=t[N.randomNumber(t.length)];N.randomBoolean()?a=(e.startsWithVowel(a)?"an ":"a ")+a:a+="s";var n=["about","on","concerning","regarding","on the subject of"];return a+" "+n[N.randomNumber(n.length)]}}]),e}();ot.model=[],ot.maxLength=0;var ct=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.options.map((function(t){return r.a.createElement(lt,{key:t.id,option:t,selected:t.id===e.props.selectedID,onSelect:function(t){return e.props.onSelect(t)}})}));return r.a.createElement("div",{className:this.props.disabled?"tabs disabled":"tabs"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ct.defaultProps={disabled:!1};var lt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="tab";return this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled"),r.a.createElement("div",{key:this.props.option.id,className:t,title:this.props.option.text,onClick:function(t){return e.click(t)}},this.props.option.text)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ut=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={monster:e.monster,page:"overview",showFilter:!1,helpSection:"speed",sidebar:"similar",similarFilter:{size:!0,type:!0,subtype:!1,role:!1,alignment:!1,challenge:!0},scratchpadFilter:C.createMonsterFilter(),scratchpadList:[],showImageSelection:!1},n}return Object(l.a)(a,[{key:"setPage",value:function(e){var t=this.getHelpOptionsForPage(e);this.setState({page:e,helpSection:t[0]})}},{key:"setHelpSection",value:function(e){this.setState({helpSection:e})}},{key:"toggleMatch",value:function(e){var t=this.state.similarFilter;t[e]=!t[e],this.setState({similarFilter:t})}},{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"addToScratchpad",value:function(e){var t=this.state.scratchpadList;t.push(e),N.sort(t),this.setState({scratchpadList:t})}},{key:"removeFromScratchpad",value:function(e){var t=this.state.scratchpadList.indexOf(e);this.state.scratchpadList.splice(t,1),this.setState({scratchpadList:this.state.scratchpadList})}},{key:"addAllToScratchpad",value:function(e){var t=this.state.scratchpadList;e.forEach((function(e){return t.push(e)})),N.sort(t),this.setState({scratchpadList:t})}},{key:"clearScratchpad",value:function(){this.setState({scratchpadList:[]})}},{key:"getHelpOptionsForPage",value:function(e){switch(e){case"overview":return["speed","senses","languages","equipment"];case"abilities":return["str","dex","con","int","wis","cha","saves","skills"];case"cbt-stats":return["armor class","hit dice","resist","vulnerable","immune","conditions"];case"actions":return["actions"];default:return[]}}},{key:"getSimilarMonsters",value:function(){var e=this,t=[];return this.props.library.forEach((function(a){a.monsters.forEach((function(a){var n=!0;e.state.monster.id===a.id&&(n=!1),e.state.similarFilter.size&&e.state.monster.size!==a.size&&(n=!1),e.state.similarFilter.type&&e.state.monster.category!==a.category&&(n=!1),e.state.similarFilter.subtype&&e.state.monster.tag!==a.tag&&(n=!1),e.state.similarFilter.role&&e.state.monster.role!==a.role&&(n=!1),e.state.similarFilter.alignment&&e.state.monster.alignment!==a.alignment&&(n=!1),e.state.similarFilter.challenge&&e.state.monster.challenge!==a.challenge&&(n=!1),n&&t.push(a)}))})),t}},{key:"recalculateRole",value:function(){var e=this.state.monster;e.role=w.getRole(e)}},{key:"setRandomValue",value:function(e,t){w.setRandomValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"spliceMonsters",value:function(e){w.spliceMonsters(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"addTrait",value:function(e){w.addTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"addRandomTrait",value:function(e,t){w.addRandomTrait(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"moveTrait",value:function(e,t){var a=this.state.monster.traits.indexOf(e),n=this.state.monster.traits.indexOf(t);w.moveTrait(this.state.monster,a,n),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"removeTrait",value:function(e){w.removeTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"copyTrait",value:function(e){w.copyTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"changeTrait",value:function(e,t,a){e[t]=a,this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"nudgeValue",value:function(e,t){w.nudgeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"changeValue",value:function(e,t){w.changeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster,showImageSelection:!1})}},{key:"changeFilterValue",value:function(e,t){var a=this.state.scratchpadFilter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({scratchpadFilter:a})}},{key:"resetFilter",value:function(){this.setState({scratchpadFilter:C.createMonsterFilter()})}},{key:"matchMonster",value:function(e){return D.matchMonster(e,this.state.scratchpadFilter)}},{key:"getHelpSection",value:function(e){switch(this.state.helpSection){case"speed":return this.getValueSection("speed","text",e);case"senses":return this.getValueSection("senses","text",e);case"languages":return this.getValueSection("languages","text",e);case"equipment":return this.getValueSection("equipment","text",e);case"str":return this.getValueSection("abilityScores.str","number",e);case"dex":return this.getValueSection("abilityScores.dex","number",e);case"con":return this.getValueSection("abilityScores.con","number",e);case"int":return this.getValueSection("abilityScores.int","number",e);case"wis":return this.getValueSection("abilityScores.wis","number",e);case"cha":return this.getValueSection("abilityScores.cha","number",e);case"saves":return this.getValueSection("savingThrows","text",e);case"skills":return this.getValueSection("skills","text",e);case"armor class":return this.getValueSection("ac","number",e);case"hit dice":return this.getValueSection("hitDice","number",e);case"resist":return this.getValueSection("damage.resist","text",e);case"vulnerable":return this.getValueSection("damage.vulnerable","text",e);case"immune":return this.getValueSection("damage.immune","text",e);case"conditions":return this.getValueSection("conditionImmunities","text",e);case"actions":return this.getActionsSection(e);default:return null}}},{key:"getValueSection",value:function(e,t,a){var n=this,s=a.map((function(a){var n=e.split("."),r=a,s=null;return n.forEach((function(e){e===n[n.length-1]?s=r[e]:r=r[e]})),"text"===t&&""===s&&(s=null),s})).filter((function(e){return null!==e})),i=[];if("number"===t){var o=null,c=null;if(s.forEach((function(e){(null===o||e<o)&&(o=e),(null===c||e>c)&&(c=e)})),null!==o&&null!==c)for(var l=o;l<=c;++l)i.push({value:l,count:0})}switch(s.forEach((function(e){var t=i.find((function(t){return t.value===e}));t?t.count+=1:i.push({value:e,count:1})})),t){case"number":N.sort(i,[{field:"value",dir:"asc"}]);break;case"text":N.sort(i,[{field:"count",dir:"desc"},{field:"value",dir:"asc"}])}"text"===t&&(0!==a.length-s.length&&i.push({value:"",count:a.length-s.length}));var u=i.map((function(t){var s=100*t.count/a.length;return r.a.createElement(p.a,{gutter:10,className:"value-list",key:i.indexOf(t)},r.a.createElement(d.a,{span:8,className:"text-container"},t.value||"(none specified)"),r.a.createElement(d.a,{span:8,className:"bar-container"},r.a.createElement("div",{className:"bar",style:{width:s+"%"}})),r.a.createElement(d.a,{span:8},r.a.createElement("button",{onClick:function(){return n.changeValue(e,t.value)}},"use this value")))}));return r.a.createElement("div",null,u,r.a.createElement("button",{onClick:function(){return n.setRandomValue(e,a)}},"select random value"))}},{key:"getActionsSection",value:function(e){var t=this,a=[];return a.push(r.a.createElement(p.a,{gutter:10,className:"value-list",key:"header"},r.a.createElement(d.a,{span:8,className:"text-container"},r.a.createElement("b",null,"type")),r.a.createElement(d.a,{span:4,className:"text-container number"},r.a.createElement("b",null,"avg")),r.a.createElement(d.a,{span:4,className:"text-container number"},r.a.createElement("b",null,"min - max")))),k.forEach((function(n){var s=null,i=null,o=0;e.forEach((function(e){var t=e.traits.filter((function(e){return e.type===n})).length;(null===s||t<s)&&(s=t),(null===i||t>i)&&(i=t),o+=t}));var c=Math.round(o/e.length);a.push(r.a.createElement(p.a,{gutter:10,className:"value-list",key:n},r.a.createElement(d.a,{span:8,className:0===o?"text-container disabled":"text-container"},N.traitType(n,!0)),r.a.createElement(d.a,{span:4,className:0===o?"text-container number disabled":"text-container number"},c),r.a.createElement(d.a,{span:4,className:0===o?"text-container number disabled":"text-container number"},s," - ",i),r.a.createElement(d.a,{span:8},r.a.createElement("button",{className:0===o?"disabled":"",onClick:function(){return t.addRandomTrait(n,e)}},"add random"))))})),r.a.createElement("div",null,a)}},{key:"getSidebar",value:function(){var e=this,t=null;if(this.props.showSidebar){var a=[];if(this.props.showSidebar)switch(this.state.sidebar){case"similar":a=this.getSimilarMonsters();break;case"all":this.props.library.forEach((function(t){t.monsters.forEach((function(t){!a.includes(t)&&e.matchMonster(t)&&a.push(t)}))}))}a=a.filter((function(t){return!e.state.scratchpadList.find((function(e){return e.id===t.id}))})),N.sort(a);var n=null;switch(this.state.sidebar){case"similar":n=r.a.createElement(U,{text:"similarity criteria"},r.a.createElement(j,{label:"size "+this.state.monster.size,checked:this.state.similarFilter.size,onChecked:function(t){return e.toggleMatch("size")}}),r.a.createElement(j,{label:"type "+this.state.monster.category,checked:this.state.similarFilter.type,onChecked:function(t){return e.toggleMatch("type")}}),r.a.createElement(j,{label:this.state.monster.tag?"subtype "+this.state.monster.tag:"subtype",checked:this.state.similarFilter.subtype,disabled:!this.state.monster.tag,onChecked:function(t){return e.toggleMatch("subtype")}}),r.a.createElement(j,{label:this.state.monster.role?"role "+this.state.monster.role:"role",checked:this.state.similarFilter.role,disabled:!this.state.monster.role,onChecked:function(t){return e.toggleMatch("role")}}),r.a.createElement(j,{label:this.state.monster.alignment?"alignment "+this.state.monster.alignment:"alignment",checked:this.state.similarFilter.alignment,disabled:!this.state.monster.alignment,onChecked:function(t){return e.toggleMatch("alignment")}}),r.a.createElement(j,{label:"challenge rating "+N.challenge(this.state.monster.challenge),checked:this.state.similarFilter.challenge,onChecked:function(t){return e.toggleMatch("challenge")}}));break;case"all":n=r.a.createElement(de,{filter:this.state.scratchpadFilter,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}})}var s=null;0===this.state.scratchpadList.length&&(s=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"this is your ",r.a.createElement("b",null,"scratchpad")," list; you can add monsters to it from the list to the right"),r.a.createElement("div",{className:"section"},"you might find this useful if you're creating a monster and want it to have similar abilities to other monsters"),r.a.createElement("div",{className:"section"},"when there are monsters in this list, their combined stats will be shown on the left"),r.a.createElement("div",{className:"section"},"you can also quickly blend together all the monters in this list to create a new monster by clicking the ",r.a.createElement("b",null,"generate hybrid monster")," button above")));var i=null;0===a.length&&(i=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"there are no monsters in your library which match the above criteria (or they are all in your scratchpad already)"))),t=r.a.createElement(d.a,{span:12,className:"scrollable sidebar sidebar-right"},r.a.createElement(p.a,{gutter:5},r.a.createElement(d.a,{span:12},r.a.createElement(ct,{options:[{id:"scratch",text:"scratchpad"}],selectedID:"scratch",onSelect:function(){return null}}),r.a.createElement("button",{className:this.state.scratchpadList.length<2?"disabled":"",onClick:function(){return e.spliceMonsters(e.state.scratchpadList)}},"generate hybrid monster"),r.a.createElement("button",{className:0===this.state.scratchpadList.length?"disabled":"",onClick:function(){return e.clearScratchpad()}},"clear scratchpad"),r.a.createElement("hr",null),this.getMonsterCards(this.state.scratchpadList,!0),s),r.a.createElement(d.a,{span:12},r.a.createElement(ct,{options:[{id:"similar",text:"similar"},{id:"all",text:"all"}],selectedID:this.state.sidebar,onSelect:function(t){return e.setState({sidebar:t})}}),n,r.a.createElement("button",{className:0===a.length?"disabled":"",onClick:function(){return e.addAllToScratchpad(a)}},"add all to scratchpad"),r.a.createElement("hr",null),this.getMonsterCards(a,!1),i)))}else{var o=null,c=N.challengeDetails().find((function(t){return t.cr===e.state.monster.challenge}));c&&(o=r.a.createElement(U,{text:"suggested stats"},r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"challenge rating"),r.a.createElement(d.a,{span:8,className:"statistic-value"},c.cr))),r.a.createElement("div",{className:"subheading"},"defensive"),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"armor class"),r.a.createElement(d.a,{span:8,className:"statistic-value"},c.ac))),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"hit points"),r.a.createElement(d.a,{span:8,className:"statistic-value"},c.hpMin," - ",c.hpMax))),r.a.createElement("div",{className:"subheading"},"offensive"),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"attack bonus"),r.a.createElement(d.a,{span:8,className:"statistic-value"},c.attack))),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"damage / rnd"),r.a.createElement(d.a,{span:8,className:"statistic-value"},c.dmgMin," - ",c.dmgMax))),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"save dc"),r.a.createElement(d.a,{span:8,className:"statistic-value"},c.save))))),t=r.a.createElement(d.a,{span:12,className:"scrollable sidebar sidebar-right",style:{padding:"5px"}},o,o?r.a.createElement("hr",null):null,r.a.createElement(le,{monster:this.state.monster}))}return t}},{key:"getMonsterCards",value:function(e,t){var a=this;return N.sort(e).map((function(e){return r.a.createElement("div",{className:"section",key:e.id},r.a.createElement(le,{monster:e,mode:"template "+a.state.page+(t?" selected":""),copyTrait:function(e){return a.copyTrait(e)},selectMonster:function(e){return a.addToScratchpad(e)},deselectMonster:function(e){return a.removeFromScratchpad(e)}}))})).filter((function(e){return!!e}))}},{key:"render",value:function(){var e=this;try{var t=null;switch(this.state.page){case"overview":t=r.a.createElement(mt,{monster:this.state.monster,toggleImageSelection:function(){return e.toggleImageSelection()},changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"abilities":t=r.a.createElement(pt,{monster:this.state.monster,changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"cbt-stats":t=r.a.createElement(dt,{monster:this.state.monster,changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"actions":t=r.a.createElement(ht,{monster:this.state.monster,addTrait:function(t){return e.addTrait(t)},moveTrait:function(t,a){return e.moveTrait(t,a)},removeTrait:function(t){return e.removeTrait(t)},changeValue:function(t,a,n){return e.changeTrait(t,a,n)}})}var a=null;if(this.props.showSidebar&&this.state.scratchpadList.length>0){var n=null;if(this.getHelpOptionsForPage(this.state.page).length>1){var s=this.getHelpOptionsForPage(this.state.page).map((function(e){return{id:e,text:e}}));n=r.a.createElement(ue,{options:s,selectedID:this.state.helpSection,onSelect:function(t){return e.setHelpSection(t)}})}a=r.a.createElement("div",{className:"monster-help group-panel"},r.a.createElement("div",{className:"heading"},"information from scratchpad monsters"),n,this.getHelpSection(this.state.scratchpadList))}return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement(ct,{options:[{id:"overview",text:"overview"},{id:"abilities",text:"abilities"},{id:"cbt-stats",text:"combat"},{id:"actions",text:"actions"}],selectedID:this.state.page,onSelect:function(t){return e.setPage(t)}}),t,a),this.getSidebar(),r.a.createElement(h.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(tt,{select:function(t){return e.changeValue("portrait",t)},cancel:function(){return e.toggleImageSelection()}})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),mt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"randomName",value:function(){var e=ot.generateName(!0);e=e[0].toUpperCase()+e.substr(1),this.props.changeValue("name",e)}},{key:"render",value:function(){var e=this;try{var t=y.map((function(e){return{id:e,text:e}}));return r.a.createElement(p.a,{gutter:10,key:"overview"},r.a.createElement(d.a,{span:24},r.a.createElement("div",{className:"subheading"},"name"),r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(H,{text:this.props.monster.name,onChange:function(t){return e.props.changeValue("name",t)}}),r.a.createElement(rt.a,{onClick:function(){return e.randomName()},title:"generate a random name"}))),r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"type"),r.a.createElement(W,{options:t,selectedID:this.props.monster.category,onSelect:function(t){return e.props.changeValue("category",t)}}),r.a.createElement("div",{className:"subheading"},"subtype"),r.a.createElement(H,{text:this.props.monster.tag,placeholder:"none",onChange:function(t){return e.props.changeValue("tag",t)}}),r.a.createElement("div",{className:"subheading"},"alignment"),r.a.createElement(H,{text:this.props.monster.alignment,onChange:function(t){return e.props.changeValue("alignment",t)}}),r.a.createElement("div",{className:"subheading"},"challenge rating"),r.a.createElement(Z,{value:N.challenge(this.props.monster.challenge),downEnabled:this.props.monster.challenge>0,onNudgeValue:function(t){return e.props.nudgeValue("challenge",t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(Z,{value:this.props.monster.size,downEnabled:"tiny"!==this.props.monster.size,upEnabled:"gargantuan"!==this.props.monster.size,onNudgeValue:function(t){return e.props.nudgeValue("size",t)}})),r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"speed"),r.a.createElement(H,{text:this.props.monster.speed,onChange:function(t){return e.props.changeValue("speed",t)}}),r.a.createElement("div",{className:"subheading"},"senses"),r.a.createElement(H,{text:this.props.monster.senses,onChange:function(t){return e.props.changeValue("senses",t)}}),r.a.createElement("div",{className:"subheading"},"languages"),r.a.createElement(H,{text:this.props.monster.languages,onChange:function(t){return e.props.changeValue("languages",t)}}),r.a.createElement("div",{className:"subheading"},"equipment"),r.a.createElement(H,{text:this.props.monster.equipment,onChange:function(t){return e.props.changeValue("equipment",t)}}),r.a.createElement("div",{className:"subheading"},"portrait"),r.a.createElement(ee,{source:this.props.monster,edit:function(){return e.props.toggleImageSelection()},clear:function(){return e.props.changeValue("portrait","")}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),pt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement(p.a,{gutter:10,key:"abilities"},r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"ability scores"),r.a.createElement(Q,{edit:!0,combatant:this.props.monster,onNudgeValue:function(t,a,n){return e.props.nudgeValue(a,n)}})),r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"saving throws"),r.a.createElement(H,{text:this.props.monster.savingThrows,onChange:function(t){return e.props.changeValue("savingThrows",t)}}),r.a.createElement("div",{className:"subheading"},"skills"),r.a.createElement(H,{text:this.props.monster.skills,onChange:function(t){return e.props.changeValue("skills",t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),dt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement(p.a,{gutter:10,key:"cbt-stats"},r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"armor class"),r.a.createElement(Z,{value:this.props.monster.ac,downEnabled:this.props.monster.ac>0,onNudgeValue:function(t){return e.props.nudgeValue("ac",t)}}),r.a.createElement("div",{className:"subheading"},"hit dice"),r.a.createElement(Z,{value:this.props.monster.hitDice+"d"+N.hitDieType(this.props.monster.size),downEnabled:this.props.monster.hitDice>1,onNudgeValue:function(t){return e.props.nudgeValue("hitDice",t)}}),r.a.createElement("div",{className:"subheading"},"hit points"),r.a.createElement("div",{className:"hp-value"},w.getTypicalHP(this.props.monster)," hp"),r.a.createElement("div",{className:"subheading"},"legendary actions"),r.a.createElement(Z,{value:this.props.monster.legendaryActions,downEnabled:this.props.monster.legendaryActions>0,onNudgeValue:function(t){return e.props.nudgeValue("legendaryActions",t)}})),r.a.createElement(d.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"damage resistances"),r.a.createElement(H,{text:this.props.monster.damage.resist,onChange:function(t){return e.props.changeValue("damage.resist",t)}}),r.a.createElement("div",{className:"subheading"},"damage vulnerabilities"),r.a.createElement(H,{text:this.props.monster.damage.vulnerable,onChange:function(t){return e.props.changeValue("damage.vulnerable",t)}}),r.a.createElement("div",{className:"subheading"},"damage immunities"),r.a.createElement(H,{text:this.props.monster.damage.immune,onChange:function(t){return e.props.changeValue("damage.immune",t)}}),r.a.createElement("div",{className:"subheading"},"condition immunities"),r.a.createElement(H,{text:this.props.monster.conditionImmunities,onChange:function(t){return e.props.changeValue("conditionImmunities",t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ht=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={selectedTraitID:null},n}return Object(l.a)(a,[{key:"setSelectedTraitID",value:function(e){this.setState({selectedTraitID:e})}},{key:"createTraitBar",value:function(e){var t=this;return r.a.createElement(ft,{key:e.id,trait:e,isSelected:e.id===this.state.selectedTraitID,select:function(e){return t.setSelectedTraitID(e)}})}},{key:"moveTrait",value:function(e,t){this.props.moveTrait(e,t)}},{key:"createSection",value:function(e,t){var a=this,n=e[t];return r.a.createElement("div",null,r.a.createElement("div",{className:"section subheading"},N.traitType(t,!0)),r.a.createElement(it.List,{values:n,lockVertically:!0,onChange:function(e){var t=e.oldIndex,r=e.newIndex;return a.moveTrait(n[t],n[r])},renderList:function(e){var t=e.children,a=e.props;return r.a.createElement("div",a,t)},renderItem:function(e){var t=e.value,n=e.props,s=e.isDragged;return r.a.createElement("div",Object.assign({},n,{className:s?"dragged":""}),a.createTraitBar(t))}}),r.a.createElement("button",{onClick:function(){return a.props.addTrait(t)}},"add a new ",N.traitType(t,!1)))}},{key:"render",value:function(){var e=this;try{var t=[],a={};k.forEach((function(n){t.push({id:n,text:N.traitType(n,!1)}),a[n]=e.props.monster.traits.filter((function(e){return e.type===n}))}));var n=this.props.monster.traits.find((function(t){return t.id===e.state.selectedTraitID})),s=null;return s=n?r.a.createElement(vt,{trait:n,removeTrait:function(t){return e.props.removeTrait(t)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)}}):r.a.createElement(se,null,"select one of the traits or actions from the column to the left to edit its details here"),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:10},this.createSection(a,"trait"),this.createSection(a,"action"),this.createSection(a,"bonus"),this.createSection(a,"reaction"),this.createSection(a,"legendary"),this.createSection(a,"mythic"),this.createSection(a,"lair")),r.a.createElement(d.a,{span:14},s))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ht.defaultProps={addTrait:null,copyTrait:null,removeTrait:null,changeValue:null,swapTraits:null};var ft=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:this.props.isSelected?"trait-bar selected":"trait-bar",onClick:function(){return e.props.select(e.props.trait.id)}},r.a.createElement(st.a,{className:"grabber","data-movable-handle":!0}),r.a.createElement("div",{className:"name"},this.props.trait.name||"unnamed "+N.traitType(this.props.trait.type,!1)))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),vt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{key:this.props.trait.id,className:"section"},r.a.createElement("div",{className:"subheading"},"trait name"),r.a.createElement(H,{text:this.props.trait.name,onChange:function(t){return e.props.changeValue(e.props.trait,"name",t)}}),r.a.createElement("div",{className:"subheading"},"usage"),r.a.createElement(H,{text:this.props.trait.usage,onChange:function(t){return e.props.changeValue(e.props.trait,"usage",t)}}),r.a.createElement("div",{className:"subheading"},"details"),r.a.createElement(H,{text:this.props.trait.text,placeholder:"details",multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.trait,"text",t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.removeTrait(e.props.trait)}},"remove this trait"))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),gt=a(213),bt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={pc:e.pc,showImageSelection:!1},n}return Object(l.a)(a,[{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"addCompanion",value:function(){var e=C.createCompanion();e.name="new companion",this.state.pc.companions.push(e),this.setState({pc:this.state.pc})}},{key:"removeCompanion",value:function(e){var t=this.state.pc;t.companions=this.state.pc.companions.filter((function(t){return t.id!==e})),this.setState({pc:t})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({pc:this.state.pc,showImageSelection:!1})}},{key:"nudgeValue",value:function(e,t,a){var n,r=e[t];switch(t){case"size":n=N.nudgeSize(r,a);break;default:n=(r||0)+a}this.changeValue(e,t,n)}},{key:"render",value:function(){var e=this;try{var t=[];this.props.library.forEach((function(e){e.monsters.forEach((function(e){t.push({id:e.id,text:e.name})}))})),N.sort(t,[{field:"text",dir:"asc"}]);var a=this.state.pc.companions.map((function(a){return r.a.createElement("div",{className:"group-panel companion-list-item",key:a.id},r.a.createElement("div",{className:"companion-fields"},r.a.createElement(H,{text:a.name,onChange:function(t){return e.changeValue(a,"name",t)}}),r.a.createElement(W,{options:t,placeholder:"select a stat block",selectedID:a.monsterID||void 0,onSelect:function(t){return e.changeValue(a,"monsterID",t)},onClear:function(){return e.changeValue(a,"monsterID",null)}})),r.a.createElement("div",{className:"companion-actions"},r.a.createElement(gt.a,{onClick:function(){return e.removeCompanion(a.id)}})))}));return 0===a.length&&a.push(r.a.createElement("div",{className:"section",key:"empty"},r.a.createElement("i",null,"no companions (pets, retainers, mounts, etc)"))),r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"subheading"},"character name:"),r.a.createElement(H,{text:this.state.pc.name,onChange:function(t){return e.changeValue(e.state.pc,"name",t)}}),r.a.createElement("div",{className:"subheading"},"player name:"),r.a.createElement(H,{text:this.state.pc.player,onChange:function(t){return e.changeValue(e.state.pc,"player",t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(Z,{value:this.state.pc.size,downEnabled:"tiny"!==this.state.pc.size,upEnabled:"gargantuan"!==this.state.pc.size,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"size",t)}}),r.a.createElement("div",{className:"subheading"},"race:"),r.a.createElement(H,{text:this.state.pc.race,onChange:function(t){return e.changeValue(e.state.pc,"race",t)}}),r.a.createElement("div",{className:"subheading"},"class:"),r.a.createElement(H,{text:this.state.pc.classes,onChange:function(t){return e.changeValue(e.state.pc,"classes",t)}}),r.a.createElement("div",{className:"subheading"},"level:"),r.a.createElement(Z,{value:this.state.pc.level,downEnabled:this.state.pc.level>1,upEnabled:this.state.pc.level<20,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"level",t)}}),r.a.createElement("div",{className:"subheading"},"passive skills"),r.a.createElement(Z,{value:this.state.pc.passiveInsight,label:"insight",downEnabled:this.state.pc.passiveInsight>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passiveInsight",t)}}),r.a.createElement(Z,{value:this.state.pc.passiveInvestigation,label:"investigation",downEnabled:this.state.pc.passiveInvestigation>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passiveInvestigation",t)}}),r.a.createElement(Z,{value:this.state.pc.passivePerception,label:"perception",downEnabled:this.state.pc.passivePerception>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passivePerception",t)}})),r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"subheading"},"languages:"),r.a.createElement(H,{text:this.state.pc.languages,onChange:function(t){return e.changeValue(e.state.pc,"languages",t)}}),r.a.createElement("div",{className:"subheading"},"d&d beyond link:"),r.a.createElement(H,{text:this.state.pc.url,placeholder:"https://ddb.ac/characters/...",onChange:function(t){return e.changeValue(e.state.pc,"url",t)}}),r.a.createElement("div",{className:"subheading"},"portrait"),r.a.createElement(ee,{source:this.state.pc,edit:function(){return e.toggleImageSelection()},clear:function(){return e.changeValue(e.state.pc,"portrait","")}}),r.a.createElement("div",{className:"subheading"},"companions:"),a,r.a.createElement("button",{onClick:function(){return e.addCompanion()}},"add a new companion")),r.a.createElement(h.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(tt,{select:function(t){return e.changeValue(e.state.pc,"portrait",t)},cancel:function(){return e.toggleImageSelection()}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),yt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={map:e.map,imageID:null,size:0,square:0,imageDimensions:{width:0,height:0},mapDimensions:{width:0,height:0}},n}return Object(l.a)(a,[{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target){var n=a.target.result;t.state.imageID&&window.localStorage.removeItem("image-"+t.state.imageID);try{var r={id:N.guid(),name:e.name,data:n},s=JSON.stringify(r);window.localStorage.setItem("image-"+r.id,s);var i=new Image;i.onload=function(){var e=Math.round(Math.min(i.width,i.height)/10);t.setState({imageID:r.id,size:n.length,square:e,imageDimensions:{width:i.width,height:i.height},mapDimensions:{width:Math.round(i.width/e),height:Math.round(i.height/e)}},(function(){t.updateMap(r.name)}))},i.src=n}catch(o){$e.a.open({message:"can't upload this image",description:"not enough storage space for this image ("+N.toData(n.length)+"); try reducing the resolution or removing unused images"})}}},a.readAsDataURL(e),!1}},{key:"nudgeSquare",value:function(e){var t=this,a=Math.max(0,this.state.square+e);this.setState({square:a,mapDimensions:{width:Math.round(this.state.imageDimensions.width/a),height:Math.round(this.state.imageDimensions.height/a)}},(function(){t.updateMap(null)}))}},{key:"nudgeWidth",value:function(e){var t=this,a=Math.max(0,this.state.mapDimensions.width+e);this.setState({mapDimensions:{width:a,height:this.state.mapDimensions.height}},(function(){t.updateMap(null)}))}},{key:"nudgeHeight",value:function(e){var t=this,a=Math.max(0,this.state.mapDimensions.height+e);this.setState({mapDimensions:{width:this.state.mapDimensions.width,height:a}},(function(){t.updateMap(null)}))}},{key:"updateMap",value:function(e){var t=this.state.map;if(e&&(t.name=e),this.state.imageID){var a=C.createMapItem();a.type="tile",a.terrain="custom",a.customBackground=this.state.imageID,a.width=this.state.mapDimensions.width,a.height=this.state.mapDimensions.height,t.items=[a]}else t.items=[];this.setState({map:t})}},{key:"render",value:function(){var e=this;try{var t=null;return t=this.state.imageID&&this.state.imageDimensions?r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"this image is ",N.toData(this.state.size)),r.a.createElement("div",{className:"section"},"set the name and dimensions of this map image"),r.a.createElement("div",{className:"section"},"changing the size of a map square, in pixels, will change the map's dimensions"),r.a.createElement("div",{className:"section"},"you can then fine-tune the exact width and height of the map")),r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(H,{text:this.state.map.name,placeholder:"map name",onChange:function(t){return e.updateMap(t)}}),r.a.createElement("div",{className:"subheading"},"map square size"),r.a.createElement(Z,{value:this.state.square+" px",label:"square size",factors:[1,10],downEnabled:this.state.square>1,onNudgeValue:function(t){return e.nudgeSquare(t)}}),r.a.createElement("div",{className:"subheading"},"map dimensions"),r.a.createElement(Z,{value:this.state.mapDimensions.width+" sq",label:"width",downEnabled:this.state.mapDimensions.width>1,onNudgeValue:function(t){return e.nudgeWidth(t)}}),r.a.createElement(Z,{value:this.state.mapDimensions.height+" sq",label:"height",downEnabled:this.state.mapDimensions.height>1,onNudgeValue:function(t){return e.nudgeHeight(t)}})):r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(et.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(Qe.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:8,className:"scrollable"},t),r.a.createElement(d.a,{span:16,className:"scrollable both-ways"},r.a.createElement(ke,{map:this.state.map,mode:"edit",showGrid:!0,gridSquareClicked:function(e,t){return null}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Et=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={group:e.group},n}return Object(l.a)(a,[{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e){var n=a[e];t.state.group[e]=n}})),t.state.group.monsters.forEach((function(e){e.id=N.guid(),e.portrait=""})),t.setState({group:t.state.group})})),!1}},{key:"render",value:function(){var e=this;try{return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(et.a.Dragger,{accept:".monstergroup",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(Qe.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))),r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement(He,{heading:this.props.group.name,columns:1,content:this.props.group.monsters.map((function(e){return r.a.createElement(le,{key:e.id,monster:e,mode:"view"})}))})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),kt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",monster:e.monster},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){w.import(this.state.source,this.state.monster),this.setState({monster:this.state.monster})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e&&"portrait"!==e){var n=a[e];t.state.monster[e]=n}})),t.setState({monster:t.state.monster})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":a=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"go to the following link to find the monster you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/monsters",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/monsters")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),r.a.createElement(H,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(et.a.Dragger,{accept:".monster",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(Qe.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement(ct,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(d.a,{span:12,className:"scrollable",style:{padding:"5px"}},r.a.createElement(le,{monster:this.state.monster})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),wt=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"importParty",value:function(t,a){a.name="",a.pcs=[];var n=(new DOMParser).parseFromString(t,"text/html");try{a.name=n.getElementsByClassName("page-title")[0].innerText.trim()}catch(u){console.error(u)}try{for(var r=n.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-active")[0].getElementsByClassName("ddb-campaigns-character-card"),s=0;s!==r.length;++s){var i=r[s];a.pcs.push(e.getCharacter(i,!0))}}catch(u){console.error(u)}try{for(var o=n.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-inactive")[0].getElementsByClassName("ddb-campaigns-character-card"),c=0;c!==o.length;++c){var l=o[c];a.pcs.push(e.getCharacter(l,!1))}}catch(u){console.error(u)}}},{key:"getCharacter",value:function(e,t){var a=C.createPC();a.name=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-primary")[0].innerText.trim(),a.player=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[1].innerText.trim().substring(8),a.active=t;var n=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[0].innerText.trim().split("|");a.level=Number.parseInt(n[0].substring(4).trim(),10),a.race=n[1].trim(),a.classes=n[2].trim();var r=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-details-link")[0];return a.url="https://www.dndbeyond.com"+r.getAttribute("href"),a}},{key:"importPC",value:function(e,t){try{var a=JSON.parse(e);t.name=a.character.name,t.size=a.character.race.size,t.race=a.character.race.fullName;var n=0,r="";a.character.classes.forEach((function(e){n+=e.level,""!==r&&(r+=" / "),r+=e.definition.name,e.subclassDefinition&&(r+=" ("+e.subclassDefinition.name+")")})),t.classes=r,t.level=n;var s=[].concat(a.character.modifiers.race).concat(a.character.modifiers.class).concat(a.character.modifiers.background).concat(a.character.modifiers.item).concat(a.character.modifiers.feat).concat(a.character.modifiers.condition),i=s.filter((function(e){return"language"===e.type})).map((function(e){return e.friendlySubtypeName}));t.languages=i.join(", ");var o=N.proficiency(n),c=a.character.stats[3].value,l=a.character.stats[4].value;s.filter((function(e){return"bonus"===e.type&&"intelligence-score"===e.subType})).forEach((function(e){return c+=e.value})),s.filter((function(e){return"bonus"===e.type&&"wisdom-score"===e.subType})).forEach((function(e){return l+=e.value}));var u=0,m=0,p=0,d=s.filter((function(e){return"insight"===e.subType||"wisdom-ability-checks"===e.subType})).map((function(e){return e.type}));d.includes("expertise")?u=2:d.includes("proficiency")?u=1:d.includes("half-proficiency-round-up")&&(u=.5);var h=s.filter((function(e){return"investigation"===e.subType||"intelligence-ability-checks"===e.subType})).map((function(e){return e.type}));h.includes("expertise")?m=2:h.includes("proficiency")?m=1:d.includes("half-proficiency-round-up")&&(m=.5);var f=s.filter((function(e){return"perception"===e.subType||"wisdom-ability-checks"===e.subType})).map((function(e){return e.type}));f.includes("expertise")?p=2:f.includes("proficiency")?p=1:d.includes("half-proficiency-round-up")&&(p=.5),t.passiveInsight=10+N.modifierValue(l)+Math.floor(o*u),t.passiveInvestigation=10+N.modifierValue(c)+Math.floor(o*m),t.passivePerception=10+N.modifierValue(l)+Math.floor(o*p),t.companions=[],a.character.creatures.forEach((function(e){var a=C.createCompanion();a.name=e.name,t.companions.push(a)}))}catch(v){console.error(v)}}}]),e}(),Nt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",party:e.party},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){wt.importParty(this.state.source,this.state.party),this.setState({party:this.state.party})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e){var n=a[e];t.state.party[e]=n}})),t.state.party.pcs.forEach((function(e){e.id=N.guid(),e.portrait=""})),t.setState({party:t.state.party})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":a=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"go to the following link to find the party you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/my-campaigns",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/my-campaigns")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),r.a.createElement(H,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(et.a.Dragger,{accept:".party",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(Qe.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement(ct,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement(He,{heading:this.props.party.name,columns:1,content:this.props.party.pcs.map((function(e){return r.a.createElement(We,{key:e.id,pc:e,mode:"view"})}))})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ct=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",pc:e.pc},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){wt.importPC(this.state.source,this.state.pc),this.setState({pc:this.state.pc})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e&&"portrait"!==e){var n=a[e];t.state.pc[e]=n}})),t.setState({pc:t.state.pc})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":var n=null,s=this.state.pc.url;""!==s?(s.endsWith("/")||(s+="/"),s+="json",n=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"go to the following link"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},s)),r.a.createElement("div",{className:"section"},"copy the data into the clipboard, paste it into the box below, and press the analyse button"))):n=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"go to the following link to find the pc you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),a=r.a.createElement("div",null,n,r.a.createElement(H,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(et.a.Dragger,{accept:".pc",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(Qe.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement(ct,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(d.a,{span:12,className:"scrollable"},r.a.createElement(We,{pc:this.state.pc,mode:"view"})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),xt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getKillsChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"kill"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=N.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"kills"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Le,{data:t}))}},{key:"getDamageChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"damage"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=a.value}})),t=N.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"damage dealt"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Le,{data:t}))}},{key:"getMobilityChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"movement"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=N.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mobility"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Le,{data:t}))}},{key:"getConditionsAddedChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"condition-add"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=N.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"conditions added"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Le,{data:t}))}},{key:"getConditionsRemovedChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"condition-remove"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=N.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"conditions removed"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Le,{data:t}))}},{key:"getTurnLengthChart",value:function(){var e=this,t=[],a=null,n=[];return this.props.combat.report.forEach((function(r){switch(r.type){case"turn-start":a=r.timestamp;break;case"turn-end":if(null!==a){var s=e.props.combat.combatants.find((function(e){return e.id===r.combatantID}));if(s&&"pc"===s.type){var i=t.find((function(e){return e.text===s.displayName}));void 0===i&&(i={text:s.displayName,value:0},t.push(i));var o=r.timestamp-a;n.forEach((function(e){if(e.start&&e.end){var t=e.end-e.start;o-=t}})),i.value+=o}a=null,n=[]}break;case"combat-pause":n.push({start:r.timestamp,end:null});break;case"combat-resume":if(n.length>0)n[n.length-1].end=r.timestamp}})),t=N.sort(t,[{field:"value",dir:"asc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"turn length"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Le,{data:t,onFormatValue:function(e){var t=new Date(e);return t.getMinutes()+"m "+t.getSeconds()+"s"}}))}},{key:"render",value:function(){try{return r.a.createElement("div",{className:"scrollable padded"},this.getKillsChart(),this.getDamageChart(),this.getMobilityChart(),this.getConditionsAddedChart(),this.getConditionsRemovedChart(),this.getTurnLengthChart())}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),St=a(255),Mt=a(228),Ot=a(227),It=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=[];this.props.combatants.forEach((function(a){a.conditions.forEach((function(n){t.push(r.a.createElement(Dt,{key:n.id,condition:n,combatant:a,combatants:e.props.allCombatants,showCombatantName:e.props.combatants.length>1,inline:e.props.inline,nudgeConditionValue:function(t,a,n){return e.props.nudgeConditionValue(t,a,n)},editCondition:function(t){return e.props.editCondition(a,t)},removeCondition:function(t){return e.props.removeCondition(a,t)}}))}))}));var a=null;if(this.props.inline){var n=g.map((function(e){return{id:e,text:e}}));a=r.a.createElement(W,{options:n,placeholder:"add a condition...",onSelect:function(t){var a=C.createCondition();a.name=t,e.props.quickAddCondition(e.props.combatants,a)}})}else a=r.a.createElement("button",{onClick:function(){return e.props.addCondition()}},"add a condition");return r.a.createElement("div",{className:"section"},t,a)}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Dt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.condition.name||"condition";"exhaustion"===this.props.condition.name&&(t+=" ("+this.props.condition.level+")"),this.props.showCombatantName&&(t=this.props.combatant.displayName+": "+t);var a=null;this.props.inline||(a=r.a.createElement(Mt.a,{title:"edit",onClick:function(){return e.props.editCondition(e.props.condition)}}));var n=r.a.createElement(Ot.a,{title:"remove",onClick:function(){return e.props.removeCondition(e.props.condition)}}),s=null;null!==this.props.condition.duration&&(s=r.a.createElement("div",{className:"section"},r.a.createElement("i",null,N.conditionDurationText(this.props.condition,this.props.combatants))));var i=[];"exhaustion"===this.props.condition.name&&i.push(r.a.createElement("div",{key:"level",className:"section"},r.a.createElement(Z,{value:this.props.condition.level,label:"level",downEnabled:this.props.condition.level>1,upEnabled:this.props.condition.level<6,onNudgeValue:function(t){return e.props.nudgeConditionValue(e.props.condition,"level",t)}})));for(var o=N.conditionText(this.props.condition),c=0;c!==o.length;++c)i.push(r.a.createElement("div",{key:c,className:"section"},o[c]));return r.a.createElement("div",{className:"group-panel condition-panel"},r.a.createElement("div",{className:"condition-heading"},r.a.createElement("div",{className:"condition-name"},t),r.a.createElement("div",{className:"condition-buttons"},a,n)),s,i)}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),jt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:e.defaultTab,healingValue:0,damageValue:0,damageMultipliers:{}},n}return Object(l.a)(a,[{key:"nudgeHealing",value:function(e){this.setState({healingValue:Math.max(this.state.healingValue+e,0)})}},{key:"nudgeDamage",value:function(e){this.setState({damageValue:Math.max(this.state.damageValue+e,0)})}},{key:"setView",value:function(e){this.setState({view:e})}},{key:"setDamageMultiplier",value:function(e,t){var a=this.state.damageMultipliers;a[e]=t,this.setState({damageMultipliers:a})}},{key:"heal",value:function(){var e=this,t=this.state.healingValue;this.setState({healingValue:0},(function(){var a=[];e.props.combatants.forEach((function(e){var n,r,s,i=null!==(n=e.hpMax)&&void 0!==n?n:0,o=(null!==(r=e.hpCurrent)&&void 0!==r?r:0)+t;o=Math.min(o,i),a.push({id:e.id,hp:o,temp:null!==(s=e.hpTemp)&&void 0!==s?s:0,damage:0})})),e.props.changeHP(a)}))}},{key:"damage",value:function(){var e=this,t=this.state.damageValue;this.setState({damageValue:0},(function(){var a=[];e.props.combatants.forEach((function(n){var r,s,i,o=null!==(r=e.state.damageMultipliers[n.id])&&void 0!==r?r:1,c=null!==(s=n.hpCurrent)&&void 0!==s?s:0,l=null!==(i=n.hpTemp)&&void 0!==i?i:0,u=Math.floor(t*o),m=u,p=Math.min(m,l);l-=p,c-=m-=p,c=Math.max(c,0),a.push({id:n.id,hp:c,temp:l,damage:u})})),e.props.changeHP(a)}))}},{key:"getMainSection",value:function(){var e=this,t=[],a=[];if(this.props.combatants.every((function(e){return e.active}))){if(this.props.combatants.every((function(e){return e.current})))t.push(r.a.createElement("button",{key:"makeDefeated",onClick:function(){return e.props.makeDefeated(e.props.combatants)}},"mark as defeated and end turn"));else{if(1===this.props.combatants.length)!!this.props.allCombatants.find((function(t){return t.mountID===e.props.combatants[0].id}))||t.push(r.a.createElement("button",{key:"makeCurrent",onClick:function(){return e.props.makeCurrent(e.props.combatants[0])}},"start turn"));t.push(r.a.createElement("button",{key:"makeDefeated",onClick:function(){return e.props.makeDefeated(e.props.combatants)}},"mark as defeated"))}if(this.props.combatants.every((function(e){return"pc"!==e.type})))this.props.allCombatants.filter((function(e){return"pc"===e.type})).forEach((function(t){var n="engaged:"+t.displayName;a.push(r.a.createElement(R.a.CheckableTag,{key:t.id,checked:e.props.combatants.every((function(e){return e.tags.includes(n)})),onChange:function(){return e.props.toggleTag(e.props.combatants,n)}},t.displayName))}))}this.props.combatants.every((function(e){return e.defeated}))&&t.push(r.a.createElement("button",{key:"makeActive",onClick:function(){return e.props.makeActive(e.props.combatants)}},"mark as active"));var n=null;t.length>0&&(n=r.a.createElement("div",null,t,r.a.createElement("hr",null)));var s=null;return a.length>0&&(s=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"engaged with: "),a)),r.a.createElement("div",null,n,r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"quick tags: "),r.a.createElement(R.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("conc")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"conc")}},"concentrating"),r.a.createElement(R.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("bane")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"bane")}},"bane"),r.a.createElement(R.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("bless")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"bless")}},"bless"),r.a.createElement(R.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.conditions.some((function(e){return"prone"===e.name}))})),onChange:function(){return e.props.toggleCondition(e.props.combatants,"prone")}},"prone"),r.a.createElement(R.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.conditions.some((function(e){return"unconscious"===e.name}))})),onChange:function(){return e.props.toggleCondition(e.props.combatants,"unconscious")}},"unconscious"),r.a.createElement(R.a.CheckableTag,{checked:!this.props.combatants.every((function(e){return e.showOnMap})),onChange:function(){return e.props.toggleHidden(e.props.combatants)}},"hidden")),s)}},{key:"getHPSection",value:function(){var e=this;if(!this.props.combatants.every((function(e){return"monster"===e.type})))return null;var t=null;if(1===this.props.combatants.length){var a,n,s,i,o,c,l=this.props.combatants[0];t=r.a.createElement(U,{text:"current hit points"},r.a.createElement(Z,{value:null!==(a=l.hpCurrent)&&void 0!==a?a:0,label:"hp",factors:[1,10],downEnabled:(null!==(n=l.hpCurrent)&&void 0!==n?n:0)>0,upEnabled:(null!==(s=l.hpCurrent)&&void 0!==s?s:0)<(null!==(i=l.hpMax)&&void 0!==i?i:0),onNudgeValue:function(t){return e.props.nudgeValue(l,"hpCurrent",t)}}),r.a.createElement(Z,{value:null!==(o=l.hpTemp)&&void 0!==o?o:0,label:"temp hp",factors:[1,10],downEnabled:(null!==(c=l.hpTemp)&&void 0!==c?c:0)>0,onNudgeValue:function(t){return e.props.nudgeValue(l,"hpTemp",t)}}))}var u=this.props.combatants.map((function(t){var a=t,n=null,s=null,i=null,o=null;return a.damage.resist&&(n=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"resistances")," ",a.damage.resist," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.damage.vulnerable&&(s=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"vulnerabilities")," ",a.damage.vulnerable," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.damage.immune&&(i=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"immunities")," ",a.damage.immune," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.tags.includes("conc")&&(o=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},a.displayName," is ",r.a.createElement("b",null,"concentrating"),", and will need to make a check if they take damage"))),n||s||i||o?r.a.createElement(se,{key:t.id},n,s,i,o):null})),m="apply damage";if(1===this.props.combatants.length){var h=this.state.damageMultipliers[this.props.combatants[0].id];.5===h&&(m="apply half damage"),2===h&&(m="apply double damage")}var f=[{id:"half",text:"half"},{id:"normal",text:"normal"},{id:"double",text:"double"}],v=this.props.combatants.map((function(t){var a,n="normal",s=null!==(a=e.state.damageMultipliers[t.id])&&void 0!==a?a:1;s<1&&(n="half"),s>1&&(n="double");var i=r.a.createElement(ue,{options:f,selectedID:n,onSelect:function(a){var n=1;"half"===a&&(n=.5),"double"===a&&(n=2),e.setDamageMultiplier(t.id,n)}});return 1===e.props.combatants.length?r.a.createElement("div",{key:t.id},i):r.a.createElement(p.a,{key:t.id,align:"middle",justify:"center"},r.a.createElement(d.a,{span:8},r.a.createElement("div",null,t.displayName)),r.a.createElement(d.a,{span:16},i))})),g=null,b=this.props.combatants.filter((function(e){return null!=e.hpCurrent&&e.hpCurrent<=0}));if(b.length>0){var y=1===b.length&&b[0].current?"mark as defeated and end turn":"mark as defeated",E=null;this.props.combatants.length>1&&(E=r.a.createElement("ul",null,b.map((function(e){return r.a.createElement("li",{key:e.id},e.displayName)})))),g=r.a.createElement("button",{onClick:function(){return e.props.makeDefeated(b)}},y,E)}return r.a.createElement("div",null,u,r.a.createElement(Z,{value:this.state.damageValue,label:"damage",factors:[1,10],downEnabled:this.state.damageValue>0,onNudgeValue:function(t){return e.nudgeDamage(t)}}),r.a.createElement("button",{className:0===this.state.damageValue?"disabled":"",onClick:function(){return e.damage()}},m),v,g,r.a.createElement("hr",null),r.a.createElement(U,{text:"healing"},r.a.createElement(Z,{value:this.state.healingValue,label:"healing",factors:[1,10],downEnabled:this.state.healingValue>0,onNudgeValue:function(t){return e.nudgeHealing(t)}}),r.a.createElement("button",{className:0===this.state.healingValue?"disabled":"",onClick:function(){return e.heal()}},"apply healing")),t)}},{key:"getConditionSection",value:function(){var e=this,t=this.props.combatants.map((function(t){if("monster"!==t.type)return null;var a=t;return a.conditionImmunities?r.a.createElement(se,{key:t.id},r.a.createElement("b",null,"immunities")," ",a.conditionImmunities," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null):null})),a=r.a.createElement(It,{combatants:this.props.combatants,allCombatants:this.props.allCombatants,inline:this.props.inline,addCondition:function(){return e.props.addCondition(e.props.combatants)},quickAddCondition:function(t,a){return e.props.quickAddCondition(t,a)},editCondition:function(t,a){return e.props.editCondition(t,a)},removeCondition:function(t,a){return e.props.removeCondition(t,a)},nudgeConditionValue:function(t,a,n){return e.props.nudgeValue(t,a,n)}});return r.a.createElement("div",null,t,a)}},{key:"getMapSection",value:function(){var e=this;if(!this.props.map)return null;if(this.props.combatants.every((function(t){return e.props.map&&e.props.map.items.find((function(e){return e.id===t.id}))}))){var t=null,a=null;if(1===this.props.combatants.length){var n=this.props.combatants[0];t=r.a.createElement(Z,{value:n.altitude+" ft.",label:"altitude",onNudgeValue:function(t){return e.props.nudgeValue(n,"altitude",5*t)}});var s=null;if(n.aura.radius>0){s=r.a.createElement("div",null,r.a.createElement(ue,{options:[{id:"square",text:"square"},{id:"rounded",text:"rounded"},{id:"circle",text:"circle"}],selectedID:n.aura.style,onSelect:function(t){return e.props.changeValue(n.aura,"style",t)}}),r.a.createElement("input",{type:"color",value:n.aura.color,onChange:function(t){return e.props.changeValue(n.aura,"color",t.target.value)}}))}a=r.a.createElement(U,{text:"aura"},r.a.createElement(Z,{value:n.aura.radius+" ft.",label:"size",downEnabled:n.aura.radius>0,onNudgeValue:function(t){return e.props.nudgeValue(n.aura,"radius",5*t)}}),s)}return r.a.createElement("div",null,r.a.createElement(Ze,{onClick:function(t){return e.props.mapMove(e.props.combatants,t)}}),r.a.createElement("hr",null),t,a,r.a.createElement("button",{onClick:function(){return e.props.mapRemove(e.props.combatants)}},"remove from map"))}return 1===this.props.combatants.length?r.a.createElement("button",{key:"mapAdd",onClick:function(){return e.props.mapAdd(e.props.combatants[0])}},"add to map"):null}},{key:"getAdvancedSection",value:function(){var e=this,t=null;this.props.removeCombatants&&this.props.combatants.every((function(e){return!e.current}))&&(t=r.a.createElement(F,{text:"remove from encounter",onConfirm:function(){e.props.removeCombatants&&e.props.removeCombatants(e.props.combatants)}}));var a=null,n=null,s=null,i=null,o=null;if(1===this.props.combatants.length){var c,l=this.props.combatants[0];if(a=r.a.createElement(U,{text:"change name"},r.a.createElement(H,{text:l.displayName,onChange:function(t){return e.props.changeValue(l,"displayName",t)}})),n=r.a.createElement(U,{text:"change size"},r.a.createElement(Z,{value:l.displaySize,label:"size",downEnabled:"tiny"!==l.displaySize,upEnabled:"gargantuan"!==l.displaySize,onNudgeValue:function(t){return e.props.nudgeValue(l,"displaySize",t)}})),!l.pending)s=r.a.createElement(U,{text:"change initiative score"},r.a.createElement(Z,{value:null!==(c=l.initiative)&&void 0!==c?c:0,label:"initiative",onNudgeValue:function(t){return e.props.nudgeValue(l,"initiative",t)}}));if(i=r.a.createElement(U,{text:"change faction"},r.a.createElement(W,{options:["foe","neutral","ally"].map((function(e){return{id:e,text:e}})),selectedID:l.faction,onSelect:function(t){return e.props.changeValue(l,"faction",t)}})),!this.props.allCombatants.find((function(e){return e.mountID===l.id}))){var u=this.props.allCombatants.filter((function(e){return e.id!==l.id})).filter((function(e){return!!e.mountID})).map((function(e){return e.mountID})),m=this.props.allCombatants.filter((function(e){return e.id!==l.id})).filter((function(e){return"placeholder"!==e.type})).filter((function(e){return!e.mountID})).filter((function(e){return!u.includes(e.id)})).map((function(e){return{id:e.id,text:e.displayName}}));N.sort(m,[{field:"text",dir:"asc"}]);var p=null;p=m.length>0?r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mounted on:"),r.a.createElement(W,{options:m,selectedID:l.mountID,onSelect:function(t){return e.props.changeValue(l,"mountID",t)},onClear:function(){return e.props.changeValue(l,"mountID",null)}})):r.a.createElement(se,null,"no mounts available");var d=null;if(l.mountID){var h=["controlled","independent"].map((function(e){return{id:e,text:e}}));d=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mount is:"),r.a.createElement(ue,{options:h,selectedID:l.mountType,onSelect:function(t){return e.props.changeValue(l,"mountType",t)}}))}o=r.a.createElement(U,{text:"mounted combat"},p,d)}}var f=[];this.props.combatants.filter((function(e){return"pc"===e.type})).forEach((function(t){t.companions.filter((function(t){return!e.props.allCombatants.find((function(e){return e.id===t.id}))})).forEach((function(t){f.push(r.a.createElement("button",{key:t.id,onClick:function(){return e.props.addCompanion(t)}},"add ",t.name))}))}));var v=null;if(1===this.props.combatants.length){var g=this.props.combatants[0];v=r.a.createElement(H,{text:g.note,placeholder:"notes",multiLine:!0,onChange:function(t){return e.props.changeValue(g,"note",t)}})}return r.a.createElement("div",null,t,a,n,s,i,o,f,v)}},{key:"render",value:function(){var e=this;try{var t=["main","hp","cond","map","adv"].map((function(e){return{id:e,text:e}})),a=this.props.allCombatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""}));this.props.map&&!this.props.combatants.some((function(e){return a.includes(e.id)}))||t.splice(3,1),this.props.combatants.every((function(e){return"monster"===e.type}))||t.splice(1,1);var n=this.state.view;t.find((function(e){return e.id===n}))||(n=t[0].id);var s=null;switch(n){case"main":s=this.getMainSection();break;case"hp":s=this.getHPSection();break;case"cond":s=this.getConditionSection();break;case"map":s=this.getMapSection();break;case"adv":s=this.getAdvancedSection()}return r.a.createElement("div",null,r.a.createElement(ct,{options:t,selectedID:n,onSelect:function(t){return e.setView(t)}}),s)}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Tt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={externalWindow:null,containerElement:null},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=window.open("","","width=800, height=500, left=200, top=200"),a=null;t&&((a=t.document.createElement("div")).className="dojo popout",t.document.body.appendChild(a),Array.from(document.styleSheets).forEach((function(e){var a=e;if(e.href){var n=document.createElement("link");n.rel="stylesheet",n.href=e.href,t.document.head.appendChild(n)}else if(a&&a.cssRules&&a.cssRules.length>0){var r=document.createElement("style");Array.from(a.cssRules).forEach((function(e){r.appendChild(document.createTextNode(e.cssText))})),t.document.head.appendChild(r)}})),t.document.title=this.props.title,t.addEventListener("beforeunload",(function(){e.props.onCloseWindow()})));this.setState({externalWindow:t,containerElement:a})}},{key:"componentWillUnmount",value:function(){this.state.externalWindow&&this.state.externalWindow.close()}},{key:"render",value:function(){try{return this.state.containerElement?i.a.createPortal(this.props.children,this.state.containerElement):null}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Vt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={map:e.map,playerViewOpen:!1,editFog:!1,selectedCombatantIDs:[],fog:e.fog,partyID:e.partyID,combatants:e.combatants},n}return Object(l.a)(a,[{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"toggleEditFog",value:function(){this.setState({editFog:!this.state.editFog,selectedCombatantIDs:[]})}},{key:"setSelectedCombatantIDs",value:function(e){this.setState({editFog:!(e.length>0)&&this.state.editFog,selectedCombatantIDs:e})}},{key:"toggleFog",value:function(e,t,a,n){for(var r=this,s=function(e){for(var a=function(t){var a=r.state.fog.findIndex((function(a){return a.x===e&&a.y===t}));-1===a?r.state.fog.push({x:e,y:t}):r.state.fog.splice(a,1)},s=t;s<=n;++s)a(s)},i=e;i<=a;++i)s(i);this.setState({fog:this.state.fog})}},{key:"rotateMap",value:function(){O.rotateMap(this.state.map),this.setState({map:this.state.map})}},{key:"setParty",value:function(e){var t=this.state.map;t.items=t.items.filter((function(e){return"pc"!==e.type&&"companion"!==e.type}));var a=[];e&&e.pcs.forEach((function(e){a.push(D.convertPCToCombatant(e))})),N.sort(a,[{field:"displayName",dir:"asc"}]),this.setState({map:this.state.map,partyID:e?e.id:null,combatants:a})}},{key:"addCompanion",value:function(e){var t=this.state.combatants;t.push(D.convertCompanionToCombatant(e)),N.sort(t,[{field:"displayName",dir:"asc"}]),this.setState({map:this.state.map,selectedCombatantIDs:[e.id],combatants:t})}},{key:"fillFog",value:function(){var e=[],t=O.mapDimensions(this.state.map);if(t){for(var a=t.minX;a<=t.maxX;++a)for(var n=t.minY;n<=t.maxY;++n)e.push({x:a,y:n});this.setState({fog:e})}}},{key:"clearFog",value:function(){this.setState({fog:[]})}},{key:"toggleItemSelection",value:function(e,t){if(e&&t){var a=this.state.selectedCombatantIDs;if(a.includes(e)){var n=a.indexOf(e);a.splice(n,1)}else a.push(e);this.setSelectedCombatantIDs(a)}else this.setSelectedCombatantIDs(e?[e]:[])}},{key:"mapMove",value:function(e,t){var a=this;e.forEach((function(e){var n=a.state.map.items.find((function(t){return t.id===e.id}));if(n)switch(t){case"N":n.y-=1;break;case"NE":n.x+=1,n.y-=1;break;case"E":n.x+=1;break;case"SE":n.x+=1,n.y+=1;break;case"S":n.y+=1;break;case"SW":n.x-=1,n.y+=1;break;case"W":n.x-=1;break;case"NW":n.x-=1,n.y-=1}})),this.setState({map:this.state.map})}},{key:"mapRemove",value:function(e){var t=this;e.forEach((function(e){var a=t.state.map.items.find((function(t){return t.id===e.id}));if(a){var n=t.state.map.items.indexOf(a);t.state.map.items.splice(n,1)}})),this.setState({map:this.state.map,selectedCombatantIDs:[]})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({map:this.state.map})}},{key:"nudgeValue",value:function(e,t,a){var n=null;switch(t){case"challenge":n=N.nudgeChallenge(e[t],a);break;case"size":case"displaySize":n=N.nudgeSize(e[t],a);break;default:n=e[t]+a}this.changeValue(e,t,n)}},{key:"gridSquareClicked",value:function(e,t,a){var n=this,r=this.state.combatants.find((function(e){return e.id===n.state.selectedCombatantIDs[0]})),s=this.state.map.items.find((function(e){return e.id===n.state.selectedCombatantIDs[0]}));if(r&&!s){var i=C.createMapItem();i.id=r.id,i.type=r.type,i.x=e,i.y=t;var o=N.miniSize(r.displaySize);i.height=o,i.width=o,this.state.map.items.push(i),this.setState({map:this.state.map})}this.state.editFog&&!a&&this.toggleFog(e,t,e,t)}},{key:"getPlayerView",value:function(){var e=this;return this.state.playerViewOpen?r.a.createElement(Tt,{title:"Map",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("div",{className:"scrollable both-ways"},this.getMap(!0))):null}},{key:"getMap",value:function(e){var t=this,a=1===this.state.selectedCombatantIDs.length&&!this.state.map.items.find((function(e){return e.id===t.state.selectedCombatantIDs[0]})),n=null;if(e&&this.state.fog.length>0){var s=O.mapDimensions(this.state.map);if(s){for(var i=[],c=function(e){for(var a=function(a){t.state.fog.find((function(t){return t.x===e&&t.y===a}))||i.push({x:e,y:a})},n=s.minY;n<=s.maxY;++n)a(n)},l=s.minX;l<=s.maxX;++l)c(l);if(i.length>0){var u=i.map((function(e){return e.x})),m=i.map((function(e){return e.y}));n={minX:Math.min.apply(Math,Object(o.a)(u)),maxX:Math.max.apply(Math,Object(o.a)(u)),minY:Math.min.apply(Math,Object(o.a)(m)),maxY:Math.max.apply(Math,Object(o.a)(m))}}}}return r.a.createElement(ke,{map:this.state.map,mode:e?"combat-player":"combat",viewport:n,combatants:this.state.combatants,showGrid:(a||this.state.editFog)&&!e,selectedItemIDs:this.state.selectedCombatantIDs,fog:this.state.fog,gridSquareClicked:function(a,n){return t.gridSquareClicked(a,n,e)},gridRectangleSelected:function(e,a,n,r){return t.toggleFog(e,a,n,r)},itemSelected:function(e,a){return t.toggleItemSelection(e,a)}})}},{key:"render",value:function(){var e=this;try{var t=null,a=this.state.combatants.filter((function(t){return e.state.selectedCombatantIDs.includes(t.id)})),n=this.state.map.items.filter((function(t){return e.state.selectedCombatantIDs.includes(t.id)}));if(a.length>0&&n.length===a.length)t=r.a.createElement("div",{className:"section"},r.a.createElement(jt,{combatants:a,allCombatants:this.state.combatants,map:this.state.map,defaultTab:"map",inline:!0,makeCurrent:function(e){return null},makeActive:function(e){return null},makeDefeated:function(e){return null},toggleTag:function(t,a){return e.props.toggleTag(t,a)},toggleCondition:function(t,a){return e.props.toggleCondition(t,a)},toggleHidden:function(t){return e.props.toggleHidden(t)},changeHP:function(e){return null},addCondition:function(e){return null},quickAddCondition:function(t,a){return e.props.quickAddCondition(t,a)},editCondition:function(e,t){return null},removeCondition:function(t,a){return e.props.removeCondition(t,a)},mapAdd:function(e){return null},mapMove:function(t,a){return e.mapMove(t,a)},mapRemove:function(t){return e.mapRemove(t)},removeCombatants:null,addCompanion:function(t){return e.addCompanion(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.setSelectedCombatantIDs([])}},r.a.createElement(St.a,{style:{fontSize:"10px"}})," back"));else{var s=null;if(this.state.combatants.length){var i=this.state.combatants.filter((function(t){return!e.state.map.items.find((function(e){return e.id===t.id}))})).map((function(t){var a=null;return e.state.selectedCombatantIDs.includes(t.id)&&(a=r.a.createElement(se,null,"click on the map to place this person")),r.a.createElement("div",{key:t.id,className:"group-panel clickable"},r.a.createElement("div",{onClick:function(){return e.setSelectedCombatantIDs([t.id])}},t.displayName),a)}));s=r.a.createElement("div",null,i,r.a.createElement(F,{text:"choose a different party",onConfirm:function(){return e.setParty(null)}}))}else s=r.a.createElement(W,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"select a party",onSelect:function(t){var a;return e.setParty(null!==(a=e.props.parties.find((function(e){return e.id===t})))&&void 0!==a?a:null)}});var o=null;this.state.editFog&&(o=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("p",null,"click on map squares to turn fog of war on and off"),r.a.createElement("p",null,"you can also click and drag to select an area")),r.a.createElement("button",{onClick:function(){return e.fillFog()}},"fill fog of war"),r.a.createElement("button",{className:0===this.state.fog.length?"disabled":"",onClick:function(){return e.clearFog()}},"clear fog of war"))),t=r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"options"),r.a.createElement("button",{onClick:function(){return e.rotateMap()}},"rotate map"),r.a.createElement("button",{onClick:function(){return e.props.startCombat(e.state.partyID,e.state.map,e.state.fog,e.state.combatants)}},"start combat")),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"fog of war"),r.a.createElement(j,{label:"edit fog of war",checked:this.state.editFog,onChecked:function(){return e.toggleEditFog()}}),o),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"pcs"),s),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"player view"),r.a.createElement(j,{label:"show player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}})))}return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{span:6,className:"scrollable sidebar sidebar-left"},t),r.a.createElement(d.a,{span:18,className:"scrollable both-ways"},this.getMap(!1)),this.getPlayerView())}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Pt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t="parties"===this.props.view?"navigator-item pcs selected":"navigator-item pcs",a="library"===this.props.view?"navigator-item monsters selected":"navigator-item monsters",n="encounters"===this.props.view?"navigator-item encounters selected":"navigator-item encounters",s="maps"===this.props.view?"navigator-item maps selected":"navigator-item maps",i="combat"===this.props.view?"navigator-item combat selected":"navigator-item combat";return r.a.createElement("div",{className:"page-footer"},r.a.createElement("div",{className:t,onClick:function(){return e.props.onSelectView("parties")}},"pcs"),r.a.createElement("div",{className:a,onClick:function(){return e.props.onSelectView("library")}},"monsters"),r.a.createElement("div",{className:n,onClick:function(){return e.props.onSelectView("encounters")}},"encounters"),r.a.createElement("div",{className:s,onClick:function(){return e.props.onSelectView("maps")}},"maps"),r.a.createElement("div",{className:i,onClick:function(){return e.props.onSelectView("combat")}},"combat"))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),At=a(225),zt=a(224),Rt=a(223),Lt=a(222),Gt=a(221),Ft=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"page-header"},r.a.createElement("div",{className:"app-title app-name"},"dojo"),r.a.createElement(At.a,{className:"tools"===this.props.sidebar?"title-bar-icon selected":"title-bar-icon",title:"tools",onClick:function(){return e.props.onSelectSidebar("tools"===e.props.sidebar?null:"tools")}}),r.a.createElement(zt.a,{className:"generators"===this.props.sidebar?"title-bar-icon selected":"title-bar-icon",title:"generators",onClick:function(){return e.props.onSelectSidebar("generators"===e.props.sidebar?null:"generators")}}),r.a.createElement(Rt.a,{className:"reference"===this.props.sidebar?"title-bar-icon selected":"title-bar-icon",title:"reference",onClick:function(){return e.props.onSelectSidebar("reference"===e.props.sidebar?null:"reference")}}),r.a.createElement(Lt.a,{className:"search"===this.props.sidebar?"title-bar-icon selected":"title-bar-icon",title:"search",onClick:function(){return e.props.onSelectSidebar("search"===e.props.sidebar?null:"search")}}),r.a.createElement(Gt.a,{className:"about"===this.props.sidebar?"title-bar-icon selected":"title-bar-icon",title:"about",onClick:function(){return e.props.onSelectSidebar("about"===e.props.sidebar?null:"about")}}))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Bt=a(220),qt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getValue",value:function(e){var t,a,n;switch(e.type){case"pc":return r.a.createElement("div",{className:"value"},"pc");case"monster":var s=null!==(t=e.hpCurrent)&&void 0!==t?t:0,i=null!==(a=e.hpMax)&&void 0!==a?a:0,o=null!==(n=e.hpTemp)&&void 0!==n?n:0,c=s.toString();return o>0&&(c+="+"+o),s<i&&(c+=" / "+i),r.a.createElement("div",{className:"value"},c," hp")}return null}},{key:"render",value:function(){var e=this;try{var t=null;this.props.combat.map&&(t=r.a.createElement("div",{className:"section"},r.a.createElement(ke,{map:this.props.combat.map,combatants:this.props.combat.combatants})));var a=this.props.combat.combatants.filter((function(e){return e.active})).filter((function(e){return"placeholder"!==e.type})).map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)}},r.a.createElement(ee,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},t.displayName),e.getValue(t))}));return r.a.createElement("div",{className:"card combat"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.combat.name||"unnamed combat")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement("div",{className:"section"},"paused at round ",this.props.combat.round),t,r.a.createElement("div",{className:"subheading"},"initiative order"),a),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.resume(e.props.combat)}},"resume combat"),r.a.createElement(F,{text:"delete combat",onConfirm:function(){return e.props.delete(e.props.combat)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ht=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{if(!this.props.hasPCs||!this.props.hasMonsters)return r.a.createElement(p.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement(d.a,{xs:20,sm:18,md:16,lg:12,xl:10},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"this screen is for running combat encounters, but before you can do that you need to do these things first:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("span",{className:this.props.hasPCs?"strikethrough":""},"define a party of pcs in the ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.setView("parties")}},"pcs screen")),this.props.hasPCs?r.a.createElement(Bt.a,{title:"done",style:{marginLeft:"5px"}}):null),r.a.createElement("li",null,r.a.createElement("span",{className:this.props.hasMonsters?"strikethrough":""},"add some monsters in the ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.setView("library")}},"monsters screen")),this.props.hasMonsters?r.a.createElement(Bt.a,{title:"done",style:{marginLeft:"5px"}}):null)),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"you probably want to design your encounter in the ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.setView("encounters")}},"encounters screen"),", but you don't have to (you can generate a random encounter here instead)"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"if you want to use a tactical map, you can either build one in the ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.setView("maps")}},"maps screen"),", or you can generate a random one here"))));var t=this.props.combats;N.sort(t);var a=t.map((function(t){return r.a.createElement(qt,{key:t.id,combat:t,resume:function(t){return e.props.resumeCombat(t)},delete:function(t){return e.props.deleteCombat(t)},openStatBlock:function(t){return e.props.openStatBlock(t)}})}));return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"here you can run a combat encounter by specifying a party and an encounter, and optionally a tactical map"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see a list of combats that you have paused"),r.a.createElement("div",{className:"section"},"you can resume a paused combat by selecting it"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start a combat encounter, press the ",r.a.createElement("b",null,"start a new combat")," button")),r.a.createElement("button",{onClick:function(){return e.props.createCombat()}},"start a new combat")),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(He,{heading:"combats",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Wt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:"position"},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"getPositionSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement(Ze,{onClick:function(t){return e.props.move(e.props.item,t)}}),r.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},r.a.createElement(Z,{value:this.props.item.width+" sq",label:"width",downEnabled:this.props.item.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"width",t)}}),r.a.createElement(Z,{value:this.props.item.height+" sq",label:"height",downEnabled:this.props.item.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"height",t)}}))))}},{key:"getStyleSection",value:function(){var e=this,t=["overlay","token"].map((function(e){return{id:e,text:e}})),a=["square","rounded","circle"].map((function(e){return{id:e,text:e}}));return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"type"),r.a.createElement(ue,{options:t,selectedID:this.props.item.type,onSelect:function(t){return e.props.changeValue(e.props.item,"type",t)}}),r.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"shape"),r.a.createElement(ue,{options:a,selectedID:this.props.item.style,onSelect:function(t){return e.props.changeValue(e.props.item,"style",t)}}),r.a.createElement("div",{className:"subheading"},"color"),r.a.createElement("input",{type:"color",value:this.props.item.color,onChange:function(t){return e.props.changeValue(e.props.item,"color",t.target.value)}}),r.a.createElement("div",{className:"subheading"},"opacity"),r.a.createElement(P.a,{min:0,max:255,value:this.props.item.opacity,tooltipVisible:!1,onChange:function(t){return e.props.changeValue(e.props.item,"opacity",t)}})),r.a.createElement("div",{style:{display:"token"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(Z,{value:this.props.item.size,downEnabled:"tiny"!==this.props.item.size,upEnabled:"gargantuan"!==this.props.item.size,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"size",t)}})))}},{key:"getNotesSection",value:function(){var e=this;return this.props.note?r.a.createElement("div",null,r.a.createElement(H,{text:this.props.note.text,placeholder:"details",multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.note,"text",t)}}),r.a.createElement("button",{onClick:function(){return e.props.removeNote(e.props.item.id)}},"remove note")):r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addNote(e.props.item.id)}},"add a note"))}},{key:"render",value:function(){var e=this;try{var t=["position","style","notes"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"position":a=this.getPositionSection();break;case"style":a=this.getStyleSection();break;case"notes":a=this.getNotesSection()}return r.a.createElement("div",{className:"card map",key:"selected"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map item")),r.a.createElement("div",{className:"card-content"},r.a.createElement(ue,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),r.a.createElement("hr",null),a,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.remove(e.props.item)}},"remove from the map"))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),_t=a(219),Jt=new re.a.Converter;Jt.setOption("tables",!0);var Yt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getInformationTag",value:function(){return this.props.combatant.current?r.a.createElement(R.a,{className:"info"},"current turn"):this.props.selected?r.a.createElement(R.a,{className:"info"},"selected"):null}},{key:"onClick",value:function(e){e.stopPropagation(),this.props.select&&this.props.select(this.props.combatant,e.ctrlKey)}},{key:"getContent",value:function(){var e=this,t=[];if("monster"===this.props.combatant.type&&!this.props.minimal){var a,n,s=this.props.combatant,i=(null!==(a=this.props.combatant.hpCurrent)&&void 0!==a?a:0).toString();(null!==(n=this.props.combatant.hpTemp)&&void 0!==n?n:0)>0&&(i+="+"+this.props.combatant.hpTemp),t.push(r.a.createElement("div",{key:"stats"},r.a.createElement(p.a,{align:"middle"},r.a.createElement(d.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-label"},"ac"),r.a.createElement("div",{className:"statistic-value"},s.ac))),r.a.createElement(d.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-value"},i),r.a.createElement("div",{className:"statistic-label"},"hp")))),r.a.createElement(ye,{combatant:this.props.combatant})))}if(this.props.combatant.mountID){var o=this.props.combat.combatants.find((function(t){return t.id===e.props.combatant.mountID}));if(o){var c=r.a.createElement("button",{className:"link",onClick:function(t){t.stopPropagation(),e.props.select(o,!1)}},o.displayName),l=null;"controlled"===this.props.combatant.mountType&&(l=r.a.createElement("div",{className:"note-details"},"your mount moves as directed; it can only take dash, disengage, or dodge actions")),t.push(r.a.createElement(se,{key:"mount"},r.a.createElement("div",null," mounted on: ",c),l,r.a.createElement("div",{className:"note-details"},"if you\u2019re knocked prone, or an effect moves your mount against its will, you must succeed on a dex save (dc 10) or land prone in a space within 5 feet of your mount"),r.a.createElement("div",{className:"note-details"},"if your mount is knocked prone, you can use your reaction to land on your feet; otherwise, you fall prone in a space within 5 feet of your mount")))}}var u=this.props.combat.combatants.find((function(t){return t.mountID===e.props.combatant.id}));if(u){var m=r.a.createElement("button",{className:"link",onClick:function(t){t.stopPropagation(),e.props.select(u,!1)}},u.displayName);t.push(r.a.createElement(se,{key:"rider"},r.a.createElement("div",null,"ridden by: ",m)))}var h=[];return this.props.combatant.tags.filter((function(e){return e.startsWith("engaged")})).forEach((function(e){h.push(N.getTagDescription(e))})),h.length>0&&t.push(r.a.createElement(se,{key:"engaged"},r.a.createElement("div",null,"engaged with: ",h.join(", ")))),this.props.combatant.tags.filter((function(e){return!e.startsWith("engaged")})).forEach((function(e){t.push(r.a.createElement(se,{key:e},r.a.createElement("div",{className:"note-heading"},N.getTagTitle(e)),r.a.createElement("div",{className:"note-details"},N.getTagDescription(e))))})),this.props.combat.map&&!this.props.combat.map.items.find((function(t){return t.id===e.props.combatant.id}))&&t.push(r.a.createElement(se,{key:"not-on-map"},r.a.createElement("span",null,"not on the map"),r.a.createElement(_t.a,{className:"icon-button",onClick:function(){return e.props.addToMap(e.props.combatant)}}))),this.props.combatant.showOnMap||t.push(r.a.createElement(se,{key:"hidden"},"hidden")),this.props.combatant.conditions&&this.props.combatant.conditions.forEach((function(a){var n=a.name;"exhaustion"===a.name&&(n+=" ("+a.level+")"),a.duration&&(n+=" "+N.conditionDurationText(a,e.props.combat.combatants));for(var s=[],i=N.conditionText(a),o=0;o!==i.length;++o)s.push(r.a.createElement("div",{key:o,className:"note-details"},i[o]));t.push(r.a.createElement(se,{key:a.id},r.a.createElement("div",{className:"note-heading"},n),s))})),this.props.combatant.note&&t.push(r.a.createElement(se,{key:"text"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Jt.makeHtml(this.props.combatant.note)}}))),t}},{key:"render",value:function(){var e=this;try{var t="initiative-list-item clickable "+this.props.combatant.type;this.props.combatant.current&&(t+=" current"),this.props.selected&&(t+=" highlight"),this.props.combatant.defeated&&(t+=" defeated");var a=null,n=this.props.combatant;return n.portrait&&(a=r.a.createElement(ee,{source:n,inline:!0})),r.a.createElement("div",{className:t,onClick:function(t){return e.onClick(t)}},r.a.createElement("div",{className:"header"},a,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant"),this.getInformationTag()),r.a.createElement("div",{className:"init-entry-content"},this.getContent()))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ut=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"makeActive",value:function(e){e.stopPropagation(),this.props.makeActive(this.props.combatant)}},{key:"render",value:function(){var e=this;try{var t,a=null,n=this.props.combatant;return n.portrait&&(a=r.a.createElement(ee,{source:n,inline:!0})),r.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},r.a.createElement("div",{className:"header"},a,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),r.a.createElement("div",{className:"init-entry-content"},r.a.createElement(Z,{value:null!==(t=this.props.combatant.initiative)&&void 0!==t?t:10,onNudgeValue:function(t){return e.props.nudgeValue(e.props.combatant,"initiative",t)}}),r.a.createElement("button",{onClick:function(t){return e.makeActive(t)}},"add to encounter")))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Xt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=null,a=this.props.combatant;return a.portrait&&(t=r.a.createElement(ee,{source:a,inline:!0})),r.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},r.a.createElement("div",{className:"header"},t,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),r.a.createElement("div",{className:"init-entry-content"},r.a.createElement("button",{onClick:function(){return e.props.addToMap()}},"place on map")))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Kt=new re.a.Converter;Kt.setOption("tables",!0);var Zt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={showDefeatedCombatants:!1,showRollButtons:!1,selectedItemIDs:[],addingToMapID:null,addingOverlay:!1,addingFog:!1,playerView:{open:!1,showControls:!1},middleColumnWidth:8},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("beforeunload",(function(){e.setPlayerViewOpen(!1)}))}},{key:"toggleShowDefeatedCombatants",value:function(){this.setState({showDefeatedCombatants:!this.state.showDefeatedCombatants})}},{key:"toggleShowRollButtons",value:function(){this.setState({showRollButtons:!this.state.showRollButtons})}},{key:"setSelectedItemIDs",value:function(e){this.setState({selectedItemIDs:e})}},{key:"toggleItemSelection",value:function(e,t){if(e&&t){var a=this.state.selectedItemIDs;if(a.includes(e)){var n=a.indexOf(e);a.splice(n,1)}else a.push(e);this.setSelectedItemIDs(a)}else this.setSelectedItemIDs(e?[e]:[])}},{key:"setAddingToMapID",value:function(e){this.setState({addingToMapID:e,addingOverlay:!1,addingFog:!1})}},{key:"toggleAddingOverlay",value:function(){this.setState({addingOverlay:!this.state.addingOverlay,addingToMapID:null,addingFog:!1})}},{key:"toggleAddingFog",value:function(){this.setState({addingOverlay:!1,addingToMapID:null,addingFog:!this.state.addingFog})}},{key:"fillFog",value:function(){if(this.props.combat.map){var e=[],t=O.mapDimensions(this.props.combat.map);if(t){for(var a=t.minX;a<=t.maxX;++a)for(var n=t.minY;n<=t.maxY;++n)e.push({x:a,y:n});this.props.setFog(e)}}}},{key:"clearFog",value:function(){this.props.setFog([])}},{key:"setPlayerViewOpen",value:function(e){var t=this.state.playerView;t.open=e,this.setState({playerView:t})}},{key:"setPlayerViewShowControls",value:function(e){var t=this.state.playerView;t.showControls=e,this.setState({playerView:t})}},{key:"nudgeMiddleColumnWidth",value:function(e){this.setState({middleColumnWidth:this.state.middleColumnWidth+e})}},{key:"nextTurn",value:function(){var e=this,t=this.props.combat.combatants.find((function(e){return e.current}));if(t)this.props.endTurn(t);else{var a=this.props.combat.combatants.filter((function(t){return"placeholder"!==t.type||D.combatHasLairActions(e.props.combat)})).find((function(e){return e.active}));a&&this.props.makeCurrent(a)}}},{key:"defeatCombatants",value:function(e){var t=this,a=e.map((function(e){return e.id}));this.setState({selectedItemIDs:this.state.selectedItemIDs.filter((function(e){return!a.includes(e)}))},(function(){t.props.makeDefeated(e)}))}},{key:"removeCombatants",value:function(e){var t=this,a=e.map((function(e){return e.id}));this.setState({selectedItemIDs:this.state.selectedItemIDs.filter((function(e){return!a.includes(e)}))},(function(){t.props.removeCombatants(e)}))}},{key:"gridSquareClicked",value:function(e,t){var a=this;if(this.state.addingToMapID){var n=this.props.combat.combatants.find((function(e){return e.id===a.state.addingToMapID}));n&&this.props.mapAdd(n,e,t),this.setAddingToMapID(null)}if(this.state.addingOverlay){var r=C.createMapItem();r.type="overlay",r.x=e,r.y=t,r.width=1,r.height=1,r.color="#005080",r.opacity=127,r.style="square",this.props.addOverlay(r),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[r.id]})}this.state.addingFog&&this.toggleFog(e,t,e,t)}},{key:"toggleFog",value:function(e,t,a,n){for(var r=this.props.combat.fog,s=function(e){for(var a=function(t){var a=r.findIndex((function(a){return a.x===e&&a.y===t}));-1===a?r.push({x:e,y:t}):r.splice(a,1)},s=t;s<=n;++s)a(s)},i=e;i<=a;++i)s(i);this.props.setFog(r)}},{key:"orderCombatants",value:function(e){var t=e.find((function(e){return e.current}));if(t){var a=e.indexOf(t);if(0!==a){var n=Object(o.a)(e);return n.splice(a).concat(["top of the round"]).concat(n)}}return e}},{key:"getPlayerView",value:function(){var e=this;if(!this.state.playerView.open)return null;var t=this.props.combat.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),a=this.props.combat.combatants.filter((function(e){return"pc"===e.type||e.showOnMap})).filter((function(e){return!e.pending&&e.active&&!e.defeated})).filter((function(e){return!t.includes(e.id)})).filter((function(t){return"monster"!==t.type||!e.props.combat.map||!!e.props.combat.map.items.find((function(e){return e.id===t.id}))})).filter((function(t){return"placeholder"!==t.type||D.combatHasLairActions(e.props.combat)})),n=this.orderCombatants(a).map((function(t){return e.createCombatantRow(t,!0)}));if(this.props.combat.map){var s=null;if(this.props.combat.map&&this.state.playerView.showControls){var i=this.props.combat.combatants.filter((function(t){return null!==e.props.combat.map&&e.props.combat.map.items.find((function(e){return e.id===t.id}))})).filter((function(e){return e.showOnMap})).filter((function(t){return e.state.selectedItemIDs.includes(t.id)}));if(0===i.length&&(i=this.props.combat.combatants.filter((function(t){return null!==e.props.combat.map&&e.props.combat.map.items.find((function(e){return e.id===t.id}))})).filter((function(e){return e.showOnMap})).filter((function(e){return e.current}))),1===i.length){var c=i[0];s=r.a.createElement("div",null,r.a.createElement("div",{className:"heading lowercase"},c.displayName),r.a.createElement(Ze,{onClick:function(t){return e.props.mapMove([c.id],t)}}),r.a.createElement("hr",null),r.a.createElement(Z,{key:"altitude",value:c.altitude+" ft.",label:"altitude",onNudgeValue:function(t){return e.props.nudgeValue(c,"altitude",5*t)}}),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:8},r.a.createElement(j,{label:"conc.",display:"button",checked:c.tags.includes("conc"),onChecked:function(t){return e.props.toggleTag([c],"conc")}})),r.a.createElement(d.a,{span:8},r.a.createElement(j,{label:"bane",display:"button",checked:c.tags.includes("bane"),onChecked:function(t){return e.props.toggleTag([c],"bane")}})),r.a.createElement(d.a,{span:8},r.a.createElement(j,{label:"bless",display:"button",checked:c.tags.includes("bless"),onChecked:function(t){return e.props.toggleTag([c],"bless")}}))),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:8},r.a.createElement(j,{label:"prone",display:"button",checked:c.conditions.some((function(e){return"prone"===e.name})),onChecked:function(t){return e.props.toggleCondition([c],"prone")}})),r.a.createElement(d.a,{span:8},r.a.createElement(j,{label:"uncon.",display:"button",checked:c.conditions.some((function(e){return"unconscious"===e.name})),onChecked:function(t){return e.props.toggleCondition([c],"unconscious")}})),r.a.createElement(d.a,{span:8},r.a.createElement(j,{label:"hidden",display:"button",checked:!c.showOnMap,onChecked:function(t){return e.props.changeValue([c],"showOnMap",!t)}}))))}i.length>1&&(s=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"multiple items selected")))}var l=null;if(this.props.combat.fog.length>0){var u=O.mapDimensions(this.props.combat.map);if(u){for(var m=[],h=function(t){for(var a=function(a){e.props.combat.fog.find((function(e){return e.x===t&&e.y===a}))||m.push({x:t,y:a})},n=u.minY;n<=u.maxY;++n)a(n)},f=u.minX;f<=u.maxX;++f)h(f);if(m.length>0){var v=m.map((function(e){return e.x})),g=m.map((function(e){return e.y}));l={minX:Math.min.apply(Math,Object(o.a)(v)),maxX:Math.max.apply(Math,Object(o.a)(v)),minY:Math.min.apply(Math,Object(o.a)(g)),maxY:Math.max.apply(Math,Object(o.a)(g))}}}}return r.a.createElement(Tt,{title:"Encounter",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:24,sm:24,md:12,lg:16,xl:18,className:"scrollable both-ways"},r.a.createElement(ke,{key:"map",map:this.props.combat.map,mode:"combat-player",viewport:l,combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,itemSelected:function(t,a){return e.toggleItemSelection(t,a)}})),r.a.createElement(d.a,{xs:24,sm:24,md:12,lg:8,xl:6,className:"scrollable"},s,r.a.createElement("div",{className:"heading fixed-top"},"initiative order"),n)))}return r.a.createElement(Tt,{title:"Encounter",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("div",{className:"scrollable"},r.a.createElement("div",{className:"heading"},"initiative order"),n))}},{key:"getMenu",value:function(){var e=this,t=null;this.props.combat.encounter.notes&&(t=r.a.createElement(U,{text:"encounter notes"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Kt.makeHtml(this.props.combat.encounter.notes)}})));var a=null;this.props.combat.map&&(a=r.a.createElement(F,{text:"end combat and open map",onConfirm:function(){return e.props.endCombat(!0)}}));var n=[];this.props.combat.combatants.filter((function(e){return"pc"===e.type})).forEach((function(t){var a=e.props.parties.find((function(e){return e.pcs.find((function(e){return e.id===t.id}))}));a&&!n.includes(a)&&n.push(a)}));var s=[];n.forEach((function(t){t.pcs.forEach((function(a){e.props.combat.combatants.find((function(e){return e.id===a.id}))||s.push(r.a.createElement("button",{key:a.id,onClick:function(){return e.props.addPC(t.id,a.id)}},a.name," (",t.name,")"))}))}));var i=null;s.length>0&&(i=r.a.createElement(U,{text:"add pcs"},s));var o=null;this.props.combat.encounter&&this.props.combat.encounter.waves.length>0&&(o=r.a.createElement("button",{onClick:function(){return e.props.addWave()}},"add wave"));var c=null;return this.props.combat.map&&this.state.playerView.open&&(c=r.a.createElement("div",null,r.a.createElement(j,{label:"show map controls",checked:this.state.playerView.showControls,onChecked:function(t){return e.setPlayerViewShowControls(t)}}))),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"encounter"),t,r.a.createElement("button",{onClick:function(){return e.props.pauseCombat()}},"pause combat"),r.a.createElement(F,{text:"end combat",onConfirm:function(){return e.props.endCombat(!1)}}),a,r.a.createElement("div",{className:"subheading"},"leaderboard"),r.a.createElement("button",{onClick:function(){return e.props.showLeaderboard()}},"show leaderboard"),r.a.createElement("div",{className:"subheading"},"combatants"),r.a.createElement("button",{onClick:function(){return e.props.addCombatants()}},"add combatants"),i,o,r.a.createElement("button",{onClick:function(){return e.props.addCompanion(null)}},"add a companion"),r.a.createElement("div",{className:"subheading"},"player view"),r.a.createElement(j,{label:"show player view",checked:this.state.playerView.open,onChecked:function(t){return e.setPlayerViewOpen(t)}}),c,r.a.createElement("div",{className:"subheading"},"layout"),r.a.createElement(j,{label:"show defeated combatants",checked:this.state.showDefeatedCombatants,onChecked:function(){return e.toggleShowDefeatedCombatants()}}),r.a.createElement(j,{label:"show monster die rolls",checked:this.state.showRollButtons,onChecked:function(){return e.toggleShowRollButtons()}}),r.a.createElement(Z,{value:"middle column size",downEnabled:this.state.middleColumnWidth>4,upEnabled:this.state.middleColumnWidth<14,onNudgeValue:function(t){return e.nudgeMiddleColumnWidth(2*t)}}))}},{key:"getSelectedCombatant",value:function(){var e=this,t=this.state.selectedItemIDs.map((function(t){return e.props.combat.combatants.find((function(e){return e.id===t}))})).filter((function(e){return!!e}));N.sort(t,[{field:"displayName",dir:"asc"}]);var a=t.filter((function(e){return"placeholder"===e.type}));if(a.length>0)return r.a.createElement("div",null,this.createCard(a[0]));if(t.length>0&&t.every((function(e){return e.current})))return r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"you've selected the current initiative holder"));if(1===t.length)return r.a.createElement("div",null,this.createControls(t),r.a.createElement("hr",null),this.createCard(t[0]));if(t.length>1)return r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"multiple combatants are selected:"),t.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},t.displayName,r.a.createElement(T.a,{style:{float:"right",padding:"2px 0",fontSize:"14px"},onClick:function(){return e.toggleItemSelection(t.id,!0)}}))}))),this.createControls(t));if(this.props.combat.map){var n=this.props.combat.map.items.find((function(t){return t.id===e.state.selectedItemIDs[0]}));if(n)return r.a.createElement(Wt,{item:n,note:O.getNote(this.props.combat.map,n),move:function(t,a){return e.props.mapMove([t.id],a)},remove:function(t){return e.props.mapRemove([t.id])},addNote:function(t){return e.props.mapAddNote(t)},removeNote:function(t){return e.props.mapRemoveNote(t)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.props.nudgeValue(t,a,n)}})}return r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"select a pc or monster from the ",r.a.createElement("b",null,"initiative order")," list (in the middle column) to see its details here"))}},{key:"createCombatantRow",value:function(e,t){var a=this;if("string"===typeof e)return r.a.createElement("div",{key:e,className:"section init-separator"},e);var n=this.state.selectedItemIDs.includes(e.id);return t&&!this.props.combat.map&&(n=!1),r.a.createElement(Yt,{key:e.id,combatant:e,combat:this.props.combat,selected:n,minimal:t,select:function(e,t){return a.toggleItemSelection(e.id,t)},addToMap:function(e){return a.setAddingToMapID(a.state.addingToMapID?null:e.id)},nudgeValue:function(e,t,n){return a.props.nudgeValue(e,t,n)},makeActive:function(e){return a.props.makeActive([e])}})}},{key:"createControls",value:function(e){var t=this;return e.some((function(e){return"placeholder"===e.type}))?null:r.a.createElement(jt,{combatants:e,allCombatants:this.props.combat.combatants,map:this.props.combat.map,defaultTab:"main",inline:!1,makeCurrent:function(e){return t.props.makeCurrent(e)},makeActive:function(e){return t.props.makeActive(e)},makeDefeated:function(e){return t.defeatCombatants(e)},toggleTag:function(e,a){return t.props.toggleTag(e,a)},toggleCondition:function(e,a){return t.props.toggleCondition(e,a)},toggleHidden:function(e){return t.props.toggleHidden(e)},changeHP:function(e){return t.props.changeHP(e)},addCondition:function(e){return t.props.addCondition(e)},quickAddCondition:function(e,t){return null},editCondition:function(e,a){return t.props.editCondition(e,a)},removeCondition:function(e,a){return t.props.removeCondition(e,a)},mapAdd:function(e){return t.setAddingToMapID(t.state.addingToMapID?null:e.id)},mapMove:function(e,a){return t.props.mapMove(e.map((function(e){return e.id})),a)},mapRemove:function(e){return t.props.mapRemove(e.map((function(e){return e.id})))},removeCombatants:function(e){return t.removeCombatants(e)},addCompanion:function(e){return t.props.addCompanion(e)},changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeValue:function(e,a,n){return t.props.nudgeValue(e,a,n)}})}},{key:"createCard",value:function(e){var t=this;switch(e.type){case"pc":return r.a.createElement(We,{pc:e,mode:"combat",changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeValue:function(e,a,n){return t.props.nudgeValue(e,a,n)}});case"monster":return r.a.createElement(le,{monster:e,mode:"combat",showRollButtons:this.state.showRollButtons,useTrait:function(a){return t.props.useTrait(e,a)},rechargeTrait:function(a){return t.props.rechargeTrait(e,a)},onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}});case"companion":var a=null,n=e;return n.monsterID&&this.props.library.forEach((function(e){var s=e.monsters.find((function(e){return e.id===n.monsterID}));s&&(a=r.a.createElement(le,{monster:s,showRollButtons:t.state.showRollButtons,onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}}))})),a;case"placeholder":var s=[];return this.props.combat.combatants.forEach((function(e){var a=e;a&&a.traits&&a.traits.some((function(e){return"lair"===e.type}))&&s.push(r.a.createElement("div",{className:"card monster",key:"lair "+a.id},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},a.name)),r.a.createElement("div",{className:"card-content"},r.a.createElement(oe,{combatant:a,mode:"lair",useTrait:function(e){return t.props.useTrait(a,e)},rechargeTrait:function(e){return t.props.rechargeTrait(a,e)}}))))})),s}return null}},{key:"render",value:function(){var e=this;try{var t=this.props.combat.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),a=null,n=[],s=[];this.props.combat.combatants.filter((function(e){return!t.includes(e.id)})).forEach((function(t){t.pending?n.push(r.a.createElement(Ut,{key:t.id,combatant:t,nudgeValue:function(t,a,n){return e.props.nudgeValue(t,a,n)},makeActive:function(t){return e.props.makeActive([t])}})):(t.current&&(a=r.a.createElement("div",null,e.createControls([t]),r.a.createElement("hr",null),e.createCard(t))),(t.active||t.defeated&&e.state.showDefeatedCombatants)&&s.push(t))})),0!==n.length&&n.unshift(r.a.createElement(se,{key:"pending-help"},r.a.createElement("div",{className:"section"},"these combatants are not yet part of the encounter"),r.a.createElement("div",{className:"section"},"set initiative on each of them, then add them to the encounter")));var i=s.filter((function(t){return"placeholder"!==t.type||D.combatHasLairActions(e.props.combat)})),o=this.orderCombatants(i).map((function(t){return e.createCombatantRow(t,!1)})),c=null;if(!a&&this.props.combat.map){var l=i.filter((function(t){return e.props.combat.map&&!e.props.combat.map.items.find((function(e){return e.id===t.id}))})).map((function(t){return r.a.createElement(Xt,{key:t.id,combatant:t,addToMap:function(){return e.setAddingToMapID(t.id)}})}));l.length>0&&(c=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"these combatants have not yet been placed on the map (which you'll find in the middle column)"),r.a.createElement("div",{className:"section"},"to place one on the map, click the ",r.a.createElement("b",null,"place on map")," button and then click on a map square")),l))}a||(o.unshift(r.a.createElement(se,{key:"init-help"},r.a.createElement("div",{className:"section"},"these are the combatants taking part in this encounter; you can select them to see their stat blocks (on the right)"),r.a.createElement("div",{className:"section"},"they are listed in initiative order (with the highest initiative score at the top of the list, and the lowest at the bottom)"))),a=r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"when you're ready to begin the encounter, press the ",r.a.createElement("b",null,"start combat")," button (above)"),r.a.createElement("div",{className:"section"},"the current initiative holder will be displayed here")));var u=null;this.props.combat.notifications.length>0&&(u=r.a.createElement("div",{className:"notifications"},this.props.combat.notifications.map((function(t){return r.a.createElement(Qt,{key:t.id,notification:t,close:function(t,a){return e.props.closeNotification(t,a)}})}))));var m=null;this.props.combat.map&&(m=r.a.createElement(ke,{key:"map",map:this.props.combat.map,mode:"combat",showGrid:null!==this.state.addingToMapID||this.state.addingOverlay||this.state.addingFog,combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,itemSelected:function(t,a){return e.toggleItemSelection(t,a)},gridSquareClicked:function(t,a){return e.gridSquareClicked(t,a)},gridRectangleSelected:function(t,a,n,r){return e.toggleFog(t,a,n,r)}}));var h=[];this.props.combat.combatants.filter((function(e){return!e.pending&&e.active&&!e.defeated})).forEach((function(t){var a=t;a&&a.traits&&a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&!a.current&&h.push(r.a.createElement("div",{className:"card monster",key:"leg "+a.id},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},a.name)),r.a.createElement("div",{className:"card-content"},r.a.createElement(oe,{combatant:a,mode:"legendary",useTrait:function(t){return e.props.useTrait(a,t)},rechargeTrait:function(t){return e.props.rechargeTrait(a,t)}}))))}));var f=this.state.middleColumnWidth,v=(24-f)/2;return r.a.createElement("div",{className:"full-height"},r.a.createElement(p.a,{align:"middle",className:"combat-top-row"},r.a.createElement(d.a,{span:v},r.a.createElement("div",{className:"action"},r.a.createElement("button",{onClick:function(){return e.nextTurn()}},this.props.combat.combatants.find((function(e){return e.current}))?"next turn":"start combat"))),r.a.createElement(d.a,{span:f},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-label"},"round"),r.a.createElement("div",{className:"statistic-value"},this.props.combat.round))),r.a.createElement(d.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-value"},D.getCombatXP(this.props.combat)),r.a.createElement("div",{className:"statistic-label"},"xp"))))),r.a.createElement(d.a,{span:v},r.a.createElement("div",{className:"menu"},r.a.createElement(G.a,{content:this.getMenu(),trigger:"click",placement:"bottomRight"},r.a.createElement(st.a,{title:"menu"}))))),r.a.createElement(p.a,{className:"combat-main"},r.a.createElement(d.a,{span:v,className:"scrollable"},r.a.createElement(He,{heading:"initiative holder",content:[a],columns:1,showToggle:!1})),r.a.createElement(d.a,{span:f,className:"scrollable"},u,r.a.createElement(He,{heading:"waiting for intiative",content:n,columns:1,showToggle:!0}),r.a.createElement(He,{heading:"legendary actions",content:h,columns:1,showToggle:!0}),r.a.createElement(He,{heading:"encounter map",content:[m],columns:1,showToggle:!0,controls:r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.scatterCombatants("monster")}},"scatter monsters"),r.a.createElement("button",{onClick:function(){return e.props.scatterCombatants("pc")}},"scatter pcs"),r.a.createElement(j,{label:this.state.addingOverlay?"click on the map to add the item, or click here to cancel":"add token / overlay",display:"button",checked:this.state.addingOverlay,onChecked:function(){return e.toggleAddingOverlay()}}),r.a.createElement(j,{label:"edit fog of war",checked:this.state.addingFog,onChecked:function(){return e.toggleAddingFog()}}),r.a.createElement("div",{style:{display:this.state.addingFog?"":"none"}},r.a.createElement("button",{onClick:function(){return e.fillFog()}},"fill fog of war"),r.a.createElement("button",{className:0===this.props.combat.fog.length?"disabled":"",onClick:function(){return e.clearFog()}},"clear fog of war")))}),r.a.createElement(He,{heading:"initiative order",content:o,columns:1,showToggle:!0})),r.a.createElement(d.a,{span:v,className:"scrollable"},r.a.createElement(He,{heading:"not on the map",content:[c],columns:1,showToggle:!0}),r.a.createElement(He,{heading:"selected combatant",content:[this.getSelectedCombatant()],columns:1}))),this.getPlayerView())}catch(g){return console.error(g),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Qt=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"success",value:function(){switch(this.props.notification.type){case"condition-save":case"condition-end":var e=this.props.notification.data;e.duration&&("saves"!==e.duration.type&&"rounds"!==e.duration.type||(e.duration.count-=1,0===e.duration.count?this.close(!0):this.close()));break;case"trait-recharge":this.props.notification.data.uses=0,this.close()}}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.close(this.props.notification,e)}},{key:"render",value:function(){var e=this;try{var t=this.props.notification.combatant,a=this.props.notification.data,n=this.props.notification.data,s=t.displayName||t.name||"unnamed monster";switch(this.props.notification.type){case"condition-save":var i=a.duration,o=i.saveType.toString();return"death"!==o&&(o=o.toUpperCase()),r.a.createElement("div",{key:this.props.notification.id,className:"descriptive"},r.a.createElement("div",{className:"text"},s," must make a ",o," save against dc ",i.saveDC),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{key:"success",onClick:function(){return e.success()}},"success")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{key:"close",onClick:function(){return e.close()}},"close"))));case"condition-end":return r.a.createElement("div",{key:this.props.notification.id,className:"descriptive"},r.a.createElement("div",{className:"text"},s," is no longer affected by condition ",a.name),r.a.createElement("button",{onClick:function(){return e.close()}},"close"));case"trait-recharge":return r.a.createElement("div",{key:this.props.notification.id,className:"descriptive"},r.a.createElement("div",{className:"text"},s," can attempt to recharge ",n.name," (",n.usage,")"),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{key:"recharge",onClick:function(){return e.success()}},"recharge")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{key:"close",onClick:function(){return e.close()}},"close"))));default:return null}}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),$t=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getText",value:function(e){return r.a.createElement("div",{className:"name"},e.monsterName||e.roles.join(", ")||"unnamed monster")}},{key:"getValue",value:function(e){return e.count>1?r.a.createElement("div",{className:"value"},"x",e.count):null}},{key:"getPortrait",value:function(e){var t=this.props.getMonster(e.monsterName,e.monsterGroupName);return t&&t.portrait?r.a.createElement(ee,{source:t,inline:!0}):null}},{key:"render",value:function(){var e=this;try{var t=this.props.encounter.slots.map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)}},e.getPortrait(t),e.getText(t),e.getValue(t))}));0===t.length&&t.push(r.a.createElement("div",{key:"empty",className:"section"},"no monsters")),this.props.encounter.waves.forEach((function(a){t.push(r.a.createElement("div",{key:"name "+a.id,className:"section subheading"},a.name||"unnamed wave")),a.slots.forEach((function(a){t.push(r.a.createElement("div",{key:a.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(a)}},e.getPortrait(a),e.getValue(a)))})),0===t.length&&t.push(r.a.createElement("div",{key:"empty "+a.id,className:"section"},"no monsters"))}));var a=null;if(this.props.parties.length>0){var n=this.props.parties.map((function(e){return{id:e.id,text:e.name}}));a=r.a.createElement(W,{options:n,placeholder:"start combat with...",onSelect:function(t){return e.props.run(e.props.encounter,t)}})}return r.a.createElement("div",{className:"card encounter"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.encounter.name||"unnamed encounter")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement("div",{className:"subheading"},"monsters"),t,r.a.createElement("div",{className:"subheading"},"xp"),D.getEncounterXP(this.props.encounter,this.props.getMonster)),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.view(e.props.encounter)}},"open encounter"),r.a.createElement("button",{onClick:function(){return e.props.edit(e.props.encounter)}},"edit encounter"),a,r.a.createElement(F,{text:"delete encounter",onConfirm:function(){return e.props.delete(e.props.encounter)}})))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ea=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"openStatBlock",value:function(e){var t=this.props.getMonster(e.monsterName,e.monsterGroupName);t&&this.props.openStatBlock(t)}},{key:"render",value:function(){var e=this;try{if(!this.props.hasMonsters)return r.a.createElement(p.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement(d.a,{xs:20,sm:18,md:16,lg:12,xl:10},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"this screen is for building encounters, but before you can do that you need to do these things first:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("span",{className:this.props.hasMonsters?"strikethrough":""},"add some monsters in the ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.setView("library")}},"monsters screen")),this.props.hasMonsters?r.a.createElement(Bt.a,{title:"done",style:{marginLeft:"5px"}}):null)))));var t=this.props.encounters;N.sort(t);var a=t.map((function(t){return r.a.createElement($t,{key:t.id,encounter:t,parties:e.props.parties,view:function(t){return e.props.viewEncounter(t)},edit:function(t){return e.props.editEncounter(t)},delete:function(t){return e.props.deleteEncounter(t)},run:function(t,a){return e.props.runEncounter(t,a)},openStatBlock:function(t){return e.openStatBlock(t)},getMonster:function(t,a){return e.props.getMonster(t,a)}})}));return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"on this page you can set up encounters"),r.a.createElement("div",{className:"section"},"when you have created an encounter you can add monsters to it, then gauge its difficulty for a party of pcs"),r.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can then run the encounter in the combat manager"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see a list of encounters that you have created"),r.a.createElement("div",{className:"section"},"select an encounter from the list to add monsters to it"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start building an encounter, press the ",r.a.createElement("b",null,"create a new encounter")," button")),r.a.createElement("button",{onClick:function(){return e.props.addEncounter(null)}},"create a new encounter"),r.a.createElement(U,{text:"use an encounter template"},r.a.createElement(Ae,{items:D.encounterTemplates().map((function(e){return{id:e.name,text:e.name}})),selectedItemID:null,onSelect:function(t){return e.props.addEncounter(t)}}))),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(He,{heading:"encounters",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ta=new re.a.Converter;ta.setOption("tables",!0);var aa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getSlots",value:function(e,t,a){var n=this,s=a.filter((function(e){return""!==e.monsterName}));return 0===s.length?r.a.createElement(se,null,"no monsters"):r.a.createElement(He,{key:e,heading:t,columns:2,content:s.map((function(e){var t=n.props.getMonster(e.monsterName,e.monsterGroupName);if(t){var a=JSON.parse(JSON.stringify(t));return e.count>1&&(a.name+=" x"+e.count),r.a.createElement(le,{key:e.id,monster:a})}return null}))})}},{key:"render",value:function(){var e=this;try{var t;return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(na,{encounter:this.props.encounter,parties:this.props.parties,edit:function(t){return e.props.edit(t)},delete:function(t){return e.props.delete(t)},run:function(t,a){return e.props.run(t,a)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},goBack:function(){return e.props.goBack()}})),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ta.makeHtml(this.props.encounter.notes)}}),this.getSlots(this.props.encounter.id,null!==(t=this.props.encounter.name)&&void 0!==t?t:"unnamed encounter",this.props.encounter.slots),this.props.encounter.waves.map((function(t){var a;return e.getSlots(t.id,null!==(a=t.name)&&void 0!==a?a:"wave",t.slots)}))))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),na=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;return this.props.parties.length>0&&(t=r.a.createElement(W,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start combat with...",onSelect:function(t){return e.props.run(e.props.encounter,t)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"encounter name"),r.a.createElement(H,{text:this.props.encounter.name,placeholder:"encounter name",onChange:function(t){return e.props.changeValue(e.props.encounter,"name",t)}})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.edit(e.props.encounter)}},"edit encounter"),t,r.a.createElement(F,{text:"delete encounter",onConfirm:function(){return e.props.delete(e.props.encounter)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(St.a,{style:{fontSize:"10px"}})," back to the list")))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ra=a(205),sa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){try{var e=r.a.createElement(ra.a,{autoplay:!0,autoplaySpeed:1e4},r.a.createElement("div",{key:"prologue"},r.a.createElement("p",{className:"heading"},"welcome to ",r.a.createElement("span",{className:"app-name"},"dojo")),r.a.createElement("p",null,r.a.createElement("span",{className:"app-name"},"dojo")," is an app for dms of ",r.a.createElement("a",{href:"https://www.wizards.com/dnd",target:"_blank",rel:"noopener noreferrer"},"dungeons and dragons fifth edition")),r.a.createElement("p",null,"with ",r.a.createElement("span",{className:"app-name"},"dojo")," you can...")),r.a.createElement("div",{key:"monster"},r.a.createElement("p",{className:"heading"},"build unique, challenging monsters"),r.a.createElement("ul",null,r.a.createElement("li",null,"watch the stat block change as you design your monster"),r.a.createElement("li",null,"see a list of similar monsters to help kickstart your creativity (or show you typical stat values for the type of monster you're creating)"),r.a.createElement("li",null,"build an entirely random monster with a single click"),r.a.createElement("li",null,"easily import any monster from ",r.a.createElement("a",{href:"https://dnd.wizards.com/articles/features/basicrules",target:"_blank",rel:"noopener noreferrer"},"the basic rules")," or from ",r.a.createElement("a",{href:"https://www.dndbeyond.com",target:"_blank",rel:"noopener noreferrer"},"d&d beyond")),r.a.createElement("li",null,"supports legendary and mythic monsters"))),r.a.createElement("div",{key:"encounter"},r.a.createElement("p",{className:"heading"},"create rewarding encounters"),r.a.createElement("ul",null,r.a.createElement("li",null,"quickly add monsters to your encounter and see its xp value and difficulty level change"),r.a.createElement("li",null,"split your encounter into multiple waves"),r.a.createElement("li",null,"let ",r.a.createElement("span",{className:"app-name"},"dojo")," build a random encounter on the fly - or use one of its encounter templates to get started"))),r.a.createElement("div",{key:"map"},r.a.createElement("p",{className:"heading"},"design intricate tactical maps"),r.a.createElement("ul",null,r.a.createElement("li",null,"create a dungeon map by quickly adding rooms, doors, corridors, and stairs"),r.a.createElement("li",null,"for something a little more fancy, you can upload your own battlemap images - even animated images"),r.a.createElement("li",null,"generate an entire random dungeon map with one click"),r.a.createElement("li",null,"add fog of war and then show your maps to your players"))),r.a.createElement("div",{key:"combat"},r.a.createElement("p",{className:"heading"},"run combat without the book-keeping"),r.a.createElement("ul",null,r.a.createElement("li",null,"see the initiative list at a glance - and share it with players in a separate window"),r.a.createElement("li",null,"track monster hit points, rechargable actions, and legendary actions"),r.a.createElement("li",null,"track conditions, their durations, and the effects they impose"),r.a.createElement("li",null,"easily handle mounted combat"),r.a.createElement("li",null,"if you're using a tactical map, ",r.a.createElement("span",{className:"app-name"},"dojo")," keeps track of everyone's location"))),r.a.createElement("div",{key:"epilogue"},r.a.createElement("p",{className:"heading"},"to get started"),r.a.createElement("p",null,"use the buttons at the bottom of the screen to explore ",r.a.createElement("span",{className:"app-name"},"dojo"),"'s main features"),r.a.createElement("p",null,"or press the buttons at the top right for additional tools like a die roller, some useful random generators, and rules references")));return r.a.createElement(p.a,{align:"middle",justify:"center",className:"scrollable"},e)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ia=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.map.name||"unnamed map")),r.a.createElement("div",{className:"card-content"},r.a.createElement(p.a,{align:"middle",justify:"center",className:"fixed-height"},r.a.createElement(d.a,{span:24},r.a.createElement(ke,{map:this.props.map}))),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.viewMap(e.props.map)}},"open map"),r.a.createElement("button",{onClick:function(){return e.props.editMap(e.props.map)}},"edit map"),r.a.createElement(F,{text:"delete map",onConfirm:function(){return e.props.removeMap(e.props.map)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),oa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.maps;N.sort(t);var a=t.map((function(t){return r.a.createElement(ia,{key:t.id,map:t,viewMap:function(t){return e.props.viewMap(t)},editMap:function(t){return e.props.editMap(t)},removeMap:function(t){return e.props.deleteMap(t)}})}));return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"on this page you can set up tactical maps"),r.a.createElement("div",{className:"section"},"when you have created a map you can use it in the combat manager"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see a list of maps"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start a new map, press the ",r.a.createElement("b",null,"create a new map")," button")),r.a.createElement("button",{onClick:function(){return e.props.addMap()}},"create a new map"),r.a.createElement("button",{onClick:function(){return e.props.importMap()}},"import a map image"),r.a.createElement(U,{text:"create a random map"},r.a.createElement("button",{onClick:function(){return e.props.generateMap("dungeon")}},"create a new dungeon map"),r.a.createElement("button",{onClick:function(){return e.props.generateMap("delve")}},"create a new delve map"))),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(He,{heading:"maps",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ca=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getMonsters",value:function(){var e=this;return 0===this.props.group.monsters.length?r.a.createElement("div",{className:"section"},"no monsters"):this.props.group.monsters.map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)}},r.a.createElement(ee,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},t.name||"unnamed monster"),r.a.createElement("div",{className:"value"},"cr ",N.challenge(t.challenge)))}))}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.group.name||"unnamed group")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},this.getMonsters()),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.open(e.props.group)}},"open group"),r.a.createElement(F,{text:"delete group",onConfirm:function(){return e.props.delete(e.props.group)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),la=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{if(!this.props.hasMonsters)return r.a.createElement(p.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement(d.a,{xs:20,sm:18,md:16,lg:12,xl:10},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"to kickstart your monster collection, let's import all the monsters from the ",r.a.createElement("a",{href:"http://dnd.wizards.com/articles/features/systems-reference-document-srd",target:"_blank",rel:"noopener noreferrer"},"d&d system reference document")),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.addOpenGameContent()}},"import monsters"))));var t=this.props.library;N.sort(t);var a=t.map((function(t){return r.a.createElement(ca,{key:t.id,group:t,open:function(t){return e.props.selectMonsterGroup(t)},delete:function(t){return e.props.deleteMonsterGroup(t)},openStatBlock:function(t){return e.props.openStatBlock(t)}})}));return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"you can maintain your menagerie of monsters here"),r.a.createElement("div",{className:"section"},"you can then use these monsters to design combat encounters in the encounter builder"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see a list of monster groups"),r.a.createElement("div",{className:"section"},"select a monster group from the list to see stat blocks for monsters in that group"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start adding monsters, press the ",r.a.createElement("b",null,"create a new monster group")," button")),r.a.createElement("button",{onClick:function(){return e.props.addMonsterGroup()}},"create a new monster group"),r.a.createElement("button",{onClick:function(){return e.props.importMonsterGroup()}},"import a monster group"),r.a.createElement("button",{onClick:function(){return e.props.openDemographics(null)}},"show demographics")),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(He,{heading:"monster groups",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ua=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"export",value:function(e){var t=e.name+".monster";N.saveFile(t,e)}},{key:"render",value:function(){var e=this;try{var t=[];return 0!==this.props.monsterGroup.monsters.length?this.props.monsterGroup.monsters.forEach((function(a){t.push(r.a.createElement(le,{monster:a,mode:"editable",library:e.props.library,moveToGroup:function(t,a){return e.props.moveToGroup(t,a)},removeMonster:function(t){return e.props.removeMonster(t)},viewMonster:function(t){return e.props.viewMonster(t)},editMonster:function(t){return e.props.editMonster(t)},exportMonster:function(t){return e.export(t)},cloneMonster:function(t,a){return e.props.cloneMonster(t,a)}}))})):t.push(r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"there are no monsters in this group"))),r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(ma,{monsterGroup:this.props.monsterGroup,library:this.props.library,goBack:function(){return e.props.goBack()},addMonster:function(t){return e.props.addMonster(t)},importMonster:function(){return e.props.importMonster()},changeValue:function(t,a){return e.props.changeValue(e.props.monsterGroup,t,a)},removeMonsterGroup:function(){return e.props.removeMonsterGroup()},openDemographics:function(){return e.props.openDemographics(e.props.monsterGroup)}})),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(He,{content:t,heading:this.props.monsterGroup.name||"unnamed group"})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ma=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={cr:1,type:null,size:null,role:null},n}return Object(l.a)(a,[{key:"getSummary",value:function(){if(0===this.props.monsterGroup.monsters.length)return r.a.createElement("div",{className:"section centered"},r.a.createElement("i",null,"no monsters"));var e={min:30,max:0};this.props.monsterGroup.monsters.forEach((function(t){e.min=Math.min(e.min,t.challenge),e.max=Math.max(e.max,t.challenge)}));var t=e.min===e.max?N.challenge(e.min):N.challenge(e.min)+" - "+N.challenge(e.max);return r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"monsters")),r.a.createElement("div",{className:"section"},this.props.monsterGroup.monsters.length),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"challenge rating")),r.a.createElement("div",{className:"section"},t))}},{key:"getGenerator",value:function(){var e=this,t=y.map((function(e){return{id:e,text:e}})),a=b.map((function(e){return{id:e,text:e}})),n=E.map((function(e){return{id:e,text:e}})),s=[];return this.props.library.forEach((function(t){t.monsters.forEach((function(t){var a=!0;t.challenge!==e.state.cr&&(a=!1),e.state.type&&t.category!==e.state.type&&(a=!1),e.state.size&&t.size!==e.state.size&&(a=!1),e.state.role&&t.role!==e.state.role&&(a=!1),a&&s.push(t)}))})),r.a.createElement(U,{text:"create a random monster"},r.a.createElement(Z,{label:"cr",value:N.challenge(this.state.cr),onNudgeValue:function(t){return e.setState({cr:N.nudgeChallenge(e.state.cr,t)})}}),r.a.createElement(W,{options:t,selectedID:this.state.type,placeholder:"any type",onSelect:function(t){return e.setState({type:t})},onClear:function(){return e.setState({type:null})}}),r.a.createElement(W,{options:a,selectedID:this.state.size,placeholder:"any size",onSelect:function(t){return e.setState({size:t})},onClear:function(){return e.setState({size:null})}}),r.a.createElement(W,{options:n,selectedID:this.state.role,placeholder:"any role",onSelect:function(t){return e.setState({role:t})},onClear:function(){return e.setState({role:null})}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"number of monsters:"),r.a.createElement(d.a,{span:8,className:"statistic-value"},s.length))),r.a.createElement("hr",null),r.a.createElement("button",{className:s.length>2?"":"disabled",onClick:function(){var t=C.createMonster();t.name=ot.generateName(!0),w.spliceMonsters(t,s),e.props.addMonster(t)}},"create monster"))}},{key:"export",value:function(){var e=this.props.monsterGroup.name+".monstergroup";N.saveFile(e,this.props.monsterGroup)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"monster group name"),r.a.createElement(H,{text:this.props.monsterGroup.name,placeholder:"monster group name",onChange:function(t){return e.props.changeValue("name",t)}})),r.a.createElement("hr",null),this.getSummary(),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.addMonster(null)}},"add a new monster"),r.a.createElement("button",{onClick:function(){return e.props.importMonster()}},"import a monster"),this.getGenerator(),r.a.createElement("button",{onClick:function(){return e.props.openDemographics()}},"show demographics"),r.a.createElement("button",{onClick:function(){return e.export()}},"export group"),r.a.createElement(F,{text:"delete group",onConfirm:function(){return e.props.removeMonsterGroup()}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(St.a,{style:{fontSize:"10px"}})," back to the list"))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),pa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getText",value:function(e){var t=e.name||"unnamed pc";return e.player&&(t+=" ("+e.player+")"),t}},{key:"getPCs",value:function(){var e=this;return 0===this.props.party.pcs.length?r.a.createElement("div",{className:"section"},"no pcs"):this.props.party.pcs.map((function(t){return r.a.createElement("div",{key:t.id,className:t.active?"combatant-row":"combatant-row inactive",onClick:function(){return e.props.openStatBlock(t)}},r.a.createElement(ee,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},e.getText(t)),r.a.createElement("div",{className:"value"},"lvl ",t.level))}))}},{key:"render",value:function(){var e=this;try{var t=null;if(this.props.encounters.length>0){var a=this.props.encounters.map((function(e){return{id:e.id,text:e.name}}));t=r.a.createElement(W,{options:a,placeholder:"start combat...",onSelect:function(t){return e.props.runEncounter(e.props.party,t)}})}return r.a.createElement("div",{className:"card pc"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.party.name||"unnamed party")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},this.getPCs()),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.open(e.props.party)}},"open party"),t,r.a.createElement(F,{text:"delete party",onConfirm:function(){return e.props.delete(e.props.party)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),da=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.parties;N.sort(t);var a=t.map((function(t){return r.a.createElement(pa,{key:t.id,party:t,encounters:e.props.encounters,open:function(t){return e.props.selectParty(t)},delete:function(t){return e.props.deleteParty(t)},runEncounter:function(t,a){return e.props.runEncounter(t,a)},openStatBlock:function(t){return e.props.openStatBlock(t)}})}));return r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"this page is where you can tell dojo all about your pcs"),r.a.createElement("div",{className:"section"},"you can add a party for each of your gaming groups"),r.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can run the encounter in the combat manager"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see a list of parties that you have created"),r.a.createElement("div",{className:"section"},"select a party from the list to see pc details"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start adding a party, press the ",r.a.createElement("b",null,"create a new party")," button")),r.a.createElement("button",{onClick:function(){return e.props.addParty()}},"create a new party"),r.a.createElement("button",{onClick:function(){return e.props.importParty()}},"import a party")),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(He,{heading:"parties",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ha=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"export",value:function(e){var t=e.name+".pc";N.saveFile(t,e)}},{key:"render",value:function(){var e=this;try{var t=this.props.party.pcs.filter((function(e){return e.active})),a=[];t.forEach((function(t){a.push(r.a.createElement(We,{pc:t,mode:"edit",changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},editPC:function(t){return e.props.editPC(t)},updatePC:function(t){return e.props.updatePC(t)},exportPC:function(t){return e.export(t)},removePC:function(t){return e.props.removePC(t)}}))}));var n=this.props.party.pcs.filter((function(e){return!e.active})),s=[];return n.forEach((function(t){s.push(r.a.createElement(We,{pc:t,mode:"edit",changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},editPC:function(t){return e.props.editPC(t)},updatePC:function(t){return e.props.updatePC(t)},exportPC:function(t){return e.export(t)},removePC:function(t){return e.props.removePC(t)}}))})),0===t.length&&a.push(r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"there are no pcs in this party"))),r.a.createElement(p.a,{className:"full-height"},r.a.createElement(d.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(fa,{party:this.props.party,goBack:function(){return e.props.goBack()},addPC:function(){return e.props.addPC()},importPC:function(){return e.props.importPC()},changeValue:function(t,a){return e.props.changeValue(e.props.party,t,a)},removeParty:function(){return e.props.removeParty()}})),r.a.createElement(d.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(He,{content:a,heading:this.props.party.name||"unnamed party"}),r.a.createElement(He,{content:s,heading:"inactive pcs"})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),fa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"export",value:function(){var e=this.props.party.name+".party";N.saveFile(e,this.props.party)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"party name"),r.a.createElement(H,{text:this.props.party.name,placeholder:"party name",onChange:function(t){return e.props.changeValue("name",t)}})),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.addPC()}},"add a new pc"),r.a.createElement("button",{onClick:function(){return e.props.importPC()}},"import a pc"),r.a.createElement("button",{onClick:function(){return e.export()}},"export party"),r.a.createElement(F,{text:"delete party",onConfirm:function(){return e.props.removeParty()}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(St.a,{style:{fontSize:"10px"}})," back to the list")))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),va=a(96),ga=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:"dojo",showImages:!1},n}return Object(l.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"toggleImages",value:function(){this.setState({showImages:!this.state.showImages})}},{key:"render",value:function(){var e=this;try{var t=["dojo","settings","ogl"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"dojo":a=r.a.createElement("div",null,r.a.createElement("div",{className:"section"},"designed by ",r.a.createElement("a",{href:"mailto:andy.aiken@live.co.uk"},"andy aiken")),r.a.createElement("div",{className:"section"},"version ",r.a.createElement("b",null,va.version)),r.a.createElement("div",{className:"section"},"if you would like to raise a bug or request a new feature, you can do so ",r.a.createElement("a",{href:"https://github.com/andyaiken/dojo",target:"_blank",rel:"noopener noreferrer"},"here")),r.a.createElement("div",{className:"section"},"the roadmap for planned new features can be found ",r.a.createElement("a",{href:"https://github.com/andyaiken/dojo/projects/8?fullscreen=true",target:"_blank",rel:"noopener noreferrer"},"here")));break;case"settings":for(var n=0,s=0,i=0;i!==window.localStorage.length;++i){var o=window.localStorage.key(i);if(o){var c=window.localStorage.getItem(o);c&&(o.startsWith("data")&&(n+=c.length),o.startsWith("image")&&(s+=c.length))}}a=r.a.createElement("div",null,r.a.createElement(se,null,r.a.createElement("div",{className:"section"},"the ",r.a.createElement("b",null,"clear all data")," button will reset the entire app and cannot be undone"),r.a.createElement("div",{className:"section"},"use it at your own risk")),r.a.createElement(F,{text:"clear all data",onConfirm:function(){return e.props.resetAll()}}),r.a.createElement("button",{onClick:function(){return e.toggleImages()}},"show images"),r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"data"),r.a.createElement("div",{className:"section"},r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"total"),r.a.createElement(d.a,{span:8,className:"statistic-value"},N.toData(n+s))),r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"data"),r.a.createElement(d.a,{span:8,className:"statistic-value"},N.toData(n))),r.a.createElement(p.a,null,r.a.createElement(d.a,{span:16},"images"),r.a.createElement(d.a,{span:8,className:"statistic-value"},N.toData(s)))));break;case"ogl":a=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"open game license"),r.a.createElement("div",{className:"section"},"The following text is the property of Wizards of the Coast, Inc. and is Copyright 2000 Wizards of the Coast, Inc ('Wizards'). All Rights Reserved."),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("b",null,"Definitions"),": (a)'Contributors' means the copyright and/or trademark owners who have contributed Open Game Content; (b)'Derivative Material' means copyrighted material including derivative works and translations (including into other computer languages), potation, modification, correction, addition, extension, upgrade, improvement, compilation, abridgment or other form in which an existing work may be recast, transformed or adapted; (c) 'Distribute' means to reproduce, license, rent, lease, sell, broadcast, publicly display, transmit or otherwise distribute; (d)'Open Game Content' means the game mechanic and includes the methods, procedures, processes and routines to the extent such content does not embody the Product Identity and is an enhancement over the prior art and any additional content clearly identified as Open Game Content by the Contributor, and means any work covered by this License, including translations and derivative works under copyright law, but specifically excludes Product Identity. (e) 'Product Identity' means product and product line names, logos and identifying marks including trade dress; artifacts; creatures characters; stories, storylines, plots, thematic elements, dialogue, incidents, language, artwork, symbols, designs, depictions, likenesses, formats, poses, concepts, themes and graphic, photographic and other visual or audio representations; names and descriptions of characters, spells, enchantments, personalities, teams, personas, likenesses and special abilities; places, locations, environments, creatures, equipment, magical or supernatural abilities or effects, logos, symbols, or graphic designs; and any other trademark or registered trademark clearly identified as Product identity by the owner of the Product Identity, and which specifically excludes the Open Game Content; (f) 'Trademark' means the logos, names, mark, sign, motto, designs that are used by a Contributor to identify itself or its products or the associated products contributed to the Open Game License by the Contributor (g) 'Use', 'Used' or 'Using' means to use, Distribute, copy, edit, format, modify, translate and otherwise create Derivative Material of Open Game Content. (h) 'You' or 'Your' means the licensee in terms of this agreement."),r.a.createElement("li",null,r.a.createElement("b",null,"The License"),": This License applies to any Open Game Content that contains a notice indicating that the Open Game Content may only be Used under and in terms of this License. You must affix such a notice to any Open Game Content that you Use. No terms may be added to or subtracted from this License except as described by the License itself. No other terms or conditions may be applied to any Open Game Content distributed using this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Offer and Acceptance"),": By Using the Open Game Content You indicate Your acceptance of the terms of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Grant and Consideration"),": In consideration for agreeing to use this License, the Contributors grant You a perpetual, worldwide, royalty-free, non-exclusive license with the exact terms of this License to Use, the Open Game Content."),r.a.createElement("li",null,r.a.createElement("b",null,"Representation of Authority to Contribute"),": If You are contributing original material as Open Game Content, You represent that Your Contributions are Your original creation and/or You have sufficient rights to grant the rights conveyed by this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Notice of License Copyright"),": You must update the COPYRIGHT NOTICE portion of this License to include the exact text of the COPYRIGHT NOTICE of any Open Game Content You are copying, modifying or distributing, and You must add the title, the copyright date, and the copyright holder's name to the COPYRIGHT NOTICE of any original Open Game Content you Distribute."),r.a.createElement("li",null,r.a.createElement("b",null,"Use of Product Identity"),": You agree not to Use any Product Identity, including as an indication as to compatibility, except as expressly licensed in another, independent Agreement with the owner of each element of that Product Identity. You agree not to indicate compatibility or co-adaptability with any Trademark or Registered Trademark in conjunction with a work containing Open Game Content except as expressly licensed in another, independent Agreement with the owner of such Trademark or Registered Trademark. The use of any Product Identity in Open Game Content does not constitute a challenge to the ownership of that Product Identity. The owner of any Product Identity used in Open Game Content shall retain all rights, title and interest in and to that Product Identity."),r.a.createElement("li",null,r.a.createElement("b",null,"Identification"),": If you distribute Open Game Content You must clearly indicate which portions of the work that you are distributing are Open Game Content."),r.a.createElement("li",null,r.a.createElement("b",null,"Updating the License"),": Wizards or its designated Agents may publish updated versions of this License. You may use any authorized version of this License to copy, modify and distribute any Open Game Content originally distributed under any version of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Copy of this License"),": You MUST include a copy of this License with every copy of the Open Game Content You Distribute."),r.a.createElement("li",null,r.a.createElement("b",null,"Use of Contributor Credits"),": You may not market or advertise the Open Game Content using the name of any Contributor unless You have written permission from the Contributor to do so."),r.a.createElement("li",null,r.a.createElement("b",null,"Inability to Comply"),": If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Open Game Content due to statute, judicial order, or governmental regulation then You may not Use any Open Game Material so affected."),r.a.createElement("li",null,r.a.createElement("b",null,"Termination"),": This License will terminate automatically if You fail to comply with all terms herein and fail to cure such breach within 30 days of becoming aware of the breach. All sublicenses shall survive the termination of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Reformation"),": If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable."),r.a.createElement("li",null,r.a.createElement("b",null,"COPYRIGHT NOTICE")," Open Game License v 1.0 Copyright 2000, Wizards of the Coast, Inc.")))}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"about"),r.a.createElement(ue,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},a),r.a.createElement(h.a,{visible:this.state.showImages,closable:!1,onClose:function(){return e.toggleImages()}},r.a.createElement(tt,{parties:this.props.parties,library:this.props.library,maps:this.props.maps,combats:this.props.combats})))}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ba=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={description:"",physical:"",mental:"",speech:""},n}return Object(l.a)(a,[{key:"generate",value:function(){this.setState({description:ot.generateNPC(),physical:ot.generateNPCPhysical(),mental:ot.generateNPCMental(),speech:ot.generateNPCSpeech()})}},{key:"render",value:function(){var e=this;try{var t=null;return this.state.description&&(t=r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},r.a.createElement("div",null,r.a.createElement("b",null,"npc:")," ",this.state.description),r.a.createElement("hr",null),r.a.createElement("div",{className:"smaller"},r.a.createElement("b",null,"physical:")," ",this.state.physical),r.a.createElement("div",{className:"smaller"},r.a.createElement("b",null,"personality:")," ",this.state.mental),r.a.createElement("div",{className:"smaller"},r.a.createElement("b",null,"speech:")," ",this.state.speech)))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t?r.a.createElement("hr",null):null,t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ya=a(22),Ea=a.n(ya),ka=a(30),wa=a(218),Na=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={source:null,values:[]},n}return Object(l.a)(a,[{key:"fetchData",value:function(){var e=Object(ka.a)(Ea.a.mark((function e(){var t,a;return Ea.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/dojo/data/places.txt");case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,this.setState({source:a});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generate",value:function(){ot.initModel([this.state.source]),this.setState({values:ot.generate(10).map((function(e){return e.line}))})}},{key:"render",value:function(){var e=this;try{this.state.source||this.fetchData();for(var t=[],a=0;a!==this.state.values.length;++a)t.push(r.a.createElement(Ca,{key:a,text:this.state.values[a]}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t.length>0?r.a.createElement("hr",null):null,t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ca=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement(wa.a,{title:"copy",onClick:function(t){return e.copy(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),xa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={values:[]},n}return Object(l.a)(a,[{key:"generate",value:function(){for(var e=[];e.length<10;){var t="";switch(this.props.type){case"book":t=ot.generateBookTitle();break;case"name":t=ot.generateName(!1);break;case"potion":t=ot.generatePotion();break;case"treasure":t=ot.generateTreasure()}e.includes(t)||e.push(t)}e.sort(),this.setState({values:e})}},{key:"render",value:function(){var e=this;try{for(var t=[],a=0;a!==this.state.values.length;++a)t.push(r.a.createElement(Sa,{key:a,text:this.state.values[a]}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t.length>0?r.a.createElement("hr",null):null,t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Sa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement(wa.a,{title:"copy",onClick:function(t){return e.copy(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ma=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"name":t=r.a.createElement(xa,{key:"name",type:"name"});break;case"book":t=r.a.createElement(xa,{key:"book",type:"book"});break;case"potion":t=r.a.createElement(xa,{key:"potion",type:"potion"});break;case"treasure":t=r.a.createElement(xa,{key:"treasure",type:"treasure"});break;case"place":t=r.a.createElement(Na,null);break;case"npc":t=r.a.createElement(ba,null)}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"generators"),r.a.createElement(ue,{options:[{id:"name",text:"names"},{id:"book",text:"book titles"},{id:"potion",text:"potions"},{id:"treasure",text:"treasures"},{id:"place",text:"place names"},{id:"npc",text:"npc"}],selectedID:this.props.view,itemsPerRow:3,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Oa=a(217),Ia=a(206),Da=new re.a.Converter;Da.setOption("tables",!0);var ja=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={source:null},n}return Object(l.a)(a,[{key:"fetchData",value:function(){var e=Object(ka.a)(Ea.a.mark((function e(){var t,a;return Ea.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.props.filename);case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,this.setState({source:a});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){try{return this.state.source||this.fetchData(),r.a.createElement(Ia.a,{spinning:null===this.state.source,indicator:r.a.createElement(Oa.a,{style:{fontSize:20,marginTop:100}})},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Da.makeHtml(this.state.source||"")}}))}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ta=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.monsters.find((function(t){return t.id===e.props.selectedMonsterID})),a=null;return t&&(a=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(le,{monster:t}))),r.a.createElement("div",null,r.a.createElement(W,{options:this.props.monsters.map((function(e){return{id:e.id,text:e.name}})),placeholder:"select a monster...",selectedID:this.props.selectedMonsterID,onSelect:function(t){return e.props.selectMonsterID(t)}}),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Va=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"getSummary",value:function(){var e=this,t=this.props.parties.find((function(t){return t.id===e.props.selectedPartyID}));if(!t)return null;var a=t.pcs.filter((function(e){return e.active}));if(0===a.length)return r.a.createElement("div",{className:"section centered"},r.a.createElement("i",null,"no pcs"));var n=Math.round(a.reduce((function(e,t){return e+t.level}),0)/a.length),s=a.map((function(e){return e.languages.toLowerCase()})).join(", ").split(/[ ,;.:]+/).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]).sort((function(e,t){return"common"===e?-1:"common"===t?1:e.localeCompare(t)})).map((function(e){var t=a.filter((function(t){return t.languages.toLowerCase().includes(e)})),n=t.length===a.length?"all pcs":t.map((function(e){return e.name})).join(", "),s=e[0].toUpperCase()+e.substr(1);return r.a.createElement("div",{key:s,className:"table-row"},r.a.createElement("div",{className:"table-cell l"},s),r.a.createElement("div",{className:"table-cell l"},n))})),i={min:Number.MAX_VALUE,max:Number.MIN_VALUE},o={min:Number.MAX_VALUE,max:Number.MIN_VALUE},c={min:Number.MAX_VALUE,max:Number.MIN_VALUE};a.forEach((function(e){i.min=Math.min(i.min,e.passiveInsight),i.max=Math.max(i.max,e.passiveInsight),o.min=Math.min(o.min,e.passiveInvestigation),o.max=Math.max(o.max,e.passiveInvestigation),c.min=Math.min(c.min,e.passivePerception),c.max=Math.max(c.max,e.passivePerception)}));for(var l=Math.min(i.min,o.min,c.min),u=Math.max(i.max,o.max,c.max),m=[],p=function(e){var t=a.filter((function(t){return t.passiveInsight===e})).map((function(e){return e.name})).join(", "),n=a.filter((function(t){return t.passiveInvestigation===e})).map((function(e){return e.name})).join(", "),s=a.filter((function(t){return t.passivePerception===e})).map((function(e){return e.name})).join(", ");m.push(r.a.createElement("div",{key:e,className:"table-row"},r.a.createElement("div",{className:"table-cell l small"},e),r.a.createElement("div",{className:"table-cell l"},t),r.a.createElement("div",{className:"table-cell l"},n),r.a.createElement("div",{className:"table-cell l"},s)))},d=u;d>=l;--d)p(d);return r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"languages"),r.a.createElement("div",{className:"table alternating"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"language")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"spoken by"))),s),r.a.createElement("div",{className:"section subheading"},"passive skills"),r.a.createElement("div",{className:"table alternating"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell l small"}),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"insight")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"investigation")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"perception"))),m),r.a.createElement("div",{className:"section subheading"},"average level"),r.a.createElement("div",{className:"section"},n))}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement(W,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"select a party...",selectedID:this.props.selectedPartyID,onSelect:function(t){return e.props.selectPartyID(t)}}),this.getSummary())}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Pa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"skills":t=r.a.createElement(ja,{key:"skills",filename:"/dojo/data/skills.md"});break;case"conditions":t=r.a.createElement(ja,{key:"conditions",filename:"/dojo/data/conditions.md"});break;case"actions":t=r.a.createElement(ja,{key:"actions",filename:"/dojo/data/actions.md"});break;case"party":t=r.a.createElement(Va,{selectedPartyID:this.props.selectedPartyID,parties:this.props.parties,selectPartyID:function(t){return e.props.selectPartyID(t)}});break;case"monster":t=r.a.createElement(Ta,{selectedMonsterID:this.props.selectedMonsterID,monsters:this.props.monsters,selectMonsterID:function(t){return e.props.selectMonsterID(t)}})}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"reference"),r.a.createElement(ue,{options:[{id:"skills",text:"skills"},{id:"conditions",text:"conditions"},{id:"actions",text:"actions"},{id:"party",text:"party"},{id:"monster",text:"monster"}],selectedID:this.props.view,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Aa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={text:""},n}return Object(l.a)(a,[{key:"setSearchTerm",value:function(e){this.setState({text:e})}},{key:"render",value:function(){var e=this;try{var t=[];return this.state.text.length>2&&(this.props.parties.filter((function(t){return I.matchParty(e.state.text,t)})).forEach((function(a){var n=[];a.pcs.filter((function(t){return I.matchPC(e.state.text,t)})).forEach((function(t){var a=[];t.companions.filter((function(t){return I.matchCompanion(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.name)))})),n.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openParty(a.id)}},r.a.createElement("div",{className:"section"},a.name),n))})),this.props.library.filter((function(t){return I.matchGroup(e.state.text,t)})).forEach((function(a){var n=[];a.monsters.filter((function(t){return I.matchMonster(e.state.text,t)})).forEach((function(t){var a=[];t.traits.filter((function(t){return I.matchTrait(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.name)))})),n.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openGroup(a.id)}},r.a.createElement("div",{className:"section"},a.name),n))})),this.props.encounters.filter((function(t){return I.matchEncounter(e.state.text,t)})).forEach((function(a){var n=[];a.slots.filter((function(t){return I.matchEncounterSlot(e.state.text,t)})).forEach((function(e){n.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.monsterName)))}));var s=[];a.waves.filter((function(t){return I.matchEncounterWave(e.state.text,t)})).forEach((function(t){var a=[];t.slots.filter((function(t){return I.matchEncounterSlot(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.monsterName)))})),s.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openEncounter(a.id)}},r.a.createElement("div",{className:"section"},a.name),n,s))})),this.props.maps.filter((function(t){return I.matchMap(e.state.text,t)})).forEach((function(a){var n=[];a.notes.filter((function(t){return I.matchMapNote(e.state.text,t)})).forEach((function(e){n.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},"map note")))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openMap(a.id)}},r.a.createElement("div",{className:"section"},a.name),n))})),0===t.length&&t.push(r.a.createElement(se,{key:"empty"},"nothing found"))),r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"search"),r.a.createElement(H,{text:this.state.text,placeholder:"enter your search term here",minLength:3,onChange:function(t){return e.setSearchTerm(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),za=a(215),Ra=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={option:"normal",results:[]},n}return Object(l.a)(a,[{key:"rollDice",value:function(){var e=this,t={rolls:[],constant:this.props.constant,option:this.state.option};[4,6,8,10,12,20,100].forEach((function(a){for(var n=e.props.dice[a],r=0;r!==n;++r){var s=N.dieRoll(a);switch(t.option){case"advantage":s=Math.max(s,N.dieRoll(a));break;case"disadvantage":s=Math.min(s,N.dieRoll(a))}t.rolls.push({sides:a,value:s})}})),this.state.results.unshift(t),this.setState({results:this.state.results})}},{key:"reset",value:function(){var e=this;this.setState({option:"normal"},(function(){e.props.resetDice()}))}},{key:"dieTypeClicked",value:function(e,t,a){if(e.preventDefault(),0===t){var n=this.props.constant+(a?1:-1);this.props.setConstant(n)}else{var r=Math.max(this.props.dice[t]+(a?1:-1),0);this.props.setDie(t,r)}}},{key:"getDieTypeBox",value:function(e){var t=this,a=this.props.dice[e];return r.a.createElement("div",{className:a>0?"die-type":"die-type none",onClick:function(a){return t.dieTypeClicked(a,e,!a.ctrlKey)},onContextMenu:function(a){return t.dieTypeClicked(a,e,!1)}},r.a.createElement("div",{className:"die-type-name"},"d",e),r.a.createElement("div",{className:"die-type-value"},a))}},{key:"getConstantBox",value:function(){var e=this,t=this.props.constant;return r.a.createElement("div",{className:t>0?"die-type":"die-type none",onClick:function(t){return e.dieTypeClicked(t,0,!t.ctrlKey)},onContextMenu:function(t){return e.dieTypeClicked(t,0,!1)}},r.a.createElement("div",{className:"die-type-name"},"+/-"),r.a.createElement("div",{className:"die-type-value"},t))}},{key:"renderRoll",value:function(e,t){var a=[],n=0;if(e.rolls.forEach((function(e,t){var s="";20===e.sides&&(1===e.value&&(s="nat1"),20===e.value&&(s="nat20")),a.push(r.a.createElement(R.a,{key:"d"+e.sides+"."+t,className:s},"d",e.sides,": ",r.a.createElement("b",null,e.value))),n+=e.value})),0!==e.constant){var s=e.constant>0?"+":"-";a.push(r.a.createElement(R.a,{key:"constant"},s," ",r.a.createElement("b",null,Math.abs(e.constant)))),n+=e.constant}var i="normal"===e.option?null:r.a.createElement(za.a,{className:"roll-icon "+e.option,title:e.option});return r.a.createElement("div",{key:t,className:"die-roll group-panel"},r.a.createElement("div",{className:"rolls"},a,i),r.a.createElement("div",{className:"sum"},n))}},{key:"render",value:function(){var e=this;try{var t=this.state.results.map((function(t,a){return e.renderRoll(t,a)})),a=this.props.dice[4]+this.props.dice[6]+this.props.dice[8]+this.props.dice[10]+this.props.dice[12]+this.props.dice[20]+this.props.dice[100],n="";return[100,20,12,10,8,6,4].forEach((function(t){0!==e.props.dice[t]&&(n&&(n+=" + "),n+=e.props.dice[t]+"d"+t)})),0!==this.props.constant&&(n&&(this.props.constant>0?n+=" + ":n+=" - "),n+=Math.abs(this.props.constant)),r.a.createElement("div",null,r.a.createElement("div",{className:"die-types"},this.getDieTypeBox(4),this.getDieTypeBox(6),this.getDieTypeBox(8),this.getDieTypeBox(10),this.getDieTypeBox(12),this.getDieTypeBox(20),this.getDieTypeBox(100),this.getConstantBox()),r.a.createElement("hr",null),r.a.createElement(ue,{options:["normal","advantage","disadvantage"].map((function(e){return{id:e,text:e}})),selectedID:this.state.option,disabled:1!==a||1!==this.props.dice[20],onSelect:function(t){return e.setState({option:t})}}),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{className:a>0?"":"disabled",onClick:function(){return e.rollDice()}},"roll ",n)),r.a.createElement(d.a,{span:12},r.a.createElement("button",{className:a>0?"":"disabled",onClick:function(){return e.reset()}},"reset"))),r.a.createElement("hr",null),t)}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),La=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={filename:null,data:null,playerViewOpen:!1},n}return Object(l.a)(a,[{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target){var n=a.target.result;t.setState({filename:e.name,data:n})}},a.readAsDataURL(e),!1}},{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"clear",value:function(){this.setState({filename:null,data:null,playerViewOpen:!1})}},{key:"getPlayerView",value:function(){var e=this;return this.state.playerViewOpen?r.a.createElement(Tt,{title:"Handout",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("img",{className:"nonselectable-image",src:this.state.data||"",alt:this.state.filename||""})):null}},{key:"render",value:function(){var e=this;try{var t=null;return t=this.state.data?r.a.createElement("div",null,r.a.createElement("img",{className:"nonselectable-image",src:this.state.data||"",alt:this.state.filename||""}),r.a.createElement(j,{label:"show player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}}),r.a.createElement("button",{onClick:function(){return e.clear()}},"change handout")):r.a.createElement("div",null,r.a.createElement(se,null,"no handout loaded"),r.a.createElement(et.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(Qe.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),r.a.createElement("div",null,t,this.getPlayerView())}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ga=a(214),Fa=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"say",value:function(){var t=Object(ka.a)(Ea.a.mark((function t(a,n){var r;return Ea.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.speechSynthesis.cancel(),r=new SpeechSynthesisUtterance(a),t.next=4,e.chooseVoice(n);case 4:r.voice=t.sent,r.rate=e.randomValue(.5,1.5),r.pitch=e.randomValue(.5,1.5),window.speechSynthesis.speak(r);case 8:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},{key:"chooseVoice",value:function(){var t=Object(ka.a)(Ea.a.mark((function t(a){var n,r,s,i;return Ea.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getVoices();case 2:return n=t.sent,r=a.map((function(t){return e.getLanguageCode(t)})),0===(s=n.filter((function(e){return r.includes(e.lang.substr(0,2))}))).length&&(s=n.filter((function(e){return e.default}))),0===s.length&&(s=n),i=Math.floor(Math.random()*s.length),t.abrupt("return",s[i]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getVoices",value:function(){return new Promise((function(e){var t=window.speechSynthesis.getVoices();t.length>0?e(t):speechSynthesis.onvoiceschanged=function(){t=window.speechSynthesis.getVoices(),e(t)}}))}},{key:"getLanguageCode",value:function(e){switch(e){case"armenian":return"hy";case"basque":return"eu";case"bulgarian":return"bg";case"chichewa":return"ny";case"chinese":return"zh";case"croatian":return"hr";case"czech":return"cs";case"dutch":return"nl";case"german":return"de";case"greek":return"el";case"icelandic":return"is";case"irish":return"ga";case"kannada":return"kn";case"kazakh":return"kk";case"latvian":return"lv";case"lithuanian":return"lt";case"macedonian":return"mk";case"malay":return"ms";case"maltese":return"mt";case"maori":return"mi";case"polish":return"pl";case"portuguese":return"pt";case"punjabi":return"pa";case"samoan":return"sm";case"serbian":return"sr";case"shona":return"sn";case"spanish":return"es";case"swedish":return"sv";case"turkish":return"tr";case"welsh":return"cy";default:return e.substr(0,2)}}},{key:"randomValue",value:function(e,t){return e+(Math.random()+Math.random()+Math.random())/3*(t-e)}}]),e}(),Ba=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={preset:null,languages:[],output:[]},n}return Object(l.a)(a,[{key:"getAllLanguages",value:function(){return["afrikaans","amharic","armenian","basque","belarusian","bulgarian","chichewa","chinese","croatian","czech","danish","dutch","english","finnish","french","german","greek","hawaiian","hindi","hungarian","icelandic","irish","italian","japanese","kannada","kazakh","korean","kyrgyz","latvian","lithuanian","macedonian","malay","maltese","maori","myanmar","nepali","norwegian","polish","portuguese","punjabi","romanian","russian","samoan","serbian","shona","somali","spanish","swahili","swedish","thai","turkish","welsh","yiddish","zulu"]}},{key:"addLanguage",value:function(e){this.state.languages.push(e),this.setState({languages:this.state.languages.sort()})}},{key:"removeLanguage",value:function(e){var t=this.state.languages.indexOf(e);this.state.languages.splice(t,1),this.setState({languages:this.state.languages})}},{key:"usePreset",value:function(e){var t=[];switch(e){case"draconic":t=["armenian","irish","maltese"];break;case"dwarvish":t=["czech","german","yiddish"];break;case"elvish":t=["finnish","spanish","welsh"];break;case"goblin":t=["hawaiian","kyrgyz","somali"];break;case"orc":t=["macedonian","russian","turkish"]}this.setState({preset:e,languages:t.sort(),output:[]})}},{key:"random",value:function(){for(var e=this.getAllLanguages(),t=[];3!==t.length;){var a=e[Math.floor(Math.random()*e.length)];t.includes(a)||t.push(a)}this.setState({languages:t,output:[]})}},{key:"generate",value:function(){var e=this,t=this.state.languages.map((function(e){return fetch("/dojo/data/langs/"+e+".txt")}));Promise.all(t).then((function(t){var a=t.map((function(e){return e.text()}));Promise.all(a).then((function(t){ot.initModel(t),e.setState({output:ot.generate(5).map((function(e){return e.line}))})}))}))}},{key:"reset",value:function(){this.setState({preset:null,languages:[],output:[]})}},{key:"render",value:function(){var e=this;try{var t=["draconic","dwarvish","elvish","goblin","orc","custom"].map((function(e){return{id:e,text:e}})),a=this.state.languages.length>0,n=null;if("custom"===this.state.preset){var s=this.state.languages.join(", ");""===s&&(s="none");var i=this.getAllLanguages().map((function(t){var a=e.state.languages.includes(t);return r.a.createElement(j,{key:t,label:t,checked:a,display:"button",onChecked:function(a){return a?e.addLanguage(t):e.removeLanguage(t)}})})),o=a||this.state.output.length>0;n=r.a.createElement("div",{className:"group-panel"},r.a.createElement(U,{text:"selected languages: "+s},r.a.createElement("div",{className:"language-options"},r.a.createElement(He,{columns:3,content:i}))),r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.random()}},"random languages")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{className:o?"":"disabled",onClick:function(){return e.reset()}},"reset"))))}var c=[];this.state.output.length>0&&c.push(r.a.createElement("hr",{key:"div"}));for(var l=0;l!==this.state.output.length;++l)c.push(r.a.createElement(qa,{key:l,text:this.state.output[l],languages:this.state.languages}));return r.a.createElement("div",null,r.a.createElement(ue,{options:t,selectedID:this.state.preset,itemsPerRow:3,onSelect:function(t){return e.usePreset(t)}}),n,r.a.createElement("hr",null),r.a.createElement("button",{className:a?"":"disabled",onClick:function(){return e.generate()}},"generate text"),c)}catch(u){return console.error(u),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),qa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"say",value:function(e){e.stopPropagation(),Fa.say(this.props.text,this.props.languages)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement("div",null,r.a.createElement(wa.a,{title:"copy",onClick:function(t){return e.copy(t)}})),r.a.createElement("div",null,r.a.createElement(Ga.a,{title:"say (experimental)",onClick:function(t){return e.say(t)}}))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ha=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a);var r=[(n=t.call(this,e)).createCard("ace of swords","breakthrough, clarity, sharp mind","confusion, brutality, chaos"),n.createCard("two of swords","difficult choices, indecision, stalemate","lesser of two evils, no right choice, confusion"),n.createCard("three of swords","heartbreak, suffering, grief","recovery, forgiveness, moving on"),n.createCard("four of swords","rest, restoration, contemplation","restlessness, burnout, stress"),n.createCard("five of swords","unbridled ambition, win at all costs, sneakiness","lingering resentment, desire to reconcile, forgiveness"),n.createCard("six of swords","transition, leaving behind, moving on","emotional baggage, unresolved issues, resisting transition"),n.createCard("seven of swords","deception, trickery, tactics and strategy","coming clean, rethinking approach, deception"),n.createCard("eight of swords","imprisonment, entrapment, self-victimization","self acceptance, new perspective, freedom"),n.createCard("nine of swords","anxiety, hopelessness, trauma","hope, reaching out, despair"),n.createCard("ten of swords","failure, collapse, defeat","can't get worse, only upwards, inevitable end"),n.createCard("page of swords","curiosity, restlessness, mental energy","deception, manipulation, all talk"),n.createCard("knight of swords","action, impulsiveness, defending beliefs","no direction, disregard for consequences, unpredictability"),n.createCard("queen of swords","complexity, perceptiveness, clear mindedness","cold hearted, cruel, bitterness"),n.createCard("king of swords","head over heart, discipline, truth","manipulative, cruel, weakness"),n.createCard("ace of wands","creation, willpower, inspiration, desire","lack of energy, lack of passion, boredom"),n.createCard("two of wands","planning, making decisions, leaving home","fear of change, playing safe, bad planning"),n.createCard("three of wands","looking ahead, expansion, rapid growth","obstacles, delays, frustration"),n.createCard("four of wands","community, home, celebration","lack of support, transience, home conflicts"),n.createCard("five of wands","competition, rivalry, conflict","avoiding conflict, respecting differences"),n.createCard("six of wands","victory, success, public reward","excess pride, lack of recognition, punishment"),n.createCard("seven of wands","perseverance, defensive, maintaining control","give up, destroyed confidence, overwhelmed"),n.createCard("eight of wands","rapid action, movement, quick decisions","panic, waiting, slowdown"),n.createCard("nine of wands","resilience, grit, last stand","exhaustion, fatigue, questioning motivations"),n.createCard("ten of wands","accomplishment, responsibility, burden","inability to delegate, overstressed, burnt out"),n.createCard("page of wands","exploration, excitement, freedom","lack of direction, procrastination, creating conflict"),n.createCard("knight of wands","action, adventure, fearlessness","anger, impulsiveness, recklessness"),n.createCard("queen of wands","courage, determination, joy","selfishness, jealousy, insecurities"),n.createCard("king of wands","big picture, leader, overcoming challenges","impulsive, overbearing, unachievable expectations"),n.createCard("ace of cups","new feelings, spirituality, intuition","emotional loss, blocked creativity, emptiness"),n.createCard("two of cups","unity, partnership, connection","imbalance, broken communication, tension"),n.createCard("three of cups","friendship, community, happiness","overindulgence, gossip, isolation"),n.createCard("four of cups","apathy, contemplation, disconnectedness","sudden awareness, choosing happiness, acceptance"),n.createCard("five of cups","loss, grief, self-pity","acceptance, moving on, finding peace"),n.createCard("six of cups","familiarity, happy memories, healing","moving forward, leaving home, independence"),n.createCard("seven of cups","searching for purpose, choices, daydreaming","lack of purpose, diversion, confusion"),n.createCard("eight of cups","walking away, disillusionment, leaving behind","avoidance, fear of change, fear of loss"),n.createCard("nine of cups","satisfaction, emotional stability, luxury","lack of inner joy, smugness, dissatisfaction"),n.createCard("ten of cups","inner happiness, fulfillment, dreams coming true","shattered dreams, broken family, domestic disharmony"),n.createCard("page of cups","happy surprise, dreamer, sensitivity","emotional immaturity, insecurity, disappointment"),n.createCard("knight of cups","following the heart, idealist, romantic","moodiness, disappointment"),n.createCard("queen of cups","compassion, calm, comfort","martyrdom, insecurity, dependence"),n.createCard("king of cups","compassion, control, balance","coldness, moodiness, bad advice"),n.createCard("ace of pentacles","opportunity, prosperity, new venture","lost opportunity, missed chance, bad investment"),n.createCard("two of pentacles","balancing decisions, priorities, adapting to change","loss of balance, disorganized, overwhelmed"),n.createCard("three of pentacles","teamwork, collaboration, building","lack of teamwork, disorganized, group conflict"),n.createCard("four of pentacles","conservation, frugality, security","greediness, stinginess, possessiveness"),n.createCard("five of pentacles","need, poverty, insecurity","recovery, charity, improvement"),n.createCard("six of pentacles","charity, generosity, sharing","strings attached, stinginess, power and domination"),n.createCard("seven of pentacles","hard work, perseverance, diligence","work without results, distractions, lack of rewards"),n.createCard("eight of pentacles","apprenticeship, passion, high standards","lack of passion, uninspired, no motivation"),n.createCard("nine of pentacles","fruits of labor, rewards, luxury","reckless spending, living beyond means, false success"),n.createCard("ten of pentacles","legacy, culmination, inheritance","fleeting success, lack of stability, lack of resources"),n.createCard("page of pentacles","ambition, desire, diligence","lack of commitment, greediness, laziness"),n.createCard("knight of pentacles","efficiency, hard work, responsibility","laziness, obsessiveness, work without reward"),n.createCard("queen of pentacles","practicality, creature comforts, financial security","self-centeredness, jealousy, smothering"),n.createCard("king of pentacles","abundance, prosperity, security","greed, indulgence, sensuality"),n.createCard("the fool","innocence, new beginnings, free spirit","recklessness, taken advantage of, inconsideration"),n.createCard("the magician","willpower, desire, creation, manifestation","trickery, illusions, out of touch"),n.createCard("the high priestess","intuitive, unconscious, inner voice","lack of center, lost inner voice, repressed feelings"),n.createCard("the empress","motherhood, fertility, nature","dependence, smothering, emptiness, nosiness"),n.createCard("the emperor","authority, structure, control, fatherhood","tyranny, rigidity, coldness"),n.createCard("the hierophant","tradition, conformity, morality, ethics","rebellion, subversiveness, new approaches"),n.createCard("the lovers","partnerships, duality, union","loss of balance, one-sidedness, disharmony"),n.createCard("the chariot","direction, control, willpower","lack of control, lack of direction, aggression"),n.createCard("strength","inner strength, bravery, compassion, focus","self doubt, weakness, insecurity"),n.createCard("the hermit","contemplation, search for truth, inner guidance","loneliness, isolation, lost your way"),n.createCard("the wheel of fortune","change, cycles, inevitable fate","no control, clinging to control, bad luck"),n.createCard("justice","cause and effect, clarity, truth","dishonesty, unaccountability, unfairness"),n.createCard("the hanged man","sacrifice, release, martyrdom","stalling, needless sacrifice, fear of sacrifice"),n.createCard("death","end of cycle, beginnings, change, metamorphosis","fear of change, holding on, stagnation, decay"),n.createCard("temperance","middle path, patience, finding meaning","extremes, excess, lack of balance"),n.createCard("the devil","addiction, materialism, playfulness","freedom, release, restoring control"),n.createCard("the tower","sudden upheaval, broken pride, disaster","disaster avoided, delayed disaster, fear of suffering"),n.createCard("the star","hope, faith, rejuvenation","faithlessness, discouragement, insecurity"),n.createCard("the moon","unconscious, illusions, intuition","confusion, fear, misinterpretation"),n.createCard("the sun","joy, success, celebration, positivity","negativity, depression, sadness"),n.createCard("judgement","reflection, reckoning, awakening","lack of self awareness, doubt, self loathing"),n.createCard("the world","fulfillment, harmony, completion","incompletion, no closure")];return n.state={deck:r,draws:[]},n}return Object(l.a)(a,[{key:"createCard",value:function(e,t,a){return{id:N.guid(),name:e,meanings:{upright:t,reversed:a}}}},{key:"drawCards",value:function(e){for(var t=this,a=[],n=function(){var e=N.randomNumber(t.state.deck.length),n=t.state.deck[e];a.find((function(e){return e.cardID===n.id}))||a.push({id:N.guid(),cardID:n.id,reversed:N.randomBoolean()})};a.length<e;)n();this.setState({draws:a})}},{key:"render",value:function(){var e=this;try{var t=this.state.draws.map((function(t){var a=e.state.deck.find((function(e){return e.id===t.cardID}));return a?r.a.createElement(d.a,{span:8,key:t.id},r.a.createElement(Wa,{card:a,reversed:t.reversed})):null}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.drawCards(3)}},"draw cards"),r.a.createElement(p.a,null,t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Wa=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={flipped:!1},n}return Object(l.a)(a,[{key:"flip",value:function(){this.setState({flipped:!this.state.flipped})}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:this.state.flipped?"oracle-card flipped":"oracle-card",onClick:function(){return e.flip()}},r.a.createElement("div",{className:"oracle-card-inner"},r.a.createElement("div",{className:"oracle-card-front"},"?"),r.a.createElement("div",{className:"oracle-card-back"},r.a.createElement("div",{className:"oracle-card-name"},this.props.card.name),r.a.createElement("div",{className:"oracle-card-reversed"},this.props.reversed?"(reversed)":""),r.a.createElement("div",{className:"oracle-card-meaning"},this.props.reversed?this.props.card.meanings.reversed:this.props.card.meanings.upright))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),_a=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"die":t=r.a.createElement(Ra,{dice:this.props.dice,constant:this.props.constant,setDie:function(t,a){return e.props.setDie(t,a)},setConstant:function(t){return e.props.setConstant(t)},resetDice:function(){return e.props.resetDice()}});break;case"handout":t=r.a.createElement(La,null);break;case"language":t=r.a.createElement(Ba,null);break;case"oracle":t=r.a.createElement(Ha,null)}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"tools"),r.a.createElement(ue,{options:[{id:"die",text:"die roller"},{id:"handout",text:"handout"},{id:"language",text:"language"},{id:"oracle",text:"oracle"}],selectedID:this.props.view,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ja=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).saveAfterDelay=N.debounce((function(){return n.saveAll()}),5e3);var r=[];try{var s=window.localStorage.getItem("data-parties");s&&(r=JSON.parse(s))}catch(f){console.error("Could not parse JSON: ",f)}var i=[];try{var o=window.localStorage.getItem("data-library");o&&(i=JSON.parse(o)).forEach((function(e){e.monsters.forEach((function(e){if(void 0===e.legendaryActions){var t=e.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))?3:0;e.legendaryActions=t}e.role=w.getRole(e)}))}))}catch(f){console.error("Could not parse JSON: ",f)}var l=[];try{var u=window.localStorage.getItem("data-encounters");u&&(l=JSON.parse(u)).forEach((function(e){e.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})),e.waves.forEach((function(e){e.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}))}))}))}catch(f){console.error("Could not parse JSON: ",f)}var m=[];try{var p=window.localStorage.getItem("data-maps");p&&(m=JSON.parse(p))}catch(f){console.error("Could not parse JSON: ",f)}var d=[];try{var h=window.localStorage.getItem("data-combats");h&&(d=JSON.parse(h)).forEach((function(e){e.combatants.forEach((function(e){if(void 0===e.faction)switch(e.type){case"pc":case"companion":e.faction="ally";break;case"monster":e.faction="foe";break;default:e.faction="neutral"}void 0===e.note&&(e.note=""),void 0===e.mountID&&(e.mountID=null),void 0===e.mountType&&(e.mountType="controlled")})),e.encounter&&(e.encounter.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})),e.encounter.waves.forEach((function(e){e.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}))}))),e.map&&void 0===e.map.notes&&(e.map.notes=[]),void 0===e.fog&&(e.fog=[]),void 0===e.report&&(e.report=[])}))}catch(f){console.error("Could not parse JSON: ",f)}return n.state={view:"home",drawer:null,sidebar:null,parties:r,library:i,encounters:l,maps:m,combats:d,selectedPartyID:null,selectedMonsterGroupID:null,selectedEncounterID:null,selectedCombatID:null},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;v.a.bind("ctrl+f",(function(t){t.preventDefault(),e.setSidebar("search")}))}},{key:"componentWillUnmount",value:function(){v.a.unbind("ctrl+f")}},{key:"componentDidUpdate",value:function(){this.saveAfterDelay()}},{key:"setView",value:function(e){this.save(),this.setState({view:e})}},{key:"setSidebar",value:function(e){if(e)switch(e){case"tools":var t={};[4,6,8,10,12,20,100].forEach((function(e){return t[e]=0})),this.setState({sidebar:{type:"tools",subtype:"die",dice:t,constant:0}});break;case"generators":this.setState({sidebar:{type:"generators",subtype:"name"}});break;case"reference":this.setState({sidebar:{type:"reference",subtype:"skills",selectedPartyID:null,selectedMonsterID:null}});break;default:this.setState({sidebar:{type:e}})}else this.setState({sidebar:null})}},{key:"closeDrawer",value:function(){this.setState({drawer:null})}},{key:"selectParty",value:function(e){this.setState({selectedPartyID:e?e.id:null})}},{key:"selectMonsterGroup",value:function(e){this.setState({selectedMonsterGroupID:e?e.id:null})}},{key:"selectEncounter",value:function(e){this.setState({selectedEncounterID:e?e.id:null})}},{key:"selectPartyByID",value:function(e){this.save(),this.setState({view:"parties",selectedPartyID:e})}},{key:"selectMonsterGroupByID",value:function(e){this.save(),this.setState({view:"library",selectedMonsterGroupID:e})}},{key:"selectEncounterByID",value:function(e){this.save(),this.setState({view:"encounters"})}},{key:"selectMapByID",value:function(e){this.save(),this.setState({view:"maps"})}},{key:"setDice",value:function(e,t,a){var n={};[4,6,8,10,12,20,100].forEach((function(e){return n[e]=0})),n[t]=e,this.setState({sidebar:{type:"tools",subtype:"die",dice:n,constant:a}})}},{key:"resetAll",value:function(){var e=this;this.setState({parties:[],library:[],encounters:[],maps:[],combats:[],selectedPartyID:null,selectedMonsterGroupID:null,selectedCombatID:null},(function(){e.saveAll();for(var t=0;t!==window.localStorage.length;++t){var a=window.localStorage.key(t);a&&window.localStorage.removeItem(a)}}))}},{key:"getMonster",value:function(e,t){var a=this.state.library.find((function(e){return e.name===t}));if(a){var n=a.monsters.find((function(t){return t.name===e}));if(n)return n}return null}},{key:"changeValue",value:function(e,t,a){for(var n=this,r=t.split("."),s=e,i=0;i!==r.length;++i){var o=r[i];i===r.length-1?s[o]=a:s=s[o]}if(N.sort(this.state.parties),N.sort(this.state.library),N.sort(this.state.encounters),"initiative"===t&&!e.pending){var c=this.state.combats.find((function(e){return e.id===n.state.selectedCombatID}));D.sortCombatants(c)}if("mountID"===t){var l=this.state.combats.find((function(e){return e.id===n.state.selectedCombatID}));l&&this.setMountPositions(l)}this.setState({parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,combats:this.state.combats,selectedPartyID:this.state.selectedPartyID,selectedMonsterGroupID:this.state.selectedMonsterGroupID,selectedCombatID:this.state.selectedCombatID,drawer:this.state.drawer})}},{key:"nudgeValue",value:function(e,t,a){for(var n=t.split("."),r=e,s=0;s!==n.length;++s){var i=n[s];if(s===n.length-1){var o=null;switch(i){case"challenge":o=N.nudgeChallenge(r[i],a);break;case"size":case"displaySize":o=N.nudgeSize(r[i],a);break;default:o=r[i]+a}this.changeValue(e,t,o)}else r=r[i]}}},{key:"addParty",value:function(){var e=C.createParty();e.name="new party";var t=[].concat(this.state.parties,[e]);N.sort(t),this.setState({parties:t,selectedPartyID:e.id})}},{key:"removeCurrentParty",value:function(){var e=this,t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));t&&this.removeParty(t)}},{key:"removeParty",value:function(e){var t=this.state.parties.indexOf(e);this.state.parties.splice(t,1),this.setState({parties:this.state.parties,selectedPartyID:null})}},{key:"importParty",value:function(){this.setState({drawer:{type:"import-party",party:C.createParty()}})}},{key:"acceptImportedParty",value:function(){this.state.parties.push(this.state.drawer.party),this.setState({parties:this.state.parties,drawer:null})}},{key:"removePC",value:function(e){var t=this,a=this.state.parties.find((function(e){return e.id===t.state.selectedPartyID}));if(a){var n=a.pcs.indexOf(e);a.pcs.splice(n,1),this.setState({parties:this.state.parties})}}},{key:"editPC",value:function(e){e||((e=C.createPC()).name="new pc");var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"pc",pc:t}})}},{key:"importPC",value:function(){this.setState({drawer:{type:"import-pc",pc:C.createPC()}})}},{key:"acceptImportedPC",value:function(){var e=this,t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));t&&(t.pcs.push(this.state.drawer.pc),N.sort(t.pcs),this.setState({parties:this.state.parties,drawer:null}))}},{key:"updatePC",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"update-pc",pc:t}})}},{key:"savePC",value:function(){var e=this;N.sort(this.state.drawer.pc.companions);var t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));if(t){var a=t.pcs.find((function(t){return t.id===e.state.drawer.pc.id}));if(a){var n=t.pcs.indexOf(a);t.pcs[n]=this.state.drawer.pc}else t.pcs.push(this.state.drawer.pc);N.sort(t.pcs),this.setState({parties:this.state.parties,drawer:null})}}},{key:"addMonsterGroup",value:function(){var e=C.createMonsterGroup();e.name="new group";var t=[].concat(this.state.library,[e]);N.sort(t),this.setState({library:t,selectedMonsterGroupID:e.id})}},{key:"importMonsterGroup",value:function(){this.setState({drawer:{type:"import-group",group:C.createMonsterGroup()}})}},{key:"acceptImportedGroup",value:function(){this.state.library.push(this.state.drawer.group),this.setState({library:this.state.library,drawer:null})}},{key:"removeCurrentMonsterGroup",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));t&&this.removeMonsterGroup(t)}},{key:"removeMonsterGroup",value:function(e){var t=this.state.library.indexOf(e);this.state.library.splice(t,1),this.setState({library:this.state.library,selectedMonsterGroupID:null})}},{key:"removeMonster",value:function(e){var t=this,a=this.state.library.find((function(e){return e.id===t.state.selectedMonsterGroupID}));if(a){var n=a.monsters.indexOf(e);a.monsters.splice(n,1),this.setState({library:this.state.library})}}},{key:"importMonster",value:function(){this.setState({drawer:{type:"import-monster",monster:C.createMonster()}})}},{key:"acceptImportedMonster",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));t&&(t.monsters.push(this.state.drawer.monster),N.sort(t.monsters),this.setState({library:this.state.library,drawer:null}))}},{key:"moveToGroup",value:function(e,t){var a=this.state.library.find((function(t){return t.monsters.includes(e)}));if(a){var n=a.monsters.indexOf(e);a.monsters.splice(n,1);var r=this.state.library.find((function(e){return e.id===t}));r&&(r.monsters.push(e),N.sort(r.monsters),this.setState({library:this.state.library}))}}},{key:"addMonster",value:function(e){var t=this;if(e){var a=this.state.library.find((function(e){return e.id===t.state.selectedMonsterGroupID}));a&&(a.monsters.push(e),N.sort(a.monsters),this.setState({library:this.state.library,drawer:{type:"statblock",source:e}}))}else{(e=C.createMonster()).name="new monster";var n=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:n,showSidebar:!1}})}}},{key:"editMonster",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:t,showSidebar:!1}})}},{key:"saveMonster",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));if(t){var a=t.monsters.find((function(t){return t.id===e.state.drawer.monster.id}));if(a){var n=t.monsters.indexOf(a);t.monsters[n]=this.state.drawer.monster}else t.monsters.push(this.state.drawer.monster);N.sort(t.monsters),this.setState({library:this.state.library,drawer:null})}}},{key:"toggleShowSidebar",value:function(){var e=this.state.drawer;e.showSidebar=!e.showSidebar,this.setState({drawer:e})}},{key:"cloneMonster",value:function(e,t){var a=this.state.library.find((function(t){return t.monsters.includes(e)}));if(a){var n=w.clone(e,t);a.monsters.push(n),N.sort(a.monsters),this.setState({library:this.state.library})}}},{key:"addOpenGameContent",value:function(){var e=this;fetch("/dojo/data/monsters.json").then((function(e){return e.json()})).then((function(t){t.forEach((function(t){try{if(t.name){var a=w.createFromJSON(t),n=a.tag||a.category;0===n.indexOf("swarm")&&(n="swarm"),"any race"===n&&(n="npc");var r=e.state.library.find((function(e){return e.name===n}));r||(r={id:N.guid(),name:n,monsters:[]},e.state.library.push(r)),r.monsters.push(a)}}catch(s){console.error(s)}})),N.sort(e.state.library),e.setState({library:e.state.library})}))}},{key:"openDemographics",value:function(e){this.setState({drawer:{type:"monster-demographics",group:e}})}},{key:"addEncounter",value:function(e){var t=C.createEncounter();if(t.name="new encounter",e){var a=D.encounterTemplates().find((function(t){return t.name===e}));a&&(t.name="new "+e+" encounter",t.slots=a.slots.map((function(e){var t=C.createEncounterSlot();return t.roles=e.roles,t.count=e.count,t})),t.waves=[])}var n=JSON.parse(JSON.stringify(t));this.setState({drawer:{type:"encounter-edit",encounter:n}})}},{key:"editEncounter",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"encounter-edit",encounter:t}})}},{key:"saveEncounter",value:function(){var e=this,t=this.state.encounters,a=this.state.encounters.find((function(t){return t.id===e.state.drawer.encounter.id}));a?t[this.state.encounters.indexOf(a)]=this.state.drawer.encounter:t.push(this.state.drawer.encounter);N.sort(t),this.setState({encounters:t,drawer:null})}},{key:"removeEncounter",value:function(e){var t=this.state.encounters.indexOf(e);this.state.encounters.splice(t,1),this.setState({encounters:this.state.encounters,selectedEncounterID:null})}},{key:"generateMap",value:function(e){var t=C.createMap();t.name="new "+e,O.generate(e,t),this.state.maps.push(t),this.setState({maps:this.state.maps})}},{key:"viewMap",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"map-view",map:t,fog:[],partyID:null,combatants:[]}})}},{key:"editMap",value:function(e){e||((e=C.createMap()).name="new map");var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"map-edit",map:t}})}},{key:"saveMap",value:function(){var e=this,t=this.state.maps,a=this.state.maps.find((function(t){return t.id===e.state.drawer.map.id}));a?t[this.state.maps.indexOf(a)]=this.state.drawer.map:t.push(this.state.drawer.map);N.sort(t),this.setState({maps:t,drawer:null})}},{key:"importMap",value:function(){var e=C.createMap();this.setState({drawer:{type:"import-map",map:e}})}},{key:"acceptImportedMap",value:function(){this.state.maps.push(this.state.drawer.map),this.setState({maps:this.state.maps,drawer:null})}},{key:"declineImportedMap",value:function(){if(this.state.drawer.map.items.length>0){var e=this.state.drawer.map.items[0].customBackground;window.localStorage.removeItem("image-"+e)}this.closeDrawer()}},{key:"removeMap",value:function(e){var t=this.state.maps.indexOf(e);this.state.maps.splice(t,1),this.setState({maps:this.state.maps})}},{key:"createCombat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=1===this.state.parties.length?this.state.parties[0]:null;if(t){var i=this.state.parties.find((function(e){return e.id===t}));i&&(s=i)}var o=1===this.state.encounters.length?this.state.encounters[0]:null;e&&(o=e);var c=C.createCombatSetup();c.party=JSON.parse(JSON.stringify(s)),c.encounter=JSON.parse(JSON.stringify(e)),o&&(c.slotInfo=N.getCombatSlotData(o,this.state.library)),a&&(c.map=a),c.fog=n,c.combatants=r,this.setState({drawer:{type:"combat-start",combatSetup:c}})}},{key:"startCombat",value:function(){var e=this,t=this.state.drawer.combatSetup;if(t.party&&t.encounter){var a=t.party.name||"unnamed party",n=t.encounter.name||"unnamed encounter",r=C.createCombat();r.name=a+" vs "+n,r.encounter=JSON.parse(JSON.stringify(t.encounter));var s=C.createCombatReportEntry();s.type="combat-start",r.report.push(s),t.combatants.forEach((function(e){r.combatants.push(e)})),t.party.pcs.filter((function(e){return e.active})).forEach((function(e){r.combatants.find((function(t){return t.id===e.id}))||r.combatants.push(D.convertPCToCombatant(e))})),r.encounter.slots.forEach((function(a){var n=e.getMonster(a.monsterName,a.monsterGroupName),s=t.slotInfo.find((function(e){return e.id===a.id}));n&&s?s.members.forEach((function(e){r.combatants.push(D.convertMonsterToCombatant(n,e.init,e.hp,e.name,a.faction))})):r.issues.push("unknown monster: "+a.monsterName+" in group "+a.monsterGroupName)})),r.combatants.push(D.convertPlaceholderToCombatant()),D.sortCombatants(r),t.map&&(r.map=JSON.parse(JSON.stringify(t.map)),r.fog=t.fog),this.setState({combats:[].concat(this.state.combats,[r]),selectedCombatID:r.id,drawer:null,view:"combat"})}}},{key:"openAddWaveModal",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t){var a=C.createCombatSetup();a.encounter=t.encounter,a.slotInfo=N.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:{type:"combat-wave",combatSetup:a}})}}},{key:"addWaveToCombat",value:function(){var e=this,t=this.state.drawer.combatSetup,a=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t&&t.encounter&&a){var n=t.encounter.waves.find((function(e){return e.id===t.waveID}));n&&(n.slots.forEach((function(n){var r=e.getMonster(n.monsterName,n.monsterGroupName),s=t.slotInfo.find((function(e){return e.id===n.id}));r&&s?s.members.forEach((function(e){a.combatants.push(D.convertMonsterToCombatant(r,e.init,e.hp,e.name,n.faction))})):a.issues.push("unknown monster: "+n.monsterName+" in group "+n.monsterGroupName)})),D.sortCombatants(a),this.setState({combats:this.state.combats,drawer:null}))}}},{key:"openAddCombatantModal",value:function(){var e=this;if(this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}))){var t=C.createCombatSetup();t.encounter=C.createEncounter(),t.slotInfo=N.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:{type:"combat-add-combatants",combatSetup:t}})}}},{key:"addMonsterToAddCombatantsModal",value:function(e){var t=this.state.drawer.combatSetup;if(t&&t.encounter){var a=N.getMonsterGroup(e,this.state.library),n=C.createEncounterSlot();n.id=e.id,n.monsterName=e.name,n.monsterGroupName=a.name,t.encounter.slots.push(n),t.slotInfo=N.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:this.state.drawer})}}},{key:"addCombatantsToCombat",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID})),a=this.state.drawer.combatSetup;t&&a&&a.encounter&&(a.encounter.slots.forEach((function(n){var r=e.getMonster(n.monsterName,n.monsterGroupName),s=a.slotInfo.find((function(e){return e.id===n.id}));r&&s?s.members.forEach((function(e){t.combatants.push(D.convertMonsterToCombatant(r,e.init,e.hp,e.name,n.faction))})):t.issues.push("unknown monster: "+n.monsterName+" in group "+n.monsterGroupName)})),D.sortCombatants(t),this.setState({combats:this.state.combats,drawer:null}))}},{key:"addPCToEncounter",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(n){var r=this.state.parties.find((function(t){return t.id===e}));if(r){var s=r.pcs.find((function(e){return e.id===t}));s&&(n.combatants.push(D.convertPCToCombatant(s)),this.setState({combats:this.state.combats}))}}}},{key:"addCompanionToEncounter",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(a.combatants.push(D.convertCompanionToCombatant(e)),this.setState({combats:this.state.combats}))}},{key:"pauseCombat",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t){var a=C.createCombatReportEntry();a.type="combat-pause",t.report.push(a),this.setState({selectedCombatID:null})}}},{key:"resumeCombat",value:function(e){var t=C.createCombatReportEntry();t.type="combat-resume",e.report.push(t),this.setState({selectedCombatID:e.id})}},{key:"endCombat",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t){var n=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));n&&(t=n)}if(t){var r=C.createCombatReportEntry();r.type="combat-end",t.report.push(r);var s=this.state.combats.indexOf(t);this.state.combats.splice(s,1),this.setState({combats:this.state.combats,selectedCombatID:null},(function(){if(t&&t.map&&a){var n=t.combatants.filter((function(e){return"pc"===e.type||"companion"===e.type}));n.forEach((function(e){e.pending=!1,e.active=!0,e.defeated=!1,e.current=!1}));var r=null,s=t.combatants.filter((function(e){return"pc"===e.type}));if(s.length>0){var i=e.state.parties.find((function(e){return e.pcs.find((function(e){return e.id===s[0].id}))}));i&&(r=i.id,i.pcs.forEach((function(e){n.find((function(t){return t.id===e.id}))||n.push(D.convertPCToCombatant(e)),e.companions.forEach((function(e){n.find((function(t){return t.id===e.id}))||n.push(D.convertCompanionToCombatant(e))}))})))}N.sort(n,[{field:"displayName",dir:"asc"}]),e.setState({view:"maps",drawer:{type:"map-view",map:t.map,fog:t.fog,partyID:r,combatants:n}})}}))}}},{key:"makeCurrent",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(n){if(n.combatants.filter((function(e){return e.conditions})).forEach((function(t){t.conditions.forEach((function(a){if(a.duration)switch(a.duration.type){case"saves":e&&t.id===e.id&&"start"===a.duration.point&&n.notifications.push({id:N.guid(),type:"condition-save",data:a,combatant:t});break;case"combatant":if(e&&(a.duration.combatantID===e.id||null===a.duration.combatantID)&&"start"===a.duration.point){var r=t.conditions.indexOf(a);t.conditions.splice(r,1),n.notifications.push({id:N.guid(),type:"condition-end",data:a,combatant:t})}break;case"rounds":if(e&&t.id===e.id&&(a.duration.count-=1),0===a.duration.count){var s=t.conditions.indexOf(a);t.conditions.splice(s,1),n&&n.notifications.push({id:N.guid(),type:"condition-end",data:a,combatant:t})}}}))})),e&&"monster"===e.type&&(e.traits.filter((function(e){return e.uses>0&&e.usage.toLowerCase().startsWith("recharge ")})).forEach((function(t){n.notifications.push({id:N.guid(),type:"trait-recharge",data:t,combatant:e})})),e.traits.filter((function(e){return"legendary"===e.type||"mythic"===e.type})).forEach((function(e){e.uses=0}))),n.combatants.forEach((function(e){e.current=!1})),e&&(e.current=!0,"pc"===e.type)){var r=C.createCombatReportEntry();r.type="turn-start",r.combatantID=e.id,n.report.push(r)}t&&(n.round+=1),this.setState({combats:this.state.combats})}}},{key:"makeActive",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=e.some((function(e){return e.pending}));e.forEach((function(e){e.pending=!1,e.active=!0,e.defeated=!1})),n&&D.sortCombatants(a),this.setState({combats:this.state.combats})}}},{key:"makeDefeated",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=a.combatants.find((function(e){return e.current}));e.forEach((function(e){if(e.pending=!1,e.active=!1,e.defeated=!0,e.mountID=null,e.mountType="controlled",a.combatants.forEach((function(t){t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")})),a.combatants.forEach((function(t){t.tags=t.tags.filter((function(t){return t!=="engaged:"+e.displayName}))})),a.map&&(a.map.items=a.map.items.filter((function(t){return t.id!==e.id}))),n&&"pc"===n.type&&"monster"===e.type){var t=C.createCombatReportEntry();t.type="kill",t.combatantID=n.id,a.report.push(t)}})),n&&e.find((function(e){return e.id===n.id}))?this.endTurn(n):this.setState({combats:this.state.combats})}}},{key:"useTrait",value:function(e,t){t.uses+=1,this.setState({combats:this.state.combats})}},{key:"rechargeTrait",value:function(e,t){t.uses=0,this.setState({combats:this.state.combats})}},{key:"removeCombatants",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(e.forEach((function(e){var t=a.combatants.indexOf(e);if(a.combatants.splice(t,1),a.combatants.forEach((function(t){t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")})),a.combatants.forEach((function(t){t.tags=t.tags.filter((function(t){return t!=="engaged:"+e.displayName}))})),a.map){var n=a.map.items.find((function(t){return t.id===e.id}));if(n){var r=a.map.items.indexOf(n);a.map.items.splice(r,1)}}})),this.setState({combats:this.state.combats}))}},{key:"endTurn",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){if("pc"===e.type){var n=C.createCombatReportEntry();n.type="turn-end",n.combatantID=e.id,a.report.push(n)}a.combatants.filter((function(e){return e.conditions})).forEach((function(t){t.conditions.forEach((function(n){if(n.duration)switch(n.duration.type){case"saves":if(t.id===e.id&&"end"===n.duration.point){var r=C.createNotification();r.type="condition-save",r.data=n,r.combatant=t,a.notifications.push(r)}break;case"combatant":if((n.duration.combatantID===e.id||null===n.duration.combatantID)&&"end"===n.duration.point){var s=t.conditions.indexOf(n);t.conditions.splice(s,1);var i=C.createNotification();i.type="condition-end",i.data=n,i.combatant=t,a.notifications.push(i)}}}))}));var r=a.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),s=a.combatants.filter((function(e){return!r.includes(e.id)})).filter((function(e){return e.current||!e.pending&&e.active&&!e.defeated})).filter((function(e){return"placeholder"!==e.type||D.combatHasLairActions(a)}));if(0===s.length)this.makeCurrent(null,!1);else if(1===s.length&&s[0].defeated)this.makeCurrent(null,!1);else{var i=s.indexOf(e)+1,o=!1;i>=s.length&&(i=0,o=!0),this.makeCurrent(s[i],o)}}}},{key:"changeHP",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(e.forEach((function(e){var t=a.combatants.find((function(t){return t.id===e.id}));t&&(t.hpCurrent=e.hp,t.hpTemp=e.temp);var n=a.combatants.find((function(e){return e.current}));if(n&&"pc"===n.type){var r=C.createCombatReportEntry();r.type="damage",r.combatantID=n.id,r.value=e.damage,a.report.push(r)}})),this.setState({combats:this.state.combats}))}},{key:"toggleTag",value:function(e,t){e.forEach((function(e){e.tags.includes(t)?e.tags=e.tags.filter((function(e){return e!==t})):e.tags.push(t)})),this.setState({combats:this.state.combats,drawer:this.state.drawer})}},{key:"toggleCondition",value:function(e,t){var a=this;e.forEach((function(e){var n=e.conditions.find((function(e){return e.name===t}));if(n)a.removeCondition(e,n);else{var r=C.createCondition();r.name=t,e.conditions.push(r),e.conditions=N.sort(e.conditions,[{field:"name",dir:"asc"}]);var s=a.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(s){var i=s.combatants.find((function(e){return e.current}));if(i&&"pc"===i.type){var o=C.createCombatReportEntry();o.type="condition-add",o.combatantID=i.id,s.report.push(o)}}}})),this.setState({combats:this.state.combats,drawer:this.state.drawer})}},{key:"toggleHidden",value:function(e){e.forEach((function(e){e.showOnMap=!e.showOnMap})),this.setState({combats:this.state.combats,drawer:this.state.drawer})}},{key:"mapAdd",value:function(e,t,a){var n=this,r=this.state.combats.find((function(e){return e.id===n.state.selectedCombatID}));if(r){var s=[e];if(e.mountID){var i=r.combatants.find((function(t){return t.id===e.mountID}));i&&s.push(i)}s.forEach((function(e){if(r.map){var n=s.map((function(e){return e.id}));r.map.items=r.map.items.filter((function(e){return!n.includes(e.id)}))}var i=C.createMapItem();i.id=e.id,i.type=e.type,i.x=t,i.y=a;var o=N.miniSize(e.displaySize);i.height=o,i.width=o,r.map&&r.map.items.push(i)})),this.setState({combats:this.state.combats})}}},{key:"mapMove",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));n&&(e.forEach((function(e){if(n.map){var a=n.map.items.find((function(t){return t.id===e}));if(a){switch(t){case"N":a.y-=1;break;case"NE":a.x+=1,a.y-=1;break;case"E":a.x+=1;break;case"SE":a.x+=1,a.y+=1;break;case"S":a.y+=1;break;case"SW":a.x-=1,a.y+=1;break;case"W":a.x-=1;break;case"NW":a.x-=1,a.y-=1}if("pc"===a.type){var r=C.createCombatReportEntry();r.type="movement",r.combatantID=a.id,n.report.push(r)}}}})),this.setMountPositions(n),this.setState({combats:this.state.combats}))}},{key:"mapRemove",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=Object(o.a)(e);e.forEach((function(e){var t=a.combatants.find((function(t){return t.id===e}));t&&t.mountID&&n.push(t.mountID)})),n.forEach((function(e){if(a.map){var t=a.map.items.find((function(t){return t.id===e}));if(t){var n=a.map.items.indexOf(t);a.map.items.splice(n,1)}}})),this.setState({combats:this.state.combats})}}},{key:"mapAddNote",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a&&a.map){var n=C.createMapNote();n.targetID=e,a.map.notes.push(n),this.setState({combats:this.state.combats})}}},{key:"mapRemoveNote",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a&&a.map){var n=a.map.notes.findIndex((function(t){return t.targetID===e}));a.map.notes.splice(n,1),this.setState({combats:this.state.combats})}}},{key:"scatterCombatants",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&a.map&&(O.scatterCombatants(a,e),this.setMountPositions(a),this.setState({combats:this.state.combats}))}},{key:"rotateMap",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));t&&t.map&&(O.rotateMap(t.map),this.setState({combats:this.state.combats}))}},{key:"setFog",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(a.fog=e,this.setState({combats:this.state.combats}))}},{key:"addMapItem",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&a.map&&(a.map.items.push(e),this.setState({combats:this.state.combats}))}},{key:"setMountPositions",value:function(e){e.combatants.forEach((function(t){if(t.mountID&&e.map){var a=e.map.items.find((function(e){return e.id===t.id})),n=e.map.items.find((function(e){return e.id===t.mountID}));a&&n&&(n.x=a.x,n.y=a.y)}}))}},{key:"addCondition",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=C.createCondition();n.name="blinded",this.setState({drawer:{type:"condition-add",condition:n,combatants:e,allCombatants:a.combatants}})}}},{key:"addConditionFromModal",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));t&&(this.state.drawer.combatants.forEach((function(a){var n=JSON.parse(JSON.stringify(e.state.drawer.condition));n.id=N.guid(),a.conditions.push(n),N.sort(a.conditions,[{field:"name",dir:"asc"}]);var r=t.combatants.find((function(e){return e.current}));if(r&&"pc"===r.type){var s=C.createCombatReportEntry();s.type="condition-add",s.combatantID=r.id,t.report.push(s)}})),this.setState({combats:this.state.combats,drawer:null}))}},{key:"quickAddCondition",value:function(e,t){e.forEach((function(e){if(!e.conditions.some((function(e){return e.name===t.name}))){var a=JSON.parse(JSON.stringify(t));e.conditions.push(a)}})),this.setState({combats:this.state.combats,drawer:this.state.drawer})}},{key:"editCondition",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));n&&this.setState({drawer:{type:"condition-edit",condition:t,combatants:[e],allCombatants:n.combatants}})}},{key:"editConditionFromModal",value:function(){var e=this;this.state.drawer.combatants.forEach((function(t){var a=t.conditions.find((function(t){return t.id===e.state.drawer.condition.id}));if(a){var n=t.conditions.indexOf(a);t.conditions[n]=e.state.drawer.condition,N.sort(t.conditions,[{field:"name",dir:"asc"}])}})),this.setState({combats:this.state.combats,drawer:null})}},{key:"removeCondition",value:function(e,t){var a=this,n=e.conditions.indexOf(t);e.conditions.splice(n,1);var r=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(r){var s=r.combatants.find((function(e){return e.current}));if(s&&"pc"===s.type){var i=C.createCombatReportEntry();i.type="condition-remove",i.combatantID=s.id,r.report.push(i)}}this.setState({combats:this.state.combats,drawer:this.state.drawer})}},{key:"closeNotification",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(n){var r=n.notifications.indexOf(e);if(n.notifications.splice(r,1),t&&e.combatant&&e.data){var s=e.combatant.conditions.indexOf(e.data);e.combatant.conditions.splice(s,1)}this.setState({combats:this.state.combats})}}},{key:"showLeaderboard",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));t&&this.setState({drawer:{type:"leaderboard",combat:t}})}},{key:"save",value:function(){switch(this.state.view){case"parties":this.saveKey(this.state.parties,"data-parties");break;case"library":this.saveKey(this.state.library,"data-library");break;case"encounters":this.saveKey(this.state.encounters,"data-encounters");break;case"maps":this.saveKey(this.state.maps,"data-maps");break;case"combat":this.saveKey(this.state.combats,"data-combats")}}},{key:"saveAll",value:function(){this.saveKey(this.state.parties,"data-parties"),this.saveKey(this.state.library,"data-library"),this.saveKey(this.state.encounters,"data-encounters"),this.saveKey(this.state.maps,"data-maps"),this.saveKey(this.state.combats,"data-combats")}},{key:"saveKey",value:function(e,t){try{var a=JSON.stringify(e);console.info("Saving ("+t+"): "+N.toData(a.length)),window.localStorage.setItem(t,a)}catch(n){console.error("Could not stringify data: ",n)}}},{key:"getContent",value:function(){var e=this,t=!1;this.state.parties.forEach((function(e){return t=t||e.pcs.length>0}));var a=!1;switch(this.state.library.forEach((function(e){return a=a||e.monsters.length>0})),this.state.view){case"home":return r.a.createElement(sa,null);case"parties":return this.state.selectedPartyID?r.a.createElement(ha,{party:this.state.parties.find((function(t){return t.id===e.state.selectedPartyID})),goBack:function(){return e.selectParty(null)},removeParty:function(){return e.removeCurrentParty()},addPC:function(){return e.editPC(null)},importPC:function(){return e.importPC()},editPC:function(t){return e.editPC(t)},updatePC:function(t){return e.updatePC(t)},removePC:function(t){return e.removePC(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}):r.a.createElement(da,{parties:this.state.parties,encounters:this.state.encounters,addParty:function(){return e.addParty()},importParty:function(){return e.importParty()},selectParty:function(t){return e.selectParty(t)},deleteParty:function(t){return e.removeParty(t)},runEncounter:function(t,a){var n=e.state.encounters.find((function(e){return e.id===a}));n&&e.createCombat(n,t.id)},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})}});case"library":return this.state.selectedMonsterGroupID?r.a.createElement(ua,{monsterGroup:this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID})),library:this.state.library,goBack:function(){return e.selectMonsterGroup(null)},removeMonsterGroup:function(){return e.removeCurrentMonsterGroup()},openDemographics:function(t){return e.openDemographics(t)},addMonster:function(t){return e.addMonster(t)},importMonster:function(){return e.importMonster()},removeMonster:function(t){return e.removeMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},viewMonster:function(t){return e.setState({drawer:{type:"statblock",source:t}})},editMonster:function(t){return e.editMonster(t)},cloneMonster:function(t,a){return e.cloneMonster(t,a)},moveToGroup:function(t,a){return e.moveToGroup(t,a)}}):r.a.createElement(la,{library:this.state.library,hasMonsters:a,addMonsterGroup:function(){return e.addMonsterGroup()},importMonsterGroup:function(){return e.importMonsterGroup()},selectMonsterGroup:function(t){return e.selectMonsterGroup(t)},deleteMonsterGroup:function(t){return e.removeMonsterGroup(t)},addOpenGameContent:function(){return e.addOpenGameContent()},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})},openDemographics:function(t){return e.openDemographics(t)}});case"encounters":return this.state.selectedEncounterID?r.a.createElement(aa,{encounter:this.state.encounters.find((function(t){return t.id===e.state.selectedEncounterID})),parties:this.state.parties,edit:function(t){return e.editEncounter(t)},delete:function(t){return e.removeEncounter(t)},run:function(t,a){return e.createCombat(t,a)},getMonster:function(t,a){return e.getMonster(t,a)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},goBack:function(){return e.selectEncounter(null)}}):r.a.createElement(ea,{encounters:this.state.encounters,parties:this.state.parties,hasMonsters:a,addEncounter:function(t){return e.addEncounter(t)},viewEncounter:function(t){return e.selectEncounter(t)},editEncounter:function(t){return e.editEncounter(t)},deleteEncounter:function(t){return e.removeEncounter(t)},runEncounter:function(t,a){return e.createCombat(t,a)},getMonster:function(t,a){return e.getMonster(t,a)},setView:function(t){return e.setView(t)},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})}});case"maps":return r.a.createElement(oa,{maps:this.state.maps,addMap:function(){return e.editMap(null)},importMap:function(){return e.importMap()},generateMap:function(t){return e.generateMap(t)},viewMap:function(t){return e.viewMap(t)},editMap:function(t){return e.editMap(t)},deleteMap:function(t){return e.removeMap(t)}});case"combat":return this.state.selectedCombatID?r.a.createElement(Zt,{combat:this.state.combats.find((function(t){return t.id===e.state.selectedCombatID})),parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,pauseCombat:function(){return e.pauseCombat()},endCombat:function(t){return e.endCombat(null,t)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},makeCurrent:function(t){return e.makeCurrent(t,!1)},makeActive:function(t){return e.makeActive(t)},makeDefeated:function(t){return e.makeDefeated(t)},useTrait:function(t,a){return e.useTrait(t,a)},rechargeTrait:function(t,a){return e.rechargeTrait(t,a)},removeCombatants:function(t){return e.removeCombatants(t)},addCombatants:function(){return e.openAddCombatantModal()},addCompanion:function(t){return e.addCompanionToEncounter(t)},addPC:function(t,a){return e.addPCToEncounter(t,a)},addWave:function(){return e.openAddWaveModal()},addCondition:function(t){return e.addCondition(t)},editCondition:function(t,a){return e.editCondition(t,a)},removeCondition:function(t,a){return e.removeCondition(t,a)},mapAdd:function(t,a,n){return e.mapAdd(t,a,n)},mapMove:function(t,a){return e.mapMove(t,a)},mapRemove:function(t){return e.mapRemove(t)},mapAddNote:function(t){return e.mapAddNote(t)},mapRemoveNote:function(t){return e.mapRemoveNote(t)},endTurn:function(t){return e.endTurn(t)},changeHP:function(t){return e.changeHP(t)},closeNotification:function(t,a){return e.closeNotification(t,a)},toggleTag:function(t,a){return e.toggleTag(t,a)},toggleCondition:function(t,a){return e.toggleCondition(t,a)},toggleHidden:function(t){return e.toggleHidden(t)},scatterCombatants:function(t){return e.scatterCombatants(t)},rotateMap:function(){return e.rotateMap()},setFog:function(t){return e.setFog(t)},addOverlay:function(t){return e.addMapItem(t)},showLeaderboard:function(){return e.showLeaderboard()},onRollDice:function(t,a,n){return e.setDice(t,a,n)}}):r.a.createElement(Ht,{combats:this.state.combats,hasPCs:t,hasMonsters:a,createCombat:function(){return e.createCombat()},resumeCombat:function(t){return e.resumeCombat(t)},deleteCombat:function(t){return e.endCombat(t)},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})},setView:function(t){return e.setView(t)}})}return null}},{key:"getSidebar",value:function(){var e=this;if(!this.state.sidebar)return null;var t=null;switch(this.state.sidebar.type){case"tools":t=r.a.createElement(_a,{view:this.state.sidebar.subtype,setView:function(t){var a=e.state.sidebar;a.subtype=t,e.setState({sidebar:a})},dice:this.state.sidebar.dice,constant:this.state.sidebar.constant,setDie:function(t,a){var n=e.state.sidebar;n.dice[t]=a,e.setState({sidebar:n})},setConstant:function(t){var a=e.state.sidebar;a.constant=t,e.setState({sidebar:a})},resetDice:function(){var t=e.state.sidebar;[4,6,8,10,12,20,100].forEach((function(e){return t.dice[e]=0})),t.constant=0,e.setState({sidebar:t})}});break;case"generators":t=r.a.createElement(Ma,{view:this.state.sidebar.subtype,setView:function(t){var a=e.state.sidebar;a.subtype=t,e.setState({sidebar:a})}});break;case"reference":var a=[];this.state.library.forEach((function(e){e.monsters.forEach((function(e){return a.push(e)}))})),N.sort(a),t=r.a.createElement(Pa,{view:this.state.sidebar.subtype,setView:function(t){var a=e.state.sidebar;a.subtype=t,e.setState({sidebar:a})},selectedPartyID:this.state.sidebar.selectedPartyID,parties:this.state.parties,selectPartyID:function(t){var a=e.state.sidebar;a.selectedPartyID=t,e.setState({sidebar:a})},selectedMonsterID:this.state.sidebar.selectedMonsterID,monsters:a,selectMonsterID:function(t){var a=e.state.sidebar;a.selectedMonsterID=t,e.setState({sidebar:a})}});break;case"search":t=r.a.createElement(Aa,{parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,openParty:function(t){return e.selectPartyByID(t)},openGroup:function(t){return e.selectMonsterGroupByID(t)},openEncounter:function(t){return e.selectEncounterByID(t)},openMap:function(t){return e.selectMapByID(t)}});break;case"about":t=r.a.createElement(ga,{parties:this.state.parties,library:this.state.library,maps:this.state.maps,combats:this.state.combats,resetAll:function(){return e.resetAll()}})}return r.a.createElement("div",{className:"sidebar sidebar-right"},t)}},{key:"getDrawer",value:function(){var e=this,t=null,a=null,n=null,s="50%",i=!1;if(this.state.drawer)switch(this.state.drawer.type){case"statblock":t=r.a.createElement(_e,{source:this.state.drawer.source}),a="statblock",i=!0;break;case"import-party":t=r.a.createElement(Nt,{party:this.state.drawer.party}),a="import party",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedParty()}},"accept party"),i=!0;break;case"pc":t=r.a.createElement(bt,{pc:this.state.drawer.pc,library:this.state.library}),a="pc editor",n=r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.savePC()}},"save changes")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes")));break;case"import-pc":t=r.a.createElement(Ct,{pc:this.state.drawer.pc}),a="import pc",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedPC()}},"accept pc"),i=!0;break;case"update-pc":t=r.a.createElement(Ct,{pc:this.state.drawer.pc}),a="update pc",n=r.a.createElement("button",{onClick:function(){return e.savePC()}},"accept pc"),i=!0;break;case"import-group":t=r.a.createElement(Et,{group:this.state.drawer.group}),a="import monster group",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedGroup()}},"accept group"),i=!0;break;case"monster":t=r.a.createElement(ut,{monster:this.state.drawer.monster,library:this.state.library,showSidebar:this.state.drawer.showSidebar}),a="monster editor",n=r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:6},r.a.createElement("button",{onClick:function(){return e.saveMonster()}},"save changes")),r.a.createElement(d.a,{span:6},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes")),r.a.createElement(d.a,{span:12},r.a.createElement(j,{label:"advanced tools",checked:this.state.drawer.showSidebar,onChecked:function(){return e.toggleShowSidebar()}}))),s="85%";break;case"import-monster":t=r.a.createElement(kt,{monster:this.state.drawer.monster}),a="import monster",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedMonster()}},"accept monster"),i=!0;break;case"monster-demographics":t=r.a.createElement(Ge,{groups:this.state.drawer.group?[this.state.drawer.group]:this.state.library}),a="demographics",i=!0;break;case"encounter-edit":t=r.a.createElement(Je,{encounter:this.state.drawer.encounter,parties:this.state.parties,library:this.state.library,getMonster:function(t,a){return e.getMonster(t,a)}}),a="encounter editor",n=r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.saveEncounter()}},"save changes")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="75%";break;case"map-view":t=r.a.createElement(Vt,{map:this.state.drawer.map,fog:this.state.drawer.fog,partyID:this.state.drawer.partyID,combatants:this.state.drawer.combatants,parties:this.state.parties,startCombat:function(t,a,n,r){return e.createCombat(null,t,a,n,r)},toggleTag:function(t,a){return e.toggleTag(t,a)},toggleCondition:function(t,a){return e.toggleCondition(t,a)},toggleHidden:function(t){return e.toggleHidden(t)},quickAddCondition:function(t,a){return e.quickAddCondition(t,a)},removeCondition:function(t,a){return e.removeCondition(t,a)}}),a=this.state.drawer.map.name,s="75%",i=!0;break;case"map-edit":t=r.a.createElement(at,{map:this.state.drawer.map}),a="map editor",n=r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.saveMap()}},"save changes")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="85%";break;case"import-map":t=r.a.createElement(yt,{map:this.state.drawer.map}),a="import map",n=r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.acceptImportedMap()}},"save changes")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.declineImportedMap()}},"discard changes"))),s="75%",i=!1;break;case"combat-start":t=r.a.createElement(Se,{type:"start",combatSetup:this.state.drawer.combatSetup,parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,getMonster:function(t,a){return e.getMonster(t,a)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="start combat",n=r.a.createElement("button",{className:this.state.drawer.combatSetup.party&&this.state.drawer.combatSetup.encounter?"":"disabled",onClick:function(){return e.startCombat()}},"start combat"),s="75%",i=!0;break;case"combat-wave":t=r.a.createElement(Se,{type:"add-wave",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:function(t,a){return e.getMonster(t,a)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="add a wave",n=r.a.createElement("button",{className:null!==this.state.drawer.combatSetup.waveID?"":"disabled",onClick:function(){return e.addWaveToCombat()}},"add wave"),s="75%",i=!0;break;case"combat-add-combatants":t=r.a.createElement(Se,{type:"add-combatants",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:function(t,a){return e.getMonster(t,a)},addMonster:function(t){return e.addMonsterToAddCombatantsModal(t)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="add combatants",n=r.a.createElement("button",{className:null!==this.state.drawer.combatSetup.encounter?"":"disabled",onClick:function(){return e.addCombatantsToCombat()}},"add combatants"),s="75%",i=!0;break;case"condition-add":t=r.a.createElement(Re,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="add a condition",n=r.a.createElement("button",{onClick:function(){return e.addConditionFromModal()}},"add"),s="75%",i=!0;break;case"condition-edit":t=r.a.createElement(Re,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="edit condition",n=r.a.createElement(p.a,{gutter:10},r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.editConditionFromModal()}},"save changes")),r.a.createElement(d.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="75%";break;case"leaderboard":t=r.a.createElement(xt,{combat:this.state.drawer.combat}),a="leaderboard",i=!0}return{content:t,header:a,footer:n,width:s,closable:i}}},{key:"render",value:function(){var e=this;try{var t=this.getSidebar(),a=this.getDrawer();return r.a.createElement("div",{className:"dojo"},r.a.createElement(Ya,null,r.a.createElement(Ft,{sidebar:this.state.sidebar?this.state.sidebar.type:null,onSelectSidebar:function(t){return e.setSidebar(t)}})),r.a.createElement("div",{className:"page-content"},r.a.createElement(Ya,null,r.a.createElement("div",{className:this.state.sidebar?"content with-sidebar":"content"},this.getContent())),r.a.createElement(Ya,null,t)),r.a.createElement(Ya,null,r.a.createElement(Pt,{view:this.state.view,onSelectView:function(t){return e.setView(t)}})),r.a.createElement(Ya,null,r.a.createElement(h.a,{closable:!1,maskClosable:a.closable,width:a.width,visible:null!==a.content,onClose:function(){return e.closeDrawer()}},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},a.header)),r.a.createElement("div",{className:"drawer-content"},a.content),r.a.createElement("div",{className:"drawer-footer"},a.footer))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ya=function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={hasError:!1},n}return Object(l.a)(a,[{key:"componentDidCatch",value:function(e,t){console.error(e.name),console.error(e.message),console.error(e.stack),console.error(t.componentStack)}},{key:"render",value:function(){return this.state.hasError?r.a.createElement("div",{className:"render-error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),a}(r.a.Component);i.a.render(r.a.createElement(Ja,null),document.getElementById("root"))},96:function(e){e.exports=JSON.parse('{"name":"dojo","version":"8.17.0","license":"MIT","repository":"https://github.com/andyaiken/dojo.git","homepage":"https://andyaiken.github.io/dojo/","dependencies":{"@ant-design/icons":"^4.2.1","antd":"^4.3.4","mousetrap":"^1.6.5","react":"^16.13.1","react-debounce-input":"^3.2.2","react-dom":"^16.13.1","react-movable":"^2.5.0","showdown":"^1.9.1"},"devDependencies":{"@types/mousetrap":"^1.6.3","@types/react":"^16.9.38","@types/react-dom":"^16.9.8","@types/showdown":"^1.9.3","gh-pages":"^2.2.0","node-sass":"^4.14.0","react-scripts":"^3.4.1","tslint":"^5.20.1","tslint-react":"^3.6.0","typescript":"^3.9.5"},"scripts":{"update":"npm update && npm update --save-dev","start":"react-scripts start --display-error-details","lint":"tslint --config tslint.json --format verbose \'src/**/*.{ts,tsx}\'","predeploy":"react-scripts build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":["eslint-recommended","react-app"]},"browserslist":[">0.2%","not dead","not ie <= 11","not op_mini all"]}')}},[[100,1,2]]]);