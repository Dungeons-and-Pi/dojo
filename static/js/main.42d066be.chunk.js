(this.webpackJsonpdojo=this.webpackJsonpdojo||[]).push([[0],{102:function(e){e.exports=JSON.parse('{"name":"dojo","version":"12.1.0","license":"MIT","repository":"https://github.com/andyaiken/dojo.git","homepage":"https://andyaiken.github.io/dojo/","dependencies":{"@ant-design/icons":"^4.4.0","antd":"^4.12.2","lz-string":"^1.4.4","mousetrap":"^1.6.5","peerjs":"^1.3.1","react":"^17.0.1","react-debounce-input":"^3.2.3","react-dom":"^17.0.1","react-movable":"^2.5.3","react-pdf":"^5.1.0","react-router-dom":"^5.2.0","recursive-diff":"^1.0.8","showdown":"^1.9.1","uuid":"^8.3.2"},"devDependencies":{"@types/lz-string":"^1.3.34","@types/mousetrap":"^1.6.5","@types/react":"^16.14.3","@types/react-dom":"^16.9.10","@types/react-pdf":"^4.0.6","@types/react-router-dom":"^5.1.7","@types/showdown":"^1.9.3","@types/uuid":"^8.3.0","gh-pages":"^2.2.0","node-sass":"^4.14.0","react-scripts":"^3.4.4","tslint":"^5.20.1","tslint-microsoft-contrib":"^6.2.0","tslint-react":"^3.6.0","typescript":"^4.1.3"},"scripts":{"start":"react-scripts start --display-error-details","lint":"tslint --config tslint.json --format verbose \'src/**/*.{ts,tsx}\'","predeploy":"react-scripts build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":["eslint-recommended","react-app"]},"browserslist":[">0.2%","not dead","not ie <= 11","not op_mini all"]}')},115:function(e,t,a){e.exports=a(153)},120:function(e,t,a){},121:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=121},144:function(e,t){},145:function(e,t){},146:function(e,t){},147:function(e,t){},148:function(e,t){},153:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(25),i=a.n(r),o=(a(120),a(104)),l=a(24),c=a(111),d=a(163),p=a(166),h=a(168),m=a(164),u=a(39),g=a.n(u),y=a(165);class b{static guid(e=!1){if(e){const e="abcdefghijklmnopqrstuvwxyz";let t="";for(;t.length<6;){t+=e[b.randomNumber(e.length)]}return t}return Object(y.a)()}static sort(e,t=[]){0===t.length&&(t=[{field:"name",dir:"asc"}]);return e.sort((e,a)=>{let s=0;return t.forEach(t=>{0===s&&(s=((e,t,a)=>{if(void 0!==e[a]&&void 0!==t[a]){if(e[a]<t[a])return-1;if(e[a]>t[a])return 1}return 0})(e,a,t.field)*("asc"===t.dir?1:-1))}),s}),e}static debounce(e,t=500){let a;return()=>{clearTimeout(a),a=setTimeout(e,t)}}static toData(e){const t=e/1073741824;if(t>=1)return t.toFixed(2)+" GB";{const t=e/1048576;if(t>=1)return t.toFixed(2)+" MB";{const t=e/1024;if(t>=1)return t.toFixed(2)+" KB"}}return e+" B"}static saveFile(e,t){const a=JSON.stringify(t,null,"\t"),s=new Blob([a],{type:"application/json"}),n=document.createElement("a");n.download=e,n.href=window.URL.createObjectURL(s),n.click()}static randomNumber(e){return e<=0?0:Math.floor(Math.random()*e)}static randomBoolean(){return 0===b.randomNumber(2)}static randomDecimal(){return b.randomNumber(100)/100}}class E{static createParty(){return{id:b.guid(),name:"",pcs:[],awards:[]}}static createPC(){return{id:b.guid(),type:"pc",active:!0,player:"",name:"",size:"medium",race:"",classes:"",level:1,languages:"Common",passiveInsight:10,passiveInvestigation:10,passivePerception:10,darkvision:0,portrait:"",url:"",companions:[],awards:[]}}static createCompanion(){return{id:b.guid(),name:"",monsterID:null}}static createAward(){return{id:b.guid(),category:"",name:"",description:""}}static createMonsterGroup(){return{id:b.guid(),name:"",monsters:[]}}static createMonster(){return{id:b.guid(),type:"monster",name:"",size:"medium",role:"",category:"humanoid",tag:"",alignment:"",challenge:1,abilityScores:{str:10,dex:10,con:10,int:10,wis:10,cha:10},ac:10,acInfo:"",hitDice:1,damage:{resist:"",vulnerable:"",immune:""},savingThrows:"",speed:"",skills:"",senses:"",languages:"",equipment:"",traits:[],conditionImmunities:"",portrait:"",legendaryActions:0}}static createTrait(){return{id:b.guid(),name:"",usage:"",type:"action",text:"",uses:0}}static createEncounter(){return{id:b.guid(),name:"",slots:[],waves:[],notes:""}}static createEncounterSlot(){return{id:b.guid(),monsterID:"",roles:[],count:1,faction:"foe"}}static createEncounterWave(){return{id:b.guid(),name:"",slots:[]}}static createMonsterFilter(){return{name:"",challengeMin:0,challengeMax:5,category:"all types",size:"all sizes",role:"all roles"}}static createMap(){return{id:b.guid(),name:"",items:[],areas:[]}}static createMapItem(){return{id:b.guid(),type:"tile",x:0,y:0,z:0,width:4,height:4,depth:1,terrain:"",customBackground:"",customLink:"",content:null,size:"medium",color:"",opacity:255,style:null}}static createMapArea(){return{id:b.guid(),name:"",text:"",x:0,y:0,z:0,width:1,height:1,depth:1}}static createExploration(){return{id:b.guid(),name:"",map:this.createMap(),partyID:"",fog:[],lighting:"bright light",combatants:[]}}static createCombatSetup(){return{party:null,encounter:null,waveID:null,map:null,fog:[],lighting:"bright light",combatants:[],slotInfo:[]}}static createCombatSlotInfo(){return{id:"",useGroupHP:!0,useGroupInit:!0,hp:0,init:0,members:[]}}static createCombatSlotMember(){return{id:b.guid(),name:"",hp:0,init:0}}static createCombat(){return{id:b.guid(),name:"",encounter:E.createEncounter(),combatants:[],map:null,fog:[],lighting:"bright light",round:1,issues:[]}}static createNotification(){return{id:b.guid(),type:"condition-save",data:null,combatant:null}}static createCondition(){return{id:b.guid(),name:"",level:1,text:"",duration:null}}static createConditionDurationSaves(){return{type:"saves",count:1,saveType:"str",saveDC:10,point:"start"}}static createConditionDurationCombatant(){return{type:"combatant",point:"start",combatantID:null}}static createConditionDurationRounds(){return{type:"rounds",count:1}}}class f{static modifierValue(e){return Math.floor((e-10)/2)}static modifier(e){const t=this.modifierValue(e);let a=t.toString();return t>=0&&(a="+"+a),a}static dieRoll(e=20,t=1){let a=0;for(let s=0;s!==t;++s)a+=b.randomNumber(e)+1;return a}static rollDice(e,t,a){const s={id:b.guid(),rolls:[],constant:t,mode:a};return[4,6,8,10,12,20,100].forEach(t=>{const a=e[t];for(let e=0;e!==a;++e){let e=f.dieRoll(t);switch(s.mode){case"advantage":e=Math.max(e,f.dieRoll(t));break;case"disadvantage":e=Math.min(e,f.dieRoll(t))}s.rolls.push({id:b.guid(),sides:t,value:e})}}),s}static miniSize(e){switch(e){case"tiny":return.4;case"small":return.6;case"medium":return 1;case"large":return 2;case"huge":return 3;case"gargantuan":return 4;default:return 1}}static hitDieType(e){switch(e){case"tiny":return 4;case"small":return 6;case"medium":return 8;case"large":return 10;case"huge":return 12;case"gargantuan":return 20;default:return 8}}static proficiency(e){return e<5?2:e<9?3:e<13?4:e<17?5:6}static challenge(e){switch(e){case.125:return"1/8";case.25:return"1/4";case.5:return"1/2";default:return e.toString()}}static parseChallenge(e){switch(e){case"1/8":return.125;case"1/4":return.25;case"1/2":return.5;default:return parseInt(e,10)}}static challengeDetails(){return[{cr:0,ac:13,hpMin:1,hpMax:6,attack:3,dmgMin:0,dmgMax:1,save:13},{cr:.125,ac:13,hpMin:7,hpMax:35,attack:3,dmgMin:2,dmgMax:3,save:13},{cr:.25,ac:13,hpMin:36,hpMax:49,attack:3,dmgMin:4,dmgMax:5,save:13},{cr:.5,ac:13,hpMin:50,hpMax:70,attack:3,dmgMin:6,dmgMax:8,save:13},{cr:1,ac:13,hpMin:71,hpMax:85,attack:3,dmgMin:9,dmgMax:14,save:13},{cr:2,ac:13,hpMin:86,hpMax:100,attack:3,dmgMin:15,dmgMax:20,save:13},{cr:3,ac:13,hpMin:101,hpMax:115,attack:4,dmgMin:21,dmgMax:26,save:13},{cr:4,ac:14,hpMin:116,hpMax:130,attack:5,dmgMin:27,dmgMax:32,save:14},{cr:5,ac:15,hpMin:131,hpMax:145,attack:6,dmgMin:33,dmgMax:38,save:15},{cr:6,ac:15,hpMin:146,hpMax:160,attack:6,dmgMin:39,dmgMax:44,save:15},{cr:7,ac:15,hpMin:161,hpMax:175,attack:6,dmgMin:45,dmgMax:50,save:15},{cr:8,ac:16,hpMin:176,hpMax:190,attack:7,dmgMin:51,dmgMax:56,save:16},{cr:9,ac:16,hpMin:191,hpMax:205,attack:7,dmgMin:57,dmgMax:62,save:16},{cr:10,ac:17,hpMin:206,hpMax:220,attack:7,dmgMin:63,dmgMax:68,save:16},{cr:11,ac:17,hpMin:221,hpMax:235,attack:8,dmgMin:69,dmgMax:74,save:17},{cr:12,ac:17,hpMin:236,hpMax:250,attack:8,dmgMin:75,dmgMax:80,save:17},{cr:13,ac:18,hpMin:251,hpMax:265,attack:8,dmgMin:81,dmgMax:86,save:18},{cr:14,ac:18,hpMin:266,hpMax:280,attack:8,dmgMin:87,dmgMax:92,save:18},{cr:15,ac:18,hpMin:281,hpMax:295,attack:8,dmgMin:93,dmgMax:98,save:18},{cr:16,ac:18,hpMin:296,hpMax:310,attack:9,dmgMin:99,dmgMax:104,save:18},{cr:17,ac:19,hpMin:311,hpMax:325,attack:10,dmgMin:105,dmgMax:110,save:19},{cr:18,ac:19,hpMin:326,hpMax:340,attack:10,dmgMin:111,dmgMax:116,save:19},{cr:19,ac:19,hpMin:341,hpMax:355,attack:10,dmgMin:117,dmgMax:122,save:19},{cr:20,ac:19,hpMin:356,hpMax:400,attack:10,dmgMin:123,dmgMax:140,save:19},{cr:21,ac:19,hpMin:401,hpMax:445,attack:11,dmgMin:141,dmgMax:158,save:20},{cr:22,ac:19,hpMin:446,hpMax:490,attack:11,dmgMin:159,dmgMax:176,save:20},{cr:23,ac:19,hpMin:491,hpMax:535,attack:11,dmgMin:177,dmgMax:194,save:20},{cr:24,ac:19,hpMin:536,hpMax:580,attack:12,dmgMin:195,dmgMax:212,save:21},{cr:25,ac:19,hpMin:581,hpMax:625,attack:12,dmgMin:213,dmgMax:230,save:21},{cr:26,ac:19,hpMin:626,hpMax:670,attack:12,dmgMin:231,dmgMax:248,save:21},{cr:27,ac:19,hpMin:671,hpMax:715,attack:13,dmgMin:249,dmgMax:266,save:22},{cr:28,ac:19,hpMin:716,hpMax:760,attack:13,dmgMin:267,dmgMax:284,save:22},{cr:29,ac:19,hpMin:761,hpMax:805,attack:13,dmgMin:285,dmgMax:302,save:22},{cr:30,ac:19,hpMin:806,hpMax:850,attack:14,dmgMin:303,dmgMax:320,save:23}]}static experience(e){switch(e){case 0:return 10;case.125:return 25;case.25:return 50;case.5:return 100;case 1:return 200;case 2:return 450;case 3:return 700;case 4:return 1100;case 5:return 1800;case 6:return 2300;case 7:return 2900;case 8:return 3900;case 9:return 5e3;case 10:return 5900;case 11:return 7200;case 12:return 8400;case 13:return 1e4;case 14:return 11500;case 15:return 13e3;case 16:return 15e3;case 17:return 18e3;case 18:return 2e4;case 19:return 22e3;case 20:return 25e3;case 21:return 33e3;case 22:return 41e3;case 23:return 5e4;case 24:return 62e3;case 30:return 155e3;default:return 0}}static experienceFactor(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 1.5;case 3:case 4:case 5:case 6:return 2;case 7:case 8:case 9:case 10:return 2.5;case 11:case 12:case 13:case 14:return 3;default:return 4}}static pcExperience(e,t){switch(t){case"easy":switch(e){case 1:return 25;case 2:return 50;case 3:return 75;case 4:return 125;case 5:return 250;case 6:return 300;case 7:return 350;case 8:return 450;case 9:return 550;case 10:return 600;case 11:return 800;case 12:return 1e3;case 13:return 1100;case 14:return 1250;case 15:return 1400;case 16:return 1600;case 17:return 2e3;case 18:return 2100;case 19:return 2400;case 20:return 2800;default:return 0}case"medium":switch(e){case 1:return 50;case 2:return 100;case 3:return 150;case 4:return 250;case 5:return 500;case 6:return 600;case 7:return 750;case 8:return 900;case 9:return 1100;case 10:return 1200;case 11:return 1600;case 12:return 2e3;case 13:return 2200;case 14:return 2500;case 15:return 2800;case 16:return 3200;case 17:return 3900;case 18:return 4200;case 19:return 4900;case 20:return 5700;default:return 0}case"hard":switch(e){case 1:return 75;case 2:return 150;case 3:return 225;case 4:return 375;case 5:return 750;case 6:return 900;case 7:return 1100;case 8:return 1400;case 9:return 1600;case 10:return 1900;case 11:return 2400;case 12:return 3e3;case 13:return 3400;case 14:return 3800;case 15:return 4300;case 16:return 4800;case 17:return 5900;case 18:return 6300;case 19:return 7300;case 20:return 8500;default:return 0}case"deadly":switch(e){case 1:return 100;case 2:return 200;case 3:return 400;case 4:return 500;case 5:return 1100;case 6:return 1400;case 7:return 1700;case 8:return 2100;case 9:return 2400;case 10:return 2800;case 11:return 3600;case 12:return 4500;case 13:return 5100;case 14:return 5700;case 15:return 6400;case 16:return 7200;case 17:return 8800;case 18:return 9500;case 19:return 10900;case 20:return 12700;default:return 0}default:return 0}}static traitType(e,t){let a="";switch(e){case"trait":a="trait";break;case"action":a="action";break;case"reaction":a="reaction";break;default:a=e+" action"}return t&&(a+="s"),a}static nudgeChallenge(e,t){let a=0;switch(e){case 0:-1===t&&(a=0),1===t&&(a=.125);break;case.125:-1===t&&(a=0),1===t&&(a=.25);break;case.25:-1===t&&(a=.125),1===t&&(a=.5);break;case.5:-1===t&&(a=.25),1===t&&(a=1);break;case 1:-1===t&&(a=.5),1===t&&(a=2);break;default:a=e+t}return a}static nudgeSize(e,t){const a=["tiny","small","medium","large","huge","gargantuan"];let s=a.indexOf(e)+t;return s<0&&(s=0),s>=a.length&&(s=a.length-1),a[s]}static nudgeDifficulty(e,t){const a=["easy","medium","hard","deadly"];let s=a.indexOf(e)+t;return s<0&&(s=0),s>=a.length&&(s=a.length-1),a[s]}static nudgeLighting(e,t){const a=["darkness","dim light","bright light"];let s=a.indexOf(e)+t;return s<0&&(s=0),s>=a.length&&(s=a.length-1),a[s]}static conditionText(e){switch(e.name){case"blinded":return["a blinded creature can't see and automatically fails any ability check that requires sight","attack rolls against the creature have advantage, and the creature's attack rolls have disadvantage"];case"charmed":return["a charmed creature can't attack the charmer or target the charmer with harmful abilities or magical effects","the charmer has advantage on any ability check to interact socially with the creature"];case"deafened":return["a deafened creature can't hear and automatically fails any ability check that requires hearing."];case"exhaustion":switch(e.level){case 1:return["disadvantage on ability checks"];case 2:return["disadvantage on ability checks","speed halved"];case 3:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws"];case 4:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved"];case 5:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0"];case 6:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0","death"];default:return[]}case"frightened":return["a frightened creature has disadvantage on ability checks and attack rolls while the source of its fear is within line of sight","the creature can't willingly move closer to the source of its fear"];case"grappled":return["a grappled creature's speed becomes 0, and it can't benefit from any bonus to its speed","the condition ends if the grappler is incapacitated","the condition also ends if an effect removes the grappled creature from the reach of the grappler or grappling effect"];case"incapacitated":return["an incapacitated creature can't take actions or reactions","being incapacitated breaks concentration"];case"invisible":return["an invisible creature is impossible to see without the aid of magic or a special sense","for the purpose of hiding, the creature is heavily obscured","the creature's location can be detected by any noise it makes or any tracks it leaves","attack rolls against the creature have disadvantage, and the creature's attack rolls have advantage"];case"paralyzed":return["a paralyzed creature is incapacitated (can't take actions or reactions) and can't move or speak","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];case"petrified":return["a petrified creature is transformed, along with any nonmagical objects it is wearing or carrying, into a solid inanimate substance (usually stone)","its weight increases by a factor of ten, and it ceases aging","the creature is incapacitated (can't take actions or reactions), can't move or speak, and is unaware of its surroundings","attack rolls against the creature have advantage","the creature automatically fails strength and dexterity saving throws","the creature has resistance to all damage","the creature is immune to poison and disease, although a poison or disease already in its system is suspended, not neutralized"];case"poisoned":return["a poisoned creature has disadvantage on attack rolls and ability checks"];case"prone":return["a prone creature's only movement option is to crawl, unless it stands up (using half its speed) and thereby ends the condition","the creature has disadvantage on attack rolls","an attack roll against the creature has advantage if the attacker is within 5 feet of the creature; otherwise, the attack roll has disadvantage"];case"restrained":return["a restrained creature's speed becomes 0, and it can't benefit from any bonus to its speed","attack rolls against the creature have advantage, and the creature's attack rolls have disadvantage","the creature has disadvantage on dexterity saving throws"];case"stunned":return["a stunned creature is incapacitated (can't take actions or reactions), can't move, and can speak only falteringly","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage"];case"unconscious":return["an unconscious creature is incapacitated (can't take actions or reactions), can't move or speak, and is unaware of its surroundings","the creature drops whatever its holding and falls prone","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];case"custom":return[e.text];default:return[]}}static conditionDurationText(e,t){if(null!==e.duration)switch(e.duration.type){case"saves":const a=e.duration;let s=a.saveType.toString();"death"!==s&&(s=s.toUpperCase());const n=a.count>1?"saves":"save";return"until they make "+a.count+" "+s+" "+n+" at dc "+a.saveDC;case"combatant":const r=e.duration,i=r.point,o=t.find(e=>e.id===r.combatantID);return"until the "+i+" of "+(o?(o.displayName||o.name||"unnamed monster")+"'s":"their")+" next turn";case"rounds":const l=e.duration,c=l.count>1?"rounds":"round";return"for "+l.count+" "+c;default:return null}return null}static getCombatSlotData(e,t){const a=[];t.forEach(e=>{e.monsters.forEach(e=>a.push(e))});const s=[];return e&&e.slots.forEach(e=>{const t=a.find(t=>t.id===e.monsterID);if(t){const a=E.createCombatSlotInfo();a.id=e.id,a.init=this.dieRoll()+this.modifierValue(t.abilityScores.dex),a.hp=N.getTypicalHP(t);for(let s=0;s!==e.count;++s){const e=E.createCombatSlotMember();e.init=a.init,e.hp=a.hp,e.name=t.name,a.members.push(e)}if(e.count>1)for(let s=0;s!==e.count;++s)a.members[s].name=t.name+" "+(s+1);s.push(a)}}),s}static getTagTitle(e){if(e.startsWith("engaged"))return"engaged";switch(e){case"conc":return"concentrating";case"bane":return"affected by bane";case"bless":return"affected by bless";default:return e}}static getTagDescription(e){if(e.startsWith("engaged")){return e.split(":")[1]}switch(e){case"conc":return"if damaged, must make con save (dc is half damage taken or 10, whichever is higher) or lose concentration";case"bane":return"subtract d4 from attack rolls and saving throws";case"bless":return"add d4 to attack rolls and saving throws";default:return e}}static getWildSurge(){const e=["Roll on this table at the start of each of your turns for the next minute, ignoring this result on subsequent rolls.","For the next minute, you can see any invisible creature if you have line of sight to it.","A modron chosen and controlled by the DM appears in an unoccupied space within 5 feet of you, then disappears 1 minute later.","You cast fireball as a 3rd-level spell centered on yourself.","You cast magic missile as a 5th-level spell.","Roll a d10. Your height changes by a number of inches equal to the roll. If the roll is odd, you shrink. If the roll is even, you grow.","You cast confusion centered on yourself.","For the next minute, you regain 5 hit points at the start of each of your turns.","You grow a long beard made of feathers that remains until you sneeze, at which point the feathers explode out from your face.","You cast grease centered on yourself.","Creatures have disadvantage on saving throws against the next spell you cast in the next minute that involves a saving throw.","Your skin turns a vibrant shade of blue. A remove curse spell can end this effect.","An eye appears on your forehead for the next minute. During that time, you have advantage on Wisdom (Perception) checks that rely on sight.","For the next minute, all your spells with a casting time of 1 action have a casting time of 1 bonus action.","You teleport up to 60 feet to an unoccupied space of your choice that you can see.","You are transported to the Astral Plane until the end of your next turn, after which time you return to the space you previously occupied or the nearest unoccupied space if that space is occupied.","Maximize the damage of the next damaging spell you cast within the next minute.","Roll a d10. Your age changes by a number of years equal to the roll. If the roll is odd, you get younger (minimum 1 year old). If the roll is even, you get older.","1d6 flumphs controlled by the DM appear in unoccupied spaces within 60 feet of you and are frightened of you. They vanish after 1 minute.","You regain 2d10 hit points.","You turn into a potted plant until the start of your next turn. While a plant, you are incapacitated and have vulnerability to all damage. If you drop to 0 hit points, your pot breaks, and your form reverts.","For the next minute, you can teleport up to 20 feet as a bonus action on each of your turns.","You cast levitate on yourself.","A unicorn controlled by the DM appears in a space within 5 feet of you, then disappears 1 minute later.","You can't speak for the next minute. Whenever you try, pink bubbles float out of your mouth.","A spectral shield hovers near you for the next minute, granting you a +2 bonus to AC and immunity to magic missile.","You are immune to being intoxicated by alcohol for the next 5d6 days.","Your hair falls out but grows back within 24 hours.","For the next minute, any flammable object you touch that isn't being worn or carried by another creature bursts into flame.","You regain your lowest-level expended spell slot.","For the next minute, you must shout when you speak.","You cast fog cloud centered on yourself.","Up to three creatures you choose within 30 feet of you take 4d10 lightning damage.","You are frightened by the nearest creature until the end of your next turn.","Each creature within 30 feet of you becomes invisible for the next minute. The invisibility ends on a creature when it attacks or casts a spell.","You gain resistance to all damage for the next minute.","A random creature within 60 feet of you becomes poisoned for 1d4 hours.","You glow with bright light in a 30-foot radius for the next minute. Any creature that ends its turn within 5 feet of you is blinded until the end of its next turn.","You cast polymorph on yourself. If you fail the saving throw, you turn into a sheep for the spell's duration.","Illusory butterflies and flower petals flutter in the air within 10 feet of you for the next minute.","You can take one additional action immediately.","Each creature within 30 feet of you takes 1d10 necrotic damage. You regain hit points equal to the sum of the necrotic damage dealt.","You cast mirror image.","You cast fly on a random creature within 60 feet of you.","You become invisible for the next minute. During that time, other creatures can't hear you. The invisibility ends if you attack or cast a spell.","If you die within the next minute, you immediately come back to life as if by the reincarnate spell.","Your size increases by one size category for the next minute.","You and all creatures within 30 feet of you gain vulnerability to piercing damage for the next minute.","You are surrounded by faint, ethereal music for the next minute.","You regain all expended sorcery points.","You cast speak with animals","A mephit chosen and controlled by the DM appears in an unoccupied space within 5 feet of you, then disappears 1 minute later.","You cast ice storm as a 4th-level spell centered on yourself.","You cast scorching ray as a 5th-level spell.","For the next hour, your eyes and veins shed bright light in a 20 foot radius, and dim light for an additional 20 feet.","You cast plant growth centered on yourself.","You cast aura of life.","A daisy sprouts from your head. It may be pruned without harm.","You cast faerie fire centered on yourself.","You have a brief vision of the future. Roll a d20 and record the number rolled. Once in the next hour, you can replace any attack roll, saving throw, or ability check made by you or a creature that you can see with the foretelling roll. You must choose to do so before the roll, and you can replace a roll in this way only once per turn.","You become unable to turn left. A remove curse spell can end this effect.","A glimpse of the future gives you advantage on the next saving throw you make.","You cast haste on yourself.","You cast thunder step as a 3rd-level spell.","You switch positions with the target immediately after the effects of the spell occur. If the spell had multiple targets, you switch places with the closest one to you.","For the next minute, roll an extra die of damage for each spell you cast.","You take no action on your next turn. Instead, you vomit 1d100 gold pieces.","A pseudodragon controlled by the DM appears in an unoccupied space within 60 feet of you. It vanishes after 1 minute.","You cast healing word as a 2nd-level spell.","You turn into a harmless creature for 1d4 rounds. While in this form, you have a movement speed of 15 feet and vulnerability to all damage. If you drop to 0 hit points your form reverts.","Spider legs sprout from your back, giving you a climbing speed of 20 feet. The legs remain in place for one hour.","You cast freedom of movement on yourself.","A couatl controlled by the DM appears in a space within 5 feet of you, then disappears 1 minute later.","You're deafened for the next minute. For this duration, green smoke pours out from your ears.","A wall of fire encircles you as a 4th-level spell. You are on the side that takes no damage.","You cast create food and water.","You shoot eight non-venomous snakes from your fingertips.","For the next minute, any organic object you touch decays. Food spoils, plants wilt, etc. Your unarmed strikes deal an additional 1d4 necrotic damage.","All silver you are carrying becomes gold.","An illusory image of you is left in your space. It can be dispelled with dispel magic.","You cast darkness centered on yourself.","You breathe a cone of dragon's breath as a 2nd-level spell the next time you try to speak.","You are entombed in crystal, which shatters at the end of your next turn. You gain 50 temporary hit points and are considered petrified. All these effects, incuding any remaining temporary hit points, end when the crystal shatters.","For the next minute, creatures within 30 feet of you can't see further than 30 feet away.","You cast warding wind.","A random creature within 60 feet of you falls asleep for 1d4 turns or until it takes damage. While asleep they are unconscious. A creature is not affected if they cannot be put to sleep by magic.","You cast color spray as a 1st-level spell.","You cast flesh to stone on yourself.","Illusory rain and autumn leaves fall to the ground within 10 feet of you for the next minute.","If the spell requires concentration, it automatically lasts for its maximum duration; if not, its duration is doubled. If it is instantaneous, it is immediately recast on the same target.","You cast thunderwave as a 1st-level spell.","You cast blur.","You cast reverse gravity centered on yourself.","You cast blink.","You regain all expended hit dice.","Your size decreases by one size category for the next minute.","All weapons within 30 feet of you turn into food for the next minute.","A gentle gust of wind blows outward from you.","For one minute, an illusory duplicate of yourself appears in an empty space adjacent to you. The duplicate is under your control and shares your initiative, hit points, sorcery points, and spell slots. Any resources spent by the duplicate are also expended by you."];return e[b.randomNumber(e.length)].toLowerCase()}}const v=["blinded","charmed","deafened","exhaustion","frightened","grappled","incapacitated","invisible","paralyzed","petrified","poisoned","prone","restrained","stunned","unconscious","custom"],w=["tiny","small","medium","large","huge","gargantuan"],k=["aberration","beast","celestial","construct","dragon","elemental","fey","fiend","giant","humanoid","monstrosity","ooze","plant","undead"],x=["artillery","boss","controller","skirmisher","sneak","soldier","tank"],C=["trait","action","bonus","reaction","legendary","mythic","lair"];class N{static getTypicalHP(e){const t=(f.hitDieType(e.size)+1)/2+f.modifierValue(e.abilityScores.con);return Math.floor(e.hitDice*t)}static getTypicalHPString(e){const t=f.hitDieType(e.size),a=f.modifierValue(e.abilityScores.con)*e.hitDice;let s="";return a>0&&(s=" + "+a),a<0&&(s=" - "+Math.abs(a)),e.hitDice+"d"+t+s}static getVisionRadius(e){let t=0;const a=e.senses.match(/dark\s?vision\s+(\d+)\s?ft/i);return a&&(t=parseInt(a[1],10)),t}static nudgeValue(e,t,a){let s=e,n=null;const r=t.split(".");let i;switch(r.forEach(e=>{e===r[r.length-1]?n=s[e]:s=s[e]}),t){case"challenge":i=f.nudgeChallenge(n,a);break;case"size":i=f.nudgeSize(n,a);break;default:i=(n||0)+a,i=Math.max(i,0)}N.changeValue(e,t,i)}static changeValue(e,t,a){let s=e;const n=t.split(".");n.forEach(e=>{e===n[n.length-1]?s[e]=a:s=s[e]})}static clear(e){e.name="",e.size="medium",e.role="",e.category="beast",e.tag="",e.alignment="",e.challenge=1,e.abilityScores.str=10,e.abilityScores.dex=10,e.abilityScores.con=10,e.abilityScores.int=10,e.abilityScores.wis=10,e.abilityScores.cha=10,e.ac=10,e.acInfo="",e.hitDice=1,e.damage.resist="",e.damage.vulnerable="",e.damage.immune="",e.savingThrows="",e.speed="",e.skills="",e.senses="",e.languages="",e.equipment="",e.traits=[],e.conditionImmunities="",e.portrait="",e.legendaryActions=0}static createFromJSON(e){const t=E.createMonster();t.type="monster",t.name=e.name,t.size=e.size.toLowerCase(),t.role="",t.category=e.type,t.tag=e.subtype,t.alignment=e.alignment,t.challenge=f.parseChallenge(e.challenge_rating),t.ac=e.armor_class,t.acInfo="",t.speed=e.speed,t.senses=e.senses,t.languages=e.languages;const a=e.hit_dice.indexOf("d");t.hitDice=parseInt(e.hit_dice.substring(0,a),10),t.abilityScores.str=e.strength,t.abilityScores.dex=e.dexterity,t.abilityScores.con=e.constitution,t.abilityScores.int=e.intelligence,t.abilityScores.wis=e.wisdom,t.abilityScores.cha=e.charisma,t.damage.resist=e.damage_resistances,t.damage.vulnerable=e.damage_vulnerabilities,t.damage.immune=e.damage_immunities,t.conditionImmunities=e.condition_immunities,t.legendaryActions=0;[{field:"strength_save",text:"Strength"},{field:"dexterity_save",text:"Dexterity"},{field:"constitution_save",text:"Constitution"},{field:"intelligence_save",text:"Intelligence"},{field:"wisdom_save",text:"Wisdom"},{field:"charisma_save",text:"Charisma"}].forEach(a=>{if(e[a.field]){const s=a.text+" "+e[a.field];t.savingThrows+=""===t.savingThrows?s:", "+s}});return[{field:"acrobatics",text:"Acrobatics"},{field:"animal_handling",text:"Animal handling"},{field:"arcana",text:"Arcana"},{field:"athletics",text:"Athletics"},{field:"deception",text:"Deception"},{field:"history",text:"History"},{field:"insight",text:"Insight"},{field:"intimidation",text:"Intimidation"},{field:"investigation",text:"Investigation"},{field:"medicine",text:"Medicine"},{field:"nature",text:"Nature"},{field:"perception",text:"Perception"},{field:"performance",text:"Performance"},{field:"persuasion",text:"Persuasion"},{field:"religion",text:"Religion"},{field:"sleight_of_hand",text:"Sleight of hand"},{field:"stealth",text:"Stealth"},{field:"survival",text:"Survival"}].forEach(a=>{if(e[a.field]){const s=a.text+" "+e[a.field];t.skills+=""===t.skills?s:", "+s}}),e.special_abilities&&e.special_abilities.forEach(e=>{const a=this.buildTrait(e,"trait");t.traits.push(a)}),e.actions&&e.actions.forEach(e=>{const a=this.buildTrait(e,"action");t.traits.push(a)}),e.reactions&&e.reactions.forEach(e=>{const a=this.buildTrait(e,"reaction");t.traits.push(a)}),e.legendary_actions&&e.legendary_actions.forEach(e=>{const a=this.buildTrait(e,"legendary");t.traits.push(a)}),t.traits.some(e=>"legendary"===e.type||"mythic"===e.type)&&(t.legendaryActions=3),t.role=this.getRole(t),t}static buildTrait(e,t){let a="",s="";const n=e.name.indexOf("(");if(-1===n)a=e.name;else{const t=e.name.indexOf(")");a=e.name.substring(0,n-1),s=e.name.substring(n+1,t).toLowerCase()}const r=e.desc.replace(/\u2022/g,"*");let i=t;return"Lair Actions"===a&&(i="lair"),0===r.indexOf("As a bonus action")&&(i="bonus"),{id:b.guid(),type:i,name:a,usage:s,text:r,uses:0}}static import(e,t){N.clear(t);const a=(new DOMParser).parseFromString(e,"text/html");try{t.name=a.getElementsByClassName("mon-stat-block__name")[0].innerText.trim();let e=a.getElementsByClassName("mon-stat-block__meta")[0].innerText.toLowerCase().trim();const s=e.indexOf(" ");t.size=e.substring(0,s).trim(),e=e.substring(s+1).trim();const n=e.indexOf(",");t.alignment=e.substring(n+1).trim(),e=e.substring(0,n).trim();const r=e.indexOf("("),i=e.indexOf(")");-1!==r&&-1!==i&&(t.tag=e.substring(r+1,i).trim(),e=e.substring(0,r).trim()),t.category=e}catch(s){console.error(s)}try{const e=a.getElementsByClassName("mon-stat-block__attribute");for(let a=0;a!==e.length;++a){const s=e[a],n=s.getElementsByClassName("mon-stat-block__attribute-label")[0].innerText.toLowerCase().trim(),r=s.getElementsByClassName("mon-stat-block__attribute-data-value")[0].innerText.toLowerCase().trim();switch(n){case"armor class":t.ac=Number.parseInt(r,10);let e=s.getElementsByClassName("mon-stat-block__attribute-data-extra")[0].innerText.toLowerCase().trim();e.startsWith("(")&&(e=e.substr(1,e.length-2)),t.acInfo=e;break;case"hit points":const a=s.getElementsByClassName("mon-stat-block__attribute-data-extra")[0].innerText.toLowerCase().trim();t.hitDice=Number.parseInt(a.substring(1,a.indexOf("d")),10);break;case"speed":t.speed=r}}}catch(s){console.error(s)}try{const e=a.getElementsByClassName("ability-block__stat");for(let a=0;a!==e.length;++a){const s=e[a],n=s.getElementsByClassName("ability-block__heading")[0].innerText.toLowerCase().trim(),r=s.getElementsByClassName("ability-block__score")[0].innerText.toLowerCase().trim(),i=Number.parseInt(r,10);t.abilityScores[n]=i}}catch(s){console.error(s)}try{const e=a.getElementsByClassName("mon-stat-block__tidbit");for(let a=0;a!==e.length;++a){const s=e[a],n=s.getElementsByClassName("mon-stat-block__tidbit-label")[0].innerText.toLowerCase().trim(),r=s.getElementsByClassName("mon-stat-block__tidbit-data")[0].innerText.toLowerCase().trim();switch(n){case"saving throws":t.savingThrows=r;break;case"skills":t.skills=r;break;case"damage vulnerabilities":t.damage.vulnerable=r;break;case"damage resistances":t.damage.resist=r;break;case"damage immunities":t.damage.immune=r;break;case"condition immunities":t.conditionImmunities=r;break;case"senses":t.senses=r;break;case"languages":t.languages=r;break;case"challenge":const e=r.indexOf(" ");t.challenge=Number.parseInt(r.substring(0,e),10)}}}catch(s){console.error(s)}try{const e=a.getElementsByClassName("mon-stat-block__description-block");for(let a=0;a!==e.length;++a){const s=e[a];let n="trait";const r=s.getElementsByClassName("mon-stat-block__description-block-heading");if(r.length>0){switch(r[0].innerText.toLowerCase().trim()){case"actions":n="action";break;case"bonus actions":n="bonus";break;case"reactions":n="reaction";break;case"legendary actions":n="legendary";break;case"mythic actions":n="mythic";break;case"lair actions":n="lair"}}const i=s.getElementsByTagName("p");for(let e=0;e!==i.length;++e){let a=i[e].innerText.trim();const s=E.createTrait();s.type=n;const r=a.indexOf(".");s.text=a.substring(r+1).trim(),a=a.substring(0,r);const o=a.indexOf("("),l=a.indexOf(")");if(-1!==o&&-1!==l&&(s.usage=a.substring(o+1,l).trim(),a=a.substring(0,o).trim()),s.name=a,s.name)t.traits.push(s);else{const e=t.traits[t.traits.length-1];e.text+="\n",e.text+=s.text}}}}catch(s){console.error(s)}t.traits.some(e=>"legendary"===e.type||"mythic"===e.type)&&(t.legendaryActions=3),t.role=this.getRole(t)}static copyTrait(e,t){const a=JSON.parse(JSON.stringify(t));a.id=b.guid(),e.traits.push(a)}static addTrait(e,t){const a=E.createTrait();a.type=t,e.traits.push(a)}static moveTrait(e,t,a){const s=e.traits.splice(t,1);e.traits.splice(a,0,...s)}static removeTrait(e,t){const a=e.traits.indexOf(t);e.traits.splice(a,1)}static swapTraits(e,t,a){const s=e.traits.indexOf(t),n=e.traits.indexOf(a);e.traits[n]=t,e.traits[s]=a}static spliceMonsters(e,t){["size","category","tag","alignment","challenge","speed","senses","languages","equipment","abilityScores.str","abilityScores.dex","abilityScores.con","abilityScores.int","abilityScores.wis","abilityScores.cha","savingThrows","skills","ac","acInfo","hitDice","damage.resist","damage.vulnerable","damage.immune","conditionImmunities"].forEach(a=>{this.setRandomValue(e,a,t)}),e.traits=[],C.forEach(a=>{const s=[];t.forEach(e=>{e.traits.filter(e=>e.type===a).forEach(e=>s.push(e))});const n=[];s.forEach(e=>{const t=n.find(t=>t.trait.name===e.name);t?t.count+=1:n.push({trait:e,count:1})});const r=[];n.filter(e=>e.count===t.length).forEach(t=>{this.copyTrait(e,t.trait),r.push(t.trait.id)}),r.forEach(e=>{const t=n.findIndex(t=>t.trait.id===e);n.splice(t,1)});const i=s.length/t.length;for(;e.traits.filter(e=>e.type===a).length<i;){const t=b.randomNumber(n.length),a=n[t].trait;this.copyTrait(e,a),n.splice(t,1)}}),e.traits.some(e=>"legendary"===e.type||"mythic"===e.type)&&(e.legendaryActions=3),e.role=this.getRole(e)}static setRandomValue(e,t,a){let s=a[b.randomNumber(a.length)],n=null;const r=t.split(".");r.forEach(e=>{e===r[r.length-1]?n=s[e]:s=s[e]}),this.changeValue(e,t,n)}static addRandomTrait(e,t,a){const s=[];a.forEach(e=>{e.traits.filter(e=>e.type===t).forEach(e=>{s.push(e)})});const n=b.randomNumber(s.length),r=s[n];this.copyTrait(e,r)}static getToHitExpressions(e){return Array.from(e.text.matchAll(/([+-])\s*(\d+)\s*to hit/g)).map(e=>{const t=e[0];let a=parseInt(e[2],10);return"-"===e[1]&&(a*=-1),{expression:t,bonus:a}})}static getDiceExpressions(e){return Array.from(e.text.matchAll(/(\d*)[dD](\d+)\s*(([+-])\s*(\d*))?/g)).map(e=>{var t;const a=e[0],s=null!==(t=parseInt(e[1],10))&&void 0!==t?t:1,n=parseInt(e[2],10);let r=0;return e[3]&&e[4]&&e[5]&&(r=parseInt(e[5],10),"-"===e[4]&&(r*=-1)),{expression:a,count:s,sides:n,bonus:r}})}static getSaveExpressions(e){return Array.from(e.text.matchAll(/(dc|DC)\s*(\d+)/g)).map(e=>({expression:e[0],dc:parseInt(e[2],10)}))}static getRole(e){if(e.legendaryActions>0)return"boss";if(e.traits.some(e=>e.text.toLowerCase().includes("teleport")))return"skirmisher";const t=e.skills.toLowerCase();if(t.includes("deception")||t.includes("stealth"))return"sneak";if(e.traits.some(e=>e.text.toLowerCase().includes("indistinguishable")))return"sneak";const a=f.challengeDetails().find(t=>t.cr===e.challenge);if(a){if(N.getTypicalHP(e)>a.hpMax)return"tank";const t=e.traits.filter(e=>{const t=this.getToHitExpressions(e),s=this.getDiceExpressions(e).map(e=>e.count*(e.sides+1)/2+e.bonus),n=this.getSaveExpressions(e);return t.some(e=>e.bonus>a.attack)||s.some(e=>e>a.dmgMax)||n.some(e=>e.dc>a.save)});if(t.length>0){const e=t.filter(e=>{const t=e.text.toLowerCase();return t.includes("ranged")&&t.includes("attack")}).length;return e>=t.length-e?"artillery":"soldier"}}let s=0;return v.forEach(t=>{if("custom"!==t){e.traits.some(e=>e.text.toLowerCase().includes(t.toLowerCase()))&&(s+=1)}}),s>=2?"controller":"skirmisher"}}class S{static allImages(){const e=[];for(let t=0;t!==window.localStorage.length;++t){const a=window.localStorage.key(t);if(a&&a.startsWith("image-")){const t=window.localStorage.getItem(a);if(t){const a=JSON.parse(t);e.push({id:a.id,name:a.name,data:a.data})}}}return b.sort(e,[{field:"name",dir:"asc"}])}static getImage(e){let t=null;const a=window.localStorage.getItem("image-"+e);if(a){const e=JSON.parse(a);t={id:e.id,name:e.name,data:e.data}}return t}static saveImage(e,t,a){const s="image-"+e;if(null===window.localStorage.getItem(s)){const n={id:e,name:t,data:a};window.localStorage.setItem(s,JSON.stringify(n))}}static clearUnusedImages(e,t,a){S.allImages().forEach(s=>{let n=!1;e.forEach(e=>{e.items.find(e=>e.customBackground===s.id)&&(n=!0)}),t.forEach(e=>{e.map&&e.map.items.find(e=>e.customBackground===s.id)&&(n=!0)}),a.forEach(e=>{e.map.items.find(e=>e.customBackground===s.id)&&(n=!0)}),n||window.localStorage.removeItem("image-"+s.id)})}}class I{static matchParty(e,t){return!!I.match(e,t.name)||t.pcs.some(t=>I.matchPC(e,t))}static matchPC(e,t){return!!I.match(e,t.name)||(!!I.match(e,t.player)||(!!I.match(e,t.race)||(!!I.match(e,t.classes)||t.companions.some(t=>I.matchCompanion(e,t)))))}static matchCompanion(e,t){return!!I.match(e,t.name)}static matchGroup(e,t){return!!I.match(e,t.name)||t.monsters.some(t=>I.matchMonster(e,t))}static matchMonster(e,t){return!!I.match(e,t.name)||(!!I.match(e,t.category)||(!!I.match(e,t.tag)||(!!I.match(e,t.senses)||(!!I.match(e,t.languages)||(!!I.match(e,t.equipment)||t.traits.some(t=>I.matchTrait(e,t)))))))}static matchTrait(e,t){return!!I.match(e,t.name)||(!!I.match(e,t.usage)||!!I.match(e,t.text))}static matchEncounter(e,t,a){return!!I.match(e,t.name)||(!!t.waves.some(t=>I.matchEncounterWave(e,t,e=>a(e)))||t.slots.some(t=>I.matchEncounterSlot(e,t,e=>a(e))))}static matchEncounterWave(e,t,a){return!!I.match(e,t.name)||t.slots.some(t=>I.matchEncounterSlot(e,t,e=>a(e)))}static matchEncounterSlot(e,t,a){const s=a(t.monsterID);return!(!s||!I.match(e,s.name))}static matchMap(e,t){return!!I.match(e,t.name)||t.areas.some(t=>I.matchMapArea(e,t))}static matchMapArea(e,t){return!!I.match(e,t.name)||!!I.match(e,t.text)}static matchAward(e,t){return!!I.match(e,t.name)||!!I.match(e,t.description)}static match(e,t){if(!e)return!0;let a=!0;return e.toLowerCase().split(" ").forEach(e=>{-1===t.toLowerCase().indexOf(e)&&(a=!1)}),a}}class M{static getMonsterCount(e,t){let a=0,s=[];return null!==t&&t!==e.id||(s=s.concat(e.slots)),e.waves.forEach(e=>{null!==t&&t!==e.id||(s=s.concat(e.slots))}),s.filter(e=>"foe"===e.faction).forEach(e=>{a+=e.count}),a}static getEncounterXP(e,t,a){let s=0,n=[];return null!==t&&t!==e.id||(n=n.concat(e.slots)),e.waves.forEach(e=>{null!==t&&t!==e.id||(n=n.concat(e.slots))}),n.filter(e=>"foe"===e.faction).forEach(e=>{const t=a(e.monsterID);t&&(s+=f.experience(t.challenge)*e.count)}),s}static getAdjustedEncounterXP(e,t,a){const s=this.getMonsterCount(e,t);return this.getEncounterXP(e,t,a)*f.experienceFactor(s)}static getCombatXP(e){let t=0;return e.combatants.filter(e=>"monster"===e.type).filter(e=>"foe"===e.faction).forEach(e=>{const a=e;t+=f.experience(a.challenge)}),t}static getFilterDescription(e){let t="";"all sizes"!==e.size&&(t+=t?" "+e.size:e.size),"all types"!==e.category&&(t+=t?" "+e.category:e.category),"all roles"!==e.role&&(t+=t?" "+e.role:e.role);const a=f.challenge(e.challengeMin),s=f.challenge(e.challengeMax);return t+=" monsters of cr "+(e.challengeMin===e.challengeMax?a:a+" to "+s),t}static buildEncounter(e,t,a,s,n){const r=[];for(s.forEach(e=>{e.monsters.filter(e=>M.matchMonster(e,a)).forEach(t=>r.push({id:t.id,monsterName:t.name,groupName:e.name}))});M.getAdjustedEncounterXP(e,null,e=>n(e))<t;)if(e.slots.length>0&&f.dieRoll(3)>1){const t=b.randomNumber(e.slots.length);e.slots[t].count+=1}else{const t=r.filter(t=>!e.slots.find(e=>e.monsterID===t.id));if(t.length>0){const a=b.randomNumber(t.length),s=E.createEncounterSlot();s.monsterID=t[a].id,e.slots.push(s)}else if(0===e.slots.length)break}for(;e.slots.length>1&&10===f.dieRoll(10);){const t=b.randomNumber(e.slots.length),a=e.slots[t];e.slots=e.slots.filter(e=>e.id!==a.id);const s=E.createEncounterWave();s.name="wave "+(e.waves.length+2),s.slots.push(a),e.waves.push(s)}}static matchMonster(e,t){return!(e.challenge<t.challengeMin)&&(!(e.challenge>t.challengeMax)&&(!(""!==t.name&&!I.match(t.name,e.name))&&(("all types"===t.category||e.category===t.category)&&(("all sizes"===t.size||e.size===t.size)&&("all roles"===t.role||e.role===t.role)))))}static sortEncounter(e,t){M.sortEncounterSlots(e,e=>t(e)),e.waves.forEach(e=>M.sortEncounterSlots(e,e=>t(e)))}static sortEncounterSlots(e,t){const a=[];e.slots.forEach(e=>{let t=a.find(t=>t.monsterID===e.monsterID&&t.roles.join(",")===e.roles.join(","));t?t.count+=e.count:(t=e,a.push(e))}),e.slots=a,e.slots.sort((e,a)=>{let s=e.monsterID;const n=t(e.monsterID);n&&n.name&&(s=n.name);let r=a.monsterID;const i=t(a.monsterID);return i&&i.name&&(r=i.name),s<r?-1:s>r?1:0})}static sortCombatants(e){e.combatants.sort((e,t)=>e.initiative&&t.initiative&&e.initiative<t.initiative?1:e.initiative&&t.initiative&&e.initiative>t.initiative||e.displayName<t.displayName?-1:e.displayName>t.displayName?1:0)}static combatHasLairActions(e){let t=!1;return e.combatants.filter(e=>!e.pending&&e.active&&!e.defeated).forEach(e=>{const a=e;a&&a.traits&&a.traits.some(e=>"lair"===e.type)&&(t=!0)}),t}static encounterHasMonster(e,t){let a=e.slots.map(e=>e.monsterID);return e.waves.forEach(e=>{a=a.concat(e.slots.map(e=>e.monsterID))}),!!a.find(e=>e===t)}static convertPCToCombatant(e){const t=JSON.parse(JSON.stringify(e));return t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e.name,t.displaySize=e.size,t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t.darkvision=e.darkvision,t.lightSource=null,t.path=null,t}static convertMonsterToCombatant(e,t,a,s,n){const r=JSON.parse(JSON.stringify(e));return r.id=b.guid(),r.current=!1,r.pending=!1,r.active=!0,r.defeated=!1,r.faction=n,r.displayName=s,r.displaySize=e.size,r.showOnMap=!0,r.initiative=t,r.hpMax=a,r.hpCurrent=a,r.hpTemp=0,r.conditions=[],r.tags=[],r.note="",r.aura={radius:0,style:"rounded",color:"#005080"},r.mountID=null,r.mountType="controlled",r.darkvision=N.getVisionRadius(e),r.lightSource=null,r.path=null,r}static convertCompanionToCombatant(e){const t=e?JSON.parse(JSON.stringify(e)):{};return t.id=e?e.id:b.guid(),t.type="companion",t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e?e.name:"companion",t.displaySize="medium",t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t.darkvision=0,t.lightSource=null,t.path=null,t}static convertPlaceholderToCombatant(){return{id:b.guid(),type:"placeholder",current:!1,pending:!1,active:!0,defeated:!1,faction:"neutral",displayName:"lair actions",displaySize:"medium",showOnMap:!0,initiative:20,hpMax:null,hpCurrent:null,hpTemp:null,conditions:[],tags:[],note:"",aura:{radius:0,style:"rounded",color:"#005080"},mountID:null,mountType:"controlled",darkvision:0,lightSource:null,path:null}}static updateCombatant(e,t){e.player=t.player,e.name=t.name,e.displayName=t.name,e.size=t.size,e.race=t.race,e.classes=t.classes,e.level=t.level,e.languages=t.languages,e.passiveInsight=t.passiveInsight,e.passiveInvestigation=t.passiveInvestigation,e.passivePerception=t.passivePerception,e.darkvision=t.darkvision,e.portrait=t.portrait,e.url=t.url}static encounterTemplates(){return[{name:"battlefield control",slots:[{roles:["controller"],count:1},{roles:["skirmisher","sneak"],count:5}]},{name:"commander and troops",slots:[{roles:["controller","soldier"],count:1},{roles:["soldier","tank"],count:5}]},{name:"dragon's den",slots:[{roles:["boss"],count:1}]},{name:"double line",slots:[{roles:["soldier","tank"],count:3},{roles:["artillery","controller"],count:2}]},{name:"wolf pack",slots:[{roles:["skirmisher"],count:6}]}]}static getActiveCombatants(e,t,a){const s=e.combatants.filter(e=>!!e.mountID&&"controlled"===e.mountType).map(e=>e.mountID||"");return e.combatants.filter(e=>!s.includes(e.id)).filter(e=>e.active||e.defeated&&a).filter(e=>!t||"pc"===e.type||e.showOnMap).filter(a=>!t||"monster"!==a.type||!e.map||!!e.map.items.find(e=>e.id===a.id)).filter(t=>"placeholder"!==t.type||M.combatHasLairActions(e))}static getMountsAndRiders(e,t){const a=e.map(e=>t.find(t=>t.id===e)).filter(e=>void 0!==e),s=a.map(e=>t.find(t=>t.id===e.mountID)).filter(e=>void 0!==e),n=a.map(e=>t.find(t=>t.mountID===e.id)).filter(e=>void 0!==e);return a.concat(s).concat(n)}static setMountPositions(e,t){e.forEach(e=>{if(e.mountID){const a=t.items.find(t=>t.id===e.id),s=t.items.find(t=>t.id===e.mountID);a&&s&&(s.x=a.x,s.y=a.y)}})}}class D{static initModel(e){const t=[];let a=0;e.forEach(e=>{e.split(/\r?\n/).forEach(e=>{e&&(D.addLineToModel(e,t),a=Math.max(a,e.length))})}),D.model=t,D.maxLength=a}static addLineToModel(e,t){e=String.fromCharCode(0,1)+e+String.fromCharCode(2);for(let a=2;a!==e.length;++a){const s=e.substr(a-2,2),n=e.substr(a,1);let r=t.find(e=>e.prev===s);r||(r={prev:s,freq:[]},t.push(r));let i=r.freq.find(e=>e.char===n);i||(i={char:n,count:0},r.freq.push(i)),i.count+=1}}static generateLine(){const e=this.generateLines(1);return e.length>0?e[0]:""}static generateLines(e){const t=[];let a=0;for(;t.length<e&&a<100;){const e=D.extractLine();e&&!t.includes(e)&&e.length<=D.maxLength?t.push(e):a+=1}return t}static extractLine(){let e=String.fromCharCode(0,1);for(;;){const t=e.substr(e.length-2,2),a=D.model.find(e=>e.prev===t);if(!a)return null;{let t="";a.freq.forEach(e=>{t+=e.char.repeat(e.count)});const s=b.randomNumber(t.length);let n=t[s];if(n===String.fromCharCode(2))return e=e.substr(2),e;if(1===f.dieRoll()){["bdg","ptk","sz","aeiouy","lr","ckq","vf"].forEach(e=>{if(e.includes(n)){const t=b.randomNumber(e.length);n=e[t]}})}e+=n}}}static getSourceLanguages(){return["afrikaans","amharic","armenian","basque","belarusian","bulgarian","chichewa","chinese","croatian","czech","danish","dutch","english","finnish","french","german","greek","hawaiian","hindi","hungarian","icelandic","irish","italian","japanese","kannada","kazakh","korean","kyrgyz","latvian","lithuanian","macedonian","malay","maltese","maori","myanmar","nepali","norwegian","polish","portuguese","punjabi","romanian","russian","samoan","serbian","shona","somali","spanish","swahili","swedish","thai","turkish","welsh","yiddish","zulu"]}static getLanguagePresets(){return[{name:"draconic",languages:["armenian","irish","maltese"]},{name:"dwarvish",languages:["czech","german","kazakh"]},{name:"elvish",languages:["finnish","spanish","welsh"]},{name:"giant",languages:["amharic","hungarian","polish"]},{name:"gnomish",languages:["chichewa","korean","yiddish"]},{name:"goblin",languages:["hawaiian","kyrgyz","somali"]},{name:"halfling",languages:["english","maori","samoan"]},{name:"orc",languages:["macedonian","russian","turkish"]}]}static getRandomLanguages(){const e=D.getSourceLanguages(),t=[];for(;3!==t.length;){const a=e[b.randomNumber(e.length)];t.includes(a)||t.push(a)}return t.sort()}static generateTranslation(e){const t="abcdefghijklmnopqrstuvwxyz";let a="";for(let s=0;s!==e.length;++s){if(" "!==e.toLowerCase().charAt(s)){a+=t[b.randomNumber(t.length)]}else a+=" "}return D.shuffle(a)}static getAllLanguages(){return["common","abyssal","aquan","auran","celestial","deep speech","dwarvish","elvish","giant","gnomish","goblin","halfling","ignan","infernal","orc","primordial","sylvan","terran","undercommon"]}static getKnownLanguages(e){return e.map(e=>e.languages.toLowerCase()).join(", ").split(/[,;:]+/).map(e=>e.trim()).filter(e=>e.length>0).reduce((e,t)=>(-1===e.indexOf(t)&&e.push(t),e),[]).sort((e,t)=>"common"===e?-1:"common"===t?1:e.localeCompare(t)).map(e=>D.capitalise(e))}static startsWithVowel(e){let t=!1;return["a","e","i","o","u"].forEach(a=>{e.toLowerCase().startsWith(a)&&(t=!0)}),t}static shuffle(e){const t=e.split("");for(let a=t.length-1;a>0;a--){const e=b.randomNumber(a+1),s=t[a];t[a]=t[e],t[e]=s}return t.join("")}static capitalise(e){return e.split(" ").filter(e=>e.length>0).map(e=>e[0].toUpperCase()+(e.length>1?e.substring(1):"")).join(" ")}static generateName(){const e=["As Has Khe Zash Gl Ig Iv Kos Miv Pav Ser Dar Even Gor Rand Sto Tam Barer Keth Mum","Mar Burg Al Hel Wrayt S Eag Eath Joan Answ L Ot Ced At Tal Ham Jasm Mail Yash Row","Adr Alber Ba Bar Gar Kildr Kath Dies Eld Gurd Har Morg Or Rur Mar Vis Jen Torg Tak Thor End Ris Em Gunn","Ad All Aram Berri Car Enial Gann Im Per Sorvi Var Adr An Beth Bir Jelen Key Lesh Mer Mia Naiv Quel Sar Shan","Al An C Cor Eld Er Finn Gar Lin Mer Os Per Ros An Cal Cor Kith Lav Ned Pae Seraph T V Chen","Are Bala Bhar Don Gh Hesk Med Meh Nad Pand Patr Sham Shed Ak Bir Farid Fla Ka Ko Mish Thav Uad Eder Hener","Alu Stos Fa Ravay Leo Stok Vic El Yeng Car Ric Ar Guir Es My Pey"].join(" ").toLowerCase().split(" "),t=["Eir Eid Eed El Ar An Or Ef Al Vin Orn Dur Stag Elm Ur Us","Ik Ich Ern End Tor Nor In Rak Gen Sik Gran Linn Vok Brek Dal Gar","An Ar Il Rian Ric Is Dan Arai Meral Cian En Rion Ialis Ior Nan Kas","Ton Der Ade Rin Don Rich Nan Ret Al Born Coe By Fire Yas Dal Yle","Han Asar Ash Aar Esch An Rash En Arr Jed Rin Gar Ash Dinn Hun Rek","Orel Aadi Ahn Aver Eiros Kain Retor Lannan Pet Ikos","Er Ey A E Il Elia Ya Ed Eue Ild Oane Yne Orna Ie Ala Erri Ea Ia","Ber Tin Hild Dryn A Eth Runn Ellen Loda Dis Ja Lin Ra Tyrd De Rasa","Rie Aea Striana Inua Rynna Ilia Na Neth Leth Iel Lee Qui Astra Ia Ania Ynn","Dry Ree Lie Ora Emia Ian Ri Inia Ina Aena Ani Erna Lyse La Da Aela","Ra Ir Eh Ann Ilar Rinn Ann La Ra A Ina Va Hit Ederei Ere Eila","Ina Ceryn Vyn Ella Aella Vyre"].join(" ").toLowerCase().split(" "),a=b.randomNumber(e.length),s=b.randomNumber(t.length);let n="";if(1===f.dieRoll(10)){const e=["-","'"," "];n=e[b.randomNumber(e.length)]}return e[a]+n+t[s]}static generatePotion(){let e="";const t=D.potionColour(!0),a=D.potionLiquid(),s=D.potionAdjective(),n=D.potionFeature();switch(b.randomNumber(5)){case 0:e=t+" "+a;break;case 1:e=t+" "+a+" "+n;break;case 2:e=s+" "+t+" "+a;break;case 3:e=s+" "+t+" "+a+" "+n;break;case 4:e=s+" "+a+", "+t+" "+n}switch(e=(D.startsWithVowel(e)?"an":"a")+" "+e+" in "+D.potionContainer(),b.randomNumber(6)){case 0:e+="; it smells "+D.potionSmell();break;case 1:e+="; it tastes "+D.potionSmell();break;case 2:e+="; it smells "+D.potionSmell()+" but tastes "+D.potionSmell();break;case 3:e+="; it smells and tastes "+D.potionSmell()}return e}static generateBookTitle(){let e="";const t=D.bookNounPhrase(b.randomBoolean(),b.randomBoolean());switch(b.randomNumber(5)){case 0:e=t+"'s "+D.bookNounPhrase(b.randomBoolean(),!1);break;case 1:e=t+" "+D.bookPreposition()+" "+D.bookNounPhrase(b.randomBoolean(),!0);break;case 2:e=D.bookGerund()+" "+D.bookNounPhrase(b.randomBoolean(),!0);break;case 3:e=D.bookAbout()+" "+t;break;case 4:e=t}if(0===b.randomNumber(10)&&(e+=": "+D.bookAbout()+" "+D.bookNounPhrase(b.randomBoolean(),b.randomBoolean())),0===b.randomNumber(10)){let t="";switch(b.randomNumber(3)){case 0:t="volume";break;case 1:t="part";break;case 2:t="book"}switch(b.randomNumber(5)){case 0:e+=", "+t+" one";break;case 1:e+=", "+t+" two";break;case 2:e+=", "+t+" three";break;case 3:e+=", "+t+" four";break;case 4:e+=", "+t+" five"}}return e}static generateNPCAge(){const e=["elderly","middle-aged","teenage","youthful","young","old"];return e[b.randomNumber(e.length)]}static generateNPCProfession(){const e=["apothecary","architect","armourer","arrowsmith","astrologer","baker","barber","lawyer","beggar","bellfounder","blacksmith","bookbinder","brewer","bricklayer","butcher","carpenter","carter","cartwright","chandler","peddler","clerk","clockmaker","cobbler","cook","cooper","merchant","embroiderer","engraver","fisherman","fishmonger","forester","furrier","gardener","gemcutter","glassblower","goldsmith","grocer","haberdasher","stableman","courtier","herbalist","innkeeper","ironmonger","labourer","painter","locksmith","mason","messenger","miller","miner","minstrel","ploughman","farmer","porter","sailor","scribe","seamstress","shepherd","shipwright","soapmaker","tailor","tinker","vintner","weaver"];return e[b.randomNumber(e.length)]}static generateNPCHeight(){const e=["gangly","gigantic","hulking","lanky","short","small","stumpy","tall","tiny","willowy"];return e[b.randomNumber(e.length)]}static generateNPCWeight(){const e=["broad-shouldered","fat","gaunt","heavy-set","obese","plump","pot-bellied","rotund","skinny","slender","slim","statuesque","stout","thin"];return e[b.randomNumber(e.length)]}static generateNPCHair(){const e=["short","cropped","long","braided","dreadlocked","shoulder-length","wiry","balding","receeding","curly","tightly-curled","straight","greasy","limp","sparse","thinning","wavy"],t=["black","brown","dark brown","light brown","red","ginger","strawberry blonde","blonde","ash blonde","graying","silver","white","gray","auburn"];return e[b.randomNumber(e.length)]+", "+t[b.randomNumber(t.length)]}static generateNPCPhysical(){const e=["bearded","buck-toothed","chiselled","doe-eyed","fine-featured","florid","gap-toothed","goggle-eyed","grizzled","jowly","jug-eared","pock-marked","broken nose","red-cheeked","scarred","squinting","thin-lipped","toothless","weather-beaten","wrinkled"];return e[b.randomNumber(e.length)]}static generateNPCMental(){const e=["hot-tempered","overbearing","antagonistic","haughty","elitist","proud","rude","aloof","mischievous","impulsive","lusty","irreverent","madcap","thoughtless","absent-minded","insensitive","brave","craven","shy","fearless","obsequious","inquisitive","prying","intellectual","perceptive","keen","perfectionist","stern","harsh","punctual","driven","trusting","kind-hearted","forgiving","easy-going","compassionate","miserly","hard-hearted","covetous","avaricious","thrifty","wastrel","spendthrift","extravagant","kind","charitable","gloomy","morose","compulsive","irritable","vengeful","honest","truthful","innocent","gullible","bigoted","biased","narrow-minded","cheerful","happy","diplomatic","pleasant","foolhardy","affable","fatalistic","depressing","cynical","sarcastic","realistic","secretive","retiring","practical","level-headed","dull","reverent","scheming","paranoid","cautious","deceitful","nervous","uncultured","boorish","barbaric","graceless","crude","cruel","sadistic","immoral","jealous","belligerent","argumentative","arrogant","careless","curious","exacting","friendly","greedy","generous","moody","naive","opinionated","optimistic","pessimistic","quiet","sober","suspicious","uncivilised","violent","peaceful"];return e[b.randomNumber(e.length)]}static generateNPCSpeech(){const e=["accented","articulate","garrulous","breathless","crisp","gutteral","high-pitched","lisping","loud","nasal","slow","fast","squeaky","stuttering","wheezy","whiny","whispery","soft-spoken","laconic","blustering"];return e[b.randomNumber(e.length)]}static generateNPCTrait(){const e=["I idolize a particular hero of my faith and constantly refer to that person's deeds and example.","I can find common ground between the fiercest enemies, empathizing with them and always working toward peace.","I see omens in every event and action. The gods try to speak to us, we just need to listen.","Nothing can shake my optimistic attitude.","I quote (or misquote) the sacred texts and proverbs in almost every situation.","I am tolerant (or intolerant) of other faiths and respect (or condemn) the worship of other gods.","I've enjoyed fine food, drink, and high society among my temple's elite. Rough living grates on me.","I've spent so long in the temple that I have little practical experience dealing with people in the outside world.","I fall in and out of love easily, and am always pursuing someone.","I have a joke for every occasion, especially occasions where humor is inappropriate.","Flattery is my preferred trick for getting what I want.","I'm a born gambler who can't resist taking a risk for a potential payoff.","I lie about almost everything, even when there's no good reason to.","Sarcasm and insults are my weapons of choice.","I keep multiple holy symbols on me and invoke whatever deity might come in useful at any given moment.","I pocket anything I see that might have some value.","I always have plan for what to do when things go wrong.","I am always calm, no matter what the situation. I never raise my voice or let my emotions control me.","The first thing I do in a new place is note the locations of everything valuable - or where such things could be hidden.","I would rather make a new friend than a new enemy.","I am incredibly slow to trust. Those who seem the fairest often have the most to hide.","I don't pay attention to the risks in a situation. Never tell me the odds.","The best way to get me to do something is to tell me I can't do it.","I blow up at the slightest insult.","I know a story relevant to almost every situation.","Whenever I come to a new place, I collect local rumors and spread gossip.","I'm a hopeless romantic, always searching for that 'special someone'.","Nobody stays angry at me or around me for long, since I can defuse any amount of tension.","I love a good insult, even one directed at me.","I get bitter if I'm not the center of attention.","I'll settle for nothing less than perfection.","I change my mood or my mind as quickly as I change key in a song.","I judge people by their actions, not their words.","If someone is in trouble, I'm always willing to lend help.","When I set my mind to something, I follow through no matter what gets in my way.","I have a strong sense of fair play and always try to find the most equitable solution to arguments.","I'm confident in my own abilities and do what I can to instill confidence in others.","Thinking is for other people. I prefer action.","I misuse long words in an attempt to sound smarter.","I get bored easily. When am I going to get on with my destiny?","I believe that everything worth doing is worth doing right. I can't help it - I'm a perfectionist.","I'm a snob who looks down on those who can't appreciate fine art.","I always want to know how things work and what makes people tick.","I'm full of witty aphorisms and have a proverb for every occasion.","I'm rude to people who lack my commitment to hard work and fair play.","I like to talk at length about my profession.","I don't part with my money easily and will haggle tirelessly to get the best deal possible.","I'm well known for my work, and I want to make sure everyone appreciates it. I'm always taken aback when people haven't heard of me.","I've been isolated for so long that I rarely speak, preferring gestures and the occasional grunt.","I am utterly serene, even in the face of disaster.","The leader of my community has something wise to say on every topic, and I am eager to share that wisdom.","I feel tremendous empathy for all who suffer.","I'm oblivious to etiquette and social expectations.","I connect everything that happens to me to a grand cosmic plan.","I often get lost in my own thoughts and contemplations, becoming oblivious to my surroundings.","I am working on a grand philosophical theory and love sharing my ideas.","My eloquent flattery makes everyone I talk to feel like the most wonderful and important person in the world.","The common folk love me for my kindness and generosity.","No one could doubt by looking at my regal bearing that I am a cut above the unwashed masses.","I take great pains to always look my best and follow the latest fashions.","I don't like to get my hands dirty, and I won't be caught dead in unsuitable accommodations.","Despite my birth, I do not place myself above other folk. We all have the same blood.","My favor, once lost, is lost forever.","If you do me an injury, I will crush you, ruin your name, and salt your fields.","I'm driven by a wanderlust that led me away from home.","I watch over my friends as if they were a litter of newborn pups.","I once ran twenty-five miles without stopping to warn my clan of an approaching orc horde. I'd do it again if I had to.","I have a lesson for every situation, drawn from observing nature.","I place no stock in wealthy or well-mannered folk. Money and manners won't save you from a hungry owlbear.","I'm always picking things up, absently fiddling with them, and sometimes accidentally breaking them.","I feel far more comfortable around animals than people.","I was, in fact, raised by wolves.","I use polysyllabic words to convey the impression of great erudition.","I've read every book in the world's greatest libraries - or like to boast that I have.","I'm used to helping out those who aren't as smart as I am, and I patiently explain anything and everything to others.","There's nothing I like more than a good mystery.","I'm willing to listen to every side of an argument before I make my own judgment.","I...speak...slowly...when talking...to idiots...which...almost...everyone...is...compared...to me.","I am horribly, horribly awkward in social situations.","I'm convinced that people are always trying to steal my secrets.","My friends know they can rely on me, no matter what.","I work hard so that I can play hard when the work is done.","I enjoy sailing into new ports and making new friends over a flagon of ale.","I stretch the truth for the sake of a good story.","To me, a tavern brawl is a nice way to get to know a new city.","I never pass up a friendly wager.","My language is as foul as an otyugh nest.","I like a job well done, especially if I can convince someone else to do it.","I'm always polite and respectful.","I'm haunted by memories of war. I can't get the images of violence out of my mind.","I've lost too many friends, and I'm slow to make new ones.","I'm full of inspiring and cautionary tales from my military experience relevant to almost every combat situation.","I can stare down a hellhound without flinching.","I enjoy being strong and like breaking things.","I have a crude sense of humor.","I face problems head-on. A simple direct solution is the best path to success.","I hide scraps of food and trinkets away in my pockets.","I ask a lot of questions.","I like to squeeze into small places where no one else can get to me.","I sleep with my back to a wall or tree, with everything I own wrapped in a bundle in my arms.","I eat like a pig and have bad manners.","I think anyone who's nice to me is hiding evil intent.","I don't like to bathe.","I bluntly say what other people are hinting or hiding."];return e[b.randomNumber(e.length)]}static generateNPCIdeal(){const e=["Faith. I trust that my deity will guide my actions. I have faith that if I work hard, things will go well. (Lawful)","Tradition. The ancient traditions of worship and sacrifice must be preserved and upheld. (Lawful)","Charity. I always try to help those in need, no matter what the personal cost. (Good)","Change. We must help bring about the changes the gods are constantly working in the world. (Chaotic)","Power. I hope to one day rise to the top of my faith's religious hierarchy. (Lawful)","Aspiration. I seek to prove my self worthy of my god's favor by matching my actions against his or her teachings. (Any)","Independence. I am a free spirit - no one tells me what to do. (Chaotic)","Fairness. I never target people who can't afford to lose a few coins. (Lawful)","Charity. I distribute money I acquire to the people who really need it. (Good)","Creativity. I never run the same con twice. (Chaotic)","Friendship. Material goods come and go. Bonds of friendship last forever. (Good)","Aspiration. I'm determined to make something of myself. (Any)","Honor. I don't steal from others in the trade. (Lawful)","Freedom. Chains are meant to be broken, as are those who would forge them. (Chaotic)","Charity. I steal from the wealthy so that I can help people in need. (Good)","Greed. I will do whatever it takes to become wealthy. (Evil)","People. I'm loyal to my friends, not to any ideals, and everyone else can take a trip down the Styx for all I care. (Neutral)","Redemption. There's a spark of good in everyone. (Good)","Beauty. When I perform, I make the world better than it was. (Good)","Tradition. The stories, legends, and songs of the past must never be forgotten. (Lawful)","Creativity. The world is in need of new ideas and bold action. (Chaotic)","Greed. I'm only in it for the money and fame. (Evil)","People. I like seeing the smiles on people's faces when I perform. That's all that matters. (Neutral)","Honesty. Art should reflect the soul; it should come from within and reveal who we really are. (Any)","Respect. People deserve to be treated with dignity and respect. (Good)","Fairness. No one should get preferential treatment before the law, and no one is above the law. (Lawful)","Freedom. Tyrants must not be allowed to oppress the people. (Chaotic)","Might. If I become strong, I can take what I want - what I deserve. (Evil)","Sincerity. There's no good pretending to be something I'm not. (Neutral)","Destiny. Nothing and no one can steer me away from my higher calling. (Any)","Community. It is the duty of all civilized people to strengthen the bonds of community and the security of civilization. (Lawful)","Generosity. My talents were given to me so that I could use them to benefit the world. (Good)","Freedom. Everyone should be free to pursue his or her livelihood. (Chaotic)","Greed. I'm only in it for the money. (Evil)","People. I'm committed to the people I care about, not to ideals. (Neutral)","Aspiration. I work hard to be the best there is at my craft. (Any)","Greater Good. My gifts are meant to be shared with all, not used for my own benefit. (Good)","Logic. Emotions must not cloud our sense of what is right and true, or our logical thinking. (Lawful)","Free Thinking. Inquiry and curiosity are the pillars of progress. (Chaotic)","Power. Solitude and contemplation are paths toward mystical or magical power. (Evil)","Live and Let Live. Meddling in the affairs of others only causes trouble. (Neutral)","Self-Knowledge. If you know yourself, there're nothing left to know. (Any)","Respect. Respect is due to me because of my position, but all people regardless of station deserve to be treated with dignity. (Good)","Responsibility. It is my duty to respect the authority of those above me, just as those below me must respect mine. (Lawful)","Independence. I must prove that I can handle myself without the coddling of my family. (Chaotic)","Power. If I can attain more power, no one will tell me what to do. (Evil)","Family. Blood runs thicker than water. (Any)","Noble Obligation. It is my duty to protect and care for the people beneath me. (Good)","Change. Life is like the seasons, in constant change, and we must change with it. (Chaotic)","Greater Good. It is each person's responsibility to make the most happiness for the whole tribe. (Good)","Honor. If I dishonor myself, I dishonor my whole clan. (Lawful)","Might. The strongest are meant to rule. (Evil)","Nature. The natural world is more important than all the constructs of civilization. (Neutral)","Glory. I must earn glory in battle, for myself and my clan. (Any)","Knowledge. The path to power and self-improvement is through knowledge. (Neutral)","Beauty. What is beautiful points us beyond itself toward what is true. (Good)","Logic. Emotions must not cloud our logical thinking. (Lawful)","No Limits. Nothing should fetter the infinite possibility inherent in all existence. (Chaotic)","Power. Knowledge is the path to power and domination. (Evil)","Self-improvement. The goal of a life of study is the betterment of oneself.","Respect. The thing that keeps a ship together is mutual respect between captain and crew. (Good)","Fairness. We all do the work, so we all share in the rewards. (Lawful)","Freedom. The sea is freedom - the freedom to go anywhere and do anything. (Chaotic)","Master. I'm a predator, and the other ships on the sea are my prey. (Evil)","People. I'm committed to my crewmates, not to ideals. (Neutral)","Aspiration. Someday I'll own my own ship and chart my own destiny. (Any)","Greater Good. Our lot is to lay down our lives in defense of others. (Good)","Responsibility. I do what I must and obey just authority. (Lawful)","Independence. When people follow orders blindly they embrace a kind of tyranny. (Chaotic)","Might. In life as in war, the stronger force wins. (Evil)","Ideals aren't worth killing for or going to war for. (Neutral)","Nation. My city, nation, or people are all that matter. (Any)","Respect. All people, rich or poor, deserve respect. (Good)","Community. We have to take care of each other, because no one else is going to do it. (Lawful)","Change. The low are lifted up, and the high and mighty are brought down. Change is the nature of things. (Chaotic)","Retribution. The rich need to be shown what life and death are like in the gutters. (Evil)","People. I help people who help me - that's what keeps us alive. (Neutral)","Aspiration. I'm going to prove that I'm worthy of a better life. (Any)"];return e[b.randomNumber(e.length)]}static generateNPCBond(){const e=["I would die to recover an ancient artifact of my faith that was lost long ago.","I will someday get revenge on the corrupt temple hierarchy who branded me a heretic.","I owe me life to the priest who took me in when my parents died.","Everything I do is for the common people.","I will do anything to protect the temple where I served.","I seek to preserve a sacred text that my enemies consider heretical and seek to destroy.","I fleeced the wrong person and must work to ensure that this individual never crosses paths with me or those I care about.","I owe everything to my mentor - a horrible person who's probably rotting in jail somewhere.","Somewhere out there I have a child who doesn't know me. I'm making the world better for him or her.","I come from a noble family, and one day I'll reclaim my lands and title from those who stole them from me.","A powerful person killed someone I love. Some day soon, I'll have my revenge.","I swindled and ruined a person who didn't deserve it. I seek to atone for my misdeeds but might never be able to forgive myself.","I'm trying to pay off an old debt I owe to a generous benefactor.","My ill-gotten gains go to support my family.","Something important was taken from me, and I aim to steal it back.","I will become the greatest thief that ever lived.","I'm guilty of a terrible crime. I hope I can redeem myself for it.","Someone I loved died because of a mistake I made. That will never happen again.","My instrument is my most treasured possession, and it reminds me of someone I love.","Someone stole my precious instrument, and someday I'll get it back.","I want to be famous, whatever it takes.","I idolize a hero of the old tales and measure my deeds against that person's.","I will do anything to prove myself superior to me hated rival.","I would do anything for the other members of my old troupe.","I have a family, but I have no idea where they are. One day, I hope to see them again.","I worked the land, I love the land, and I will protect the land.","A proud noble once gave me a horrible beating, and I will take my revenge on any bully I encounter.","My tools are symbols of my past life, and I carry them so that I will never forget my roots.","I protect those who cannot protect themselves.","I wish my childhood sweetheart had come with me to pursue my destiny.","The workshop where I learned my trade is the most important place in the world to me.","I created a great work for someone, and then found them unworthy to receive it. I'm still looking for someone worthy.","I owe my guild a great debt for forging me into the person I am today.","I pursue wealth to secure someone's love.","One day I will return to my guild and prove that I am the greatest artisan of them all.","I will get revenge on the evil forces that destroyed my place of business and ruined my livelihood.","Nothing is more important than the other members of my hermitage, order, or association.","I entered seclusion to hide from the ones who might still be hunting me. I must someday confront them.","I'm still seeking the enlightenment I pursued in my seclusion, and it still eludes me.","I entered seclusion because I loved someone I could not have.","Should my discovery come to light, it could bring ruin to the world.","My isolation gave me great insight into a great evil that only I can destroy.","I will face any challenge to win the approval of my family.","My house's alliance with another noble family must be sustained at all costs.","Nothing is more important that the other members of my family.","I am in love with the heir of a family that my family despises.","My loyalty to my sovereign is unwavering.","The common folk must see me as a hero of the people.","My family, clan, or tribe is the most important thing in my life, even when they are far from me.","An injury to the unspoiled wilderness of my home is an injury to me.","I will bring terrible wrath down on the evildoers who destroyed my homeland.","I am the last of my tribe, and it is up to me to ensure their names enter legend.","I suffer awful visions of a coming disaster and will do anything to prevent it.","It is my duty to provide children to sustain my tribe.","It is my duty to protect my students.","I have an ancient text that holds terrible secrets that must not fall into the wrong hands.","I work to preserve a library, university, scriptorium, or monastery.","My life's work is a series of tomes related to a specific field of lore.","I've been searching my whole life for the answer to a certain question.","I sold my soul for knowledge. I hope to do great deeds and win it back.","I'm loyal to my captain first, everything else second.","The ship is most important - crewmates and captains come and go.","I'll always remember my first ship.","In a harbor town, I have a paramour whose eyes nearly stole me from the sea.","I was cheated of my fair share of the profits, and I want to get my due.","Ruthless pirates murdered my captain and crewmates, plundered our ship, and left me to die. Vengeance will be mine.","I would lay down my life for the people I served with.","Someone saved my life on the battlefield. To this day, I will never leave a friend behind.","My honor is my life.","I'll never forget the crushing defeat my company suffered or the enemies who dealt it.","Those who fight beside me are those worth dying for.","I fight for those who cannot fight for themselves.","My town or city is my home, and I'll fight to defend it.","I sponsor an orphanage to keep others from enduring what I was forced to endure.","I owe my survival to another urchin who taught me to live on the streets.","I owe a debt I can never repay to the person who took pity on me.","I escaped my life of poverty by robbing an important person, and I'm wanted for it.","No one else is going to have to endure the hardships I've been through."];return e[b.randomNumber(e.length)]}static generateNPCFlaw(){const e=["I judge others harshly, and myself even more severely.","I put too much trust in those who wield power within my temple's hierarchy.","My piety sometimes leads me to blindly trust those that profess faith in my god.","I am inflexible in my thinking.","I am suspicious of strangers and suspect the worst of them.","Once I pick a goal, I become obsessed with it to the detriment of everything else in my life.","I can't resist a pretty face.","I'm always in debt. I spend my ill-gotten gains on decadent luxuries faster than I bring them in.","I'm convinced that no one could ever fool me in the way I fool others.","I'm too greedy for my own good. I can't resist taking a risk if there's money involved.","I can't resist swindling people who are more powerful than me.","I hate to admit it and will hate myself for it, but I'll run and preserve my own hide if the going gets tough.","When I see something valuable, I can't think about anything but how to steal it.","When faced with a choice between money and my friends, I usually choose the money.","If there's a plan, I'll forget it. If I don't forget it, I'll ignore it.","I have a 'tell' that reveals when I'm lying.","I turn tail and run when things go bad.","An innocent person is in prison for a crime that I committed. I'm okay with that.","I'll do anything to win fame and renown.","I'm a sucker for a pretty face.","A scandal prevents me from ever going home again. That kind of trouble seems to follow me around.","I once satirized a noble who still wants my head. It was a mistake that I will likely repeat.","I have trouble keeping my true feelings hidden. My sharp tongue lands me in trouble.","Despite my best efforts, I am unreliable to my friends.","The tyrant who rules my land will stop at nothing to see me killed.","I'm convinced of the significance of my destiny, and blind to my shortcomings and the risk of failure.","The people who knew me when I was young know my shameful secret, so I can never go home again.","I have a weakness for the vices of the city, especially hard drink.","Secretly, I believe that things would be better if I were a tyrant lording over the land.","I have trouble trusting in my allies.","I'll do anything to get my hands on something rare or priceless.","I'm quick to assume that someone is trying to cheat me.","No one must ever learn that I once stole money from guild coffers.","I'm never satisfied with what I have - I always want more.","I would kill to acquire a noble title.","I'm horribly jealous of anyone who outshines my handiwork. Everywhere I go, I'm surrounded by rivals.","Now that I've returned to the world, I enjoy its delights a little too much.","I harbor dark bloodthirsty thoughts that my isolation failed to quell.","I am dogmatic in my thoughts and philosophy.","I let my need to win arguments overshadow friendships and harmony.","I'd risk too much to uncover a lost bit of knowledge.","I like keeping secrets and won't share them with anyone.","I secretly believe that everyone is beneath me.","I hide a truly scandalous secret that could ruin my family forever.","I too often hear veiled insults and threats in every word addressed to me, and I'm quick to anger.","I have an insatiable desire for carnal pleasures.","In fact, the world does revolve around me.","By my words and actions, I often bring shame to my family.","I am too enamored of ale, wine, and other intoxicants.","There's no room for caution in a life lived to the fullest.","I remember every insult I've received and nurse a silent resentment toward anyone who's ever wronged me.","I am slow to trust members of other races","Violence is my answer to almost any challenge.","Don't expect me to save those who can't save themselves. It is nature's way that the strong thrive and the weak perish.","I am easily distracted by the promise of information.","Most people scream and run when they see a demon. I stop and take notes on its anatomy.","Unlocking an ancient mystery is worth the price of a civilization.","I overlook obvious solutions in favor of complicated ones.","I speak without really thinking through my words, invariably insulting others.","I can't keep a secret to save my life, or anyone else's.","I follow orders, even if I think they're wrong.","I'll say anything to avoid having to do extra work.","Once someone questions my courage, I never back down no matter how dangerous the situation.","Once I start drinking, it's hard for me to stop.","I can't help but pocket loose coins and other trinkets I come across.","My pride will probably lead to my destruction","The monstrous enemy we faced in battle still leaves me quivering with fear.","I have little respect for anyone who is not a proven warrior.","I made a terrible mistake in battle that cost many lives - and I would do anything to keep that mistake secret.","My hatred of my enemies is blind and unreasoning.","I obey the law, even if the law causes misery.","I'd rather eat my armor than admit when I'm wrong.","If I'm outnumbered, I always run away from a fight.","Gold seems like a lot of money to me, and I'll do just about anything for more of it.","I will never fully trust anyone other than myself.","I'd rather kill someone in their sleep than fight fair.","It's not stealing if I need it more than someone else.","People who don't take care of themselves get what they deserve."];return e[b.randomNumber(e.length)]}static generateTreasure(){let e="";const t=["diamond","ruby","sapphire","emerald","amethyst","garnet","topaz","pearl","black pearl","opal","fire opal","amber","coral","agate","carnelian","jade","peridot","moonstone","alexandrite","aquamarine","jacinth","marble"];switch(b.randomNumber(12)){case 0:case 1:case 2:let a=t[b.randomNumber(t.length)];switch(b.randomBoolean()){case!0:a+=" gemstone";break;case!1:a="piece of "+a}switch(b.randomNumber(12)){case 0:a="well cut "+a;break;case 1:a="rough-cut "+a;break;case 2:a="poorly cut "+a;break;case 3:a="small "+a;break;case 4:a="large "+a;break;case 5:a="oddly shaped "+a;break;case 6:a="highly polished "+a}e=a;break;case 3:case 4:case 5:const s=["medal","statuette","sculpture","idol","chalice","goblet","dish","bowl"],n=s[b.randomNumber(s.length)],r=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];e=r[b.randomNumber(r.length)]+" "+n;break;case 6:case 7:case 8:const i=["ring","necklace","crown","circlet","bracelet","anklet","torc","brooch","pendant","locket","diadem","tiara","earring"],o=i[b.randomNumber(i.length)],l=["gold","silver","bronze","platinum","electrum","mithral","orium","adamantine"];switch(e=l[b.randomNumber(l.length)]+" "+o,b.randomNumber(5)){case 0:e=(b.randomBoolean()?"enamelled":"laquered")+" "+e;break;case 1:e=l[b.randomNumber(l.length)]+"-"+(b.randomBoolean()?"plated":"filigreed")+" "+e}switch(b.randomNumber(10)){case 0:e="delicate "+e;break;case 1:e="intricate "+e;break;case 2:e="elegant "+e;break;case 3:e="simple "+e;break;case 4:e="plain "+e}break;case 9:case 10:let c="";switch(b.randomBoolean()){case!0:switch(c="painting",b.randomBoolean()){case!0:c="oil "+c;break;case!1:c="watercolour "+c}break;case!1:switch(c="drawing",b.randomNumber(3)){case 0:c="pencil "+c;break;case 1:c="charcoal "+c;break;case 2:c="pastel "+c}}const d=["small","large","delicate","fragile","elegant","detailed"],p=["canvas","paper","parchment","wood panels","fabric"];e=d[b.randomNumber(d.length)]+" "+c+" on "+p[b.randomNumber(p.length)];break;case 11:const h=["lute","lyre","mandolin","violin","drum","flute","clarinet","accordion","banjo","bodhran","ocarina","zither","djembe","shawm"],m=h[b.randomNumber(h.length)],u=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];e=u[b.randomNumber(u.length)]+" "+m}switch(b.randomNumber(5)){case 0:const a=["feywild","shadowfell","elemental chaos","astral plane","abyss","distant north","distant east","distant west","distant south"];e+=" from the "+a[b.randomNumber(a.length)];break;case 1:const s=["decorated with","inscribed with","engraved with","embossed with","carved with"],n=["indecipherable","ancient","curious","unusual","dwarven","eladrin","elven","draconic","gith"],r=["script","designs","sigils","runes","glyphs","patterns"];e+=" "+s[b.randomNumber(s.length)]+" "+n[b.randomNumber(n.length)]+" "+r[b.randomNumber(r.length)];break;case 2:const i=["glowing with","suffused with","infused with","humming with","pulsing with"],o=["arcane","divine","primal","psionic","dark","shadow","elemental","ethereal","unknown"],l=["energy","power","magic"];e+=" "+i[b.randomNumber(i.length)]+" "+o[b.randomNumber(o.length)]+" "+l[b.randomNumber(l.length)];break;case 4:let c=t[b.randomNumber(t.length)];b.randomBoolean()?c+="s":c="a single "+c;const d=["set with","inlaid with","studded with","with shards of"];e+=" "+d[b.randomNumber(d.length)]+" "+c}return(D.startsWithVowel(e)?"an ":"a ")+e}static generateRoomName(){const e=["antechamber","arena","armoury","aviary","audience chamber","banquet hall","bath chamber","barracks","bedroom","boudoir","bestiary","burial chamber","cells","chamber","chantry","chapel","classroom","closet","court","crypt","dining room","dormitory","dressing room","dumping ground","entrance hall","gallery","game room","great hall","guard post","hall","harem","hoard","infirmary","kennels","kitchens","laboratory","lair","library","mausoleum","meditation room","museum","nursery","observatory","office","pantry","prison","quarters","reception room","refectory","ritual chamber","shrine","smithy","stable","storeroom","study","temple","throne room","torture chamber","trophy room","training area","treasury","waiting room","workroom","workshop","vault","vestibule"];return e[b.randomNumber(e.length)]}static potionColour(e){let t=["red","scarlet","crimson","carmine","vermillion","pink","blue","royal blue","sky blue","light blue","dark blue","midnight blue","indigo","yellow","lemon yellow","amber","green","light green","dark green","sea green","turquoise","aquamarine","emerald","purple","lavender","lilac","mauve","orange","brown","maroon","ochre","black","dark grey","grey","light grey","off-white","white","golden","silver"];if(e&&(t=t.concat(["blood red","cherry red","ruby-coloured","rose-coloured","sapphire-coloured","straw-coloured","olive-coloured","plum-coloured","mud-coloured","cream-coloured","ivory-coloured","bronze-coloured","colourless","clear","transparent"])),e&&0===b.randomNumber(5)){const e=b.randomNumber(t.length),a=b.randomNumber(t.length),s=[t[e],t[a]];return b.sort(s,[{field:"length",dir:"asc"}]),s[0]+" and "+s[1]}return t[b.randomNumber(t.length)]}static potionAdjective(){const e=["watery","syrupy","thick","viscous","gloopy","thin","runny","translucent","effervescent","fizzing","bubbling","foaming","volatile","smoking","fuming","vaporous","steaming","cold","icy cold","hot","sparkling","iridescent","cloudy","opalescent","luminous","phosphorescent","glowing"];return e[b.randomNumber(e.length)]}static potionFeature(){switch(b.randomNumber(6)){case 0:return"with "+this.potionColour(!0)+" specks";case 1:return"with flecks of "+this.potionColour(!1);case 2:const e=this.potionColour(!0);return"with "+(D.startsWithVowel(e)?"an":"a")+" "+e+" suspension";case 3:return"with a floating "+this.potionColour(!0)+" layer";case 4:return"with a ribbon of "+this.potionColour(!1);case 5:return"with "+this.potionColour(!0)+" marbling"}return""}static potionLiquid(){const e=["liquid","solution","draught","oil","elixir","potion"];return e[b.randomNumber(e.length)]}static potionContainer(){const e=["small","rounded","tall","square","irregularly-shaped","long-necked","cylindrical","round-bottomed"],t=["glass","metal","ceramic","crystal"],a=["vial","jar","bottle","flask"],s=e[b.randomNumber(e.length)];let n=t[b.randomNumber(t.length)];const r=a[b.randomNumber(a.length)];0===b.randomNumber(3)&&(n=this.potionColour(!0)+" "+n);let i="";switch(b.randomBoolean()){case!0:i=n+" "+r;break;case!1:i=s+" "+n+" "+r}return(D.startsWithVowel(i)?"an":"a")+" "+i}static potionSmell(){const e=["acidic","acrid","of ammonia","of apples","bitter","brackish","buttery","of cherries","delicious","earthy","of earwax","of fish","floral","of lavender","lemony","of honey","fruity","meaty","metallic","musty","of onions","of oranges","peppery","of perfume","rotten","salty","sickly sweet","starchy","sugary","smokey","sour","spicy","of sweat","sweet","unpleasant","vile","vinegary"];return e[b.randomNumber(e.length)]}static bookNounPhrase(e,t){let a=D.bookNoun(e),s=!1;if(e&&0===b.randomNumber(5)&&(a+="s",s=!0),0===b.randomNumber(3)){a=D.bookAdjective()+" "+a}if(t&&b.randomBoolean())switch(b.randomBoolean()){case!0:a="the "+a;break;case!1:if(s)switch(b.randomNumber(6)){case 0:a="two "+a;break;case 1:a="three "+a;break;case 2:a="four "+a;break;case 3:a="five "+a;break;case 4:a="six "+a;break;case 5:a="seven "+a}else switch(b.randomBoolean()){case!0:a=(D.startsWithVowel(a)?"an":"a")+" "+a;break;case!1:a="one "+a}}return a}static bookNoun(e){let t=["elf","halfling","dwarf","gnome","tiefling","dragonborn","goliath","changeling","drow","minotaur","beast","orc","goblin","hobgoblin","dragon","demon","devil","angel","god","gith","night","day","eclipse","shadow","sky","sun","moon","star","void","battle","war","brawl","fist","blade","arrow","spell","prayer","eye","wing","army","legion","brigade","galleon","warship","frigate","potion","jewel","ring","amulet","cloak","sword","spear","helm","wizard","king","queen","prince","princess","warlock","barbarian","sorcerer","thief","mage","child","wayfarer","adventurer","pirate","spy","sage","assassin","mountain","forest","peak","cave","cavern","lake","swamp","marshland","island","shore","city","town","village","tower","arena","castle","citadel","bridge","game","wager","quest","challenge","rose","lily","thorn","leaf","word","snake","serpent","song","lament","dirge","elegy","storm","tempest"];e||(t=t.concat(["darkness","light","dusk","twilight","revenge","vengeance","blood","earth","water","ice","wood","metal","lightning","thunder","mist","snow","flame","fire","wind","stone","destruction","life","death","time","end","danger","luck","chaos","truth","untruth","lie","deception","music","sound","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"]));return t[b.randomNumber(t.length)]}static bookAdjective(){const e=["dark","bright","tyrannous","devout","noble","eldritch","mystical","magical","sorcerous","savage","silent","lonely","violent","peaceful","black","white","gold","silver","red","pale","dying","living","ascending","defiled","mythical","legendary","heroic","empty","mighty","despairing","spellbound","enchanted","soaring","falling","visionary","bold","perilous"];return e[b.randomNumber(e.length)]}static bookGerund(){const e=["killing","murdering","watching","examining","enchanting","destroying","defying","betraying","protecting","silencing","bearing","fighting"];return e[b.randomNumber(e.length)]}static bookPreposition(){const e=["and","in","of","with","against","for","to","towards"];return e[b.randomNumber(e.length)]}static bookAbout(){const e=["treatise","essay","monograph","discourse","dissertation","primer","history","enchiridion"];let t=e[b.randomNumber(e.length)];b.randomBoolean()?t=(D.startsWithVowel(t)?"an ":"a ")+t:t+="s";const a=["about","on","concerning","regarding","on the subject of"];return t+" "+a[b.randomNumber(a.length)]}}D.model=[],D.maxLength=0;const T=["default","cavern","dirt","flagstone","floorboard","grassland","pit","sand","snow","water","custom","link"],A=["single","double","arch","bars"],P=["stairs","spiral","ladder"];class V{static scatterCombatants(e,t,a){e.items=e.items.filter(e=>!t.map(e=>e.id).includes(e.id));if(e.items.filter(e=>"tile"===e.type).length>0){let s=null;if(a){const t=e.areas.find(e=>e.id===a);t&&(s={minX:t.x,minY:t.y,maxX:t.x+t.width-1,maxY:t.y+t.height-1})}const n=s||V.mapDimensions(e.items);n&&t.forEach(t=>{const a=[];for(let s=n.minX;s<=n.maxX;++s)for(let r=n.minY;r<=n.maxY;++r){V.canAddMonsterHere(e,t,s,r)&&a.push({x:s,y:r})}if(a.length>0){const s=a[b.randomNumber(a.length)],n=f.miniSize(t.displaySize),r=E.createMapItem();r.id=t.id,r.type=t.type,r.x=s.x,r.y=s.y,r.height=n,r.width=n,e.items.push(r)}})}}static moveCombatants(e,t,a,s,n){const r=M.getMountsAndRiders(e,a).map(e=>e.id);e.forEach(e=>{r.includes(e)||r.push(e)}),r.forEach(e=>{const t=a.find(t=>t.id===e);if(t&&t.path){const a=s.items.find(t=>t.id===e);a&&t.path.push({x:a.x,y:a.y,z:a.z})}}),r.forEach(e=>V.move(s,e,t,n)),M.setMountPositions(a,s)}static mapDimensions(e){const t=e.filter(e=>"tile"===e.type);if(t.length>0){let e=t[0].x,a=t[0].y,s=t[0].x+t[0].width-1,n=t[0].y+t[0].height-1;return t.forEach(t=>{e=Math.min(e,t.x),a=Math.min(a,t.y),s=Math.max(s,t.x+t.width-1),n=Math.max(n,t.y+t.height-1)}),{minX:e,minY:a,maxX:s,maxY:n}}return null}static calculateDistance(e,t,a){let s=0;e.x>t&&(s=e.x-t),e.x+e.width-1<t&&(s=t-(e.x+e.width-1));let n=0;return e.y>a&&(n=e.y-a),e.y+e.height-1<a&&(n=a-(e.y+e.height-1)),5*Math.ceil(Math.sqrt(Math.pow(s,2)+Math.pow(n,2)))}static canAddTileHere(e,t,a,s,n,r,i){const o=[],l=a-i,c=t+(s-1)+r,d=a+(n-1)+i;for(let p=t-r;p<=c;++p)for(let t=l;t<=d;++t){const a=V.itemsAt(e,p,t).every(e=>"tile"!==e.type);o.push(a)}return o.every(e=>e)}static canAddMonsterHere(e,t,a,s){const n=[],r=f.miniSize(t.displaySize),i=a+Math.max(1,r)-1,o=s+Math.max(1,r)-1;for(let l=a;l<=i;++l)for(let t=s;t<=o;++t){const a=V.itemsAt(e,l,t),s=a.length>0&&a.every(e=>"tile"===e.type);n.push(s)}return n.every(e=>e)}static itemsAt(e,t,a){return e.items.filter(e=>{const s=e.x,n=e.x+e.width-1,r=e.y,i=e.y+e.height-1;return t>=s&&t<=n&&a>=r&&a<=i})}static rotateMap(e){e.items.forEach(e=>{const t=-1*(e.y+e.height-1),a=e.x,s=e.height,n=e.width;e.x=t,e.y=a,e.width=s,e.height=n,e.content&&(e.content.orientation="horizontal"===e.content.orientation?"vertical":"horizontal")}),e.areas.forEach(e=>{const t=-1*(e.y+e.height-1),a=e.x,s=e.height,n=e.width;e.x=t,e.y=a,e.width=s,e.height=n})}static mapSize(e){return e.items.filter(e=>"tile"===e.type).reduce((e,t)=>e+V.mapTileSize(t),0)}static mapTileSize(e){return"tile"===e.type?e.width*e.height:0}static generate(e,t){switch(e){case"dungeon":let e=0;for(;e<10;)V.addRoom(t)&&(e+=1);break;case"delve":let a=0;for(;a<3;)V.addRoom(t)&&(a+=1);break;case"room":let s=!1;for(;!s;)s=V.addRoom(t)}}static addRoom(e){const t=E.createMapItem();t.type="tile",t.terrain="default",t.style="square",t.width=f.dieRoll(6,2)+2,t.height=f.dieRoll(6,2)+2;let a=null;const s=V.mapDimensions(e.items);if(s){const n=1,r=2;s.minX-=t.width+r,s.minY-=t.height+r,s.maxX+=r,s.maxY+=r;const i=[];for(let a=s.minX;a!==s.maxX;++a)for(let r=s.minY;r!==s.maxY;++r){V.canAddTileHere(e,a,r,t.width,t.height,n,n)&&i.push({x:a,y:r})}if(!(i.length>0))return!1;{const e=b.randomNumber(i.length);t.x=i[e].x,t.y=i[e].y}const o=[];if(e.items.filter(e=>"tile"===e.type).forEach(a=>{const s=Math.max(t.x,a.x),n=Math.min(t.x+t.width-1,a.x+a.width-1);if(n-s+1>=2){const r=Math.min(t.y+t.height-1,a.y+a.height-1)+1,i=Math.max(t.y,a.y)-1;for(let t=s;t<=n-1;++t){const a=E.createMapItem();a.type="tile",a.terrain="default",a.style="square",a.x=t,a.y=r,a.width=2,a.height=i-r+1,V.canAddTileHere(e,a.x,a.y,a.width,a.height,1,0)&&o.push({tile:a,horizontal:!1})}}const r=Math.max(t.y,a.y),i=Math.min(t.y+t.height-1,a.y+a.height-1);if(i-r+1>=2){const s=Math.min(t.x+t.width-1,a.x+a.width-1)+1,n=Math.max(t.x,a.x)-1;for(let t=r;t<=i-1;++t){const a=E.createMapItem();a.type="tile",a.terrain="default",a.style="square",a.x=s,a.y=t,a.width=n-s+1,a.height=2,V.canAddTileHere(e,a.x,a.y,a.width,a.height,0,1)&&o.push({tile:a,horizontal:!0})}}}),!(o.length>0))return!1;{const s=b.randomNumber(o.length),n=o[s];if(!n.horizontal&&1===n.tile.height||n.horizontal&&1===n.tile.width)2===f.dieRoll(2)&&(n.tile.content={type:"doorway",style:V.getRandomDoorwayStyle(),orientation:n.horizontal?"vertical":"horizontal"});else{if(!n.horizontal&&n.tile.height>=4||n.horizontal&&n.tile.width>=4){if(2===f.dieRoll(2)){const t=E.createMapItem();t.type="tile",t.terrain="default",t.style="square",t.content={type:"doorway",style:V.getRandomDoorwayStyle(),orientation:""},n.horizontal?(t.x=n.tile.x,t.y=n.tile.y,t.width=1,t.height=2,t.content.orientation="vertical",n.tile.x+=1,n.tile.width-=1):(t.x=n.tile.x,t.y=n.tile.y,t.width=2,t.height=1,t.content.orientation="horizontal",n.tile.y+=1,n.tile.height-=1),e.items.push(t)}if(2===f.dieRoll(2)){const t=E.createMapItem();t.type="tile",t.terrain="default",t.style="square",t.content={type:"doorway",style:V.getRandomDoorwayStyle(),orientation:""},n.horizontal?(t.x=n.tile.x+n.tile.width-1,t.y=n.tile.y,t.width=1,t.height=2,t.content.orientation="vertical",n.tile.width-=1):(t.x=n.tile.x,t.y=n.tile.y+n.tile.height-1,t.width=2,t.height=1,t.content.orientation="horizontal",n.tile.height-=1),e.items.push(t)}}(!n.horizontal&&n.tile.height<=4||n.horizontal&&n.tile.width<=4)&&3===f.dieRoll(3)&&(n.tile.content={type:"stairway",style:"stairs",orientation:n.horizontal?"vertical":"horizontal"})}a=this.getRoomAdjunct(t,e),e.items.push(n.tile),e.items.push(t),a&&e.items.push(a)}}else a=this.getRoomAdjunct(t,e),e.items.push(t),a&&e.items.push(a);const n=[t];a&&n.push(a);const r=this.mapDimensions(n);if(r){const t=E.createMapArea();t.name=D.capitalise(D.generateRoomName()),t.x=r.minX-1,t.y=r.minY-1,t.width=r.maxX-r.minX+3,t.height=r.maxY-r.minY+3,e.areas.push(t)}return!0}static getRoomAdjunct(e,t){if(b.randomBoolean())return null;let a=0,s=0;const n=[];switch(b.randomNumber(2)){case 0:a=b.randomNumber(e.width-2)+2,s=f.dieRoll(4,2);const r=e.width-a;for(let o=0;o!==r;++o){const r=e.x+o,i=e.y-s;V.canAddTileHere(t,r,i,a,s,1,1)&&n.push({x:r,y:i});const l=e.y+e.height;V.canAddTileHere(t,r,l,a,s,1,1)&&n.push({x:r,y:l})}break;case 1:a=f.dieRoll(4,2),s=b.randomNumber(e.height-2)+2;const i=e.height-s;for(let o=0;o!==i;++o){const r=e.y+o,i=e.x-a;V.canAddTileHere(t,i,r,a,s,1,1)&&n.push({x:i,y:r});const l=e.x+e.width;V.canAddTileHere(t,l,r,a,s,1,1)&&n.push({x:l,y:r})}}if(n.length>0){const e=n[b.randomNumber(n.length)],t=E.createMapItem();return t.type="tile",t.terrain="default",t.style="square",t.x=e.x,t.y=e.y,t.width=a,t.height=s,t}return null}static getRandomDoorwayStyle(){const e=b.randomNumber(A.length);return A[e]}static getViewport(e,t){if(t){const a=e.areas.find(e=>e.id===t);if(a)return{minX:a.x,minY:a.y,maxX:a.x+a.width-1,maxY:a.y+a.height-1}}return null}static add(e,t,a,s){let n=e.items.find(e=>e.id===t.id);if(n)t.path&&t.path.push({x:n.x,y:n.y,z:n.z});else{n=E.createMapItem(),n.id=t.id,n.type=t.type;const a=f.miniSize(t.displaySize);n.height=a,n.width=a,e.items.push(n)}n.x=a,n.y=s}static move(e,t,a,s){let n=null;if(n=e.items.find(e=>e.id===t)||null,n||(n=e.areas.find(e=>e.id===t)||null),n)switch(a){case"N":n.y-=s;break;case"NE":n.x+=s,n.y-=s;break;case"E":n.x+=s;break;case"SE":n.x+=s,n.y+=s;break;case"S":n.y+=s;break;case"SW":n.x-=s,n.y+=s;break;case"W":n.x-=s;break;case"NW":n.x-=s,n.y-=s;break;case"UP":n.z+=s;break;case"DOWN":n.z-=s}}static remove(e,t){const a=e.items.find(e=>e.id===t);if(a){const t=e.items.indexOf(a);e.items.splice(t,1)}}static getDistance(e,t,a){let s=0;const n=t.concat([e]);let r=null;return n.forEach(e=>{r&&(s+=V.getStepDistance(r,e,a)),r=e}),s}static getStepDistance(e,t,a){if(!e||!t)return 0;const s=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),r=Math.abs(e.z-t.z),i=Math.max(s,n,r);if(s>0&&n>0||s>0&&r>0||n>0&&r>0){if(i>1){const e=Math.sqrt(Math.pow(s,2)+Math.pow(n,2)+Math.pow(r,2));return Math.round(2*e)/2}switch(a){case"one":return s;case"two":return 2*s;default:return 1.5*s}}return i}}var O=a(80),L=a.n(O),R=a(81),z=a.n(R),q=a(60),F=a.n(q);class G{static getDefaultData(){return{people:[],messages:[],party:null,shared:{type:"nothing",data:null,images:[],additional:{}},options:{allowChat:!1,allowControls:!1}}}static getID(){return this.peer?this.peer.id:""}static getPartyID(){return this.data.party?this.data.party.id:""}static getName(e){const t=this.data.people.find(t=>t.id===e);return t?t.name:"unknown person"}static getStatus(e){const t=this.data.people.find(t=>t.id===e);return t?t.status:""}static getCharacterID(e){const t=this.data.people.find(t=>t.id===e);return t?t.characterID:""}static getCurrentName(e){if(this.data.party){const t=this.data.people.find(t=>t.id===e);if(t&&t.characterID){const e=this.data.party.pcs.find(e=>e.id===t.characterID);if(e)return e.name}}return G.getName(e)}static getCombatant(e){var t;return null!==(t=G.getCombatants().find(t=>t.id===e))&&void 0!==t?t:null}static getCombatants(){if("combat"===G.data.shared.type){return G.data.shared.data.combatants}if("exploration"===G.data.shared.type){return G.data.shared.data.combatants}return[]}static getMap(){if("combat"===G.data.shared.type){return G.data.shared.data.map}if("exploration"===G.data.shared.type){return G.data.shared.data.map}return null}static createTextPacket(e,t,a,s){return{type:"message",payload:{id:b.guid(),from:G.getID(),to:e,type:"text",data:{text:t,language:a,untranslated:s}}}}static createLinkPacket(e,t){return{type:"message",payload:{id:b.guid(),from:G.getID(),to:e,type:"link",data:{url:t}}}}static createImagePacket(e,t){return{type:"message",payload:{id:b.guid(),from:G.getID(),to:e,type:"image",data:{image:t}}}}static createRollPacket(e,t){return{type:"message",payload:{id:b.guid(),from:G.getID(),to:e,type:"roll",data:{roll:t}}}}static createCardPacket(e,t){return{type:"message",payload:{id:b.guid(),from:G.getID(),to:e,type:"card",data:{card:t}}}}static packetToString(e){const t=JSON.stringify(e);return L.a.compressToUTF16(t)}static stringToPacket(e){const t=L.a.decompressFromUTF16(e);return JSON.parse(t)}static processPacket(e){switch(e.type){case"update":if(e.payload.people&&(this.data.people=e.payload.people),e.payload.party&&(this.data.party=e.payload.party),e.payload.shared&&(this.data.shared=e.payload.shared,G.previousReceivedSharedState=JSON.parse(JSON.stringify(this.data.shared))),e.payload.sharedDiff){const t=e.payload.sharedDiff;F.a.applyDiff(G.data.shared,t),G.previousReceivedSharedState=JSON.parse(JSON.stringify(this.data.shared))}e.payload.options&&(this.data.options=e.payload.options);break;case"player-info":const t=e.payload.player,a=this.data.people.find(e=>e.id===t);a&&(a.status=e.payload.status,a.characterID=e.payload.characterID);break;case"character-info":if(G.data.party){const t=e.payload.pc,a=G.data.party.pcs.find(e=>e.id===t.id);if(a){const e=G.data.party.pcs.indexOf(a);if(-1!==e){G.data.party.pcs[e]=t;let a=null;if("combat"===G.data.shared.type){a=G.data.shared.data.combatants.find(e=>e.id===t.id)}if("exploration"===G.data.shared.type){a=G.data.shared.data.combatants.find(e=>e.id===t.id)}a&&M.updateCombatant(a,t)}}else G.data.party.pcs.push(t);b.sort(G.data.party.pcs)}break;case"message":const s={id:e.payload.id,from:e.payload.from,to:e.payload.to,type:e.payload.type,data:e.payload.data};this.data.messages.push(s),s.from!==G.getID()&&(0===s.to.length||s.to.includes(G.getID()))&&this.onNewMessage&&this.onNewMessage(s);break;case"prompt":if(this.onPrompt){const t=e.payload.prompt,a=e.payload.data;this.onPrompt(t,a)}break;case"roll-result":if("initiative"===e.payload.roll){const t=e.payload.id,a=G.getCombatants().find(e=>e.id===t);if(a&&(a.initiative=e.payload.result,a.pending=!1,a.active=!0),"combat"===G.data.shared.type){const e=G.data.shared.data;M.sortCombatants(e)}}break;case"player-shared-update":if(e.payload.shared&&(this.data.shared=e.payload.shared),e.payload.sharedDiff){const t=e.payload.sharedDiff;F.a.applyDiff(G.data.shared,t)}}}static finish(){G.peer&&(G.peer.destroy(),G.peer=null),G.data=this.getDefaultData()}}G.peer=null,G.data=G.getDefaultData(),G.previousSentSharedState=null,G.previousReceivedSharedState=null,G.onNewMessage=void 0,G.onPrompt=void 0;class B{static getState(){return this.state}static init(e){if("not started"!==this.state)return;this.state="starting",this.onStateChanged&&this.onStateChanged(),G.data.party=e;const t=b.guid(!0);G.peer=new z.a(t,{host:"dojoserver.herokuapp.com",port:443,secure:!0}),G.peer.on("open",()=>{setInterval(()=>this.sendPulse(),6e4),this.state="started",this.onStateChanged&&this.onStateChanged()}),G.peer.on("close",()=>{this.shutdown()}),G.peer.on("disconnected",()=>{G.peer?G.peer.reconnect():this.shutdown()}),G.peer.on("error",e=>{console.error(e),this.shutdown()}),G.peer.on("connection",e=>{this.connections.push(e),e.on("open",()=>{this.sendPeopleUpdate(),this.sendPartyUpdate(e),this.sendSharedUpdate(e),this.sendOptionsUpdate(e),this.onNewConnection&&this.onNewConnection(e.label),this.onDataChanged&&this.onDataChanged()}),e.on("close",()=>{const t=this.connections.indexOf(e);-1!==t&&this.connections.splice(t,1),this.sendPeopleUpdate()}),e.on("error",t=>{console.error(t),this.kick(e.peer)}),e.on("data",e=>{const t=G.stringToPacket(e);this.onDataReceived(t)})})}static shutdown(){this.connections.forEach(e=>e.close()),this.connections=[],G.finish(),this.state="not started",this.onStateChanged&&this.onStateChanged()}static kick(e){const t=this.connections.filter(e=>e.open).find(t=>t.peer===e);if(t){t.close();const e=this.connections.indexOf(t);-1!==e&&this.connections.splice(e,1),this.sendPeopleUpdate()}}static setOption(e,t){G.data.options[e]=t,this.onDataChanged&&this.onDataChanged();const a={type:"update",payload:{options:G.data.options}};this.broadcast(a)}static sendPulse(){this.sendPeopleUpdate(),this.sendPartyUpdate(),this.sendSharedUpdate(),this.sendOptionsUpdate()}static sendPeopleUpdate(){const e=this.connections.filter(e=>e.open).map(e=>({id:e.peer,name:e.label,status:G.getStatus(e.peer),characterID:G.getCharacterID(e.peer)}));b.sort(e),e.unshift({id:G.getID(),name:"DM",status:"",characterID:""});const t={type:"update",payload:{people:e}};G.processPacket(t),this.broadcast(t)}static sendPartyUpdate(e=null){const t={type:"update",payload:{party:G.data.party}};this.broadcast(t,e)}static sendSharedUpdate(e=null){const t={type:"update",payload:{shared:G.data.shared}};this.broadcast(t,e),null===e&&(G.previousSentSharedState=JSON.parse(JSON.stringify(G.data.shared)))}static sendSharedDiffUpdate(){b.debounce(()=>{const e={type:"update",payload:{shared:G.data.shared}};let t=!0;if(null!==G.previousSentSharedState){const a=F.a.getDiff(G.previousSentSharedState,G.data.shared);t=a.length>0,e.payload={sharedDiff:a}}t&&(this.broadcast(e),G.previousSentSharedState=JSON.parse(JSON.stringify(G.data.shared)))},500)()}static sendOptionsUpdate(e=null){const t={type:"update",payload:{options:G.data.options}};this.broadcast(t,e)}static sendMessage(e,t,a,s){this.onDataReceived(G.createTextPacket(e,t,a,s))}static sendLink(e,t){this.onDataReceived(G.createLinkPacket(e,t))}static sendImage(e,t){this.onDataReceived(G.createImagePacket(e,t))}static sendRoll(e,t){this.onDataReceived(G.createRollPacket(e,t))}static sendCard(e,t){this.onDataReceived(G.createCardPacket(e,t))}static shareNothing(){G.previousSentSharedState=null,G.previousReceivedSharedState=null,G.data.shared={type:"nothing",data:null,images:[],additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}static shareCombat(e){const t=[];e.map&&e.map.items.filter(e=>"custom"===e.terrain&&""!==e.customBackground).forEach(e=>{const a=S.getImage(e.customBackground);a&&t.push(a)}),G.previousSentSharedState=null,G.previousReceivedSharedState=null,G.data.shared={type:"combat",data:e,images:t,additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}static shareExploration(e){const t=[];e.map.items.filter(e=>"custom"===e.terrain&&""!==e.customBackground).forEach(e=>{const a=S.getImage(e.customBackground);a&&t.push(a)}),G.previousSentSharedState=null,G.previousReceivedSharedState=null,G.data.shared={type:"exploration",data:e,images:t,additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}static shareHandout(e){G.previousSentSharedState=null,G.previousReceivedSharedState=null,G.data.shared={type:"handout",data:e,images:[],additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}static shareMonster(e){G.previousSentSharedState=null,G.previousReceivedSharedState=null,G.data.shared={type:"monster",data:e,images:[],additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}static prompt(e,t){const a={type:"prompt",payload:{prompt:e,data:t}};this.broadcast(a)}static onDataReceived(e){G.processPacket(e),this.onDataChanged&&this.onDataChanged(),"player-shared-update"===e.type||"character-info"===e.type?this.sendSharedDiffUpdate():this.broadcast(e)}static broadcast(e,t=null){const a=G.packetToString(e);t?t.send(a):this.connections.filter(e=>e.open).forEach(e=>e.send(a))}}B.connections=[],B.state="not started",B.onStateChanged=void 0,B.onDataChanged=void 0,B.onNewConnection=void 0;class j{static getState(){return this.state}static connect(e,t){if("not connected"!==this.state)return;this.state="connecting",this.onStateChanged&&this.onStateChanged();const a="player-"+b.guid();G.peer=new z.a(a,{host:"dojoserver.herokuapp.com",port:443,secure:!0}),G.peer.on("open",()=>{if(G.peer){const a=G.peer.connect(e,{label:t,reliable:!0});this.connection=a,a.on("open",()=>{this.state="connected",this.onStateChanged&&this.onStateChanged()}),a.on("close",()=>{this.disconnect()}),a.on("error",e=>{console.error(e),this.disconnect()}),a.on("data",e=>{try{const t=G.stringToPacket(e);G.processPacket(t),this.onDataChanged&&this.onDataChanged()}catch(t){console.error(t)}})}}),G.peer.on("close",()=>{this.disconnect()}),G.peer.on("disconnected",()=>{G.peer?G.peer.reconnect():this.disconnect()}),G.peer.on("error",e=>{console.error(e),this.disconnect()})}static disconnect(){this.connection&&(this.connection.close(),this.connection=null),G.finish(),this.state="not connected",this.onStateChanged&&this.onStateChanged()}static sendUpdate(e,t){this.sendPacket({type:"player-info",payload:{player:G.getID(),status:e,characterID:t}})}static sendMessage(e,t,a,s){this.sendPacket(G.createTextPacket(e,t,a,s))}static sendLink(e,t){this.sendPacket(G.createLinkPacket(e,t))}static sendImage(e,t){this.sendPacket(G.createImagePacket(e,t))}static sendRoll(e,t){this.sendPacket(G.createRollPacket(e,t))}static sendCard(e,t){this.sendPacket(G.createCardPacket(e,t))}static sendCharacter(e){this.sendPacket({type:"character-info",payload:{pc:e}})}static sendRollResult(e,t){this.sendPacket({type:"roll-result",payload:{id:G.getCharacterID(G.getID()),roll:e,result:t}})}static sendSharedUpdate(){b.debounce(()=>{const e={type:"update",payload:{shared:G.data.shared}};let t=!0;if(null!==G.previousReceivedSharedState){const a=F.a.getDiff(G.previousReceivedSharedState,G.data.shared);t=a.length>0,e.payload={sharedDiff:a}}t&&(this.sendPacket(e),G.previousReceivedSharedState=JSON.parse(JSON.stringify(G.data.shared)))},500)()}static sendPacket(e){this.connection&&this.connection.send(G.packetToString(e))}}j.connection=null,j.state="not connected",j.onStateChanged=void 0,j.onDataChanged=void 0;var U=a(185),H=a(159),Y=a(171),W=a(167),J=a(82);class _ extends n.a.Component{keyDown(e){"Enter"===e.key&&this.props.onPressEnter&&this.props.onPressEnter()}render(){try{let e="";return this.props.disabled&&(e="disabled"),this.props.noMargins&&(e+=" no-margins"),this.props.multiLine?n.a.createElement(J.DebounceInput,{element:"textarea",minLength:this.props.minLength,debounceTimeout:this.props.debounce?500:100,className:e,value:this.props.text,placeholder:this.props.placeholder,rows:5,onChange:e=>this.props.onChange(e.target.value)}):n.a.createElement(J.DebounceInput,{minLength:this.props.minLength,debounceTimeout:this.props.debounce?500:100,className:e,value:this.props.text,placeholder:this.props.placeholder,onChange:e=>this.props.onChange(e.target.value),onKeyDown:e=>this.keyDown(e)})}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}_.defaultProps={placeholder:"",multiLine:!1,minLength:0,disabled:!1,debounce:!0,noMargins:!1,onPressEnter:null};class K extends n.a.Component{constructor(e){super(e),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){console.error("Error recorded by ErrorBoundary:"),console.error(e.name),console.error(e.message),console.error(e.stack),console.error(t.componentStack)}render(){return this.state.error?n.a.createElement(X,{error:this.state.error}):this.props.children}}class X extends n.a.Component{showError(){d.a.open({message:n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"error"),n.a.createElement(_,{text:this.props.error,multiLine:!0,onChange:e=>null})),closeIcon:n.a.createElement(c.a,null),duration:5})}render(){return n.a.createElement("div",{className:"render-error"},n.a.createElement("div",{className:"message"},"error"),n.a.createElement("div",{className:"message"},"please refresh"),n.a.createElement("button",{className:"link",onClick:()=>this.showError()},"details"))}}var Z=a(170),Q=a(158);class $ extends n.a.Component{readFile(e){const t=new FileReader;return t.onload=e=>{if(e.target){const t=e.target.result;this.props.setPortrait(t)}},t.readAsDataURL(e),!1}getEditor(){let e=null,t=null;return""!==this.props.source.portrait?(e=n.a.createElement("img",{className:"circle",src:this.props.source.portrait,alt:"portrait"}),t=n.a.createElement(c.a,{className:"clear",onClick:()=>this.props.clear()})):e=n.a.createElement("div",null,n.a.createElement(Q.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"),n.a.createElement("p",{className:"ant-upload-text"},"try to upload small images if possible"))),n.a.createElement("div",{className:"portrait editing"},n.a.createElement("div",{className:"section centered"},e,t))}getDisplay(){if(""===this.props.source.portrait)return null;let e="portrait";return this.props.inline?e+=" inline":e+=" section centered",n.a.createElement("div",{className:e},n.a.createElement("img",{className:"circle",src:this.props.source.portrait,alt:"portrait"}))}render(){try{return null!==this.props.setPortrait?this.getEditor():this.getDisplay()}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}$.defaultProps={inline:!1,setPortrait:null,clear:null};class ee extends n.a.Component{getTags(){const e=[];let t=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(t+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(n.a.createElement(W.a,{key:"tag-main"},t)),this.props.monster.alignment&&e.push(n.a.createElement(W.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(n.a.createElement(W.a,{key:"tag-cr"},"cr ",f.challenge(this.props.monster.challenge))),e}render(){try{const e=this.props.monster.name||"unnamed monster";return n.a.createElement("div",{className:"card monster"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title",title:e},e),n.a.createElement(Y.a,{onClick:()=>this.props.selectMonster(this.props.monster)})),n.a.createElement("div",{className:"card-content"},n.a.createElement($,{source:this.props.monster}),n.a.createElement("div",{className:"section centered"},this.getTags())))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class te extends n.a.Component{click(e){e.stopPropagation(),this.props.onChecked(!this.props.checked)}render(){try{let e="checkbox";this.props.checked&&(e+=" checked"),this.props.disabled&&(e+=" disabled");const t=n.a.createElement("div",{className:"toggle-container"},n.a.createElement("div",{className:"toggle"}));return n.a.createElement("div",{className:e,onClick:e=>this.click(e),role:"button"},n.a.createElement("div",{className:"checkbox-label"},this.props.label),t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}te.defaultProps={disabled:!1};var ae=a(172);class se extends n.a.Component{constructor(e){super(e),this.state={open:!1,filterText:""}}toggleOpen(e){e.stopPropagation(),this.setState({open:!this.state.open})}setFilterText(e){this.setState({filterText:e})}select(e){this.setState({open:!1}),this.props.onSelect(e)}clear(e){e.stopPropagation(),this.props.onClear()}render(){try{if(0===this.props.options.length)return null;let e=this.props.disabled?"dropdown disabled":"dropdown";const t=[];let a;this.props.selectedID&&(a=this.props.options.find(e=>e.id===this.props.selectedID));const s=a&&this.props.onClear;if(t.push(n.a.createElement("div",{key:"selection",className:"dropdown-top",title:a?a.text:this.props.placeholder},n.a.createElement("div",{className:"item-text"},a?a.text:this.props.placeholder),s?n.a.createElement(c.a,{onClick:e=>this.clear(e)}):n.a.createElement(ae.a,{className:"ellipsis"}))),this.state.open){e+=" open";let a=null;this.props.options.length>15&&(a=n.a.createElement("div",{className:"dropdown-filter",onClick:e=>e.stopPropagation(),role:"button"},n.a.createElement(_,{text:this.state.filterText,placeholder:"search this list...",onChange:e=>this.setFilterText(e)})));const s=this.props.options.map(e=>{if(null===e.text)return n.a.createElement("hr",{key:e.id});return I.match(this.state.filterText,e.text)?n.a.createElement(ne,{key:e.id,option:e,selected:e.id===this.props.selectedID,select:e=>this.select(e)}):null}).filter(e=>!!e);t.push(n.a.createElement("div",{key:"options",className:"dropdown-options"},a,s))}return n.a.createElement("div",{className:e,onClick:e=>this.toggleOpen(e),role:"button"},t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}se.defaultProps={selectedID:null,placeholder:"select...",disabled:!1,onClear:null};class ne extends n.a.Component{click(e){e.stopPropagation(),this.props.option.disabled||this.props.select(this.props.option.id)}render(){try{let e="dropdown-option";return this.props.selected&&(e+=" selected"),this.props.option.disabled&&(e+=" disabled"),n.a.createElement("div",{className:e,onClick:e=>this.click(e),role:"button"},this.props.option.text)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var re=a(173),ie=a(161);class oe extends n.a.Component{render(){try{let e="expander";return this.props.disabled&&(e+=" disabled"),n.a.createElement(ie.a,{className:e,bordered:!1,defaultActiveKey:[],expandIcon:e=>n.a.createElement(re.a,{rotate:e.isActive?-180:0}),expandIconPosition:"right"},n.a.createElement(ie.a.Panel,{key:"one",header:n.a.createElement("div",{className:"collapse-header-text"},this.props.text)},this.props.children))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}oe.defaultProps={disabled:!1};var le=a(174),ce=a(175);class de extends n.a.Component{click(e,t){e.stopPropagation(),this.props.onNudgeValue(t)}touchEnd(e,t){e.preventDefault(),e.stopPropagation(),this.props.onNudgeValue(t)}render(){try{let e="info-value";0===this.props.value&&(e+=" disabled");const t=[],a=[],s=this.props.factors||[1];s.forEach(e=>{t.push(n.a.createElement("div",{key:"minus"+e,className:1===e?"spin-button":"spin-button multiple",onTouchEnd:t=>this.touchEnd(t,-1*e),onClick:t=>this.click(t,-1*e),role:"button"},1===e?n.a.createElement(le.a,null):n.a.createElement("div",null,e))),a.push(n.a.createElement("div",{key:"plus"+e,className:1===e?"spin-button":"spin-button multiple",onTouchEnd:t=>this.touchEnd(t,1*e),onClick:t=>this.click(t,1*e),role:"button"},1===e?n.a.createElement(ce.a,null):n.a.createElement("div",null,e)))}),t.reverse();let r="minus",i="plus";return this.props.downEnabled||(r+=" disabled"),this.props.upEnabled||(i+=" disabled"),n.a.createElement("div",{className:this.props.disabled?"number-spin disabled":"number-spin"},n.a.createElement("div",{className:r},t),n.a.createElement("div",{className:"info",style:{width:"calc(100% - "+60*s.length+"px)"}},n.a.createElement("div",{className:"info-label"},this.props.label),n.a.createElement("div",{className:e},this.props.value)),n.a.createElement("div",{className:i},a))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}de.defaultProps={label:null,upEnabled:!0,downEnabled:!0,disabled:!1,factors:null};class pe extends n.a.Component{render(){try{var e;if(0===this.props.options.length)return null;const t=null!==(e=this.props.itemsPerRow)&&void 0!==e?e:this.props.options.length,a=this.props.options.map(e=>n.a.createElement(he,{key:e.id,option:e,width:100/t,selected:e.id===this.props.selectedID,onSelect:e=>this.props.onSelect(e)}));return n.a.createElement("div",{className:this.props.disabled?"selector disabled":"selector"},a)}catch(t){return console.error(t),n.a.createElement(X,{error:t})}}}pe.defaultProps={itemsPerRow:null,disabled:!1};class he extends n.a.Component{click(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}render(){try{let e="option";return this.props.selected&&(e+=" selected"),this.props.option.disabled&&(e+=" disabled"),n.a.createElement("div",{key:this.props.option.id,className:e,style:{flex:"0 0 "+this.props.width+"%"},title:this.props.option.text,onClick:e=>this.click(e),role:"button"},this.props.option.text)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class me extends n.a.Component{constructor(e){super(e);let t=e.party;t||1===e.parties.length&&(t=e.parties[0]),this.state={selectedPartyID:t?t.id:null,selectedWaveID:null,customPartySize:5,customPartyLevel:1}}selectParty(e){this.setState({selectedPartyID:e})}setWave(e){this.setState({selectedWaveID:e})}render(){try{const t=M.getMonsterCount(this.props.encounter,this.state.selectedWaveID),a=M.getEncounterXP(this.props.encounter,this.state.selectedWaveID,this.props.getMonster),s=M.getAdjustedEncounterXP(this.props.encounter,this.state.selectedWaveID,this.props.getMonster);let r=null;if(this.props.encounter.waves.length>0){const e=[{id:this.props.encounter.id,text:"encounter"}];this.props.encounter.waves.forEach(t=>{e.push({id:t.id,text:t.name||"unnamed wave"})}),r=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement(se,{placeholder:"encounter plus all waves",options:e,selectedID:this.state.selectedWaveID,onSelect:e=>this.setWave(e),onClear:()=>this.setWave(null)}))}const i=n.a.createElement("div",null,r,n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"xp for these monsters"),n.a.createElement(h.a,{span:8,className:"right-value"},a," xp"))),n.a.createElement("div",{className:"section",style:{display:s===a?"none":""}},n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"effective xp for ",t," monster(s)"),n.a.createElement(h.a,{span:8,className:"right-value"},s," xp"))));let o,l,c=this.props.party;if(null===c)if("custom"===this.state.selectedPartyID){c=E.createParty();for(let e=0;e!==this.state.customPartySize;++e){const e=E.createPC();e.level=this.state.customPartyLevel,c.pcs.push(e)}}else{var e;c=null!==(e=this.props.parties.find(e=>e.id===this.state.selectedPartyID))&&void 0!==e?e:null}if(c){let e=0,t=0,a=0,r=0;const d=c.pcs.filter(e=>e.active);d.forEach(s=>{e+=f.pcExperience(s.level,"easy"),t+=f.pcExperience(s.level,"medium"),a+=f.pcExperience(s.level,"hard"),r+=f.pcExperience(s.level,"deadly")});let m="trivial",u="trivial";if(s>0&&(s>=e&&(m="easy",u="easy"),s>=t&&(m="medium",u="medium"),s>=a&&(m="hard",u="hard"),s>=r&&(m="deadly",u="deadly"),r>0&&s>=10*r&&(m="tpk",u="tpk"),r>0&&s>=20*r&&(m="dm with a grudge",u="dm with a grudge"),r>0&&s>=30*r&&(m="now you're just being silly",u="now you're just being silly"),d.length<3||d.length>5)){const e=d.length<3;switch(m){case"trivial":u=e?"easy":"trivial";break;case"easy":u=e?"medium":"trivial";break;case"medium":u=e?"hard":"easy";break;case"hard":u=e?"deadly":"medium";break;case"deadly":u=e?"deadly":"hard";break;default:u=""}}o=n.a.createElement("div",{className:"table"},n.a.createElement("div",{className:"table-row"},n.a.createElement("div",{className:"table-cell easy"},n.a.createElement("b",null,"easy")),n.a.createElement("div",{className:"table-cell medium"},n.a.createElement("b",null,"medium")),n.a.createElement("div",{className:"table-cell hard"},n.a.createElement("b",null,"hard")),n.a.createElement("div",{className:"table-cell deadly"},n.a.createElement("b",null,"deadly"))),n.a.createElement("div",{className:"table-row"},n.a.createElement("div",{className:"table-cell"},e," xp"),n.a.createElement("div",{className:"table-cell"},t," xp"),n.a.createElement("div",{className:"table-cell"},a," xp"),n.a.createElement("div",{className:"table-cell"},r," xp")));const g=e=>100*e/Math.max(s,1.2*r),y=e=>100-g(e);l=n.a.createElement("div",null,n.a.createElement("div",{className:"difficulty-gauge"},n.a.createElement("div",{className:"bar-container"},n.a.createElement("div",{className:"bar trivial",style:{left:"0",right:y(e)+"%"}})),n.a.createElement("div",{className:"bar-container"},n.a.createElement("div",{className:"bar easy",style:{left:g(e)+"%",right:y(t)+"%"}})),n.a.createElement("div",{className:"bar-container"},n.a.createElement("div",{className:"bar medium",style:{left:g(t)+"%",right:y(a)+"%"}})),n.a.createElement("div",{className:"bar-container"},n.a.createElement("div",{className:"bar hard",style:{left:g(a)+"%",right:y(r)+"%"}})),n.a.createElement("div",{className:"bar-container"},n.a.createElement("div",{className:"bar deadly",style:{left:g(r)+"%",right:"0"}})),n.a.createElement("div",{className:"encounter-container"},n.a.createElement("div",{className:"encounter",style:{left:g(s)-.5+"%"}}))),i,n.a.createElement("div",{className:"section"},n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"difficulty for this party"),n.a.createElement(h.a,{span:8,className:"right-value"},m))),n.a.createElement("div",{className:"section",style:{display:u===m?"none":""}},n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"effective difficulty for ",d.length," pc(s)"),n.a.createElement(h.a,{span:8,className:"right-value"},u))))}else l=i;if(!this.props.party){const e=[];if(this.props.parties)for(let a=0;a!==this.props.parties.length;++a){const t=this.props.parties[a];e.push({id:t.id,text:t.name})}e.push({id:"custom",text:"custom party"});let t=null;return"custom"===this.state.selectedPartyID&&(t=n.a.createElement("div",null,n.a.createElement(de,{value:this.state.customPartySize,label:"party size",downEnabled:this.state.customPartySize>1,onNudgeValue:e=>this.setState({customPartySize:this.state.customPartySize+e})}),n.a.createElement(de,{value:this.state.customPartyLevel,label:"party level",downEnabled:this.state.customPartyLevel>1,upEnabled:this.state.customPartyLevel<20,onNudgeValue:e=>this.setState({customPartyLevel:this.state.customPartyLevel+e})}))),n.a.createElement("div",null,n.a.createElement(se,{options:e,placeholder:"select party...",selectedID:this.state.selectedPartyID,onSelect:e=>this.selectParty(e)}),t,o,l)}return n.a.createElement("div",null,o,l)}catch(t){return console.error(t),n.a.createElement(X,{error:t})}}}me.defaultProps={parties:[],party:null};class ue extends n.a.Component{render(){try{const e=["all sizes"].concat(w).map(e=>({id:e,text:e})),t=["all types"].concat(k).map(e=>({id:e,text:e})),a=t.find(e=>"aberration"===e.id);a&&(a.text="aberr.");const s=t.find(e=>"celestial"===e.id);s&&(s.text="celest.");const r=t.find(e=>"construct"===e.id);r&&(r.text="const.");const i=t.find(e=>"elemental"===e.id);i&&(i.text="elem.");const o=t.find(e=>"humanoid"===e.id);o&&(o.text="human.");const l=t.find(e=>"monstrosity"===e.id);l&&(l.text="monst.");let c=null;this.props.showName&&(c=n.a.createElement(_,{key:"search",text:this.props.filter.name,placeholder:"filter by name",noMargins:!0,onChange:e=>this.props.changeValue("name",e)}));let d=null;if(this.props.showRoles){const e=["all roles"].concat(x).map(e=>({id:e,text:e}));d=n.a.createElement(pe,{options:e,selectedID:this.props.filter.role,itemsPerRow:2,onSelect:e=>this.props.changeValue("role",e)})}return n.a.createElement("div",null,c,n.a.createElement(oe,{text:this.props.prefix+" "+M.getFilterDescription(this.props.filter)},n.a.createElement(H.a,{range:!0,min:0,max:30,value:[this.props.filter.challengeMin,this.props.filter.challengeMax],onChange:e=>this.props.changeValue("challenge",e)}),n.a.createElement(se,{options:e,placeholder:"filter by size...",selectedID:this.props.filter.size,onSelect:e=>this.props.changeValue("size",e)}),n.a.createElement(pe,{options:t,selectedID:this.props.filter.category,itemsPerRow:3,onSelect:e=>this.props.changeValue("category",e)}),d,n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement("button",{onClick:()=>this.props.resetFilter()},"clear filter"))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}ue.defaultProps={prefix:"showing",showName:!0,showRoles:!0};var ge=a(113),ye=a(182),be=a(183),Ee=a(184),fe=a(106),ve=a(169),we=a(31),ke=a.n(we),xe=a(176);class Ce extends n.a.Component{render(){try{return n.a.createElement(ve.a,{content:n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement(xe.a,{style:{color:"red"}}),n.a.createElement("span",{style:{marginLeft:"10px"}},this.props.prompt)),this.props.info,n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.onConfirm()},"confirm")),trigger:"click",overlayClassName:"confirm-tooltip"},n.a.createElement("button",{className:this.props.disabled?"danger disabled":"danger"},this.props.text))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Ce.defaultProps={prompt:"are you sure you want to do this?",info:null,disabled:!1};var Ne=a(177),Se=a(178),Ie=a(179),Me=a(180);class De extends n.a.Component{constructor(e){super(e),this.state={step:1}}click(e,t){e.stopPropagation(),this.props.onMove(t,this.state.step)}undo(e){e.stopPropagation(),this.props.undo&&this.props.undo.enabled&&this.props.undo.onUndo()}toggleStep(e){e.stopPropagation(),this.setState({step:1===this.state.step?.5:1})}render(){try{let e="radial";this.props.disabled&&(e+=" disabled");let t=null;if(this.props.showToggle){const e=1!==this.state.step?"\xbd":"";t=n.a.createElement("div",{className:"radial-toggle",role:"button",onClick:e=>this.toggleStep(e)},e)}let a=null;if(this.props.undo){let e="undo";this.props.undo.enabled||(e+=" disabled"),a=n.a.createElement("div",{className:e},n.a.createElement(Ne.a,{title:"undo",onClick:e=>this.undo(e)}),this.props.undo.text)}let s=null;if(this.props.altitude){let e="altitude";this.props.altitude.enabled||(e+=" disabled"),s=n.a.createElement("div",{className:e},n.a.createElement(Se.a,{title:"move up",onClick:e=>this.click(e,"UP")}),this.props.altitude.text,n.a.createElement(Ie.a,{title:"move down",onClick:e=>this.click(e,"DOWN")}))}return n.a.createElement("div",{className:e},n.a.createElement(p.a,{align:"middle"},n.a.createElement(h.a,{span:8},a),n.a.createElement(h.a,{span:8},n.a.createElement("div",{className:"dial"},n.a.createElement("div",{className:"cells"},n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow radial-arrow-diag",onClick:e=>this.click(e,"NW"),role:"button"},n.a.createElement(Me.a,{rotate:-45}))),n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow",onClick:e=>this.click(e,"N"),role:"button"},n.a.createElement(Me.a,null))),n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow radial-arrow-diag",onClick:e=>this.click(e,"NE"),role:"button"},n.a.createElement(Me.a,{rotate:45}))),n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow",onClick:e=>this.click(e,"W"),role:"button"},n.a.createElement(Me.a,{rotate:-90}))),n.a.createElement("div",{className:"radial-cell"},t),n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow",onClick:e=>this.click(e,"E"),role:"button"},n.a.createElement(Me.a,{rotate:90}))),n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow radial-arrow-diag",onClick:e=>this.click(e,"SW"),role:"button"},n.a.createElement(Me.a,{rotate:-135}))),n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow",onClick:e=>this.click(e,"S"),role:"button"},n.a.createElement(Me.a,{rotate:180}))),n.a.createElement("div",{className:"radial-cell"},n.a.createElement("div",{className:"radial-arrow radial-arrow-diag",onClick:e=>this.click(e,"SE"),role:"button"},n.a.createElement(Me.a,{rotate:135})))))),n.a.createElement(h.a,{span:8},s)))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}De.defaultProps={showToggle:!1,undo:null,altitude:null,disabled:!1};class Te extends n.a.Component{render(){try{const e=this.props.options.map(e=>n.a.createElement(Ae,{key:e.id,option:e,selected:e.id===this.props.selectedID,onSelect:e=>this.props.onSelect(e)}));return n.a.createElement("div",{className:this.props.disabled?"tabs disabled":"tabs"},e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Te.defaultProps={disabled:!1};class Ae extends n.a.Component{click(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}render(){try{let e="tab";this.props.selected&&(e+=" selected"),this.props.option.disabled&&(e+=" disabled");let t=null;return t=this.props.option.display?this.props.option.display:n.a.createElement("div",null,this.props.option.text),n.a.createElement("div",{key:this.props.option.id,className:e,title:this.props.option.text,onClick:e=>this.click(e),role:"button"},t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var Pe=a(181);class Ve extends n.a.Component{render(){try{const e=[];return this.props.combatants.forEach(t=>{t.conditions.forEach(a=>{e.push(n.a.createElement(Oe,{key:a.id,condition:a,combatant:t,combatants:this.props.allCombatants,showCombatantName:this.props.combatants.length>1,nudgeConditionValue:(e,t,a)=>this.props.nudgeConditionValue(e,t,a),editCondition:e=>this.props.editCondition(t,e),deleteCondition:e=>this.props.deleteCondition(t,e)}))})}),n.a.createElement("div",{className:"section"},e,n.a.createElement("button",{onClick:()=>this.props.addCondition()},"add a condition"))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Oe extends n.a.Component{render(){try{let e=this.props.condition.name||"condition";"custom"===e&&(e=this.props.condition.text||"custom condition"),"exhaustion"===this.props.condition.name&&(e+=" ("+this.props.condition.level+")"),this.props.showCombatantName&&(e=this.props.combatant.displayName+": "+e);let t=null;null!==this.props.condition.duration&&(t=n.a.createElement("div",{className:"section"},n.a.createElement("i",null,f.conditionDurationText(this.props.condition,this.props.combatants))));const a=[];if("exhaustion"===this.props.condition.name&&a.push(n.a.createElement("div",{key:"level",className:"section"},n.a.createElement(de,{value:this.props.condition.level,label:"level",downEnabled:this.props.condition.level>1,upEnabled:this.props.condition.level<6,onNudgeValue:e=>this.props.nudgeConditionValue(this.props.condition,"level",e)}))),"custom"!==this.props.condition.name){const e=f.conditionText(this.props.condition);for(let t=0;t!==e.length;++t)a.push(n.a.createElement("div",{key:t,className:"section"},e[t]))}return n.a.createElement("div",{className:"group-panel condition-panel"},n.a.createElement("div",{className:"condition-heading"},n.a.createElement("div",{className:"condition-name"},e),n.a.createElement("div",{className:"condition-buttons"},n.a.createElement(Pe.a,{title:"edit",onClick:()=>this.props.editCondition(this.props.condition)}),n.a.createElement(ge.a,{title:"remove",onClick:()=>this.props.deleteCondition(this.props.condition)}))),t,a)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Le extends n.a.Component{render(){try{let e="note";return this.props.white&&(e+=" white"),n.a.createElement("div",{className:e},this.props.children)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Le.defaultProps={white:!1};class Re extends n.a.Component{constructor(e){super(e),this.state={view:e.defaultTab,healingValue:0,damageValue:0,damageMultipliers:{}}}nudgeHealing(e){this.setState({healingValue:Math.max(this.state.healingValue+e,0)})}nudgeDamage(e){this.setState({damageValue:Math.max(this.state.damageValue+e,0)})}setView(e){this.setState({view:e})}setDamageMultiplier(e,t){const a=this.state.damageMultipliers;a[e]=t,this.setState({damageMultipliers:a})}heal(){if(null===this.props.changeHP)return;const e=this.state.healingValue;this.setState({healingValue:0},()=>{const t=[];this.props.combatants.forEach(a=>{var s,n,r;const i=null!==(s=a.hpMax)&&void 0!==s?s:0;let o=(null!==(n=a.hpCurrent)&&void 0!==n?n:0)+e;o=Math.min(o,i),t.push({id:a.id,hp:o,temp:null!==(r=a.hpTemp)&&void 0!==r?r:0,damage:0})}),this.props.changeHP(t)})}damage(){if(null===this.props.changeHP)return;const e=this.state.damageValue;this.setState({damageValue:0},()=>{const t=[];this.props.combatants.forEach(a=>{var s,n,r;const i=null!==(s=this.state.damageMultipliers[a.id])&&void 0!==s?s:1;let o=null!==(n=a.hpCurrent)&&void 0!==n?n:0,l=null!==(r=a.hpTemp)&&void 0!==r?r:0;const c=Math.floor(e*i);let d=c;const p=Math.min(d,l);d-=p,l-=p,o-=d,o=Math.max(o,0),t.push({id:a.id,hp:o,temp:l,damage:c})}),this.props.changeHP(t)})}getMainSection(){const e=[],t=[],a=[];if(this.props.combatants.every(e=>e.active)){if(this.props.makeCurrent&&this.props.makeDefeated)if(this.props.combatants.every(e=>e.current))e.push(n.a.createElement("button",{key:"makeDefeated",onClick:()=>this.props.makeDefeated(this.props.combatants)},"mark as defeated and end turn"));else{if(1===this.props.combatants.length){!!this.props.allCombatants.find(e=>e.mountID===this.props.combatants[0].id)||e.push(n.a.createElement("button",{key:"makeCurrent",onClick:()=>this.props.makeCurrent(this.props.combatants[0])},"start turn"))}e.push(n.a.createElement("button",{key:"makeDefeated",onClick:()=>this.props.makeDefeated(this.props.combatants)},"mark as defeated"))}if(this.props.combatants.every(e=>"pc"!==e.type)){this.props.allCombatants.filter(e=>"pc"===e.type).forEach(e=>{const a="engaged:"+e.displayName;t.push(n.a.createElement(W.a.CheckableTag,{key:e.id,checked:this.props.combatants.every(e=>e.tags.includes(a)),onChange:()=>this.props.toggleTag(this.props.combatants,a)},e.displayName))})}}if(1===this.props.combatants.length&&"bright light"!==this.props.lighting){const e=this.props.combatants[0];0===e.darkvision&&a.push(n.a.createElement(Le,{key:"light"},n.a.createElement("p",null,e.displayName," is in ",this.props.lighting,", and has no darkvision")))}this.props.makeActive&&this.props.combatants.every(e=>e.defeated)&&e.push(n.a.createElement("button",{key:"makeActive",onClick:()=>this.props.makeActive(this.props.combatants)},"mark as active"));let s=null;e.length>0&&(s=n.a.createElement("div",null,e,n.a.createElement("hr",null)));let r=null;return t.length>0&&(r=n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"engaged with: "),t)),n.a.createElement("div",null,a,s,n.a.createElement(ze,{combatants:this.props.combatants,editable:!0,toggleTag:(e,t)=>this.props.toggleTag(e,t),toggleCondition:(e,t)=>this.props.toggleCondition(e,t),toggleHidden:e=>this.props.toggleHidden(e)}),r)}getHPSection(){if(!this.props.combatants.every(e=>"monster"===e.type))return null;let e=null;if(1===this.props.combatants.length){var t,a,s,r,i,o;const l=this.props.combatants[0];e=n.a.createElement(oe,{text:"current hit points"},n.a.createElement(de,{value:null!==(t=l.hpCurrent)&&void 0!==t?t:0,label:"hp",factors:[1,10],downEnabled:(null!==(a=l.hpCurrent)&&void 0!==a?a:0)>0,upEnabled:(null!==(s=l.hpCurrent)&&void 0!==s?s:0)<(null!==(r=l.hpMax)&&void 0!==r?r:0),onNudgeValue:e=>this.props.nudgeValue(l,"hpCurrent",e)}),n.a.createElement(de,{value:null!==(i=l.hpTemp)&&void 0!==i?i:0,label:"temp hp",factors:[1,10],downEnabled:(null!==(o=l.hpTemp)&&void 0!==o?o:0)>0,onNudgeValue:e=>this.props.nudgeValue(l,"hpTemp",e)}))}const l=this.props.combatants.map(e=>{const t=e;let a=null,s=null,r=null,i=null;return t.damage.resist&&(a=n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"resistances")," ",t.damage.resist," ",this.props.combatants.length>1?n.a.createElement("i",null," - ",e.displayName):null)),t.damage.vulnerable&&(s=n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"vulnerabilities")," ",t.damage.vulnerable," ",this.props.combatants.length>1?n.a.createElement("i",null," - ",e.displayName):null)),t.damage.immune&&(r=n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"immunities")," ",t.damage.immune," ",this.props.combatants.length>1?n.a.createElement("i",null," - ",e.displayName):null)),t.tags.includes("conc")&&(i=n.a.createElement("div",{className:"section"},t.displayName," is ",n.a.createElement("b",null,"concentrating"),", and will need to make a check if they take damage")),a||s||r||i?n.a.createElement(Le,{key:e.id},a,s,r,i):null});let c="apply damage";if(1===this.props.combatants.length){const e=this.state.damageMultipliers[this.props.combatants[0].id];.5===e&&(c="apply half damage"),2===e&&(c="apply double damage")}const d=[{id:"half",text:"half"},{id:"normal",text:"normal"},{id:"double",text:"double"}],m=this.props.combatants.map(e=>{var t;let a="normal";const s=null!==(t=this.state.damageMultipliers[e.id])&&void 0!==t?t:1;s<1&&(a="half"),s>1&&(a="double");const r=n.a.createElement(pe,{options:d,selectedID:a,onSelect:t=>{let a=1;"half"===t&&(a=.5),"double"===t&&(a=2),this.setDamageMultiplier(e.id,a)}});return 1===this.props.combatants.length?n.a.createElement("div",{key:e.id},r):n.a.createElement(p.a,{key:e.id,align:"middle",justify:"center"},n.a.createElement(h.a,{span:8},n.a.createElement("div",null,e.displayName)),n.a.createElement(h.a,{span:16},r))});let u=null;const g=this.props.combatants.filter(e=>null!=e.hpCurrent&&e.hpCurrent<=0);if(g.length>0){const e=1===g.length&&g[0].current?"mark as defeated and end turn":"mark as defeated";let t=null;this.props.combatants.length>1&&(t=n.a.createElement("ul",null,g.map(e=>n.a.createElement("li",{key:e.id},e.displayName)))),u=n.a.createElement("button",{onClick:()=>this.props.makeDefeated(g)},e,t)}return n.a.createElement("div",null,l,n.a.createElement(de,{value:this.state.damageValue,label:"damage",factors:[1,10],downEnabled:this.state.damageValue>0,onNudgeValue:e=>this.nudgeDamage(e)}),n.a.createElement("button",{className:0===this.state.damageValue?"disabled":"",onClick:()=>this.damage()},c),m,u,n.a.createElement("hr",null),n.a.createElement(oe,{text:"healing"},n.a.createElement(de,{value:this.state.healingValue,label:"healing",factors:[1,10],downEnabled:this.state.healingValue>0,onNudgeValue:e=>this.nudgeHealing(e)}),n.a.createElement("button",{className:0===this.state.healingValue?"disabled":"",onClick:()=>this.heal()},"apply healing")),e)}getConditionSection(){const e=this.props.combatants.map(e=>{if("monster"!==e.type)return null;const t=e;return t.conditionImmunities?n.a.createElement(Le,{key:e.id},n.a.createElement("b",null,"immunities")," ",t.conditionImmunities," ",this.props.combatants.length>1?n.a.createElement("i",null," - ",e.displayName):null):null}),t=n.a.createElement(Ve,{combatants:this.props.combatants,allCombatants:this.props.allCombatants,addCondition:()=>this.props.addCondition(this.props.combatants),editCondition:(e,t)=>this.props.editCondition(e,t),deleteCondition:(e,t)=>this.props.deleteCondition(e,t),nudgeConditionValue:(e,t,a)=>this.props.nudgeValue(e,t,a)});return n.a.createElement("div",null,e,t)}getMapSection(){if(!this.props.map)return null;if(this.props.combatants.every(e=>this.props.map&&this.props.map.items.find(t=>t.id===e.id))){let e=null,t=null,a=null,s=null;if(1===this.props.combatants.length){const r=this.props.combatants[0],i=this.props.map.items.find(e=>e.id===r.id);if(i){if(r.path){const t=V.getDistance(i,r.path,this.props.options.diagonals);e={enabled:r.path.length>0,text:n.a.createElement("div",{className:"section centered"},n.a.createElement("b",null,5*t)," ft"),onUndo:()=>this.props.undoStep(r)}}t={enabled:!0,text:n.a.createElement("div",{className:"section centered"},n.a.createElement("b",null,5*i.z)," ft")}}let o=null;if(r.aura.radius>0){const e=[{id:"square",text:"square"},{id:"rounded",text:"rounded"},{id:"circle",text:"circle"}];o=n.a.createElement("div",null,n.a.createElement(pe,{options:e,selectedID:r.aura.style,onSelect:e=>this.props.changeValue(r.aura,"style",e)}),n.a.createElement("input",{type:"color",value:r.aura.color,onChange:e=>this.props.changeValue(r.aura,"color",e.target.value)}),n.a.createElement("button",{onClick:()=>this.props.changeValue(r.aura,"radius",0)},"remove aura"))}a=n.a.createElement(oe,{text:"aura"},n.a.createElement(de,{value:r.aura.radius+" ft.",label:"radius",downEnabled:r.aura.radius>0,onNudgeValue:e=>this.props.nudgeValue(r.aura,"radius",5*e)}),o),s=n.a.createElement("button",{onClick:()=>this.props.mapAdd(r)},"place on a different square")}return n.a.createElement("div",null,n.a.createElement(De,{showToggle:!0,undo:e,altitude:t,onMove:(e,t)=>this.props.mapMove(this.props.combatants,e,t)}),n.a.createElement("hr",null),a,s,n.a.createElement("button",{onClick:()=>this.props.mapRemove(this.props.combatants)},"remove from map"))}return 1===this.props.combatants.length?n.a.createElement("button",{key:"mapAdd",onClick:()=>this.props.mapAdd(this.props.combatants[0])},"add to map"):null}getAdvancedSection(){let e=null;this.props.removeCombatants&&this.props.combatants.every(e=>!e.current)&&(e=n.a.createElement(Ce,{text:"remove from encounter",onConfirm:()=>{this.props.removeCombatants&&this.props.removeCombatants(this.props.combatants)}}));let t=null,a=null,s=null,r=null,i=null,o=null,l=null,c=null;if(1===this.props.combatants.length){const e=this.props.combatants[0];var d;if(t=n.a.createElement(oe,{text:"name"},n.a.createElement(_,{text:e.displayName,onChange:t=>this.props.changeValue(e,"displayName",t)})),a=n.a.createElement(oe,{text:"size"},n.a.createElement(de,{value:e.displaySize,label:"size",downEnabled:"tiny"!==e.displaySize,upEnabled:"gargantuan"!==e.displaySize,onNudgeValue:t=>this.props.nudgeValue(e,"displaySize",t)})),!e.pending)s=n.a.createElement(oe,{text:"initiative score"},n.a.createElement(de,{value:null!==(d=e.initiative)&&void 0!==d?d:0,label:"initiative",onNudgeValue:t=>this.props.nudgeValue(e,"initiative",t)}));r=n.a.createElement(oe,{text:"faction"},n.a.createElement(pe,{options:["foe","neutral","ally"].map(e=>({id:e,text:e})),selectedID:e.faction,onSelect:t=>this.props.changeValue(e,"faction",t)})),i=n.a.createElement(oe,{text:"vision"},n.a.createElement(de,{value:e.darkvision+" ft",label:"darkvision",downEnabled:e.darkvision>0,onNudgeValue:t=>this.props.nudgeValue(e,"darkvision",10*t)}));let p="none";e.lightSource&&(5===e.lightSource.bright&&10===e.lightSource.dim&&(p="candle"),20===e.lightSource.bright&&40===e.lightSource.dim&&(p="torch"),30===e.lightSource.bright&&60===e.lightSource.dim&&(p="lantern")),o=n.a.createElement(oe,{text:"light source"},n.a.createElement(pe,{options:["none","candle","torch","lantern"].map(e=>({id:e,text:e})),selectedID:p,onSelect:t=>{switch(t){case"none":this.props.changeValue(e,"lightSource",null);break;case"candle":this.props.changeValue(e,"lightSource",{bright:5,dim:10});break;case"torch":this.props.changeValue(e,"lightSource",{bright:20,dim:40});break;case"lantern":this.props.changeValue(e,"lightSource",{bright:30,dim:60})}}}));if(!this.props.allCombatants.find(t=>t.mountID===e.id)){const t=this.props.allCombatants.filter(t=>t.id!==e.id).filter(e=>!!e.mountID).map(e=>e.mountID),a=this.props.allCombatants.filter(t=>t.id!==e.id).filter(e=>"placeholder"!==e.type).filter(e=>!e.mountID).filter(e=>!t.includes(e.id)).map(e=>({id:e.id,text:e.displayName}));b.sort(a,[{field:"text",dir:"asc"}]);let s=null;s=a.length>0?n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"mounted on:"),n.a.createElement(se,{options:a,selectedID:e.mountID,onSelect:t=>this.props.changeValue(e,"mountID",t),onClear:()=>this.props.changeValue(e,"mountID",null)})):n.a.createElement(Le,null,"no mounts available");let r=null;if(e.mountID){const t=["controlled","independent"].map(e=>({id:e,text:e}));r=n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"mount is:"),n.a.createElement(pe,{options:t,selectedID:e.mountType,onSelect:t=>this.props.changeValue(e,"mountType",t)}))}l=n.a.createElement(oe,{text:"mounted combat"},s,r)}c=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement(_,{text:e.note,placeholder:"notes",multiLine:!0,onChange:t=>this.props.changeValue(e,"note",t)}))}const p=[];return this.props.combatants.filter(e=>"pc"===e.type).forEach(e=>{e.companions.filter(e=>!this.props.allCombatants.find(t=>t.id===e.id)).forEach(e=>{p.push(n.a.createElement("button",{key:e.id,onClick:()=>this.props.addCompanion(e)},"add ",e.name))})}),n.a.createElement("div",null,e,t,a,s,r,i,o,l,p,c)}render(){try{const e=["main","hp","cond","map","adv"],t=this.props.allCombatants.filter(e=>!!e.mountID&&"controlled"===e.mountType).map(e=>e.mountID||"");if(this.props.map&&!this.props.combatants.some(e=>t.includes(e.id))||e.splice(3,1),this.props.combatants.every(e=>"monster"===e.type)||e.splice(1,1),!this.props.showTabs)return n.a.createElement("div",null,e.includes("main")?this.getMainSection():null,e.includes("hp")?n.a.createElement("div",null,n.a.createElement("hr",null),this.getHPSection()):null,e.includes("cond")?n.a.createElement("div",null,n.a.createElement("hr",null),this.getConditionSection()):null,e.includes("map")?n.a.createElement("div",null,n.a.createElement("hr",null),this.getMapSection()):null,e.includes("adv")?n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement(oe,{text:"advanced controls"},this.getAdvancedSection())):null);let a=this.state.view;e.includes(a)||(a=e[0]);let s=null;switch(a){case"main":s=this.getMainSection();break;case"hp":s=this.getHPSection();break;case"cond":s=this.getConditionSection();break;case"map":s=this.getMapSection();break;case"adv":s=this.getAdvancedSection()}return n.a.createElement("div",{className:"combat-controls"},n.a.createElement(Te,{options:e.map(e=>({id:e,text:e})),selectedID:a,onSelect:e=>this.setView(e)}),s)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Re.defaultProps={showTabs:!0,defaultTab:"main",makeCurrent:null,makeActive:null,makeDefeated:null,changeHP:null,removeCombatants:null};class ze extends n.a.Component{createTag(e,t,a){return this.props.editable?n.a.createElement(W.a.CheckableTag,{checked:t,onChange:()=>a()},e):t?n.a.createElement(W.a,null,e):null}render(){try{return n.a.createElement("div",{className:"section"},this.createTag("bane",this.props.combatants.every(e=>e.tags.includes("bane")),()=>this.props.toggleTag(this.props.combatants,"bane")),this.createTag("bless",this.props.combatants.every(e=>e.tags.includes("bless")),()=>this.props.toggleTag(this.props.combatants,"bless")),this.createTag("concentrating",this.props.combatants.every(e=>e.tags.includes("conc")),()=>this.props.toggleTag(this.props.combatants,"conc")),this.createTag("hidden",!this.props.combatants.every(e=>e.showOnMap),()=>this.props.toggleHidden(this.props.combatants)),this.createTag("prone",this.props.combatants.every(e=>e.conditions.some(e=>"prone"===e.name)),()=>this.props.toggleCondition(this.props.combatants,"prone")),this.createTag("unconscious",this.props.combatants.every(e=>e.conditions.some(e=>"unconscious"===e.name)),()=>this.props.toggleCondition(this.props.combatants,"unconscious")))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}(new ke.a.Converter).setOption("tables",!0);class qe extends n.a.Component{constructor(e){super(e),this.state={size:"thumbnail"===e.mode?15:45,selectionStartSquare:null,selectionEndSquare:null}}gridSquareMouseDown(e,t){this.setState({selectionStartSquare:{x:e,y:t},selectionEndSquare:null})}gridSquareEntered(e,t){this.state.selectionStartSquare?this.setState({selectionEndSquare:{x:e,y:t}}):this.props.gridSquareEntered&&this.props.gridSquareEntered(e,t)}gridSquareMouseUp(e,t){if(this.state.selectionStartSquare){const a=this.state.selectionStartSquare.x,s=this.state.selectionStartSquare.y;this.setState({selectionStartSquare:null,selectionEndSquare:null},()=>{if(a===e&&s===t)this.props.gridSquareClicked&&this.props.gridSquareClicked(e,t);else if(this.props.gridRectangleSelected){const n=Math.min(a,e),r=Math.min(s,t),i=Math.max(a,e),o=Math.max(s,t);this.props.gridRectangleSelected(n,r,i,o)}})}}isSelected(e,t){if(this.state.selectionStartSquare&&this.state.selectionEndSquare){const a=Math.min(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),s=Math.min(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y),n=Math.max(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),r=Math.max(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y);return e>=a&&e<=n&&t>=s&&t<=r}return!1}getMapDimensions(){let e=this.props.viewport;if(!e){this.props.map.items.filter(e=>"edit"!==this.props.mode||"tile"===e.type).forEach(t=>{e?(e.minX=Math.min(e.minX,t.x),e.maxX=Math.max(e.maxX,t.x+t.width-1),e.minY=Math.min(e.minY,t.y),e.maxY=Math.max(e.maxY,t.y+t.height-1)):e={minX:t.x,maxX:t.x+t.width-1,minY:t.y,maxY:t.y+t.height-1}}),this.props.map.areas.forEach(t=>{e&&(e.minX=Math.min(e.minX,t.x),e.maxX=Math.max(e.maxX,t.x+t.width-1),e.minY=Math.min(e.minY,t.y),e.maxY=Math.max(e.maxY,t.y+t.height-1))}),this.props.combatants.filter(e=>e.aura.radius>0).forEach(t=>{const a=this.props.map.items.find(e=>e.id===t.id);if(a){const s=t.aura.radius/5;let n=1;const r=t;r&&(n=Math.max(f.miniSize(r.size),1));const i=a.x-s,o=a.x+(n-1)+s,l=a.y-s,c=a.y+(n-1)+s;e&&(e.minX=Math.min(e.minX,i),e.maxX=Math.max(e.maxX,o),e.minY=Math.min(e.minY,l),e.maxY=Math.max(e.maxY,c))}})}if(!e){if("thumbnail"===this.props.mode)return null;e={minX:0,maxX:0,minY:0,maxY:0}}if("thumbnail"===this.props.mode||"combat-player"===this.props.mode){const t=[];for(let a=e.minX;a<=e.maxX;++a)for(let s=e.minY;s<=e.maxY;++s)this.props.fog.find(e=>e.x===a&&e.y===s)||t.push({x:a,y:s});if(t.length>0){const a=t.map(e=>e.x),s=t.map(e=>e.y);e={minX:Math.min(...a),maxX:Math.max(...a),minY:Math.min(...s),maxY:Math.max(...s)}}}return e.minX-=this.props.paddingSquares,e.maxX+=this.props.paddingSquares,e.minY-=this.props.paddingSquares,e.maxY+=this.props.paddingSquares,e}getStyle(e,t,a,s,n,r){let i=0,o=0;a<1&&(i=(1-a)/2),s<1&&(o=(1-s)/2);let l="0";switch(n){case"rounded":l=this.state.size+"px";break;case"circle":l="50%"}return{left:"calc("+this.state.size+"px * "+(e+i-r.minX)+")",top:"calc("+this.state.size+"px * "+(t+o-r.minY)+")",width:"calc("+this.state.size+"px * "+a+")",height:"calc("+this.state.size+"px * "+s+")",borderRadius:l,backgroundSize:this.state.size+"px"}}render(){try{let e=null;"thumbnail"!==this.props.mode&&(e=n.a.createElement(Fe,{mapSize:this.state.size,setMapSize:e=>this.setState({size:e}),showAreasControl:"combat"===this.props.mode&&this.props.map.areas.length>0,areas:this.props.map.areas,selectArea:e=>this.props.areaSelected(e),showLightControl:"combat"===this.props.mode,lighting:this.props.lighting,selectLighting:e=>this.props.changeLighting(e)}));const t=this.getMapDimensions();if(!t)return n.a.createElement("div",{className:"section centered"},"(blank map)");let a=[];"edit"!==this.props.mode&&"combat"!==this.props.mode||(a=this.props.map.areas.map(e=>{const a=this.getStyle(e.x,e.y,e.width,e.height,"square",t);return n.a.createElement(Ge,{key:e.id,style:a,selected:this.props.selectedItemIDs.includes(e.id)})}));const s=this.props.map.items.filter(e=>"tile"===e.type).map(e=>{const a=this.getStyle(e.x,e.y,e.width,e.height,e.style,t);return n.a.createElement(je,{key:e.id,tile:e,style:a,selectable:"edit"===this.props.mode,selected:this.props.selectedItemIDs.includes(e.id),select:(e,t)=>"edit"===this.props.mode?this.props.itemSelected(e,t):null})});let r=[];this.props.showAreaNames&&(r=this.props.map.areas.map(e=>{const a=this.getStyle(e.x,e.y,e.width,e.height,null,t);return n.a.createElement("div",{key:e.id+" name",className:"map-area-name",style:a},e.name)}));let i=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(i=this.props.map.items.filter(e=>"overlay"===e.type).map(e=>{const a=this.getStyle(e.x,e.y,e.width,e.height,e.style,t);return a.backgroundColor=e.color+e.opacity.toString(16),n.a.createElement(Ue,{key:e.id,overlay:e,style:a,selected:this.props.selectedItemIDs.includes(e.id),select:(e,t)=>this.props.itemSelected(e,t)})}));let o=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(o=this.props.combatants.filter(e=>e.aura.radius>0).filter(e=>e.showOnMap||"combat-player"!==this.props.mode).map(e=>{const a=this.props.map.items.find(t=>t.id===e.id);if(a){const s=e.aura.radius/5,r=2*s+Math.max(f.miniSize(e.displaySize),1),i=this.getStyle(a.x-s,a.y-s,r,r,e.aura.style,t);return i.backgroundColor=e.aura.color,n.a.createElement("div",{key:e.id+" aura",className:"aura",style:i})}return null}).filter(e=>null!==e));const l=[],c=[];let d=null;if("edit"!==this.props.mode){const e=this.props.combatants.map(e=>e.mountID||"").filter(e=>""!==e);this.props.map.items.filter(e=>"monster"===e.type||"pc"===e.type||"companion"===e.type||"token"===e.type).filter(t=>!e.includes(t.id)).sort((e,t)=>{const a=this.props.combatants.find(t=>t.id===e.id),s=this.props.combatants.find(e=>e.id===t.id),n=a?a.displaySize:e.size,r=s?s.displaySize:t.size;return f.miniSize(r)-f.miniSize(n)}).forEach(e=>{let a=f.miniSize(e.size),s=!1,r=!1;const i=this.props.combatants.find(t=>t.id===e.id);if(i){let o=i.displaySize;if(i.mountID){const e=this.props.combatants.find(e=>e.id===i.mountID);e&&(o=e.displaySize)}if(a=f.miniSize(o),s="pc"===i.type,r=i.id===G.getCharacterID(G.getID())&&G.data.options.allowControls,("combat"===this.props.mode||"combat-player"===this.props.mode)&&i.path&&i.path.length>0){i.path.forEach((e,s)=>{if(e){const r=this.getStyle(e.x,e.y,a,a,"square",t);c.push(n.a.createElement(Be,{key:i.id+"-step-"+s,x:e.x,y:e.y,style:r,mode:"step"}))}});const s=V.getDistance(e,i.path,this.props.options?this.props.options.diagonals:""),r=i.path[0],o=this.getStyle(r.x,r.y,a,a,"square",t);o.fontSize=a*this.state.size/5+"px",d=n.a.createElement(Be,{x:r.x,y:r.y,style:o,mode:"step",content:5*s+" ft"})}}const o=this.getStyle(e.x,e.y,a,a,"circle",t);o.fontSize=a*this.state.size/4+"px",l.push(n.a.createElement(He,{key:e.id,token:e,combatant:i||null,style:o,width:a*this.state.size,simple:"thumbnail"===this.props.mode,showGauge:"combat"===this.props.mode,showHidden:"combat"===this.props.mode||s,selectable:"combat"===this.props.mode||"combat-player"===this.props.mode&&r,selected:this.props.selectedItemIDs.includes(e.id),select:(e,t)=>this.props.itemSelected(e,t),remove:e=>this.props.itemRemove(e),conditionRemove:(e,t)=>this.props.conditionRemove(e,t),toggleTag:(e,t)=>this.props.toggleTag(e,t),toggleCondition:(e,t)=>this.props.toggleCondition(e,t),toggleHidden:e=>this.props.toggleHidden(e)}))})}let p=[];"edit"!==this.props.mode&&(p=this.props.fog.map(e=>n.a.createElement(Be,{key:"fog "+e.x+","+e.y,x:e.x,y:e.y,style:this.getStyle(e.x,e.y,1,1,"square",t),mode:"fog"})));const h=[];if("bright light"!==this.props.lighting){const e=[];"combat"===this.props.mode&&(this.props.combatants.filter(e=>e.current).forEach(t=>e.push(t)),this.props.combatants.filter(e=>this.props.selectedItemIDs.includes(e.id)).forEach(t=>e.push(t))),"combat-player"===this.props.mode&&this.props.combatants.filter(e=>"pc"===e.type&&this.props.selectedItemIDs.includes(e.id)).forEach(t=>e.push(t));for(let a=t.minX;a<=t.maxX;++a)for(let s=t.minY;s<=t.maxY;++s){let r=this.props.lighting;this.props.combatants.filter(e=>null!==e.lightSource).forEach(e=>{const t=this.props.map.items.find(t=>t.id===e.id);if(t){const n=V.calculateDistance(t,a,s);e.lightSource&&e.lightSource.dim>=n&&"darkness"===r&&(r="dim light"),e.lightSource&&e.lightSource.bright>=n&&(r="bright light")}}),e.filter(e=>e.darkvision>0).forEach(e=>{const t=this.props.map.items.find(t=>t.id===e.id);if(t){const n=V.calculateDistance(t,a,s);e.darkvision>=n&&("dim light"===r?r="bright light":"darkness"===r&&(r="dim light"))}}),"bright light"!==r&&h.push(n.a.createElement(Be,{key:"light "+a+","+s,x:a,y:s,style:this.getStyle(a,s,1,1,"square",t),mode:"light "+r.replaceAll(" ","-")}))}}const m=[];if(this.props.showGrid)for(let f=t.minY;f!==t.maxY+1;++f)for(let e=t.minX;e!==t.maxX+1;++e)m.push(n.a.createElement(Be,{key:e+","+f,x:e,y:f,style:this.getStyle(e,f,1,1,"square",t),selected:this.isSelected(e,f),onMouseDown:(e,t)=>this.gridSquareMouseDown(e,t),onMouseUp:(e,t)=>this.gridSquareMouseUp(e,t),onMouseEnter:(e,t)=>this.gridSquareEntered(e,t)}));let u=null;if(this.props.focussedSquare){const e=this.getStyle(this.props.focussedSquare.x-1,this.props.focussedSquare.y-1,3,3,"circle",t);u=n.a.createElement("div",{className:"grid-focus",style:e})}const g="map-panel "+this.props.mode,y=1+t.maxX-t.minX,b=1+t.maxY-t.minY,E=this.state.size*y+2;let v=this.state.size*b+2;return e&&(v+=42),n.a.createElement("div",{className:g,style:{width:E+"px",height:v+"px"},onClick:()=>this.props.itemSelected?this.props.itemSelected(null,!1):null,role:"button"},e,n.a.createElement("div",{className:"grid"},a,s,r,i,o,c,d,l,p,h,m,u))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}qe.defaultProps={mode:"thumbnail",options:null,viewport:null,paddingSquares:0,combatants:[],showGrid:!1,showAreaNames:!1,selectedItemIDs:[],fog:[],lighting:"bright light",focussedSquare:null,itemSelected:null,itemMove:null,itemRemove:null,conditionRemove:null,toggleTag:null,toggleCondition:null,toggleHidden:null,areaSelected:null,gridSquareEntered:null,gridSquareClicked:null,gridRectangleUpdated:null,gridRectangleSelected:null,changeLighting:null};class Fe extends n.a.Component{constructor(e){super(e),this.state={mode:"view"}}setMode(e){this.setState({mode:e})}nudgeSize(e){const t=Math.max(this.props.mapSize+e,3);this.props.setMapSize(t)}render(){try{const e=[];switch(this.props.showLightControl&&e.push(n.a.createElement(pe,{key:"mode",options:["view","light"].map(e=>({id:e,text:e})),selectedID:this.state.mode,onSelect:e=>this.setMode(e)})),this.state.mode){case"view":if(e.push(n.a.createElement(de,{key:"zoom",value:"zoom",downEnabled:this.props.mapSize>3,onNudgeValue:e=>this.nudgeSize(3*e)})),this.props.showAreasControl){const t=[{id:"",text:"whole map"}];this.props.areas.forEach(e=>{t.push({id:e.id,text:e.name})}),e.push(n.a.createElement(se,{key:"areas",options:t,placeholder:"show map area...",onSelect:e=>this.props.selectArea(e)}))}break;case"light":e.push(n.a.createElement(de,{key:"light",value:this.props.lighting,downEnabled:"darkness"!==this.props.lighting,upEnabled:"bright light"!==this.props.lighting,onNudgeValue:e=>this.props.selectLighting(f.nudgeLighting(this.props.lighting,e))}))}return n.a.createElement("div",{className:"map-menu"},e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ge extends n.a.Component{render(){try{let e="map-area";return this.props.selected&&(e+=" selected"),n.a.createElement("div",{className:e,style:this.props.style})}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Be extends n.a.Component{mouseDown(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(this.props.x,this.props.y)}mouseUp(e){e.stopPropagation(),this.props.onMouseUp&&this.props.onMouseUp(this.props.x,this.props.y)}mouseEnter(e){e.stopPropagation(),this.props.onMouseEnter&&this.props.onMouseEnter(this.props.x,this.props.y)}doubleClick(e){e.stopPropagation(),this.props.onDoubleClick&&this.props.onDoubleClick(this.props.x,this.props.y)}render(){try{let e=null;return this.props.content&&(e=n.a.createElement("div",{className:"content",style:{fontSize:this.props.style.fontSize}},this.props.content)),n.a.createElement("div",{className:"grid-square "+this.props.mode+(this.props.selected?" selected":""),style:this.props.style,onMouseDown:e=>this.mouseDown(e),onMouseUp:e=>this.mouseUp(e),onMouseEnter:e=>this.mouseEnter(e),onDoubleClick:e=>this.doubleClick(e),role:"button"},e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Be.defaultProps={mode:"cell",selected:!1,content:null,onMouseDown:null,onMouseUp:null,onMouseEnter:null,onDoubleClick:null};class je extends n.a.Component{select(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.tile.id,e.ctrlKey))}render(){try{let e="tile "+this.props.tile.terrain;this.props.selected&&(e+=" selected");let t=null;if("custom"===this.props.tile.terrain){const e=S.getImage(this.props.tile.customBackground);e&&(t=n.a.createElement("img",{className:"custom-image",alt:"map tile",src:e.data}))}"link"===this.props.tile.terrain&&(t=n.a.createElement("img",{className:"custom-image",alt:"map tile",src:this.props.tile.customLink}));let a=null;if(this.props.tile.content)switch(this.props.tile.content.type){case"doorway":switch(this.props.tile.content.style){case"single":switch(this.props.tile.content.orientation){case"horizontal":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),n.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}));break;case"vertical":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),n.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}))}break;case"double":switch(this.props.tile.content.orientation){case"horizontal":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),n.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}),n.a.createElement("line",{className:"thin",x1:"50%",y1:"25%",x2:"50%",y2:"75%"}));break;case"vertical":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),n.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}),n.a.createElement("line",{className:"thin",x1:"25%",y1:"50%",x2:"75%",y2:"50%"}))}break;case"arch":switch(this.props.tile.content.orientation){case"horizontal":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"20%",y2:"50%"}),n.a.createElement("line",{className:"thick",x1:"80%",y1:"50%",x2:"100%",y2:"50%"}),n.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"20%",y2:"80%"}),n.a.createElement("line",{className:"medium",x1:"80%",y1:"20%",x2:"80%",y2:"80%"}));break;case"vertical":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"20%"}),n.a.createElement("line",{className:"thick",x1:"50%",y1:"80%",x2:"50%",y2:"100%"}),n.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"80%",y2:"20%"}),n.a.createElement("line",{className:"medium",x1:"20%",y1:"80%",x2:"80%",y2:"80%"}))}break;case"bars":switch(this.props.tile.content.orientation){case"horizontal":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("circle",{className:"thin filled",cx:"10%",cy:"50%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"30%",cy:"50%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"70%",cy:"50%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"90%",cy:"50%",r:"5%"}));break;case"vertical":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"10%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"30%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"70%",r:"5%"}),n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"90%",r:"5%"}))}}break;case"stairway":switch(this.props.tile.content.style){case"stairs":switch(this.props.tile.content.orientation){case"horizontal":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thin",x1:"0",y1:"12.5%",x2:"100%",y2:"12.5%"}),n.a.createElement("line",{className:"thin",x1:"0",y1:"25%",x2:"100%",y2:"25%"}),n.a.createElement("line",{className:"thin",x1:"0",y1:"37.5%",x2:"100%",y2:"37.5%"}),n.a.createElement("line",{className:"thin",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),n.a.createElement("line",{className:"thin",x1:"0",y1:"62.5%",x2:"100%",y2:"62.5%"}),n.a.createElement("line",{className:"thin",x1:"0",y1:"75%",x2:"100%",y2:"75%"}),n.a.createElement("line",{className:"thin",x1:"0",y1:"87.5%",x2:"100%",y2:"87.5%"}));break;case"vertical":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("line",{className:"thin",x1:"12.5%",y1:"0",x2:"12.5%",y2:"100%"}),n.a.createElement("line",{className:"thin",x1:"25%",y1:"0",x2:"25%",y2:"100%"}),n.a.createElement("line",{className:"thin",x1:"37.5%",y1:"0",x2:"37.5%",y2:"100%"}),n.a.createElement("line",{className:"thin",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),n.a.createElement("line",{className:"thin",x1:"62.5%",y1:"0",x2:"62.5%",y2:"100%"}),n.a.createElement("line",{className:"thin",x1:"75%",y1:"0",x2:"75%",y2:"100%"}),n.a.createElement("line",{className:"thin",x1:"87.5%",y1:"0",x2:"87.5%",y2:"100%"}))}break;case"spiral":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("ellipse",{className:"thin outline",cx:"50%",cy:"50%",rx:"40%",ry:"40%"}),n.a.createElement("ellipse",{className:"thin filled",cx:"50%",cy:"50%",rx:"10%",ry:"10%"}),n.a.createElement("line",{className:"thin",x1:"50%",y1:"10%",x2:"50%",y2:"90%"}),n.a.createElement("line",{className:"thin",x1:"10%",y1:"50%",x2:"90%",y2:"50%"}),n.a.createElement("line",{className:"thin",x1:"20%",y1:"20%",x2:"80%",y2:"80%"}),n.a.createElement("line",{className:"thin",x1:"20%",y1:"80%",x2:"80%",y2:"20%"}));break;case"ladder":switch(this.props.tile.content.orientation){case"horizontal":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("circle",{className:"thin filled",cx:"20%",cy:"50%",r:"7%"}),n.a.createElement("line",{className:"thin",x1:"20%",y1:"50%",x2:"80%",y2:"50%"}),n.a.createElement("circle",{className:"thin filled",cx:"80%",cy:"50%",r:"7%"}));break;case"vertical":a=n.a.createElement("svg",{className:"tile-content"},n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"20%",r:"7%"}),n.a.createElement("line",{className:"thin",x1:"50%",y1:"20%",x2:"50%",y2:"80%"}),n.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"80%",r:"7%"}))}}}return n.a.createElement("div",{className:e,style:this.props.style,onClick:e=>this.select(e),role:"button"},t,a)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ue extends n.a.Component{select(e){e.stopPropagation(),this.props.select(this.props.overlay.id,e.ctrlKey)}render(){try{let e="overlay";return this.props.selected&&(e+=" selected"),n.a.createElement("div",{className:e,style:this.props.style,onClick:e=>this.select(e),role:"button"})}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class He extends n.a.Component{constructor(e){super(e),this.state={hovered:!1,clicked:!1}}handleHoverChange(e){this.setState({hovered:e,clicked:!1})}handleClickChange(e){this.setState({hovered:!1,clicked:e})}select(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.token.id,e.ctrlKey))}getPopoverContent(e){let t="token",a=null;const s=[];if(this.props.combatant){if(t=this.props.combatant.displayName||"unnamed combatant",a=n.a.createElement(ze,{combatants:[this.props.combatant],editable:e,toggleTag:(e,t)=>this.props.toggleTag(e,t),toggleCondition:(e,t)=>this.props.toggleCondition(e,t),toggleHidden:e=>this.props.toggleHidden(e)}),0!==this.props.token.z&&s.push(n.a.createElement("div",{key:"altitude",className:"section"},"altitude: ",Math.abs(5*this.props.token.z)," ft ",this.props.token.z>0?"up":"down")),e)this.props.combatant.conditions.filter(e=>"prone"!==e.name&&"unconscious"!==e.name).forEach(e=>{s.push(n.a.createElement("div",{key:e.id,className:"content-then-icons"},n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"group-panel"},e.name)),n.a.createElement("div",{className:"icons"},n.a.createElement(ge.a,{onClick:()=>this.props.conditionRemove(this.props.combatant,e)}))))});else{const e=this.props.combatant.conditions.map(e=>e.name).filter(e=>"prone"!==e&&"unconscious"!==e&&"custom"!==e).join(", ");""!==e&&s.push(n.a.createElement("div",{key:"conditions",className:"section"},e));const t=this.props.combatant.conditions.find(e=>"custom"===e.name);t&&f.conditionText(t).forEach((e,a)=>{s.push(n.a.createElement("div",{key:t.id+"-"+a,className:"section"},e))})}this.props.combatant.note&&s.push(n.a.createElement("div",{key:"note",className:"section"},this.props.combatant.note))}return e&&s.push(n.a.createElement("button",{key:"remove",onClick:()=>this.props.remove(this.props.token.id)},"remove from map")),n.a.createElement("div",null,n.a.createElement("div",{key:"name",className:"section centered"},n.a.createElement("b",null,t)),a,s.length>0?n.a.createElement("hr",null):null,s)}render(){try{let e="token",t="token";if(this.props.selected&&(t+=" selected"),this.props.selectable||(t+=" not-selectable"),this.props.combatant&&(e=this.props.combatant.displayName||"combatant",t+=" "+this.props.combatant.faction,this.props.combatant.current&&(t+=" current"),!this.props.combatant.showOnMap)){if(!this.props.showHidden)return null;t+=" hidden"}let a=null,s=null,r=null,i=null;if(this.props.combatant&&!this.props.simple){const t=this.props.combatant;if(t&&t.portrait)a=n.a.createElement("img",{className:"portrait",src:t.portrait,alt:e});else{const t=e.toUpperCase().replace(/[^A-Z0-9 ]/,"").split(" ").map(e=>e[0]).join("");a=n.a.createElement("div",{className:"initials"},t)}if("monster"===this.props.combatant.type&&this.props.showGauge){const e=this.props.combatant.hpCurrent||0,t=this.props.combatant.hpMax||0;if(e<t){let a="orange";e>=t?a="green":e<=t/2&&(a="crimson"),s=n.a.createElement(fe.a,{type:"circle",status:"normal",strokeColor:a,showInfo:!1,percent:100*e/t,width:this.props.width-3})}}this.props.token.z>0&&(r=n.a.createElement("div",{className:"badge"},n.a.createElement(ye.a,{twoToneColor:"#3c78dc"}))),this.props.token.z<0&&(r=n.a.createElement("div",{className:"badge"},n.a.createElement(be.a,{twoToneColor:"#3c78dc"})));let o=0;this.props.combatant.conditions&&(o+=this.props.combatant.conditions.length),this.props.combatant.tags&&(o+=this.props.combatant.tags.filter(e=>!e.startsWith("engaged")).length),o>0&&(i=n.a.createElement("div",{className:"conditions"},n.a.createElement(Ee.a,{twoToneColor:"#3c78dc"})))}const o=n.a.createElement("div",{className:t,style:this.props.style,onClick:e=>this.select(e),role:"button"},a,s,r,i);return this.props.selectable?n.a.createElement(ve.a,{content:this.getPopoverContent(!1),trigger:"hover",placement:"bottom",overlayClassName:"map-hover-tooltip",visible:this.state.hovered,onVisibleChange:e=>this.handleHoverChange(e)},n.a.createElement(ve.a,{content:this.getPopoverContent(!0),trigger:"contextMenu",placement:"bottom",overlayClassName:"map-click-tooltip",visible:this.state.clicked,onVisibleChange:e=>this.handleClickChange(e)},o)):n.a.createElement(ve.a,{content:this.getPopoverContent(!1),trigger:"hover",placement:"bottom",overlayClassName:"map-hover-tooltip"},o)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ye extends n.a.Component{constructor(e){super(e),this.state={combatSetup:e.combatSetup,encounterFixed:!!e.combatSetup.encounter,mapFixed:!!e.combatSetup.map}}setEncounterID(e){const t=this.state.combatSetup,a=this.props.encounters.find(t=>t.id===e);t.encounter=a?JSON.parse(JSON.stringify(a)):null,t.slotInfo=f.getCombatSlotData(t.encounter,this.props.library),this.setState({combatSetup:t},()=>this.props.notify())}setMapID(e){const t=this.props.maps.find(t=>t.id===e),a=this.state.combatSetup;a.map=t||null,this.setState({combatSetup:a})}setWaveID(e){const t=this.state.combatSetup;if(t.waveID=e,t.encounter){const a=t.encounter.waves.find(t=>t.id===e);a&&(t.slotInfo=f.getCombatSlotData(a,this.props.library))}this.setState({combatSetup:t},()=>this.props.notify())}generateEncounter(e){const t=E.createEncounter(),a=E.createMonsterFilter();let s=0,n=0;if(this.state.combatSetup.party){const t=this.state.combatSetup.party.pcs.filter(e=>e.active);t.forEach(t=>{s+=f.pcExperience(t.level,e),n+=t.level});const r=n/t.length;a.challengeMax=Math.max(r,5)}M.buildEncounter(t,s,a,this.props.library,this.props.getMonster);const r=this.state.combatSetup;r.encounter=t,r.slotInfo=f.getCombatSlotData(t,this.props.library),this.setState({combatSetup:r},()=>this.props.notify())}generateMap(e){const t=E.createMap();V.generate(e,t);const a=this.state.combatSetup;a.map=t,this.setState({combatSetup:a},()=>this.props.notify())}changeValue(e,t,a){e[t]=a;const s=e;s.members&&("init"===t&&s.members.forEach(e=>e.init=a),"hp"===t&&s.members.forEach(e=>e.hp=a)),this.setState({combatSetup:this.state.combatSetup})}nudgeValue(e,t,a){e[t]=e[t]+a;const s=this.state.combatSetup;if(s.encounter){if(s.waveID){const e=s.encounter.waves.find(e=>e.id===s.waveID);e&&(s.slotInfo=f.getCombatSlotData(e,this.props.library))}else s.slotInfo=f.getCombatSlotData(s.encounter,this.props.library);this.setState({combatSetup:s})}}render(){try{let e=null,t=null;switch(this.props.type){case"start":let a=null;this.state.encounterFixed||(a=n.a.createElement(We,{combatSetup:this.state.combatSetup,encounters:this.props.encounters,fixed:this.state.encounterFixed,setEncounterID:e=>this.setEncounterID(e),generateEncounter:e=>this.generateEncounter(e),getMonster:e=>this.props.getMonster(e)}));let s=null;this.state.mapFixed||(s=n.a.createElement(Je,{combatSetup:this.state.combatSetup,maps:this.props.maps,fixed:this.state.mapFixed,setMapID:e=>this.setMapID(e),generateMap:e=>this.generateMap(e)})),e=n.a.createElement("div",null,a,s),t=n.a.createElement("div",null,n.a.createElement(Ze,{type:this.props.type,combatSetup:this.state.combatSetup,getMonster:e=>this.props.getMonster(e),changeValue:(e,t,a)=>this.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a)}));break;case"add-wave":e=n.a.createElement("div",null,n.a.createElement(_e,{combatSetup:this.state.combatSetup,setWaveID:e=>this.setWaveID(e),getMonster:e=>this.props.getMonster(e)})),t=n.a.createElement("div",null,n.a.createElement(Ze,{type:this.props.type,combatSetup:this.state.combatSetup,getMonster:e=>this.props.getMonster(e),changeValue:(e,t,a)=>this.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a)}));break;case"add-combatants":e=n.a.createElement("div",null,n.a.createElement(Xe,{combatSetup:this.state.combatSetup,library:this.props.library,addMonster:e=>this.props.addMonster(e)})),t=n.a.createElement("div",null,n.a.createElement(Ke,{encounter:this.state.combatSetup.encounter,nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a),getMonster:e=>this.props.getMonster(e)}),n.a.createElement(Ze,{type:this.props.type,combatSetup:this.state.combatSetup,getMonster:e=>this.props.getMonster(e),changeValue:(e,t,a)=>this.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a)}))}return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable"},e),n.a.createElement(h.a,{span:12,className:"scrollable"},t))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Ye.defaultProps={encounters:null,maps:null,addMonster:null};class We extends n.a.Component{render(){let e=null;if(!this.props.combatSetup.encounter){let t=null;if(this.props.encounters.length>0){const e=this.props.encounters.map(e=>({id:e.id,text:e.name||"unnamed encounter"}));t=n.a.createElement(se,{options:e,placeholder:"select an encounter",onSelect:e=>this.props.setEncounterID(e)})}let a=null;this.props.combatSetup.party&&(a=n.a.createElement("button",{onClick:()=>this.props.generateEncounter("medium")},"generate a random encounter")),e=n.a.createElement("div",null,t,a)}let t=null;if(this.props.combatSetup.encounter){const e=this.props.combatSetup.encounter.slots.map(e=>{let t="";const a=this.props.getMonster(e.monsterID);return a&&(t=a.name),t=t||"unnamed monster",e.count>1&&(t+=" (x"+e.count+")"),n.a.createElement("div",{key:e.id,className:"group-panel"},t)});0===e.length&&e.push(n.a.createElement(Le,{key:"empty"},"no monsters")),t=n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"monsters"),e)}let a=null;this.props.combatSetup.encounter&&!this.props.fixed&&(a=n.a.createElement(c.a,{onClick:()=>this.props.setEncounterID(null)}));let s=null;return this.props.combatSetup.party&&this.props.combatSetup.encounter&&(s=n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"difficulty"),n.a.createElement(me,{party:this.props.combatSetup.party,encounter:this.props.combatSetup.encounter,getMonster:e=>this.props.getMonster(e)}))),n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"encounter",a),e,t,s)}}class Je extends n.a.Component{render(){let e=null;if(!this.props.combatSetup.map){let t=null;if(this.props.maps.length>0){const e=this.props.maps.map(e=>({id:e.id,text:e.name||"unnamed map"}));t=n.a.createElement(se,{options:e,placeholder:"select a map",onSelect:e=>this.props.setMapID(e)})}e=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"this is optional - you don't have to use a map to run an encounter")),t,n.a.createElement("button",{onClick:()=>this.props.generateMap("delve")},"generate a random delve"))}let t=null;this.props.combatSetup.map&&(t=n.a.createElement("div",{className:"scrollable horizontal-only"},n.a.createElement(qe,{map:this.props.combatSetup.map,combatants:this.props.combatSetup.combatants})));let a=null;return this.props.combatSetup.map&&!this.props.fixed&&(a=n.a.createElement(c.a,{onClick:()=>this.props.setMapID(null)})),n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"map",a),e,t)}}class _e extends n.a.Component{render(){if(null===this.props.combatSetup.encounter)return n.a.createElement("div",{className:"section"},"you have not selected an encounter");{if(0===this.props.combatSetup.encounter.waves.length)return n.a.createElement("div",{className:"section"},"you have not defined any waves");const e=this.props.combatSetup.encounter.waves.map(e=>({id:e.id,text:e.name||"unnamed wave"}));let t=null;if(this.props.combatSetup.waveID){const e=this.props.combatSetup.encounter.waves.find(e=>e.id===this.props.combatSetup.waveID);if(e){const a=e.slots.map(e=>{let t="";const a=this.props.getMonster(e.monsterID);return a&&(t=a.name),t=t||"unnamed monster",e.count>1&&(t+=" (x"+e.count+")"),n.a.createElement("div",{key:e.id,className:"group-panel"},t)});0===a.length&&a.push(n.a.createElement(Le,{key:"empty"},"no monsters")),t=n.a.createElement("div",null,a)}}return n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"wave"),n.a.createElement(se,{options:e,placeholder:"select wave",selectedID:this.props.combatSetup.waveID?this.props.combatSetup.waveID:void 0,onSelect:e=>this.props.setWaveID(e),onClear:()=>this.props.setWaveID(null)}),t)}}}class Ke extends n.a.Component{render(){const e=this.props.encounter.slots.map(e=>{let t="";const a=this.props.getMonster(e.monsterID);return a&&(t=a.name),t=t||"unnamed monster",e.count>1&&(t+=" (x"+e.count+")"),n.a.createElement("div",{key:e.id,className:"group-panel"},t,n.a.createElement(de,{value:"count: "+e.count,downEnabled:e.count>1,onNudgeValue:t=>this.props.nudgeValue(e,"count",t)}))});return 0===e.length&&e.push(n.a.createElement(Le,{key:"empty"},"no monsters")),n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"selected monsters"),e)}}class Xe extends n.a.Component{constructor(e){super(e),this.state={filter:E.createMonsterFilter()}}changeFilterValue(e,t){const a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}resetFilter(){this.setState({filter:E.createMonsterFilter()})}matchMonster(e){return M.matchMonster(e,this.state.filter)}render(){const e=[];this.props.library.forEach(t=>{t.monsters.forEach(t=>{this.matchMonster(t)&&e.push(t)})}),e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0);let t=[];var a;this.props.combatSetup.encounter&&(t=null===(a=this.props.combatSetup.encounter)||void 0===a?void 0:a.slots.map(e=>e.monsterID));let s=e.filter(e=>!t.includes(e.id)).map(e=>n.a.createElement(ee,{key:e.id,monster:e,selectMonster:e=>this.props.addMonster(e)}));return 0===s.length&&(s=n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"there are no monsters that match the above criteria (or you have already selected them all)"))),n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"monsters"),n.a.createElement(ue,{filter:this.state.filter,changeValue:(e,t)=>this.changeFilterValue(e,t),resetFilter:()=>this.resetFilter()}),s)}}class Ze extends n.a.Component{constructor(e){super(e),this.state={standardInitOptions:!0,standardHPOptions:!0,view:"count"}}setView(e){this.setState({view:e})}getSlots(e,t){return this.props.combatSetup.slotInfo.map(a=>{const s=e.slots.find(e=>e.id===a.id);if(!s)return null;const r=this.props.getMonster(s.monsterID);return r?n.a.createElement(Qe,{key:a.id,slotInfo:a,encounterSlot:s,monster:r,view:t,changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.props.nudgeValue(e,t,a)}):null})}render(){var e;if("start"===this.props.type&&!this.props.combatSetup.encounter)return n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"options"),n.a.createElement("div",{className:"section"},"select an encounter to see monster information here."));if("add-wave"===this.props.type&&!this.props.combatSetup.waveID)return n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"options"),n.a.createElement("div",{className:"section"},"select a wave to see monster information here."));if("add-combatants"===this.props.type&&0===(null===(e=this.props.combatSetup.encounter)||void 0===e?void 0:e.slots.length))return n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"options"),n.a.createElement("div",{className:"section"},"add monsters to see their information here."));if(this.props.combatSetup.encounter){let e=this.props.combatSetup.encounter;if(this.props.combatSetup.waveID){const t=this.props.combatSetup.encounter.waves.find(e=>e.id===this.props.combatSetup.waveID);t&&(e=t)}return 0===e.slots.length?null:n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"options"),n.a.createElement(te,{checked:this.state.standardInitOptions,label:"roll initiative once for each different type of monster",onChecked:e=>this.setState({standardInitOptions:e})}),this.state.standardInitOptions?null:this.getSlots(e,"initiative"),n.a.createElement(te,{checked:this.state.standardHPOptions,label:"use typical hp for each monster",onChecked:e=>this.setState({standardHPOptions:e})}),this.state.standardHPOptions?null:this.getSlots(e,"hit points"),n.a.createElement("hr",null),n.a.createElement(oe,{text:"advanced options"},n.a.createElement(pe,{options:["count","names","faction"].map(e=>({id:e,text:e})),selectedID:this.state.view,onSelect:e=>this.setView(e)}),n.a.createElement("hr",null),n.a.createElement("div",null,this.getSlots(e,this.state.view))))}return null}}class Qe extends n.a.Component{rollInit(e){const t=f.dieRoll(),a=f.modifierValue(this.props.monster.abilityScores.dex);this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"init",t+a)}rollHP(e){const t=f.hitDieType(this.props.monster.size),a=f.dieRoll(t,this.props.monster.hitDice),s=f.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice;this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"hp",a+s)}getValueSection(e,t,a,s,r){return n.a.createElement(p.a,{align:"middle"},n.a.createElement(h.a,{span:20},n.a.createElement(H.a,{min:e,max:t,value:a[s],onChange:e=>this.props.changeValue(a,s,e)})),n.a.createElement(h.a,{span:4},n.a.createElement("div",{className:"combatant-value"},a[s],n.a.createElement(U.a,{onClick:()=>r()}))))}getInitSection(){let e=null;this.props.encounterSlot.count>1&&(e=n.a.createElement(te,{label:"roll initiative once for this group",checked:this.props.slotInfo.useGroupInit,onChecked:e=>this.props.changeValue(this.props.slotInfo,"useGroupInit",e)}));const t=f.modifierValue(this.props.monster.abilityScores.dex),a=1+t,s=20+t,r=[];return this.props.slotInfo.useGroupInit?r.push(n.a.createElement("div",{key:"init"},this.getValueSection(a,s,this.props.slotInfo,"init",()=>this.rollInit(null)))):this.props.slotInfo.members.forEach(e=>{r.push(n.a.createElement("div",{key:e.id},n.a.createElement("div",{className:"combatant-name"},e.name),this.getValueSection(a,s,e,"init",()=>this.rollInit(e))))}),n.a.createElement("div",null,e,r)}getHPSection(){let e=null;this.props.encounterSlot.count>1&&(e=n.a.createElement(te,{label:"use the same hp for every monster in this group",checked:this.props.slotInfo.useGroupHP,onChecked:e=>this.props.changeValue(this.props.slotInfo,"useGroupHP",e)}));const t=N.getTypicalHP(this.props.monster),a=f.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice,s=this.props.monster.hitDice+a,r=this.props.monster.hitDice*f.hitDieType(this.props.monster.size)+a,i=[];return this.props.slotInfo.useGroupHP?i.push(n.a.createElement("div",{key:"hp"},this.getValueSection(s,r,this.props.slotInfo,"hp",()=>this.rollHP(null)),n.a.createElement("button",{className:this.props.slotInfo.hp!==t?"":"disabled",onClick:()=>this.props.changeValue(this.props.slotInfo,"hp",t)},"reset to average hp"))):this.props.slotInfo.members.forEach(e=>{i.push(n.a.createElement("div",{key:e.id},n.a.createElement("div",{className:"combatant-name"},e.name),this.getValueSection(s,r,e,"hp",()=>this.rollHP(e)),n.a.createElement("button",{className:e.hp!==t?"":"disabled",onClick:()=>this.props.changeValue(e,"hp",t)},"reset to average hp")))}),n.a.createElement("div",null,e,i)}getCountSection(){return n.a.createElement("div",null,n.a.createElement(de,{value:"count: "+this.props.encounterSlot.count,downEnabled:this.props.encounterSlot.count>1,onNudgeValue:e=>this.props.nudgeValue(this.props.encounterSlot,"count",e)}))}getNameSection(){return this.props.slotInfo.members.map(e=>n.a.createElement(_,{key:e.id,text:e.name,onChange:t=>this.props.changeValue(e,"name",t)}))}getFactionSection(){return n.a.createElement("div",null,n.a.createElement(pe,{options:["foe","neutral","ally"].map(e=>({id:e,text:e})),selectedID:this.props.encounterSlot.faction,onSelect:e=>this.props.changeValue(this.props.encounterSlot,"faction",e)}))}render(){let e=this.props.monster.name||"unnamed monster",t=null;switch(this.props.view){case"initiative":e+=" (1d20 "+f.modifier(this.props.monster.abilityScores.dex)+")",t=this.getInitSection();break;case"hit points":e+=" ("+N.getTypicalHPString(this.props.monster)+")",t=this.getHPSection();break;case"count":t=this.getCountSection();break;case"names":t=this.getNameSection();break;case"faction":t=this.getFactionSection()}return n.a.createElement("div",{className:"group-panel combatant-setup"},n.a.createElement("div",{className:"subheading"},e),t)}}class $e extends n.a.Component{render(){try{const e=this.props.items.map(e=>n.a.createElement(et,{key:e.id,item:e,selected:this.props.selectedItemID===e.id,onSelect:e=>this.props.onSelect(e)}));return n.a.createElement("div",{className:"radio-group"},e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}$e.defaultProps={selectedItemID:null};class et extends n.a.Component{click(e){e.stopPropagation(),this.props.onSelect(this.props.item.id)}render(){try{let e="radio-item",t=null;return this.props.selected&&(e+=" selected",this.props.item.details&&(t=n.a.createElement("div",{className:"radio-item-details"},this.props.item.details))),this.props.item.disabled&&(e+=" disabled"),n.a.createElement("div",{className:e,onClick:e=>this.click(e),role:"button"},n.a.createElement("div",{className:"radio-item-top"},n.a.createElement("div",{className:"radio-item-text"},this.props.item.text),n.a.createElement("div",{className:"radio-item-info"},this.props.item.info)),t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class tt extends n.a.Component{constructor(e){super(e),this.state={condition:e.condition}}setCondition(e){if(this.state.condition.name!==e){const t=this.state.condition;t.name=e,t.level=1,t.text="",this.setState({condition:t})}}setCustomText(e){const t=this.state.condition;t.text=e,this.setState({condition:t})}setDuration(e){let t=null;switch(e){case"saves":t=E.createConditionDurationSaves();break;case"combatant":t=E.createConditionDurationCombatant();break;case"rounds":t=E.createConditionDurationRounds()}const a=this.state.condition;a.duration=t,this.setState({condition:a})}changeValue(e,t,a){e[t]=a,this.setState({condition:this.state.condition})}nudgeValue(e,t,a){let s=e[t]+a;"level"===t&&(s=Math.max(s,1),s=Math.min(s,6)),"count"===t&&(s=Math.max(s,1)),"saveDC"===t&&(s=Math.max(s,0)),e[t]=s,this.setState({condition:this.state.condition})}render(){try{const e=v.map(e=>{let t=null;const a=[];if(e===this.state.condition.name&&("exhaustion"===e&&(t=n.a.createElement(de,{value:this.props.condition.level,label:"exhaustion",downEnabled:this.props.condition.level>1,upEnabled:this.props.condition.level<6,onNudgeValue:e=>this.nudgeValue(this.props.condition,"level",e)})),"custom"===e&&(t=n.a.createElement(_,{text:this.state.condition.text,placeholder:"",onChange:e=>this.setCustomText(e)})),"custom"!==this.state.condition.name)){const e=f.conditionText(this.state.condition);for(let t=0;t!==e.length;++t)a.push(n.a.createElement("li",{key:t,className:"section"},e[t]))}const s=this.props.combatants.filter(e=>"monster"===e.type).some(t=>!!t&&-1!==t.conditionImmunities.indexOf(e));return{id:e,text:e,details:n.a.createElement("div",{key:e},t,n.a.createElement("ul",null,a)),disabled:s}}),t=["str","dex","con","int","wis","cha","death"].map(e=>({id:e,text:e})),a=[{id:"start",text:"start of turn"},{id:"end",text:"end of turn"}],s=this.props.allCombatants.filter(e=>"placeholder"!==e.type).map(e=>{const t=e;return{id:t.id,text:t.displayName||t.name||"unnamed monster"}});b.sort(s,[{field:"text",dir:"asc"}]);const r=[{id:"none",text:"until removed (default)",details:n.a.createElement("div",{className:"section"},n.a.createElement("div",null,"the condition persists until it is manually removed"))},{id:"saves",text:"until a successful save",details:n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"number of saves required"),n.a.createElement(de,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:e=>this.nudgeValue(this.props.condition.duration,"count",e)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"save dc"),n.a.createElement(de,{value:this.props.condition.duration?"dc "+this.props.condition.duration.saveDC:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.saveDC>0,onNudgeValue:e=>this.nudgeValue(this.props.condition.duration,"saveDC",e)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"type of save"),n.a.createElement(pe,{options:t,selectedID:this.props.condition.duration?this.props.condition.duration.saveType:null,onSelect:e=>this.changeValue(this.props.condition.duration,"saveType",e)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"make the save at the start or end of the turn"),n.a.createElement(pe,{options:a,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:e=>this.changeValue(this.props.condition.duration,"point",e)})))},{id:"combatant",text:"until someone's next turn",details:n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"start or end of the turn"),n.a.createElement(pe,{options:a,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:e=>this.changeValue(this.props.condition.duration,"point",e)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"combatant"),n.a.createElement(se,{options:s,selectedID:this.props.condition.duration&&this.props.condition.duration.combatantID||void 0,onSelect:e=>this.changeValue(this.props.condition.duration,"combatantID",e)})))},{id:"rounds",text:"for a number of rounds",details:n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"number of rounds"),n.a.createElement(de,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:e=>this.nudgeValue(this.props.condition.duration,"count",e)})))}];return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement("div",{className:"heading"},"condition"),n.a.createElement($e,{items:e,selectedItemID:this.state.condition.name,onSelect:e=>this.setCondition(e)})),n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement("div",{className:"heading"},"duration"),n.a.createElement($e,{items:r,selectedItemID:this.state.condition.duration?this.state.condition.duration.type:"none",onSelect:e=>this.setDuration(e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class at extends n.a.Component{render(){try{if(0===this.props.data.length)return null;const e=Math.max(...this.props.data.map(e=>e.value));let t;if(this.props.collapse)t=this.props.data.filter(e=>e.value>0);else{const e=this.props.data.find(e=>e.value>0);this.props.data.reverse();const a=this.props.data.find(e=>e.value>0);this.props.data.reverse();const s=e?this.props.data.indexOf(e):0,n=a?this.props.data.indexOf(a):this.props.data.length-1;t=this.props.data.slice(s,n+1)}const a=t.map(t=>n.a.createElement("div",{key:t.text,className:"bar-container"},n.a.createElement("div",{className:"bar",style:{width:"calc((100% - 1px) * "+t.value+" / "+e+")"}},n.a.createElement("div",{className:"label"},t.text,": ",this.props.onFormatValue(t.value)))));return n.a.createElement("div",{className:"plot"},a)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}at.defaultProps={collapse:!1,onFormatValue:e=>e.toString()};class st extends n.a.Component{constructor(e){super(e),this.state={chart:"challenge"}}selectChart(e){this.setState({chart:e})}render(){try{const e=[];if(this.props.groups.forEach(t=>t.monsters.forEach(t=>e.push(t))),0===e.length)return null;let t=[];switch(this.state.chart){case"challenge":t=[0,.125,.25,.5,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30].map(t=>({text:"cr "+f.challenge(t),value:e.filter(e=>e.challenge===t).length}));break;case"size":t=w.map(t=>({text:t,value:e.filter(e=>e.size===t).length}));break;case"type":t=k.map(t=>({text:t,value:e.filter(e=>e.category===t).length}))}const a=[{id:"challenge",text:"challenge rating"},{id:"size",text:"size"},{id:"type",text:"type"}];return n.a.createElement("div",{className:"scrollable padded"},n.a.createElement(pe,{options:a,selectedID:this.state.chart,onSelect:e=>this.selectChart(e)}),n.a.createElement(at,{data:t}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var nt=a(190),rt=a(191),it=a(101);class ot extends n.a.Component{constructor(e){super(e),this.state={showAbilityScores:!1}}toggleAbilityScores(){this.setState({showAbilityScores:!this.state.showAbilityScores})}roll(e,t,a){e.stopPropagation();const s=this.props.combatant.abilityScores[t],n=f.modifierValue(s);this.props.onRollDice(t,1,20,n,a)}getAbilityScore(e){const t=this.props.combatant.abilityScores[e],a=f.modifier(t),s=n.a.createElement("div",null,n.a.createElement("div",{className:"ability-heading"},e),n.a.createElement("div",{className:"ability-value"},n.a.createElement("div",null,this.state.showAbilityScores?t:a)));return this.props.showRollButtons?n.a.createElement(ve.a,{content:n.a.createElement("div",null,n.a.createElement("button",{onClick:t=>this.roll(t,e,"advantage")},"adv"),n.a.createElement("button",{onClick:t=>this.roll(t,e,"disadvantage")},"dis")),trigger:"contextMenu"},n.a.createElement("div",{className:"ability-score link",onClick:t=>this.roll(t,e,""),role:"button"},s)):n.a.createElement("div",{className:"ability-score"},s)}render(){try{let e=null;return e=this.props.edit?n.a.createElement("div",null,n.a.createElement(de,{value:this.props.combatant.abilityScores.str,label:"strength",downEnabled:this.props.combatant.abilityScores.str>0,onNudgeValue:e=>this.props.onNudgeValue(this.props.combatant,"abilityScores.str",e)}),n.a.createElement(de,{value:this.props.combatant.abilityScores.dex,label:"dexterity",downEnabled:this.props.combatant.abilityScores.dex>0,onNudgeValue:e=>this.props.onNudgeValue(this.props.combatant,"abilityScores.dex",e)}),n.a.createElement(de,{value:this.props.combatant.abilityScores.con,label:"constitution",downEnabled:this.props.combatant.abilityScores.con>0,onNudgeValue:e=>this.props.onNudgeValue(this.props.combatant,"abilityScores.con",e)}),n.a.createElement(de,{value:this.props.combatant.abilityScores.int,label:"intelligence",downEnabled:this.props.combatant.abilityScores.int>0,onNudgeValue:e=>this.props.onNudgeValue(this.props.combatant,"abilityScores.int",e)}),n.a.createElement(de,{value:this.props.combatant.abilityScores.wis,label:"wisdom",downEnabled:this.props.combatant.abilityScores.wis>0,onNudgeValue:e=>this.props.onNudgeValue(this.props.combatant,"abilityScores.wis",e)}),n.a.createElement(de,{value:this.props.combatant.abilityScores.cha,label:"charisma",downEnabled:this.props.combatant.abilityScores.cha>0,onNudgeValue:e=>this.props.onNudgeValue(this.props.combatant,"abilityScores.cha",e)})):n.a.createElement("div",{className:"ability-scores",onClick:()=>this.toggleAbilityScores(),role:"button"},this.getAbilityScore("str"),this.getAbilityScore("dex"),this.getAbilityScore("con"),this.getAbilityScore("int"),this.getAbilityScore("wis"),this.getAbilityScore("cha")),e}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}ot.defaultProps={edit:!1,showRollButtons:!1,onNudgeValue:null,onRollDice:null};class lt extends n.a.Component{render(){try{return n.a.createElement("div",{className:"statistic"},n.a.createElement("div",{className:"statistic-prefix"},this.props.prefix),n.a.createElement("div",{className:"statistic-label"},this.props.label),n.a.createElement("div",{className:"statistic-value"},this.props.value),n.a.createElement("div",{className:"statistic-suffix"},this.props.suffix))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}lt.defaultProps={prefix:null,suffix:null};var ct=a(186),dt=a(187),pt=a(188);const ht=new ke.a.Converter;ht.setOption("tables",!0);class mt extends n.a.Component{createSection(e,t){const a=e[t];if(0===a.length)return null;let s=null;if("legendary"===this.props.mode||"lair"===this.props.mode)switch(t){case"legendary":case"mythic":let e=null,a=null;if(this.props.combatant.legendaryActions>0&&(e=n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round"),n.a.createElement("hr",null)),"legendary"===this.props.mode)){let e=0;this.props.combatant.traits.filter(e=>("legendary"===e.type||"mythic"===e.type)&&e.uses>0).forEach(t=>{let a=1;if(t.usage){const e=t.usage.toLowerCase().match(/\D*(\d*)\D*/);e&&(a=parseInt(e[1],10))}e+=a}),e=Math.min(e,this.props.combatant.legendaryActions);const t=Math.max(this.props.combatant.legendaryActions-e,0),s=[];for(let a=0;a!==e;++a)s.push(n.a.createElement(ct.a,{key:"used "+a}));for(let a=0;a!==t;++a)s.push(n.a.createElement(dt.a,{key:"unused "+a}));a=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement("div",{className:"section centered legendary-usage"},s))}"legendary"===t&&(s=n.a.createElement(Le,{white:!0},e,n.a.createElement("div",null,"one legendary action can be used at the end of each other combatant's turn; spent actions are refreshed at the start of the monster's turn"),a)),"mythic"===t&&(s=n.a.createElement(Le,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));break;case"lair":s=n.a.createElement(Le,{white:!0},"one lair action can be taken each round on initiative 20")}else"legendary"===t&&(s=n.a.createElement(Le,{white:!0},n.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round")),"mythic"===t&&(s=n.a.createElement(Le,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));return n.a.createElement("div",null,n.a.createElement("div",{className:"section subheading"},f.traitType(t,!0)),s,a)}render(){try{const e={};return C.forEach(t=>{e[t]=this.props.combatant.traits.filter(e=>e.type===t).map(e=>n.a.createElement(ut,{key:e.id,trait:e,mode:this.props.mode,showRollButtons:this.props.showRollButtons,copyTrait:e=>this.props.copyTrait(e),useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e),onRollDice:(e,t,a,s,n)=>this.props.onRollDice(e,t,a,s,n)}))}),0===this.props.combatant.traits.length?n.a.createElement("div",null,n.a.createElement("i",null,"no traits or actions")):"combat"===this.props.mode?n.a.createElement("div",null,this.createSection(e,"trait"),this.createSection(e,"action"),this.createSection(e,"bonus"),this.createSection(e,"reaction")):"legendary"===this.props.mode?n.a.createElement("div",null,this.createSection(e,"legendary"),this.createSection(e,"mythic")):"lair"===this.props.mode?n.a.createElement("div",null,this.createSection(e,"lair")):n.a.createElement("div",null,this.createSection(e,"trait"),this.createSection(e,"action"),this.createSection(e,"bonus"),this.createSection(e,"reaction"),this.createSection(e,"legendary"),this.createSection(e,"mythic"),this.createSection(e,"lair"))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}mt.defaultProps={mode:"view",showRollButtons:!1,copyTrait:null,useTrait:null,rechargeTrait:null,onRollDice:null};class ut extends n.a.Component{render(){try{let e=0,t=this.props.trait.name||"unnamed "+f.traitType(this.props.trait.type,!1);if(this.props.trait.usage){let a="";this.props.trait.usage.toLowerCase().startsWith("recharge ")&&(e=1,this.props.trait.uses>0&&(a="; used"));const s=this.props.trait.usage.toLowerCase().match(/(\d+)\s*\/\s*day/);s&&(e=parseInt(s[1],10),this.props.trait.uses>0&&(a="; used "+this.props.trait.uses)),t+=" *("+this.props.trait.usage+a+")*"}"legendary"!==this.props.trait.type&&"mythic"!==this.props.trait.type||(e=1,this.props.trait.uses>0&&(t+=" *(used)*"));const a="**"+t+"** "+this.props.trait.text;switch(this.props.mode){case"view":return n.a.createElement("div",{key:this.props.trait.id,className:"section trait"},n.a.createElement("div",{className:"trait-content",dangerouslySetInnerHTML:{__html:ht.makeHtml(a)}}));case"template":return n.a.createElement("div",{key:this.props.trait.id,className:"section trait trait-template"},n.a.createElement(pt.a,{className:"copy-trait-button",rotate:270,title:"import",onClick:()=>this.props.copyTrait(this.props.trait)}),n.a.createElement("div",{className:"trait-content",dangerouslySetInnerHTML:{__html:ht.makeHtml(a)}}));case"combat":case"legendary":case"lair":let t="";const s=[];e>0&&(this.props.trait.uses>=e?(t="strikethrough",s.push(n.a.createElement("button",{key:"use",className:"link",onClick:()=>this.props.rechargeTrait(this.props.trait)},"recharge"))):s.push(n.a.createElement("button",{key:"use",className:"link",onClick:()=>this.props.useTrait(this.props.trait)},"use"))),this.props.showRollButtons&&(N.getToHitExpressions(this.props.trait).forEach(e=>{s.push(n.a.createElement(ve.a,{content:n.a.createElement("div",null,n.a.createElement("button",{onClick:t=>this.props.onRollDice(this.props.trait.name,1,20,e.bonus,"advantage")},"adv"),n.a.createElement("button",{onClick:t=>this.props.onRollDice(this.props.trait.name,1,20,e.bonus,"disadvantage")},"dis")),trigger:"contextMenu"},n.a.createElement("button",{key:e.expression,className:"link",onClick:()=>this.props.onRollDice(this.props.trait.name,1,20,e.bonus,"")},e.expression)))}),N.getDiceExpressions(this.props.trait).forEach(e=>{s.push(n.a.createElement("button",{key:e.expression,className:"link",onClick:()=>this.props.onRollDice(this.props.trait.name,e.count,e.sides,e.bonus,"")},e.expression))}));let r=null;return s.length>0&&(r=n.a.createElement("div",{className:"trait-buttons"},s)),n.a.createElement("div",{key:this.props.trait.id,className:"section trait"},n.a.createElement("div",{className:t,dangerouslySetInnerHTML:{__html:ht.makeHtml(a)}}),r)}}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}ut.defaultProps={mode:"view",showRollButtons:!1,copyTrait:null,useTrait:null,rechargeTrait:null,onRollDice:null};class gt extends n.a.Component{getAC(){let e=this.props.monster.ac.toString();return this.props.monster.acInfo&&(e+=" ("+this.props.monster.acInfo+")"),e}getHP(){return N.getTypicalHP(this.props.monster)+" ("+N.getTypicalHPString(this.props.monster)+")"}statSection(e,t,a=!1){if(!t)return null;let s=!0,r=null;if(a){let e=t;const a=[];Array.from(t.matchAll(/([^,;:/]*)\s+([+-]?)\s*(\d+)/g)).forEach(t=>{const s=t[0],r=t[2]||"+",i=parseInt(t[3],10)*("+"===r?1:-1);a.push(n.a.createElement(ve.a,{content:n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.onRollDice(s,1,20,i,"advantage")},"adv"),n.a.createElement("button",{onClick:()=>this.props.onRollDice(s,1,20,i,"disadvantage")},"dis")),trigger:"contextMenu"},n.a.createElement("button",{key:s,className:"link",onClick:()=>this.props.onRollDice(s,1,20,i,"")},s))),e=e.replace(s,"")}),s=!!e.match(/[a-zA-Z]/),r=n.a.createElement("div",{className:"roll-buttons"},a)}return n.a.createElement("div",{className:"section"},n.a.createElement("b",null,e)," ",s?t:null,r)}getTags(){const e=[];let t=this.props.monster.size;const a=this.props.monster;a&&(t=a.displaySize||t);let s=(t+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(s+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(n.a.createElement(W.a,{key:"tag-main"},s)),this.props.monster.alignment&&e.push(n.a.createElement(W.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(n.a.createElement(W.a,{key:"tag-cr"},"cr ",f.challenge(this.props.monster.challenge))),e}getStats(){let e=null;const t=this.props.monster;if(null!==t.hpCurrent&&void 0!==t.hpCurrent){var a,s;const r=null!==(a=t.hpCurrent)&&void 0!==a?a:0,i=null!==(s=t.hpTemp)&&void 0!==s?s:0;let o=r.toString();i>0&&(o+="+"+i),e=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement(p.a,null,n.a.createElement(h.a,{span:12},n.a.createElement(lt,{label:"armor class",value:this.props.monster.ac})),n.a.createElement(h.a,{span:12},n.a.createElement(lt,{label:"hit points",value:o}))))}return n.a.createElement("div",{className:"stats"},n.a.createElement($,{source:this.props.monster}),n.a.createElement("div",{className:"section centered"},this.getTags()),e,n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement(ot,{combatant:this.props.monster,showRollButtons:this.props.showRollButtons,onRollDice:(e,t,a,s,n)=>this.props.onRollDice(e,t,a,s,n)})),this.statSection("ac",this.getAC()),this.statSection("hp",this.getHP()),this.statSection("saving throws",this.props.monster.savingThrows,this.props.showRollButtons),this.statSection("skills",this.props.monster.skills,this.props.showRollButtons),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment),n.a.createElement("hr",null),n.a.createElement(mt,{combatant:this.props.monster,mode:this.props.combat?"combat":"view",showRollButtons:this.props.showRollButtons,useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e),onRollDice:(e,t,a,s,n)=>this.props.onRollDice(e,t,a,s,n)}))}render(){try{const e=(this.props.monster?this.props.monster.displayName:null)||this.props.monster.name||"unnamed monster";return n.a.createElement("div",{className:"card monster"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title",title:e},e)),n.a.createElement("div",{className:"card-content"},this.getStats()))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}gt.defaultProps={combat:!1,showRollButtons:!1,useTrait:null,rechargeTrait:null,onRollDice:null};var yt=a(189);class bt extends n.a.Component{getAC(){let e=this.props.monster.ac.toString();return this.props.monster.acInfo&&(e+=" ("+this.props.monster.acInfo+")"),e}getHP(){return N.getTypicalHP(this.props.monster)+" ("+N.getTypicalHPString(this.props.monster)+")"}statSection(e,t){return t?n.a.createElement("div",{className:"section"},n.a.createElement("b",null,e)," ",t):null}getTags(){const e=[];let t=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(t+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(n.a.createElement(W.a,{key:"tag-main"},t)),this.props.monster.alignment&&e.push(n.a.createElement(W.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(n.a.createElement(W.a,{key:"tag-cr"},"cr ",f.challenge(this.props.monster.challenge))),e}getStats(){switch(this.props.section){case"overview":return n.a.createElement("div",null,n.a.createElement($,{source:this.props.monster}),n.a.createElement("div",{className:"section centered"},this.getTags()),n.a.createElement("hr",null),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment));case"abilities":return n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement(ot,{combatant:this.props.monster})),this.statSection("saving throws",this.props.monster.savingThrows),this.statSection("skills",this.props.monster.skills));case"combat":return n.a.createElement("div",null,this.statSection("ac",this.getAC()),this.statSection("hp",this.getHP()),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities));case"features":return n.a.createElement(mt,{combatant:this.props.monster,mode:"template",copyTrait:e=>this.props.copyTrait(e)})}}render(){const e=this.props.monster.name||"unnamed monster";try{return n.a.createElement("div",{className:"card monster"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title",title:e},e),n.a.createElement(yt.a,{onClick:()=>this.props.deselectMonster(this.props.monster)})),n.a.createElement("div",{className:"card-content"},this.getStats(),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.showMonster(this.props.monster)},"show full statblock")))}catch(t){return console.error(t),n.a.createElement(X,{error:t})}}}class Et extends n.a.Component{constructor(e){super(e),this.state={monster:e.monster,page:"overview",sidebarView:"statblock",helpSection:"type",similarFilter:{size:!0,type:!0,subtype:!1,role:!1,alignment:!1,challenge:!0},addingToScratchpad:!1,scratchpadAddMode:"similar",scratchpadFilter:E.createMonsterFilter(),scratchpadList:[],inspectedMonster:null}}setPage(e){const t=this.getHelpOptionsForPage(e);this.setState({page:e,helpSection:t[0]})}recalculateRole(){const e=this.state.monster;e.role=N.getRole(e)}addTrait(e){N.addTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}moveTrait(e,t){const a=this.state.monster.traits.indexOf(e),s=this.state.monster.traits.indexOf(t);N.moveTrait(this.state.monster,a,s),this.recalculateRole(),this.setState({monster:this.state.monster})}copyTrait(e){N.copyTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster,page:"features"})}changeTrait(e,t,a){e[t]=a,this.recalculateRole(),this.setState({monster:this.state.monster})}deleteTrait(e){N.removeTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}changeValue(e,t){N.changeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}nudgeValue(e,t){N.nudgeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}setHelpSection(e){this.setState({helpSection:e})}toggleMatch(e){const t=this.state.similarFilter;t[e]=!t[e],this.setState({similarFilter:t})}addToScratchpad(e){const t=this.state.scratchpadList;t.push(e),b.sort(t),this.setState({scratchpadList:t})}removeFromScratchpad(e){const t=this.state.scratchpadList.indexOf(e);this.state.scratchpadList.splice(t,1),this.setState({scratchpadList:this.state.scratchpadList})}addAllToScratchpad(e){const t=this.state.scratchpadList;e.forEach(e=>t.push(e)),b.sort(t),this.setState({scratchpadList:t})}clearScratchpad(){this.setState({scratchpadList:[]})}spliceMonsters(){N.spliceMonsters(this.state.monster,this.state.scratchpadList),this.recalculateRole(),this.setState({monster:this.state.monster})}getHelpOptionsForPage(e){switch(e){case"overview":return["type","subtype","align","challenge","size","speed","senses","lang","equip"];case"abilities":return["str","dex","con","int","wis","cha","saves","skills"];case"combat":return["armor class","hit dice","resist","vulnerable","immune","conditions"];case"features":return["features"]}return[]}getSimilarMonsters(){const e=[];return this.props.library.forEach(t=>{t.monsters.forEach(t=>{let a=!0;this.state.monster.id===t.id&&(a=!1),this.state.similarFilter.size&&this.state.monster.size!==t.size&&(a=!1),this.state.similarFilter.type&&this.state.monster.category!==t.category&&(a=!1),this.state.similarFilter.subtype&&this.state.monster.tag!==t.tag&&(a=!1),this.state.similarFilter.role&&this.state.monster.role!==t.role&&(a=!1),this.state.similarFilter.alignment&&this.state.monster.alignment!==t.alignment&&(a=!1),this.state.similarFilter.challenge&&this.state.monster.challenge!==t.challenge&&(a=!1),a&&e.push(t)})}),e}setRandomValue(e){N.setRandomValue(this.state.monster,e,this.state.scratchpadList),this.recalculateRole(),this.setState({monster:this.state.monster})}addRandomTrait(e){N.addRandomTrait(this.state.monster,e,this.state.scratchpadList),this.recalculateRole(),this.setState({monster:this.state.monster})}changeFilterValue(e,t){const a=this.state.scratchpadFilter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({scratchpadFilter:a})}resetFilter(){this.setState({scratchpadFilter:E.createMonsterFilter()})}matchMonster(e){return M.matchMonster(e,this.state.scratchpadFilter)}getHelpSection(){switch(this.state.helpSection){case"type":return this.getValueSection("category","text");case"subtype":return this.getValueSection("tag","text");case"align":return this.getValueSection("alignment","text");case"challenge":return this.getValueSection("challenge","number");case"size":return this.getValueSection("size","text");case"speed":return this.getValueSection("speed","text");case"senses":return this.getValueSection("senses","text");case"lang":return this.getValueSection("languages","text");case"equip":return this.getValueSection("equipment","text");case"str":return this.getValueSection("abilityScores.str","number");case"dex":return this.getValueSection("abilityScores.dex","number");case"con":return this.getValueSection("abilityScores.con","number");case"int":return this.getValueSection("abilityScores.int","number");case"wis":return this.getValueSection("abilityScores.wis","number");case"cha":return this.getValueSection("abilityScores.cha","number");case"saves":return this.getValueSection("savingThrows","text");case"skills":return this.getValueSection("skills","text");case"armor class":return this.getValueSection("ac","number");case"hit dice":return this.getValueSection("hitDice","number");case"resist":return this.getValueSection("damage.resist","text");case"vulnerable":return this.getValueSection("damage.vulnerable","text");case"immune":return this.getValueSection("damage.immune","text");case"conditions":return this.getValueSection("conditionImmunities","text");case"features":return this.getFeaturesSection();default:return null}}getValueSection(e,t){const a=this.state.scratchpadList.map(a=>{const s=e.split(".");let n=a,r=null;return s.forEach(e=>{e===s[s.length-1]?r=n[e]:n=n[e]}),"text"===t&&""===r&&(r=null),r}).filter(e=>null!==e),s=[];if("number"===t){let e=null,t=null;if(a.forEach(a=>{(null===e||a<e)&&(e=a),(null===t||a>t)&&(t=a)}),null!==e&&null!==t)for(let a=e;a<=t;++a)s.push({value:a,count:0})}switch(a.forEach(e=>{const t=s.find(t=>t.value===e);t?t.count+=1:s.push({value:e,count:1})}),t){case"number":b.sort(s,[{field:"value",dir:"asc"}]);break;case"text":b.sort(s,[{field:"count",dir:"desc"},{field:"value",dir:"asc"}])}if("text"===t){0!==this.state.scratchpadList.length-a.length&&s.push({value:"",count:this.state.scratchpadList.length-a.length})}const r=s.map(t=>{const a=100*t.count/this.state.scratchpadList.length;return n.a.createElement(p.a,{gutter:10,className:"value-list",key:s.indexOf(t)},n.a.createElement(h.a,{span:8,className:"text-container"},t.value||"(none specified)"),n.a.createElement(h.a,{span:8,className:"bar-container"},n.a.createElement("div",{className:"bar",style:{width:a+"%"}})),n.a.createElement(h.a,{span:8},n.a.createElement("button",{onClick:()=>this.changeValue(e,t.value)},"use this value")))});return n.a.createElement("div",null,r,n.a.createElement("button",{onClick:()=>this.setRandomValue(e)},"select random value"))}getFeaturesSection(){const e=[];return e.push(n.a.createElement(p.a,{gutter:10,className:"value-list",key:"header"},n.a.createElement(h.a,{span:8,className:"text-container"},n.a.createElement("b",null,"type")),n.a.createElement(h.a,{span:4,className:"text-container number"},n.a.createElement("b",null,"avg")),n.a.createElement(h.a,{span:4,className:"text-container number"},n.a.createElement("b",null,"min - max")))),C.forEach(t=>{let a=null,s=null,r=0;this.state.scratchpadList.forEach(e=>{const n=e.traits.filter(e=>e.type===t).length;(null===a||n<a)&&(a=n),(null===s||n>s)&&(s=n),r+=n});const i=Math.round(r/this.state.scratchpadList.length);e.push(n.a.createElement(p.a,{gutter:10,className:"value-list",key:t},n.a.createElement(h.a,{span:8,className:0===r?"text-container disabled":"text-container"},f.traitType(t,!0)),n.a.createElement(h.a,{span:4,className:0===r?"text-container number disabled":"text-container number"},i),n.a.createElement(h.a,{span:4,className:0===r?"text-container number disabled":"text-container number"},a," - ",s),n.a.createElement(h.a,{span:8},n.a.createElement("button",{className:0===r?"disabled":"",onClick:()=>this.addRandomTrait(t)},"add random"))))}),n.a.createElement("div",null,e)}getScratchpad(){let e=null;if(this.state.scratchpadList.length>0){const t=b.sort(this.state.scratchpadList).map(e=>n.a.createElement("div",{className:"section",key:e.id},n.a.createElement(bt,{monster:e,section:this.state.page,copyTrait:e=>this.copyTrait(e),deselectMonster:e=>this.removeFromScratchpad(e),showMonster:e=>this.setState({inspectedMonster:e})})));let a=null;this.getHelpOptionsForPage(this.state.page).length>1&&(a=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"select a one of the following fields to see its values from your scratchpad monsters")),n.a.createElement(pe,{options:this.getHelpOptionsForPage(this.state.page).map(e=>({id:e,text:e})),selectedID:this.state.helpSection,onSelect:e=>this.setHelpSection(e)}))),e=n.a.createElement("div",null,n.a.createElement(oe,{text:"scratchpad list"},n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.setState({addingToScratchpad:!0})},"add monsters to list")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{className:0===this.state.scratchpadList.length?"disabled":"",onClick:()=>this.clearScratchpad()},"clear list"))),t),n.a.createElement("div",{className:"monster-help"},a,this.getHelpSection()))}else e=n.a.createElement("button",{onClick:()=>this.setState({addingToScratchpad:!0})},"add monsters to your scratchpad list");return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"this is your scratchpad list; you can add monsters to it to see their combined statistics"),n.a.createElement("div",{className:"section"},"you might find this useful if, for example, you want your monster to have similar abilities to other monsters"),n.a.createElement("div",{className:"section",style:{display:this.state.scratchpadList.length<2?"none":""}},"or you can ",n.a.createElement("button",{className:"link",onClick:()=>this.spliceMonsters()},"splice these monsters together")," to create a unique hyrid monster")),e)}getContent(){switch(this.state.page){case"overview":return n.a.createElement(ft,{monster:this.state.monster,changeValue:(e,t)=>this.changeValue(e,t),nudgeValue:(e,t)=>this.nudgeValue(e,t)});case"abilities":return n.a.createElement(vt,{monster:this.state.monster,changeValue:(e,t)=>this.changeValue(e,t),nudgeValue:(e,t)=>this.nudgeValue(e,t)});case"combat":return n.a.createElement(wt,{monster:this.state.monster,changeValue:(e,t)=>this.changeValue(e,t),nudgeValue:(e,t)=>this.nudgeValue(e,t)});case"features":return n.a.createElement(kt,{monster:this.state.monster,addTrait:e=>this.addTrait(e),copyTrait:e=>this.copyTrait(e),moveTrait:(e,t)=>this.moveTrait(e,t),deleteTrait:e=>this.deleteTrait(e),changeValue:(e,t,a)=>this.changeTrait(e,t,a)})}return null}getSidebar(){switch(this.state.sidebarView){case"statblock":return n.a.createElement(gt,{monster:this.state.monster});case"guidelines":return n.a.createElement(Nt,{monster:this.state.monster});case"scratchpad":return this.getScratchpad();case"features":return n.a.createElement(St,{monster:this.state.monster,library:this.props.library,copyTrait:e=>this.copyTrait(e)})}return null}getDrawer(){const e={visible:!1,title:"drawer",content:null,footer:null,onClose:()=>null};if(e.footer=n.a.createElement("button",{onClick:()=>e.onClose()},"close"),this.state.inspectedMonster&&(e.visible=!0,e.title="monster",e.content=n.a.createElement("div",{className:"scrollable padded"},n.a.createElement(gt,{monster:this.state.inspectedMonster})),e.onClose=()=>{this.setState({inspectedMonster:null})}),this.state.addingToScratchpad){const t=[{id:"similar",text:"similar monsters"},{id:"all",text:"all monsters"}];let a=null;switch(this.state.scratchpadAddMode){case"similar":a=n.a.createElement(oe,{text:"similarity criteria"},n.a.createElement(te,{label:"size "+this.state.monster.size,checked:this.state.similarFilter.size,onChecked:e=>this.toggleMatch("size")}),n.a.createElement(te,{label:"type "+this.state.monster.category,checked:this.state.similarFilter.type,onChecked:e=>this.toggleMatch("type")}),n.a.createElement(te,{label:this.state.monster.tag?"subtype "+this.state.monster.tag:"subtype",checked:this.state.similarFilter.subtype,disabled:!this.state.monster.tag,onChecked:e=>this.toggleMatch("subtype")}),n.a.createElement(te,{label:this.state.monster.role?"role "+this.state.monster.role:"role",checked:this.state.similarFilter.role,disabled:!this.state.monster.role,onChecked:e=>this.toggleMatch("role")}),n.a.createElement(te,{label:this.state.monster.alignment?"alignment "+this.state.monster.alignment:"alignment",checked:this.state.similarFilter.alignment,disabled:!this.state.monster.alignment,onChecked:e=>this.toggleMatch("alignment")}),n.a.createElement(te,{label:"challenge rating "+f.challenge(this.state.monster.challenge),checked:this.state.similarFilter.challenge,onChecked:e=>this.toggleMatch("challenge")}));break;case"all":a=n.a.createElement(ue,{filter:this.state.scratchpadFilter,changeValue:(e,t)=>this.changeFilterValue(e,t),resetFilter:()=>this.resetFilter()})}let s=[];switch(this.state.scratchpadAddMode){case"similar":s=this.getSimilarMonsters();break;case"all":this.props.library.forEach(e=>{e.monsters.forEach(e=>{!s.includes(e)&&this.matchMonster(e)&&s.push(e)})})}s=s.filter(e=>!this.state.scratchpadList.find(t=>t.id===e.id));const r=b.sort(s).map(e=>n.a.createElement("div",{className:"section",key:e.id},n.a.createElement(ee,{monster:e,selectMonster:e=>this.addToScratchpad(e)})));let i=null;0===s.length&&(i=n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"there are no monsters in your library which match the above criteria (or they are all in your scratchpad already)"))),e.visible=!0,e.title="add to scratchpad",e.content=n.a.createElement("div",{className:"scrollable padded"},n.a.createElement(Te,{options:t,selectedID:this.state.scratchpadAddMode,onSelect:e=>this.setState({scratchpadAddMode:e})}),a,n.a.createElement("button",{className:0===s.length?"disabled":"",onClick:()=>this.addAllToScratchpad(s)},"add all to scratchpad"),n.a.createElement("hr",null),r,i),e.onClose=()=>{this.setState({addingToScratchpad:!1})}}return e}render(){try{const e=this.getContent(),t=this.getSidebar(),a=this.getDrawer();return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Te,{options:["overview","abilities","combat","features"].map(e=>({id:e,text:e})),selectedID:this.state.page,onSelect:e=>this.setPage(e)}),e),n.a.createElement(h.a,{span:12,className:"scrollable sidebar sidebar-right"},n.a.createElement(Te,{options:["statblock","guidelines","scratchpad","features"].map(e=>({id:e,text:e})),selectedID:this.state.sidebarView,onSelect:e=>this.setState({sidebarView:e})}),t),n.a.createElement(m.a,{className:this.props.options.theme,closable:!1,maskClosable:!0,width:"30%",visible:a.visible,onClose:()=>a.onClose()},n.a.createElement("div",{className:"drawer-header"},n.a.createElement("div",{className:"app-title"},a.title)),n.a.createElement("div",{className:"drawer-content"},a.content),n.a.createElement("div",{className:"drawer-footer"},a.footer)))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ft extends n.a.Component{randomName(){const e=D.capitalise(D.generateName());this.props.changeValue("name",e)}render(){try{return n.a.createElement(p.a,{gutter:10,key:"overview"},n.a.createElement(h.a,{span:24},n.a.createElement("div",{className:"subheading"},"name"),n.a.createElement("div",{className:"control-with-icons"},n.a.createElement(_,{text:this.props.monster.name,onChange:e=>this.props.changeValue("name",e)}),n.a.createElement("div",{className:"icons"},n.a.createElement(nt.a,{onClick:()=>this.randomName(),title:"generate a random name"}))),n.a.createElement("div",{className:"subheading"},"type"),n.a.createElement(pe,{options:k.map(e=>({id:e,text:e})),selectedID:this.props.monster.category,itemsPerRow:5,onSelect:e=>this.props.changeValue("category",e)})),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"subheading"},"subtype"),n.a.createElement(_,{text:this.props.monster.tag,placeholder:"none",onChange:e=>this.props.changeValue("tag",e)}),n.a.createElement("div",{className:"subheading"},"alignment"),n.a.createElement(_,{text:this.props.monster.alignment,onChange:e=>this.props.changeValue("alignment",e)}),n.a.createElement("div",{className:"subheading"},"challenge rating"),n.a.createElement(de,{value:f.challenge(this.props.monster.challenge),downEnabled:this.props.monster.challenge>0,onNudgeValue:e=>this.props.nudgeValue("challenge",e)}),n.a.createElement("div",{className:"subheading"},"size"),n.a.createElement(de,{value:this.props.monster.size,downEnabled:"tiny"!==this.props.monster.size,upEnabled:"gargantuan"!==this.props.monster.size,onNudgeValue:e=>this.props.nudgeValue("size",e)}),n.a.createElement("div",{className:"subheading"},"speed"),n.a.createElement(_,{text:this.props.monster.speed,onChange:e=>this.props.changeValue("speed",e)})),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"subheading"},"senses"),n.a.createElement(_,{text:this.props.monster.senses,onChange:e=>this.props.changeValue("senses",e)}),n.a.createElement("div",{className:"subheading"},"languages"),n.a.createElement(_,{text:this.props.monster.languages,onChange:e=>this.props.changeValue("languages",e)}),n.a.createElement("div",{className:"subheading"},"equipment"),n.a.createElement(_,{text:this.props.monster.equipment,onChange:e=>this.props.changeValue("equipment",e)}),n.a.createElement("div",{className:"subheading"},"portrait"),n.a.createElement($,{source:this.props.monster,setPortrait:e=>this.props.changeValue("portrait",e),clear:()=>this.props.changeValue("portrait","")})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class vt extends n.a.Component{render(){try{return n.a.createElement(p.a,{gutter:10,key:"abilities"},n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"subheading"},"ability scores"),n.a.createElement(ot,{edit:!0,combatant:this.props.monster,onNudgeValue:(e,t,a)=>this.props.nudgeValue(t,a)})),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"subheading"},"saving throws"),n.a.createElement(_,{text:this.props.monster.savingThrows,onChange:e=>this.props.changeValue("savingThrows",e)}),n.a.createElement("div",{className:"subheading"},"skills"),n.a.createElement(_,{text:this.props.monster.skills,onChange:e=>this.props.changeValue("skills",e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class wt extends n.a.Component{render(){try{return n.a.createElement(p.a,{gutter:10,key:"combat"},n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"subheading"},"armor class"),n.a.createElement(de,{value:this.props.monster.ac,downEnabled:this.props.monster.ac>0,onNudgeValue:e=>this.props.nudgeValue("ac",e)}),n.a.createElement("div",{className:"subheading"},"armor type"),n.a.createElement(_,{text:this.props.monster.acInfo,onChange:e=>this.props.changeValue("acInfo",e)}),n.a.createElement("div",{className:"subheading"},"hit dice"),n.a.createElement(de,{value:this.props.monster.hitDice,downEnabled:this.props.monster.hitDice>1,onNudgeValue:e=>this.props.nudgeValue("hitDice",e)}),n.a.createElement(Le,null,n.a.createElement("p",null,"to calculate hit points, the die type is based on the monster's size, and the die roll is modified by the monster's constitution modifier"),n.a.createElement("hr",null),n.a.createElement("div",{className:"hp-value"},N.getTypicalHP(this.props.monster)+" hp ("+N.getTypicalHPString(this.props.monster)+")"))),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"subheading"},"damage resistances"),n.a.createElement(_,{text:this.props.monster.damage.resist,onChange:e=>this.props.changeValue("damage.resist",e)}),n.a.createElement("div",{className:"subheading"},"damage vulnerabilities"),n.a.createElement(_,{text:this.props.monster.damage.vulnerable,onChange:e=>this.props.changeValue("damage.vulnerable",e)}),n.a.createElement("div",{className:"subheading"},"damage immunities"),n.a.createElement(_,{text:this.props.monster.damage.immune,onChange:e=>this.props.changeValue("damage.immune",e)}),n.a.createElement("div",{className:"subheading"},"condition immunities"),n.a.createElement(_,{text:this.props.monster.conditionImmunities,onChange:e=>this.props.changeValue("conditionImmunities",e)}),n.a.createElement("div",{className:"subheading"},"legendary actions"),n.a.createElement(de,{value:this.props.monster.legendaryActions,downEnabled:this.props.monster.legendaryActions>0,onNudgeValue:e=>this.props.nudgeValue("legendaryActions",e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class kt extends n.a.Component{constructor(e){super(e),this.state={selectedTraitID:null}}setSelectedTraitID(e){this.setState({selectedTraitID:e})}createSection(e,t){const a=e[t];return n.a.createElement("div",null,n.a.createElement("div",{className:"trait-header-bar"},n.a.createElement("div",{className:"subheading"},f.traitType(t,!0)),n.a.createElement(Y.a,{title:"add",onClick:()=>this.props.addTrait(t)})),n.a.createElement(it.List,{values:a,lockVertically:!0,onChange:({oldIndex:e,newIndex:t})=>this.props.moveTrait(a[e],a[t]),renderList:({children:e,props:t})=>n.a.createElement("div",t,e),renderItem:({value:e,props:t,isDragged:a})=>n.a.createElement("div",Object.assign({},t,{className:a?"dragged":""}),n.a.createElement(xt,{key:e.id,trait:e,isSelected:e.id===this.state.selectedTraitID,select:e=>this.setSelectedTraitID(e)}))}))}render(){try{const e=[],t={};C.forEach(a=>{e.push({id:a,text:f.traitType(a,!1)}),t[a]=this.props.monster.traits.filter(e=>e.type===a)});const a=this.props.monster.traits.find(e=>e.id===this.state.selectedTraitID);let s=null;return s=a?n.a.createElement(Ct,{trait:a,copyTrait:e=>this.props.copyTrait(e),deleteTrait:e=>this.props.deleteTrait(e),changeValue:(e,t,a)=>this.props.changeValue(e,t,a)}):n.a.createElement(Le,null,"select one of the features from the column to the left to edit its details here"),n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:8},this.createSection(t,"trait"),this.createSection(t,"action"),this.createSection(t,"bonus"),this.createSection(t,"reaction"),this.createSection(t,"legendary"),this.createSection(t,"mythic"),this.createSection(t,"lair")),n.a.createElement(h.a,{span:16},s))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class xt extends n.a.Component{render(){try{return n.a.createElement("div",{className:this.props.isSelected?"trait-bar selected":"trait-bar",onClick:()=>this.props.select(this.props.trait.id),role:"button"},n.a.createElement("div",{className:"name"},this.props.trait.name||"unnamed "+f.traitType(this.props.trait.type,!1)),n.a.createElement(rt.a,{className:"grabber","data-movable-handle":!0}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ct extends n.a.Component{render(){try{const e=C.map(e=>({id:e,text:e}));return e.forEach(e=>{"reaction"===e.id&&(e.text="react"),"legendary"===e.id&&(e.text="legend")}),n.a.createElement("div",{key:this.props.trait.id,className:"section"},n.a.createElement(pe,{options:e,selectedID:this.props.trait.type,itemsPerRow:4,onSelect:e=>this.props.changeValue(this.props.trait,"type",e)}),n.a.createElement("hr",null),n.a.createElement("div",{className:"subheading"},"feature name"),n.a.createElement(_,{text:this.props.trait.name,onChange:e=>this.props.changeValue(this.props.trait,"name",e)}),n.a.createElement("div",{className:"subheading"},"usage"),n.a.createElement(_,{text:this.props.trait.usage,onChange:e=>this.props.changeValue(this.props.trait,"usage",e)}),n.a.createElement("div",{className:"subheading"},"details"),n.a.createElement(_,{text:this.props.trait.text,placeholder:"details",multiLine:!0,onChange:e=>this.props.changeValue(this.props.trait,"text",e)}),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.copyTrait(this.props.trait)},"create a copy of this feature"),n.a.createElement(Ce,{text:"delete this feature",onConfirm:()=>this.props.deleteTrait(this.props.trait)}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Nt extends n.a.Component{render(){try{const e=f.challengeDetails();let t=1;this.props.monster.damage.immune?t=this.props.monster.challenge<11?2:this.props.monster.challenge<17?1.5:1.25:this.props.monster.damage.resist&&(t=this.props.monster.challenge<5?2:this.props.monster.challenge<11?1.5:this.props.monster.challenge<17?1.25:1);const a=N.getTypicalHP(this.props.monster)*t;let s=[],r=[];this.props.monster.traits.forEach(e=>{r=r.concat(N.getToHitExpressions(e).map(e=>e.bonus)),s=s.concat(N.getSaveExpressions(e).map(e=>e.dc))});const i=Math.min(...r),o=Math.max(...r),l=Math.min(...s),c=Math.max(...s);return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"this table shows typical values for certain stats (ac, hp, etc) for a given challenge rating"),n.a.createElement("p",null,"to gauge a monster's cr, take the average of its defensive cr (from ac and hp) and offensive cr (from attack bonus, save dc, and damage per round)")),n.a.createElement("div",{className:"table alternating"},n.a.createElement(p.a,{className:"table-row table-row-header"},n.a.createElement(h.a,{span:4,className:"table-cell"},"cr"),n.a.createElement(h.a,{span:4,className:"table-cell"},"ac"),n.a.createElement(h.a,{span:4,className:"table-cell"},"effective hp"),n.a.createElement(h.a,{span:4,className:"table-cell"},"attack bonus"),n.a.createElement(h.a,{span:4,className:"table-cell"},"save dc"),n.a.createElement(h.a,{span:4,className:"table-cell"},"dmg / rnd")),e.map(e=>{const t=e.cr===this.props.monster.challenge,s=e.ac===this.props.monster.ac,r=e.hpMin<=a&&e.hpMax>=a,d=i<=e.attack&&o>=e.attack,m=l<=e.save&&c>=e.save;return n.a.createElement(p.a,{key:e.cr,className:"table-row"},n.a.createElement(h.a,{span:4,className:t?"table-cell table-cell-highlight":"table-cell"},f.challenge(e.cr)),n.a.createElement(h.a,{span:4,className:s?"table-cell table-cell-highlight":"table-cell"},e.ac),n.a.createElement(h.a,{span:4,className:r?"table-cell table-cell-highlight":"table-cell"},e.hpMin," - ",e.hpMax),n.a.createElement(h.a,{span:4,className:d?"table-cell table-cell-highlight":"table-cell"},"+",e.attack),n.a.createElement(h.a,{span:4,className:m?"table-cell table-cell-highlight":"table-cell"},e.save),n.a.createElement(h.a,{span:4,className:"table-cell"},e.dmgMin," - ",e.dmgMax))})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class St extends n.a.Component{constructor(e){super(e),this.state={mode:"search",query:"",randomTraits:[]}}chooseRandomTraits(){const e=[];this.props.library.forEach(t=>{t.monsters.forEach(t=>{t.id!==this.props.monster.id&&t.traits.forEach(t=>{e.push(t)})})});const t=[];for(;t.length<10;){const a=b.randomNumber(e.length);t.push(e[a]),e.splice(a,1)}b.sort(t),this.setState({randomTraits:t})}getSearchSection(){const e=[];this.state.query.length>=2&&(this.props.library.forEach(t=>{t.monsters.forEach(t=>{t.id!==this.props.monster.id&&t.traits.forEach(t=>{I.matchTrait(this.state.query,t)&&e.push(t)})})}),b.sort(e));let t=null;if(""!==this.state.query)if(0===e.length)t=n.a.createElement(Le,null,n.a.createElement("p",null,"no features found"));else{const a={};C.forEach(t=>{a[t]=e.filter(e=>e.type===t).map(e=>n.a.createElement("div",{className:"card monster",key:e.id},n.a.createElement(ut,{trait:e,mode:"template",copyTrait:e=>this.props.copyTrait(e)})))}),t=C.map(e=>a[e].length>0?n.a.createElement("div",{key:e},n.a.createElement("div",{className:"subheading"},f.traitType(e,!0)),a[e]):null)}return n.a.createElement("div",null,n.a.createElement(_,{text:this.state.query,placeholder:"search for features...",onChange:e=>this.setState({query:e})}),t?n.a.createElement("hr",null):null,t)}getRandomSection(){const e={};C.forEach(t=>{e[t]=this.state.randomTraits.filter(e=>e.type===t).map(e=>n.a.createElement("div",{className:"card monster",key:e.id},n.a.createElement(ut,{trait:e,mode:"template",copyTrait:e=>this.props.copyTrait(e)})))});const t=C.map(t=>e[t].length>0?n.a.createElement("div",{key:t},n.a.createElement("div",{className:"subheading"},f.traitType(t,!0)),e[t]):null);return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.chooseRandomTraits()},"select random features"),t)}render(){let e=null;switch(this.state.mode){case"search":e=this.getSearchSection();break;case"random":e=this.getRandomSection()}return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"here you can look for features from other monsters in your library, either for inspiration or to copy directly into your monster")),n.a.createElement(pe,{options:["search","random"].map(e=>({id:e,text:e})),selectedID:this.state.mode,onSelect:e=>this.setState({mode:e})}),e)}}class It extends n.a.Component{constructor(e){super(e),this.state={pc:e.pc}}addCompanion(){const e=E.createCompanion();this.state.pc.companions.push(e),this.setState({pc:this.state.pc})}removeCompanion(e){const t=this.state.pc;t.companions=this.state.pc.companions.filter(t=>t.id!==e),this.setState({pc:t})}changeValue(e,t,a){e[t]=a,this.setState({pc:this.state.pc})}nudgeValue(e,t,a){const s=e[t];let n;switch(t){case"size":n=f.nudgeSize(s,a);break;default:n=(s||0)+a}this.changeValue(e,t,n)}render(){try{const e=[];this.props.library.forEach(t=>{t.monsters.forEach(t=>{e.push({id:t.id,text:t.name})})}),b.sort(e,[{field:"text",dir:"asc"}]);const t=this.state.pc.companions.map(t=>n.a.createElement("div",{className:"group-panel companion-list-item",key:t.id},n.a.createElement("div",{className:"companion-fields"},n.a.createElement(_,{text:t.name,onChange:e=>this.changeValue(t,"name",e)}),n.a.createElement(se,{options:e,placeholder:"select a stat block",selectedID:t.monsterID||void 0,onSelect:e=>this.changeValue(t,"monsterID",e),onClear:()=>this.changeValue(t,"monsterID",null)})),n.a.createElement("div",{className:"companion-actions"},n.a.createElement(ge.a,{onClick:()=>this.removeCompanion(t.id)}))));return 0===t.length&&t.push(n.a.createElement("div",{className:"section",key:"empty"},n.a.createElement("i",null,"no companions (pets, retainers, mounts, etc)"))),n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable padded"},n.a.createElement("div",{className:"subheading"},"character name"),n.a.createElement(_,{text:this.state.pc.name,onChange:e=>this.changeValue(this.state.pc,"name",e)}),n.a.createElement("div",{className:"subheading"},"player name"),n.a.createElement(_,{text:this.state.pc.player,onChange:e=>this.changeValue(this.state.pc,"player",e)}),n.a.createElement("div",{className:"subheading"},"size"),n.a.createElement(de,{value:this.state.pc.size,downEnabled:"tiny"!==this.state.pc.size,upEnabled:"gargantuan"!==this.state.pc.size,onNudgeValue:e=>this.nudgeValue(this.state.pc,"size",e)}),n.a.createElement("div",{className:"subheading"},"race"),n.a.createElement(_,{text:this.state.pc.race,onChange:e=>this.changeValue(this.state.pc,"race",e)}),n.a.createElement("div",{className:"subheading"},"class"),n.a.createElement(_,{text:this.state.pc.classes,onChange:e=>this.changeValue(this.state.pc,"classes",e)}),n.a.createElement("div",{className:"subheading"},"level"),n.a.createElement(de,{value:this.state.pc.level,downEnabled:this.state.pc.level>1,upEnabled:this.state.pc.level<20,onNudgeValue:e=>this.nudgeValue(this.state.pc,"level",e)}),n.a.createElement("div",{className:"subheading"},"passive skills"),n.a.createElement(de,{value:this.state.pc.passiveInsight,label:"insight",downEnabled:this.state.pc.passiveInsight>0,onNudgeValue:e=>this.nudgeValue(this.state.pc,"passiveInsight",e)}),n.a.createElement(de,{value:this.state.pc.passiveInvestigation,label:"investigation",downEnabled:this.state.pc.passiveInvestigation>0,onNudgeValue:e=>this.nudgeValue(this.state.pc,"passiveInvestigation",e)}),n.a.createElement(de,{value:this.state.pc.passivePerception,label:"perception",downEnabled:this.state.pc.passivePerception>0,onNudgeValue:e=>this.nudgeValue(this.state.pc,"passivePerception",e)})),n.a.createElement(h.a,{span:12,className:"scrollable padded"},n.a.createElement("div",{className:"subheading"},"darkvision"),n.a.createElement(de,{value:this.state.pc.darkvision+" ft",downEnabled:this.state.pc.darkvision>0,onNudgeValue:e=>this.nudgeValue(this.state.pc,"darkvision",10*e)}),n.a.createElement("div",{className:"subheading"},"languages"),n.a.createElement(_,{text:this.state.pc.languages,onChange:e=>this.changeValue(this.state.pc,"languages",e)}),n.a.createElement("div",{className:"subheading"},"d&d beyond link"),n.a.createElement(_,{text:this.state.pc.url,placeholder:"https://ddb.ac/characters/...",onChange:e=>this.changeValue(this.state.pc,"url",e)}),n.a.createElement("div",{className:"subheading"},"portrait"),n.a.createElement($,{source:this.state.pc,setPortrait:e=>this.changeValue(this.state.pc,"portrait",e),clear:()=>this.changeValue(this.state.pc,"portrait","")}),n.a.createElement("div",{className:"subheading"},"companions"),t,n.a.createElement("button",{onClick:()=>this.addCompanion()},"add a new companion")))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Mt extends n.a.Component{constructor(e){super(e),this.state={images:S.allImages(),filter:""}}setFilter(e){this.setState({filter:e})}readFile(e){const t=new FileReader;return t.onload=t=>{if(t.target)try{const a=t.target.result;S.saveImage(b.guid(),e.name,a),this.setState({images:S.allImages()})}catch(a){d.a.open({message:"can't upload this image",description:"not enough storage space; try reducing the resolution or removing unused images",closeIcon:n.a.createElement(c.a,null),duration:5})}},t.readAsDataURL(e),!1}render(){try{const e=this.state.images.filter(e=>I.match(this.state.filter,e.name)).map(e=>n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"subheading"},e.name),n.a.createElement("img",{className:"section selectable-image",src:e.data,alt:e.name,onClick:()=>this.props.select?this.props.select(e.id):null})));return 0===e.length&&e.push(n.a.createElement(Le,{key:"empty"},"no images")),this.state.images.length>0&&e.unshift(n.a.createElement(_,{key:"search",text:this.state.filter,placeholder:"search for an image",onChange:e=>this.setFilter(e)})),n.a.createElement("div",{className:"scrollable"},n.a.createElement("div",null,n.a.createElement(Q.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"),n.a.createElement("p",{className:"ant-upload-text"},"try to upload small images if possible"))),e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Dt extends n.a.Component{constructor(e){super(e),this.state={mode:"link",map:e.map,imageLink:null,imageID:null,size:0,square:0,imageDimensions:{width:0,height:0},mapDimensions:{width:10,height:10}}}readFile(e){const t=new FileReader;return t.onload=t=>{if(t.target){const s=t.target.result;this.state.imageID&&window.localStorage.removeItem("image-"+this.state.imageID);try{const t={id:b.guid(),name:e.name,data:s},a=JSON.stringify(t);window.localStorage.setItem("image-"+t.id,a);const n=new Image;n.onload=()=>{const e=Math.round(Math.min(n.width,n.height)/10);this.setState({imageID:t.id,size:s.length,square:e,imageDimensions:{width:n.width,height:n.height},mapDimensions:{width:Math.round(n.width/e),height:Math.round(n.height/e)}},()=>{this.updateMap(t.name)})},n.src=s}catch(a){d.a.open({message:"can't upload this image",description:"not enough storage space for this image ("+b.toData(s.length)+"); try reducing the resolution or removing unused images",closeIcon:n.a.createElement(c.a,null),duration:5})}}},t.readAsDataURL(e),!1}nudgeSquare(e){const t=Math.max(0,this.state.square+e);this.setState({square:t,mapDimensions:{width:Math.round(this.state.imageDimensions.width/t),height:Math.round(this.state.imageDimensions.height/t)}},()=>{this.updateMap(null)})}nudgeWidth(e){const t=Math.max(0,this.state.mapDimensions.width+e);this.setState({mapDimensions:{width:t,height:this.state.mapDimensions.height}},()=>{this.updateMap(null)})}nudgeHeight(e){const t=Math.max(0,this.state.mapDimensions.height+e);this.setState({mapDimensions:{width:this.state.mapDimensions.width,height:t}},()=>{this.updateMap(null)})}updateMap(e){const t=this.state.map;if(e&&(t.name=e),this.state.imageLink){const e=E.createMapItem();e.type="tile",e.terrain="link",e.customLink=this.state.imageLink,e.width=this.state.mapDimensions.width,e.height=this.state.mapDimensions.height,t.items=[e]}else if(this.state.imageID){const e=E.createMapItem();e.type="tile",e.terrain="custom",e.customBackground=this.state.imageID,e.width=this.state.mapDimensions.width,e.height=this.state.mapDimensions.height,t.items=[e]}else t.items=[];this.setState({map:t})}render(){var e;try{let t=null;switch(this.state.mode){case"link":t=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"enter the address, name, and dimensions of the image you want to use")),n.a.createElement("div",{className:"subheading"},"address"),n.a.createElement(_,{text:null!==(e=this.state.imageLink)&&void 0!==e?e:"",placeholder:"https://...",onChange:e=>this.setState({imageLink:e},()=>this.updateMap(this.state.map.name))}),n.a.createElement("div",{className:"subheading"},"map name"),n.a.createElement(_,{text:this.state.map.name,placeholder:"map name",onChange:e=>this.updateMap(e)}),n.a.createElement("div",{className:"subheading"},"map dimensions"),n.a.createElement(de,{value:this.state.mapDimensions.width+" sq",label:"width",downEnabled:this.state.mapDimensions.width>1,onNudgeValue:e=>this.nudgeWidth(e)}),n.a.createElement(de,{value:this.state.mapDimensions.height+" sq",label:"height",downEnabled:this.state.mapDimensions.height>1,onNudgeValue:e=>this.nudgeHeight(e)}));break;case"upload":t=this.state.imageID?n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"this image is ",b.toData(this.state.size)),n.a.createElement("div",{className:"section"},"set the name and dimensions of this map image"),n.a.createElement("div",{className:"section"},"changing the size of a map square, in pixels, will change the map's dimensions"),n.a.createElement("div",{className:"section"},"you can then fine-tune the exact width and height of the map")),n.a.createElement("div",{className:"subheading"},"map name"),n.a.createElement(_,{text:this.state.map.name,placeholder:"map name",onChange:e=>this.updateMap(e)}),n.a.createElement("div",{className:"subheading"},"map square size"),n.a.createElement(de,{value:this.state.square+" px",label:"square size",factors:[1,10],downEnabled:this.state.square>1,onNudgeValue:e=>this.nudgeSquare(e)}),n.a.createElement("div",{className:"subheading"},"map dimensions"),n.a.createElement(de,{value:this.state.mapDimensions.width+" sq",label:"width",downEnabled:this.state.mapDimensions.width>1,onNudgeValue:e=>this.nudgeWidth(e)}),n.a.createElement(de,{value:this.state.mapDimensions.height+" sq",label:"height",downEnabled:this.state.mapDimensions.height>1,onNudgeValue:e=>this.nudgeHeight(e)})):n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"select the file you want to upload")),n.a.createElement(Q.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"),n.a.createElement("p",{className:"ant-upload-text"},"try to upload small images if possible")))}return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:8,className:"scrollable"},n.a.createElement(Te,{options:["link","upload"].map(e=>({id:e,text:e})),selectedID:this.state.mode,onSelect:e=>this.setState({mode:e})}),t),n.a.createElement(h.a,{span:16,className:"scrollable both-ways"},n.a.createElement(qe,{map:this.state.map,mode:"edit",showGrid:!0,gridSquareClicked:(e,t)=>null})))}catch(t){return console.error(t),n.a.createElement(X,{error:t})}}}class Tt extends n.a.Component{constructor(e){super(e),this.state={showContent:!0}}toggleContentVisible(){this.setState({showContent:!this.state.showContent})}render(){try{const e=this.props.content.filter(e=>!!e);if(0===e.length)return null;let t=null;if(this.props.heading){let e=null;this.props.showToggle&&(e=n.a.createElement(re.a,{className:this.state.showContent?"rotate":"",onClick:()=>this.toggleContentVisible()})),t=n.a.createElement("div",{className:"heading fixed-top"},n.a.createElement("div",{className:"title"},this.props.heading),e)}let a=null;if(this.state.showContent){let t=6;switch(this.props.columns){case 1:t=24;break;case 2:t=12;break;case 3:t=8}a=n.a.createElement(p.a,{align:"top",gutter:10},e.map(a=>n.a.createElement(h.a,{key:e.indexOf(a),span:t},a)))}return n.a.createElement("div",{className:"grid-panel"},t,a)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Tt.defaultProps={columns:0,heading:null,showToggle:!1};class At extends n.a.Component{constructor(e){super(e),this.state={group:e.group}}readFile(e){return e.text().then(e=>{const t=JSON.parse(e);Object.keys(t).forEach(e=>{if("id"!==e){const a=t[e];this.state.group[e]=a}}),this.state.group.monsters.forEach(e=>{e.id=b.guid(),e.portrait=""}),this.setState({group:this.state.group})}),!1}render(){try{return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"select the file you want to upload")),n.a.createElement(Q.a.Dragger,{accept:".monstergroup",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))),n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Tt,{heading:this.props.group.name,columns:1,content:this.props.group.monsters.map(e=>n.a.createElement(gt,{key:e.id,monster:e}))})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Pt extends n.a.Component{constructor(e){super(e),this.state={view:"paste",source:"",monster:e.monster}}setView(e){this.setState({view:e})}setSource(e){this.setState({source:e})}analyse(){N.import(this.state.source,this.state.monster),this.setState({monster:this.state.monster})}readFile(e){return e.text().then(e=>{const t=JSON.parse(e);Object.keys(t).forEach(e=>{if("id"!==e&&"portrait"!==e){const a=t[e];this.state.monster[e]=a}}),this.setState({monster:this.state.monster})}),!1}render(){try{const e=["paste","upload"].map(e=>({id:e,text:e}));let t=null;switch(this.state.view){case"paste":t=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"go to the following link to find the monster you want to import"),n.a.createElement("div",{className:"section"},n.a.createElement("a",{href:"https://www.dndbeyond.com/monsters",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/monsters")),n.a.createElement("div",{className:"section"},"then right-click on the page and select ",n.a.createElement("b",null,"view page source")),n.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),n.a.createElement(_,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:e=>this.setSource(e)}),n.a.createElement("button",{onClick:()=>this.analyse()},"analyse"));break;case"upload":t=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"select the file you want to upload")),n.a.createElement(Q.a.Dragger,{accept:".monster",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Te,{options:e,selectedID:this.state.view,onSelect:e=>this.setView(e)}),t),n.a.createElement(h.a,{span:12,className:"scrollable",style:{padding:"5px"}},n.a.createElement(gt,{monster:this.state.monster})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Vt{static importParty(e,t){t.name="",t.pcs=[];const a=(new DOMParser).parseFromString(e,"text/html");try{t.name=a.getElementsByClassName("page-title")[0].innerText.trim()}catch(s){console.error(s)}try{const e=a.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-active")[0].getElementsByClassName("ddb-campaigns-character-card");for(let a=0;a!==e.length;++a){const s=e[a];t.pcs.push(Vt.getCharacter(s,!0))}}catch(s){console.error(s)}try{const e=a.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-inactive")[0].getElementsByClassName("ddb-campaigns-character-card");for(let a=0;a!==e.length;++a){const s=e[a];t.pcs.push(Vt.getCharacter(s,!1))}}catch(s){console.error(s)}}static getCharacter(e,t){const a=E.createPC();a.name=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-primary")[0].innerText.trim(),a.player=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[1].innerText.trim().substring(8),a.active=t;const s=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[0].innerText.trim().split("|");a.level=Number.parseInt(s[0].substring(4).trim(),10),a.race=s[1].trim(),a.classes=s[2].trim();const n=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-details-link")[0];return a.url="https://www.dndbeyond.com"+n.getAttribute("href"),a}static importPC(e,t){try{const a=JSON.parse(e);t.name=a.character.name,t.size=a.character.race.size,t.race=a.character.race.fullName;let s=0,n="";a.character.classes.forEach(e=>{s+=e.level,""!==n&&(n+=" / "),n+=e.definition.name,e.subclassDefinition&&(n+=" ("+e.subclassDefinition.name+")")}),t.classes=n,t.level=s;const r=[].concat(a.character.modifiers.race).concat(a.character.modifiers.class).concat(a.character.modifiers.background).concat(a.character.modifiers.item).concat(a.character.modifiers.feat).concat(a.character.modifiers.condition),i=r.filter(e=>"language"===e.type).map(e=>e.friendlySubtypeName);t.languages=i.join(", ");const o=f.proficiency(s);let l=a.character.stats[3].value,c=a.character.stats[4].value;r.filter(e=>"bonus"===e.type&&"intelligence-score"===e.subType).forEach(e=>l+=e.value),r.filter(e=>"bonus"===e.type&&"wisdom-score"===e.subType).forEach(e=>c+=e.value);let d=0,p=0,h=0;const m=r.filter(e=>"insight"===e.subType||"wisdom-ability-checks"===e.subType).map(e=>e.type);m.includes("expertise")?d=2:m.includes("proficiency")?d=1:m.includes("half-proficiency-round-up")&&(d=.5);const u=r.filter(e=>"investigation"===e.subType||"intelligence-ability-checks"===e.subType).map(e=>e.type);u.includes("expertise")?p=2:u.includes("proficiency")?p=1:m.includes("half-proficiency-round-up")&&(p=.5);const g=r.filter(e=>"perception"===e.subType||"wisdom-ability-checks"===e.subType).map(e=>e.type);g.includes("expertise")?h=2:g.includes("proficiency")?h=1:m.includes("half-proficiency-round-up")&&(h=.5),t.passiveInsight=10+f.modifierValue(c)+Math.floor(o*d),t.passiveInvestigation=10+f.modifierValue(l)+Math.floor(o*p),t.passivePerception=10+f.modifierValue(c)+Math.floor(o*h),t.companions=[],a.character.creatures.forEach(e=>{const a=E.createCompanion();a.name=e.name,t.companions.push(a)})}catch(a){console.error(a)}}}class Ot extends n.a.Component{render(){try{let e=null;if(this.props.pc.companions.length>0){const t=this.props.pc.companions.map(e=>n.a.createElement("div",{key:e.id,className:"group-panel"},e.name));e=n.a.createElement("div",null,n.a.createElement("div",{className:"section subheading"},"companions"),t)}const t=(this.props.pc?this.props.pc.displayName:null)||this.props.pc.name||"unnamed pc";return n.a.createElement("div",{className:"card pc"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title",title:t},t)),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"stats"},n.a.createElement($,{source:this.props.pc}),n.a.createElement("div",{className:"section centered lowercase"},n.a.createElement(W.a,null,this.props.pc.race||"unknown race"),n.a.createElement(W.a,null,this.props.pc.classes||"unknown class"),n.a.createElement(W.a,null,"level "+this.props.pc.level)),n.a.createElement("div",{className:"section centered",style:{display:this.props.pc.url?"":"none"}},n.a.createElement("a",{href:this.props.pc.url,target:"_blank",rel:"noopener noreferrer"},"d&d beyond sheet")),n.a.createElement("hr",null),n.a.createElement("div",{className:"section subheading"},"size"),n.a.createElement("div",{className:"section"},this.props.pc.size),n.a.createElement("div",{className:"section subheading"},"languages"),n.a.createElement("div",{className:"section"},this.props.pc.languages||"none listed"),n.a.createElement("div",{className:"section subheading"},"darkvision"),n.a.createElement("div",{className:"section"},this.props.pc.darkvision>0?this.props.pc.darkvision+" ft":"none"),n.a.createElement("hr",null),n.a.createElement(p.a,null,n.a.createElement(h.a,{span:8},n.a.createElement(lt,{prefix:"passive",label:"insight",value:this.props.pc.passiveInsight})),n.a.createElement(h.a,{span:8},n.a.createElement(lt,{prefix:"passive",label:"investigation",value:this.props.pc.passiveInvestigation})),n.a.createElement(h.a,{span:8},n.a.createElement(lt,{prefix:"passive",label:"perception",value:this.props.pc.passivePerception}))),e)))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Lt extends n.a.Component{constructor(e){super(e),this.state={view:"paste",source:"",party:e.party}}setView(e){this.setState({view:e})}setSource(e){this.setState({source:e})}analyse(){Vt.importParty(this.state.source,this.state.party),this.setState({party:this.state.party})}readFile(e){return e.text().then(e=>{const t=JSON.parse(e);Object.keys(t).forEach(e=>{if("id"!==e){const a=t[e];this.state.party[e]=a}}),this.state.party.pcs.forEach(e=>{e.id=b.guid(),e.portrait=""}),this.setState({party:this.state.party})}),!1}render(){try{const e=["paste","upload"].map(e=>({id:e,text:e}));let t=null;switch(this.state.view){case"paste":t=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"go to the following link to find the party you want to import"),n.a.createElement("div",{className:"section"},n.a.createElement("a",{href:"https://www.dndbeyond.com/my-campaigns",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/my-campaigns")),n.a.createElement("div",{className:"section"},"then right-click on the page and select ",n.a.createElement("b",null,"view page source")),n.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),n.a.createElement(_,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:e=>this.setSource(e)}),n.a.createElement("button",{onClick:()=>this.analyse()},"analyse"));break;case"upload":t=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"select the file you want to upload")),n.a.createElement(Q.a.Dragger,{accept:".party",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Te,{options:e,selectedID:this.state.view,onSelect:e=>this.setView(e)}),t),n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Tt,{heading:this.props.party.name,columns:1,content:this.props.party.pcs.map(e=>n.a.createElement(Ot,{key:e.id,pc:e}))})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Rt extends n.a.Component{constructor(e){super(e),this.state={view:"paste",source:"",pc:e.pc}}setView(e){this.setState({view:e})}setSource(e){this.setState({source:e})}analyse(){Vt.importPC(this.state.source,this.state.pc),this.setState({pc:this.state.pc})}readFile(e){return e.text().then(e=>{const t=JSON.parse(e);Object.keys(t).forEach(e=>{if("id"!==e&&"portrait"!==e){const a=t[e];this.state.pc[e]=a}}),this.setState({pc:this.state.pc})}),!1}render(){try{const e=["paste","upload"].map(e=>({id:e,text:e}));let t=null;switch(this.state.view){case"paste":let e=null,a=this.state.pc.url;""!==a?(a.endsWith("/")||(a+="/"),a+="json",e=n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"go to the following link"),n.a.createElement("div",{className:"section"},n.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},a)),n.a.createElement("div",{className:"section"},"copy the data into the clipboard, paste it into the box below, and press the analyse button"))):e=n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"go to the following link to find the pc you want to import"),n.a.createElement("div",{className:"section"},n.a.createElement("a",{href:"https://www.dndbeyond.com/",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/")),n.a.createElement("div",{className:"section"},"then right-click on the page and select ",n.a.createElement("b",null,"view page source")),n.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),t=n.a.createElement("div",null,e,n.a.createElement(_,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:e=>this.setSource(e)}),n.a.createElement("button",{onClick:()=>this.analyse()},"analyse"));break;case"upload":t=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"select the file you want to upload")),n.a.createElement(Q.a.Dragger,{accept:".pc",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Te,{options:e,selectedID:this.state.view,onSelect:e=>this.setView(e)}),t),n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Ot,{pc:this.state.pc})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class zt extends n.a.Component{constructor(e){super(e),this.state={filter:E.createMonsterFilter()}}changeFilterValue(e,t){const a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}resetFilter(){this.setState({filter:E.createMonsterFilter()})}render(){try{const e=[],t=this.props.wave?this.props.wave.slots:this.props.encounter.slots;this.props.library.forEach(a=>{a.monsters.forEach(a=>{const s=M.matchMonster(a,this.state.filter),n=!this.props.slot||this.props.slot.roles.includes(a.role),r=t.some(e=>e.monsterID===a.id);s&&n&&!r&&e.push(a)})}),e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0);const a=!!this.props.slot&&this.props.slot.roles.length>0;let s=n.a.createElement($e,{items:e.map(e=>({id:e.id,text:e.name||"unnamed monster",info:"cr "+f.challenge(e.challenge)})),selectedItemID:this.props.monster?this.props.monster.id:null,onSelect:t=>{var a;return this.props.setMonster(null!==(a=e.find(e=>e.id===t))&&void 0!==a?a:null)}});if(0===e.length){const e=M.getFilterDescription(this.state.filter);s=n.a.createElement(Le,{key:"empty"},"there are no monsters that meet the criteria ",n.a.createElement("i",null,e)," (or they are all already part of the encounter)")}let r=n.a.createElement(Le,null,"select a monster from the list at the left to see its statblock here");return this.props.monster&&(r=n.a.createElement(gt,{monster:this.props.monster})),n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:8,className:"scrollable"},n.a.createElement("div",{className:"section"},n.a.createElement(ue,{filter:this.state.filter,showRoles:!a,changeValue:(e,t)=>this.changeFilterValue(e,t),resetFilter:()=>this.resetFilter()})),n.a.createElement("hr",null),s),n.a.createElement(h.a,{span:16,className:"scrollable"},r))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var qt=a(162);class Ft extends n.a.Component{constructor(e){super(e),this.state={data:e.data}}setType(e){const t=this.state.data;t.type=e,this.setState({data:t},()=>{this.props.onUpdated()})}setXP(e){const t=this.state.data;t.xp=Math.max(0,e),this.setState({data:t},()=>{this.props.onUpdated()})}setParty(e){const t=this.state.data;t.partyID=e,t.xp=this.calculateXP(),this.setState({data:t},()=>{this.props.onUpdated()})}setDifficulty(e){const t=this.state.data;t.difficulty=e,t.xp=this.calculateXP(),this.setState({data:t},()=>{this.props.onUpdated()})}changeFilterValue(e,t){const a=this.state.data.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t;const s=this.state.data;s.filter=a,this.setState({data:s},()=>{this.props.onUpdated()})}resetFilter(){const e=this.state.data;e.filter=E.createMonsterFilter(),this.setState({data:e},()=>{this.props.onUpdated()})}calculateXP(){let e=0;const t=this.props.parties.find(e=>e.id===this.props.data.partyID);if(t){t.pcs.filter(e=>e.active).forEach(t=>{e+=f.pcExperience(t.level,this.props.data.difficulty)})}return e}render(){try{const e=M.getFilterDescription(this.state.data.filter);let t=null,a=null;switch(this.state.data.type){case"xp":t=n.a.createElement("p",null,"the encounter will be created by adding ",n.a.createElement("b",null,"random ",e)," until it reaches ",n.a.createElement("b",null,this.state.data.xp," xp")),a=n.a.createElement("div",null,n.a.createElement("div",{className:"section subheading"},"xp value"),n.a.createElement(qt.a,{value:this.state.data.xp,min:1e3,step:1e3,onChange:e=>{const t=parseInt((null!==e&&void 0!==e?e:0).toString(),10);this.setXP(t)}}));break;case"party":t=n.a.createElement("p",null,"the encounter will be created by adding ",n.a.createElement("b",null,"random ",e)," until it reaches ",n.a.createElement("b",null,this.state.data.difficulty," difficulty")),a=n.a.createElement("div",null,n.a.createElement("div",{className:"section subheading"},"party"),n.a.createElement(se,{options:this.props.parties.map(e=>({id:e.id,text:e.name||"unnamed party"})),selectedID:this.state.data.partyID,onSelect:e=>this.setParty(e)}),n.a.createElement("div",{className:"section subheading"},"difficulty"),n.a.createElement(de,{value:this.state.data.difficulty,downEnabled:"easy"!==this.state.data.difficulty,upEnabled:"deadly"!==this.state.data.difficulty,onNudgeValue:e=>this.setDifficulty(f.nudgeDifficulty(this.state.data.difficulty,e))}))}return n.a.createElement("div",{className:"scrollable padded"},n.a.createElement(Le,null,t),n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"section heading"},"method"),n.a.createElement(pe,{options:[{id:"xp",text:"by xp value"},{id:"party",text:"by difficulty"}],selectedID:this.state.data.type,onSelect:e=>this.setType(e)}),a),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"section heading"},"monsters"),n.a.createElement(ue,{filter:this.state.data.filter,prefix:"use",showName:!1,showRoles:!1,changeValue:(e,t)=>this.changeFilterValue(e,t),resetFilter:()=>this.resetFilter()}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Gt{static getAward(e){var t;return null!==(t=Gt.getAwards().find(t=>t.id===e))&&void 0!==t?t:null}static getAwards(){const e=[Gt.createAward("award-003","social","Peace Sells","Reconcile differences between mortal enemies"),Gt.createAward("award-001","social","I Speak Jive","Act as the party translator"),Gt.createAward("award-004","social","Well I Didn't Vote For Him","Legitimately achieve high political status"),Gt.createAward("award-024","social","Maybe We Can Reason With It","Defeat an enemy using only social skills"),Gt.createAward("award-006","social","Objection","Win a legal case"),Gt.createAward("award-009","social","Hey, It's Enrico Palazzo","Beat a performance check while in disguise"),Gt.createAward("award-035","social","Chewbacca Defense","Successfully use poor logic in a persuasion check"),Gt.createAward("award-060","social","Bottoms Up","Win a drinking contest"),Gt.createAward("award-007","social","Dobby Is Free","Team up with an NPC sidekick"),Gt.createAward("award-019","social","Missionary Position","Convert an NPC's religion"),Gt.createAward("award-041","social","Do You Hear The People Sing?","Overthrow a government"),Gt.createAward("award-046","social","You Got Me Monologuing","Take advantage of a talkative villain"),Gt.createAward("award-083","social","Sexual Tyrannosaurus","Seduce an NPC"),Gt.createAward("award-000","exploration","Crikey","Tame an animal"),Gt.createAward("award-014","exploration","Oh Yeah","Burst through a wall"),Gt.createAward("award-033","exploration","Safety First","Discover a trap before it discovers you"),Gt.createAward("award-050","exploration","Who Needs Sleep?","Go 3 days without a long rest"),Gt.createAward("award-076","exploration","Glutton For Punishment","Knowingly activate a trap"),Gt.createAward("award-101","exploration","Suck It, Boromir","Simply walk into a well-guarded place"),Gt.createAward("award-049","exploration","And Stay Out","Get kicked out of a public establishment"),Gt.createAward("award-103","exploration","African Or European?","Spend more than 30 minutes on a puzzle"),Gt.createAward("award-022","combat","Hippie","Deal no damage in an encounter"),Gt.createAward("award-042","combat","Are You Not Entertained?","Finish an encounter within 3 rounds"),Gt.createAward("award-043","combat","Make It Last","Finish an encounter after at least 10 rounds"),Gt.createAward("award-053","combat","Get Over Here","Grapple enemies 3 times in an encounter"),Gt.createAward("award-021","combat","Nuke It From Orbit","Deal 20 overkill damage to an enemy"),Gt.createAward("award-023","combat","Walking Guillotine","Decapitate 20 enemies"),Gt.createAward("award-037","combat","It's Super Effective","Trigger an enemy's vulnerability"),Gt.createAward("award-055","combat","Avengers Assemble","Have the party team up on a single enemy"),Gt.createAward("award-056","combat","You Merely Adopted The Dark","Hit an enemy in complete darkness"),Gt.createAward("award-077","combat","I've Fallen And I Can't Get Up","Remain prone for 3 rounds"),Gt.createAward("award-078","combat","Hadouken","Lob a flaming projectile at en enemy"),Gt.createAward("award-079","combat","French Tactics","Retreat from 5 battles"),Gt.createAward("award-081","combat","My Turn","Revive an enemy in order to kill them yourself"),Gt.createAward("award-093","combat","Your Mother Was A Hamster","Taunt an enemy to get their attention"),Gt.createAward("award-032","combat","Butterfingers","Disarm an NPC"),Gt.createAward("award-054","combat","Rasputin","Have 3 impairing conditions at once"),Gt.createAward("award-097","combat","Imperial Marksmanship","Achieve only ranged misses in an encounter"),Gt.createAward("award-025","murder","Finish Him","Deliver 10 coups de gr\xe2ce"),Gt.createAward("award-094","murder","Clever Girl","Flank and kill an unsuspecting enemy"),Gt.createAward("award-058","murder","This Is Sparta","Kill an enemy using falling damage"),Gt.createAward("award-059","murder","Ain't Got Time To Bleed","Kill 3 enemies in an encounter while at half HP"),Gt.createAward("award-062","murder","Sic Semper Tyrannis","Kill a beloved political figure"),Gt.createAward("award-063","murder","Armaments 2:9-21","Kill an enemy with a holy weapon"),Gt.createAward("award-064","murder","Showoff","Kill all enemies in an encounter by yourself"),Gt.createAward("award-065","murder","Buzzkill","Kill an annoying NPC"),Gt.createAward("award-066","murder","I Can Kill You With My Brain","Kill an enemy using only skill checks"),Gt.createAward("award-067","murder","Dracarys","Kill an enemy with an animal"),Gt.createAward("award-068","murder","Whose Life Is It Anyway?","Kill an enemy with an improvised weapon"),Gt.createAward("award-069","murder","Finesse","Kill an enemy with no overkill damage"),Gt.createAward("award-070","murder","Nothing Is True","Kill an enemy without being seen or heard"),Gt.createAward("award-071","murder","Douple Tap","Kill an undead enemy with a headshot"),Gt.createAward("award-072","murder","Long Live The King","Kill and replace a sovereign leader"),Gt.createAward("award-073","murder","Sorry About The Mess","Kill an enemy in a public place"),Gt.createAward("award-074","murder","Dark And Full Of Terrors","Kill an enemy in the name of a god"),Gt.createAward("award-075","murder","Fatality","Kill an enemy using the environment"),Gt.createAward("award-108","survival","Birth Of The Joker","Survive 50 points of acid damage"),Gt.createAward("award-109","survival","Are You God Of Hammers?","Survive 50 points of bludgeoning damage"),Gt.createAward("award-110","survival","Overlook Hotel","Survive 50 points of cold damage"),Gt.createAward("award-111","survival","I'm Very Badly Burned","Survive 50 points of fire damage"),Gt.createAward("award-112","survival","Is That All You Got?","Survive 50 points of force damage"),Gt.createAward("award-113","survival","It's Electrifying","Survive 50 points of lightning damage"),Gt.createAward("award-114","survival","Thriller","Survive 50 points of necrotic damage"),Gt.createAward("award-115","survival","I'm A Leaf On The Wind","Survive 50 points of piercing damage"),Gt.createAward("award-116","survival","Mithridates, He Died Old","Survive 50 points of poison damage"),Gt.createAward("award-117","survival","Nosebleed","Survive 50 points of psychic damage"),Gt.createAward("award-118","survival","So Bright I Gotta Wear Shades","Survive 50 points of radiant damage"),Gt.createAward("award-119","survival","Just A Flesh Wound","Survive 50 points of slashing damage"),Gt.createAward("award-120","survival","Loud Noises","Survive 50 points of thunder damage"),Gt.createAward("award-098","survival","Gonna Need A Bigger Boat","Survive an encounter with a sea monster"),Gt.createAward("award-099","survival","All Washed Up","Survive a shipwreck"),Gt.createAward("award-045","survival","It's In The Pipes","Survive being petrified"),Gt.createAward("award-008","survival","Stop, Drop, And Roll","Survive 3 rounds of ongoing fire damage"),Gt.createAward("award-002","economic","Holla Holla Get Dolla","Amass 10,000 gold pieces"),Gt.createAward("award-092","economic","Sticky Fingers","Steal 1,000 gold pieces"),Gt.createAward("award-080","economic","My Precious","Retrieve a MacGuffin"),Gt.createAward("award-106","economic","Bloodbath And Beyond","Open a shop"),Gt.createAward("award-104","economic","Nothing To See Here","Take and / or give 20 bribes"),Gt.createAward("award-090","economic","It Belongs In A Museum","Take an artifact from a dungeon"),Gt.createAward("award-052","economic","Spare No Expense","Go broke"),Gt.createAward("award-085","dice","Did You Break A Mirror?","Roll 2 natural 1s in a row"),Gt.createAward("award-086","dice","Taxi!","Roll 2 natural 1s on an advantaged roll"),Gt.createAward("award-087","dice","Single File Solar System","Roll 2 natural 20s in a row"),Gt.createAward("award-088","dice","I Am A Golden God","Roll 2 natural 20s on a disadvantaged roll"),Gt.createAward("award-039","dice","Never Tell Me The Odds","Succeed only because you rolled a 20"),Gt.createAward("award-048","dice","A Bird In The Hand","Get a worse result on a reroll"),Gt.createAward("award-051","dice","Who Needs Rules?","Go a full session without touching your dice"),Gt.createAward("award-015","paragon","For King And Country","Successfully defend a royal life"),Gt.createAward("award-034","paragon","Flawless Victory","The party takes 0 damage in an encounter"),Gt.createAward("award-044","paragon","Breaker Of Chains","Free 20 captive people"),Gt.createAward("award-082","paragon","All The World's A Stage","Roleplay your character exceptionally"),Gt.createAward("award-095","paragon","I Volunteer As Tribute","Sacrifice yourself"),Gt.createAward("award-096","paragon","Friendship Is Magic","Save a fellow PC"),Gt.createAward("award-102","paragon","It Still Only Counts As One","Kill a large enemy by yourself"),Gt.createAward("award-018","renegade","The Rains Of Castamere","Commit genocide"),Gt.createAward("award-012","renegade","I'm Gotham's Reckoning","Destroy an entire city"),Gt.createAward("award-084","renegade","Chaos Is A Ladder","Shift your alignment to chaotic"),Gt.createAward("award-100","renegade","You Either Die A Hero...","Shift your alignment to evil"),Gt.createAward("award-107","renegade","Sudden But Inevitable","Betray the party for your own gain"),Gt.createAward("award-091","renegade","99 Red Balloons","Start a war"),Gt.createAward("award-105","renegade","This Is Bat Country","Take drugs"),Gt.createAward("award-013","renegade","Homewrecker","Break up an NPC relationship"),Gt.createAward("award-016","oops","Did I Do That?","Cause a total party kill"),Gt.createAward("award-010","oops","Tubthumping","Reach 0 HP twice in a single encounter"),Gt.createAward("award-005","oops","Helen Keller","Become deafened and blinded simultaneously"),Gt.createAward("award-028","oops","He's Dead, Jim","Die for the first time"),Gt.createAward("award-029","oops","Fool Me Twice","Die for the second time"),Gt.createAward("award-030","oops","Angered The Dice Gods","Die for the third time"),Gt.createAward("award-026","oops","Was That Important?","Destroy an item necessary for a quest"),Gt.createAward("award-057","oops","I Was Elected To Lead","Ignore a crucial plot point"),Gt.createAward("award-047","oops","It's Not A Tumor","Get a permanent deformity"),Gt.createAward("award-038","oops","She Turned Me Into A Newt","Be polymorphed against your will"),Gt.createAward("award-040","oops","Keaton Was Keyser Soze","Fall for a red herring"),Gt.createAward("award-089","misc","The Cardinal Sin","Deliberately split the party"),Gt.createAward("award-031","misc","Karma","Experience revenge from an old enemy"),Gt.createAward("award-036","misc","Get On With It","Talk out of character for a full minute"),Gt.createAward("award-061","misc","Don't You Forget About Me","Meet with a recurring villain"),Gt.createAward("award-020","misc","The Black Wind Howls","Correctly predict the death of another PC")];return b.sort(e),e}static getCategories(){const e=[];return Gt.getAwards().filter(e=>"misc"!==e.category).forEach(t=>{e.includes(t.category)||e.push(t.category)}),e.sort(),e.push("misc"),e}static createAward(e,t,a,s){const n=E.createAward();return n.id=e,n.category=t,n.name=a,n.description=s,n}}var Bt=a(192);class jt extends n.a.Component{render(){try{return n.a.createElement("div",{className:"group-panel"},n.a.createElement(p.a,{gutter:10,align:"middle"},n.a.createElement(h.a,{span:4},n.a.createElement(Bt.a,{style:{fontSize:"50px"},twoToneColor:"#d4af37"})),n.a.createElement(h.a,{span:20},n.a.createElement("div",{className:"section subheading"},this.props.award.name.toLowerCase()),n.a.createElement(W.a,null,this.props.award.category),n.a.createElement("div",{className:"section"},this.props.award.description.toLowerCase()),this.props.children)))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ut extends n.a.Component{render(){try{if(!this.props.source)return null;let e=null;switch(this.props.source.type){case"pc":e=n.a.createElement(Ot,{pc:this.props.source});break;case"monster":e=n.a.createElement(gt,{monster:this.props.source})}let t=null;if("pc"===this.props.source.type){const e=this.props.source.awards.map(e=>{const t=Gt.getAward(e);return t?n.a.createElement(jt,{key:t.id,award:t}):null});e.length>0&&(t=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement("div",{className:"subheading"},"awards"),e))}return n.a.createElement("div",{className:"scrollable padded"},e,t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ht extends n.a.Component{success(){switch(this.props.notification.type){case"condition-save":case"condition-end":const e=this.props.notification.data;e.duration&&("saves"!==e.duration.type&&"rounds"!==e.duration.type||(e.duration.count-=1,this.props.close(this.props.notification,0===e.duration.count)));break;case"trait-recharge":this.props.notification.data.uses=0,this.props.close(this.props.notification,!1)}}render(){try{const e=this.props.notification.combatant,t=e.displayName||e.name||"unnamed monster";switch(this.props.notification.type){case"condition-save":const e=this.props.notification.data,a="custom"===e.name?e.text:e.name,s=e.duration;let r=s.saveType.toString();return"death"!==r&&(r=r.toUpperCase()),n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("b",null,t)," (",n.a.createElement("i",null,a),") must make a ",r," save against dc ",s.saveDC),n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.success()},"success")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.props.close(this.props.notification,!1)},"failure"))));case"condition-end":const i=this.props.notification.data,o="custom"===i.name?i.text:i.name;return n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("b",null,t)," is no longer affected by condition ",n.a.createElement("b",null,o)));case"trait-recharge":const l=this.props.notification.data;return n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("b",null,t)," can attempt to recharge ",n.a.createElement("b",null,l.name)),n.a.createElement("div",{className:"section"},l.usage),n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.success()},"recharge")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.props.openSidebar()},"roll 1d6"))))}}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Ht.defaultProps={openSidebar:null};var Yt=a(112);class Wt extends n.a.Component{render(){try{const e=[];let t=0;if(this.props.result.rolls.forEach(a=>{let s="";20===a.sides&&(1===a.value&&(s="nat1"),20===a.value&&(s="nat20")),e.push(n.a.createElement(W.a,{key:a.id,className:s},"d",a.sides,": ",n.a.createElement("b",null,a.value))),t+=a.value}),0!==this.props.result.constant){const a=this.props.result.constant>0?"+":"-";e.push(n.a.createElement(W.a,{key:"constant"},a," ",n.a.createElement("b",null,Math.abs(this.props.result.constant)))),t+=this.props.result.constant}const a=""===this.props.result.mode?null:n.a.createElement(Yt.a,{className:"roll-icon "+this.props.result.mode,title:this.props.result.mode});return n.a.createElement("div",{className:"die-roll-result group-panel"},n.a.createElement("div",{className:"rolls"},e,a),n.a.createElement("div",{className:"sum"},t))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Jt extends n.a.Component{render(){try{const e=this.props.shortcuts.concat(this.props.tabs.map(e=>n.a.createElement("div",{key:e.id,className:e.selected?"navigator-item selected":"navigator-item",onClick:()=>e.onSelect(),role:"button"},e.text)));return n.a.createElement("div",{className:"page-footer"},e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Jt.defaultProps={tabs:[],shortcuts:[]};var _t=a(193),Kt=a(194),Xt=a(195);class Zt extends n.a.Component{render(){try{const e=this.props.breadcrumbs.map(e=>n.a.createElement("div",{key:e.id,className:"breadcrumb",onClick:()=>e.onClick(),role:"button"},e.text));let t=null;return this.props.onToggleSidebar&&(t=n.a.createElement(_t.a,{className:"toggle",title:"show sidebar",onClick:()=>this.props.onToggleSidebar()}),this.props.sidebarVisible&&(t=n.a.createElement(Kt.a,{className:"toggle",title:"hide sidebar",onClick:()=>this.props.onToggleSidebar()}))),this.props.onToggleSettings&&(t=n.a.createElement(Xt.a,{className:"toggle",title:"settings",onClick:()=>this.props.onToggleSettings()})),n.a.createElement("div",{className:"page-header"},n.a.createElement("div",{className:"app-title"},e),t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}Zt.defaultProps={sidebarVisible:!1,onToggleSidebar:null,onToggleSettings:null};var Qt=a(202),$t=a(203),ea=a(204),ta=a(205),aa=a(206),sa=a(110),na=a(207),ra=a(208),ia=a(209),oa=a(102);class la extends n.a.Component{constructor(e){super(e),this.state={view:"dojo"}}setView(e){this.setState({view:e})}clearImages(){S.clearUnusedImages(this.props.maps,this.props.combats,this.props.explorations),this.setState({view:this.state.view})}render(){try{const e=["dojo","settings","ogl"].map(e=>({id:e,text:e}));let t=null;switch(this.state.view){case"dojo":t=n.a.createElement("div",null,n.a.createElement("div",{className:"section"},"designed by ",n.a.createElement("a",{href:"mailto:andy.aiken@live.co.uk"},"andy aiken")),n.a.createElement("div",{className:"section"},"version ",n.a.createElement("b",null,oa.version)),n.a.createElement("div",{className:"section"},"if you would like to raise a bug or request a new feature, you can do so here: ",n.a.createElement("a",{href:"https://github.com/andyaiken/dojo",target:"_blank",rel:"noopener noreferrer"},"repository")),n.a.createElement("div",{className:"section"},"the roadmap for planned new features can be found here: ",n.a.createElement("a",{href:"https://github.com/andyaiken/dojo/projects/8?fullscreen=true",target:"_blank",rel:"noopener noreferrer"},"roadmap")));break;case"settings":let e=0,a=0;for(let t=0;t!==window.localStorage.length;++t){const s=window.localStorage.key(t);if(s){const t=window.localStorage.getItem(s);t&&(s.startsWith("data")&&(e+=t.length),s.startsWith("image")&&(a+=t.length))}}t=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"turn this setting on to add die roll buttons to monster stat blocks")),n.a.createElement(te,{label:"show monster die rolls",checked:this.props.options.showMonsterDieRolls,onChecked:e=>this.props.setOption("showMonsterDieRolls",e)}),n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"you can switch the app between light theme and dark theme")),n.a.createElement(te,{label:"use dark theme",checked:"dark"===this.props.options.theme,onChecked:e=>this.props.setOption("theme",e?"dark":"light")}),n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"this setting controls how diagonal movement is calculated")),n.a.createElement(se,{options:[{id:"one",text:"diagonals count as one square (5 ft)"},{id:"onepointfive",text:"diagonals count as 1\xbd squares (7.5 ft)"},{id:"two",text:"diagonals count as two squares (10 ft)"}],selectedID:this.props.options.diagonals,onSelect:e=>this.props.setOption("diagonals",e)}),n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"the browser has a limited amount of image storage space"),n.a.createElement("div",{className:"section"},"use this button to delete anything that isn't currently being used")),n.a.createElement("button",{onClick:()=>this.clearImages()},"remove unused images"),n.a.createElement("hr",null),n.a.createElement("div",{className:"subheading"},"data"),n.a.createElement("div",{className:"section"},n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"total"),n.a.createElement(h.a,{span:8,className:"right-value"},b.toData(e+a))),n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"data"),n.a.createElement(h.a,{span:8,className:"right-value"},b.toData(e))),n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"images"),n.a.createElement(h.a,{span:8,className:"right-value"},b.toData(a)))));break;case"ogl":t=n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"open game license"),n.a.createElement("div",{className:"section"},"The following text is the property of Wizards of the Coast, Inc. and is Copyright 2000 Wizards of the Coast, Inc ('Wizards'). All Rights Reserved."),n.a.createElement("ol",null,n.a.createElement("li",null,n.a.createElement("b",null,"Definitions"),": (a)'Contributors' means the copyright and/or trademark owners who have contributed Open Game Content; (b)'Derivative Material' means copyrighted material including derivative works and translations (including into other computer languages), potation, modification, correction, addition, extension, upgrade, improvement, compilation, abridgment or other form in which an existing work may be recast, transformed or adapted; (c) 'Distribute' means to reproduce, license, rent, lease, sell, broadcast, publicly display, transmit or otherwise distribute; (d)'Open Game Content' means the game mechanic and includes the methods, procedures, processes and routines to the extent such content does not embody the Product Identity and is an enhancement over the prior art and any additional content clearly identified as Open Game Content by the Contributor, and means any work covered by this License, including translations and derivative works under copyright law, but specifically excludes Product Identity. (e) 'Product Identity' means product and product line names, logos and identifying marks including trade dress; artifacts; creatures characters; stories, storylines, plots, thematic elements, dialogue, incidents, language, artwork, symbols, designs, depictions, likenesses, formats, poses, concepts, themes and graphic, photographic and other visual or audio representations; names and descriptions of characters, spells, enchantments, personalities, teams, personas, likenesses and special abilities; places, locations, environments, creatures, equipment, magical or supernatural abilities or effects, logos, symbols, or graphic designs; and any other trademark or registered trademark clearly identified as Product identity by the owner of the Product Identity, and which specifically excludes the Open Game Content; (f) 'Trademark' means the logos, names, mark, sign, motto, designs that are used by a Contributor to identify itself or its products or the associated products contributed to the Open Game License by the Contributor (g) 'Use', 'Used' or 'Using' means to use, Distribute, copy, edit, format, modify, translate and otherwise create Derivative Material of Open Game Content. (h) 'You' or 'Your' means the licensee in terms of this agreement."),n.a.createElement("li",null,n.a.createElement("b",null,"The License"),": This License applies to any Open Game Content that contains a notice indicating that the Open Game Content may only be Used under and in terms of this License. You must affix such a notice to any Open Game Content that you Use. No terms may be added to or subtracted from this License except as described by the License itself. No other terms or conditions may be applied to any Open Game Content distributed using this License."),n.a.createElement("li",null,n.a.createElement("b",null,"Offer and Acceptance"),": By Using the Open Game Content You indicate Your acceptance of the terms of this License."),n.a.createElement("li",null,n.a.createElement("b",null,"Grant and Consideration"),": In consideration for agreeing to use this License, the Contributors grant You a perpetual, worldwide, royalty-free, non-exclusive license with the exact terms of this License to Use, the Open Game Content."),n.a.createElement("li",null,n.a.createElement("b",null,"Representation of Authority to Contribute"),": If You are contributing original material as Open Game Content, You represent that Your Contributions are Your original creation and/or You have sufficient rights to grant the rights conveyed by this License."),n.a.createElement("li",null,n.a.createElement("b",null,"Notice of License Copyright"),": You must update the COPYRIGHT NOTICE portion of this License to include the exact text of the COPYRIGHT NOTICE of any Open Game Content You are copying, modifying or distributing, and You must add the title, the copyright date, and the copyright holder's name to the COPYRIGHT NOTICE of any original Open Game Content you Distribute."),n.a.createElement("li",null,n.a.createElement("b",null,"Use of Product Identity"),": You agree not to Use any Product Identity, including as an indication as to compatibility, except as expressly licensed in another, independent Agreement with the owner of each element of that Product Identity. You agree not to indicate compatibility or co-adaptability with any Trademark or Registered Trademark in conjunction with a work containing Open Game Content except as expressly licensed in another, independent Agreement with the owner of such Trademark or Registered Trademark. The use of any Product Identity in Open Game Content does not constitute a challenge to the ownership of that Product Identity. The owner of any Product Identity used in Open Game Content shall retain all rights, title and interest in and to that Product Identity."),n.a.createElement("li",null,n.a.createElement("b",null,"Identification"),": If you distribute Open Game Content You must clearly indicate which portions of the work that you are distributing are Open Game Content."),n.a.createElement("li",null,n.a.createElement("b",null,"Updating the License"),": Wizards or its designated Agents may publish updated versions of this License. You may use any authorized version of this License to copy, modify and distribute any Open Game Content originally distributed under any version of this License."),n.a.createElement("li",null,n.a.createElement("b",null,"Copy of this License"),": You MUST include a copy of this License with every copy of the Open Game Content You Distribute."),n.a.createElement("li",null,n.a.createElement("b",null,"Use of Contributor Credits"),": You may not market or advertise the Open Game Content using the name of any Contributor unless You have written permission from the Contributor to do so."),n.a.createElement("li",null,n.a.createElement("b",null,"Inability to Comply"),": If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Open Game Content due to statute, judicial order, or governmental regulation then You may not Use any Open Game Material so affected."),n.a.createElement("li",null,n.a.createElement("b",null,"Termination"),": This License will terminate automatically if You fail to comply with all terms herein and fail to cure such breach within 30 days of becoming aware of the breach. All sublicenses shall survive the termination of this License."),n.a.createElement("li",null,n.a.createElement("b",null,"Reformation"),": If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable."),n.a.createElement("li",null,n.a.createElement("b",null,"COPYRIGHT NOTICE")," Open Game License v 1.0 Copyright 2000, Wizards of the Coast, Inc.")))}return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"about"),n.a.createElement(pe,{options:e,selectedID:this.state.view,onSelect:e=>this.setView(e)})),n.a.createElement("div",{className:"sidebar-content"},t))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ca extends n.a.Component{constructor(e){super(e),this.state={selectedCategory:null}}setSelectedCategory(e){this.setState({selectedCategory:""===e?null:e})}render(){try{var e;if(!G.data.party)return null;const t=G.getCharacterID(G.getID()),a=G.data.party.pcs.find(e=>e.id===t);if(!a)return null;const s=Gt.getCategories().map(e=>({id:e,text:e}));s.unshift({id:"",text:"all"});const r=Gt.getAwards().filter(e=>null===this.state.selectedCategory||e.category===this.state.selectedCategory),i=r.filter(e=>a.awards.includes(e.id)),o=r.filter(e=>{var t;return null===(t=G.data.party)||void 0===t?void 0:t.awards.includes(e.id)}),l=r.filter(e=>!i.includes(e)&&!o.includes(e));let c=n.a.createElement(Le,null,n.a.createElement("p",null,"no awards"));i.length>0&&(c=n.a.createElement("div",null,i.map(e=>n.a.createElement(jt,{key:e.id,award:e}))));let d=n.a.createElement(Le,null,n.a.createElement("p",null,"no awards"));o.length>0&&(d=n.a.createElement("div",null,o.map(e=>n.a.createElement(jt,{key:e.id,award:e}))));let p=n.a.createElement(Le,null,n.a.createElement("p",null,"no awards"));l.length>0&&(p=n.a.createElement("div",null,l.map(e=>n.a.createElement(jt,{key:e.id,award:e}))));const h=i.length+o.length,m=r.length;return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"awards"),n.a.createElement(oe,{text:"filter awards"},n.a.createElement(pe,{options:s,selectedID:null!==(e=this.state.selectedCategory)&&void 0!==e?e:"",itemsPerRow:4,onSelect:e=>this.setSelectedCategory(e)}))),n.a.createElement("div",{className:"sidebar-content"},n.a.createElement("div",{className:"section centered"},n.a.createElement(fe.a,{status:"normal",percent:100*h/m,type:"circle",format:()=>h+" / "+m})),n.a.createElement("hr",null),n.a.createElement("div",{className:"subheading"},"your awards"),c,n.a.createElement("div",{className:"subheading"},"party awards"),d,n.a.createElement("div",{className:"subheading"},"still to get"),p))}catch(t){return console.error(t),n.a.createElement(X,{error:t})}}}var da=a(30),pa=a.n(da),ha=a(45),ma=a(196);class ua extends n.a.Component{render(){try{const e=[{id:"name",text:"names"},{id:"book",text:"book titles"},{id:"potion",text:"potions"},{id:"treasure",text:"treasures"},{id:"place",text:"place names"},{id:"npc",text:"npc"}];let t=null;switch(this.props.view){case"name":t=n.a.createElement(ga,{key:"name",type:"name"});break;case"book":t=n.a.createElement(ga,{key:"book",type:"book"});break;case"potion":t=n.a.createElement(ga,{key:"potion",type:"potion"});break;case"treasure":t=n.a.createElement(ga,{key:"treasure",type:"treasure"});break;case"place":t=n.a.createElement(ya,null);break;case"npc":t=n.a.createElement(ba,{npc:this.props.npc,generateNPC:()=>this.props.generateNPC()})}return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"generators"),n.a.createElement(pe,{options:e,selectedID:this.props.view,itemsPerRow:3,onSelect:e=>this.props.setView(e)})),n.a.createElement("div",{className:"sidebar-content"},t))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ga extends n.a.Component{constructor(e){super(e),this.state={values:[]}}generate(){const e=[];for(;e.length<10;){let t="";switch(this.props.type){case"book":t=D.generateBookTitle();break;case"name":t=D.generateName();break;case"potion":t=D.generatePotion();break;case"treasure":t=D.generateTreasure()}e.includes(t)||e.push(t)}e.sort(),this.setState({values:e})}render(){try{const e=[];for(let t=0;t!==this.state.values.length;++t)e.push(n.a.createElement(Ea,{key:t,text:this.state.values[t]}));return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.generate()},"generate"),e.length>0?n.a.createElement("hr",null):null,e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ya extends n.a.Component{constructor(e){super(e),this.state={values:[]}}generate(){var e=this;return Object(ha.a)(pa.a.mark((function t(){var a,s,n;return pa.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/dojo/data/places.txt");case 2:return a=t.sent,t.next=5,a.text();case 5:s=t.sent,D.initModel([s]),n=D.generateLines(10),e.setState({values:n});case 9:case"end":return t.stop()}}),t)})))()}render(){try{const e=[];for(let t=0;t!==this.state.values.length;++t)e.push(n.a.createElement(Ea,{key:t,text:this.state.values[t]}));return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.generate()},"generate"),e.length>0?n.a.createElement("hr",null):null,e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ba extends n.a.Component{render(){try{let e=null;return this.props.npc&&(e=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement("div",{className:"group-panel"},n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"age:")," ",this.props.npc.age),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"profession:")," ",this.props.npc.profession),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"height:")," ",this.props.npc.height),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"weight:")," ",this.props.npc.weight),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"hair:")," ",this.props.npc.hair),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"physical:")," ",this.props.npc.physical),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"personality:")," ",this.props.npc.mental),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"speech:")," ",this.props.npc.speech),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"trait:")," ",this.props.npc.trait),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"ideal:")," ",this.props.npc.ideal),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"bond:")," ",this.props.npc.bond),n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"flaw:")," ",this.props.npc.flaw)))),n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.generateNPC()},"generate"),e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ea extends n.a.Component{copy(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}render(){try{return n.a.createElement("div",{className:"generated-item group-panel"},n.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),n.a.createElement("div",{className:"icon-section"},n.a.createElement(ma.a,{title:"copy to clipboard",onClick:e=>this.copy(e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var fa=a(55),va=a(157);class wa extends n.a.Component{constructor(e){super(e),this.state={externalWindow:null,containerElement:null}}componentDidMount(){const e=window.open("","","width=800, height=500, left=200, top=200");let t=null;if(e){t=e.document.createElement("div"),t.className="dojo popout",e.document.body.appendChild(t);Array.from(document.styleSheets).forEach(t=>{const a=t;if(t.href){const a=document.createElement("link");a.rel="stylesheet",a.href=t.href,e.document.head.appendChild(a)}else if(a&&a.cssRules&&a.cssRules.length>0){const t=document.createElement("style");Array.from(a.cssRules).forEach(e=>{t.appendChild(document.createTextNode(e.cssText))}),e.document.head.appendChild(t)}}),e.document.title=this.props.title,e.addEventListener("beforeunload",()=>{this.props.onCloseWindow()})}this.setState({externalWindow:e,containerElement:t})}componentWillUnmount(){this.state.externalWindow&&this.state.externalWindow.close()}render(){try{return this.state.containerElement?i.a.createPortal(this.props.children,this.state.containerElement):null}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}const ka=new ke.a.Converter;ka.setOption("tables",!0);class xa extends n.a.Component{constructor(e){super(e),this.state={awardText:"",awardCategory:null,showPending:!0,showGranted:!0}}setAwardText(e){this.setState({awardText:e})}setAwardCategory(e){this.setState({awardCategory:""===e?null:e})}setShowPending(e){this.setState({showPending:e})}setShowGranted(e){this.setState({showGranted:e})}render(){var e,t,a;try{const r=[{id:"skills",text:"skills"},{id:"conditions",text:"conditions"},{id:"actions",text:"actions"}];this.props.parties.length>0&&r.push({id:"party",text:"party"}),this.props.monsters.length>0&&r.push({id:"monster",text:"monster"}),this.props.showAwards&&r.push({id:"awards",text:"awards"});let i=null,o=null;switch(this.props.view){case"skills":o=n.a.createElement(Ca,{key:"skills",filename:"/dojo/data/skills.md"});break;case"conditions":o=n.a.createElement(Ca,{key:"conditions",filename:"/dojo/data/conditions.md"});break;case"actions":o=n.a.createElement(Ca,{key:"actions",filename:"/dojo/data/actions.md"});break;case"party":var s;if(this.props.parties.length>1)i=n.a.createElement(se,{options:this.props.parties.map(e=>({id:e.id,text:e.name||"unnamed party"})),placeholder:"select a party...",selectedID:this.props.selectedPartyID,onSelect:e=>this.props.selectPartyID(e)}),o=n.a.createElement(Na,{party:null!==(s=this.props.parties.find(e=>e.id===this.props.selectedPartyID))&&void 0!==s?s:null});else 1===this.props.parties.length&&(i=n.a.createElement("div",{className:"section heading"},this.props.parties[0].name||"unnamed party"),o=n.a.createElement(Na,{party:this.props.parties[0]}));break;case"monster":i=n.a.createElement(se,{options:this.props.monsters.map(e=>({id:e.id,text:e.name})),placeholder:"select a monster...",selectedID:this.props.selectedMonsterID,onSelect:e=>this.props.selectMonsterID(e),onClear:()=>this.props.selectMonsterID(null)}),o=n.a.createElement(Sa,{monster:null!==(e=this.props.monsters.find(e=>e.id===this.props.selectedMonsterID))&&void 0!==e?e:null});break;case"awards":const r=Gt.getCategories().map(e=>({id:e,text:e}));r.unshift({id:"",text:"all"});let l=Gt.getAwards(),c=null,d=null,m=null,u=null;if(1===this.props.parties.length&&(u=this.props.parties[0]),this.props.parties.length>1&&(u=this.props.parties.find(e=>e.id===this.props.selectedPartyID),d=n.a.createElement(oe,{text:"granting awards"},n.a.createElement(Le,null,n.a.createElement("p",null,"to grant any of these awards, you need to select a party")),n.a.createElement(se,{placeholder:"select a party...",options:this.props.parties.map(e=>({id:e.id,text:e.name||"unnamed party"})),selectedID:this.props.selectedPartyID,onSelect:e=>this.props.selectPartyID(e)}))),u){const e=[].concat(u.awards);if(u.pcs.forEach(t=>{e.concat(t.awards)}),l=l.filter(t=>{const a=e.includes(t.id);return!(!this.state.showGranted||!a)||!(!this.state.showPending||a)}).filter(e=>!(""!==this.state.awardText&&!I.matchAward(this.state.awardText,e))&&(!this.state.awardCategory||e.category===this.state.awardCategory)),l.length>0){const t=l.filter(t=>e.includes(t.id));m=n.a.createElement("div",{className:"section centered"},n.a.createElement(fe.a,{status:"normal",percent:100*t.length/l.length,type:"circle",format:()=>t.length+" / "+l.length}),n.a.createElement("hr",null))}c=n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement(te,{label:"pending awards",checked:this.state.showPending,onChecked:e=>this.setShowPending(e)})),n.a.createElement(h.a,{span:12},n.a.createElement(te,{label:"granted awards",checked:this.state.showGranted,onChecked:e=>this.setShowGranted(e)})))}i=n.a.createElement("div",null,n.a.createElement(oe,{text:"filter awards"},n.a.createElement(_,{text:this.state.awardText,placeholder:"search",noMargins:!0,onChange:e=>this.setAwardText(e)}),n.a.createElement(pe,{options:r,selectedID:null!==(t=this.state.awardCategory)&&void 0!==t?t:"",itemsPerRow:4,onSelect:e=>this.setAwardCategory(e)}),c),d),o=n.a.createElement("div",null,m,n.a.createElement(Ia,{awards:l,party:null!==(a=this.props.parties.find(e=>e.id===this.props.selectedPartyID))&&void 0!==a?a:null,addAward:(e,t)=>this.props.addAward(e,t),deleteAward:(e,t)=>this.props.deleteAward(e,t)}))}return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"reference"),n.a.createElement(pe,{options:r,selectedID:this.props.view,itemsPerRow:6===r.length?3:r.length,onSelect:e=>this.props.setView(e)}),i),n.a.createElement("div",{className:"sidebar-content"},o))}catch(r){return console.error(r),n.a.createElement(X,{error:r})}}}class Ca extends n.a.Component{constructor(e){super(e),this.state={source:null}}fetchData(){var e=this;return Object(ha.a)(pa.a.mark((function t(){var a,s;return pa.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e.props.filename);case 2:return a=t.sent,t.next=5,a.text();case 5:s=t.sent,e.setState({source:s});case 7:case"end":return t.stop()}}),t)})))()}render(){try{return this.state.source||this.fetchData(),n.a.createElement(va.a,{spinning:null===this.state.source,indicator:n.a.createElement(fa.a,{style:{fontSize:20,marginTop:100}})},n.a.createElement("div",{dangerouslySetInnerHTML:{__html:ka.makeHtml(this.state.source||"")}}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Na extends n.a.Component{render(){try{if(!this.props.party)return null;const e=this.props.party.pcs.filter(e=>e.active);if(0===e.length)return n.a.createElement("div",{className:"section centered"},n.a.createElement("i",null,"no pcs"));const t=Math.round(e.reduce((e,t)=>e+t.level,0)/e.length),a=D.getKnownLanguages(e),s=a.map(t=>{const a=e.filter(e=>e.languages.toLowerCase().includes(t.toLowerCase())),s=a.length===e.length?"all pcs":a.map(e=>e.name).join(", "),r=D.capitalise(t);return n.a.createElement("div",{key:r,className:"table-row"},n.a.createElement("div",{className:"table-cell l"},r),n.a.createElement("div",{className:"table-cell l"},s))}),r=D.getAllLanguages().map(e=>D.capitalise(e)).filter(e=>!a.includes(e));let i=null;r.length>0&&(i=n.a.createElement("div",{className:"section"},n.a.createElement("b",null,"unknown languages"),": ",r.join(", ")));const o=e.map(e=>e.darkvision).reduce((e,t)=>(-1===e.indexOf(t)&&e.push(t),e),[]).sort().map(t=>{const a=e.filter(e=>e.darkvision===t),s=a.length===e.length?"all pcs":a.map(e=>e.name).join(", ");return n.a.createElement("div",{key:t,className:"table-row"},n.a.createElement("div",{className:"table-cell l small"},t>0?t+" ft":"none"),n.a.createElement("div",{className:"table-cell l"},s))}),l={min:Number.MAX_VALUE,max:Number.MIN_VALUE},c={min:Number.MAX_VALUE,max:Number.MIN_VALUE},d={min:Number.MAX_VALUE,max:Number.MIN_VALUE};e.forEach(e=>{l.min=Math.min(l.min,e.passiveInsight),l.max=Math.max(l.max,e.passiveInsight),c.min=Math.min(c.min,e.passiveInvestigation),c.max=Math.max(c.max,e.passiveInvestigation),d.min=Math.min(d.min,e.passivePerception),d.max=Math.max(d.max,e.passivePerception)});const p=Math.min(l.min,c.min,d.min),h=Math.max(l.max,c.max,d.max),m=[];for(let y=h;y>=p;--y){const t=e.filter(e=>e.passiveInsight===y).map(e=>e.name).join(", "),a=e.filter(e=>e.passiveInvestigation===y).map(e=>e.name).join(", "),s=e.filter(e=>e.passivePerception===y).map(e=>e.name).join(", ");m.push(n.a.createElement("div",{key:y,className:"table-row"},n.a.createElement("div",{className:"table-cell l small"},y),n.a.createElement("div",{className:"table-cell l"},t),n.a.createElement("div",{className:"table-cell l"},a),n.a.createElement("div",{className:"table-cell l"},s)))}const u=Gt.getAwards().filter(e=>{var t,a;let s=!1;return(null===(t=this.props.party)||void 0===t?void 0:t.awards.includes(e.id))&&(s=!0),null===(a=this.props.party)||void 0===a||a.pcs.forEach(t=>{t.awards.includes(e.id)&&(s=!0)}),s}).map(e=>{var t,a;const s=[];(null===(t=this.props.party)||void 0===t?void 0:t.awards.includes(e.id))&&s.push(this.props.party.name||"unnamed party"),null===(a=this.props.party)||void 0===a||a.pcs.forEach(t=>{t.awards.includes(e.id)&&s.push(t.name||"unnamed pc")});let r=null;return s.length>0&&(r=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"awarded to:",s.map(e=>n.a.createElement(W.a,{key:e},e))))),n.a.createElement(jt,{key:e.id,award:e},r)});let g=n.a.createElement(Le,null,n.a.createElement("p",null,"no awards yet"));return u.length>0&&(g=n.a.createElement("div",null,u)),n.a.createElement("div",null,n.a.createElement("div",{className:"section subheading"},"average level"),n.a.createElement("div",{className:"section"},n.a.createElement(fe.a,{status:"normal",percent:5*t,format:()=>t})),n.a.createElement("hr",null),n.a.createElement("div",{className:"section subheading"},"languages"),n.a.createElement("div",{className:"table alternating"},n.a.createElement("div",{className:"table-row table-row-header"},n.a.createElement("div",{className:"table-cell l"},"language"),n.a.createElement("div",{className:"table-cell l"},"spoken by")),s),i,n.a.createElement("hr",null),n.a.createElement("div",{className:"section subheading"},"darkvision"),n.a.createElement("div",{className:"table alternating"},n.a.createElement("div",{className:"table-row table-row-header"},n.a.createElement("div",{className:"table-cell l small"},"range"),n.a.createElement("div",{className:"table-cell l"},"pcs")),o),n.a.createElement("hr",null),n.a.createElement("div",{className:"section subheading"},"passive skills"),n.a.createElement("div",{className:"table alternating"},n.a.createElement("div",{className:"table-row table-row-header"},n.a.createElement("div",{className:"table-cell l small"}),n.a.createElement("div",{className:"table-cell l"},"insight"),n.a.createElement("div",{className:"table-cell l"},"investigation"),n.a.createElement("div",{className:"table-cell l"},"perception")),m),n.a.createElement(Le,null,n.a.createElement("p",null,"remember that advantage / disadvantage grants +/- 5 to passive rolls")),n.a.createElement("hr",null),n.a.createElement("div",{className:"section subheading"},"awards"),g)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Sa extends n.a.Component{constructor(e){super(e),this.state={playerViewOpen:!1}}setPlayerViewOpen(e){this.setState({playerViewOpen:e})}getPlayerView(){return this.state.playerViewOpen&&this.props.monster?n.a.createElement(wa,{title:"Monster",onCloseWindow:()=>this.setPlayerViewOpen(!1)},n.a.createElement("div",{className:"scrollable"},n.a.createElement(gt,{monster:this.props.monster}))):null}render(){try{let e=null;return this.props.monster&&(e=n.a.createElement("div",null,n.a.createElement(te,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:e=>this.setPlayerViewOpen(e)}),n.a.createElement(te,{label:"share in session",disabled:"started"!==B.getState(),checked:"monster"===G.data.shared.type,onChecked:e=>e?B.shareMonster(this.props.monster):B.shareNothing()}),n.a.createElement("hr",null),n.a.createElement(gt,{monster:this.props.monster}))),n.a.createElement("div",null,e,this.getPlayerView())}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ia extends n.a.Component{render(){try{if(0===this.props.awards.length)return n.a.createElement(Le,null,n.a.createElement("p",null,"no awards"));const e=this.props.awards.map(e=>{let t=null;if(this.props.party){const a=[];this.props.party.awards.includes(e.id)&&a.push(n.a.createElement("div",{key:this.props.party.id,className:"group-panel control-with-icons"},n.a.createElement("div",null,this.props.party.name||"unnamed party"),n.a.createElement("div",{className:"icons"},n.a.createElement(c.a,{onClick:()=>this.props.deleteAward(e.id,this.props.party)}))));const s=[{id:this.props.party.id,text:this.props.party.name||"unnamed party"}];this.props.party.pcs.filter(e=>e.active).forEach(t=>{t.awards.includes(e.id)&&a.push(n.a.createElement("div",{key:t.id,className:"group-panel control-with-icons"},n.a.createElement("div",null,t.name||"unnamed pc"),n.a.createElement("div",{className:"icons"},n.a.createElement(c.a,{onClick:()=>this.props.deleteAward(e.id,t)})))),s.push({id:t.id,text:t.name||"unnamed pc"})}),t=n.a.createElement("div",null,n.a.createElement("hr",null),a,n.a.createElement(se,{placeholder:"award to...",options:s,onSelect:t=>{if(this.props.party)if(t===this.props.party.id)this.props.addAward(e.id,this.props.party);else{const a=this.props.party.pcs.find(e=>e.id===t);a&&this.props.addAward(e.id,a)}}}))}return n.a.createElement(jt,{key:e.id,award:e},t)});return n.a.createElement("div",null,e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ma extends n.a.Component{constructor(e){super(e),this.state={text:""}}setSearchTerm(e){this.setState({text:e})}render(){try{const e=[];return this.state.text.length>2&&(this.props.parties.filter(e=>I.matchParty(this.state.text,e)).forEach(t=>{const a=[];t.pcs.filter(e=>I.matchPC(this.state.text,e)).forEach(e=>{const t=[];e.companions.filter(e=>I.matchCompanion(this.state.text,e)).forEach(e=>{t.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},e.name)))}),a.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},e.name),t))}),e.push(n.a.createElement("div",{key:t.id,className:"group-panel clickable",onClick:()=>this.props.openParty(t.id),role:"button"},n.a.createElement("div",{className:"section"},t.name),a))}),this.props.library.filter(e=>I.matchGroup(this.state.text,e)).forEach(t=>{const a=[];t.monsters.filter(e=>I.matchMonster(this.state.text,e)).forEach(e=>{const t=[];e.traits.filter(e=>I.matchTrait(this.state.text,e)).forEach(e=>{t.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},e.name)))}),a.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},e.name),t))}),e.push(n.a.createElement("div",{key:t.id,className:"group-panel clickable",onClick:()=>this.props.openGroup(t.id),role:"button"},n.a.createElement("div",{className:"section"},t.name),a))}),this.props.encounters.filter(e=>I.matchEncounter(this.state.text,e,e=>this.props.getMonster(e))).forEach(t=>{const a=[];t.slots.filter(e=>I.matchEncounterSlot(this.state.text,e,e=>this.props.getMonster(e))).forEach(e=>{const t=this.props.getMonster(e.monsterID);a.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},t?t.name:"monster")))});const s=[];t.waves.filter(e=>I.matchEncounterWave(this.state.text,e,e=>this.props.getMonster(e))).forEach(e=>{const t=[];e.slots.filter(e=>I.matchEncounterSlot(this.state.text,e,e=>this.props.getMonster(e))).forEach(e=>{const a=this.props.getMonster(e.monsterID);t.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},a?a.name:"monster")))}),s.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},e.name),t))}),e.push(n.a.createElement("div",{key:t.id,className:"group-panel clickable",onClick:()=>this.props.openEncounter(t.id),role:"button"},n.a.createElement("div",{className:"section"},t.name),a,s))}),this.props.maps.filter(e=>I.matchMap(this.state.text,e)).forEach(t=>{const a=[];t.areas.filter(e=>I.matchMapArea(this.state.text,e)).forEach(e=>{a.push(n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement("div",{className:"section"},"map area")))}),e.push(n.a.createElement("div",{key:t.id,className:"group-panel clickable",onClick:()=>this.props.openMap(t.id),role:"button"},n.a.createElement("div",{className:"section"},t.name),a))}),0===e.length&&e.push(n.a.createElement(Le,{key:"empty"},"nothing found"))),n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"search"),n.a.createElement(_,{text:this.state.text,placeholder:"enter your search term here",minLength:3,onChange:e=>this.setSearchTerm(e)})),n.a.createElement("div",{className:"sidebar-content"},e))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var Da=a(197),Ta=a(198),Aa=a(199),Pa=a(200);class Va{static getTarotDeck(){return[].concat(Va.getTarotMinorArcana()).concat(Va.getTarotMajorArcana())}static getTarotMajorArcana(){return[this.createMajorArcana(0,"the fool","innocence, new beginnings, free spirit","recklessness, taken advantage of, inconsideration"),this.createMajorArcana(1,"the magician","willpower, desire, creation, manifestation","trickery, illusions, out of touch"),this.createMajorArcana(2,"the high priestess","intuitive, unconscious, inner voice","lack of center, lost inner voice, repressed feelings"),this.createMajorArcana(3,"the empress","motherhood, fertility, nature","dependence, smothering, emptiness, nosiness"),this.createMajorArcana(4,"the emperor","authority, structure, control, fatherhood","tyranny, rigidity, coldness"),this.createMajorArcana(5,"the hierophant","tradition, conformity, morality, ethics","rebellion, subversiveness, new approaches"),this.createMajorArcana(6,"the lovers","partnerships, duality, union","loss of balance, one-sidedness, disharmony"),this.createMajorArcana(7,"the chariot","direction, control, willpower","lack of control, lack of direction, aggression"),this.createMajorArcana(8,"justice","cause and effect, clarity, truth","dishonesty, unaccountability, unfairness"),this.createMajorArcana(9,"the hermit","contemplation, search for truth, inner guidance","loneliness, isolation, lost your way"),this.createMajorArcana(10,"the wheel of fortune","change, cycles, inevitable fate","no control, clinging to control, bad luck"),this.createMajorArcana(11,"strength","inner strength, bravery, compassion, focus","self doubt, weakness, insecurity"),this.createMajorArcana(12,"the hanged man","sacrifice, release, martyrdom","stalling, needless sacrifice, fear of sacrifice"),this.createMajorArcana(13,"death","end of cycle, beginnings, change, metamorphosis","fear of change, holding on, stagnation, decay"),this.createMajorArcana(14,"temperance","middle path, patience, finding meaning","extremes, excess, lack of balance"),this.createMajorArcana(15,"the devil","addiction, materialism, playfulness","freedom, release, restoring control"),this.createMajorArcana(16,"the tower","sudden upheaval, broken pride, disaster","disaster avoided, delayed disaster, fear of suffering"),this.createMajorArcana(17,"the star","hope, faith, rejuvenation","faithlessness, discouragement, insecurity"),this.createMajorArcana(18,"the moon","unconscious, illusions, intuition","confusion, fear, misinterpretation"),this.createMajorArcana(19,"the sun","joy, success, celebration, positivity","negativity, depression, sadness"),this.createMajorArcana(20,"judgement","reflection, reckoning, awakening","lack of self awareness, doubt, self loathing"),this.createMajorArcana(21,"the world","fulfillment, harmony, completion","incompletion, no closure")]}static getTarotMinorArcana(){return[this.createMinorArcana("ace","swords","breakthrough, clarity, sharp mind","confusion, brutality, chaos"),this.createMinorArcana(2,"swords","difficult choices, indecision, stalemate","lesser of two evils, no right choice, confusion"),this.createMinorArcana(3,"swords","heartbreak, suffering, grief","recovery, forgiveness, moving on"),this.createMinorArcana(4,"swords","rest, restoration, contemplation","restlessness, burnout, stress"),this.createMinorArcana(5,"swords","unbridled ambition, win at all costs, sneakiness","lingering resentment, desire to reconcile, forgiveness"),this.createMinorArcana(6,"swords","transition, leaving behind, moving on","emotional baggage, unresolved issues, resisting transition"),this.createMinorArcana(7,"swords","deception, trickery, tactics and strategy","coming clean, rethinking approach, deception"),this.createMinorArcana(8,"swords","imprisonment, entrapment, self-victimization","self acceptance, new perspective, freedom"),this.createMinorArcana(9,"swords","anxiety, hopelessness, trauma","hope, reaching out, despair"),this.createMinorArcana(10,"swords","failure, collapse, defeat","can't get worse, only upwards, inevitable end"),this.createMinorArcana("page","swords","curiosity, restlessness, mental energy","deception, manipulation, all talk"),this.createMinorArcana("knight","swords","action, impulsiveness, defending beliefs","no direction, disregard for consequences, unpredictability"),this.createMinorArcana("queen","swords","complexity, perceptiveness, clear mindedness","cold hearted, cruel, bitterness"),this.createMinorArcana("king","swords","head over heart, discipline, truth","manipulative, cruel, weakness"),this.createMinorArcana("ace","wands","creation, willpower, inspiration, desire","lack of energy, lack of passion, boredom"),this.createMinorArcana(2,"wands","planning, making decisions, leaving home","fear of change, playing safe, bad planning"),this.createMinorArcana(3,"wands","looking ahead, expansion, rapid growth","obstacles, delays, frustration"),this.createMinorArcana(4,"wands","community, home, celebration","lack of support, transience, home conflicts"),this.createMinorArcana(5,"wands","competition, rivalry, conflict","avoiding conflict, respecting differences"),this.createMinorArcana(6,"wands","victory, success, public reward","excess pride, lack of recognition, punishment"),this.createMinorArcana(7,"wands","perseverance, defensive, maintaining control","give up, destroyed confidence, overwhelmed"),this.createMinorArcana(8,"wands","rapid action, movement, quick decisions","panic, waiting, slowdown"),this.createMinorArcana(9,"wands","resilience, grit, last stand","exhaustion, fatigue, questioning motivations"),this.createMinorArcana(10,"wands","accomplishment, responsibility, burden","inability to delegate, overstressed, burnt out"),this.createMinorArcana("page","wands","exploration, excitement, freedom","lack of direction, procrastination, creating conflict"),this.createMinorArcana("knight","wands","action, adventure, fearlessness","anger, impulsiveness, recklessness"),this.createMinorArcana("queen","wands","courage, determination, joy","selfishness, jealousy, insecurities"),this.createMinorArcana("king","wands","big picture, leader, overcoming challenges","impulsive, overbearing, unachievable expectations"),this.createMinorArcana("ace","cups","new feelings, spirituality, intuition","emotional loss, blocked creativity, emptiness"),this.createMinorArcana(2,"cups","unity, partnership, connection","imbalance, broken communication, tension"),this.createMinorArcana(3,"cups","friendship, community, happiness","overindulgence, gossip, isolation"),this.createMinorArcana(4,"cups","apathy, contemplation, disconnectedness","sudden awareness, choosing happiness, acceptance"),this.createMinorArcana(5,"cups","loss, grief, self-pity","acceptance, moving on, finding peace"),this.createMinorArcana(6,"cups","familiarity, happy memories, healing","moving forward, leaving home, independence"),this.createMinorArcana(7,"cups","searching for purpose, choices, daydreaming","lack of purpose, diversion, confusion"),this.createMinorArcana(8,"cups","walking away, disillusionment, leaving behind","avoidance, fear of change, fear of loss"),this.createMinorArcana(9,"cups","satisfaction, emotional stability, luxury","lack of inner joy, smugness, dissatisfaction"),this.createMinorArcana(10,"cups","inner happiness, fulfillment, dreams coming true","shattered dreams, broken family, domestic disharmony"),this.createMinorArcana("page","cups","happy surprise, dreamer, sensitivity","emotional immaturity, insecurity, disappointment"),this.createMinorArcana("knight","cups","following the heart, idealist, romantic","moodiness, disappointment"),this.createMinorArcana("queen","cups","compassion, calm, comfort","martyrdom, insecurity, dependence"),this.createMinorArcana("king","cups","compassion, control, balance","coldness, moodiness, bad advice"),this.createMinorArcana("ace","pentacles","opportunity, prosperity, new venture","lost opportunity, missed chance, bad investment"),this.createMinorArcana(2,"pentacles","balancing decisions, priorities, adapting to change","loss of balance, disorganized, overwhelmed"),this.createMinorArcana(3,"pentacles","teamwork, collaboration, building","lack of teamwork, disorganized, group conflict"),this.createMinorArcana(4,"pentacles","conservation, frugality, security","greediness, stinginess, possessiveness"),this.createMinorArcana(5,"pentacles","need, poverty, insecurity","recovery, charity, improvement"),this.createMinorArcana(6,"pentacles","charity, generosity, sharing","strings attached, stinginess, power and domination"),this.createMinorArcana(7,"pentacles","hard work, perseverance, diligence","work without results, distractions, lack of rewards"),this.createMinorArcana(8,"pentacles","apprenticeship, passion, high standards","lack of passion, uninspired, no motivation"),this.createMinorArcana(9,"pentacles","fruits of labor, rewards, luxury","reckless spending, living beyond means, false success"),this.createMinorArcana(10,"pentacles","legacy, culmination, inheritance","fleeting success, lack of stability, lack of resources"),this.createMinorArcana("page","pentacles","ambition, desire, diligence","lack of commitment, greediness, laziness"),this.createMinorArcana("knight","pentacles","efficiency, hard work, responsibility","laziness, obsessiveness, work without reward"),this.createMinorArcana("queen","pentacles","practicality, creature comforts, financial security","self-centeredness, jealousy, smothering"),this.createMinorArcana("king","pentacles","abundance, prosperity, security","greed, indulgence, sensuality")]}static createMinorArcana(e,t,a,s){return{id:b.guid(),value:e,name:e+" of "+t,data:{upright:a,reversed:s}}}static createMajorArcana(e,t,a,s){return{id:b.guid(),value:e,name:t,data:{upright:a,reversed:s}}}static getStandardDeck(){const e=[];return["hearts","diamonds","spades","clubs"].forEach(t=>{let a=0;switch(t){case"hearts":a=9829;break;case"diamonds":a=9830;break;case"spades":a=9824;break;case"clubs":a=9827}["ace",2,3,4,5,6,7,8,9,10,"jack","queen","king"].forEach(s=>{e.push(Va.createCard(s,t,a))})}),e}static getStandardDeckWithJokers(){const e=Va.getStandardDeck();return e.push(Va.createJoker()),e.push(Va.createJoker()),e}static createCard(e,t,a){return{id:b.guid(),value:e,name:e+" of "+t,data:a}}static createJoker(){return{id:b.guid(),value:"",name:"joker",data:null}}static getDeckOfManyThings(){return[Va.createManyThingsCard("vizier"),Va.createManyThingsCard("sun"),Va.createManyThingsCard("moon"),Va.createManyThingsCard("star"),Va.createManyThingsCard("comet"),Va.createManyThingsCard("the fates"),Va.createManyThingsCard("throne"),Va.createManyThingsCard("key"),Va.createManyThingsCard("knight"),Va.createManyThingsCard("gem"),Va.createManyThingsCard("talons"),Va.createManyThingsCard("the void"),Va.createManyThingsCard("flames"),Va.createManyThingsCard("skull"),Va.createManyThingsCard("idiot"),Va.createManyThingsCard("donjon"),Va.createManyThingsCard("ruin"),Va.createManyThingsCard("euryale"),Va.createManyThingsCard("rogue"),Va.createManyThingsCard("balance"),Va.createManyThingsCard("fool"),Va.createManyThingsCard("jester")]}static getDeckOfManyThingsSmall(){return[Va.createManyThingsCard("sun"),Va.createManyThingsCard("moon"),Va.createManyThingsCard("star"),Va.createManyThingsCard("throne"),Va.createManyThingsCard("key"),Va.createManyThingsCard("knight"),Va.createManyThingsCard("the void"),Va.createManyThingsCard("flames"),Va.createManyThingsCard("skull"),Va.createManyThingsCard("ruin"),Va.createManyThingsCard("euryale"),Va.createManyThingsCard("rogue"),Va.createManyThingsCard("jester")]}static createManyThingsCard(e){return{id:b.guid(),value:"",name:e,data:9763}}}class Oa extends n.a.Component{getDieTypeBox(e){const t=this.props.dice[e];return n.a.createElement("div",{className:t>0?"die-type":"die-type none",onClick:t=>this.dieTypeClicked(t,e,!t.ctrlKey),onContextMenu:t=>this.dieTypeClicked(t,e,!1),role:"button"},n.a.createElement("div",{className:"die-type-name"},"d",100===e?"%":e),n.a.createElement("div",{className:"die-type-value"},t))}getConstantBox(){const e=this.props.constant;return n.a.createElement("div",{className:e>0?"die-type":"die-type none",onClick:e=>this.dieTypeClicked(e,0,!e.ctrlKey),onContextMenu:e=>this.dieTypeClicked(e,0,!1),role:"button"},n.a.createElement("div",{className:"die-type-name"},"+/-"),n.a.createElement("div",{className:"die-type-value"},e))}dieTypeClicked(e,t,a){if(e.preventDefault(),0===t){const e=this.props.constant+(a?1:-1);this.props.setConstant(e)}else{const e=Math.max(this.props.dice[t]+(a?1:-1),0);this.props.setDie(t,e)}}render(){try{const e=this.props.dice[4]+this.props.dice[6]+this.props.dice[8]+this.props.dice[10]+this.props.dice[12]+this.props.dice[20]+this.props.dice[100];let t="";[100,20,12,10,8,6,4].forEach(e=>{0!==this.props.dice[e]&&(t&&(t+=" + "),t+=this.props.dice[e]+"d"+e)}),0!==this.props.constant&&(t&&(this.props.constant>0?t+=" + ":t+=" - "),t+=Math.abs(this.props.constant));let a=null;return a=1===e&&1===this.props.dice[20]?n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:8},n.a.createElement("button",{onClick:()=>this.props.rollDice("")},"roll ",t)),n.a.createElement(h.a,{span:8},n.a.createElement("button",{onClick:()=>this.props.rollDice("advantage")},"advantage")),n.a.createElement(h.a,{span:8},n.a.createElement("button",{onClick:()=>this.props.rollDice("disadvantage")},"disadvantage"))):n.a.createElement("div",null,n.a.createElement("button",{className:e>0?"":"disabled",onClick:()=>this.props.rollDice("")},"roll ",t)),n.a.createElement("div",{className:"die-roll-panel"},n.a.createElement("div",{className:"die-types"},this.getDieTypeBox(4),this.getDieTypeBox(6),this.getDieTypeBox(8),this.getDieTypeBox(10),this.getDieTypeBox(12),this.getDieTypeBox(20),this.getDieTypeBox(100),this.getConstantBox()),n.a.createElement("hr",null),n.a.createElement(p.a,{gutter:10,align:"middle"},n.a.createElement(h.a,{span:22},a),n.a.createElement(h.a,{span:2,className:"section centered"},n.a.createElement(c.a,{className:e>0?"die-reset-button":"die-reset-button disabled",title:"reset dice",onClick:()=>this.props.resetDice()}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class La extends n.a.Component{constructor(e){super(e),this.state={flipped:!1}}flip(){this.setState({flipped:!this.state.flipped})}render(){try{let e="",t="",a="";return this.props.card.data&&("number"===typeof this.props.card.data?(e=String.fromCharCode(this.props.card.data),t="suit",a=String.fromCharCode(this.props.card.data)):(e=this.props.reversed?this.props.card.data.reversed:this.props.card.data.upright,a=this.props.reversed?"(reversed)":"")),n.a.createElement("div",{className:this.state.flipped?"playing-card flipped":"playing-card",onClick:()=>this.flip(),role:"button"},n.a.createElement("div",{className:"playing-card-inner"},n.a.createElement("div",{className:"playing-card-front"},"?"),n.a.createElement("div",{className:"playing-card-back"},n.a.createElement("div",{className:"playing-card-name"},n.a.createElement("div",null,this.props.card.name)),n.a.createElement("div",{className:"playing-card-data scrollable "+t},n.a.createElement("div",null,e)),n.a.createElement("div",{className:"playing-card-footer"},n.a.createElement("div",null,a),n.a.createElement("div",null,n.a.createElement("b",null,"number"===typeof this.props.card.value?this.props.card.value:""))))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}const Ra=new ke.a.Converter;Ra.setOption("tables",!0);class za extends n.a.Component{render(){try{if(this.props.people.length<2)return n.a.createElement(Le,{key:"empty"},n.a.createElement("p",null,"no-one else is currently connected"));const e=this.props.people.map(e=>{let t=null;return"dm"===this.props.user&&e.id!==G.getID()&&(t=n.a.createElement(c.a,{title:"kick",onClick:()=>this.props.kick(e.id)})),n.a.createElement("div",{key:e.id,className:"group-panel person"},n.a.createElement("div",{className:"person-details"},n.a.createElement(ja,{person:e}),n.a.createElement("div",{className:"status"},e.status)),n.a.createElement("div",{className:"person-icon"},t))});return n.a.createElement("div",{className:"connections-panel"},e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class qa extends n.a.Component{constructor(e){super(e);const t=G.getID(),a=G.data.people.find(e=>e.id===t);this.state={status:a?a.status:""}}setStatus(e){this.setState({status:e})}sendPlayerUpdate(){const e=G.getID(),t=G.data.people.find(t=>t.id===e);t&&j.sendUpdate(this.state.status,t.characterID)}render(){return n.a.createElement("div",{className:"player-status-panel"},n.a.createElement("div",{className:"control-with-icons"},n.a.createElement(_,{placeholder:"update your status",debounce:!1,text:this.state.status,onChange:e=>this.setStatus(e),onPressEnter:()=>this.sendPlayerUpdate()}),n.a.createElement("div",{className:"icons"},n.a.createElement(Da.a,{onClick:()=>this.sendPlayerUpdate(),title:"update status"}))),n.a.createElement(Ce,{text:"disconnect",onConfirm:()=>j.disconnect()}))}}class Fa extends n.a.Component{constructor(...e){super(...e),this.bottom=n.a.createRef(),this.scrollToBottom=()=>{this.bottom&&this.bottom.current&&this.bottom.current.scrollIntoView({behavior:"smooth"})}}componentDidMount(){this.scrollToBottom()}componentDidUpdate(){this.scrollToBottom()}showMessage(e){const t=G.getID();return e.from===t||0===e.to.length||e.to.includes(t)}render(){try{const e=this.props.messages.filter(e=>this.showMessage(e)).map(e=>n.a.createElement(Ga,{key:e.id,user:this.props.user,message:e,openImage:e=>this.props.openImage(e)}));return 0===e.length&&e.push(n.a.createElement(Le,{key:"empty"},n.a.createElement("p",null,"no messages yet"))),n.a.createElement("div",{className:"messages-panel"},e,n.a.createElement("div",{ref:this.bottom}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ga extends n.a.Component{render(){try{let e=G.getCurrentName(this.props.message.from),t="message",a="message-byline";const s="message-content";let r=null;this.props.message.from===G.getID()?t+=" from-me":t+=" to-me";let i=null;switch(this.props.message.type){case"text":const e=this.props.message.data.text,t=this.props.message.data.language,a=this.props.message.data.untranslated;if("player"===this.props.user&&""!==t){let e=!1;if(G.data.party){const a=G.getCharacterID(G.getID()),s=G.data.party.pcs.find(e=>e.id===a);s&&(e=-1!==s.languages.toLowerCase().indexOf(t.toLowerCase()))}e||(i=n.a.createElement("div",{className:"text"},n.a.createElement("div",{className:"text untranslated"},a),n.a.createElement("div",{className:"language"},"in an unknown language")))}i||(i=e.startsWith("/")?n.a.createElement("div",{className:"emote"},G.getName(this.props.message.from)+" "+e.substr(1)):n.a.createElement("div",{className:"text"},n.a.createElement("div",{dangerouslySetInnerHTML:{__html:Ra.makeHtml(e)}}),""!==t?n.a.createElement("div",{className:"language"},"in ",t):null));break;case"link":const s=this.props.message.data.url;i=n.a.createElement("a",{className:"link",href:s,target:"_blank",rel:"noopener noreferrer"},s);break;case"image":const r=this.props.message.data.image;i=n.a.createElement("img",{className:"selectable-image",src:r,alt:"shared",onClick:()=>this.props.openImage(r)});break;case"roll":const o=this.props.message.data.roll;i=n.a.createElement(Wt,{result:o});break;case"card":const l=this.props.message.data.card;i=n.a.createElement(p.a,{justify:"space-around"},n.a.createElement(h.a,{span:10},n.a.createElement(La,{card:l.card,reversed:l.reversed})))}return 0!==this.props.message.to.length&&(e+=" to "+this.props.message.to.map(e=>G.getCurrentName(e)).join(", "),a+=" private",r=n.a.createElement(Ta.a,{title:"private message"})),n.a.createElement("div",{className:t},n.a.createElement("div",{className:a},e,r),n.a.createElement("div",{className:s},i))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ba extends n.a.Component{constructor(e){super(e);const t={};[4,6,8,10,12,20,100].forEach(e=>t[e]=0),t[20]=1,this.state={type:"text",message:"",language:"",multiline:!1,url:"",image:"",dice:t,constant:0,deck:"tarot deck",mode:"public",recipients:[]}}setType(e){this.setState({type:e})}setMessage(e){this.setState({message:e})}setLanguage(e){this.setState({language:e})}toggleMultiline(){this.setState({multiline:!this.state.multiline})}setURL(e){this.setState({url:e})}setImage(e){this.setState({image:e})}readFile(e){const t=new FileReader;return t.onload=e=>{if(e.target){const t=e.target.result;this.setImage(t)}},t.readAsDataURL(e),!1}setDie(e,t){const a=this.state.dice;a[e]=t,this.setState({dice:a})}setConstant(e){this.setState({constant:e})}setDeck(e){this.setState({deck:e})}resetDice(){const e=this.state.dice;[4,6,8,10,12,20,100].forEach(t=>e[t]=0),this.setState({dice:e,constant:0})}setMode(e){this.setState({mode:e,recipients:"public"===e?[]:this.state.recipients})}addRecipient(e){const t=this.state.recipients;t.push(e),this.setState({recipients:t})}removeRecipient(e){const t=this.state.recipients,a=t.indexOf(e);t.splice(a,1),this.setState({recipients:t})}canSend(){let e=!1;switch(this.state.mode){case"public":e=!0;break;case"private":e=this.state.recipients.length>0}let t=!1;switch(this.state.type){case"text":t=""!==this.state.message;break;case"link":t=""!==this.state.url;break;case"image":t=""!==this.state.image;break;case"roll":case"card":t=!0}return e&&t}sendMessage(){var e=this;return Object(ha.a)(pa.a.mark((function t(){var a,s,n,r;return pa.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.canSend()&&(a=[...e.state.recipients],s=e.state.message.split("\n").join("\n\n"),n=e.state.language,r=""===n?"":D.generateTranslation(s),e.setState({message:""},()=>{e.props.sendMessage(a,s,n,r)}));case 1:case"end":return t.stop()}}),t)})))()}sendLink(){if(this.canSend()){const e=[...this.state.recipients],t=this.state.url;this.setState({url:""},()=>{this.props.sendLink(e,t)})}}sendImage(){if(this.canSend()){const e=[...this.state.recipients],t=this.state.image;this.setState({image:""},()=>{this.props.sendImage(e,t)})}}sendRoll(e){if(this.canSend()){const t=[...this.state.recipients],a=f.rollDice(this.state.dice,this.state.constant,e);this.props.sendRoll(t,a)}}sendCard(){if(this.canSend()){const e=[...this.state.recipients];let t=[];switch(this.state.deck){case"tarot deck":t=Va.getTarotDeck();break;case"tarot deck (major arcana)":t=Va.getTarotMajorArcana();break;case"tarot deck (minor arcana)":t=Va.getTarotMinorArcana();break;case"standard deck":t=Va.getStandardDeck();break;case"standard deck (with jokers)":t=Va.getStandardDeckWithJokers();break;case"deck of many things":t=Va.getDeckOfManyThings();break;case"deck of many things (13 cards)":t=Va.getDeckOfManyThingsSmall()}const a=t[b.randomNumber(t.length)],s={id:b.guid(),card:a,reversed:b.randomBoolean()};this.props.sendCard(e,s)}}getMessageSection(){switch(this.state.type){case"text":let e=null;if(G.data.party){let t=[];if("dm"===this.props.user)t=D.getKnownLanguages(G.data.party.pcs),t.push("(some other language)");else{const e=G.getCharacterID(G.getID()),a=G.data.party.pcs.find(t=>t.id===e);a&&(t=D.getKnownLanguages([a]))}e=n.a.createElement(se,{placeholder:"(no language specified)",options:t.map(e=>({id:e,text:e})),selectedID:this.state.language,onSelect:e=>this.setLanguage(e),onClear:()=>this.setLanguage("")})}return n.a.createElement("div",null,n.a.createElement("div",{className:"control-with-icons"},n.a.createElement(_,{placeholder:"send a message",multiLine:this.state.multiline,debounce:!1,text:this.state.message,onChange:e=>this.setMessage(e),onPressEnter:()=>this.sendMessage()}),n.a.createElement("div",{className:"icons"},n.a.createElement(Aa.a,{onClick:()=>this.toggleMultiline(),title:"expand",className:this.state.multiline?"active":""}),n.a.createElement(Da.a,{onClick:()=>this.sendMessage(),title:"send message",className:this.canSend()?"":"disabled"}))),e);case"link":return n.a.createElement("div",{className:"control-with-icons"},n.a.createElement(_,{placeholder:"send a link",debounce:!1,text:this.state.url,onChange:e=>this.setURL(e),onPressEnter:()=>this.sendLink()}),n.a.createElement("div",{className:"icons"},n.a.createElement(Da.a,{onClick:()=>this.sendLink(),title:"send link",className:this.canSend()?"":"disabled"})));case"image":return""!==this.state.image?n.a.createElement("div",null,n.a.createElement("img",{className:"nonselectable-image",src:this.state.image,alt:"shared"}),n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.setImage("")},"clear")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{className:this.canSend()?"":"disabled",onClick:()=>this.sendImage()},"send")))):n.a.createElement("div",null,n.a.createElement(Q.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")));case"roll":return n.a.createElement(Oa,{dice:this.state.dice,constant:this.state.constant,setDie:(e,t)=>this.setDie(e,t),setConstant:e=>this.setConstant(e),resetDice:()=>this.resetDice(),rollDice:e=>this.sendRoll(e)});case"card":return n.a.createElement("div",null,n.a.createElement(se,{options:["tarot deck","tarot deck (major arcana)","tarot deck (minor arcana)","standard deck","standard deck (with jokers)","deck of many things","deck of many things (13 cards)"].map(e=>({id:e,text:e})),selectedID:this.state.deck,onSelect:e=>this.setDeck(e)}),n.a.createElement("button",{onClick:()=>this.sendCard()},"draw a card"));case"settings":return this.getSettingsSection()}return null}getSettingsSection(){let e=null;if("private"===this.state.mode){const t=G.data.people.filter(e=>e.id!==G.getID()).map(e=>n.a.createElement(te,{key:e.id,label:G.getCurrentName(e.id),checked:this.state.recipients.includes(e.id),onChecked:t=>t?this.addRecipient(e.id):this.removeRecipient(e.id)}));let a=null;0===this.state.recipients.length&&(a=n.a.createElement(Le,null,n.a.createElement("p",null,"for a private message, you must select at least one person"))),e=n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"choose who to send your message to"),t,a)}return n.a.createElement("div",null,n.a.createElement(pe,{options:["public","private"].map(e=>({id:e,text:e})),selectedID:this.state.mode,onSelect:e=>this.setMode(e)}),e)}render(){try{if(G.data.people.length<2)return null;let e=null;return e="public"===this.state.mode?n.a.createElement(Pa.a,{title:"message is public",onClick:()=>this.setType("settings")}):n.a.createElement(Ta.a,{title:"message is private",onClick:()=>this.setType("settings")}),n.a.createElement("div",{className:"send-message-panel"},n.a.createElement("div",{className:"message-controls"},n.a.createElement(pe,{options:["text","link","image","roll","card"].map(e=>({id:e,text:e})),selectedID:this.state.type,onSelect:e=>this.setType(e)}),e),this.getMessageSection())}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ja extends n.a.Component{render(){if(!this.props.person)return null;if(null!==G.data.party){const e=this.props.person.characterID,t=G.data.party.pcs.find(t=>t.id===e);if(t)return n.a.createElement("div",{className:"character-panel"},n.a.createElement($,{source:t,inline:!0}),n.a.createElement("div",{className:"name pc"},t.name))}return n.a.createElement("div",{className:"character-panel"},n.a.createElement("div",{className:"name"},this.props.person.name))}}class Ua extends n.a.Component{getContent(){return"connected"===j.getState()?n.a.createElement(Fa,{user:"player",messages:G.data.messages,openImage:e=>this.props.openImage(e)}):null}getFooter(){return"connected"===j.getState()?n.a.createElement("div",{className:"sidebar-footer"},n.a.createElement(Ba,{user:"player",sendMessage:(e,t,a,s)=>j.sendMessage(e,t,a,s),sendLink:(e,t)=>j.sendLink(e,t),sendImage:(e,t)=>j.sendImage(e,t),sendRoll:(e,t)=>j.sendRoll(e,t),sendCard:(e,t)=>j.sendCard(e,t)})):null}render(){return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"chat")),n.a.createElement("div",{className:"sidebar-content"},this.getContent()),this.getFooter())}}class Ha extends n.a.Component{getContent(){if("connected"===j.getState()){if(G.data.options.allowControls){let e=[],t=null,a="bright light";if("combat"===G.data.shared.type){const s=G.data.shared.data;e=s.combatants,t=s.map,a=s.lighting}if("exploration"===G.data.shared.type){const s=G.data.shared.data;e=s.combatants,t=s.map,a=s.lighting}const s=G.getCharacterID(G.getID()),r=e.find(e=>e.id===s);return r?n.a.createElement(Re,{combatants:[r],allCombatants:e,map:t,options:this.props.options,lighting:a,showTabs:!1,toggleTag:(e,t)=>{e.forEach(e=>{e.tags.includes(t)?e.tags=e.tags.filter(e=>e!==t):e.tags.push(t)}),j.sendSharedUpdate(),this.props.onUpdated()},toggleCondition:(e,t)=>{e.forEach(e=>{if(e.conditions.some(e=>e.name===t))e.conditions=e.conditions.filter(e=>e.name!==t);else{const a=E.createCondition();a.name=t,e.conditions.push(a),e.conditions=b.sort(e.conditions,[{field:"name",dir:"asc"}])}}),j.sendSharedUpdate(),this.props.onUpdated()},toggleHidden:e=>{e.forEach(e=>e.showOnMap=!e.showOnMap),j.sendSharedUpdate(),this.props.onUpdated()},addCondition:t=>this.props.addCondition(t,e),editCondition:(t,a)=>this.props.editCondition(t,a,e),deleteCondition:(e,t)=>{e.conditions=e.conditions.filter(e=>e.name!==t.name),j.sendSharedUpdate(),this.props.onUpdated()},mapAdd:e=>this.props.toggleAddingToMap(),mapMove:(a,s,n)=>{a.filter(e=>null!==e.path).forEach(e=>{const a=t.items.find(t=>t.id===e.id);a&&e.path&&e.path.push({x:a.x,y:a.y,z:a.z})});const r=a.map(e=>e.id),i=M.getMountsAndRiders(r,e).map(e=>e.id);r.forEach(e=>{i.includes(e)||i.push(e)}),i.forEach(e=>V.move(t,e,s,n)),M.setMountPositions(e,t),j.sendSharedUpdate(),this.props.onUpdated()},mapRemove:a=>{const s=a.map(e=>e.id),n=M.getMountsAndRiders(s,e).map(e=>e.id);s.forEach(e=>{n.includes(e)||n.push(e)}),n.forEach(e=>V.remove(t,e)),j.sendSharedUpdate(),this.props.onUpdated()},undoStep:e=>{if(e.path&&e.path.length>0){const a=t.items.find(t=>t.id===e.id);if(a){const t=e.path[e.path.length-1];a.x=t.x,a.y=t.y,a.z=t.z,e.path.splice(e.path.length-1,1),j.sendSharedUpdate(),this.props.onUpdated()}}},addCompanion:t=>{e.push(M.convertCompanionToCombatant(t)),b.sort(e,[{field:"displayName",dir:"asc"}]),j.sendSharedUpdate(),this.props.onUpdated()},changeValue:(e,t,a)=>{e[t]=a,j.sendSharedUpdate(),this.props.onUpdated()},nudgeValue:(e,t,a)=>{let s=null;switch(t){case"displaySize":s=f.nudgeSize(e.displaySize,a);break;default:s=e[t]+a}if(e[t]=s,"combat"===G.data.shared.type){const e=G.data.shared.data;M.sortCombatants(e)}j.sendSharedUpdate(),this.props.onUpdated()}}):n.a.createElement(Le,null,n.a.createElement("p",null,"when you choose your character, you will be able to control it here"))}return n.a.createElement(Le,null,n.a.createElement("p",null,"you haven't been given control of your character"))}return n.a.createElement(Le,null,n.a.createElement("p",null,"you're not connected"))}render(){return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"controls")),n.a.createElement("div",{className:"sidebar-content"},this.getContent()))}}class Ya extends n.a.Component{getContent(){return"connected"===j.getState()?n.a.createElement("div",null,n.a.createElement(qa,null),n.a.createElement("hr",null),n.a.createElement(za,{user:"player",people:G.data.people,kick:e=>null})):null}render(){return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"session")),n.a.createElement("div",{className:"sidebar-content"},this.getContent()))}}class Wa extends n.a.Component{constructor(e){super(e),this.state={selectedPartyID:1===this.props.parties.length?this.props.parties[0].id:null}}setSelectedPartyID(e){this.setState({selectedPartyID:e})}getContent(){switch(B.getState()){case"not started":return this.getNotStartedContent();case"starting":return this.getStartingContent();case"started":return this.getStartedContent()}}getNotStartedContent(){return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"select a party, then click the 'start' button to allow your players to connect to the game session"),n.a.createElement("p",null,"you can then send messages and share content such as handouts, combat encounters, and map explorations")),n.a.createElement(se,{placeholder:"select a party...",options:this.props.parties.map(e=>({id:e.id,text:e.name})),selectedID:this.state.selectedPartyID,onSelect:e=>this.setSelectedPartyID(e)}),n.a.createElement("button",{className:this.state.selectedPartyID?"":"disabled",onClick:()=>{const e=this.props.parties.find(e=>e.id===this.state.selectedPartyID);e&&B.init(e)}},"start the session"))}getStartingContent(){return n.a.createElement(Le,null,n.a.createElement("p",null,"starting session..."))}getStartedContent(){switch(this.props.view){case"messages":return n.a.createElement(Fa,{user:"dm",messages:G.data.messages,openImage:e=>this.props.openImage(e)});case"people":return n.a.createElement(za,{user:"dm",people:G.data.people,kick:e=>{B.kick(e),this.forceUpdate()}});case"management":let e="https://andyaiken.github.io/dojo/#/player/"+G.getID();"localhost"===window.location.hostname&&(e="http://localhost:3000/dojo/#/player/"+G.getID());let t=null;switch(G.data.shared.type){case"nothing":t="(nothing)";break;case"combat":t="encounter ("+G.data.shared.data.encounter.name+")";break;case"exploration":t="map ("+G.data.shared.data.map.name+")";break;case"handout":t="handout ("+G.data.shared.data.title+")";break;case"monster":t="monster ("+G.data.shared.data.name+")"}let a=null;return"nothing"!==G.data.shared.type&&(a=n.a.createElement(Ce,{text:"stop sharing",onConfirm:()=>B.shareNothing()})),n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"give the following link to your players, and ask them to open the player app in their browser")),n.a.createElement("div",{className:"generated-item group-panel"},n.a.createElement("div",{className:"text-section small"},n.a.createElement("p",null,"player app link:"),n.a.createElement("p",null,n.a.createElement("b",null,e))),n.a.createElement("div",{className:"icon-section"},n.a.createElement(ma.a,{title:"copy to clipboard",onClick:t=>navigator.clipboard.writeText(e)}))),n.a.createElement("hr",null),n.a.createElement("div",{className:"subheading"},"currently sharing"),n.a.createElement("div",{className:"section"},t),a,n.a.createElement("hr",null),n.a.createElement("div",{className:"subheading"},"options"),n.a.createElement(te,{label:"allow chat",checked:G.data.options.allowChat,onChecked:e=>B.setOption("allowChat",e)}),n.a.createElement(te,{label:"allow players to control their characters",checked:G.data.options.allowControls,onChecked:e=>B.setOption("allowControls",e)}),n.a.createElement(Ce,{text:"end the session",onConfirm:()=>B.shutdown()}))}return null}getViewSelector(){if("started"!==B.getState())return null;const e=[];return e.push("management"),e.push("people"),G.data.options.allowChat&&e.push("messages"),n.a.createElement(pe,{options:e.map(e=>({id:e,text:e})),selectedID:this.props.view,onSelect:e=>this.props.setView(e)})}getFooter(){return"started"===B.getState()&&"messages"===this.props.view?n.a.createElement("div",{className:"sidebar-footer"},n.a.createElement(Ba,{user:"dm",sendMessage:(e,t,a,s)=>B.sendMessage(e,t,a,s),sendLink:(e,t)=>B.sendLink(e,t),sendImage:(e,t)=>B.sendImage(e,t),sendRoll:(e,t)=>B.sendRoll(e,t),sendCard:(e,t)=>B.sendCard(e,t)})):null}render(){return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"session"),this.getViewSelector()),n.a.createElement("div",{className:"sidebar-content"},this.getContent()),this.getFooter())}}var Ja=a(201);class _a{static say(e,t){return Object(ha.a)(pa.a.mark((function a(){var s;return pa.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return window.speechSynthesis.cancel(),s=new SpeechSynthesisUtterance(e),a.next=4,_a.chooseVoice(t);case 4:s.voice=a.sent,s.rate=_a.randomValue(.5,1.5),s.pitch=_a.randomValue(.5,1.5),window.speechSynthesis.speak(s);case 8:case"end":return a.stop()}}),a)})))()}static chooseVoice(e){return Object(ha.a)(pa.a.mark((function t(){var a,s,n,r;return pa.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_a.getVoices();case 2:return a=t.sent,s=e.map(e=>_a.getLanguageCode(e)),0===(n=a.filter(e=>s.includes(e.lang.substr(0,2)))).length&&(n=a.filter(e=>e.default)),0===n.length&&(n=a),r=b.randomNumber(n.length),t.abrupt("return",n[r]);case 9:case"end":return t.stop()}}),t)})))()}static getVoices(){return new Promise(e=>{let t=window.speechSynthesis.getVoices();t.length>0?e(t):speechSynthesis.onvoiceschanged=()=>{t=window.speechSynthesis.getVoices(),e(t)}})}static getLanguageCode(e){switch(e){case"armenian":return"hy";case"basque":return"eu";case"bulgarian":return"bg";case"chichewa":return"ny";case"chinese":return"zh";case"croatian":return"hr";case"czech":return"cs";case"dutch":return"nl";case"german":return"de";case"greek":return"el";case"icelandic":return"is";case"irish":return"ga";case"kannada":return"kn";case"kazakh":return"kk";case"latvian":return"lv";case"lithuanian":return"lt";case"macedonian":return"mk";case"malay":return"ms";case"maltese":return"mt";case"maori":return"mi";case"polish":return"pl";case"portuguese":return"pt";case"punjabi":return"pa";case"samoan":return"sm";case"serbian":return"sr";case"shona":return"sn";case"spanish":return"es";case"swedish":return"sv";case"turkish":return"tr";case"welsh":return"cy";default:return e.substr(0,2)}}static randomValue(e,t){return e+(b.randomDecimal()+b.randomDecimal()+b.randomDecimal())/3*(t-e)}}var Ka=a(61);Ka.c.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Ka.c.version,"/pdf.worker.js");class Xa extends n.a.Component{constructor(e){super(e),this.state={pageCount:1,page:1}}setPageCount(e){this.setState({pageCount:e})}nudgePage(e){let t=Math.max(1,this.state.page+e);t=Math.min(this.state.pageCount,t),this.setState({page:t})}render(){try{let e=null;return this.state.pageCount>1&&(e=n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:6},n.a.createElement("div",{className:"section centered"},n.a.createElement(_t.a,{style:{fontSize:"16px"},onClick:()=>this.nudgePage(-1)}))),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"section centered"},this.state.page," / ",this.state.pageCount)),n.a.createElement(h.a,{span:6},n.a.createElement("div",{className:"section centered"},n.a.createElement(Kt.a,{style:{fontSize:"16px"},onClick:()=>this.nudgePage(1)}))))),n.a.createElement("div",null,n.a.createElement(Ka.a,{className:"pdf-document",file:this.props.src,onLoadSuccess:({numPages:e})=>this.setPageCount(e)},n.a.createElement(Ka.b,{pageNumber:this.state.page})),e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Za extends n.a.Component{render(){try{const e=[{id:"die",text:"die roller"},{id:"handout",text:"handout"},{id:"language",text:"language"},{id:"wild",text:"wild surge"},{id:"oracle",text:"oracle"}];let t=null;switch(this.props.view){case"die":t=n.a.createElement(Qa,{dice:this.props.dice,constant:this.props.constant,dieRolls:this.props.dieRolls,setDie:(e,t)=>this.props.setDie(e,t),setConstant:e=>this.props.setConstant(e),rollDice:e=>this.props.rollDice(e),resetDice:()=>this.props.resetDice()});break;case"handout":t=n.a.createElement(ts,{handout:this.props.handout,setHandout:e=>this.props.setHandout(e)});break;case"language":t=n.a.createElement($a,{mode:this.props.languageMode,setMode:e=>this.props.setLanguageMode(e),selectedLanguagePreset:this.props.selectedLanguagePreset,selectedLanguages:this.props.selectedLanguages,output:this.props.languageOutput,selectLanguagePreset:e=>this.props.selectLanguagePreset(e),addLanguage:e=>this.props.addLanguage(e),removeLanguage:e=>this.props.removeLanguage(e),clearLanguages:()=>this.props.clearLanguages(),selectRandomLanguages:()=>this.props.selectRandomLanguages(),generateLanguage:()=>this.props.generateLanguage()});break;case"wild":t=n.a.createElement(as,{surge:this.props.surge,rollSurge:()=>this.props.rollSurge()});break;case"oracle":t=n.a.createElement(ss,{draws:this.props.draws,drawCards:(e,t)=>this.props.drawCards(e,t),resetDraw:()=>this.props.resetDraw()})}return n.a.createElement("div",{className:"sidebar-container"},n.a.createElement("div",{className:"sidebar-header"},n.a.createElement("div",{className:"heading"},"tools"),n.a.createElement(pe,{options:e,selectedID:this.props.view,onSelect:e=>this.props.setView(e)})),n.a.createElement("div",{className:"sidebar-content"},t))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Qa extends n.a.Component{render(){try{const e=this.props.dieRolls.map(e=>n.a.createElement(Wt,{key:e.id,result:e}));return n.a.createElement("div",null,n.a.createElement(Oa,{dice:this.props.dice,constant:this.props.constant,setDie:(e,t)=>this.props.setDie(e,t),setConstant:e=>this.props.setConstant(e),resetDice:()=>this.props.resetDice(),rollDice:e=>this.props.rollDice(e)}),n.a.createElement("hr",null),e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class $a extends n.a.Component{constructor(e){super(e),this.state={search:""}}setSearch(e){this.setState({search:e})}render(){try{let e=null;switch(this.props.mode){case"common":const t=D.getLanguagePresets().map(e=>({id:e.name,text:e.name}));e=n.a.createElement("div",{id:"common"},n.a.createElement(pe,{options:t,selectedID:this.props.selectedLanguagePreset,itemsPerRow:4,onSelect:e=>this.props.selectLanguagePreset(e)}));break;case"custom":let a=this.props.selectedLanguages.join(", ");""===a&&(a="none");const s=D.getSourceLanguages().filter(e=>I.match(this.state.search,e)).map(e=>n.a.createElement(te,{key:e,label:e,checked:this.props.selectedLanguages.includes(e),onChecked:t=>t?this.props.addLanguage(e):this.props.removeLanguage(e)}));s.unshift(n.a.createElement("div",{key:"search"},n.a.createElement(_,{placeholder:"filter languages...",text:this.state.search,onChange:e=>this.setSearch(e)}),n.a.createElement("hr",null))),e=n.a.createElement("div",{id:"custom"},n.a.createElement("div",{className:"generated-item group-panel"},n.a.createElement("div",{className:"text-section small"},"selected languages: ",this.props.selectedLanguages.sort().join(", ")||"(none)"),n.a.createElement("div",{className:"icon-section"},n.a.createElement(c.a,{title:"clear languages",onClick:()=>this.props.clearLanguages()}))),n.a.createElement(oe,{text:"languages"},s));break;case"random":e=n.a.createElement("div",{id:"random"},n.a.createElement("div",{className:"generated-item group-panel"},n.a.createElement("div",{className:"text-section small"},"selected languages: ",this.props.selectedLanguages.sort().join(", ")||"(none)"),n.a.createElement("div",{className:"icon-section"},n.a.createElement(nt.a,{title:"choose again",onClick:()=>this.props.selectRandomLanguages()}))))}const t=[];this.props.output.length>0&&t.push(n.a.createElement("hr",{key:"div"}));for(let a=0;a!==this.props.output.length;++a)t.push(n.a.createElement(es,{key:a,text:this.props.output[a],languages:this.props.selectedLanguages}));return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"you can use this tool to generate words and sentences in fantasy languages")),n.a.createElement(pe,{options:["common","custom","random"].map(e=>({id:e,text:e})),selectedID:this.props.mode,onSelect:e=>this.props.setMode(e)}),e,n.a.createElement("hr",null),n.a.createElement("button",{className:this.props.selectedLanguages.length>0?"":"disabled",onClick:()=>this.props.generateLanguage()},"generate text"),t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class es extends n.a.Component{copy(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}say(e){e.stopPropagation(),_a.say(this.props.text,this.props.languages)}render(){try{return n.a.createElement("div",{className:"generated-item group-panel"},n.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),n.a.createElement("div",{className:"icon-section"},n.a.createElement("div",null,n.a.createElement(ma.a,{title:"copy to clipboard",onClick:e=>this.copy(e)})),n.a.createElement("div",null,n.a.createElement(Ja.a,{title:"say (experimental)",onClick:e=>this.say(e)}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ts extends n.a.Component{constructor(e){super(e),this.state={mode:"image",playerViewOpen:!1}}setMode(e){this.setState({mode:e},()=>{this.props.setHandout(null)})}readFile(e){const t=new FileReader;return t.onload=t=>{t.target&&this.props.setHandout({type:this.state.mode,filename:e.name,src:t.target.result})},t.readAsDataURL(e),!1}setPlayerViewOpen(e){this.setState({playerViewOpen:e})}clear(){"handout"===G.data.shared.type&&B.shareNothing(),this.setState({playerViewOpen:!1},()=>{this.props.setHandout(null)})}getAccept(){switch(this.state.mode){case"image":return"image/*";case"audio":return"audio/*";case"video":return"video/*";case"pdf":return".pdf"}}getDisplay(){if(!this.props.handout)return null;switch(this.props.handout.type){case"image":return n.a.createElement("img",{className:"nonselectable-image",src:this.props.handout.src||"",alt:this.props.handout.filename||""});case"audio":return n.a.createElement("audio",{controls:!0},n.a.createElement("source",{src:this.props.handout.src||""}));case"video":return n.a.createElement("video",{controls:!0},n.a.createElement("source",{src:this.props.handout.src||""}));case"pdf":return n.a.createElement(Xa,{src:this.props.handout.src||""})}return null}getPlayerView(){return this.state.playerViewOpen?n.a.createElement(wa,{title:"Handout",onCloseWindow:()=>this.setPlayerViewOpen(!1)},this.getDisplay()):null}render(){try{let e=null;return e=this.props.handout?n.a.createElement("div",null,this.getDisplay(),n.a.createElement("hr",null),n.a.createElement(te,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:e=>this.setPlayerViewOpen(e)}),n.a.createElement(te,{label:"share in session",disabled:"started"!==B.getState(),checked:"handout"===G.data.shared.type,onChecked:e=>e?B.shareHandout(this.props.handout):B.shareNothing()}),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.clear()},"change handout")):n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"you can use this tool to select a file and show it to your players")),n.a.createElement(pe,{options:["image","audio","video","pdf"].map(e=>({id:e,text:e})),selectedID:this.state.mode,onSelect:e=>this.setMode(e)}),n.a.createElement(Q.a.Dragger,{accept:this.getAccept(),showUploadList:!1,beforeUpload:e=>this.readFile(e)},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(Z.a,null)),n.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),n.a.createElement("div",null,e,this.getPlayerView())}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class as extends n.a.Component{render(){let e=null;return this.props.surge&&(e=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement("div",{className:"generated-item group-panel"},n.a.createElement("div",{className:"text-section"},n.a.createElement("p",null,this.props.surge)),n.a.createElement("div",{className:"icon-section"},n.a.createElement(ma.a,{title:"copy to clipboard",onClick:e=>navigator.clipboard.writeText(G.getID())}))))),n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"this tool randomly chooses wild magic surge effects")),n.a.createElement("button",{onClick:()=>this.props.rollSurge()},"surge"),e)}}class ss extends n.a.Component{constructor(e){super(e),this.state={deck:"tarot deck"}}draw(e){let t=[];switch(this.state.deck){case"tarot deck":t=Va.getTarotDeck();break;case"tarot deck (major arcana)":t=Va.getTarotMajorArcana();break;case"tarot deck (minor arcana)":t=Va.getTarotMinorArcana();break;case"standard deck":t=Va.getStandardDeck();break;case"standard deck (with jokers)":t=Va.getStandardDeckWithJokers();break;case"deck of many things":t=Va.getDeckOfManyThings();break;case"deck of many things (13 cards)":t=Va.getDeckOfManyThingsSmall()}this.props.drawCards(e,t)}render(){try{let e=null;if(this.props.draws.length>0){const t=this.props.draws.map(e=>n.a.createElement(h.a,{span:8,key:e.id},n.a.createElement(La,{card:e.card,reversed:e.reversed})));e=n.a.createElement("div",null,n.a.createElement(p.a,{gutter:10,justify:"space-around"},t),n.a.createElement("button",{onClick:()=>this.props.resetDraw()},"reset"))}else e=n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.draw(1)},"draw a card")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.draw(3)},"draw three cards")));return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("p",null,"this tool lets you draw cards from various different decks")),n.a.createElement(se,{options:["tarot deck","tarot deck (major arcana)","tarot deck (minor arcana)","standard deck","standard deck (with jokers)","deck of many things","deck of many things (13 cards)"].map(e=>({id:e,text:e})),selectedID:this.state.deck,onSelect:e=>this.setState({deck:e})}),e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ns extends n.a.Component{render(){try{if(!this.props.sidebar.visible)return null;const e=[];switch(this.props.user){case"dm":e.push(n.a.createElement(Qt.a,{key:"tools",className:"tools"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"tools",onClick:()=>this.props.onSelectSidebar("tools")})),e.push(n.a.createElement($t.a,{key:"generators",className:"generators"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"generators",onClick:()=>this.props.onSelectSidebar("generators")})),e.push(n.a.createElement(ea.a,{key:"reference",className:"reference"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"reference",onClick:()=>this.props.onSelectSidebar("reference")})),e.push(n.a.createElement(ta.a,{key:"session",className:"session"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"session",onClick:()=>this.props.onSelectSidebar("session")})),e.push(n.a.createElement(aa.a,{key:"search",className:"search"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"search",onClick:()=>this.props.onSelectSidebar("search")})),e.push(n.a.createElement(sa.a,{key:"about",className:"about"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"about",onClick:()=>this.props.onSelectSidebar("about")}));break;case"player":if(e.push(n.a.createElement(ea.a,{key:"reference",className:"reference"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"reference",onClick:()=>this.props.onSelectSidebar("reference")})),"connected"===j.getState()){if(G.data.options.allowChat&&e.push(n.a.createElement(na.a,{key:"session-chat",className:"session-chat"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"chat",onClick:()=>this.props.onSelectSidebar("session-chat")})),G.data.options.allowControls){let t=!1;switch(G.data.shared.type){case"combat":case"exploration":t=!0}t&&e.push(n.a.createElement(ra.a,{key:"session-controls",className:"session-controls"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"controls",onClick:()=>this.props.onSelectSidebar("session-controls")}))}e.push(n.a.createElement(ta.a,{key:"session-player",className:"session-player"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"session",onClick:()=>this.props.onSelectSidebar("session-player")})),e.push(n.a.createElement(ia.a,{key:"awards-player",className:"awards-player"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"awards",onClick:()=>this.props.onSelectSidebar("awards-player")}))}e.push(n.a.createElement(sa.a,{key:"about",className:"about"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"about",onClick:()=>this.props.onSelectSidebar("about")}))}let t=null;switch(this.props.sidebar.type){case"tools":t=n.a.createElement(Za,{view:this.props.sidebar.subtype,setView:e=>{const t=this.props.sidebar;t.subtype=e,this.props.onUpdateSidebar(t)},dice:this.props.sidebar.dice,constant:this.props.sidebar.constant,dieRolls:this.props.sidebar.dieRolls,setDie:(e,t)=>{const a=this.props.sidebar;a.dice[e]=t,this.props.onUpdateSidebar(a)},setConstant:e=>{const t=this.props.sidebar;t.constant=e,this.props.onUpdateSidebar(t)},rollDice:e=>{const t=this.props.sidebar,a=f.rollDice(t.dice,t.constant,e);t.dieRolls.unshift(a),this.props.onUpdateSidebar(t)},resetDice:()=>{const e=this.props.sidebar;[4,6,8,10,12,20,100].forEach(t=>e.dice[t]=0),e.constant=0,this.props.onUpdateSidebar(e)},handout:this.props.sidebar.handout,setHandout:e=>{const t=this.props.sidebar;t.handout=e,this.props.onUpdateSidebar(t)},languageMode:this.props.sidebar.languageMode,setLanguageMode:e=>{const t=this.props.sidebar;switch(t.languageMode=e,e){case"common":t.languagePreset=D.getLanguagePresets()[0].name,t.selectedLanguages=D.getLanguagePresets()[0].languages;break;case"random":t.languagePreset=null,t.selectedLanguages=D.getRandomLanguages();break;case"custom":t.languagePreset=null,t.selectedLanguages=[]}this.props.onUpdateSidebar(t)},selectedLanguagePreset:this.props.sidebar.languagePreset,selectedLanguages:this.props.sidebar.selectedLanguages,languageOutput:this.props.sidebar.languageOutput,selectLanguagePreset:e=>{const t=this.props.sidebar;t.languagePreset=null,t.selectedLanguages=[];const a=D.getLanguagePresets().find(t=>t.name===e);a&&(t.languagePreset=a.name,t.selectedLanguages=a.languages),this.props.onUpdateSidebar(t)},addLanguage:e=>{const t=this.props.sidebar;t.selectedLanguages.push(e),this.props.onUpdateSidebar(t)},removeLanguage:e=>{const t=this.props.sidebar,a=t.selectedLanguages.indexOf(e);t.selectedLanguages.splice(a,1),this.props.onUpdateSidebar(t)},clearLanguages:()=>{const e=this.props.sidebar;e.selectedLanguages=[],this.props.onUpdateSidebar(e)},selectRandomLanguages:()=>{const e=this.props.sidebar;e.selectedLanguages=D.getRandomLanguages(),this.props.onUpdateSidebar(e)},generateLanguage:()=>{const e=this.props.sidebar,t=e.selectedLanguages.map(e=>fetch("/dojo/data/langs/"+e+".txt"));Promise.all(t).then(t=>{const a=t.map(e=>e.text());Promise.all(a).then(t=>{D.initModel(t),e.languageOutput=D.generateLines(5),this.props.onUpdateSidebar(e)})})},surge:this.props.sidebar.surge,rollSurge:()=>{const e=this.props.sidebar;e.surge=f.getWildSurge(),this.props.onUpdateSidebar(e)},draws:this.props.sidebar.draws,drawCards:(e,t)=>{const a=this.props.sidebar;for(a.draws=[];a.draws.length<e;){const e=t[b.randomNumber(t.length)];a.draws.find(t=>t.card.id===e.id)||a.draws.push({id:b.guid(),card:e,reversed:b.randomBoolean()})}this.props.onUpdateSidebar(a)},resetDraw:()=>{const e=this.props.sidebar;e.draws=[],this.props.onUpdateSidebar(e)}});break;case"generators":t=n.a.createElement(ua,{view:this.props.sidebar.subtype,npc:this.props.sidebar.npc,setView:e=>{const t=this.props.sidebar;t.subtype=e,this.props.onUpdateSidebar(t)},generateNPC:()=>{const e=this.props.sidebar;e.npc={age:D.generateNPCAge(),profession:D.generateNPCProfession(),height:D.generateNPCHeight(),weight:D.generateNPCWeight(),hair:D.generateNPCHair(),physical:D.generateNPCPhysical(),mental:D.generateNPCMental(),speech:D.generateNPCSpeech(),trait:D.generateNPCTrait(),ideal:D.generateNPCIdeal(),bond:D.generateNPCBond(),flaw:D.generateNPCFlaw()},this.props.onUpdateSidebar(e)}});break;case"reference":const e=[];this.props.library.forEach(t=>{t.monsters.forEach(t=>e.push(t))}),b.sort(e),t=n.a.createElement(xa,{view:this.props.sidebar.subtype,setView:e=>{const t=this.props.sidebar;t.subtype=e,this.props.onUpdateSidebar(t)},selectedPartyID:this.props.sidebar.selectedPartyID,parties:this.props.parties,selectPartyID:e=>{const t=this.props.sidebar;t.selectedPartyID=e,this.props.onUpdateSidebar(t)},selectedMonsterID:this.props.sidebar.selectedMonsterID,monsters:e,selectMonsterID:e=>{const t=this.props.sidebar;t.selectedMonsterID=e,this.props.onUpdateSidebar(t)},showAwards:"dm"===this.props.user,addAward:(e,t)=>this.props.addAward(e,t),deleteAward:(e,t)=>this.props.deleteAward(e,t)});break;case"session":t=n.a.createElement(Wa,{view:this.props.sidebar.subtype,setView:e=>{const t=this.props.sidebar;t.subtype=e,this.props.onUpdateSidebar(t)},parties:this.props.parties,openImage:e=>this.props.openImage(e)});break;case"session-player":t=n.a.createElement(Ya,null);break;case"session-chat":t=n.a.createElement(Ua,{openImage:e=>this.props.openImage(e)});break;case"session-controls":t=n.a.createElement(Ha,{options:this.props.options,addCondition:(e,t)=>this.props.addCondition(e,t),editCondition:(e,t,a)=>this.props.editCondition(e,t,a),toggleAddingToMap:()=>this.props.toggleAddingToMap(),onUpdated:()=>this.props.onUpdated()});break;case"awards-player":t=n.a.createElement(ca,null);break;case"search":t=n.a.createElement(Ma,{parties:this.props.parties,library:this.props.library,encounters:this.props.encounters,maps:this.props.maps,openParty:e=>this.props.selectParty(e),openGroup:e=>this.props.selectMonsterGroup(e),openEncounter:e=>this.props.selectEncounter(e),openMap:e=>this.props.selectMap(e),getMonster:e=>this.props.getMonster(e)});break;case"about":t=n.a.createElement(la,{parties:this.props.parties,library:this.props.library,maps:this.props.maps,combats:this.props.combats,explorations:this.props.explorations,options:this.props.options,setOption:(e,t)=>this.props.setOption(e,t)})}return n.a.createElement("div",{className:"sidebar sidebar-right"},n.a.createElement("div",{className:"sidebar-icons"},e),t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}ns.defaultProps={parties:[],library:[],encounters:[],maps:[],combats:[],explorations:[],currentCombat:null,currentExploration:null,selectParty:null,selectMonsterGroup:null,selectEncounter:null,selectMap:null,openImage:null,openStatBlock:null,addAward:null,deleteAward:null,addCondition:null,editCondition:null,toggleAddingToMap:null,onUpdated:null,getMonster:null};class rs extends n.a.Component{render(){try{const e=["overlay","token"].map(e=>({id:e,text:e})),t=["square","rounded","circle"].map(e=>({id:e,text:e}));return n.a.createElement("div",{className:"card map",key:"selected"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},"map item")),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"subheading"},"type"),n.a.createElement(pe,{options:e,selectedID:this.props.item.type,onSelect:e=>this.props.changeValue(this.props.item,"type",e)}),n.a.createElement("div",{className:"subheading"},"move"),n.a.createElement(De,{showToggle:!0,onMove:(e,t)=>this.props.moveMapItem(this.props.item,e,t)}),n.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},n.a.createElement("div",{className:"subheading"},"size"),n.a.createElement("div",{className:"section"},n.a.createElement(de,{value:this.props.item.width+" sq / "+5*this.props.item.width+" ft",label:"width",downEnabled:this.props.item.width>1,onNudgeValue:e=>this.props.nudgeValue(this.props.item,"width",e)}),n.a.createElement(de,{value:this.props.item.height+" sq / "+5*this.props.item.height+" ft",label:"height",downEnabled:this.props.item.height>1,onNudgeValue:e=>this.props.nudgeValue(this.props.item,"height",e)}))),n.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},n.a.createElement("div",{className:"subheading"},"shape"),n.a.createElement(pe,{options:t,selectedID:this.props.item.style,onSelect:e=>this.props.changeValue(this.props.item,"style",e)}),n.a.createElement("div",{className:"subheading"},"color"),n.a.createElement("input",{type:"color",value:this.props.item.color,onChange:e=>this.props.changeValue(this.props.item,"color",e.target.value)}),n.a.createElement("div",{className:"subheading"},"opacity"),n.a.createElement(H.a,{min:0,max:255,value:this.props.item.opacity,tooltipVisible:!1,onChange:e=>this.props.changeValue(this.props.item,"opacity",e)})),n.a.createElement("div",{style:{display:"token"===this.props.item.type?"block":"none"}},n.a.createElement("div",{className:"subheading"},"size"),n.a.createElement(de,{value:this.props.item.size,downEnabled:"tiny"!==this.props.item.size,upEnabled:"gargantuan"!==this.props.item.size,onNudgeValue:e=>this.props.nudgeValue(this.props.item,"size",e)})),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement("button",{onClick:()=>this.props.deleteMapItem(this.props.item)},"remove from the map"))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class is extends n.a.Component{render(){try{const e=this.props.combatant.hpCurrent||0,t=this.props.combatant.hpMax||0,a=this.props.combatant.hpTemp||0,s=t/2,r=100*Math.max(e,0)/(t+a);let i="bar injured";e>=t?i="bar unhurt":e<=s&&(i="bar bloodied");let o=null;if(null!==this.props.combatant.hpTemp&&this.props.combatant.hpTemp>0){const e=100*Math.max(this.props.combatant.hpTemp,0)/(t+a);o=n.a.createElement("div",{className:"bar temp",style:{width:e+"%"}})}return n.a.createElement("div",{className:"hp-gauge"},n.a.createElement("div",{className:i,style:{width:r+"%"}}),o)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}const os=new ke.a.Converter;os.setOption("tables",!0);class ls extends n.a.Component{getInformationTag(){return this.props.combatant.current?n.a.createElement(W.a,{className:"info"},"current turn"):this.props.selected?n.a.createElement(W.a,{className:"info"},this.props.selectedText):null}onClick(e){e.stopPropagation(),this.props.select&&this.props.select(this.props.combatant,e.ctrlKey)}getContent(){const e=[];if("monster"===this.props.combatant.type&&!this.props.playerView){var t,a;const s=this.props.combatant;let r=(null!==(t=this.props.combatant.hpCurrent)&&void 0!==t?t:0).toString();(null!==(a=this.props.combatant.hpTemp)&&void 0!==a?a:0)>0&&(r+="+"+this.props.combatant.hpTemp),e.push(n.a.createElement("div",{key:"stats"},n.a.createElement(p.a,{align:"middle"},n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"information"},n.a.createElement("div",null,"ac"),n.a.createElement("div",{className:"information-value"},s.ac))),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"information"},n.a.createElement("div",{className:"information-value"},r),n.a.createElement("div",null,"hp")))),n.a.createElement(is,{combatant:this.props.combatant})))}if(this.props.combatant.mountID){const t=this.props.combat.combatants.find(e=>e.id===this.props.combatant.mountID);if(t){const a=n.a.createElement("button",{className:"link",onClick:e=>{e.stopPropagation(),this.props.select(t,!1)}},t.displayName);let s=null;"controlled"===this.props.combatant.mountType&&(s=n.a.createElement("div",{className:"note-details"},"your mount moves as directed; it can only take dash, disengage, or dodge actions")),e.push(n.a.createElement(Le,{key:"mount"},n.a.createElement("div",{className:"note-heading"},"mounted on: ",a),s,n.a.createElement("div",{className:"note-details"},"if you\u2019re knocked prone, or an effect moves your mount against its will, you must succeed on a dex save (dc 10) or land prone in a space within 5 feet of your mount"),n.a.createElement("div",{className:"note-details"},"if your mount is knocked prone, you can use your reaction to land on your feet; otherwise, you fall prone in a space within 5 feet of your mount")))}}const s=this.props.combat.combatants.find(e=>e.mountID===this.props.combatant.id);if(s){const t=n.a.createElement("button",{className:"link",onClick:e=>{e.stopPropagation(),this.props.select(s,!1)}},s.displayName);e.push(n.a.createElement(Le,{key:"rider"},n.a.createElement("div",null,"ridden by: ",t)))}const r=[];return this.props.combatant.tags.filter(e=>e.startsWith("engaged")).forEach(e=>{r.push(f.getTagDescription(e))}),r.length>0&&e.push(n.a.createElement(Le,{key:"engaged"},n.a.createElement("div",null,"engaged with: ",r.join(", ")))),this.props.combatant.tags.filter(e=>!e.startsWith("engaged")).forEach(t=>{e.push(n.a.createElement(Le,{key:t},n.a.createElement("div",{className:"note-heading"},f.getTagTitle(t)),n.a.createElement("div",{className:"note-details"},f.getTagDescription(t))))}),this.props.combat.map&&!this.props.combat.map.items.find(e=>e.id===this.props.combatant.id)&&e.push(n.a.createElement(Le,{key:"not-on-map"},n.a.createElement("p",null,"not on the map"))),this.props.combatant.showOnMap||e.push(n.a.createElement(Le,{key:"hidden"},"hidden")),this.props.combatant.conditions&&this.props.combatant.conditions.forEach(t=>{let a=t.name;"exhaustion"===t.name&&(a+=" ("+t.level+")"),t.duration&&(a+=" "+f.conditionDurationText(t,this.props.combat.combatants));let s=null;"custom"!==t.name&&(s=n.a.createElement("div",{className:"note-heading"},a));const r=[],i=f.conditionText(t);for(let e=0;e!==i.length;++e)r.push(n.a.createElement("div",{key:e,className:"note-details"},i[e]));e.push(n.a.createElement(Le,{key:t.id},s,r))}),this.props.combatant.note&&e.push(n.a.createElement(Le,{key:"text"},n.a.createElement("div",{dangerouslySetInnerHTML:{__html:os.makeHtml(this.props.combatant.note)}}))),e}render(){try{let e="initiative-list-item clickable "+this.props.combatant.type;this.props.combatant.current&&(e+=" current"),this.props.selected&&(e+=" highlight"),this.props.combatant.defeated&&(e+=" defeated");let t=null;const a=this.props.combatant;a.portrait&&(t=n.a.createElement($,{source:a,inline:!0}));let s=this.props.combatant.displayName||"combatant";if(this.props.combatant.mountID){const e=this.props.combat.combatants.find(e=>e.id===this.props.combatant.mountID);e&&(s+=" on "+(e.displayName||"unnamed mount"))}return n.a.createElement("div",{className:e,onClick:e=>this.onClick(e),role:"button"},n.a.createElement("div",{className:"header"},t,n.a.createElement("div",{className:"name"},s),this.getInformationTag()),n.a.createElement("div",{className:"init-entry-content"},this.getContent()))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class cs extends n.a.Component{makeActive(e){e.stopPropagation(),this.props.makeActive(this.props.combatant)}render(){try{var e;let t=null;const a=this.props.combatant;return a.portrait&&(t=n.a.createElement($,{source:a,inline:!0})),n.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},n.a.createElement("div",{className:"header"},t,n.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),n.a.createElement("div",{className:"init-entry-content"},n.a.createElement(de,{value:null!==(e=this.props.combatant.initiative)&&void 0!==e?e:10,onNudgeValue:e=>this.props.nudgeValue(this.props.combatant,"initiative",e)}),n.a.createElement("button",{onClick:e=>this.makeActive(e)},"add to encounter")))}catch(t){return console.error(t),n.a.createElement(X,{error:t})}}}class ds extends n.a.Component{render(){try{let e=null;const t=this.props.combatant;return t.portrait&&(e=n.a.createElement($,{source:t,inline:!0})),n.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},n.a.createElement("div",{className:"header"},e,n.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),n.a.createElement("div",{className:"init-entry-content"},n.a.createElement("button",{onClick:()=>this.props.addToMap()},"place on map")))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class ps extends n.a.Component{orderCombatants(e){const t=e.find(e=>e.current);if(t){const a=e.indexOf(t);if(0!==a){const t=[...e];return t.splice(a).concat(["top of the round"]).concat(t)}}return e}createCombatantRow(e){if("string"===typeof e)return n.a.createElement("div",{key:e,className:"section init-separator"},e);let t=this.props.selectedItemIDs.includes(e.id);return this.props.playerView&&!this.props.combat.map&&(t=!1),n.a.createElement(ls,{key:e.id,combatant:e,playerView:this.props.playerView,selectedText:this.props.selectedText,combat:this.props.combat,selected:t,select:(e,t)=>this.props.toggleItemSelection(e.id,t)})}render(){try{const e=M.getActiveCombatants(this.props.combat,this.props.playerView,this.props.showDefeated),t=this.orderCombatants(e).map(e=>this.createCombatantRow(e));return n.a.createElement("div",null,this.props.help,t)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}const hs=new ke.a.Converter;hs.setOption("tables",!0);class ms extends n.a.Component{constructor(e){super(e),this.state={showOptions:!1,showDefeatedCombatants:!1,selectedItemIDs:[],selectedAreaID:null,addingToMapID:null,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null,playerViewOpen:!1,middleColumnWidth:8}}componentDidMount(){window.addEventListener("beforeunload",()=>{this.setPlayerViewOpen(!1)})}componentDidUpdate(){"combat"===G.data.shared.type&&(G.data.shared.additional={selectedAreaID:this.state.selectedAreaID,highlightedSquare:this.state.highlightedSquare},B.sendSharedDiffUpdate())}toggleShowOptions(){this.setState({showOptions:!this.state.showOptions})}toggleShowDefeatedCombatants(){this.setState({showDefeatedCombatants:!this.state.showDefeatedCombatants})}setSelectedItemIDs(e){this.setState({selectedItemIDs:e})}toggleItemSelection(e,t){if(e&&t){const t=this.state.selectedItemIDs;if(t.includes(e)){const a=t.indexOf(e);t.splice(a,1)}else t.push(e);this.setSelectedItemIDs(t)}else this.setSelectedItemIDs(e?[e]:[])}setSelectedAreaID(e){this.setState({selectedAreaID:e})}setAddingToMapID(e){this.setState({addingToMapID:e,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}toggleAddingOverlay(){this.setState({addingOverlay:!this.state.addingOverlay,addingToMapID:null,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}toggleEditFog(){this.setState({addingOverlay:!1,addingToMapID:null,editFog:!this.state.editFog,highlightMapSquare:!1,highlightedSquare:null})}toggleHighlightMapSquare(){this.setState({addingOverlay:!1,addingToMapID:null,editFog:!1,highlightMapSquare:!this.state.highlightMapSquare,highlightedSquare:null})}setHighlightedSquare(e,t){this.state.highlightMapSquare&&this.setState({highlightedSquare:{x:e,y:t}})}fillFog(){if(this.props.combat.map){const e=[],t=V.mapDimensions(this.props.combat.map.items);if(t){for(let a=t.minX;a<=t.maxX;++a)for(let s=t.minY;s<=t.maxY;++s)e.push({x:a,y:s});this.props.setFog(e)}}}clearFog(){this.props.setFog([])}setPlayerViewOpen(e){this.setState({playerViewOpen:e})}nudgeMiddleColumnWidth(e){this.setState({middleColumnWidth:this.state.middleColumnWidth+e})}nextTurn(){const e=this.props.combat.combatants.find(e=>e.current);if(e)this.props.endTurn(e);else{const e=this.props.combat.combatants.filter(e=>"placeholder"!==e.type||M.combatHasLairActions(this.props.combat)).find(e=>e.active);e&&this.props.makeCurrent(e)}}defeatCombatants(e){const t=e.map(e=>e.id);this.setState({selectedItemIDs:this.state.selectedItemIDs.filter(e=>!t.includes(e))},()=>{this.props.makeDefeated(e)})}removeCombatants(e){const t=e.map(e=>e.id);this.setState({selectedItemIDs:this.state.selectedItemIDs.filter(e=>!t.includes(e))},()=>{this.props.removeCombatants(e)})}gridSquareClicked(e,t){if(this.state.addingToMapID){const a=this.props.combat.combatants.find(e=>e.id===this.state.addingToMapID);a&&this.props.mapAdd(a,e,t),this.setAddingToMapID(null)}if(this.state.addingOverlay){const a=E.createMapItem();a.type="token",a.x=e,a.y=t,a.width=1,a.height=1,a.color="#005080",a.opacity=127,a.style="square",this.props.addOverlay(a),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[a.id]})}this.state.editFog&&this.gridRectangleSelected(e,t,e,t)}gridRectangleSelected(e,t,a,s){if(this.state.addingOverlay){const n=E.createMapItem();n.type="overlay",n.x=e,n.y=t,n.width=a-e+1,n.height=s-t+1,n.color="#005080",n.opacity=127,n.style="square",this.props.addOverlay(n),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[n.id]})}if(this.state.editFog){const n=this.props.combat.fog;for(let r=e;r<=a;++r)for(let e=t;e<=s;++e){const t=n.findIndex(t=>t.x===r&&t.y===e);-1===t?n.push({x:r,y:e}):n.splice(t,1)}this.props.setFog(n)}}getPlayerView(){if(!this.state.playerViewOpen)return null;const e=n.a.createElement(ps,{combat:this.props.combat,playerView:!0,selectedText:"selected",showDefeated:!1,help:null,selectedItemIDs:this.state.selectedItemIDs,toggleItemSelection:(e,t)=>null});return this.props.combat.map?n.a.createElement(wa,{title:"Encounter",onCloseWindow:()=>this.setPlayerViewOpen(!1)},n.a.createElement(p.a,{className:"full-height full-width"},n.a.createElement(h.a,{span:18,className:"scrollable both-ways"},n.a.createElement(qe,{key:"map",map:this.props.combat.map,mode:"combat-player",options:this.props.options,viewport:V.getViewport(this.props.combat.map,this.state.selectedAreaID),combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,lighting:this.props.combat.lighting,focussedSquare:this.state.highlightedSquare,itemSelected:(e,t)=>this.toggleItemSelection(e,t)})),n.a.createElement(h.a,{span:6,className:"scrollable"},n.a.createElement("div",{className:"heading fixed-top"},"initiative order"),e))):n.a.createElement(wa,{title:"Encounter",onCloseWindow:()=>this.setPlayerViewOpen(!1)},n.a.createElement("div",{className:"scrollable full-width"},n.a.createElement("div",{className:"heading"},"initiative order"),e))}getOptions(){if(!this.state.showOptions)return null;let e=null;this.props.combat.encounter.notes&&(e=n.a.createElement(oe,{text:"encounter notes"},n.a.createElement("div",{dangerouslySetInnerHTML:{__html:hs.makeHtml(this.props.combat.encounter.notes)}})));let t=null;this.props.combat.map&&(t=n.a.createElement(Ce,{text:"end combat and start exploring",onConfirm:()=>this.props.endCombat(this.props.combat,!0)}));const a=[];this.props.combat.combatants.filter(e=>"pc"===e.type).forEach(e=>{const t=this.props.parties.find(t=>t.pcs.find(t=>t.id===e.id));t&&!a.includes(t)&&a.push(t)});const s=[];a.forEach(e=>{e.pcs.forEach(t=>{this.props.combat.combatants.find(e=>e.id===t.id)||s.push(n.a.createElement("button",{key:t.id,onClick:()=>this.props.addPC(e.id,t.id)},t.name," (",e.name,")"))})});let r=null;s.length>0&&(r=n.a.createElement(oe,{text:"add pcs"},s));let i=null;this.props.combat.encounter&&this.props.combat.encounter.waves.length>0&&(i=n.a.createElement("button",{onClick:()=>this.props.addWave()},"add wave"));let o=null;this.props.combat.map&&(o=n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"map"),n.a.createElement(te,{label:"add token / overlay",checked:this.state.addingOverlay,onChecked:()=>this.toggleAddingOverlay()}),n.a.createElement("div",{className:"group-panel",style:{display:this.state.addingOverlay?"":"none"}},n.a.createElement(Le,null,n.a.createElement("p",null,"click on a map square to add a token, or select a rectangle to add an overlay"))),n.a.createElement(te,{label:"highlight map square",checked:this.state.highlightMapSquare,onChecked:()=>this.toggleHighlightMapSquare()}),n.a.createElement("div",{className:"group-panel",style:{display:this.state.highlightMapSquare?"":"none"}},n.a.createElement(Le,null,n.a.createElement("p",null,"use your mouse to indicate a square on the map"),n.a.createElement("p",null,"that square will be highlighted on the shared map as well"))),n.a.createElement(te,{label:"edit fog of war",checked:this.state.editFog,onChecked:()=>this.toggleEditFog()}),n.a.createElement("div",{style:{display:this.state.editFog?"":"none"}},n.a.createElement(Le,null,n.a.createElement("p",null,"click on map squares to turn fog of war on and off"),n.a.createElement("p",null,"you can also click and drag to select an area")),n.a.createElement("button",{onClick:()=>this.fillFog()},"fill fog of war"),n.a.createElement("button",{className:0===this.props.combat.fog.length?"disabled":"",onClick:()=>this.clearFog()},"clear fog of war")),n.a.createElement("button",{onClick:()=>this.props.rotateMap()},"rotate map")));let l=null;return l="started"===B.getState()?n.a.createElement(te,{label:"share in session",checked:"combat"===G.data.shared.type,onChecked:e=>e?B.shareCombat(this.props.combat):B.shareNothing()}):n.a.createElement("button",{onClick:()=>{this.setState({showOptions:!1},()=>{this.props.onOpenSession()})}},"start a session"),n.a.createElement("div",{className:"scrollable"},n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"combat"),e,n.a.createElement("button",{onClick:()=>this.props.pauseCombat()},"pause combat"),n.a.createElement(Ce,{text:"end combat",onConfirm:()=>this.props.endCombat(this.props.combat,!1)}),t),n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"combatants"),n.a.createElement("button",{onClick:()=>{this.setState({showOptions:!1},()=>{this.props.addCombatants()})}},"add combatants"),r,i,n.a.createElement("button",{onClick:()=>this.props.addCompanion(null)},"add a companion")),o,n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"sharing"),n.a.createElement(te,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:e=>this.setPlayerViewOpen(e)}),l),n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},"layout"),n.a.createElement(te,{label:"show defeated combatants",checked:this.state.showDefeatedCombatants,onChecked:()=>this.toggleShowDefeatedCombatants()}),n.a.createElement(de,{value:"middle column size",downEnabled:this.state.middleColumnWidth>4,upEnabled:this.state.middleColumnWidth<14,onNudgeValue:e=>this.nudgeMiddleColumnWidth(2*e)})))}getSelectedCombatants(){const e=this.state.selectedItemIDs.map(e=>this.props.combat.combatants.find(t=>t.id===e)).filter(e=>!!e);b.sort(e,[{field:"displayName",dir:"asc"}]);const t=e.filter(e=>"placeholder"===e.type);if(t.length>0)return n.a.createElement("div",null,this.createCard(t[0]));if(e.length>0&&e.every(e=>e.current))return n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"you've selected the current initiative holder"));if(1===e.length)return n.a.createElement("div",null,this.createControls(e),n.a.createElement("hr",null),this.createCard(e[0]));if(e.length>1)return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"multiple combatants are selected:"),e.map(e=>n.a.createElement("div",{key:e.id,className:"group-panel"},e.displayName,n.a.createElement(c.a,{style:{float:"right",padding:"2px 0",fontSize:"14px"},onClick:()=>this.toggleItemSelection(e.id,!0)})))),this.createControls(e));if(this.props.combat.map){const e=this.props.combat.map.items.find(e=>e.id===this.state.selectedItemIDs[0]);if(e)return n.a.createElement(rs,{item:e,moveMapItem:(e,t,a)=>this.props.mapMove([e.id],t,a),deleteMapItem:e=>this.props.mapRemove([e.id]),changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.props.nudgeValue(e,t,a)})}return n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"select a pc or monster from the ",n.a.createElement("b",null,"initiative order")," list (in the middle column) to see its details here"))}createControls(e){return e.some(e=>"placeholder"===e.type)?null:n.a.createElement(Re,{combatants:e,allCombatants:this.props.combat.combatants,map:this.props.combat.map,options:this.props.options,lighting:this.props.combat.lighting,makeCurrent:e=>this.props.makeCurrent(e),makeActive:e=>this.props.makeActive(e),makeDefeated:e=>this.defeatCombatants(e),toggleTag:(e,t)=>this.props.toggleTag(e,t),toggleCondition:(e,t)=>this.props.toggleCondition(e,t),toggleHidden:e=>this.props.toggleHidden(e),changeHP:e=>this.props.changeHP(e),addCondition:e=>this.props.addCondition(e),editCondition:(e,t)=>this.props.editCondition(e,t),deleteCondition:(e,t)=>this.props.deleteCondition(e,t),mapAdd:e=>this.setAddingToMapID(this.state.addingToMapID?null:e.id),mapMove:(e,t,a)=>this.props.mapMove(e.map(e=>e.id),t,a),mapRemove:e=>this.props.mapRemove(e.map(e=>e.id)),undoStep:e=>this.props.undoStep(e),removeCombatants:e=>this.removeCombatants(e),addCompanion:e=>this.props.addCompanion(e),changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.props.nudgeValue(e,t,a)})}createCard(e){switch(e.type){case"pc":return n.a.createElement(Ot,{pc:e});case"monster":return n.a.createElement(gt,{monster:e,combat:!0,showRollButtons:this.props.options.showMonsterDieRolls,useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e),onRollDice:(e,t,a,s,n)=>this.props.onRollDice(e,t,a,s,n)});case"companion":let t=null;const a=e;return a.monsterID&&this.props.library.forEach(e=>{const s=e.monsters.find(e=>e.id===a.monsterID);s&&(t=n.a.createElement(gt,{monster:s,combat:!0,showRollButtons:this.props.options.showMonsterDieRolls,useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e),onRollDice:(e,t,a,s,n)=>this.props.onRollDice(e,t,a,s,n)}))}),t;case"placeholder":const s=[];return this.props.combat.combatants.forEach(e=>{const t=e;t&&t.traits&&t.traits.some(e=>"lair"===e.type)&&s.push(n.a.createElement("div",{className:"card monster",key:"lair "+t.id},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},t.name)),n.a.createElement("div",{className:"card-content"},n.a.createElement(mt,{combatant:t,mode:"lair",useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e)}))))}),s}return null}render(){try{const e=this.props.combat.combatants.filter(e=>!!e.mountID&&"controlled"===e.mountType).map(e=>e.mountID||""),t=this.props.combat.combatants.filter(t=>!e.includes(t.id)).find(e=>e.current),a=this.props.combat.combatants.filter(t=>!e.includes(t.id)).filter(e=>e.pending),s=a.map(e=>n.a.createElement(cs,{key:e.id,combatant:e,nudgeValue:(e,t,a)=>this.props.nudgeValue(e,t,a),makeActive:e=>this.props.makeActive([e])}));if(0!==a.length){let e=null;"started"===B.getState()&&"combat"===G.data.shared.type&&G.data.people.some(e=>""!==e.characterID)&&(e=n.a.createElement("button",{onClick:()=>B.prompt("initiative",null)},"ask for initiative rolls")),s.unshift(n.a.createElement(Le,{key:"pending-help"},n.a.createElement("div",{className:"section"},"these combatants are not yet part of the encounter"),n.a.createElement("div",{className:"section"},"set initiative on each of them, then add them to the encounter"),e))}let r=null;t||(r=n.a.createElement(Le,{key:"init-help"},n.a.createElement("div",{className:"section"},"these are the combatants taking part in this encounter; you can select them to see their stat blocks (on the right)"),n.a.createElement("div",{className:"section"},"they are listed in initiative order (with the highest initiative score at the top of the list, and the lowest at the bottom)")));const i=n.a.createElement(ps,{combat:this.props.combat,playerView:!1,selectedText:"selected",showDefeated:this.state.showDefeatedCombatants,help:r,selectedItemIDs:this.state.selectedItemIDs,toggleItemSelection:(e,t)=>this.toggleItemSelection(e,t)});let o=null;this.state.showOptions||(o=t?n.a.createElement("div",null,this.createControls([t]),n.a.createElement("hr",null),this.createCard(t)):n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"when you're ready to begin the encounter, press the ",n.a.createElement("b",null,"start combat")," button"),n.a.createElement("div",{className:"section"},"the current initiative holder will be displayed here"),n.a.createElement("button",{onClick:()=>this.nextTurn()},"start combat")));let l=null;if(this.props.combat.map){const e=M.getActiveCombatants(this.props.combat,!1,this.state.showDefeatedCombatants).filter(e=>this.props.combat.map&&!this.props.combat.map.items.find(t=>t.id===e.id));e.length>0&&(l=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"these combatants are in the initiative order, but have not yet been placed on the map (which you'll find in the middle column)"),n.a.createElement("div",{className:"section"},"to place one on the map, click the ",n.a.createElement("b",null,"place on map")," button and then click on a map square"),n.a.createElement("div",{className:"section"},"or click ",n.a.createElement("button",{className:"link",onClick:()=>this.props.scatterCombatants(e,this.state.selectedAreaID)},"here")," to scatter them randomly")),e.map(e=>n.a.createElement(ds,{key:e.id,combatant:e,addToMap:()=>this.setAddingToMapID(e.id)}))))}let c=null;this.props.combat.map&&(c=n.a.createElement("div",{key:"map",className:"scrollable horizontal-only"},n.a.createElement(qe,{map:this.props.combat.map,mode:"combat",options:this.props.options,viewport:V.getViewport(this.props.combat.map,this.state.selectedAreaID),showGrid:null!==this.state.addingToMapID||this.state.addingOverlay||this.state.editFog||this.state.highlightMapSquare,combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,lighting:this.props.combat.lighting,focussedSquare:this.state.highlightedSquare,itemSelected:(e,t)=>this.toggleItemSelection(e,t),itemRemove:e=>this.props.mapRemove([e]),conditionRemove:(e,t)=>this.props.deleteCondition(e,t),toggleTag:(e,t)=>this.props.toggleTag(e,t),toggleCondition:(e,t)=>this.props.toggleCondition(e,t),toggleHidden:e=>this.props.toggleHidden(e),areaSelected:e=>this.setSelectedAreaID(e),gridSquareEntered:(e,t)=>this.setHighlightedSquare(e,t),gridSquareClicked:(e,t)=>this.gridSquareClicked(e,t),gridRectangleSelected:(e,t,a,s)=>this.gridRectangleSelected(e,t,a,s),changeLighting:e=>this.props.changeValue(this.props.combat,"lighting",e)})));const d=[];this.props.combat.combatants.filter(e=>!e.pending&&e.active&&!e.defeated).forEach(e=>{const t=e;t&&t.traits&&t.traits.some(e=>"legendary"===e.type||"mythic"===e.type)&&!t.current&&d.push(n.a.createElement("div",{className:"card monster",key:"leg "+t.id},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},t.name)),n.a.createElement("div",{className:"card-content"},n.a.createElement(mt,{combatant:t,mode:"legendary",useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e)}))))});const u=this.state.middleColumnWidth,g=(24-u)/2;return n.a.createElement("div",{className:"full-height"},n.a.createElement(p.a,{align:"middle",className:"combat-top-row"},n.a.createElement(h.a,{span:g},n.a.createElement("div",{className:"menu",onClick:()=>this.toggleShowOptions(),role:"button"},n.a.createElement(Xt.a,{title:"options"}),n.a.createElement("span",null,"options"))),n.a.createElement(h.a,{span:u},this.props.combat.combatants.find(e=>e.current)?n.a.createElement("div",{className:"action"},n.a.createElement("button",{onClick:()=>this.nextTurn()},"next turn")):null),n.a.createElement(h.a,{span:g},n.a.createElement(p.a,null,n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"information"},n.a.createElement("div",null,"round"),n.a.createElement("div",{className:"information-value"},this.props.combat.round))),n.a.createElement(h.a,{span:12},n.a.createElement("div",{className:"information"},n.a.createElement("div",{className:"information-value"},M.getCombatXP(this.props.combat)),n.a.createElement("div",null,"xp")))))),n.a.createElement(p.a,{className:"combat-main"},n.a.createElement(h.a,{span:g,className:"scrollable"},n.a.createElement(Tt,{heading:"initiative holder",content:[o],columns:1,showToggle:!1})),n.a.createElement(h.a,{span:u,className:"scrollable"},n.a.createElement(Tt,{heading:"waiting for intiative",content:s,columns:1,showToggle:!0}),n.a.createElement(Tt,{heading:"legendary actions",content:d,columns:1,showToggle:!0}),n.a.createElement(Tt,{heading:"encounter map",content:[c],columns:1,showToggle:!0}),n.a.createElement(Tt,{heading:"initiative order",content:[i],columns:1,showToggle:!0})),n.a.createElement(h.a,{span:g,className:"scrollable"},n.a.createElement(Tt,{heading:"not on the map",content:[l],columns:1,showToggle:!0}),n.a.createElement(Tt,{heading:"selected",content:[this.getSelectedCombatants()],columns:1}))),this.getPlayerView(),n.a.createElement(m.a,{className:this.props.options.theme,placement:"left",closable:!1,maskClosable:!0,width:"33%",visible:this.state.showOptions,onClose:()=>this.toggleShowOptions()},n.a.createElement("div",{className:"drawer-header"},n.a.createElement("div",{className:"app-title"},"options")),n.a.createElement("div",{className:"drawer-content"},this.getOptions()),n.a.createElement("div",{className:"drawer-footer"},null)))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var us=a(109);class gs extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.resumeCombat(this.props.combat)},"resume combat"),n.a.createElement(Ce,{text:"delete combat",onConfirm:()=>this.props.deleteCombat(this.props.combat)}))}}class ys extends n.a.Component{getValue(e){var t,a,s;switch(e.type){case"pc":return n.a.createElement("div",{className:"value"},"pc");case"monster":const r=null!==(t=e.hpCurrent)&&void 0!==t?t:0,i=null!==(a=e.hpMax)&&void 0!==a?a:0,o=null!==(s=e.hpTemp)&&void 0!==s?s:0;let l=r.toString();return o>0&&(l+="+"+o),r<i&&(l+=" / "+i),n.a.createElement("div",{className:"value"},l," hp")}return null}render(){try{let e=null;this.props.combat.map&&(e=n.a.createElement("div",{className:"section"},n.a.createElement(qe,{map:this.props.combat.map,fog:this.props.combat.fog,combatants:this.props.combat.combatants})));const t=this.props.combat.combatants.filter(e=>e.active).filter(e=>"placeholder"!==e.type).map(e=>n.a.createElement("div",{key:e.id,className:"combatant-row",onClick:()=>this.props.openStatBlock(e),role:"button"},n.a.createElement($,{source:e,inline:!0}),n.a.createElement("div",{className:"name"},e.displayName),this.getValue(e)));return n.a.createElement("div",{className:"card encounter"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},this.props.combat.name||"unnamed combat")),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"fixed-height"},n.a.createElement("div",{className:"section"},"paused at round ",this.props.combat.round),e,n.a.createElement("div",{className:"subheading"},"initiative order"),t),n.a.createElement("hr",null),n.a.createElement(gs,{combat:this.props.combat,resumeCombat:e=>this.props.resumeCombat(e),deleteCombat:e=>this.props.deleteCombat(e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class bs extends n.a.Component{constructor(e){super(e),this.state={cloneName:e.encounter.name+" copy"}}setCloneName(e){this.setState({cloneName:e})}render(){try{let e=null;return 1===this.props.parties.length&&(e=n.a.createElement("button",{onClick:()=>this.props.startEncounter(this.props.parties[0].id,this.props.encounter.id)},"start combat")),this.props.parties.length>1&&(e=n.a.createElement(se,{options:this.props.parties.map(e=>({id:e.id,text:e.name||"unnamed party"})),placeholder:"start combat with...",onSelect:e=>this.props.startEncounter(e,this.props.encounter.id)})),n.a.createElement("div",null,n.a.createElement(oe,{text:"copy encounter"},n.a.createElement(_,{text:this.state.cloneName,placeholder:"encounter name",onChange:e=>this.setCloneName(e)}),n.a.createElement("button",{onClick:()=>this.props.cloneEncounter(this.props.encounter,this.state.cloneName)},"create copy")),e,n.a.createElement(Ce,{text:"delete encounter",onConfirm:()=>this.props.deleteEncounter(this.props.encounter)}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Es extends n.a.Component{getText(e){let t="";if(""!==e.monsterID){const a=this.props.getMonster(e.monsterID);a&&(t=a.name),t=t||"unnamed monster"}else t=e.roles.join(", ");return n.a.createElement("div",{className:"name"},t)}getValue(e){let t="";return e.count>1&&(t&&(t+=" "),t+="x"+e.count),"foe"!==e.faction&&(t&&(t+=" "),t+="("+e.faction+")"),t?n.a.createElement("div",{className:"value"},t):null}getPortrait(e){const t=this.props.getMonster(e.monsterID);return t&&t.portrait?n.a.createElement($,{source:t,inline:!0}):null}render(){try{const e=this.props.encounter.slots.map(e=>n.a.createElement("div",{key:e.id,className:"combatant-row",onClick:()=>this.props.openStatBlock(e),role:"button"},this.getPortrait(e),this.getText(e),this.getValue(e)));return 0===e.length&&e.push(n.a.createElement("div",{key:"empty",className:"section"},"no monsters")),this.props.encounter.waves.forEach(t=>{e.push(n.a.createElement("div",{key:"name "+t.id,className:"section subheading"},t.name||"unnamed wave")),t.slots.forEach(t=>{e.push(n.a.createElement("div",{key:t.id,className:"combatant-row",onClick:()=>this.props.openStatBlock(t),role:"button"},this.getPortrait(t),this.getText(t),this.getValue(t)))}),0===e.length&&e.push(n.a.createElement("div",{key:"empty "+t.id,className:"section"},"no monsters"))}),n.a.createElement("div",{className:"card encounter"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},this.props.encounter.name||"unnamed encounter")),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"fixed-height"},n.a.createElement("div",{className:"subheading"},"monsters"),e,n.a.createElement("div",{className:"subheading"},"xp"),M.getEncounterXP(this.props.encounter,null,this.props.getMonster)),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.openEncounter(this.props.encounter)},"open encounter"),n.a.createElement(oe,{text:"more options"},n.a.createElement(bs,{encounter:this.props.encounter,parties:this.props.parties,cloneEncounter:(e,t)=>this.props.cloneEncounter(e,t),startEncounter:(e,t)=>this.props.startEncounter(e,t),deleteEncounter:e=>this.props.deleteEncounter(e)}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class fs extends n.a.Component{render(){try{return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.addEncounter(null)},"add a new encounter"),n.a.createElement("button",{onClick:()=>this.props.createEncounter()},"create a random encounter"),n.a.createElement(oe,{text:"use an encounter template"},n.a.createElement($e,{items:M.encounterTemplates().map(e=>({id:e.name,text:e.name})),onSelect:e=>this.props.addEncounter(e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class vs extends n.a.Component{openStatBlock(e){const t=this.props.getMonster(e.monsterID);t&&this.props.openStatBlock(t)}render(){try{if(!this.props.hasMonsters)return n.a.createElement(p.a,{align:"middle",justify:"center",className:"scrollable"},n.a.createElement("div",{style:{width:"400px"}},n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"this screen is for building encounters, but before you can do that you need to do these things first:"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("span",{className:this.props.hasMonsters?"strikethrough":""},"add some monsters in the ",n.a.createElement("button",{className:"link",onClick:()=>this.props.setView("library")},"monsters screen")),this.props.hasMonsters?n.a.createElement(us.a,{title:"done",style:{marginLeft:"5px"}}):null)))));const e=this.props.combats;b.sort(e);const t=e.map(e=>n.a.createElement(ys,{key:e.id,combat:e,resumeCombat:e=>this.props.resumeCombat(e),deleteCombat:e=>this.props.deleteCombat(e),openStatBlock:e=>this.props.openStatBlock(e)})),a=this.props.encounters;b.sort(a);const s=a.map(e=>n.a.createElement(Es,{key:e.id,encounter:e,parties:this.props.parties,openEncounter:e=>this.props.openEncounter(e),deleteEncounter:e=>this.props.deleteEncounter(e),cloneEncounter:(e,t)=>this.props.cloneEncounter(e,t),startEncounter:(e,t)=>this.props.startEncounter(e,t),openStatBlock:e=>this.openStatBlock(e),getMonster:e=>this.props.getMonster(e)}));return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"on this page you can set up encounters"),n.a.createElement("div",{className:"section"},"when you have created an encounter you can add monsters to it, then gauge its difficulty for a party of pcs"),n.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can then run the encounter"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"on the right you will see the encounters that you have created"),n.a.createElement("div",{className:"section"},"select an encounter from the list to add monsters to it"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"to start building an encounter, press the ",n.a.createElement("b",null,"add a new encounter")," button")),n.a.createElement(fs,{createEncounter:()=>this.props.createEncounter(),addEncounter:e=>this.props.addEncounter(e)})),n.a.createElement(h.a,{span:18,className:"scrollable"},n.a.createElement(Tt,{heading:"in progress",content:t}),n.a.createElement(Tt,{heading:"encounters",content:s})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var ws=a(210);class ks extends n.a.Component{constructor(e){super(e),this.state={count:e.slot.count}}setCount(e){this.setState({count:e})}getMoveControl(){if(0===this.props.encounter.waves.length)return null;let e=null;this.props.slot.count>1&&(e=n.a.createElement(H.a,{min:1,max:this.props.slot.count,value:this.state.count,tooltipVisible:!1,onChange:e=>this.setCount(e)}));const t=[];this.props.encounter.slots.includes(this.props.slot)||t.push({id:"",text:"main encounter"}),this.props.encounter.waves.forEach(e=>{e.slots.includes(this.props.slot)||t.push({id:e.id,text:e.name})});let a="move to...";return this.props.slot.count>1&&(a=this.props.slot.count===this.state.count?"move all to...":"move "+this.state.count+" to..."),n.a.createElement(oe,{text:"move monster"},e,n.a.createElement(se,{options:t,placeholder:a,onSelect:e=>{const t=this.props.encounter.waves.find(t=>t.id===e)||null;this.props.moveToWave(this.props.slot,this.state.count,t)}}))}render(){try{let e="monster";this.props.monster&&(e=this.props.monster.name||"unnamed monster"),this.props.slot.count>1&&(e+=" (x"+this.props.slot.count+")");const t=n.a.createElement("div",null,n.a.createElement(de,{value:this.props.slot.count,label:"number",downEnabled:this.props.slot.count>1,onNudgeValue:e=>this.props.nudgeValue(this.props.slot,"count",e)}),n.a.createElement(pe,{options:["foe","neutral","ally"].map(e=>({id:e,text:e})),selectedID:this.props.slot.faction,onSelect:e=>this.props.changeValue(this.props.slot,"faction",e)}));if(!this.props.monster)return n.a.createElement("div",{className:"card "+this.props.slot.faction},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},e)),n.a.createElement("div",{className:"card-content"},n.a.createElement(Le,{white:!0},n.a.createElement("div",{className:"section"},"this empty slot has been added because you are creating an encounter from a template"),n.a.createElement("div",{className:"section"},"when you press ",n.a.createElement("b",null,"choose a monster")," you will be able to select a monster of this type:"),n.a.createElement("div",{className:"section centered"},n.a.createElement("b",null,this.props.slot.roles.join(", ")))),n.a.createElement("hr",null),t,n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement("button",{onClick:()=>this.props.chooseMonster(this.props.slot)},"choose a monster"),this.getMoveControl(),n.a.createElement(Ce,{text:"remove from encounter",onConfirm:()=>this.props.deleteEncounterSlot(this.props.slot)}))));const a=[];let s=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(s+=" ("+this.props.monster.tag.toLowerCase()+")"),a.push(n.a.createElement(W.a,{key:"tag-main"},s)),this.props.monster.alignment&&a.push(n.a.createElement(W.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),a.push(n.a.createElement(W.a,{key:"tag-cr"},"cr ",f.challenge(this.props.monster.challenge))),n.a.createElement("div",{className:"card "+this.props.slot.faction},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},e)),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"stats"},n.a.createElement($,{source:this.props.monster}),n.a.createElement("div",{className:"section centered"},a)),n.a.createElement("hr",null),t,n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement("button",{onClick:()=>this.props.showStatblock(this.props.monster)},"statblock"),this.getMoveControl(),n.a.createElement(Ce,{text:"remove from encounter",onConfirm:()=>this.props.deleteEncounterSlot(this.props.slot)}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}(new ke.a.Converter).setOption("tables",!0);class xs extends n.a.Component{getMonsterCards(e){const t=[],a=e?e.slots:this.props.encounter.slots;return a.forEach(a=>{t.push(n.a.createElement(ks,{slot:a,monster:this.props.getMonster(a.monsterID),encounter:this.props.encounter,changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.props.nudgeValue(e,t,a),chooseMonster:t=>this.props.chooseMonster(this.props.encounter,t,e),deleteEncounterSlot:t=>this.props.deleteEncounterSlot(this.props.encounter,t,e),moveToWave:(t,a,s)=>this.props.moveEncounterSlot(this.props.encounter,t,a,e,s),showStatblock:e=>this.props.showStatblock(e)}))}),0===a.length&&t.push(n.a.createElement(Le,null,n.a.createElement("p",null,"there are no monsters in this ",e?"wave":"encounter"))),t}render(){try{const e=this.props.encounter.waves.map(e=>n.a.createElement("div",{key:e.id,className:"group-panel"},n.a.createElement(_,{text:e.name,placeholder:"wave name",onChange:t=>this.props.changeValue(e,"name",t)}),n.a.createElement(Ce,{text:"delete wave",onConfirm:()=>this.props.deleteWave(this.props.encounter,e)})));let t=null;this.props.encounter.slots.some(e=>e.roles.length>0&&""===e.monsterID)&&(t=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.populateEncounter(this.props.encounter)},"choose monsters")));const a=this.props.encounter.waves.map(e=>n.a.createElement(Tt,{key:e.id,heading:e.name||"unnamed wave",content:this.getMonsterCards(e),columns:3}));let s=null;if(0===this.props.encounter.waves.length)s=n.a.createElement("button",{onClick:()=>this.props.chooseMonster(this.props.encounter,null,null)},"add monsters");else{const e=[{id:b.guid(),text:"encounter"}];this.props.encounter.waves.forEach(t=>{e.push({id:t.id,text:t.name||"unnamed wave"})}),s=n.a.createElement(se,{placeholder:"add monsters to...",options:e,onSelect:e=>{var t;const a=null!==(t=this.props.encounter.waves.find(t=>t.id===e))&&void 0!==t?t:null;this.props.chooseMonster(this.props.encounter,null,a)}})}return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"encounter name"),n.a.createElement(_,{text:this.props.encounter.name,placeholder:"encounter name",onChange:e=>this.props.changeValue(this.props.encounter,"name",e)})),n.a.createElement("hr",null),s,n.a.createElement(oe,{text:"waves"},n.a.createElement(Le,null,n.a.createElement("p",null,"if your encounter is large or occurs in stages, you can split it into waves")),e,n.a.createElement("button",{onClick:()=>this.props.addWave(this.props.encounter)},"add a new wave")),n.a.createElement(oe,{text:"notes"},n.a.createElement(_,{text:this.props.encounter.notes,placeholder:"notes",multiLine:!0,onChange:e=>this.props.changeValue(this.props.encounter,"notes",e)})),n.a.createElement(bs,{encounter:this.props.encounter,parties:this.props.parties,cloneEncounter:(e,t)=>this.props.cloneEncounter(e,t),startEncounter:(e,t)=>this.props.startEncounter(e,t),deleteEncounter:e=>this.props.deleteEncounter(e)}),t,n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.goBack()},n.a.createElement(ws.a,{style:{fontSize:"10px"}})," back to the list")),n.a.createElement(h.a,{span:12,className:"scrollable"},n.a.createElement(Tt,{heading:"encounter",content:this.getMonsterCards(null),columns:3}),a),n.a.createElement(h.a,{span:6,className:"scrollable"},n.a.createElement(Tt,{heading:"difficulty",content:[n.a.createElement(me,{key:"diff",encounter:this.props.encounter,parties:this.props.parties,getMonster:e=>this.props.getMonster(e)})],columns:1})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Cs extends n.a.Component{constructor(e){super(e),this.state={showOptions:!1,playerViewOpen:!1,addingToMapID:null,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null,selectedItemIDs:[],selectedAreaID:null}}componentDidMount(){window.addEventListener("beforeunload",()=>{this.setPlayerViewOpen(!1)})}componentDidUpdate(){"exploration"===G.data.shared.type&&(G.data.shared.additional={selectedAreaID:this.state.selectedAreaID,highlightedSquare:this.state.highlightedSquare},B.sendSharedDiffUpdate())}toggleShowOptions(){this.setState({showOptions:!this.state.showOptions})}setPlayerViewOpen(e){this.setState({playerViewOpen:e})}setAddingToMapID(e){this.setState({addingToMapID:e,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}toggleEditFog(){this.setState({addingOverlay:!1,editFog:!this.state.editFog,selectedItemIDs:[],highlightMapSquare:!1,highlightedSquare:null})}toggleAddingOverlay(){this.setState({addingOverlay:!this.state.addingOverlay,editFog:!1,selectedItemIDs:[],highlightMapSquare:!1,highlightedSquare:null})}toggleHighlightMapSquare(){this.setState({addingOverlay:!1,editFog:!1,selectedItemIDs:[],highlightMapSquare:!this.state.highlightMapSquare,highlightedSquare:null})}setHighlightedSquare(e,t,a){this.state.highlightMapSquare&&!a&&this.setState({highlightedSquare:{x:e,y:t}})}setSelectedItemIDs(e){this.setState({editFog:!(e.length>0)&&this.state.editFog,selectedItemIDs:e})}setSelectedAreaID(e){this.setState({selectedAreaID:e})}addCompanion(e){this.setState({selectedItemIDs:[e.id]},()=>this.props.addCompanion(e))}toggleItemSelection(e,t){if(e&&t){const t=this.state.selectedItemIDs;if(t.includes(e)){const a=t.indexOf(e);t.splice(a,1)}else t.push(e);this.setSelectedItemIDs(t)}else this.setSelectedItemIDs(e?[e]:[])}mapRemove(e){this.setState({selectedItemIDs:[]},()=>this.props.mapRemove(e.map(e=>e.id)))}nudgeValue(e,t,a){let s=null;switch(t){case"challenge":s=f.nudgeChallenge(e[t],a);break;case"size":case"displaySize":s=f.nudgeSize(e[t],a);break;default:s=e[t]+a}this.props.changeValue(e,t,s)}fillFog(){if(this.props.exploration.map){const e=[],t=V.mapDimensions(this.props.exploration.map.items);if(t){for(let a=t.minX;a<=t.maxX;++a)for(let s=t.minY;s<=t.maxY;++s)e.push({x:a,y:s});this.props.setFog(e)}}}clearFog(){this.props.setFog([])}gridSquareClicked(e,t,a){if(this.state.addingToMapID){const a=this.props.exploration.combatants.find(e=>e.id===this.state.addingToMapID);a&&this.props.mapAdd(a,e,t),this.setAddingToMapID(null)}if(this.state.addingOverlay){const a=E.createMapItem();a.type="token",a.x=e,a.y=t,a.width=1,a.height=1,a.color="#005080",a.opacity=127,a.style="square",this.props.addOverlay(a),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[a.id]})}this.state.editFog&&!a&&this.gridRectangleSelected(e,t,e,t)}gridRectangleSelected(e,t,a,s){if(this.state.addingOverlay){const n=E.createMapItem();n.type="overlay",n.x=e,n.y=t,n.width=a-e+1,n.height=s-t+1,n.color="#005080",n.opacity=127,n.style="square",this.props.addOverlay(n),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[n.id]})}if(this.state.editFog){const n=this.props.exploration.fog;for(let r=e;r<=a;++r)for(let e=t;e<=s;++e){const t=n.findIndex(t=>t.x===r&&t.y===e);-1===t?n.push({x:r,y:e}):n.splice(t,1)}this.props.setFog(n)}}getPlayerView(){return this.state.playerViewOpen?n.a.createElement(wa,{title:"Map",onCloseWindow:()=>this.setPlayerViewOpen(!1)},n.a.createElement("div",{className:"scrollable both-ways"},this.getMap(!0))):null}getOptions(){if(!this.state.showOptions)return null;let e=null;return e="started"===B.getState()?n.a.createElement(te,{label:"share in session",checked:"exploration"===G.data.shared.type,onChecked:e=>e?B.shareExploration(this.props.exploration):B.shareNothing()}):n.a.createElement("button",{onClick:()=>{this.setState({showOptions:!1},()=>{this.props.onOpenSession()})}},"start a session"),n.a.createElement("div",{className:"scrollable"},n.a.createElement("div",{className:"heading"},"exploration"),n.a.createElement("button",{onClick:()=>this.props.startCombat(this.props.exploration)},"stop exploring and start combat"),n.a.createElement("button",{onClick:()=>this.props.pauseExploration()},"pause exploration"),n.a.createElement(Ce,{text:"end exploration",onConfirm:()=>this.props.endExploration(this.props.exploration)}),n.a.createElement("div",{className:"heading"},"map"),n.a.createElement(te,{label:"add token / overlay",checked:this.state.addingOverlay,onChecked:()=>this.toggleAddingOverlay()}),n.a.createElement("div",{className:"group-panel",style:{display:this.state.addingOverlay?"":"none"}},n.a.createElement(Le,null,n.a.createElement("p",null,"click on a map square to add a token, or select a rectangle to add an overlay"))),n.a.createElement(te,{label:"highlight map square",checked:this.state.highlightMapSquare,onChecked:()=>this.toggleHighlightMapSquare()}),n.a.createElement("div",{className:"group-panel",style:{display:this.state.highlightMapSquare?"":"none"}},n.a.createElement(Le,null,n.a.createElement("p",null,"use your mouse to indicate a square on the map"),n.a.createElement("p",null,"that square will be highlighted on the shared map as well"))),n.a.createElement(te,{label:"edit fog of war",checked:this.state.editFog,onChecked:()=>this.toggleEditFog()}),n.a.createElement("div",{className:"group-panel",style:{display:this.state.editFog?"":"none"}},n.a.createElement(Le,null,n.a.createElement("p",null,"click on map squares to turn fog of war on and off"),n.a.createElement("p",null,"you can also click and drag to select an area")),n.a.createElement("button",{onClick:()=>this.fillFog()},"fill fog of war"),n.a.createElement("button",{className:0===this.props.exploration.fog.length?"disabled":"",onClick:()=>this.clearFog()},"clear fog of war")),n.a.createElement("button",{onClick:()=>this.props.rotateMap()},"rotate map"),n.a.createElement("div",{className:"heading"},"sharing"),n.a.createElement(te,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:e=>this.setPlayerViewOpen(e)}),e)}getMap(e){return n.a.createElement(qe,{map:this.props.exploration.map,mode:e?"combat-player":"combat",options:this.props.options,viewport:V.getViewport(this.props.exploration.map,this.state.selectedAreaID),combatants:this.props.exploration.combatants,showGrid:(null!==this.state.addingToMapID||this.state.addingOverlay||this.state.editFog||this.state.highlightMapSquare)&&!e,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.exploration.fog,lighting:this.props.exploration.lighting,focussedSquare:this.state.highlightedSquare,gridSquareEntered:(t,a)=>this.setHighlightedSquare(t,a,e),gridSquareClicked:(t,a)=>this.gridSquareClicked(t,a,e),gridRectangleSelected:(e,t,a,s)=>this.gridRectangleSelected(e,t,a,s),itemSelected:(e,t)=>this.toggleItemSelection(e,t),itemRemove:e=>this.props.mapRemove([e]),conditionRemove:(e,t)=>this.props.deleteCondition(e,t),toggleTag:(e,t)=>this.props.toggleTag(e,t),toggleCondition:(e,t)=>this.props.toggleCondition(e,t),toggleHidden:e=>this.props.toggleHidden(e),areaSelected:e=>this.setSelectedAreaID(e),changeLighting:e=>this.props.changeValue(this.props.exploration,"lighting",e)})}getSelectedCombatants(){const e=this.state.selectedItemIDs.map(e=>this.props.exploration.combatants.find(t=>t.id===e)).filter(e=>!!e);b.sort(e,[{field:"displayName",dir:"asc"}]);const t=e.filter(e=>"placeholder"===e.type);if(t.length>0)return n.a.createElement("div",null,this.createCard(t[0]));if(e.length>0&&e.every(e=>e.current))return n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"you've selected the current initiative holder"));if(1===e.length)return n.a.createElement("div",null,this.createControls(e),n.a.createElement("hr",null),this.createCard(e[0]));if(e.length>1)return n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"multiple combatants are selected:"),e.map(e=>n.a.createElement("div",{key:e.id,className:"group-panel"},e.displayName,n.a.createElement(c.a,{style:{float:"right",padding:"2px 0",fontSize:"14px"},onClick:()=>this.toggleItemSelection(e.id,!0)})))),this.createControls(e));if(this.props.exploration.map){const e=this.props.exploration.map.items.find(e=>e.id===this.state.selectedItemIDs[0]);if(e)return n.a.createElement(rs,{item:e,moveMapItem:(e,t,a)=>this.props.mapMove([e.id],t,a),deleteMapItem:e=>this.props.mapRemove([e.id]),changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a)})}return n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"select a map token to see its details here"))}createControls(e){return e.some(e=>"placeholder"===e.type)?null:n.a.createElement(Re,{combatants:e,allCombatants:this.props.exploration.combatants,map:this.props.exploration.map,options:this.props.options,lighting:this.props.exploration.lighting,defaultTab:"map",makeCurrent:e=>null,makeActive:e=>null,makeDefeated:e=>null,toggleTag:(e,t)=>this.props.toggleTag(e,t),toggleCondition:(e,t)=>this.props.toggleCondition(e,t),toggleHidden:e=>this.props.toggleHidden(e),changeHP:e=>null,addCondition:e=>this.props.addCondition(e),editCondition:(e,t)=>this.props.editCondition(e,t),deleteCondition:(e,t)=>this.props.deleteCondition(e,t),mapAdd:e=>this.setAddingToMapID(this.state.addingToMapID?null:e.id),mapMove:(e,t,a)=>this.props.mapMove(e.map(e=>e.id),t,a),mapRemove:e=>this.mapRemove(e),undoStep:e=>null,removeCombatants:null,addCompanion:e=>this.addCompanion(e),changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a)})}createCard(e){switch(e.type){case"pc":return n.a.createElement(Ot,{pc:e});case"monster":return n.a.createElement(gt,{monster:e,combat:!0,showRollButtons:this.props.options.showMonsterDieRolls,useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e),onRollDice:(e,t,a,s,n)=>this.props.onRollDice(e,t,a,s,n)});case"companion":let t=null;const a=e;return a.monsterID&&this.props.library.forEach(e=>{const s=e.monsters.find(e=>e.id===a.monsterID);s&&(t=n.a.createElement(gt,{monster:s,combat:!0,showRollButtons:this.props.options.showMonsterDieRolls,useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e),onRollDice:(e,t,a,s,n)=>this.props.onRollDice(e,t,a,s,n)}))}),t;case"placeholder":const s=[];return this.props.exploration.combatants.forEach(e=>{const t=e;t&&t.traits&&t.traits.some(e=>"lair"===e.type)&&s.push(n.a.createElement("div",{className:"card monster",key:"lair "+t.id},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},t.name)),n.a.createElement("div",{className:"card-content"},n.a.createElement(mt,{combatant:t,mode:"lair",useTrait:e=>this.props.useTrait(e),rechargeTrait:e=>this.props.rechargeTrait(e)}))))}),s}return null}render(){try{let e=null;const t=this.props.exploration.combatants.filter(e=>!this.props.exploration.map.items.find(t=>t.id===e.id));return t.length>0&&(e=n.a.createElement("div",null,n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"these pcs have not yet been placed on the map"),n.a.createElement("div",{className:"section"},"to place one on the map, click the ",n.a.createElement("b",null,"place on map")," button and then click on a map square"),n.a.createElement("div",{className:"section"},"or click ",n.a.createElement("button",{className:"link",onClick:()=>this.props.scatterCombatants(t,this.state.selectedAreaID)},"here")," to scatter them randomly")),t.map(e=>n.a.createElement(ds,{key:e.id,combatant:e,addToMap:()=>this.setAddingToMapID(e.id)})))),n.a.createElement("div",{className:"full-height"},n.a.createElement(p.a,{align:"middle",className:"combat-top-row"},n.a.createElement(h.a,{span:6},n.a.createElement("div",{className:"menu",onClick:()=>this.toggleShowOptions(),role:"button"},n.a.createElement(Xt.a,{title:"options"}),n.a.createElement("span",null,"options"))),n.a.createElement(h.a,{span:18})),n.a.createElement(p.a,{className:"combat-main"},n.a.createElement(h.a,{span:18,className:"scrollable both-ways"},this.getMap(!1)),n.a.createElement(h.a,{span:6,className:"scrollable"},n.a.createElement(Tt,{heading:"not on the map",content:[e],columns:1,showToggle:!0}),n.a.createElement(Tt,{heading:"selected",content:[this.getSelectedCombatants()],columns:1}))),this.getPlayerView(),n.a.createElement(m.a,{className:this.props.options.theme,placement:"left",closable:!1,maskClosable:!0,width:"33%",visible:this.state.showOptions,onClose:()=>this.toggleShowOptions()},n.a.createElement("div",{className:"drawer-header"},n.a.createElement("div",{className:"app-title"},"options")),n.a.createElement("div",{className:"drawer-content"},this.getOptions()),n.a.createElement("div",{className:"drawer-footer"},null)))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}var Ns=a(160);class Ss extends n.a.Component{render(){try{const e=n.a.createElement(Ns.a,{autoplay:!0,autoplaySpeed:1e4},n.a.createElement("div",{key:"prologue"},n.a.createElement("p",{className:"heading"},"welcome to ",n.a.createElement("span",{className:"app-name"},"dojo")),n.a.createElement("p",null,n.a.createElement("span",{className:"app-name"},"dojo")," is an app for dms of ",n.a.createElement("a",{href:"https://www.wizards.com/dnd",target:"_blank",rel:"noopener noreferrer"},"dungeons and dragons fifth edition")),n.a.createElement("p",null,"with ",n.a.createElement("span",{className:"app-name"},"dojo")," you can...")),n.a.createElement("div",{key:"monster"},n.a.createElement("p",{className:"heading"},"build unique, challenging monsters"),n.a.createElement("ul",null,n.a.createElement("li",null,"watch the stat block change as you design your monster"),n.a.createElement("li",null,"see a list of similar monsters to help kickstart your creativity (or show you typical stat values for the type of monster you're creating)"),n.a.createElement("li",null,"build an entirely random monster with a single click"),n.a.createElement("li",null,"easily import any monster from ",n.a.createElement("a",{href:"https://dnd.wizards.com/articles/features/basicrules",target:"_blank",rel:"noopener noreferrer"},"the basic rules")," or from ",n.a.createElement("a",{href:"https://www.dndbeyond.com",target:"_blank",rel:"noopener noreferrer"},"d&d beyond")),n.a.createElement("li",null,"supports legendary and mythic monsters"))),n.a.createElement("div",{key:"encounter"},n.a.createElement("p",{className:"heading"},"create rewarding encounters"),n.a.createElement("ul",null,n.a.createElement("li",null,"quickly add monsters to your encounter and see its xp value and difficulty level change"),n.a.createElement("li",null,"split your encounter into multiple waves"),n.a.createElement("li",null,"let ",n.a.createElement("span",{className:"app-name"},"dojo")," build a random encounter on the fly - or use one of its encounter templates to get started"))),n.a.createElement("div",{key:"map"},n.a.createElement("p",{className:"heading"},"design intricate tactical maps"),n.a.createElement("ul",null,n.a.createElement("li",null,"create a dungeon map by quickly adding rooms, doors, corridors, and stairs"),n.a.createElement("li",null,"for something a little more fancy, you can upload your own battlemap images - even animated images"),n.a.createElement("li",null,"generate an entire random dungeon map with one click"),n.a.createElement("li",null,"add fog of war and then show your maps to your players"))),n.a.createElement("div",{key:"combat"},n.a.createElement("p",{className:"heading"},"run combat without the book-keeping"),n.a.createElement("ul",null,n.a.createElement("li",null,"see the initiative list at a glance - and share it with players in a separate window"),n.a.createElement("li",null,"track monster hit points, rechargable actions, and legendary actions"),n.a.createElement("li",null,"track conditions, their durations, and the effects they impose"),n.a.createElement("li",null,"easily handle mounted combat"),n.a.createElement("li",null,"if you're using a tactical map, ",n.a.createElement("span",{className:"app-name"},"dojo")," keeps track of everyone's location"))),n.a.createElement("div",{key:"session"},n.a.createElement("p",{className:"heading"},"connect with your players"),n.a.createElement("ul",null,n.a.createElement("li",null,"use a dedicated player app to share information with your group"),n.a.createElement("li",null,"send messages (or links, or images, or die rolls) to the whole table - or whisper them to just one player"),n.a.createElement("li",null,"during combat, show the initiative order and the encounter map to your players, and let them control their own characters"),n.a.createElement("li",null,"each player can update their character's stats, so you don't have to"))),n.a.createElement("div",{key:"epilogue"},n.a.createElement("p",{className:"heading"},"to get started"),n.a.createElement("p",null,"use the buttons at the bottom of the screen to explore ",n.a.createElement("span",{className:"app-name"},"dojo"),"'s main features"),n.a.createElement("p",null,"the arrow at the top right gives you additional tools like a die roller, some useful random generators, and rules references")));return n.a.createElement(p.a,{align:"middle",justify:"center",className:"full-height"},e)}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Is extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.resumeExploration(this.props.exploration)},"resume exploration"),n.a.createElement(Ce,{text:"delete exploration",onConfirm:()=>this.props.deleteExploration(this.props.exploration)}))}}class Ms extends n.a.Component{render(){try{return n.a.createElement("div",{className:"card map"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},this.props.exploration.name||"unnamed exploration")),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"fixed-height"},n.a.createElement(qe,{map:this.props.exploration.map,fog:this.props.exploration.fog,combatants:this.props.exploration.combatants})),n.a.createElement("hr",null),n.a.createElement(Is,{exploration:this.props.exploration,resumeExploration:e=>this.props.resumeExploration(e),deleteExploration:e=>this.props.deleteExploration(e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ds extends n.a.Component{constructor(e){super(e),this.state={cloneName:e.map.name+" copy"}}setCloneName(e){this.setState({cloneName:e})}render(){try{let e=null,t=null;return 1===this.props.parties.length&&(e=n.a.createElement("button",{onClick:()=>this.props.startEncounter(this.props.parties[0].id,this.props.map.id)},"start combat"),t=n.a.createElement("button",{onClick:()=>this.props.startExploration(this.props.parties[0].id,this.props.map.id)},"start exploration")),this.props.parties.length>1&&(e=n.a.createElement(se,{options:this.props.parties.map(e=>({id:e.id,text:e.name||"unnamed party"})),placeholder:"start combat with...",onSelect:e=>this.props.startEncounter(e,this.props.map.id)}),t=n.a.createElement(se,{options:this.props.parties.map(e=>({id:e.id,text:e.name||"unnamed party"})),placeholder:"start exploration with...",onSelect:e=>this.props.startExploration(e,this.props.map.id)})),n.a.createElement("div",null,n.a.createElement(oe,{text:"copy map"},n.a.createElement(_,{text:this.state.cloneName,placeholder:"map name",onChange:e=>this.setCloneName(e)}),n.a.createElement("button",{onClick:()=>this.props.cloneMap(this.props.map,this.state.cloneName)},"create copy")),e,t,n.a.createElement(Ce,{text:"delete map",onConfirm:()=>this.props.deleteMap(this.props.map)}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ts extends n.a.Component{render(){try{return n.a.createElement("div",{className:"card map"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},this.props.map.name||"unnamed map")),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"fixed-height"},n.a.createElement(qe,{map:this.props.map,showAreaNames:!0})),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.openMap(this.props.map)},"open map"),n.a.createElement(oe,{text:"more options"},n.a.createElement(Ds,{map:this.props.map,parties:this.props.parties,cloneMap:(e,t)=>this.props.cloneMap(e,t),startEncounter:(e,t)=>this.props.startEncounter(e,t),startExploration:(e,t)=>this.props.startExploration(e,t),deleteMap:e=>this.props.deleteMap(e)}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class As extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.addMap()},"add a new map"),n.a.createElement("button",{onClick:()=>this.props.importMap()},"import a map image"),n.a.createElement(oe,{text:"create a random map"},n.a.createElement("button",{onClick:()=>this.props.generateMap("dungeon")},"create a dungeon map"),n.a.createElement("button",{onClick:()=>this.props.generateMap("delve")},"create a delve map")))}}class Ps extends n.a.Component{render(){try{const e=this.props.explorations;b.sort(e);const t=e.map(e=>n.a.createElement(Ms,{key:e.id,exploration:e,resumeExploration:e=>this.props.resumeExploration(e),deleteExploration:e=>this.props.deleteExploration(e)})),a=this.props.maps;b.sort(a);const s=a.map(e=>n.a.createElement(Ts,{key:e.id,map:e,parties:this.props.parties,openMap:e=>this.props.openMap(e),cloneMap:(e,t)=>this.props.cloneMap(e,t),deleteMap:e=>this.props.deleteMap(e),startEncounter:(e,t)=>this.props.startEncounter(e,t),startExploration:(e,t)=>this.props.startExploration(e,t)}));return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"on this page you can set up tactical maps"),n.a.createElement("div",{className:"section"},"when you have created a map you can explore it with a party of pcs, or use it in the combat manager"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"on the right you will see the maps you have created"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"to design a new map, press the ",n.a.createElement("b",null,"add a new map")," button")),n.a.createElement(As,{addMap:()=>this.props.addMap(),importMap:()=>this.props.importMap(),generateMap:e=>this.props.generateMap(e)})),n.a.createElement(h.a,{span:18,className:"scrollable"},n.a.createElement(Tt,{heading:"in progress",content:t}),n.a.createElement(Tt,{heading:"maps",content:s})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Vs extends n.a.Component{constructor(e){super(e),this.state={view:"map",selectedTileID:null,selectedAreaID:null,addingTile:!1,addingArea:!1}}setView(e){this.setState({view:e})}setSelectedTileID(e){this.setState({selectedTileID:e})}setSelectedAreaID(e){this.setState({selectedAreaID:e})}toggleAddingTile(){this.setState({addingTile:!this.state.addingTile,addingArea:!1})}toggleAddingArea(){this.setState({addingTile:!1,addingArea:!this.state.addingArea})}rectangleSelected(e,t,a,s){if(this.state.addingTile){const n=E.createMapItem();n.x=e,n.y=t,n.width=a-e+1,n.height=s-t+1,n.terrain="default",this.setState({selectedTileID:n.id,selectedAreaID:null,addingTile:!1,addingArea:!1},()=>{this.props.addMapTile(this.props.map,n)})}if(this.state.addingArea){const n=E.createMapArea();n.x=e,n.y=t,n.width=a-e+1,n.height=s-t+1,this.setState({selectedTileID:null,selectedAreaID:n.id,addingTile:!1,addingArea:!1},()=>{this.props.addMapArea(this.props.map,n)})}}render(){try{let e=null;if(this.state.selectedTileID){const t=this.props.map.items.find(e=>e.id===this.state.selectedTileID);t&&(e=n.a.createElement("div",null,n.a.createElement(Os,{tile:t,toggleImageSelection:()=>this.props.selectMapTileImage(this.props.map,t),changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.props.nudgeValue(e,t,a),moveMapTile:(e,t,a)=>this.props.moveMapTile(this.props.map,e,t,a),cloneMapTile:e=>this.props.cloneMapTile(this.props.map,e),deleteMapTile:e=>this.props.deleteMapTile(this.props.map,e),rotateMapTile:e=>this.props.rotateMapTile(this.props.map,e),sendToBack:e=>this.props.sendToBack(this.props.map,e),bringToFront:e=>this.props.bringToFront(this.props.map,e)}),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.setSelectedTileID(null)},n.a.createElement(ws.a,{style:{fontSize:"10px"}})," back to the editor")))}if(this.state.selectedAreaID){const t=this.props.map.areas.find(e=>e.id===this.state.selectedAreaID);t&&(e=n.a.createElement("div",null,n.a.createElement(Ls,{area:t,changeValue:(e,t,a)=>this.props.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.props.nudgeValue(e,t,a),moveMapArea:(e,t,a)=>this.props.moveMapArea(this.props.map,e,t,a),deleteMapArea:e=>this.props.deleteMapArea(this.props.map,e)}),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.setSelectedAreaID(null)},n.a.createElement(ws.a,{style:{fontSize:"10px"}})," back to the editor")))}if(!e){const t=this.state.addingTile?"click and drag on the map to create a tile, or click here to cancel":"add a map tile",a=this.state.addingArea?"click and drag on the map to create a map area, or click here to cancel":"add a map area",s=this.props.map.areas.map(e=>n.a.createElement("div",{key:e.id,className:"group-panel clickable",onClick:()=>this.setSelectedAreaID(e.id),role:"button"},e.name));e=n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"map name"),n.a.createElement(_,{text:this.props.map.name,placeholder:"map name",onChange:e=>this.props.changeValue(this.props.map,"name",e)})),n.a.createElement(Le,null,n.a.createElement("p",null,"maps are made out of map tiles, arranged together"),n.a.createElement("p",null,"to add a new tile to the map, click on ",n.a.createElement("b",null,"add a map tile")," below"),n.a.createElement("p",null,"to edit an existing tile, click on it to select it"),n.a.createElement("hr",null),n.a.createElement("p",null,"if your map is large, you might want to designate different areas (such as rooms in a dungeon, or floors of a building)"),n.a.createElement("p",null,"to add a new area to the map, click on ",n.a.createElement("b",null,"add a map area")," below"),n.a.createElement("p",null,"to edit an existing area, click on it to select it")),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"map tiles"),n.a.createElement("button",{onClick:()=>this.toggleAddingTile()},t),n.a.createElement(Ce,{text:"clear all tiles",onConfirm:()=>this.props.clearMapTiles(this.props.map)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"map areas"),s,n.a.createElement("button",{onClick:()=>this.toggleAddingArea()},a),n.a.createElement(Ce,{text:"clear all areas",onConfirm:()=>this.props.clearMapAreas(this.props.map)})),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.rotateMap(this.props.map)},"rotate map"),n.a.createElement("button",{onClick:()=>this.props.generateRoom(this.props.map)},"add a random room"),n.a.createElement("hr",null),n.a.createElement(Ds,{map:this.props.map,parties:this.props.parties,cloneMap:(e,t)=>this.props.cloneMap(e,t),startEncounter:(e,t)=>this.props.startEncounter(e,t),startExploration:(e,t)=>this.props.startExploration(e,t),deleteMap:e=>this.props.deleteMap(e)}),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.goBack()},n.a.createElement(ws.a,{style:{fontSize:"10px"}})," back to the list"))}const t=[];return this.state.selectedTileID&&t.push(this.state.selectedTileID),this.state.selectedAreaID&&t.push(this.state.selectedAreaID),n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},e),n.a.createElement(h.a,{span:18,className:"scrollable both-ways"},n.a.createElement(qe,{map:this.props.map,mode:"edit",paddingSquares:5,selectedItemIDs:t,showGrid:this.state.addingTile||this.state.addingArea,showAreaNames:!0,itemSelected:(e,t)=>{this.setSelectedTileID(e),this.setSelectedAreaID(null)},areaSelected:e=>this.setSelectedAreaID(e),gridRectangleSelected:(e,t,a,s)=>this.rectangleSelected(e,t,a,s)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Os extends n.a.Component{render(){try{let e=null;return"custom"===this.props.tile.terrain&&(e=n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"custom image"),n.a.createElement("button",{onClick:()=>this.props.toggleImageSelection()},"select image"),n.a.createElement("button",{onClick:()=>this.props.changeValue(this.props.tile,"customBackground","")},"clear image"))),"link"===this.props.tile.terrain&&(e=n.a.createElement("div",null,n.a.createElement("div",{className:"subheading"},"link to custom image"),n.a.createElement(_,{text:this.props.tile.customLink,placeholder:"https://...",onChange:e=>this.props.changeValue(this.props.tile,"customLink",e)}))),n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},"map tile")),n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"move"),n.a.createElement(De,{onMove:(e,t)=>this.props.moveMapTile(this.props.tile,e,t)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"size"),n.a.createElement("div",{className:"section"},n.a.createElement(de,{value:this.props.tile.width+" sq / "+5*this.props.tile.width+" ft",label:"width",downEnabled:this.props.tile.width>1,onNudgeValue:e=>this.props.nudgeValue(this.props.tile,"width",e)}),n.a.createElement(de,{value:this.props.tile.height+" sq / "+5*this.props.tile.height+" ft",label:"height",downEnabled:this.props.tile.height>1,onNudgeValue:e=>this.props.nudgeValue(this.props.tile,"height",e)}))),n.a.createElement("hr",null),n.a.createElement(oe,{text:"advanced options"},n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"terrain"),n.a.createElement(pe,{options:T.map(e=>({id:e,text:e})),selectedID:this.props.tile.terrain,itemsPerRow:3,onSelect:e=>this.props.changeValue(this.props.tile,"terrain",e)}),e),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"shape"),n.a.createElement(pe,{options:["square","rounded","circle"].map(e=>({id:e,text:e})),selectedID:this.props.tile.style,onSelect:e=>this.props.changeValue(this.props.tile,"style",e)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"content"),n.a.createElement($e,{items:[{id:"none",text:"none"},{id:"doorway",text:"doorway",details:n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("b",null,"style")),n.a.createElement(pe,{options:A.map(e=>({id:e,text:e})),selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:e=>this.props.changeValue(this.props.tile.content,"style",e)}),n.a.createElement("div",null,n.a.createElement("b",null,"orientation")),n.a.createElement(pe,{options:["horizontal","vertical"].map(e=>({id:e,text:e})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:e=>this.props.changeValue(this.props.tile.content,"orientation",e)}))},{id:"stairway",text:"stairway",details:n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("b",null,"style")),n.a.createElement(pe,{options:P.map(e=>({id:e,text:e})),selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:e=>this.props.changeValue(this.props.tile.content,"style",e)}),n.a.createElement("div",null,n.a.createElement("b",null,"orientation")),n.a.createElement(pe,{options:["horizontal","vertical"].map(e=>({id:e,text:e})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:e=>this.props.changeValue(this.props.tile.content,"orientation",e)}))}],selectedItemID:this.props.tile.content?this.props.tile.content.type:"none",onSelect:e=>{let t=null;if("none"!==e){let a="";switch(e){case"doorway":a=A[0];break;case"stairway":a=P[0]}t={type:e,orientation:"horizontal",style:a}}this.props.changeValue(this.props.tile,"content",t)}})),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.bringToFront(this.props.tile)},"bring to front"),n.a.createElement("button",{onClick:()=>this.props.sendToBack(this.props.tile)},"send to back"),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.rotateMapTile(this.props.tile)},"rotate tile"),n.a.createElement("button",{onClick:()=>this.props.cloneMapTile(this.props.tile)},"copy tile")),n.a.createElement("hr",null),n.a.createElement(Ce,{text:"delete tile",onConfirm:()=>this.props.deleteMapTile(this.props.tile)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ls extends n.a.Component{randomName(){const e=D.capitalise(D.generateRoomName());this.props.changeValue(this.props.area,"name",e)}render(){try{return n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},"map area")),n.a.createElement("div",null,n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"name"),n.a.createElement("div",{className:"control-with-icons"},n.a.createElement(_,{text:this.props.area.name,onChange:e=>this.props.changeValue(this.props.area,"name",e)}),n.a.createElement("div",{className:"icons"},n.a.createElement(nt.a,{onClick:()=>this.randomName(),title:"generate a random name"})))),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"move"),n.a.createElement(De,{onMove:(e,t)=>this.props.moveMapArea(this.props.area,e,t)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"size"),n.a.createElement(de,{value:this.props.area.width+" sq / "+5*this.props.area.width+" ft",label:"width",downEnabled:this.props.area.width>1,onNudgeValue:e=>this.props.nudgeValue(this.props.area,"width",e)}),n.a.createElement(de,{value:this.props.area.height+" sq  /"+5*this.props.area.width+" ft",label:"height",downEnabled:this.props.area.height>1,onNudgeValue:e=>this.props.nudgeValue(this.props.area,"height",e)})),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"notes"),n.a.createElement(_,{text:this.props.area.text,multiLine:!0,onChange:e=>this.props.changeValue(this.props.area,"text",e)})),n.a.createElement("hr",null),n.a.createElement(Ce,{text:"delete area",onConfirm:()=>this.props.deleteMapArea(this.props.area)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Rs extends n.a.Component{constructor(e){super(e);const t=Math.round(e.monsterGroup.monsters.map(e=>e.challenge).reduce((e,t)=>e+t,0)/e.monsterGroup.monsters.length),a=e.monsterGroup.monsters.map(e=>e.size).filter((e,t,a)=>a.indexOf(e)===t),s=e.monsterGroup.monsters.map(e=>e.category).filter((e,t,a)=>a.indexOf(e)===t),n=e.monsterGroup.monsters.map(e=>e.role).filter((e,t,a)=>a.indexOf(e)===t);this.state={cr:t,size:1===a.length?a[0]:null,type:1===s.length?s[0]:null,role:1===n.length?n[0]:null}}export(){const e=this.props.monsterGroup.name+".monstergroup";b.saveFile(e,this.props.monsterGroup)}render(){try{const e=w.map(e=>({id:e,text:e})),t=k.map(e=>({id:e,text:e})),a=x.map(e=>({id:e,text:e})),s=[];return this.props.library.forEach(e=>{e.monsters.forEach(e=>{let t=!0;Math.abs(e.challenge-this.state.cr)>1&&(t=!1),this.state.size&&e.size!==this.state.size&&(t=!1),this.state.type&&e.category!==this.state.type&&(t=!1),this.state.role&&e.role!==this.state.role&&(t=!1),t&&s.push(e)})}),n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.addMonster(null)},"add a new monster"),n.a.createElement("button",{onClick:()=>this.props.importMonster()},"import a monster"),n.a.createElement(oe,{text:"create a random monster"},n.a.createElement(Le,null,n.a.createElement("p",null,"create a random monster using existing monsters as templates"),n.a.createElement("p",null,"use the parameters below to specify the sort of monster you want to create")),n.a.createElement(de,{label:"cr",value:f.challenge(this.state.cr),onNudgeValue:e=>this.setState({cr:f.nudgeChallenge(this.state.cr,e)})}),n.a.createElement(se,{options:e,selectedID:this.state.size,placeholder:"any size",onSelect:e=>this.setState({size:e}),onClear:()=>this.setState({size:null})}),n.a.createElement(se,{options:t,selectedID:this.state.type,placeholder:"any type",onSelect:e=>this.setState({type:e}),onClear:()=>this.setState({type:null})}),n.a.createElement(se,{options:a,selectedID:this.state.role,placeholder:"any role",onSelect:e=>this.setState({role:e}),onClear:()=>this.setState({role:null})}),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},n.a.createElement(p.a,null,n.a.createElement(h.a,{span:16},"number of monsters:"),n.a.createElement(h.a,{span:8,className:"right-value"},s.length))),n.a.createElement("hr",null),n.a.createElement("button",{className:s.length>2?"":"disabled",onClick:()=>{const e=E.createMonster();e.name=D.capitalise(D.generateName()),N.spliceMonsters(e,s),this.props.addMonster(e)}},"create monster")),n.a.createElement("button",{onClick:()=>this.props.openDemographics(this.props.monsterGroup)},"show demographics"),n.a.createElement("button",{onClick:()=>this.export()},"export group"),n.a.createElement("button",{onClick:()=>this.props.createEncounter(this.props.monsterGroup.monsters.map(e=>e.id))},"create an encounter"),n.a.createElement(Ce,{text:"delete group",disabled:this.props.monsterGroup.monsters.some(e=>this.props.encounters.some(t=>M.encounterHasMonster(t,e.id))),onConfirm:()=>this.props.deleteMonsterGroup(this.props.monsterGroup)}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class zs extends n.a.Component{getMonsters(){return 0===this.props.group.monsters.length?n.a.createElement("div",{className:"section"},"no monsters"):this.props.group.monsters.map(e=>n.a.createElement("div",{key:e.id,className:"combatant-row",onClick:()=>this.props.openStatBlock(e),role:"button"},n.a.createElement($,{source:e,inline:!0}),n.a.createElement("div",{className:"name"},e.name||"unnamed monster"),n.a.createElement("div",{className:"value"},"cr ",f.challenge(e.challenge))))}render(){try{return n.a.createElement("div",{className:"card monster"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},this.props.group.name||"unnamed group")),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"fixed-height"},this.getMonsters()),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.openMonsterGroup(this.props.group)},"open group"),n.a.createElement(oe,{text:"more options"},n.a.createElement(Rs,{monsterGroup:this.props.group,library:this.props.library,encounters:this.props.encounters,addMonster:e=>this.props.addMonster(e),importMonster:()=>this.props.importMonster(),openDemographics:e=>this.props.openDemographics(e),createEncounter:e=>this.props.createEncounter(e),deleteMonsterGroup:e=>this.props.deleteMonsterGroup(e)}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class qs extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.addMonsterGroup()},"add a new monster group"),n.a.createElement("button",{onClick:()=>this.props.importMonsterGroup()},"import a monster group"),n.a.createElement("button",{onClick:()=>this.props.openDemographics()},"show demographics"))}}class Fs extends n.a.Component{render(){try{if(!this.props.hasMonsters)return n.a.createElement(p.a,{align:"middle",justify:"center",className:"scrollable"},n.a.createElement("div",{style:{width:"400px"}},n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"to kickstart your monster collection, let's import all the monsters from the ",n.a.createElement("a",{href:"https://dnd.wizards.com/articles/features/systems-reference-document-srd",target:"_blank",rel:"noopener noreferrer"},"d&d system reference document")),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.addOpenGameContent()},"import monsters"))));const e=this.props.library;b.sort(e);const t=e.map(e=>n.a.createElement(zs,{key:e.id,group:e,library:this.props.library,encounters:this.props.encounters,openMonsterGroup:e=>this.props.openMonsterGroup(e),addMonster:e=>this.props.addMonster(e),importMonster:()=>this.props.importMonster(),openDemographics:e=>this.props.openDemographics(e),deleteMonsterGroup:e=>this.props.deleteMonsterGroup(e),openStatBlock:e=>this.props.openStatBlock(e),createEncounter:e=>this.props.createEncounter(e)}));return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"you can maintain your menagerie of monsters here"),n.a.createElement("div",{className:"section"},"you can then use these monsters to design combat encounters in the encounter builder"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"on the right you will see your monster groups"),n.a.createElement("div",{className:"section"},"select a monster group from the list to see stat blocks for monsters in that group"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"to start adding monsters, press the ",n.a.createElement("b",null,"add a new monster group")," button")),n.a.createElement(qs,{addMonsterGroup:()=>this.props.addMonsterGroup(),importMonsterGroup:()=>this.props.importMonsterGroup(),openDemographics:()=>this.props.openDemographics(null)})),n.a.createElement(h.a,{span:18,className:"scrollable"},n.a.createElement(Tt,{heading:"monster groups",content:t})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Gs extends n.a.Component{constructor(e){super(e),this.state={cloneName:e.monster.name+" copy"}}setCloneName(e){this.setState({cloneName:e})}export(){const e=this.props.monster.name+".monster";b.saveFile(e,this.props.monster)}render(){try{const e=[];return this.props.library.forEach(t=>{-1===t.monsters.indexOf(this.props.monster)&&e.push({id:t.id,text:t.name||"unnamed group"})}),n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.viewMonster(this.props.monster)},"statblock"),n.a.createElement("button",{onClick:()=>this.props.editMonster(this.props.monster)},"edit monster"),n.a.createElement("button",{onClick:()=>this.export()},"export monster"),n.a.createElement(oe,{text:"copy monster"},n.a.createElement(_,{text:this.state.cloneName,placeholder:"monster name",onChange:e=>this.setCloneName(e)}),n.a.createElement("button",{onClick:()=>this.props.cloneMonster(this.props.monster,this.state.cloneName)},"create copy")),n.a.createElement(se,{options:e,placeholder:"move to group...",onSelect:e=>this.props.moveToGroup(this.props.monster,e)}),n.a.createElement("button",{onClick:()=>this.props.createEncounter(this.props.monster.id)},"create an encounter"),n.a.createElement(Ce,{text:"delete monster",disabled:this.props.encounters.some(e=>M.encounterHasMonster(e,this.props.monster.id)),onConfirm:()=>this.props.deleteMonster(this.props.monster)}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Bs extends n.a.Component{getTags(){const e=[];let t=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(t+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(n.a.createElement(W.a,{key:"tag-main"},t)),this.props.monster.alignment&&e.push(n.a.createElement(W.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(n.a.createElement(W.a,{key:"tag-cr"},"cr ",f.challenge(this.props.monster.challenge))),e}render(){try{const e=this.props.monster.name||"unnamed monster";return n.a.createElement("div",{className:"card monster"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title",title:e},e)),n.a.createElement("div",{className:"card-content"},n.a.createElement($,{source:this.props.monster}),n.a.createElement("div",{className:"section centered"},this.getTags()),n.a.createElement("hr",null),n.a.createElement(Gs,{monster:this.props.monster,library:this.props.library,encounters:this.props.encounters,viewMonster:e=>this.props.viewMonster(e),editMonster:e=>this.props.editMonster(e),deleteMonster:e=>this.props.deleteMonster(e),cloneMonster:(e,t)=>this.props.cloneMonster(e,t),moveToGroup:(e,t)=>this.props.moveToGroup(e,t),createEncounter:e=>this.props.createEncounter(e)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class js extends n.a.Component{getSummary(){if(0===this.props.monsterGroup.monsters.length)return n.a.createElement("div",{className:"section centered"},n.a.createElement("i",null,"no monsters"));const e={min:30,max:0};this.props.monsterGroup.monsters.forEach(t=>{e.min=Math.min(e.min,t.challenge),e.max=Math.max(e.max,t.challenge)});const t=e.min===e.max?f.challenge(e.min):f.challenge(e.min)+" - "+f.challenge(e.max);return n.a.createElement("div",{className:"group-panel"},n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"monsters")),n.a.createElement("div",{className:"section"},this.props.monsterGroup.monsters.length),n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"challenge rating")),n.a.createElement("div",{className:"section"},t))}render(){try{const e=[];return 0!==this.props.monsterGroup.monsters.length?this.props.monsterGroup.monsters.forEach(t=>{e.push(n.a.createElement(Bs,{monster:t,library:this.props.library,encounters:this.props.encounters,moveToGroup:(e,t)=>this.props.moveToGroup(e,t),deleteMonster:e=>this.props.deleteMonster(e),viewMonster:e=>this.props.viewMonster(e),editMonster:e=>this.props.editMonster(e),cloneMonster:(e,t)=>this.props.cloneMonster(e,t),createEncounter:e=>this.props.createEncounter([e])}))}):e.push(n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"there are no monsters in this group"))),n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"monster group name"),n.a.createElement(_,{text:this.props.monsterGroup.name,placeholder:"monster group name",onChange:e=>this.props.changeValue(this.props.monsterGroup,"name",e)})),n.a.createElement("hr",null),this.getSummary(),n.a.createElement("hr",null),n.a.createElement(Rs,{monsterGroup:this.props.monsterGroup,library:this.props.library,encounters:this.props.encounters,addMonster:e=>this.props.addMonster(e),importMonster:()=>this.props.importMonster(),openDemographics:e=>this.props.openDemographics(e),createEncounter:e=>this.props.createEncounter(e),deleteMonsterGroup:e=>this.props.deleteMonsterGroup(e)}),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.goBack()},n.a.createElement(ws.a,{style:{fontSize:"10px"}})," back to the list")),n.a.createElement(h.a,{span:18,className:"scrollable"},n.a.createElement(Tt,{content:e,heading:this.props.monsterGroup.name||"unnamed group"})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Us extends n.a.Component{export(){const e=this.props.party.name+".party";b.saveFile(e,this.props.party)}render(){try{const e=this.props.party.pcs.filter(e=>e.active);let t=null;1===this.props.encounters.length&&(t=n.a.createElement("button",{onClick:()=>this.props.startEncounter(this.props.party.id,this.props.encounters[0].id)},"start combat")),this.props.encounters.length>1&&(t=n.a.createElement(se,{options:this.props.encounters.map(e=>({id:e.id,text:e.name||"unnamed encounter"})),placeholder:"start combat...",onSelect:e=>this.props.startEncounter(this.props.party.id,e)}));let a=null;1===this.props.maps.length&&(a=n.a.createElement("button",{onClick:()=>this.props.startExploration(this.props.party.id,this.props.maps[0].id)},"start exploration")),this.props.maps.length>1&&(a=n.a.createElement(se,{options:this.props.maps.map(e=>({id:e.id,text:e.name||"unnamed map"})),placeholder:"start exploration...",onSelect:e=>this.props.startExploration(this.props.party.id,e)}));let s=null;this.props.party.pcs.length>0&&(s=n.a.createElement("button",{onClick:()=>this.props.createEncounter(this.props.party.id)},"create a random encounter"));let r=null;if(this.props.party.pcs.length>0){const t=Math.round(e.reduce((e,t)=>e+t.level,0)/e.length);r=n.a.createElement("button",{onClick:()=>this.props.setLevel(this.props.party,t+1)},"level up to ",t+1)}return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.addPC()},"add a new pc"),n.a.createElement("button",{onClick:()=>this.props.importPC()},"import a pc"),n.a.createElement("button",{onClick:()=>this.export()},"export party"),t,a,s,r,n.a.createElement("button",{onClick:()=>this.props.showReference(this.props.party)},"show party reference"),n.a.createElement(Ce,{text:"delete party",onConfirm:()=>this.props.deleteParty(this.props.party)}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Hs extends n.a.Component{getText(e){let t=e.name||"unnamed pc";return e.player&&(t+=" ("+e.player+")"),t}getPCs(){return 0===this.props.party.pcs.length?n.a.createElement("div",{className:"section"},"no pcs"):this.props.party.pcs.map(e=>n.a.createElement("div",{key:e.id,className:e.active?"combatant-row":"combatant-row inactive",onClick:()=>this.props.openStatBlock(e),role:"button"},n.a.createElement($,{source:e,inline:!0}),n.a.createElement("div",{className:"name"},this.getText(e)),n.a.createElement("div",{className:"value"},"lvl ",e.level)))}render(){try{return n.a.createElement("div",{className:"card pc"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title"},this.props.party.name||"unnamed party")),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"fixed-height"},this.getPCs()),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.openParty(this.props.party)},"open party"),n.a.createElement(oe,{text:"more options"},n.a.createElement(Us,{party:this.props.party,encounters:this.props.encounters,maps:this.props.maps,addPC:()=>this.props.addPC(),importPC:()=>this.props.importPC(),createEncounter:e=>this.props.createEncounter(e),startEncounter:(e,t)=>this.props.startEncounter(e,t),startExploration:(e,t)=>this.props.startExploration(e,t),setLevel:(e,t)=>this.props.setLevel(e,t),showReference:e=>this.props.showReference(e),deleteParty:e=>this.props.deleteParty(e)}))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ys extends n.a.Component{render(){return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.props.addParty()},"add a new party"),n.a.createElement("button",{onClick:()=>this.props.importParty()},"import a party"))}}class Ws extends n.a.Component{componentDidUpdate(){G.data.party&&B.sendPartyUpdate()}render(){try{const e=this.props.parties;b.sort(e);const t=e.map(e=>n.a.createElement(Hs,{key:e.id,party:e,encounters:this.props.encounters,maps:this.props.maps,openParty:e=>this.props.openParty(e),addPC:()=>this.props.addPC(),importPC:()=>this.props.importPC(),createEncounter:e=>this.props.createEncounter(e),startEncounter:(e,t)=>this.props.startEncounter(e,t),startExploration:(e,t)=>this.props.startExploration(e,t),setLevel:(e,t)=>this.props.setLevel(e,t),showReference:e=>this.props.showReference(e),openStatBlock:e=>this.props.openStatBlock(e),deleteParty:e=>this.props.deleteParty(e)}));return n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"this page is where you can tell dojo all about your pcs"),n.a.createElement("div",{className:"section"},"you can add a party for each of your gaming groups"),n.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can run the encounter in the combat manager"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"on the right you will see the parties that you have created"),n.a.createElement("div",{className:"section"},"select a party from the list to see pc details"),n.a.createElement("hr",null),n.a.createElement("div",{className:"section"},"to start adding a party, press the ",n.a.createElement("b",null,"add a new party")," button")),n.a.createElement(Ys,{addParty:()=>this.props.addParty(),importParty:()=>this.props.importParty()})),n.a.createElement(h.a,{span:18,className:"scrollable"},n.a.createElement(Tt,{heading:"parties",content:t})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Js extends n.a.Component{constructor(e){super(e),this.state={cloneName:e.pc.name+" copy"}}setCloneName(e){this.setState({cloneName:e})}export(e){const t=e.name+".pc";b.saveFile(t,e)}render(){try{let e=null;this.props.pc.url&&(e=n.a.createElement("button",{onClick:()=>this.props.updatePC(this.props.pc)},"update pc from d&d beyond"));let t=null;t=this.props.pc.active?n.a.createElement("button",{key:"toggle-active",onClick:()=>this.props.changeValue(this.props.pc,"active",!1)},"mark pc as inactive"):n.a.createElement("button",{key:"toggle-active",onClick:()=>this.props.changeValue(this.props.pc,"active",!0)},"mark pc as active");const a=[];return this.props.parties.forEach(e=>{-1===e.pcs.indexOf(this.props.pc)&&a.push({id:e.id,text:e.name||"unnamed party"})}),n.a.createElement("div",null,n.a.createElement("button",{key:"edit",onClick:()=>this.props.editPC(this.props.pc)},"edit pc"),e,t,n.a.createElement("button",{key:"export",onClick:()=>this.export(this.props.pc)},"export pc"),n.a.createElement(oe,{text:"copy pc"},n.a.createElement(_,{text:this.state.cloneName,placeholder:"pc name",onChange:e=>this.setCloneName(e)}),n.a.createElement("button",{onClick:()=>this.props.clonePC(this.props.pc,this.state.cloneName)},"create copy")),n.a.createElement(se,{options:a,placeholder:"move to party...",onSelect:e=>this.props.moveToParty(this.props.pc,e)}),n.a.createElement(Ce,{text:"delete pc",onConfirm:()=>this.props.removePC(this.props.pc)}))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class _s extends n.a.Component{render(){try{const e=(this.props.pc?this.props.pc.displayName:null)||this.props.pc.name||"unnamed pc";return n.a.createElement("div",{className:"card pc"},n.a.createElement("div",{className:"heading"},n.a.createElement("div",{className:"title",title:e},e)),n.a.createElement("div",{className:"card-content"},n.a.createElement("div",{className:"stats"},n.a.createElement($,{source:this.props.pc}),n.a.createElement("div",{className:"section centered lowercase"},n.a.createElement(W.a,null,this.props.pc.race||"unknown race"),n.a.createElement(W.a,null,this.props.pc.classes||"unknown class"),n.a.createElement(W.a,null,"level "+this.props.pc.level)),n.a.createElement("div",{className:"section centered",style:{display:this.props.pc.url?"":"none"}},n.a.createElement("a",{href:this.props.pc.url,target:"_blank",rel:"noopener noreferrer"},"d&d beyond sheet"))),n.a.createElement("hr",null),n.a.createElement(Js,{pc:this.props.pc,parties:this.props.parties,editPC:e=>this.props.editPC(e),updatePC:e=>this.props.updatePC(e),removePC:e=>this.props.deletePC(e),clonePC:(e,t)=>this.props.clonePC(e,t),moveToParty:(e,t)=>this.props.moveToParty(e,t),changeValue:(e,t,a)=>this.props.changeValue(e,t,a)})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Ks extends n.a.Component{componentDidUpdate(){G.data.party&&B.sendPartyUpdate()}render(){try{const e=this.props.party.pcs.filter(e=>e.active),t=[];e.forEach(e=>{t.push(n.a.createElement(_s,{pc:e,parties:this.props.parties,changeValue:(e,t,a)=>this.props.changeValue(e,t,a),editPC:e=>this.props.editPC(e),updatePC:e=>this.props.updatePC(e),deletePC:e=>this.props.deletePC(e),clonePC:(e,t)=>this.props.clonePC(e,t),moveToParty:(e,t)=>this.props.moveToParty(e,t)}))});const a=this.props.party.pcs.filter(e=>!e.active),s=[];return a.forEach(e=>{s.push(n.a.createElement(_s,{pc:e,parties:this.props.parties,changeValue:(e,t,a)=>this.props.changeValue(e,t,a),editPC:e=>this.props.editPC(e),updatePC:e=>this.props.updatePC(e),deletePC:e=>this.props.deletePC(e),clonePC:(e,t)=>this.props.clonePC(e,t),moveToParty:(e,t)=>this.props.moveToParty(e,t)}))}),0===e.length&&t.push(n.a.createElement(Le,null,n.a.createElement("div",{className:"section"},"there are no pcs in this party"))),n.a.createElement(p.a,{className:"full-height"},n.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},n.a.createElement("div",{className:"section"},n.a.createElement("div",{className:"subheading"},"party name"),n.a.createElement(_,{text:this.props.party.name,placeholder:"party name",onChange:e=>this.props.changeValue(this.props.party,"name",e)})),n.a.createElement("hr",null),n.a.createElement(Us,{party:this.props.party,encounters:this.props.encounters,maps:this.props.maps,addPC:()=>this.props.addPC(),importPC:()=>this.props.importPC(),createEncounter:e=>this.props.createEncounter(e),startEncounter:(e,t)=>this.props.startEncounter(e,t),startExploration:(e,t)=>this.props.startExploration(e,t),setLevel:(e,t)=>this.props.setLevel(e,t),showReference:e=>this.props.showReference(e),deleteParty:e=>this.props.deleteParty(e)}),n.a.createElement("hr",null),n.a.createElement("button",{onClick:()=>this.props.goBack()},n.a.createElement(ws.a,{style:{fontSize:"10px"}})," back to the list")),n.a.createElement(h.a,{span:18,className:"scrollable"},n.a.createElement(Tt,{content:t,heading:this.props.party.name||"unnamed party"}),n.a.createElement(Tt,{content:s,heading:"inactive pcs"})))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class Xs extends n.a.Component{constructor(e){super(e),this.monsterIdToGroup={},this.saveAfterDelay=b.debounce(()=>this.saveAll(),5e3);let t=[];try{const e=window.localStorage.getItem("data-parties");e&&(t=JSON.parse(e),t.forEach(e=>{void 0===e.awards&&(e.awards=[]),e.pcs.forEach(e=>{void 0===e.darkvision&&(e.darkvision=0),void 0===e.awards&&(e.awards=[])})}))}catch(c){console.error("Could not parse JSON: ",c)}let a=[];try{const e=window.localStorage.getItem("data-library");e&&(a=JSON.parse(e),a.forEach(e=>{e.monsters.forEach(e=>{if(void 0===e.acInfo&&(e.acInfo=""),void 0===e.legendaryActions){const t=e.traits.some(e=>"legendary"===e.type||"mythic"===e.type)?3:0;e.legendaryActions=t}e.role=N.getRole(e)})}))}catch(c){console.error("Could not parse JSON: ",c)}let s=[];try{const e=window.localStorage.getItem("data-encounters");e&&(s=JSON.parse(e),s.forEach(e=>{e.slots.forEach(e=>{void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}),e.waves.forEach(e=>{e.slots.forEach(e=>{void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})})}))}catch(c){console.error("Could not parse JSON: ",c)}let n=[];try{const e=window.localStorage.getItem("data-maps");e&&(n=JSON.parse(e),n.forEach(e=>{e.items.forEach(e=>{void 0===e.customLink&&(e.customLink=""),void 0===e.z&&(e.z=0),void 0===e.depth&&(e.depth=1)}),void 0===e.areas&&(e.areas=[]),e.areas.forEach(e=>{void 0===e.z&&(e.z=0),void 0===e.depth&&(e.depth=1)})}))}catch(c){console.error("Could not parse JSON: ",c)}let r=[];try{const e=window.localStorage.getItem("data-combats");e&&(r=JSON.parse(e),r.forEach(e=>{e.combatants.forEach(e=>{if(void 0===e.faction)switch(e.type){case"pc":case"companion":e.faction="ally";break;case"monster":e.faction="foe";break;default:e.faction="neutral"}void 0===e.note&&(e.note=""),void 0===e.mountID&&(e.mountID=null),void 0===e.mountType&&(e.mountType="controlled"),void 0===e.darkvision&&(e.darkvision=0),void 0===e.lightSource&&(e.lightSource=null),void 0===e.path&&(e.path=null)}),e.encounter&&(e.encounter.slots.forEach(e=>{void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}),e.encounter.waves.forEach(e=>{e.slots.forEach(e=>{void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})})),e.map&&(e.map.items.forEach(e=>{void 0===e.customLink&&(e.customLink=""),void 0===e.z&&(e.z=0),void 0===e.depth&&(e.depth=1)}),void 0===e.map.areas&&(e.map.areas=[]),e.map.areas.forEach(e=>{void 0===e.z&&(e.z=0),void 0===e.depth&&(e.depth=1)})),void 0===e.fog&&(e.fog=[]),void 0===e.lighting&&(e.lighting="bright light")}))}catch(c){console.error("Could not parse JSON: ",c)}let i=[];try{const e=window.localStorage.getItem("data-explorations");e&&(i=JSON.parse(e),i.forEach(e=>{e.map.items.forEach(e=>{void 0===e.customLink&&(e.customLink="")}),void 0===e.map.areas&&(e.map.areas=[]),e.combatants.forEach(e=>{void 0===e.darkvision&&(e.darkvision=0),void 0===e.lightSource&&(e.lightSource=null),void 0===e.path&&(e.path=null)}),void 0===e.lighting&&(e.lighting="bright light")}))}catch(c){console.error("Could not parse JSON: ",c)}let o={showMonsterDieRolls:!1,theme:"light",diagonals:"onepointfive"};try{const e=window.localStorage.getItem("data-options");e&&(o=JSON.parse(e),void 0===o.theme&&(o.theme="light"),void 0===o.diagonals&&(o.diagonals="onepointfive"))}catch(c){console.error("Could not parse JSON: ",c)}const l={};[4,6,8,10,12,20,100].forEach(e=>l[e]=0),l[20]=1,this.state={view:"home",drawer:null,sidebar:{visible:!1,type:"tools",subtype:"die",dice:l,constant:0,dieRolls:[],handout:null,languageMode:"common",languagePreset:D.getLanguagePresets()[0].name,selectedLanguages:D.getLanguagePresets()[0].languages,languageOutput:[],surge:"",draws:[],npc:null,selectedPartyID:null,selectedMonsterID:null},parties:t,library:a,encounters:s,maps:n,combats:r,explorations:i,options:o,selectedPartyID:null,selectedMonsterGroupID:null,selectedEncounterID:null,selectedMapID:null,selectedCombatID:null,selectedExplorationID:null},S.clearUnusedImages(n,r,i)}componentDidMount(){g.a.bind("ctrl+f",e=>{e.preventDefault(),this.setSidebar("search")}),B.onStateChanged=()=>this.setState(this.state),B.onDataChanged=()=>this.setState(this.state),B.onNewConnection=e=>{this.state.sidebar.visible&&"session"===this.state.sidebar.type&&"people"===this.state.sidebar.subtype||d.a.open({message:n.a.createElement("p",null,n.a.createElement("b",null,e)," has joined"),closeIcon:n.a.createElement(c.a,null),duration:5})},G.onNewMessage=e=>{this.state.sidebar.visible&&"session"===this.state.sidebar.type&&"messages"===this.state.sidebar.subtype||d.a.open({message:n.a.createElement(Ga,{user:"dm",message:e,openImage:e=>this.setState({drawer:{type:"image",data:e}})}),closeIcon:n.a.createElement(c.a,null),duration:5})}}componentWillUnmount(){g.a.unbind("ctrl+f"),B.onStateChanged=null,B.onDataChanged=null,B.onNewConnection=null,G.onNewMessage=null,B.shutdown()}componentDidUpdate(){this.saveAfterDelay()}setView(e){this.save(),this.setState({view:e})}setSidebar(e){let t="";switch(e){case"tools":t="die";break;case"generators":t="name";break;case"reference":t="skills";break;case"session":t="management";break;case"about":t="dojo"}const a=this.state.sidebar;a.visible=!0,a.type=e,a.subtype=t,this.setState({sidebar:a})}openDice(){const e=this.state.sidebar;e.visible=!0,e.type="tools",e.subtype="die",e.dice={},[4,6,8,10,12,20,100].forEach(t=>e.dice[t]=0),e.dice[6]=1,this.setState({sidebar:e})}toggleSidebar(){const e=this.state.sidebar;e.visible=!e.visible,this.setState({sidebar:e})}closeDrawer(){this.setState({drawer:null})}selectParty(e){this.setState({selectedPartyID:e?e.id:null})}selectMonsterGroup(e){this.setState({selectedMonsterGroupID:e?e.id:null})}selectEncounter(e){this.setState({selectedEncounterID:e?e.id:null})}selectMap(e){this.setState({selectedMapID:e?e.id:null})}selectPartyByID(e){this.save(),this.setState({view:"parties",selectedPartyID:e})}selectMonsterGroupByID(e){this.save(),this.setState({view:"library",selectedMonsterGroupID:e})}selectEncounterByID(e){this.save(),this.setState({view:"encounters",selectedEncounterID:e,selectedCombatID:null})}selectMapByID(e){this.save(),this.setState({view:"maps",selectedMapID:e,selectedExplorationID:null})}selectCombatByID(e){this.save(),this.setState({view:"encounters",selectedEncounterID:null,selectedCombatID:e})}selectExplorationByID(e){this.save(),this.setState({view:"maps",selectedMapID:null,selectedExplorationID:e})}rollDice(e,t,a,s,r){const i={};[4,6,8,10,12,20,100].forEach(e=>i[e]=0),i[a]=t;const o=f.rollDice(i,s,r),l=this.state.sidebar;l.dieRolls.push(o),this.setState({sidebar:l},()=>{d.a.open({key:o.id,message:n.a.createElement("div",null,n.a.createElement("div",{className:"section subheading"},e),n.a.createElement(Wt,{result:o})),closeIcon:n.a.createElement(c.a,null),duration:5})})}openSession(){const e=this.state.sidebar;e.visible=!0,e.type="session",e.subtype="management",this.setState({sidebar:e})}getMonster(e){let t=this.monsterIdToGroup[e];if(!t){t=this.state.library.reduce((e,t)=>e.concat(t.monsters),[]).find(t=>t.id===e)||null,t&&(this.monsterIdToGroup[e]=t)}return t}changeValue(e,t,a){const s=t.split(".");let n=e;for(let r=0;r!==s.length;++r){const e=s[r];r===s.length-1?n[e]=a:n=n[e]}if(b.sort(this.state.parties),b.sort(this.state.library),b.sort(this.state.encounters),b.sort(this.state.maps),b.sort(this.state.combats),b.sort(this.state.explorations),"initiative"===t&&!e.pending){const e=this.state.combats.find(e=>e.id===this.state.selectedCombatID);M.sortCombatants(e)}if("hpCurrent"===t){const t=e;t.hpCurrent=Math.min(t.hpCurrent||0,t.hpMax||0),t.hpCurrent=Math.max(t.hpCurrent||0,0)}if("hpTemp"===t){const t=e;t.hpTemp=Math.max(t.hpTemp||0,0)}if("mountID"===t){const e=this.state.combats.find(e=>e.id===this.state.selectedCombatID);e&&e.map&&M.setMountPositions(e.combatants,e.map)}this.setState({parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,combats:this.state.combats,explorations:this.state.explorations,selectedPartyID:this.state.selectedPartyID,selectedMonsterGroupID:this.state.selectedMonsterGroupID,selectedEncounterID:this.state.selectedEncounterID,selectedMapID:this.state.selectedMapID,selectedCombatID:this.state.selectedCombatID,selectedExplorationID:this.state.selectedExplorationID,drawer:this.state.drawer,sidebar:this.state.sidebar})}nudgeValue(e,t,a){const s=t.split(".");let n=e;for(let r=0;r!==s.length;++r){const i=s[r];if(r===s.length-1){let s=null;switch(i){case"challenge":s=f.nudgeChallenge(n[i],a);break;case"size":case"displaySize":s=f.nudgeSize(n[i],a);break;default:s=n[i]+a}this.changeValue(e,t,s)}else n=n[i]}}addParty(){const e=E.createParty(),t=[].concat(this.state.parties,[e]);b.sort(t),this.setState({parties:t,selectedPartyID:e.id})}deleteParty(e){const t=this.state.parties.indexOf(e);this.state.parties.splice(t,1),this.setState({parties:this.state.parties,selectedPartyID:null})}importParty(){this.setState({drawer:{type:"import-party",party:E.createParty()}})}acceptImportedParty(){this.state.parties.push(this.state.drawer.party),this.setState({parties:this.state.parties,drawer:null})}setPartyLevel(e,t){e.pcs.filter(e=>e.active).forEach(e=>e.level=t),this.setState({parties:this.state.parties})}showPartyReference(e){const t=this.state.sidebar;t.visible=!0,t.type="reference",t.subtype="party",t.selectedPartyID=e.id,this.setState({sidebar:t})}clonePC(e,t){const a=this.state.parties.find(t=>t.pcs.includes(e));if(a){const s=JSON.parse(JSON.stringify(e));s.id=b.guid(),s.name=t,a.pcs.push(s),b.sort(a.pcs),this.setState({parties:this.state.parties})}}moveToParty(e,t){const a=this.state.parties.find(t=>t.pcs.includes(e));if(a){const s=a.pcs.indexOf(e);a.pcs.splice(s,1);const n=this.state.parties.find(e=>e.id===t);n&&(n.pcs.push(e),b.sort(n.pcs),this.setState({parties:this.state.parties}))}}deletePC(e){const t=this.state.parties.find(e=>e.id===this.state.selectedPartyID);if(t){const a=t.pcs.indexOf(e);t.pcs.splice(a,1),this.setState({parties:this.state.parties})}}editPC(e){e||(e=E.createPC());const t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"pc",pc:t}})}importPC(){this.setState({drawer:{type:"import-pc",pc:E.createPC()}})}acceptImportedPC(){const e=this.state.parties.find(e=>e.id===this.state.selectedPartyID);e&&(e.pcs.push(this.state.drawer.pc),b.sort(e.pcs),this.setState({parties:this.state.parties,drawer:null}))}updatePC(e){const t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"update-pc",pc:t}})}savePC(){b.sort(this.state.drawer.pc.companions);const e=this.state.parties.find(e=>e.id===this.state.selectedPartyID);if(e){const t=e.pcs.find(e=>e.id===this.state.drawer.pc.id);if(t){const a=e.pcs.indexOf(t);e.pcs[a]=this.state.drawer.pc}else e.pcs.push(this.state.drawer.pc);b.sort(e.pcs),this.setState({parties:this.state.parties,drawer:null})}}addMonsterGroup(){const e=E.createMonsterGroup(),t=[].concat(this.state.library,[e]);b.sort(t),this.setState({library:t,selectedMonsterGroupID:e.id})}importMonsterGroup(){this.setState({drawer:{type:"import-group",group:E.createMonsterGroup()}})}acceptImportedGroup(){this.state.library.push(this.state.drawer.group),this.setState({library:this.state.library,drawer:null})}deleteMonsterGroup(e){const t=this.state.library.indexOf(e);this.state.library.splice(t,1),this.setState({library:this.state.library,selectedMonsterGroupID:null})}deleteMonster(e){const t=this.state.library.find(e=>e.id===this.state.selectedMonsterGroupID);if(t){const a=t.monsters.indexOf(e);t.monsters.splice(a,1),this.setState({library:this.state.library})}}importMonster(){this.setState({drawer:{type:"import-monster",monster:E.createMonster()}})}acceptImportedMonster(){const e=this.state.library.find(e=>e.id===this.state.selectedMonsterGroupID);e&&(e.monsters.push(this.state.drawer.monster),b.sort(e.monsters),this.setState({library:this.state.library,drawer:null}))}moveToGroup(e,t){const a=this.state.library.find(t=>t.monsters.includes(e));if(a){const s=a.monsters.indexOf(e);a.monsters.splice(s,1);const n=this.state.library.find(e=>e.id===t);n&&(n.monsters.push(e),b.sort(n.monsters),this.setState({library:this.state.library}))}}addMonster(e){if(e){const t=this.state.library.find(e=>e.id===this.state.selectedMonsterGroupID);t&&(t.monsters.push(e),b.sort(t.monsters),this.setState({library:this.state.library,drawer:{type:"statblock",source:e}}))}else{e=E.createMonster();const t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:t}})}}editMonster(e){const t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:t}})}saveMonster(){const e=this.state.library.find(e=>e.id===this.state.selectedMonsterGroupID);if(e){const t=e.monsters.find(e=>e.id===this.state.drawer.monster.id);if(t){const a=e.monsters.indexOf(t);e.monsters[a]=this.state.drawer.monster}else e.monsters.push(this.state.drawer.monster);b.sort(e.monsters),this.setState({library:this.state.library,drawer:null})}}cloneMonster(e,t){const a=this.state.library.find(t=>t.monsters.includes(e));if(a){const s=JSON.parse(JSON.stringify(e));s.id=b.guid(),s.name=t,s.traits.forEach(e=>e.id=b.guid()),a.monsters.push(s),b.sort(a.monsters),this.setState({library:this.state.library})}}addOpenGameContent(){fetch("/dojo/data/monsters.json").then(e=>e.json()).then(e=>{e.forEach(e=>{try{if(e.name){const t=N.createFromJSON(e);let a=t.tag||t.category;0===a.indexOf("swarm")&&(a="swarm"),"any race"===a&&(a="npc");let s=this.state.library.find(e=>e.name===a);s||(s={id:b.guid(),name:a,monsters:[]},this.state.library.push(s)),s.monsters.push(t)}}catch(t){console.error(t)}}),b.sort(this.state.library),this.setState({library:this.state.library})})}openDemographics(e){this.setState({drawer:{type:"monster-demographics",group:e}})}addEncounter(e){const t=E.createEncounter();if(e){const a=M.encounterTemplates().find(t=>t.name===e);a&&(t.slots=a.slots.map(e=>{const t=E.createEncounterSlot();return t.roles=e.roles,t.count=e.count,t}),t.waves=[])}const a=[].concat(this.state.encounters,[t]);b.sort(a),this.setState({view:"encounters",encounters:a,selectedEncounterID:t.id})}createEncounter(e){this.setState({drawer:{type:"random-encounter",data:{type:null===e?"xp":"party",xp:1e3,partyID:e,difficulty:"medium",filter:E.createMonsterFilter()}}})}createEncounterFromModal(){const e=E.createEncounter();M.buildEncounter(e,this.state.drawer.data.xp,this.state.drawer.data.filter,this.state.library,e=>this.getMonster(e)),M.sortEncounter(e,e=>this.getMonster(e));const t=[].concat(this.state.encounters,[e]);b.sort(t),this.setState({view:"encounters",drawer:null,encounters:t,selectedEncounterID:e.id})}cloneEncounter(e,t){const a=JSON.parse(JSON.stringify(e));a.id=b.guid(),a.slots.forEach(e=>e.id=b.guid()),a.waves.forEach(e=>{e.id=b.guid(),e.slots.forEach(e=>e.id=b.guid())}),a.name=t,this.state.encounters.push(a),b.sort(this.state.encounters),this.setState({encounters:this.state.encounters})}deleteEncounter(e){const t=this.state.encounters.indexOf(e);this.state.encounters.splice(t,1),this.setState({encounters:this.state.encounters,selectedEncounterID:null})}addToEncounterSlot(e,t,a,s,n){const r=t?t.slots:e.slots;a||(a=E.createEncounterSlot(),r.push(a));if(this.state.library.find(e=>e.monsters.includes(s))){a.monsterID=s.id,M.sortEncounter(e,e=>this.getMonster(e));let t=this.state.drawer;n?t=null:t.monster=null,this.setState({encounters:this.state.encounters,drawer:t})}}createEncounterFromMonsters(e){const t=E.createEncounter();e.forEach(e=>{const a=E.createEncounterSlot();a.monsterID=e,t.slots.push(a)}),this.state.encounters.push(t),this.setState({view:"encounters",encounters:this.state.encounters,selectedEncounterID:t.id})}addMap(){const e=E.createMap(),t=[].concat(this.state.maps,[e]);b.sort(t),this.setState({maps:t,selectedMapID:e.id})}generateMap(e){const t=E.createMap();V.generate(e,t),this.state.maps.push(t),this.setState({maps:this.state.maps})}cloneMap(e,t){const a=JSON.parse(JSON.stringify(e));a.id=b.guid(),a.items.forEach(e=>e.id=b.guid()),a.areas.forEach(e=>e.id=b.guid()),a.name=t,this.state.maps.push(a),b.sort(this.state.maps),this.setState({maps:this.state.maps})}importMap(){const e=E.createMap();this.setState({drawer:{type:"import-map",map:e}})}acceptImportedMap(){this.state.maps.push(this.state.drawer.map),this.setState({maps:this.state.maps,drawer:null})}declineImportedMap(){if(this.state.drawer.map.items.length>0){const e=this.state.drawer.map.items[0].customBackground;window.localStorage.removeItem("image-"+e)}this.closeDrawer()}deleteMap(e){const t=this.state.maps.indexOf(e);this.state.maps.splice(t,1),this.setState({maps:this.state.maps,selectedMapID:null})}selectMapTileImage(e,t){this.setState({drawer:{type:"select-image",tile:t}})}cloneMapTile(e,t){const a=JSON.parse(JSON.stringify(t));a.id=b.guid(),a.x+=1,a.y+=1,e.items.push(a),this.setState({maps:this.state.maps})}rotateMapTile(e,t){const a=t.width;t.width=t.height,t.height=a;const s=Math.floor((t.width-t.height)/2);t.x-=s,t.y+=s,t.content&&(t.content.orientation="horizontal"===t.content.orientation?"vertical":"horizontal"),this.setState({maps:this.state.maps})}deleteMapTile(e,t){const a=e.items.indexOf(t);e.items.splice(a,1),this.setState({maps:this.state.maps})}clearMapTiles(e){e.items=[],this.setState({maps:this.state.maps})}bringToFront(e,t){const a=e.items.indexOf(t);e.items.splice(a,1),e.items.push(t),this.setState({maps:this.state.maps})}sendToBack(e,t){const a=e.items.indexOf(t);e.items.splice(a,1),e.items.unshift(t),this.setState({maps:this.state.maps})}moveMapTileOrArea(e,t,a,s){V.move(e,t.id,a,s),this.setState({maps:this.state.maps})}addMapArea(e,t){e.areas.push(t),b.sort(e.areas),this.setState({maps:this.state.maps})}deleteMapArea(e,t){const a=e.areas.indexOf(t);e.areas.splice(a,1),this.setState({maps:this.state.maps})}clearMapAreas(e){e.areas=[],this.setState({maps:this.state.maps})}generateRoom(e){V.generate("room",e),this.setState({maps:this.state.maps})}startExploration(e,t){const a=this.state.parties.find(e=>e.id===t);if(a){const s=JSON.parse(JSON.stringify(e)),n=E.createExploration();n.name=a.name+" in "+e.name,n.map=s,n.partyID=t,a.pcs.filter(e=>e.active).forEach(e=>{const t=M.convertPCToCombatant(e);n.combatants.push(t)}),this.state.explorations.push(n),this.setState({view:"maps",explorations:this.state.explorations,selectedExplorationID:n.id})}}pauseExploration(){"exploration"===G.data.shared.type&&B.shareNothing(),this.setState({selectedExplorationID:null})}resumeExploration(e){this.setState({view:"maps",selectedExplorationID:e.id})}endExploration(e){"exploration"===G.data.shared.type&&B.shareNothing();const t=this.state.explorations.indexOf(e);this.state.explorations.splice(t,1),this.setState({explorations:this.state.explorations,selectedExplorationID:null})}addCompanionToExploration(e){const t=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);t&&(t.combatants.push(M.convertCompanionToCombatant(e)),b.sort(t.combatants,[{field:"displayName",dir:"asc"}]),this.setState({explorations:this.state.explorations}))}createCombat(e,t,a=null,s=[],n="bright light",r=[]){let i=1===this.state.parties.length?this.state.parties[0]:null;if(e){const t=this.state.parties.find(t=>t.id===e);t&&(i=t)}let o=1===this.state.encounters.length?this.state.encounters[0]:null;t&&(o=t);const l=E.createCombatSetup();l.party=JSON.parse(JSON.stringify(i)),l.encounter=JSON.parse(JSON.stringify(t)),o&&(l.slotInfo=f.getCombatSlotData(o,this.state.library)),a&&(l.map=a),l.fog=s,l.lighting=n,l.combatants=r,this.setState({drawer:{type:"combat-start",combatSetup:l}})}startCombat(){const e=this.state.drawer.combatSetup;if(e.party&&e.encounter){const t=e.party.name||"unnamed party",a=e.encounter.name||"unnamed encounter",s=E.createCombat();s.name=t+" vs "+a,s.encounter=JSON.parse(JSON.stringify(e.encounter)),e.combatants.forEach(e=>{s.combatants.push(e)}),e.party.pcs.filter(e=>e.active).forEach(e=>{s.combatants.find(t=>t.id===e.id)||s.combatants.push(M.convertPCToCombatant(e))}),s.encounter.slots.forEach(t=>{const a=this.getMonster(t.monsterID),n=e.slotInfo.find(e=>e.id===t.id);a&&n?n.members.forEach(e=>{s.combatants.push(M.convertMonsterToCombatant(a,e.init,e.hp,e.name,t.faction))}):s.issues.push("unknown monster")}),s.combatants.push(M.convertPlaceholderToCombatant()),M.sortCombatants(s),e.map&&(s.map=JSON.parse(JSON.stringify(e.map)),s.fog=e.fog,s.lighting=e.lighting),this.setState({combats:[].concat(this.state.combats,[s]),selectedCombatID:s.id,drawer:null,view:"encounters"})}}openAddWaveModal(){const e=this.state.combats.find(e=>e.id===this.state.selectedCombatID);if(e){const t=E.createCombatSetup();t.encounter=e.encounter,t.slotInfo=f.getCombatSlotData(e.encounter,this.state.library),this.setState({drawer:{type:"combat-wave",combatSetup:t}})}}addWaveToCombat(){const e=this.state.drawer.combatSetup,t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);if(e&&e.encounter&&t){const a=e.encounter.waves.find(t=>t.id===e.waveID);a&&(a.slots.forEach(a=>{const s=this.getMonster(a.monsterID),n=e.slotInfo.find(e=>e.id===a.id);s&&n?n.members.forEach(e=>{t.combatants.push(M.convertMonsterToCombatant(s,e.init,e.hp,e.name,a.faction))}):t.issues.push("unknown monster")}),M.sortCombatants(t),this.setState({combats:this.state.combats,drawer:null}))}}openAddCombatantModal(){if(this.state.combats.find(e=>e.id===this.state.selectedCombatID)){const e=E.createCombatSetup();e.encounter=E.createEncounter(),e.slotInfo=f.getCombatSlotData(e.encounter,this.state.library),this.setState({drawer:{type:"combat-add-combatants",combatSetup:e}})}}addMonsterToAddCombatantsModal(e){const t=this.state.drawer.combatSetup;if(t&&t.encounter){if(this.state.library.find(t=>t.monsters.find(t=>t.id===e.id))){const a=E.createEncounterSlot();a.monsterID=e.id,t.encounter.slots.push(a),t.slotInfo=f.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:this.state.drawer})}}}addCombatantsToCombat(){const e=this.state.combats.find(e=>e.id===this.state.selectedCombatID),t=this.state.drawer.combatSetup;e&&t&&t.encounter&&(t.encounter.slots.forEach(a=>{const s=this.getMonster(a.monsterID),n=t.slotInfo.find(e=>e.id===a.id);s&&n?n.members.forEach(t=>{e.combatants.push(M.convertMonsterToCombatant(s,t.init,t.hp,t.name,a.faction))}):e.issues.push("unknown monster")}),M.sortCombatants(e),this.setState({combats:this.state.combats,drawer:null}))}addPCToEncounter(e,t){const a=this.state.combats.find(e=>e.id===this.state.selectedCombatID);if(a){const s=this.state.parties.find(t=>t.id===e);if(s){const e=s.pcs.find(e=>e.id===t);e&&(a.combatants.push(M.convertPCToCombatant(e)),this.setState({combats:this.state.combats}))}}}addCompanionToEncounter(e){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);t&&(t.combatants.push(M.convertCompanionToCombatant(e)),b.sort(t.combatants,[{field:"displayName",dir:"asc"}]),this.setState({combats:this.state.combats}))}pauseCombat(){"combat"===G.data.shared.type&&B.shareNothing();this.state.combats.find(e=>e.id===this.state.selectedCombatID)&&this.setState({selectedCombatID:null})}resumeCombat(e){this.setState({view:"encounters",selectedCombatID:e.id})}endCombat(e,t=!1){"combat"===G.data.shared.type&&B.shareNothing();const a=this.state.combats.indexOf(e);this.state.combats.splice(a,1),this.setState({combats:this.state.combats,selectedCombatID:null},()=>{if(e&&e.map&&t){const t=e.combatants.filter(e=>"pc"===e.type||"companion"===e.type);t.forEach(e=>{e.current=!1,e.pending=!0,e.active=!1,e.defeated=!1,e.initiative=10});let a=null;const s=t.filter(e=>"pc"===e.type);if(s.length>0){const e=this.state.parties.find(e=>e.pcs.find(e=>e.id===s[0].id));e&&(a=e.id,e.pcs.forEach(e=>{t.find(t=>t.id===e.id)||t.push(M.convertPCToCombatant(e))}))}if(b.sort(t,[{field:"displayName",dir:"asc"}]),a){const s=e.map.id;let n=this.state.explorations.find(e=>e.map.id===s&&e.partyID===a);n||(n=E.createExploration(),n.name=e.name+"in "+e.map.name,n.partyID=a,this.state.explorations.push(n)),n.map=e.map,n.fog=e.fog,n.lighting=e.lighting,n.combatants=t,n.map.items=n.map.items.filter(e=>"tile"===e.type||"pc"===e.type||"companion"===e.type),this.setState({view:"maps",explorations:this.state.explorations,selectedExplorationID:n.id})}}})}makeCurrent(e,t){const a=this.state.combats.find(e=>e.id===this.state.selectedCombatID);a&&(a.combatants.filter(e=>e.conditions).forEach(t=>{t.conditions.forEach(s=>{if(s.duration)switch(s.duration.type){case"saves":if(e&&t.id===e.id&&"start"===s.duration.point){const e={id:b.guid(),type:"condition-save",data:s,combatant:t};d.a.open({key:e.id,message:n.a.createElement(Ht,{notification:e,close:(e,t)=>this.closeNotification(e,t)}),closeIcon:n.a.createElement(c.a,null),duration:null})}break;case"combatant":if(e&&(s.duration.combatantID===e.id||null===s.duration.combatantID)&&"start"===s.duration.point){const e=t.conditions.indexOf(s);t.conditions.splice(e,1);const a={id:b.guid(),type:"condition-end",data:s,combatant:t};d.a.open({key:a.id,message:n.a.createElement(Ht,{notification:a,close:(e,t)=>this.closeNotification(e,t)}),closeIcon:n.a.createElement(c.a,null),duration:null})}break;case"rounds":if(e&&t.id===e.id&&(s.duration.count-=1),0===s.duration.count){const e=t.conditions.indexOf(s);if(t.conditions.splice(e,1),a){const e={id:b.guid(),type:"condition-end",data:s,combatant:t};d.a.open({key:e.id,message:n.a.createElement(Ht,{notification:e,close:(e,t)=>this.closeNotification(e,t)}),closeIcon:n.a.createElement(c.a,null),duration:null})}}}})}),e&&"monster"===e.type&&(e.traits.filter(e=>e.uses>0&&e.usage.toLowerCase().startsWith("recharge ")).forEach(t=>{const a={id:b.guid(),type:"trait-recharge",data:t,combatant:e};d.a.open({key:a.id,message:n.a.createElement(Ht,{notification:a,openSidebar:()=>this.openDice(),close:(e,t)=>this.closeNotification(e,t)}),closeIcon:n.a.createElement(c.a,null),duration:null})}),e.traits.filter(e=>"legendary"===e.type||"mythic"===e.type).forEach(e=>{e.uses=0})),a.combatants.forEach(e=>{e.current=!1,e.path=null}),e&&(e.current=!0,e.path=[]),t&&(a.round+=1),this.setState({combats:this.state.combats}))}makeActive(e){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);if(t){const a=e.some(e=>e.pending);e.forEach(e=>{e.pending=!1,e.active=!0,e.defeated=!1}),a&&M.sortCombatants(t),this.setState({combats:this.state.combats})}}makeDefeated(e){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);if(t){const a=t.combatants.find(e=>e.current);e.forEach(e=>{e.pending=!1,e.active=!1,e.defeated=!0,e.mountID=null,e.mountType="controlled",t.combatants.forEach(t=>{t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")}),t.combatants.forEach(t=>{t.tags=t.tags.filter(t=>t!=="engaged:"+e.displayName)}),t.map&&(t.map.items=t.map.items.filter(t=>t.id!==e.id))}),a&&e.find(e=>e.id===a.id)?this.endTurn(a):this.setState({combats:this.state.combats})}}removeCombatants(e){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);t&&(e.forEach(e=>{const a=t.combatants.indexOf(e);if(t.combatants.splice(a,1),t.combatants.forEach(t=>{t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")}),t.combatants.forEach(t=>{t.tags=t.tags.filter(t=>t!=="engaged:"+e.displayName)}),t.map){const a=t.map.items.find(t=>t.id===e.id);if(a){const e=t.map.items.indexOf(a);t.map.items.splice(e,1)}}}),this.setState({combats:this.state.combats}))}endTurn(e){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);if(t){t.combatants.filter(e=>e.conditions).forEach(t=>{t.conditions.forEach(a=>{if(a.duration)switch(a.duration.type){case"saves":if(t.id===e.id&&"end"===a.duration.point){const e=E.createNotification();e.type="condition-save",e.data=a,e.combatant=t,d.a.open({key:e.id,message:n.a.createElement(Ht,{notification:e,close:(e,t)=>this.closeNotification(e,t)}),closeIcon:n.a.createElement(c.a,null),duration:null})}break;case"combatant":if((a.duration.combatantID===e.id||null===a.duration.combatantID)&&"end"===a.duration.point){const e=t.conditions.indexOf(a);t.conditions.splice(e,1);const s=E.createNotification();s.type="condition-end",s.data=a,s.combatant=t,d.a.open({key:s.id,message:n.a.createElement(Ht,{notification:s,close:(e,t)=>this.closeNotification(e,t)}),closeIcon:n.a.createElement(c.a,null),duration:null})}}})});const a=t.combatants.filter(e=>!!e.mountID&&"controlled"===e.mountType).map(e=>e.mountID||""),s=t.combatants.filter(e=>!a.includes(e.id)).filter(e=>e.current||!e.pending&&e.active&&!e.defeated).filter(e=>"placeholder"!==e.type||M.combatHasLairActions(t));if(0===s.length)this.makeCurrent(null,!1);else if(1===s.length&&s[0].defeated)this.makeCurrent(null,!1);else{let t=s.indexOf(e)+1,a=!1;t>=s.length&&(t=0,a=!0),this.makeCurrent(s[t],a)}}}changeHP(e){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);t&&(e.forEach(e=>{const a=t.combatants.find(t=>t.id===e.id);a&&(a.hpCurrent=e.hp,a.hpTemp=e.temp)}),this.setState({combats:this.state.combats}))}closeNotification(e,t){if(d.a.close(e.id),t&&e.combatant&&e.data){const t=e.combatant.conditions.indexOf(e.data);e.combatant.conditions.splice(t,1)}this.setState({combats:this.state.combats})}toggleTag(e,t){e.forEach(e=>{e.tags.includes(t)?e.tags=e.tags.filter(e=>e!==t):e.tags.push(t)}),this.setState({combats:this.state.combats,explorations:this.state.explorations})}toggleCondition(e,t){e.forEach(e=>{if(e.conditions.some(e=>e.name===t))e.conditions=e.conditions.filter(e=>e.name!==t);else{const a=E.createCondition();a.name=t,e.conditions.push(a),e.conditions=b.sort(e.conditions,[{field:"name",dir:"asc"}])}}),this.setState({combats:this.state.combats,explorations:this.state.explorations})}toggleHidden(e){e.forEach(e=>e.showOnMap=!e.showOnMap),this.setState({combats:this.state.combats,explorations:this.state.explorations})}addCondition(e,t){const a=E.createCondition();a.name="blinded",this.setState({drawer:{type:"condition-add",condition:a,combatants:e,allCombatants:t}})}addConditionFromModal(){this.state.drawer.combatants.forEach(e=>{const t=JSON.parse(JSON.stringify(this.state.drawer.condition));t.id=b.guid(),e.conditions.push(t),b.sort(e.conditions,[{field:"name",dir:"asc"}])}),this.setState({combats:this.state.combats,explorations:this.state.explorations,drawer:null})}editCondition(e,t,a){this.setState({drawer:{type:"condition-edit",condition:t,combatants:[e],allCombatants:a}})}editConditionFromModal(){this.state.drawer.combatants.forEach(e=>{const t=e.conditions.find(e=>e.id===this.state.drawer.condition.id);if(t){const a=e.conditions.indexOf(t);e.conditions[a]=this.state.drawer.condition,b.sort(e.conditions,[{field:"name",dir:"asc"}])}}),this.setState({combats:this.state.combats,explorations:this.state.explorations,drawer:null})}deleteCondition(e,t){e.conditions=e.conditions.filter(e=>e.name!==t.name),this.setState({combats:this.state.combats,explorations:this.state.explorations})}scatterCombatants(e,t,a,s){V.scatterCombatants(a,e,s),M.setMountPositions(t,a),this.setState({combats:this.state.combats,explorations:this.state.explorations})}rotateMap(e){V.rotateMap(e),this.setState({combats:this.state.combats,maps:this.state.maps,explorations:this.state.explorations})}mapAdd(e,t,a,s,n){M.getMountsAndRiders([e.id],s).forEach(e=>V.add(n,e,t,a)),this.setState({combats:this.state.combats,explorations:this.state.explorations})}mapMove(e,t,a,s,n){V.moveCombatants(e,t,a,s,n),this.setState({combats:this.state.combats,explorations:this.state.explorations})}mapRemove(e,t,a){const s=M.getMountsAndRiders(e,t).map(e=>e.id);e.forEach(e=>{s.includes(e)||s.push(e)}),s.forEach(e=>V.remove(a,e)),this.setState({combats:this.state.combats,explorations:this.state.explorations})}addMapItem(e,t){t.items.push(e),this.setState({combats:this.state.combats,maps:this.state.maps,explorations:this.state.explorations})}useTrait(e){e.uses+=1,this.setState({combats:this.state.combats,explorations:this.state.explorations})}rechargeTrait(e){e.uses=0,this.setState({combats:this.state.combats,explorations:this.state.explorations})}save(){switch(this.state.view){case"parties":this.saveKey(this.state.parties,"data-parties");break;case"library":this.saveKey(this.state.library,"data-library");break;case"encounters":this.saveKey(this.state.encounters,"data-encounters"),this.saveKey(this.state.combats,"data-combats");break;case"maps":this.saveKey(this.state.maps,"data-maps"),this.saveKey(this.state.explorations,"data-explorations")}this.saveKey(this.state.options,"data-options")}saveAll(){this.saveKey(this.state.parties,"data-parties"),this.saveKey(this.state.library,"data-library"),this.saveKey(this.state.encounters,"data-encounters"),this.saveKey(this.state.maps,"data-maps"),this.saveKey(this.state.combats,"data-combats"),this.saveKey(this.state.explorations,"data-explorations"),this.saveKey(this.state.options,"data-options")}saveKey(e,t){try{const a=JSON.stringify(e);window.localStorage.setItem(t,a)}catch(a){console.error("Could not stringify data: ",a)}}getBreadcrumbs(){const e=[];switch(e.push({id:"home",text:"dojo",onClick:()=>this.setView("home")}),this.state.view){case"parties":if(e.push({id:"parties",text:"pcs",onClick:()=>this.selectPartyByID(null)}),this.state.selectedPartyID){const t=this.state.parties.find(e=>e.id===this.state.selectedPartyID);e.push({id:t.id,text:t.name||"unnamed party",onClick:()=>this.selectPartyByID(this.state.selectedPartyID)})}break;case"library":if(e.push({id:"library",text:"monsters",onClick:()=>this.selectMonsterGroupByID(null)}),this.state.selectedMonsterGroupID){const t=this.state.library.find(e=>e.id===this.state.selectedMonsterGroupID);e.push({id:t.id,text:t.name||"unnamed group",onClick:()=>this.selectMonsterGroupByID(this.state.selectedMonsterGroupID)})}break;case"encounters":if(e.push({id:"encounters",text:"encounters",onClick:()=>this.selectEncounterByID(null)}),this.state.selectedEncounterID){const t=this.state.encounters.find(e=>e.id===this.state.selectedEncounterID);e.push({id:t.id,text:t.name||"unnamed encounter",onClick:()=>this.selectEncounterByID(this.state.selectedEncounterID)})}if(this.state.selectedCombatID){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);e.push({id:t.id,text:t.name||"unnamed combat",onClick:()=>this.selectCombatByID(this.state.selectedCombatID)})}break;case"maps":if(e.push({id:"maps",text:"maps",onClick:()=>this.selectMapByID(null)}),this.state.selectedMapID){const t=this.state.maps.find(e=>e.id===this.state.selectedMapID);e.push({id:t.id,text:t.name||"unnamed map",onClick:()=>this.selectMapByID(this.state.selectedMapID)})}if(this.state.selectedExplorationID){const t=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);e.push({id:t.id,text:t.name||"unnamed exploration",onClick:()=>this.selectExplorationByID(this.state.selectedExplorationID)})}}return e}getContent(){let e=!1;this.state.parties.forEach(t=>e=e||t.pcs.length>0);let t=!1;switch(this.state.library.forEach(e=>t=t||e.monsters.length>0),this.state.view){case"home":return n.a.createElement(Ss,null);case"parties":return this.state.selectedPartyID?n.a.createElement(Ks,{party:this.state.parties.find(e=>e.id===this.state.selectedPartyID),parties:this.state.parties,encounters:this.state.encounters,maps:this.state.maps,goBack:()=>this.selectParty(null),deleteParty:e=>this.deleteParty(e),addPC:()=>this.editPC(null),importPC:()=>this.importPC(),editPC:e=>this.editPC(e),updatePC:e=>this.updatePC(e),deletePC:e=>this.deletePC(e),clonePC:(e,t)=>this.clonePC(e,t),moveToParty:(e,t)=>this.moveToParty(e,t),createEncounter:e=>this.createEncounter(e),startEncounter:(e,t)=>{const a=this.state.encounters.find(e=>e.id===t);this.createCombat(e,a)},startExploration:(e,t)=>{const a=this.state.maps.find(e=>e.id===t);this.startExploration(a,e)},setLevel:(e,t)=>this.setPartyLevel(e,t),showReference:e=>this.showPartyReference(e),changeValue:(e,t,a)=>this.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a)}):n.a.createElement(Ws,{parties:this.state.parties,encounters:this.state.encounters,maps:this.state.maps,addParty:()=>this.addParty(),importParty:()=>this.importParty(),openParty:e=>this.selectParty(e),addPC:()=>this.editPC(null),importPC:()=>this.importPC(),createEncounter:e=>this.createEncounter(e),startEncounter:(e,t)=>{const a=this.state.encounters.find(e=>e.id===t);this.createCombat(e,a)},startExploration:(e,t)=>{const a=this.state.maps.find(e=>e.id===t);this.startExploration(a,e)},setLevel:(e,t)=>this.setPartyLevel(e,t),showReference:e=>this.showPartyReference(e),deleteParty:e=>this.deleteParty(e),openStatBlock:e=>this.setState({drawer:{type:"statblock",source:e}})});case"library":return this.state.selectedMonsterGroupID?n.a.createElement(js,{monsterGroup:this.state.library.find(e=>e.id===this.state.selectedMonsterGroupID),library:this.state.library,encounters:this.state.encounters,goBack:()=>this.selectMonsterGroup(null),deleteMonsterGroup:e=>this.deleteMonsterGroup(e),openDemographics:e=>this.openDemographics(e),addMonster:e=>this.addMonster(e),importMonster:()=>this.importMonster(),deleteMonster:e=>this.deleteMonster(e),changeValue:(e,t,a)=>this.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a),viewMonster:e=>this.setState({drawer:{type:"statblock",source:e}}),editMonster:e=>this.editMonster(e),cloneMonster:(e,t)=>this.cloneMonster(e,t),moveToGroup:(e,t)=>this.moveToGroup(e,t),createEncounter:e=>this.createEncounterFromMonsters(e)}):n.a.createElement(Fs,{library:this.state.library,encounters:this.state.encounters,hasMonsters:t,addMonsterGroup:()=>this.addMonsterGroup(),importMonsterGroup:()=>this.importMonsterGroup(),openMonsterGroup:e=>this.selectMonsterGroup(e),deleteMonsterGroup:e=>this.deleteMonsterGroup(e),addOpenGameContent:()=>this.addOpenGameContent(),openStatBlock:e=>this.setState({drawer:{type:"statblock",source:e}}),openDemographics:e=>this.openDemographics(e),addMonster:e=>this.addMonster(e),importMonster:()=>this.importMonster(),createEncounter:e=>this.createEncounterFromMonsters(e)});case"encounters":return this.state.selectedCombatID?n.a.createElement(ms,{combat:this.state.combats.find(e=>e.id===this.state.selectedCombatID),parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,options:this.state.options,pauseCombat:()=>this.pauseCombat(),endCombat:(e,t)=>this.endCombat(e,t),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a),changeValue:(e,t,a)=>this.changeValue(e,t,a),makeCurrent:e=>this.makeCurrent(e,!1),makeActive:e=>this.makeActive(e),makeDefeated:e=>this.makeDefeated(e),useTrait:e=>this.useTrait(e),rechargeTrait:e=>this.rechargeTrait(e),removeCombatants:e=>this.removeCombatants(e),addCombatants:()=>this.openAddCombatantModal(),addCompanion:e=>this.addCompanionToEncounter(e),addPC:(e,t)=>this.addPCToEncounter(e,t),addWave:()=>this.openAddWaveModal(),addCondition:e=>{const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.addCondition(e,t.combatants)},editCondition:(e,t)=>{const a=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.editCondition(e,t,a.combatants)},deleteCondition:(e,t)=>this.deleteCondition(e,t),mapAdd:(e,t,a)=>{const s=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.mapAdd(e,t,a,s.combatants,s.map)},mapMove:(e,t,a)=>{const s=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.mapMove(e,t,s.combatants,s.map,a)},mapRemove:e=>{const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.mapRemove(e,t.combatants,t.map)},undoStep:e=>{if(e.path&&e.path.length>0){const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID).map.items.find(t=>t.id===e.id);if(t){const a=e.path[e.path.length-1];t.x=a.x,t.y=a.y,t.z=a.z,e.path.splice(e.path.length-1,1),this.setState({combats:this.state.combats})}}},endTurn:e=>this.endTurn(e),changeHP:e=>this.changeHP(e),toggleTag:(e,t)=>this.toggleTag(e,t),toggleCondition:(e,t)=>this.toggleCondition(e,t),toggleHidden:e=>this.toggleHidden(e),scatterCombatants:(e,t)=>{const a=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.scatterCombatants(e,a.combatants,a.map,t)},rotateMap:()=>{const e=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.rotateMap(e.map)},setFog:e=>{this.state.combats.find(e=>e.id===this.state.selectedCombatID).fog=e,this.setState({combats:this.state.combats})},addOverlay:e=>{const t=this.state.combats.find(e=>e.id===this.state.selectedCombatID);this.addMapItem(e,t.map)},onRollDice:(e,t,a,s,n)=>this.rollDice(e,t,a,s,n),onOpenSession:()=>this.openSession()}):this.state.selectedEncounterID?n.a.createElement(xs,{encounter:this.state.encounters.find(e=>e.id===this.state.selectedEncounterID),parties:this.state.parties,cloneEncounter:(e,t)=>this.cloneEncounter(e,t),deleteEncounter:e=>this.deleteEncounter(e),startEncounter:(e,t)=>{const a=this.state.encounters.find(e=>e.id===t);this.createCombat(e,a)},populateEncounter:e=>{const t=[];this.state.library.forEach(a=>{a.monsters.forEach(a=>{e.slots.some(e=>e.monsterID===a.id)||t.push(a)})}),e.slots.filter(e=>e.roles.length>0).forEach(e=>{const a=t.filter(t=>e.roles.includes(t.role));if(a.length>0){const t=a[b.randomNumber(a.length)];this.state.library.find(e=>e.monsters.includes(t))&&(e.monsterID=t.id)}}),M.sortEncounter(e,e=>this.getMonster(e)),this.setState({encounters:this.state.encounters})},addWave:e=>{const t=E.createEncounterWave();t.name="wave "+(e.waves.length+2),e.waves.push(t),this.setState({encounters:this.state.encounters})},deleteWave:(e,t)=>{const a=e.waves.indexOf(t);e.waves.splice(a,1),this.setState({encounters:this.state.encounters})},moveEncounterSlot:(e,t,a,s,n)=>{if(t.count=Math.max(t.count-a,0),0===t.count)if(s){const e=s.slots.indexOf(t);s.slots.splice(e,1)}else{const a=e.slots.indexOf(t);e.slots.splice(a,1)}const r=(n?n.slots:e.slots).find(e=>e.monsterID===t.monsterID);if(r)r.count+=a;else{const s=E.createEncounterSlot();s.monsterID=t.monsterID,s.roles=[...t.roles],s.count=a,s.faction=t.faction,n?n.slots.push(s):e.slots.push(s)}M.sortEncounter(e,e=>this.getMonster(e)),this.setState({encounters:this.state.encounters})},deleteEncounterSlot:(e,t,a)=>{if(a){const e=a.slots.indexOf(t);a.slots.splice(e,1)}else{const a=e.slots.indexOf(t);e.slots.splice(a,1)}this.setState({encounters:this.state.encounters})},chooseMonster:(e,t,a)=>{t?this.setState({drawer:{type:"encounter-slot-template",encounter:e,slot:t,wave:a,monster:null}}):this.setState({drawer:{type:"encounter-slot",encounter:e,slot:t,wave:a,monster:null}})},showStatblock:e=>this.setState({drawer:{type:"statblock",source:e}}),getMonster:e=>this.getMonster(e),changeValue:(e,t,a)=>this.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a),goBack:()=>this.selectEncounter(null)}):n.a.createElement(vs,{encounters:this.state.encounters,combats:this.state.combats,parties:this.state.parties,hasMonsters:t,createEncounter:()=>this.createEncounter(null),addEncounter:e=>this.addEncounter(e),openEncounter:e=>this.selectEncounter(e),cloneEncounter:(e,t)=>this.cloneEncounter(e,t),deleteEncounter:e=>this.deleteEncounter(e),startEncounter:(e,t)=>{const a=this.state.encounters.find(e=>e.id===t);this.createCombat(e,a)},getMonster:e=>this.getMonster(e),setView:e=>this.setView(e),openStatBlock:e=>this.setState({drawer:{type:"statblock",source:e}}),resumeCombat:e=>this.resumeCombat(e),deleteCombat:e=>this.endCombat(e)});case"maps":return this.state.selectedExplorationID?n.a.createElement(Cs,{exploration:this.state.explorations.find(e=>e.id===this.state.selectedExplorationID),library:this.state.library,options:this.state.options,startCombat:e=>this.createCombat(e.partyID,null,e.map,e.fog,e.lighting,e.combatants),toggleTag:(e,t)=>this.toggleTag(e,t),toggleCondition:(e,t)=>this.toggleCondition(e,t),toggleHidden:e=>this.toggleHidden(e),addCondition:e=>{const t=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.addCondition(e,t.combatants)},editCondition:(e,t)=>{const a=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.editCondition(e,t,a.combatants)},deleteCondition:(e,t)=>this.deleteCondition(e,t),changeValue:(e,t,a)=>this.changeValue(e,t,a),addCompanion:e=>this.addCompanionToExploration(e),mapAdd:(e,t,a)=>{const s=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.mapAdd(e,t,a,s.combatants,s.map)},mapMove:(e,t,a)=>{const s=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.mapMove(e,t,s.combatants,s.map,a)},mapRemove:e=>{const t=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.mapRemove(e,t.combatants,t.map)},scatterCombatants:(e,t)=>{const a=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.scatterCombatants(e,a.combatants,a.map,t)},rotateMap:()=>{const e=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.rotateMap(e.map)},getMonster:e=>this.getMonster(e),useTrait:e=>this.useTrait(e),rechargeTrait:e=>this.rechargeTrait(e),setFog:e=>{this.state.explorations.find(e=>e.id===this.state.selectedExplorationID).fog=e,this.setState({explorations:this.state.explorations})},addOverlay:e=>{const t=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID);this.addMapItem(e,t.map)},onRollDice:(e,t,a,s,n)=>this.rollDice(e,t,a,s,n),onOpenSession:()=>this.openSession(),pauseExploration:()=>this.pauseExploration(),endExploration:e=>this.endExploration(e)}):this.state.selectedMapID?n.a.createElement(Vs,{map:this.state.maps.find(e=>e.id===this.state.selectedMapID),parties:this.state.parties,cloneMap:(e,t)=>this.cloneMap(e,t),rotateMap:e=>this.rotateMap(e),deleteMap:e=>this.deleteMap(e),addMapTile:(e,t)=>this.addMapItem(t,e),selectMapTileImage:(e,t)=>this.selectMapTileImage(e,t),moveMapTile:(e,t,a,s)=>this.moveMapTileOrArea(e,t,a,s),cloneMapTile:(e,t)=>this.cloneMapTile(e,t),rotateMapTile:(e,t)=>this.rotateMapTile(e,t),deleteMapTile:(e,t)=>this.deleteMapTile(e,t),clearMapTiles:e=>this.clearMapTiles(e),bringToFront:(e,t)=>this.bringToFront(e,t),sendToBack:(e,t)=>this.sendToBack(e,t),addMapArea:(e,t)=>this.addMapArea(e,t),moveMapArea:(e,t,a,s)=>this.moveMapTileOrArea(e,t,a,s),deleteMapArea:(e,t)=>this.deleteMapArea(e,t),clearMapAreas:e=>this.clearMapAreas(e),generateRoom:e=>this.generateRoom(e),startEncounter:(e,t)=>{const a=this.state.maps.find(e=>e.id===t);this.createCombat(e,null,a)},startExploration:(e,t)=>{const a=this.state.maps.find(e=>e.id===t);this.startExploration(a,e)},changeValue:(e,t,a)=>this.changeValue(e,t,a),nudgeValue:(e,t,a)=>this.nudgeValue(e,t,a),goBack:()=>this.selectMap(null)}):n.a.createElement(Ps,{maps:this.state.maps,parties:this.state.parties,explorations:this.state.explorations,addMap:()=>this.addMap(),importMap:()=>this.importMap(),generateMap:e=>this.generateMap(e),openMap:e=>this.selectMap(e),cloneMap:(e,t)=>this.cloneMap(e,t),deleteMap:e=>this.deleteMap(e),startEncounter:(e,t)=>{const a=this.state.maps.find(e=>e.id===t);this.createCombat(e,null,a)},startExploration:(e,t)=>{const a=this.state.maps.find(e=>e.id===t);this.startExploration(a,e)},resumeExploration:e=>this.resumeExploration(e),deleteExploration:e=>this.endExploration(e)})}return null}getTabs(){return[{id:"parties",text:"pcs",selected:"parties"===this.state.view,onSelect:()=>this.setView("parties")},{id:"library",text:"monsters",selected:"library"===this.state.view,onSelect:()=>this.setView("library")},{id:"encounters",text:"encounters",selected:"encounters"===this.state.view,onSelect:()=>this.setView("encounters")},{id:"maps",text:"maps",selected:"maps"===this.state.view,onSelect:()=>this.setView("maps")}]}getDrawer(){let e=null,t=null,a=null,s="50%",r=!1;if(this.state.drawer)switch(this.state.drawer.type){case"statblock":e=n.a.createElement(Ut,{source:this.state.drawer.source}),t="statblock",r=!0;break;case"image":e=n.a.createElement("img",{className:"nonselectable-image",src:this.state.drawer.data,alt:"shared"}),t="image",r=!0;break;case"import-party":e=n.a.createElement(Lt,{party:this.state.drawer.party}),t="import party",a=n.a.createElement("button",{onClick:()=>this.acceptImportedParty()},"accept party"),r=!0;break;case"pc":e=n.a.createElement(It,{pc:this.state.drawer.pc,library:this.state.library}),t="pc editor",a=n.a.createElement(p.a,{gutter:20},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.savePC()},"save changes")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.closeDrawer()},"discard changes")));break;case"import-pc":e=n.a.createElement(Rt,{pc:this.state.drawer.pc}),t="import pc",a=n.a.createElement("button",{onClick:()=>this.acceptImportedPC()},"accept pc"),r=!0;break;case"update-pc":e=n.a.createElement(Rt,{pc:this.state.drawer.pc}),t="update pc",a=n.a.createElement("button",{onClick:()=>this.savePC()},"accept pc"),r=!0;break;case"import-group":e=n.a.createElement(At,{group:this.state.drawer.group}),t="import monster group",a=n.a.createElement("button",{onClick:()=>this.acceptImportedGroup()},"accept group"),r=!0;break;case"monster":e=n.a.createElement(Et,{monster:this.state.drawer.monster,library:this.state.library,options:this.state.options}),t="monster editor",a=n.a.createElement(p.a,{gutter:20},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.saveMonster()},"save changes")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.closeDrawer()},"discard changes"))),s="85%";break;case"import-monster":e=n.a.createElement(Pt,{monster:this.state.drawer.monster}),t="import monster",a=n.a.createElement("button",{onClick:()=>this.acceptImportedMonster()},"accept monster"),r=!0;break;case"monster-demographics":e=n.a.createElement(st,{groups:this.state.drawer.group?[this.state.drawer.group]:this.state.library}),t="demographics",r=!0;break;case"random-encounter":e=n.a.createElement(Ft,{parties:this.state.parties,data:this.state.drawer.data,onUpdated:()=>this.forceUpdate()}),t="create a random encounter",a=n.a.createElement("button",{className:"party"===this.state.drawer.data.type&&null===this.state.drawer.data.partyID?"disabled":"",onClick:()=>this.createEncounterFromModal()},"create the encounter"),r=!0;break;case"encounter-slot":e=n.a.createElement(zt,{encounter:this.state.drawer.encounter,wave:this.state.drawer.wave,slot:this.state.drawer.slot,monster:this.state.drawer.monster,library:this.state.library,setMonster:e=>{const t=this.state.drawer;t.monster=e,this.setState({encounters:this.state.encounters,drawer:t})}}),t="choose a monster",a=n.a.createElement(p.a,{gutter:10},n.a.createElement(h.a,{span:12},n.a.createElement("button",{className:this.state.drawer.monster?"":"disabled",onClick:()=>this.addToEncounterSlot(this.state.drawer.encounter,this.state.drawer.wave,this.state.drawer.slot,this.state.drawer.monster,!1)},"add this monster to the encounter")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.closeDrawer()},"close"))),s="75%";break;case"encounter-slot-template":e=n.a.createElement(zt,{encounter:this.state.drawer.encounter,wave:this.state.drawer.wave,slot:this.state.drawer.slot,monster:this.state.drawer.monster,library:this.state.library,setMonster:e=>{const t=this.state.drawer;t.monster=e,this.setState({encounters:this.state.encounters,drawer:t})}}),t="choose a monster",a=n.a.createElement("button",{className:this.state.drawer.monster?"":"disabled",onClick:()=>this.addToEncounterSlot(this.state.drawer.encounter,this.state.drawer.wave,this.state.drawer.slot,this.state.drawer.monster,!0)},"add this monster to the encounter"),s="75%",r=!0;break;case"import-map":e=n.a.createElement(Dt,{map:this.state.drawer.map}),t="import map",a=n.a.createElement(p.a,{gutter:20},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.acceptImportedMap()},"save changes")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.declineImportedMap()},"discard changes"))),s="75%",r=!1;break;case"combat-start":e=n.a.createElement(Ye,{type:"start",combatSetup:this.state.drawer.combatSetup,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,getMonster:e=>this.getMonster(e),notify:()=>this.setState({drawer:this.state.drawer})}),t="start combat",a=n.a.createElement("button",{className:this.state.drawer.combatSetup.party&&this.state.drawer.combatSetup.encounter?"":"disabled",onClick:()=>this.startCombat()},"start combat"),r=!0;break;case"combat-wave":e=n.a.createElement(Ye,{type:"add-wave",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:e=>this.getMonster(e),notify:()=>this.setState({drawer:this.state.drawer})}),t="add a wave",a=n.a.createElement("button",{className:null!==this.state.drawer.combatSetup.waveID?"":"disabled",onClick:()=>this.addWaveToCombat()},"add wave"),r=!0;break;case"combat-add-combatants":e=n.a.createElement(Ye,{type:"add-combatants",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:e=>this.getMonster(e),addMonster:e=>this.addMonsterToAddCombatantsModal(e),notify:()=>this.setState({drawer:this.state.drawer})}),t="add combatants",a=n.a.createElement("button",{className:null!==this.state.drawer.combatSetup.encounter?"":"disabled",onClick:()=>this.addCombatantsToCombat()},"add combatants"),r=!0;break;case"condition-add":e=n.a.createElement(tt,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),t="add a condition",a=n.a.createElement("button",{onClick:()=>this.addConditionFromModal()},"add"),s="75%",r=!0;break;case"condition-edit":e=n.a.createElement(tt,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),t="edit condition",a=n.a.createElement(p.a,{gutter:20},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.editConditionFromModal()},"save changes")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.closeDrawer()},"discard changes"))),s="75%";break;case"select-image":e=n.a.createElement(Mt,{select:e=>{this.changeValue(this.state.drawer.tile,"customBackground",e),this.closeDrawer()}}),t="select image",s="25%"}return{content:e,header:t,footer:a,width:s,closable:r}}render(){try{var e,t;const a=this.getBreadcrumbs(),s=this.getContent(),r=this.getTabs(),i=this.getDrawer();return n.a.createElement("div",{className:"dojo "+this.state.options.theme},n.a.createElement("div",{className:this.state.sidebar.visible?"app with-sidebar":"app"},n.a.createElement(K,null,n.a.createElement(Zt,{breadcrumbs:a,sidebarVisible:this.state.sidebar.visible,onToggleSidebar:()=>this.toggleSidebar()})),n.a.createElement(K,null,n.a.createElement("div",{className:"page-content"},s)),n.a.createElement(K,null,n.a.createElement(Jt,{tabs:r}))),n.a.createElement(K,null,n.a.createElement(ns,{sidebar:this.state.sidebar,user:"dm",parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,combats:this.state.combats,explorations:this.state.explorations,options:this.state.options,currentCombat:null!==(e=this.state.combats.find(e=>e.id===this.state.selectedCombatID))&&void 0!==e?e:null,currentExploration:null!==(t=this.state.explorations.find(e=>e.id===this.state.selectedExplorationID))&&void 0!==t?t:null,onSelectSidebar:e=>this.setSidebar(e),onUpdateSidebar:e=>this.setState({sidebar:e}),selectParty:e=>this.selectPartyByID(e),selectMonsterGroup:e=>this.selectMonsterGroupByID(e),selectEncounter:e=>this.selectEncounterByID(e),selectMap:e=>this.selectMapByID(e),openImage:e=>this.setState({drawer:{type:"image",data:e}}),addAward:(e,t)=>{t.awards.push(e),this.setState({parties:this.state.parties},()=>{B.sendPartyUpdate(),B.prompt("award",{awardee:t.name,awardID:e})})},deleteAward:(e,t)=>{t.awards=t.awards.filter(t=>t!==e),this.setState({parties:this.state.parties},()=>{B.sendPartyUpdate()})},setOption:(e,t)=>{const a=this.state.options;a[e]=t,this.setState({options:a})},getMonster:e=>this.getMonster(e)})),n.a.createElement(K,null,n.a.createElement(m.a,{className:this.state.options.theme,closable:!1,maskClosable:i.closable,width:i.width,visible:null!==i.content,onClose:()=>this.closeDrawer()},n.a.createElement("div",{className:"drawer-header"},n.a.createElement("div",{className:"app-title"},i.header)),n.a.createElement("div",{className:"drawer-content"},i.content),n.a.createElement("div",{className:"drawer-footer"},i.footer))))}catch(a){return console.error(a),n.a.createElement(X,{error:a})}}}var Zs=a(211);class Qs extends n.a.Component{constructor(e){super(e);let t={showMonsterDieRolls:!1,theme:"light",diagonals:"onepointfive"};try{const e=window.localStorage.getItem("data-options");e&&(t=JSON.parse(e),void 0===t.theme&&(t.theme="light"),void 0===t.diagonals&&(t.diagonals="onepointfive"))}catch(s){console.error("Could not parse JSON: ",s)}const a={};[4,6,8,10,12,20,100].forEach(e=>a[e]=0),a[20]=1,this.state={addingToMap:!1,drawer:null,sidebar:{visible:!1,type:"reference",subtype:"skills",dice:a,constant:0,dieRolls:[],handout:null,languageMode:"common",languagePreset:null,selectedLanguages:[],languageOutput:[],surge:"",draws:[],npc:null,selectedPartyID:null,selectedMonsterID:null},options:t}}componentDidMount(){g.a.bind("up",e=>{e.preventDefault(),this.moveToken("N")}),g.a.bind("down",e=>{e.preventDefault(),this.moveToken("S")}),g.a.bind("left",e=>{e.preventDefault(),this.moveToken("W")}),g.a.bind("right",e=>{e.preventDefault(),this.moveToken("E")}),j.onStateChanged=()=>this.forceUpdate(),j.onDataChanged=()=>{G.data.shared.images.forEach(e=>S.saveImage(e.id,e.name,e.data)),this.forceUpdate()},G.onPrompt=(e,t)=>{switch(e){case"initiative":if("combat"===G.data.shared.type){if(""===G.getCharacterID(G.getID()))return;const e=b.guid();d.a.open({key:b.guid(),message:n.a.createElement(en,{type:"initiative",notificationKey:e}),closeIcon:n.a.createElement(c.a,null),duration:null})}break;case"award":const e=t.awardee||"someone",a=t.awardID,s=Gt.getAward(a);s&&d.a.open({key:b.guid(),message:n.a.createElement("div",null,n.a.createElement("div",null,"awarded to ",n.a.createElement("b",null,e),":"),n.a.createElement(jt,{award:s})),closeIcon:n.a.createElement(c.a,null),duration:null})}},G.onNewMessage=e=>{this.state.sidebar.visible&&"session-chat"===this.state.sidebar.type||d.a.open({key:e.id,message:n.a.createElement(Ga,{user:"player",message:e,openImage:e=>this.setState({drawer:{type:"image",data:e}})}),closeIcon:n.a.createElement(c.a,null),duration:5})}}componentWillUnmount(){g.a.unbind("up"),g.a.unbind("down"),g.a.unbind("left"),g.a.unbind("right"),j.onStateChanged=null,j.onDataChanged=null,G.onPrompt=null,G.onNewMessage=null,j.disconnect()}setAddingToMap(e){this.setState({addingToMap:e})}setSidebar(e){let t="";switch(e){case"reference":t="skills";break;case"about":t="dojo"}const a=this.state.sidebar;a.visible=!0,a.type=e,a.subtype=t,this.setState({sidebar:a})}toggleSidebar(){const e=this.state.sidebar;e.visible=!e.visible,this.setState({sidebar:e})}closeDrawer(){this.setState({drawer:null})}editPC(){if(G.data.party){const e=G.getCharacterID(G.getID()),t=G.data.party.pcs.find(t=>t.id===e);if(t){const e=JSON.parse(JSON.stringify(t));this.setState({drawer:{type:"pc",pc:e}})}}}newPC(){const e=E.createPC();e.player=G.getName(G.getID()),this.setState({drawer:{type:"pc",pc:e}})}savePC(){j.sendCharacter(this.state.drawer.pc),this.setState({drawer:null})}addCondition(e,t){const a=E.createCondition();a.name="blinded",this.setState({drawer:{type:"condition-add",condition:a,combatants:e,allCombatants:t}})}addConditionFromModal(){this.state.drawer.combatants.forEach(e=>{const t=JSON.parse(JSON.stringify(this.state.drawer.condition));t.id=b.guid(),e.conditions.push(t),b.sort(e.conditions,[{field:"name",dir:"asc"}])}),this.setState({drawer:null},()=>{j.sendSharedUpdate(),this.forceUpdate()})}editCondition(e,t,a){this.setState({drawer:{type:"condition-edit",condition:t,combatants:[e],allCombatants:a}})}editConditionFromModal(){this.state.drawer.combatants.forEach(e=>{const t=e.conditions.find(e=>e.id===this.state.drawer.condition.id);if(t){const a=e.conditions.indexOf(t);e.conditions[a]=this.state.drawer.condition,b.sort(e.conditions,[{field:"name",dir:"asc"}])}}),this.setState({drawer:null},()=>{j.sendSharedUpdate(),this.forceUpdate()})}moveToken(e){let t=[],a=null;if("combat"===G.data.shared.type){const e=G.data.shared.data;t=e.combatants,a=e.map}else if("exploration"===G.data.shared.type){const e=G.data.shared.data;t=e.combatants,a=e.map}if(a){const s=[G.getCharacterID(G.getID())];V.moveCombatants(s,e,t,a,1),j.sendSharedUpdate(),this.forceUpdate()}}getNothingSection(){let e=null;if(""===G.getCharacterID(G.getID())&&null!==G.data.party){const t=[];G.data.party.pcs.filter(e=>e.active).forEach(e=>{G.data.people.some(t=>t.characterID===e.id)||t.push(n.a.createElement("button",{key:e.id,onClick:()=>j.sendUpdate("",e.id)},n.a.createElement("div",{className:"section"},n.a.createElement($,{source:e,inline:!0}),e.name),n.a.createElement("div",{className:"section small"},"level "+e.level+" "+e.race+" "+e.classes)))}),e=n.a.createElement("div",null,n.a.createElement("hr",null),n.a.createElement("p",null,"in the meantime, please select your character:"),t,n.a.createElement("p",null,"or, create a new character ",n.a.createElement("button",{className:"link",onClick:()=>this.newPC()},"here")))}return n.a.createElement(p.a,{align:"middle",justify:"center",className:"scrollable"},n.a.createElement(Le,null,n.a.createElement("p",null,"the dm is not currently sharing anything with you; when they do, you'll see it here"),e))}getCombatSection(e,t){var a,s;const r=G.getCharacterID(G.getID()),i=null!==(a=t.selectedAreaID)&&void 0!==a?a:"",o=null!==(s=t.highlightedSquare)&&void 0!==s?s:null;let l=null;const c=e.combatants.find(e=>e.current);c&&c.id===r&&(l=n.a.createElement(Le,null,n.a.createElement("p",null,"you are the current initiative holder")));const d=n.a.createElement(ps,{combat:e,playerView:!0,selectedText:"you",showDefeated:!1,help:null,selectedItemIDs:[r],toggleItemSelection:(e,t)=>null});let p=null;return e.map&&(p=n.a.createElement("div",{className:"scrollable horizontal-only"},n.a.createElement(qe,{map:e.map,mode:"combat-player",options:this.state.options,viewport:V.getViewport(e.map,i),showGrid:this.state.addingToMap,combatants:e.combatants,selectedItemIDs:[r],fog:e.fog,focussedSquare:o,itemSelected:(e,t)=>null,itemRemove:e=>null,gridSquareClicked:(t,a)=>{if(this.state.addingToMap){M.getMountsAndRiders([r],e.combatants).forEach(s=>V.add(e.map,s,t,a)),this.setAddingToMap(!1),j.sendSharedUpdate(),this.forceUpdate()}}}))),n.a.createElement("div",{className:"scrollable"},l,n.a.createElement(Tt,{heading:"encounter map",content:[p],columns:1,showToggle:!0}),n.a.createElement(Tt,{heading:"initiative order",content:[d],columns:1,showToggle:!0}))}getExplorationSection(e,t){var a,s;const r=G.getCharacterID(G.getID()),i=null!==(a=t.selectedAreaID)&&void 0!==a?a:"",o=null!==(s=t.highlightedSquare)&&void 0!==s?s:null;return n.a.createElement("div",{className:"scrollable both-ways"},n.a.createElement(qe,{map:e.map,mode:"combat-player",options:this.state.options,viewport:V.getViewport(e.map,i),showGrid:this.state.addingToMap,combatants:e.combatants,selectedItemIDs:[r],fog:e.fog,focussedSquare:o,itemSelected:(e,t)=>null,gridSquareClicked:(t,a)=>{if(this.state.addingToMap){M.getMountsAndRiders([r],e.combatants).forEach(s=>V.add(e.map,s,t,a)),this.setAddingToMap(!1),j.sendSharedUpdate(),this.forceUpdate()}}}))}getHandoutSection(e){switch(e.type){case"image":return n.a.createElement("img",{className:"nonselectable-image borderless",src:e.src,alt:"handout"});case"audio":return n.a.createElement("audio",{controls:!0},n.a.createElement("source",{src:e.src}));case"video":return n.a.createElement("video",{controls:!0},n.a.createElement("source",{src:e.src}));case"pdf":return n.a.createElement("div",{className:"scrollable"},n.a.createElement(Xa,{src:e.src}))}return null}getMonsterSection(e){return n.a.createElement("div",{className:"scrollable"},n.a.createElement(gt,{monster:e}))}getContent(){switch(j.getState()){case"not connected":return n.a.createElement(p.a,{align:"middle",justify:"center",className:"full-height"},n.a.createElement($s,{dmcode:this.props.dmcode}));case"connecting":return n.a.createElement(p.a,{align:"middle",justify:"center",className:"full-height"},n.a.createElement("div",{className:"connection-panel"},n.a.createElement(Le,null,n.a.createElement("p",null,"connecting to ",n.a.createElement("span",{className:"app-name"},"dojo"),"..."))));case"connected":let e=null;if(""===G.getCharacterID(G.getID())||"nothing"===G.data.shared.type)e=this.getNothingSection();else if("combat"===G.data.shared.type){const t=G.data.shared.data,a=G.data.shared.additional;e=this.getCombatSection(t,a)}else if("exploration"===G.data.shared.type){const t=G.data.shared.data,a=G.data.shared.additional;e=this.getExplorationSection(t,a)}else if("handout"===G.data.shared.type){const t=G.data.shared.data;e=this.getHandoutSection(t)}else if("monster"===G.data.shared.type){const t=G.data.shared.data;e=this.getMonsterSection(t)}return n.a.createElement("div",{className:"full-height"},e)}}getDrawer(){let e=null,t=null,a=null,s="50%",r=!1;if(this.state.drawer)switch(this.state.drawer.type){case"statblock":e=n.a.createElement(Ut,{source:this.state.drawer.source}),t="statblock",r=!0;break;case"image":e=n.a.createElement("img",{className:"nonselectable-image",src:this.state.drawer.data,alt:"shared"}),t="image",r=!0;break;case"pc":e=n.a.createElement(It,{pc:this.state.drawer.pc,library:[]}),t="pc editor",a=n.a.createElement(p.a,{gutter:20},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.savePC()},"save changes")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.closeDrawer()},"discard changes")));break;case"condition-add":e=n.a.createElement(tt,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),t="add a condition",a=n.a.createElement("button",{onClick:()=>this.addConditionFromModal()},"add"),s="75%",r=!0;break;case"condition-edit":e=n.a.createElement(tt,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),t="edit condition",a=n.a.createElement(p.a,{gutter:20},n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.editConditionFromModal()},"save changes")),n.a.createElement(h.a,{span:12},n.a.createElement("button",{onClick:()=>this.closeDrawer()},"discard changes"))),s="75%"}return{content:e,header:t,footer:a,width:s,closable:r}}getShortcuts(){const e=[];return""!==G.getCharacterID(G.getID())&&(e.push(n.a.createElement(Zs.a,{key:"stats",title:"update your stats",onClick:()=>{this.editPC()}})),G.data.options.allowChat&&e.push(n.a.createElement(na.a,{key:"chat",title:"open chat",onClick:()=>{const e=this.state.sidebar;e.type="session-chat",e.subtype="",e.visible=!0,this.setState({sidebar:e})}})),G.data.options.allowControls&&("combat"!==G.data.shared.type&&"exploration"!==G.data.shared.type||e.push(n.a.createElement(ra.a,{key:"controls",title:"open character controls",onClick:()=>{const e=this.state.sidebar;e.type="session-controls",e.subtype="",e.visible=!0,this.setState({sidebar:e})}})))),e}render(){try{const e=this.getShortcuts(),t=this.getContent(),a=this.getDrawer();return n.a.createElement("div",{className:"dojo "+this.state.options.theme},n.a.createElement("div",{className:this.state.sidebar.visible?"app with-sidebar":"app"},n.a.createElement(K,null,n.a.createElement(Zt,{breadcrumbs:[{id:"home",text:"dojo - player",onClick:()=>null}],sidebarVisible:this.state.sidebar.visible,onToggleSidebar:()=>this.toggleSidebar()})),n.a.createElement(K,null,n.a.createElement("div",{className:"page-content"},t)),n.a.createElement(K,null,n.a.createElement(Jt,{shortcuts:e}))),n.a.createElement(K,null,n.a.createElement(ns,{sidebar:this.state.sidebar,user:"player",options:this.state.options,onSelectSidebar:e=>this.setSidebar(e),onUpdateSidebar:e=>this.setState({sidebar:e}),addCondition:(e,t)=>this.addCondition(e,t),editCondition:(e,t,a)=>this.editCondition(e,t,a),toggleAddingToMap:()=>this.setAddingToMap(!this.state.addingToMap),onUpdated:()=>this.forceUpdate(),setOption:(e,t)=>{const a=this.state.options;a[e]=t,this.setState({options:a})}})),n.a.createElement(K,null,n.a.createElement(m.a,{className:this.state.options.theme,closable:!1,maskClosable:a.closable,width:a.width,visible:null!==a.content,onClose:()=>this.closeDrawer()},n.a.createElement("div",{className:"drawer-header"},n.a.createElement("div",{className:"app-title"},a.header)),n.a.createElement("div",{className:"drawer-content"},a.content),n.a.createElement("div",{className:"drawer-footer"},a.footer))))}catch(e){return console.error(e),n.a.createElement(X,{error:e})}}}class $s extends n.a.Component{constructor(e){super(e);const t=window.localStorage.getItem("connect-as-player")||"";this.state={name:t}}setName(e){this.setState({name:e},()=>{window.localStorage.setItem("connect-as-player",e)})}canConnect(){return""!==this.state.name}connect(){this.canConnect()&&j.connect(this.props.dmcode,this.state.name)}render(){return""===this.props.dmcode?n.a.createElement(Le,null,n.a.createElement("p",null,"this url isn't a valid dojo player url - there's no 6-letter dm code at the end")):n.a.createElement("div",{className:"connection-panel"},n.a.createElement("div",{className:"heading"},"connect"),n.a.createElement(_,{placeholder:"your name",debounce:!1,text:this.state.name,onChange:e=>this.setName(e)}),n.a.createElement("button",{className:this.canConnect()?"":"disabled",onClick:()=>this.connect()},"connect"))}}class en extends n.a.Component{constructor(e){super(e);const t={};[4,6,8,10,12,20,100].forEach(e=>t[e]=0),t[20]=1,this.state={mode:"roll",dice:t,constant:0,result:null,entry:10}}setMode(e){this.setState({mode:e})}setDie(e,t){const a=this.state.dice;a[e]=t,this.setState({dice:a})}setConstant(e){this.setState({constant:e})}resetDice(){const e=this.state.dice;[4,6,8,10,12,20,100].forEach(t=>e[t]=0),this.setState({dice:e,constant:0})}setEntry(e){this.setState({entry:e})}roll(e){const t=f.rollDice(this.state.dice,this.state.constant,e);this.setState({result:t})}sendRoll(){let e=this.state.entry;"roll"===this.state.mode&&null!==this.state.result&&(e=this.state.result.constant,this.state.result.rolls.forEach(t=>{e+=t.value})),j.sendRollResult(this.props.type,e),d.a.close(this.props.notificationKey)}render(){let e=null;switch(this.state.mode){case"roll":e=null===this.state.result?n.a.createElement("div",null,n.a.createElement(Oa,{dice:this.state.dice,constant:this.state.constant,setDie:(e,t)=>this.setDie(e,t),setConstant:e=>this.setConstant(e),resetDice:()=>this.resetDice(),rollDice:e=>this.roll(e)})):n.a.createElement("div",null,n.a.createElement(Wt,{result:this.state.result}),n.a.createElement("button",{onClick:()=>this.sendRoll()},"send"));break;case"enter":e=n.a.createElement("div",null,n.a.createElement(de,{value:this.state.entry,label:this.props.type,onNudgeValue:e=>this.setEntry(this.state.entry+e)}),n.a.createElement("button",{onClick:()=>this.sendRoll()},"send"))}return n.a.createElement("div",null,n.a.createElement("div",{className:"heading"},this.props.type),n.a.createElement(pe,{options:["roll","enter"].map(e=>({id:e,text:e})),selectedID:this.state.mode,onSelect:e=>this.setMode(e)}),n.a.createElement("hr",null),e)}}class tn extends n.a.Component{render(){return n.a.createElement(o.a,null,n.a.createElement(l.c,null,n.a.createElement(l.a,{path:"/player/:dmcode",render:({match:e})=>n.a.createElement(Qs,{dmcode:e.params.dmcode})}),n.a.createElement(l.a,{path:"/player",render:()=>n.a.createElement(Qs,{dmcode:""})}),n.a.createElement(l.a,{render:()=>n.a.createElement(Xs,null)})))}}i.a.render(n.a.createElement(tn,null),document.getElementById("root"))}},[[115,1,2]]]);