{"version":3,"sources":["resources/icons/down-arrow-black.svg","resources/icons/ellipsis.svg","resources/icons/x.svg","resources/images/no-portrait.png","resources/icons/warning.svg","resources/icons/down-arrow.svg","resources/icons/settings.svg","utils/utils.ts","utils/factory.ts","models/monster-group.ts","utils/frankenstein.ts","utils/mercator.ts","utils/napoleon.ts","models/combat.ts","components/controls/checkbox.tsx","components/controls/confirm-button.tsx","components/controls/control-row.tsx","components/controls/dropdown.tsx","components/controls/expander.tsx","components/controls/radial.tsx","components/controls/selector.tsx","components/controls/spin.tsx","components/panels/ability-score-panel.tsx","components/panels/conditions-panel.tsx","components/panels/portrait-panel.tsx","components/controls/menu.tsx","components/panels/note.tsx","components/panels/traits-panel.tsx","components/cards/info-card.tsx","components/cards/monster-card.tsx","components/cards/pc-card.tsx","components/panels/hit-point-gauge.tsx","components/panels/map-panel.tsx","components/list-items/combat-list-item.tsx","components/panels/card-group.tsx","components/portals/popout.tsx","components/screens/combat-manager-screen.tsx","components/list-items/encounter-list-item.tsx","components/panels/difficulty-chart-panel.tsx","components/panels/filter-panel.tsx","components/screens/encounter-builder-screen.tsx","components/panels/readaloud.tsx","components/screens/home-screen.tsx","components/cards/map-card.tsx","components/list-items/map-folio-list-item.tsx","components/screens/map-folios-screen.tsx","components/list-items/monster-group-list-item.tsx","components/screens/monster-library-screen.tsx","components/list-items/party-list-item.tsx","components/screens/parties-screen.tsx","components/modals/add-combatants-modal.tsx","components/modals/combat-start-modal.tsx","models/condition.ts","components/controls/radio-group.tsx","components/modals/condition-modal.tsx","components/modals/demographics-sidebar.tsx","models/map-folio.ts","components/cards/map-tile-card.tsx","components/modals/map-editor-modal.tsx","components/modals/monster-editor-modal.tsx","components/modals/pc-editor-modal.tsx","components/tools/about/about-module.tsx","components/tools/about/ogl-module.tsx","components/tools/about/options-module.tsx","components/tools/about-tool.tsx","components/tools/dm/die-roller-module.tsx","utils/shakespeare.ts","utils/ustinov.ts","components/tools/dm/language-module.tsx","components/tools/dm/name-module.tsx","components/tools/dm-tool.tsx","components/controls/loading-wrapper.tsx","components/tools/reference/actions-module.tsx","components/tools/reference/conditions-module.tsx","components/tools/reference/skills-module.tsx","components/tools/reference-tool.tsx","components/modals/tools-sidebar.tsx","components/panels/navbar.tsx","components/panels/titlebar.tsx","components/dojo.tsx","index.js"],"names":["module","exports","Utils","monster","library","group","this","monsterIdToGroup","id","grp","find","g","monsters","includes","filter","text","result","toLowerCase","split","forEach","token","indexOf","s4","Math","floor","random","toString","substring","collection","sorts","length","field","dir","fn","a","b","undefined","sort","order","score","mod","modifierValue","str","sides","size","cr","parseInt","push","ac","hpMin","hpMax","attack","dmgMin","dmgMax","save","count","level","difficulty","type","plural","value","delta","sizes","index","condition","name","combat","duration","saveDuration","saveType","toUpperCase","saves","saveDC","combatantDuration","point","c","combatants","cmb","combatantID","displayName","roundsDuration","rounds","encounter","monsterNames","slots","slot","names","monsterName","n","tag","Factory","guid","pcs","active","player","race","classes","languages","passiveInsight","passiveInvestigation","passivePerception","portrait","url","companions","category","alignment","challenge","abilityScores","dex","con","int","wis","cha","hpTemp","hitDice","damage","resist","vulnerable","immune","savingThrows","speed","skills","senses","equipment","traits","conditionImmunities","usage","uses","waves","monsterGroupName","challengeMin","challengeMax","maps","items","x","y","width","height","terrain","customBackground","style","partyID","encounterID","waveID","folioID","mapID","encounterInitMode","map","round","notifications","issues","timestamp","data","combatant","SIZE_TYPES","CATEGORY_TYPES","TRAIT_TYPES","Frankenstein","target","newValue","source","tokens","nudgeChallenge","nudgeSize","changeValue","hpPerDie","hitDieType","hp","trait","createMonster","subtype","parseChallenge","challenge_rating","armor_class","hit_points","hit_dice","strength","dexterity","constitution","intelligence","wisdom","charisma","damage_resistances","damage_vulnerabilities","damage_immunities","condition_immunities","skill","special_abilities","rawTrait","buildTrait","actions","reactions","legendary_actions","openBracket","closeBracket","desc","replace","finalType","copy","JSON","parse","stringify","createTrait","traitType","splice","t1","t2","index1","index2","setRandomValue","m","t","distinct","current","d","addedIDs","copyTrait","findIndex","avg","Mercator","item","dimensions","mapDimensions","candidateSquares","minX","maxX","minY","maxY","canAddMonsterHere","square","miniSize","displaySize","createMapItem","tiles","tile","min","max","coveredSquares","right","bottom","x1","y1","occupants","itemsAt","canOccupy","every","left","top","newX","newY","newWidth","newHeight","Napoleon","concat","wave","getMonster","xp","experience","experienceFactor","summary","groups","getAdjustedEncounterXP","groupName","dieRoll","candidates","matchMonster","createEncounterSlot","s","createEncounterWave","match","COMBAT_TAGS","Checkbox","e","stopPropagation","props","checked","display","disabled","toggle","className","onClick","click","label","ex","console","error","React","Component","defaultProps","ConfirmButton","state","pressed","setState","callback","content","src","warning","alt","details","perform","ControlRow","controls","Dropdown","open","optionID","select","clear","options","option","selectedID","o","key","title","placeholder","ellipsis","selected","toggleOpen","DropdownOption","Expander","expanded","arrow","Radial","dir2","direction","showOut","showIn","showDiag","Selector","tabs","itemsPerRow","rowCount","ceil","rowContents","rowIndex","rowSections","row","SelectorOption","Spin","nudgeValue","preventDefault","minusBtns","plusBtns","factors","factor","onTouchEnd","touchEnd","reverse","AbilityScorePanel","showAbilityScores","edit","toggleAbilityScores","modifier","ConditionsPanel","conditions","nudgeConditionValue","editCondition","removeCondition","conditionID","addCondition","ConditionPanel","conditionDurationText","description","conditionText","PortraitPanel","files","reader","FileReader","onload","progress","setValue","readAsDataURL","none","document","getElementById","accept","onChange","onFileSelected","getEditor","getDisplay","Menu","Note","white","showdown","Showdown","Converter","TraitsPanel","prevTrait","nextTrait","mode","action","removeTrait","swapTraits","traitsByType","showInfo","info","list","createTraitPanel","addTrait","createSection","TraitPanel","maxUses","heading","used","startsWith","found","markdown","dangerouslySetInnerHTML","__html","makeHtml","event","InfoCard","MonsterCard","showDetails","cloneName","combatMode","damageOrHealing","changeHP","temp","val","sizeAndType","align","some","die","conMod","conModStr","combatModes","setCombatMode","pending","defeated","endTurn","makeDefeated","makeCurrent","makeActive","showOnMap","tags","toggleTag","nudgeDamage","heal","setDamage","mapMove","auraDetails","aura","radius","color","mapRemove","mapAdd","removeCombatant","editMonster","setCloneName","cloneMonster","groupOptions","moveToGroup","removeMonster","removeEncounterSlot","canAdd","monsterIsInWave","addEncounterSlot","selectMonster","deselectMonster","getCombatControls","stats","slotSection","getHP","imageStyle","toggleDetails","PCCard","editPC","removePC","companion","href","rel","HitPointGauge","hpCurrent","hpBloodied","hpWidth","hpTempBar","hpTempWidth","MapPanel","zoom","border","i","mi","sizeInSquares","dim","offsetX","offsetY","borderRadius","backgroundSize","getMapDimensions","grid","gridStyle","getStyle","setSelectedItemID","tileStyle","selectable","selectedItemID","auras","auraStyle","backgroundColor","mt","tokenStyle","simple","showGauge","showHidden","dragOverlay","showOverlay","yOver","xOver","overlayStyle","overlay","posX","posY","gridSquareClicked","mapHeight","GridSquare","onDoubleClick","doubleClick","MapTile","MapToken","hpGauge","altitudeBadge","conditionsBadge","altitude","CombatListItem","setSelection","CardGroup","showCards","hidden","closeBtn","close","showToggle","toggleCards","cards","Popout","externalWindow","containerElement","window","createElement","body","appendChild","Array","from","styleSheets","stylesheet","css","newStyleElement","head","cssRules","rule","createTextNode","cssText","addEventListener","closeWindow","ReactDOM","createPortal","children","CombatManagerScreen","selectedTokenID","addingToMapID","mapSize","playerView","showControls","setPlayerViewOpen","show","init","minimal","setSelectedTokenID","selection","defeatCombatant","setAddingToMapID","createCard","pendingHelp","activeHelp","notificationSection","notification","mapSection","addCombatantToMap","toolsSection","scatterCombatants","rotateMap","nudgeMapSize","setPlayerViewShowControls","nudgePlayerViewMapSize","special","legendary","lair","selectedCombatant","getPlayerView","listItems","combats","resumeEncounter","createCombat","HelpCard","NotificationPanel","success","PendingCombatantRow","getInformationText","PCRow","cls","notes","getTagDescription","join","MonsterRow","gauge","dmInfo","EncounterListItem","DifficultyChartPanel","selectedPartyID","party","xpThresholds","diffSection","monsterCount","getMonsterCount","monsterXP","getEncounterXP","adjustedXP","basicData","parties","p","xpEasy","xpMedium","xpHard","xpDeadly","pc","pcExperience","adjustedDifficulty","small","getLeft","getRight","partySelection","partyOptions","selectParty","FilterPanel","sizeOptions","catOptions","cat","resetFilter","getFilterDescription","EncounterBuilderScreen","createMonsterFilter","changeFilterValue","libraryCards","enc","encounterName","leftColumn","monsterFilter","addWave","removeWave","clearEncounter","removeEncounter","buildEncounter","nudgeFilterValue","selectEncounter","encounters","showEncounter","addEncounter","watermark","encounterCards","getMonsterCards","card","w","getLibrarySection","EncounterInfo","randomEncounterXP","randomEncounterStep","setRandomEncounterXP","setRandomEncounterStep","Number","Readaloud","HomeScreen","addOpenGameContent","MapCard","editMap","removeMap","MapFolioListItem","matchFolio","mapFolio","MapFoliosScreen","folio","addMap","removeMapFolio","selectMapFolio","mapFolios","f","showMapFolio","addMapFolio","folioCards","MapFolioInfo","MonsterGroupListItem","matchGroup","MonsterLibraryScreen","addMonster","sortMonsters","removeMonsterGroup","selectMonsterGroup","showMonsterGroup","addMonsterGroup","groupID","MonsterInfo","PartyListItem","matchParty","PartiesScreen","addPC","sortPCs","removeParty","showParty","addParty","activeCards","inactiveCards","activePCs","activePC","inactivePC","PartyInfo","insightSummary","investigationSummary","perceptionSummary","reduce","array","localeCompare","insight","invest","percep","getSummary","AddCombatantsModal","combatantSlots","getMonsterGroup","currentIDs","allCombatants","selectedCombatants","nudgeMonsterCount","CombatStartModal","combatSetup","notify","getMonsterNames","slotID","partyContent","selectedParty","pcSections","setParty","encounterOptions","encounterContent","selectedEncounter","monsterSections","waveMonsters","setEncounter","folios","folioOptions","selectMapSection","thumbnailSection","mapOptions","setMapID","setFolioID","waveOptions","waveContent","selectedWave","setWave","slotsContainer","slotNames","inputs","changeName","setEncounterInitMode","leftSection","rightSection","getPartySection","getEncounterSection","getMapSection","getDifficultySection","getMonsterSection","getWaveSection","margin","MonsterName","CONDITION_TYPES","RadioGroup","itemID","RadioGroupItem","ConditionModal","conditionName","durationType","createConditionDurationSaves","createConditionDurationCombatant","createConditionDurationRounds","object","saveOptions","pointOptions","combatantOptions","durations","setCondition","setDuration","DemographicsSidebar","chart","demographics","allMonsters","buckets","maxBucketSize","bucket","bars","set","selectChart","TERRAIN_TYPES","MapTileCard","terrainOptions","styleOptions","customSection","readerEvent","moveMapItem","resizeMapItem","cloneMapItem","removeMapItem","MapEditorModal","selectedTileID","addingTile","smallMapItem","bigMapItem","tools","mapItem","toggleAddingTile","clearMap","setSelectedTileID","addMapTile","MonsterEditorModal","page","showFilter","helpSection","sidebar","similarFilter","scratchpadFilter","scratchpadList","sections","getHelpOptionsForPage","section","spliceMonsters","addRandomTrait","getValueSection","getActionsSection","dataType","values","v","valueSections","rows","monsterCards","showSidebar","getMonsters","changeTrait","help","selector","setHelpSection","getHelpSection","sidebarContent","toggleMatch","searchResults","resultsRows","addToScratchpadList","removeSection","deleteRows","removeFromScratchpadList","transition","setPage","PCEditorModal","createCompanion","comp","removeCompanion","addCompanion","AboutModule","pkg","version","OGLModule","OptionsModule","resetAll","AboutTool","view","setView","DieRollerModule","dice","rolls","roll","optionsSection","toggleOption","rollsSection","resultSection","setDice","nudgeCount","Shakespeare","sources","model","maxLength","line","addLineToModel","String","fromCharCode","prev","substr","char","freq","requiredResults","lines","failures","extractLine","l","fit","repeat","ch","mc","maxCount","sum","Ustinov","speechSynthesis","cancel","utterance","SpeechSynthesisUtterance","chooseVoice","voice","rate","randomValue","pitch","speak","getVoices","voices","langCodes","lang","getLanguageCode","default","Promise","resolve","onvoiceschanged","language","LanguageModule","output","fetch","response","presetName","preset","getPresets","addLanguage","getLanguages","Object","keys","initModel","generate","presetOptions","selectedPreset","selectedLanguages","isSelected","removeLanguage","allowGenerate","allowReset","usePreset","reset","GeneratedText","navigator","clipboard","writeText","say","NameModule","male","female","surname","input","DMTool","LoadingWrapper","loaded","setOption","ActionsModule","fetchData","ConditionsModule","SkillsModule","ReferenceTool","ToolsSidebar","Navbar","partiesStyle","libraryStyle","encounterStyle","mapStyle","combatStyle","encountersEnabled","combatEnabled","blur","Titlebar","openHome","cog","openTools","Dojo","modal","selectedMonsterGroupID","selectedEncounterID","selectedMapFolioID","selectedCombatID","json","localStorage","getItem","setItem","createParty","createPC","original","createMonsterGroup","sourceGroup","clone","then","createFromJSON","createEncounter","sortEncounterSlots","slotContainer","aName","bName","createMapFolio","createMap","setup","createCombatSetup","partyName","addPCToCombat","groupInitRoll","addMonsterToCombat","sortCombatants","initiative","initMode","Date","toLocaleString","newRound","actor","groupRoll","singleRoll","issue","saveNotification","createNotification","endNotification","createCondition","conditionIndex","obj","openDemographics","allowWave","addToEncounter","openWaveModal","pauseCombat","endCombat","addWaveToEncounter","pausedCombat","resumeCombat","closeNotification","modalSidebar","modalTitle","modalContent","modalAllowScroll","modalButtons","closeModal","savePC","toggleShowSidebar","saveMonster","saveMap","startCombat","addWaveToCombat","addCombatantsFromModal","addConditionFromModal","editConditionFromModal","getContent","getActions","getModal","openToolsSidebar","render"],"mappings":"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","file":"static/js/main.c056113e.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/down-arrow-black.a2fc7a1f.svg\";","module.exports = __webpack_public_path__ + \"static/media/ellipsis.9650a20f.svg\";","module.exports = __webpack_public_path__ + \"static/media/x.7645a5b9.svg\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAADhCAMAAABFoniZAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAJlQTFRF/////v7+/f399PT06enp4eHh3t7e3d3d8/Pz0dHRzc3NzMzM/Pz85+fn4+Pjzs7O6Ojo8fHx3Nzc0NDQ1tbW7e3t9fX12tra7u7u2NjY9vb2+Pj45ubm09PTz8/P29vb9/f34uLi0tLS5eXl+fn57+/v8vLy7Ozs1NTU8PDw1dXV5OTk6urq+vr619fX2dnZ+/v739/f4ODgwOjgmwAAAAFiS0dEAIgFHUgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAAP8SURBVHja7d1tV6JAGIBhB6lGxzIDx8qyF61VN23r//+4/dBCGiCkCzQP9/Wxs5t77jMPBwZWWi0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMqkvIopV0t5bf/o+KRSx0d+23NxUemTTtdUrts50c4tr95px9Skc9pzrNVZ39Smf+ZULXVeYytj+ucuTeKgY2rVGTg0hBemZhfuDKIO6o4VaGdincbnDP2gUvGRsnvqzOH9OPo3h0NbqWEYffKxK4d4bxStq8uqP/oyWlsjV07ke1fRkeO66o++jo6WVz1iEYtYxCIWsX5oLNUbt7Vuj3vEyovl2ZvRbTCZBLd359eKWLti3T88xtdB3dvpjFiZsdRTuL0BfPWsiJUeS/1K7HHNF4pYqbEWKfuBc02stFj3y7Rtp6sZsZKxvKPU22LdG0WsRKx2xqb8fEysRKzfWfdEX4j1NVb8k4QTj1hfYt0/ZsVaror+1pnXkFh6khXrsei1tl5PvWbEWmTeoA7aBVstTX/aI1ahVqExZpK/thjDVkt/nNL2c2txgI9amfxJ5NRBf25X5E1i409K9eZlZc4kNv1yR29fgu+exIZfSOvwy9/ZOYlCtmjCtFivq2+uq7xJlLL597jP5p9O2wbbMYlStpWHiVrzgfruDOZNopgbFoP11nGr+7rfuto5iXJuhY2/eSsss1X2JEq8yTovcpM1YwZ3TqKsZx28mdXaroqcty93P+ueWquhD4bktMqYxGbG2jmD2ZPYyFi56ypjEpsYq1CrtElsYKwCM5gxic2LVXBdpU1i42J9o1ViEuXG+qMOmsG0SRQby45878B1lZhEqbHs2gS+OrjV9iQKjWXXxpjgRR00g4lJlBnLflQJtidxj3W1PYkiY9l19Ec2J3HPVsZMngXHilttTeJeM/ixtJ7kxrKbVeJJ3HtdiY61sa42JvGAVoJjfWn1bxL3n0HJsWyySuB7h6wrubES68oYY4KHg1pJjZXaypgDvzxKZiwbmjKIjJWxroiVEqusVhJjlTSDImOVtq4ExiqxlbhY5c2gvFhlritpscptJSvWfbmtZMVa9IlVONYTsYhFLGIRi1jEIhaxiEUsYsmM9bycl2op6Skab1Yy0c9nlYVYxCIWsYhVTSxb9Udb52J5d/E3zVT8jhL1Ej27dOfMm/ve4m/Hmg4rNY2/O+LNlVYt//MbCfqV+vxc35lYtub3qhnTsc7E8t7rjvXu0MtG7bzeVnN3FlarpYa1vocuGDr1Wlbl11gr5b8x/vBal8u6Wi0v3Xub9HgaTip/N3J3Ek7HLQep1cC/qZg/WDn7knIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9dffijal8TIpWcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTctMTAtMjBUMDM6MDY6MzErMDA6MDA219rQAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE3LTEwLTIwVDAzOjA2OjMxKzAwOjAwR4pibAAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/warning.67a11a95.svg\";","module.exports = __webpack_public_path__ + \"static/media/down-arrow.697dc1af.svg\";","module.exports = __webpack_public_path__ + \"static/media/settings.042bb1c2.svg\";","import { Combat } from '../models/combat';\r\nimport { Condition, ConditionDurationCombatant, ConditionDurationRounds, ConditionDurationSaves } from '../models/condition';\r\nimport { Encounter, EncounterWave } from '../models/encounter';\r\nimport { Monster, MonsterGroup } from '../models/monster-group';\r\n\r\nexport default class Utils {\r\n\r\n    // This is an internal dictionary to speed up lookup\r\n    private static monsterIdToGroup: { [id: string]: MonsterGroup } = {};\r\n\r\n    public static getMonsterGroup(monster: Monster, library: MonsterGroup[]): MonsterGroup {\r\n        let group = this.monsterIdToGroup[monster.id];\r\n\r\n        if (!group) {\r\n            const grp = library.find(g => g.monsters.includes(monster));\r\n            if (grp) {\r\n                group = grp;\r\n                this.monsterIdToGroup[monster.id] = group;\r\n            }\r\n        }\r\n\r\n        return group;\r\n    }\r\n\r\n    public static match(filter: string, text: string): boolean {\r\n        if (!filter) {\r\n            return true;\r\n        }\r\n\r\n        let result = true;\r\n\r\n        const tokens = filter.toLowerCase().split(' ');\r\n        tokens.forEach(token => {\r\n            if (text.toLowerCase().indexOf(token) === -1) {\r\n                result = false;\r\n            }\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    public static guid(): string {\r\n        const s4 = () => Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\r\n        return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\r\n    }\r\n\r\n    public static sort(collection: any[], sorts: { field: string, dir: 'asc' | 'desc' }[] = []): any[] {\r\n        if (sorts.length === 0) {\r\n            sorts = [{ field: 'name', dir: 'asc' }];\r\n        }\r\n\r\n        const fn = (a: any, b: any, field: string): number => {\r\n            if ((a[field] !== undefined) && (b[field] !== undefined)) {\r\n                if (a[field] < b[field]) { return -1; }\r\n                if (a[field] > b[field]) { return 1; }\r\n            }\r\n            return 0;\r\n        };\r\n\r\n        collection.sort((a, b) => {\r\n            let order = 0;\r\n            sorts.forEach(sort => {\r\n                if (order === 0) {\r\n                    order = fn(a, b, sort.field) * (sort.dir === 'asc' ? 1 : -1);\r\n                }\r\n            });\r\n            return order;\r\n        });\r\n\r\n        return collection;\r\n    }\r\n\r\n    public static modifierValue(score: number): number {\r\n        return Math.floor((score - 10) / 2);\r\n    }\r\n\r\n    public static modifier(score: number): string {\r\n        const mod = this.modifierValue(score);\r\n        let str = mod.toString();\r\n        if (mod >= 0) {\r\n            str = '+' + str;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    public static dieRoll(sides: number = 20): number {\r\n        return Math.floor(Math.random() * sides) + 1;\r\n    }\r\n\r\n    public static miniSize(size: string): number {\r\n        switch (size) {\r\n            case 'tiny': return 0.4;\r\n            case 'small': return 0.6;\r\n            case 'medium': return 1;\r\n            case 'large': return 2;\r\n            case 'huge': return 3;\r\n            case 'gargantuan': return 4;\r\n            default: return 1;\r\n        }\r\n    }\r\n\r\n    public static hitDieType(size: string) {\r\n        switch (size) {\r\n            case 'tiny': return 4;\r\n            case 'small': return 6;\r\n            case 'medium': return 8;\r\n            case 'large': return 10;\r\n            case 'huge': return 12;\r\n            case 'gargantuan': return 20;\r\n            default: return 8;\r\n        }\r\n    }\r\n\r\n    public static challenge(cr: number): string {\r\n        switch (cr) {\r\n            case 0.125: return '1/8';\r\n            case 0.25: return '1/4';\r\n            case 0.5: return '1/2';\r\n            default: return cr.toString();\r\n        }\r\n    }\r\n\r\n    public static parseChallenge(cr: string): number {\r\n        switch (cr) {\r\n            case '1/8': return 0.125;\r\n            case '1/4': return 0.25;\r\n            case '1/2': return 0.5;\r\n            default: return parseInt(cr, 10);\r\n        }\r\n    }\r\n\r\n    public static challengeDetails(): any[] {\r\n        const result: any[] = [];\r\n\r\n        result.push({ cr: 0,        ac: 13,       hpMin: 1, hpMax: 6,       attack: 3,  dmgMin: 0,   dmgMax: 1,   save: 13 });\r\n        result.push({ cr: 0.125,    ac: 13,       hpMin: 7, hpMax: 35,      attack: 3,  dmgMin: 2,   dmgMax: 3,   save: 13 });\r\n        result.push({ cr: 0.25,     ac: 13,       hpMin: 36, hpMax: 49,     attack: 3,  dmgMin: 4,   dmgMax: 5,   save: 13 });\r\n        result.push({ cr: 0.5,      ac: 13,       hpMin: 50, hpMax: 70,     attack: 3,  dmgMin: 6,   dmgMax: 8,   save: 13 });\r\n        result.push({ cr: 1,        ac: 13,       hpMin: 71, hpMax: 85,     attack: 3,  dmgMin: 9,   dmgMax: 14,  save: 13 });\r\n        result.push({ cr: 2,        ac: 13,       hpMin: 86, hpMax: 100,    attack: 3,  dmgMin: 15,  dmgMax: 20,  save: 13 });\r\n        result.push({ cr: 3,        ac: 13,       hpMin: 101, hpMax: 115,   attack: 4,  dmgMin: 21,  dmgMax: 26,  save: 13 });\r\n        result.push({ cr: 4,        ac: 14,       hpMin: 116, hpMax: 130,   attack: 5,  dmgMin: 27,  dmgMax: 32,  save: 14 });\r\n        result.push({ cr: 5,        ac: 15,       hpMin: 131, hpMax: 145,   attack: 6,  dmgMin: 33,  dmgMax: 38,  save: 15 });\r\n        result.push({ cr: 6,        ac: 15,       hpMin: 146, hpMax: 160,   attack: 6,  dmgMin: 39,  dmgMax: 44,  save: 15 });\r\n        result.push({ cr: 7,        ac: 15,       hpMin: 161, hpMax: 175,   attack: 6,  dmgMin: 45,  dmgMax: 50,  save: 15 });\r\n        result.push({ cr: 8,        ac: 16,       hpMin: 176, hpMax: 190,   attack: 7,  dmgMin: 51,  dmgMax: 56,  save: 16 });\r\n        result.push({ cr: 9,        ac: 16,       hpMin: 191, hpMax: 205,   attack: 7,  dmgMin: 57,  dmgMax: 62,  save: 16 });\r\n        result.push({ cr: 10,       ac: 17,       hpMin: 206, hpMax: 220,   attack: 7,  dmgMin: 63,  dmgMax: 68,  save: 16 });\r\n        result.push({ cr: 11,       ac: 17,       hpMin: 221, hpMax: 235,   attack: 8,  dmgMin: 69,  dmgMax: 74,  save: 17 });\r\n        result.push({ cr: 12,       ac: 17,       hpMin: 236, hpMax: 250,   attack: 8,  dmgMin: 75,  dmgMax: 80,  save: 17 });\r\n        result.push({ cr: 13,       ac: 18,       hpMin: 251, hpMax: 265,   attack: 8,  dmgMin: 81,  dmgMax: 86,  save: 18 });\r\n        result.push({ cr: 14,       ac: 18,       hpMin: 266, hpMax: 280,   attack: 8,  dmgMin: 87,  dmgMax: 92,  save: 18 });\r\n        result.push({ cr: 15,       ac: 18,       hpMin: 281, hpMax: 295,   attack: 8,  dmgMin: 93,  dmgMax: 98,  save: 18 });\r\n        result.push({ cr: 16,       ac: 18,       hpMin: 296, hpMax: 310,   attack: 9,  dmgMin: 99,  dmgMax: 104, save: 18 });\r\n        result.push({ cr: 17,       ac: 19,       hpMin: 311, hpMax: 325,   attack: 10, dmgMin: 105, dmgMax: 110, save: 19 });\r\n        result.push({ cr: 18,       ac: 19,       hpMin: 326, hpMax: 340,   attack: 10, dmgMin: 111, dmgMax: 116, save: 19 });\r\n        result.push({ cr: 19,       ac: 19,       hpMin: 341, hpMax: 355,   attack: 10, dmgMin: 117, dmgMax: 122, save: 19 });\r\n        result.push({ cr: 20,       ac: 19,       hpMin: 356, hpMax: 400,   attack: 10, dmgMin: 123, dmgMax: 140, save: 19 });\r\n        result.push({ cr: 21,       ac: 19,       hpMin: 401, hpMax: 445,   attack: 11, dmgMin: 141, dmgMax: 158, save: 20 });\r\n        result.push({ cr: 22,       ac: 19,       hpMin: 446, hpMax: 490,   attack: 11, dmgMin: 159, dmgMax: 176, save: 20 });\r\n        result.push({ cr: 23,       ac: 19,       hpMin: 491, hpMax: 535,   attack: 11, dmgMin: 177, dmgMax: 194, save: 20 });\r\n        result.push({ cr: 24,       ac: 19,       hpMin: 536, hpMax: 580,   attack: 12, dmgMin: 195, dmgMax: 212, save: 21 });\r\n        result.push({ cr: 25,       ac: 19,       hpMin: 581, hpMax: 625,   attack: 12, dmgMin: 213, dmgMax: 230, save: 21 });\r\n        result.push({ cr: 26,       ac: 19,       hpMin: 626, hpMax: 670,   attack: 12, dmgMin: 231, dmgMax: 248, save: 21 });\r\n        result.push({ cr: 27,       ac: 19,       hpMin: 671, hpMax: 715,   attack: 13, dmgMin: 249, dmgMax: 266, save: 22 });\r\n        result.push({ cr: 28,       ac: 19,       hpMin: 716, hpMax: 760,   attack: 13, dmgMin: 267, dmgMax: 284, save: 22 });\r\n        result.push({ cr: 29,       ac: 19,       hpMin: 761, hpMax: 805,   attack: 13, dmgMin: 285, dmgMax: 302, save: 22 });\r\n        result.push({ cr: 30,       ac: 19,       hpMin: 806, hpMax: 850,   attack: 14, dmgMin: 303, dmgMax: 320, save: 23 });\r\n\r\n        return result;\r\n    }\r\n\r\n    public static experience(cr: number): number {\r\n        switch (cr) {\r\n            case 0: return 10;\r\n            case 0.125: return 25;\r\n            case 0.25: return 50;\r\n            case 0.5: return 100;\r\n            case 1: return 200;\r\n            case 2: return 450;\r\n            case 3: return 700;\r\n            case 4: return 1100;\r\n            case 5: return 1800;\r\n            case 6: return 2300;\r\n            case 7: return 2900;\r\n            case 8: return 3900;\r\n            case 9: return 5000;\r\n            case 10: return 5900;\r\n            case 11: return 7200;\r\n            case 12: return 8400;\r\n            case 13: return 10000;\r\n            case 14: return 11500;\r\n            case 15: return 13000;\r\n            case 16: return 15000;\r\n            case 17: return 18000;\r\n            case 18: return 20000;\r\n            case 19: return 22000;\r\n            case 20: return 25000;\r\n            case 21: return 33000;\r\n            case 22: return 41000;\r\n            case 23: return 50000;\r\n            case 24: return 62000;\r\n            case 30: return 155000;\r\n            default: return 0;\r\n        }\r\n    }\r\n\r\n    public static experienceFactor(count: number): number {\r\n        switch (count) {\r\n            case 0:\r\n                return 0;\r\n            case 1:\r\n                return 1;\r\n            case 2:\r\n                return 1.5;\r\n            case 3:\r\n            case 4:\r\n            case 5:\r\n            case 6:\r\n                return 2;\r\n            case 7:\r\n            case 8:\r\n            case 9:\r\n            case 10:\r\n                return 2.5;\r\n            case 11:\r\n            case 12:\r\n            case 13:\r\n            case 14:\r\n                return 3;\r\n            default:\r\n                return 4;\r\n        }\r\n    }\r\n\r\n    public static pcExperience(level: number, difficulty: string): number {\r\n        switch (difficulty) {\r\n            case 'easy':\r\n                switch (level) {\r\n                    case 1: return 25;\r\n                    case 2: return 50;\r\n                    case 3: return 75;\r\n                    case 4: return 125;\r\n                    case 5: return 250;\r\n                    case 6: return 300;\r\n                    case 7: return 350;\r\n                    case 8: return 450;\r\n                    case 9: return 550;\r\n                    case 10: return 600;\r\n                    case 11: return 800;\r\n                    case 12: return 1000;\r\n                    case 13: return 1100;\r\n                    case 14: return 1250;\r\n                    case 15: return 1400;\r\n                    case 16: return 1600;\r\n                    case 17: return 2000;\r\n                    case 18: return 2100;\r\n                    case 19: return 2400;\r\n                    case 20: return 2800;\r\n                    default: return 0;\r\n                }\r\n            case 'medium':\r\n                switch (level) {\r\n                    case 1: return 50;\r\n                    case 2: return 100;\r\n                    case 3: return 150;\r\n                    case 4: return 250;\r\n                    case 5: return 500;\r\n                    case 6: return 600;\r\n                    case 7: return 750;\r\n                    case 8: return 900;\r\n                    case 9: return 1100;\r\n                    case 10: return 1200;\r\n                    case 11: return 1600;\r\n                    case 12: return 2000;\r\n                    case 13: return 2200;\r\n                    case 14: return 2500;\r\n                    case 15: return 2800;\r\n                    case 16: return 3200;\r\n                    case 17: return 3900;\r\n                    case 18: return 4200;\r\n                    case 19: return 4900;\r\n                    case 20: return 5700;\r\n                    default: return 0;\r\n                }\r\n            case 'hard':\r\n                switch (level) {\r\n                    case 1: return 75;\r\n                    case 2: return 150;\r\n                    case 3: return 225;\r\n                    case 4: return 375;\r\n                    case 5: return 750;\r\n                    case 6: return 900;\r\n                    case 7: return 1100;\r\n                    case 8: return 1400;\r\n                    case 9: return 1600;\r\n                    case 10: return 1900;\r\n                    case 11: return 2400;\r\n                    case 12: return 3000;\r\n                    case 13: return 3400;\r\n                    case 14: return 3800;\r\n                    case 15: return 4300;\r\n                    case 16: return 4800;\r\n                    case 17: return 5900;\r\n                    case 18: return 6300;\r\n                    case 19: return 7300;\r\n                    case 20: return 8500;\r\n                    default: return 0;\r\n                }\r\n            case 'deadly':\r\n                switch (level) {\r\n                    case 1: return 100;\r\n                    case 2: return 200;\r\n                    case 3: return 400;\r\n                    case 4: return 500;\r\n                    case 5: return 1100;\r\n                    case 6: return 1400;\r\n                    case 7: return 1700;\r\n                    case 8: return 2100;\r\n                    case 9: return 2400;\r\n                    case 10: return 2800;\r\n                    case 11: return 3600;\r\n                    case 12: return 4500;\r\n                    case 13: return 5100;\r\n                    case 14: return 5700;\r\n                    case 15: return 6400;\r\n                    case 16: return 7200;\r\n                    case 17: return 8800;\r\n                    case 18: return 9500;\r\n                    case 19: return 10900;\r\n                    case 20: return 12700;\r\n                    default: return 0;\r\n                }\r\n            default:\r\n                return 0;\r\n        }\r\n    }\r\n\r\n    public static traitType(type: string, plural: boolean): string {\r\n        let str = '';\r\n        switch (type) {\r\n            case 'trait':\r\n                str = 'trait';\r\n                break;\r\n            case 'action':\r\n                str = 'action';\r\n                break;\r\n            case 'bonus':\r\n                str = 'bonus action';\r\n                break;\r\n            case 'reaction':\r\n                str = 'reaction';\r\n                break;\r\n            case 'legendary':\r\n                str = 'legendary action';\r\n                break;\r\n            case 'lair':\r\n                str = 'lair action';\r\n                break;\r\n        }\r\n\r\n        if (plural) {\r\n            str += 's';\r\n        }\r\n\r\n        return str;\r\n    }\r\n\r\n    public static nudgeChallenge(value: number, delta: number): number {\r\n        let result = 0;\r\n\r\n        switch (value) {\r\n            case 0:\r\n                if (delta === -1) {\r\n                    result = 0;\r\n                }\r\n                if (delta === +1) {\r\n                    result = 0.125;\r\n                }\r\n                break;\r\n            case 0.125:\r\n                if (delta === -1) {\r\n                    result = 0;\r\n                }\r\n                if (delta === +1) {\r\n                    result = 0.25;\r\n                }\r\n                break;\r\n            case 0.25:\r\n                if (delta === -1) {\r\n                    result = 0.125;\r\n                }\r\n                if (delta === +1) {\r\n                    result = 0.5;\r\n                }\r\n                break;\r\n            case 0.5:\r\n                if (delta === -1) {\r\n                    result = 0.25;\r\n                }\r\n                if (delta === +1) {\r\n                    result = 1;\r\n                }\r\n                break;\r\n            case 1:\r\n                if (delta === -1) {\r\n                    result = 0.5;\r\n                }\r\n                if (delta === +1) {\r\n                    result = 2;\r\n                }\r\n                break;\r\n            default:\r\n                result = value + delta;\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public static nudgeSize(value: string, delta: number): string {\r\n        const sizes = ['tiny', 'small', 'medium', 'large', 'huge', 'gargantuan'];\r\n        let index = sizes.indexOf(value) + delta;\r\n        if (index < 0) {\r\n            index = 0;\r\n        }\r\n        if (index >= sizes.length) {\r\n            index = sizes.length - 1;\r\n        }\r\n        return sizes[index];\r\n    }\r\n\r\n    public static conditionText(condition: Condition): string[] {\r\n        switch (condition.name) {\r\n            case 'blinded':\r\n                return [\r\n                    'a blinded creature can’t see and automatically fails any ability check that requires sight',\r\n                    'attack rolls against the creature have advantage, and the creature’s attack rolls have disadvantage'\r\n                ];\r\n            case 'charmed':\r\n                return [\r\n                    'a charmed creature can’t attack the charmer or target the charmer with harmful abilities or magical effects',\r\n                    'the charmer has advantage on any ability check to interact socially with the creature'\r\n                ];\r\n            case 'deafened':\r\n                return [\r\n                    'a deafened creature can’t hear and automatically fails any ability check that requires hearing.'\r\n                ];\r\n            case 'exhaustion': {\r\n                switch (condition.level) {\r\n                case 1:\r\n                    return [\r\n                        'disadvantage on ability checks'\r\n                    ];\r\n                case 2:\r\n                    return [\r\n                        'disadvantage on ability checks',\r\n                        'speed halved'\r\n                    ];\r\n                case 3:\r\n                    return [\r\n                        'disadvantage on ability checks',\r\n                        'speed halved',\r\n                        'disadvantage on attack rolls and saving throws'\r\n                    ];\r\n                case 4:\r\n                    return [\r\n                        'disadvantage on ability checks',\r\n                        'speed halved',\r\n                        'disadvantage on attack rolls and saving throws',\r\n                        'hit point maximum halved'\r\n                    ];\r\n                case 5:\r\n                    return [\r\n                        'disadvantage on ability checks',\r\n                        'speed halved',\r\n                        'disadvantage on attack rolls and saving throws',\r\n                        'hit point maximum halved',\r\n                        'speed reduced to 0'\r\n                    ];\r\n                case 6:\r\n                    return [\r\n                        'disadvantage on ability checks',\r\n                        'speed halved',\r\n                        'disadvantage on attack rolls and saving throws',\r\n                        'hit point maximum halved',\r\n                        'speed reduced to 0',\r\n                        'death'\r\n                    ];\r\n                default:\r\n                    return [];\r\n                }\r\n            }\r\n            case 'frightened':\r\n                return [\r\n                    'a frightened creature has disadvantage on ability checks and attack rolls while the source of its fear is within line of sight',\r\n                    'the creature can’t willingly move closer to the source of its fear'\r\n                ];\r\n            case 'grappled':\r\n                return [\r\n                    'a grappled creature’s speed becomes 0, and it can’t benefit from any bonus to its speed',\r\n                    'the condition ends if the grappler is incapacitated',\r\n                    'the condition also ends if an effect removes the grappled creature from the reach of the grappler or grappling effect'\r\n                ];\r\n            case 'incapacitated':\r\n                return [\r\n                    'an incapacitated creature can’t take actions or reactions',\r\n                    'being incapacitated breaks concentration'\r\n                ];\r\n            case 'invisible':\r\n                return [\r\n                    'an invisible creature is impossible to see without the aid of magic or a special sense',\r\n                    'for the purpose of hiding, the creature is heavily obscured',\r\n                    'the creature’s location can be detected by any noise it makes or any tracks it leaves',\r\n                    'attack rolls against the creature have disadvantage, and the creature’s attack rolls have advantage'\r\n                ];\r\n            case 'paralyzed':\r\n                return [\r\n                    'a paralyzed creature is incapacitated (can’t take actions or reactions) and can’t move or speak',\r\n                    'the creature automatically fails strength and dexterity saving throws',\r\n                    'attack rolls against the creature have advantage',\r\n                    'any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature'\r\n                ];\r\n            case 'petrified':\r\n                return [\r\n                    /* tslint:disable-next-line:max-line-length */\r\n                    'a petrified creature is transformed, along with any nonmagical objects it is wearing or carrying, into a solid inanimate substance (usually stone)',\r\n                    'its weight increases by a factor of ten, and it ceases aging',\r\n                    'the creature is incapacitated (can’t take actions or reactions), can’t move or speak, and is unaware of its surroundings',\r\n                    'attack rolls against the creature have advantage',\r\n                    'the creature automatically fails strength and dexterity saving throws',\r\n                    'the creature has resistance to all damage',\r\n                    'the creature is immune to poison and disease, although a poison or disease already in its system is suspended, not neutralized'\r\n                ];\r\n            case 'poisoned':\r\n                return [\r\n                    'a poisoned creature has disadvantage on attack rolls and ability checks'\r\n                ];\r\n            case 'prone':\r\n                return [\r\n                    'a prone creature’s only movement option is to crawl, unless it stands up and thereby ends the condition',\r\n                    'the creature has disadvantage on attack rolls',\r\n                    /* tslint:disable-next-line:max-line-length */\r\n                    'an attack roll against the creature has advantage if the attacker is Within 5 feet of the creature; otherwise, the attack roll has disadvantage'\r\n                ];\r\n            case 'restrained':\r\n                return [\r\n                    'a restrained creature’s speed becomes 0, and it can’t benefit from any bonus to its speed',\r\n                    'attack rolls against the creature have advantage, and the creature’s attack rolls have disadvantage',\r\n                    'the creature has disadvantage on dexterity saving throws'\r\n                ];\r\n            case 'stunned':\r\n                return [\r\n                    'a stunned creature is incapacitated (can’t take actions or reactions), can’t move, and can speak only falteringly',\r\n                    'the creature automatically fails strength and dexterity saving throws',\r\n                    'attack rolls against the creature have advantage'\r\n                ];\r\n            case 'unconscious':\r\n                return [\r\n                    'an unconscious creature is incapacitated (can’t take actions or reactions), can’t move or speak, and is unaware of its surroundings',\r\n                    'the creature drops whatever its holding and falls prone',\r\n                    'the creature automatically fails strength and dexterity saving throws',\r\n                    'attack rolls against the creature have advantage',\r\n                    'any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature'\r\n                ];\r\n            case 'custom':\r\n                return [];\r\n            default:\r\n                return [];\r\n        }\r\n    }\r\n\r\n    public static conditionDurationText(condition: Condition, combat: Combat) {\r\n        if (condition.duration !== null) {\r\n            switch (condition.duration.type) {\r\n                case 'saves':\r\n                    const saveDuration = condition.duration as ConditionDurationSaves;\r\n                    let saveType = saveDuration.saveType.toString();\r\n                    if (saveType !== 'death') {\r\n                        saveType = saveType.toUpperCase();\r\n                    }\r\n                    const saves = saveDuration.count > 1 ? 'saves' : 'save';\r\n                    return 'until you make ' + saveDuration.count + ' ' + saveType + ' ' + saves + ' at dc ' + saveDuration.saveDC;\r\n                case 'combatant':\r\n                    const combatantDuration = condition.duration as ConditionDurationCombatant;\r\n                    const point = combatantDuration.point;\r\n                    const c = combat.combatants.find(cmb => cmb.id === combatantDuration.combatantID);\r\n                    const combatant = c ? (c.displayName || c.name || 'unnamed monster') + '\\'s' : 'someone\\'s';\r\n                    return 'until the ' + point + ' of ' + combatant + ' next turn';\r\n                case 'rounds':\r\n                    const roundsDuration = condition.duration as ConditionDurationRounds;\r\n                    const rounds = roundsDuration.count > 1 ? 'rounds' : 'round';\r\n                    return 'for ' + roundsDuration.count + ' ' + rounds;\r\n                default:\r\n                    return null;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public static getMonsterNames(encounter: Encounter | EncounterWave): { id: string, names: string[] }[] {\r\n        const monsterNames: any[] = [];\r\n        if (encounter) {\r\n            encounter.slots.forEach(slot => {\r\n                const names: any[] = [];\r\n                if (slot.count === 1) {\r\n                    names.push(slot.monsterName);\r\n                } else {\r\n                    for (let n = 0; n !== slot.count; ++n) {\r\n                        names.push(slot.monsterName + ' ' + (n + 1));\r\n                    }\r\n                }\r\n\r\n                monsterNames.push({\r\n                    id: slot.id,\r\n                    names: names\r\n                });\r\n            });\r\n        }\r\n\r\n        return monsterNames;\r\n    }\r\n\r\n    public static getTagDescription(tag: string) {\r\n        switch (tag) {\r\n            case 'conc':\r\n                return 'concentrating';\r\n            case 'bane':\r\n                return 'baned (subtract d4 from attack rolls and saving throws)';\r\n            case 'bless':\r\n                return 'blessed (add d4 to attack rolls and saving throws)';\r\n            case 'hex':\r\n                return 'hexed (disadvantage on one saving throw; take additional damage on hit)';\r\n            default:\r\n                return tag;\r\n        }\r\n    }\r\n}\r\n","import Utils from './utils';\r\n\r\nimport { Combat, CombatSetup, Notification } from '../models/combat';\r\nimport { Condition, ConditionDurationCombatant, ConditionDurationRounds, ConditionDurationSaves } from '../models/condition';\r\nimport { Encounter, EncounterSlot, EncounterWave, MonsterFilter } from '../models/encounter';\r\nimport { Map, MapFolio, MapItem } from '../models/map-folio';\r\nimport { Monster, MonsterGroup, Trait } from '../models/monster-group';\r\nimport { Companion, Party, PC } from '../models/party';\r\n\r\nexport default class Factory {\r\n\r\n    public static createParty(): Party {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            pcs: []\r\n        };\r\n    }\r\n\r\n    public static createPC(): PC {\r\n        return {\r\n            id: Utils.guid(),\r\n            type: 'pc',\r\n            active: true,\r\n            player: '',\r\n            name: '',\r\n            race: '',\r\n            classes: '',\r\n            level: 1,\r\n            languages: 'Common',\r\n            passiveInsight: 10,\r\n            passiveInvestigation: 10,\r\n            passivePerception: 10,\r\n            portrait: '',\r\n            url: '',\r\n            companions: []\r\n        };\r\n    }\r\n\r\n    public static createCompanion(): Companion {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: ''\r\n        };\r\n    }\r\n\r\n    public static createMonsterGroup(): MonsterGroup {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            monsters: []\r\n        };\r\n    }\r\n\r\n    public static createMonster(): Monster {\r\n        return {\r\n            id: Utils.guid(),\r\n            type: 'monster',\r\n            name: '',\r\n            size: 'medium',\r\n            category: 'humanoid',\r\n            tag: '',\r\n            alignment: '',\r\n            challenge: 1,\r\n            abilityScores: {\r\n                str: 10,\r\n                dex: 10,\r\n                con: 10,\r\n                int: 10,\r\n                wis: 10,\r\n                cha: 10\r\n            },\r\n            ac: 10,\r\n            hpMax: 4,\r\n            hpTemp: 0,\r\n            hitDice: 1,\r\n            damage: {\r\n                resist: '',\r\n                vulnerable: '',\r\n                immune: ''\r\n            },\r\n            savingThrows: '',\r\n            speed: '',\r\n            skills: '',\r\n            senses: '',\r\n            languages: '',\r\n            equipment: '',\r\n            traits: [],\r\n            conditionImmunities: '',\r\n            portrait: ''\r\n        };\r\n    }\r\n\r\n    public static createTrait(): Trait {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            usage: '',\r\n            type: 'action',\r\n            text: '',\r\n            uses: 0\r\n        };\r\n    }\r\n\r\n    public static createEncounter(): Encounter {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            slots: [],\r\n            waves: []\r\n        };\r\n    }\r\n\r\n    public static createEncounterSlot(): EncounterSlot {\r\n        return {\r\n            id: Utils.guid(),\r\n            monsterGroupName: '',\r\n            monsterName: '',\r\n            count: 1\r\n        };\r\n    }\r\n\r\n    public static createEncounterWave(): EncounterWave {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            slots: []\r\n        };\r\n    }\r\n\r\n    public static createMonsterFilter(): MonsterFilter {\r\n        return {\r\n            name: '',\r\n            challengeMin: 0,\r\n            challengeMax: 5,\r\n            category: 'all types',\r\n            size: 'all sizes'\r\n        };\r\n    }\r\n\r\n    public static createMapFolio(): MapFolio {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            maps: []\r\n        };\r\n    }\r\n\r\n    public static createMap(): Map {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            items: []\r\n        };\r\n    }\r\n\r\n    public static createMapItem(): MapItem {\r\n        return {\r\n            id: Utils.guid(),\r\n            type: 'tile',\r\n            x: 0,\r\n            y: 0,\r\n            width: 4,\r\n            height: 4,\r\n            terrain: null,\r\n            customBackground: '',\r\n            style: null\r\n        };\r\n    }\r\n\r\n    public static createCombatSetup(): CombatSetup {\r\n        return {\r\n            partyID: null,\r\n            encounterID: null,\r\n            waveID: null,\r\n            folioID: null,\r\n            mapID: null,\r\n            monsterNames: [],\r\n            encounterInitMode: 'group'\r\n        };\r\n    }\r\n\r\n    public static createCombat(): Combat {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            encounterID: null,\r\n            combatants: [],\r\n            map: null,\r\n            round: 1,\r\n            notifications: [],\r\n            issues: [],\r\n            timestamp: null\r\n        };\r\n    }\r\n\r\n    public static createNotification(): Notification {\r\n        return {\r\n            id: Utils.guid(),\r\n            type: 'condition-save',\r\n            data: null,\r\n            combatant: null\r\n        };\r\n    }\r\n\r\n    public static createCondition(): Condition {\r\n        return {\r\n            id: Utils.guid(),\r\n            name: '',\r\n            level: 1,\r\n            text: null,\r\n            duration: null\r\n        };\r\n    }\r\n\r\n    public static createConditionDurationSaves(): ConditionDurationSaves {\r\n        return {\r\n            type: 'saves',\r\n            count: 1,\r\n            saveType: 'str',\r\n            saveDC: 10,\r\n            point: 'start'\r\n        };\r\n    }\r\n\r\n    public static createConditionDurationCombatant(): ConditionDurationCombatant {\r\n        return {\r\n            type: 'combatant',\r\n            point: 'start',\r\n            combatantID: null\r\n        };\r\n    }\r\n\r\n    public static createConditionDurationRounds(): ConditionDurationRounds {\r\n        return {\r\n            type: 'rounds',\r\n            count: 1\r\n        };\r\n    }\r\n}\r\n","export interface MonsterGroup {\r\n    id: string;\r\n    name: string;\r\n    monsters: Monster[];\r\n}\r\n\r\nexport interface Monster {\r\n    id: string;\r\n    type: string;\r\n    name: string;\r\n    size: string;\r\n    category: string;\r\n    tag: string;\r\n    alignment: string;\r\n    challenge: number;\r\n    abilityScores: {\r\n        str: number;\r\n        dex: number;\r\n        con: number;\r\n        int: number;\r\n        wis: number;\r\n        cha: number;\r\n    };\r\n    ac: number;\r\n    hpMax: number;\r\n    hpTemp: number;\r\n    hitDice: number;\r\n    damage: {\r\n        resist: string;\r\n        vulnerable: string;\r\n        immune: string;\r\n    };\r\n    savingThrows: string;\r\n    speed: string;\r\n    skills: string;\r\n    senses: string;\r\n    languages: string;\r\n    equipment: string;\r\n    traits: Trait[];\r\n    conditionImmunities: string;\r\n    portrait: string;\r\n}\r\n\r\nexport interface Trait {\r\n    id: string;\r\n    name: string;\r\n    usage: string;\r\n    type: 'trait' | 'action' | 'bonus' | 'reaction' | 'legendary' | 'lair';\r\n    text: string;\r\n    uses: number;\r\n}\r\n\r\nexport const SIZE_TYPES = [\r\n    'tiny',\r\n    'small',\r\n    'medium',\r\n    'large',\r\n    'huge',\r\n    'gargantuan'\r\n];\r\n\r\nexport const CATEGORY_TYPES = [\r\n    'aberration',\r\n    'beast',\r\n    'celestial',\r\n    'construct',\r\n    'dragon',\r\n    'elemental',\r\n    'fey',\r\n    'fiend',\r\n    'giant',\r\n    'humanoid',\r\n    'monstrosity',\r\n    'ooze',\r\n    'plant',\r\n    'undead'\r\n];\r\n\r\nexport const TRAIT_TYPES = [\r\n    'trait',\r\n    'action',\r\n    'bonus',\r\n    'reaction',\r\n    'legendary',\r\n    'lair'\r\n];\r\n","import Factory from './factory';\r\nimport Utils from './utils';\r\n\r\nimport { Monster, Trait, TRAIT_TYPES } from '../models/monster-group';\r\n\r\nexport default class Frankenstein {\r\n    public static nudgeValue(target: Monster, field: string, delta: number) {\r\n        let source: any = target;\r\n        let value: any = null;\r\n        const tokens = field.split('.');\r\n        tokens.forEach(token => {\r\n            if (token === tokens[tokens.length - 1]) {\r\n                value = source[token];\r\n            } else {\r\n                source = source[token];\r\n            }\r\n        });\r\n\r\n        let newValue;\r\n        switch (field) {\r\n            case 'challenge':\r\n                newValue = Utils.nudgeChallenge(value, delta);\r\n                break;\r\n            case 'size':\r\n                newValue = Utils.nudgeSize(value, delta);\r\n                break;\r\n            default:\r\n                newValue = (value ? value : 0) + delta;\r\n                break;\r\n        }\r\n        Frankenstein.changeValue(target, field, newValue);\r\n    }\r\n\r\n    public static changeValue(target: Monster, field: string, value: any) {\r\n        let source: any = target;\r\n        const tokens = field.split('.');\r\n        tokens.forEach(token => {\r\n            if (token === tokens[tokens.length - 1]) {\r\n                source[token] = value;\r\n\r\n                if ((field === 'abilityScores.con') || (field === 'size') || (field === 'hitDice')) {\r\n                    const sides = Utils.hitDieType(target.size);\r\n                    const conMod = Math.floor((target.abilityScores.con - 10) / 2);\r\n                    const hpPerDie = ((sides + 1) / 2) + conMod;\r\n                    const hp = Math.floor(target.hitDice * hpPerDie);\r\n                    target.hpMax = hp;\r\n                }\r\n            } else {\r\n                source = source[token];\r\n            }\r\n        });\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Monster creation\r\n\r\n    public static clone(monster: Monster, name: string): Monster {\r\n        return {\r\n            id: Utils.guid(),\r\n            type: 'monster',\r\n            name: name || (monster.name + ' copy'),\r\n            size: monster.size,\r\n            category: monster.category,\r\n            tag: monster.tag,\r\n            alignment: monster.alignment,\r\n            challenge: monster.challenge,\r\n            abilityScores: {\r\n                str: monster.abilityScores.str,\r\n                dex: monster.abilityScores.dex,\r\n                con: monster.abilityScores.con,\r\n                int: monster.abilityScores.int,\r\n                wis: monster.abilityScores.wis,\r\n                cha: monster.abilityScores.cha\r\n            },\r\n            ac: monster.ac,\r\n            hpMax: monster.hpMax,\r\n            hpTemp: monster.hpTemp,\r\n            hitDice: monster.hitDice,\r\n            damage: {\r\n                resist: monster.damage.resist,\r\n                vulnerable: monster.damage.vulnerable,\r\n                immune: monster.damage.immune\r\n            },\r\n            savingThrows: monster.savingThrows,\r\n            speed: monster.speed,\r\n            skills: monster.skills,\r\n            senses: monster.senses,\r\n            languages: monster.languages,\r\n            equipment: monster.equipment,\r\n            traits: monster.traits.map(trait => {\r\n                return {\r\n                    id: Utils.guid(),\r\n                    name: trait.name,\r\n                    usage: trait.usage,\r\n                    type: trait.type,\r\n                    text: trait.text,\r\n                    uses: 0\r\n                };\r\n            }),\r\n            conditionImmunities: monster.conditionImmunities,\r\n            portrait: monster.portrait\r\n        };\r\n    }\r\n\r\n    public static createFromJSON(data: any): Monster {\r\n        const monster = Factory.createMonster();\r\n\r\n        monster.type = 'monster';\r\n        monster.name = data.name;\r\n        monster.size = data.size.toLowerCase();\r\n        monster.category = data.type;\r\n        monster.tag = data.subtype;\r\n        monster.alignment = data.alignment;\r\n        monster.challenge = Utils.parseChallenge(data.challenge_rating);\r\n        monster.ac = data.armor_class;\r\n        monster.hpMax = data.hit_points;\r\n        monster.speed = data.speed;\r\n        monster.senses = data.senses;\r\n        monster.languages = data.languages;\r\n\r\n        const index = data.hit_dice.indexOf('d');\r\n        monster.hitDice = parseInt(data.hit_dice.substring(0, index), 10);\r\n\r\n        monster.abilityScores.str = data.strength;\r\n        monster.abilityScores.dex = data.dexterity;\r\n        monster.abilityScores.con = data.constitution;\r\n        monster.abilityScores.int = data.intelligence;\r\n        monster.abilityScores.wis = data.wisdom;\r\n        monster.abilityScores.cha = data.charisma;\r\n\r\n        monster.damage.resist = data.damage_resistances;\r\n        monster.damage.vulnerable = data.damage_vulnerabilities;\r\n        monster.damage.immune = data.damage_immunities;\r\n        monster.conditionImmunities = data.condition_immunities;\r\n\r\n        const saves = [\r\n            {\r\n                field: 'strength_save',\r\n                text: 'Strength'\r\n            },\r\n            {\r\n                field: 'dexterity_save',\r\n                text: 'Dexterity'\r\n            },\r\n            {\r\n                field: 'constitution_save',\r\n                text: 'Constitution'\r\n            },\r\n            {\r\n                field: 'intelligence_save',\r\n                text: 'Intelligence'\r\n            },\r\n            {\r\n                field: 'wisdom_save',\r\n                text: 'Wisdom'\r\n            },\r\n            {\r\n                field: 'charisma_save',\r\n                text: 'Charisma'\r\n            }\r\n        ];\r\n        saves.forEach(save => {\r\n            if (data[save.field]) {\r\n                const str = save.text + ' ' + data[save.field];\r\n                monster.savingThrows += monster.savingThrows === '' ? str : ', ' + str;\r\n            }\r\n        });\r\n\r\n        const skills = [\r\n            {\r\n                field: 'acrobatics',\r\n                text: 'Acrobatics'\r\n            },\r\n            {\r\n                field: 'animal_handling',\r\n                text: 'Animal handling'\r\n            },\r\n            {\r\n                field: 'arcana',\r\n                text: 'Arcana'\r\n            },\r\n            {\r\n                field: 'athletics',\r\n                text: 'Athletics'\r\n            },\r\n            {\r\n                field: 'deception',\r\n                text: 'Deception'\r\n            },\r\n            {\r\n                field: 'history',\r\n                text: 'History'\r\n            },\r\n            {\r\n                field: 'insight',\r\n                text: 'Insight'\r\n            },\r\n            {\r\n                field: 'intimidation',\r\n                text: 'Intimidation'\r\n            },\r\n            {\r\n                field: 'investigation',\r\n                text: 'Investigation'\r\n            },\r\n            {\r\n                field: 'medicine',\r\n                text: 'Medicine'\r\n            },\r\n            {\r\n                field: 'nature',\r\n                text: 'Nature'\r\n            },\r\n            {\r\n                field: 'perception',\r\n                text: 'Perception'\r\n            },\r\n            {\r\n                field: 'performance',\r\n                text: 'Performance'\r\n            },\r\n            {\r\n                field: 'persuasion',\r\n                text: 'Persuasion'\r\n            },\r\n            {\r\n                field: 'religion',\r\n                text: 'Religion'\r\n            },\r\n            {\r\n                field: 'sleight_of_hand',\r\n                text: 'Sleight of hand'\r\n            },\r\n            {\r\n                field: 'stealth',\r\n                text: 'Stealth'\r\n            },\r\n            {\r\n                field: 'survival',\r\n                text: 'Survival'\r\n            }\r\n        ];\r\n        skills.forEach(skill => {\r\n            if (data[skill.field]) {\r\n                const str = skill.text + ' ' + data[skill.field];\r\n                monster.skills += monster.skills === '' ? str : ', ' + str;\r\n            }\r\n        });\r\n\r\n        if (data.special_abilities) {\r\n            data.special_abilities.forEach((rawTrait: any) => {\r\n                const trait = this.buildTrait(rawTrait, 'trait');\r\n                monster.traits.push(trait);\r\n            });\r\n        }\r\n        if (data.actions) {\r\n            data.actions.forEach((rawTrait: any) => {\r\n                const trait = this.buildTrait(rawTrait, 'action');\r\n                monster.traits.push(trait);\r\n            });\r\n        }\r\n        if (data.reactions) {\r\n            data.reactions.forEach((rawTrait: any) => {\r\n                const trait = this.buildTrait(rawTrait, 'reaction');\r\n                monster.traits.push(trait);\r\n            });\r\n        }\r\n        if (data.legendary_actions) {\r\n            data.legendary_actions.forEach((rawTrait: any) => {\r\n                const trait = this.buildTrait(rawTrait, 'legendary');\r\n                monster.traits.push(trait);\r\n            });\r\n        }\r\n\r\n        return monster;\r\n    }\r\n\r\n    private static buildTrait(rawTrait: any, type: 'trait' | 'action' | 'bonus' | 'reaction' | 'legendary' | 'lair'): Trait {\r\n        let name = '';\r\n        let usage = '';\r\n\r\n        const openBracket = rawTrait.name.indexOf('(');\r\n        if (openBracket === -1) {\r\n            name = rawTrait.name;\r\n        } else {\r\n            const closeBracket = rawTrait.name.indexOf(')');\r\n            name = rawTrait.name.substring(0, openBracket - 1);\r\n            usage = rawTrait.name.substring(openBracket + 1, closeBracket).toLowerCase();\r\n        }\r\n\r\n        const text: string = rawTrait.desc.replace(/•/g, '*');\r\n\r\n        let finalType = type;\r\n        if (name === 'Lair Actions') {\r\n            finalType = 'lair';\r\n        }\r\n        if (text.indexOf('As a bonus action') === 0) {\r\n            finalType = 'bonus';\r\n        }\r\n\r\n        return {\r\n            id: Utils.guid(),\r\n            type: finalType,\r\n            name: name,\r\n            usage: usage,\r\n            text: text,\r\n            uses: 0\r\n        };\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Traits\r\n\r\n    public static copyTrait(target: Monster, trait: Trait) {\r\n        const copy = JSON.parse(JSON.stringify(trait));\r\n        copy.id = Utils.guid();\r\n        target.traits.push(copy);\r\n    }\r\n\r\n    public static addTrait(target: Monster, type: 'trait' | 'action' | 'bonus' | 'reaction' | 'legendary' | 'lair') {\r\n        const trait = Factory.createTrait();\r\n        trait.type = type;\r\n        trait.name = 'New ' + Utils.traitType(type, false).toLowerCase();\r\n        target.traits.push(trait);\r\n    }\r\n\r\n    public static removeTrait(target: Monster, trait: Trait) {\r\n        const index = target.traits.indexOf(trait);\r\n        target.traits.splice(index, 1);\r\n    }\r\n\r\n    public static swapTraits(target: Monster, t1: Trait, t2: Trait) {\r\n        const index1 = target.traits.indexOf(t1);\r\n        const index2 = target.traits.indexOf(t2);\r\n        target.traits[index2] = t1;\r\n        target.traits[index1] = t2;\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Randomisation\r\n\r\n    public static spliceMonsters(target: Monster, monsters: Monster[]) {\r\n        const fields = [\r\n            'size',\r\n            'category',\r\n            'tag',\r\n            'alignment',\r\n            'challenge',\r\n            'speed',\r\n            'senses',\r\n            'languages',\r\n            'equipment',\r\n            'abilityScores.str',\r\n            'abilityScores.dex',\r\n            'abilityScores.con',\r\n            'abilityScores.int',\r\n            'abilityScores.wis',\r\n            'abilityScores.cha',\r\n            'savingThrows',\r\n            'skills',\r\n            'ac',\r\n            'hitDice',\r\n            'damage.resist',\r\n            'damage.vulnerable',\r\n            'damage.immune',\r\n            'conditionImmunities'\r\n        ];\r\n        fields.forEach(field => {\r\n            this.setRandomValue(target, field, monsters);\r\n        });\r\n\r\n        target.traits = [];\r\n\r\n        TRAIT_TYPES.forEach(type => {\r\n            // Get all traits of this type\r\n            const traits: Trait[] = [];\r\n            monsters.forEach(m => {\r\n                m.traits.filter(t => t.type === type)\r\n                    .forEach(t => traits.push(t));\r\n            });\r\n\r\n            // Collate by name\r\n            const distinct: { trait: Trait, count: number }[] = [];\r\n            traits.forEach(t => {\r\n                const current = distinct.find(d => d.trait.name === t.name);\r\n                if (current) {\r\n                    current.count += 1;\r\n                } else {\r\n                    distinct.push({\r\n                        trait: t,\r\n                        count: 1\r\n                    });\r\n                }\r\n            });\r\n\r\n            // If any are common to all monsters, copy them and remove from the candidates\r\n            const addedIDs: string[] = [];\r\n            distinct.filter(d => d.count === monsters.length)\r\n                .forEach(d => {\r\n                    this.copyTrait(target, d.trait);\r\n                    addedIDs.push(d.trait.id);\r\n                });\r\n            addedIDs.forEach(id => {\r\n                const index = distinct.findIndex(d => d.trait.id === id);\r\n                distinct.splice(index, 1);\r\n            });\r\n\r\n            const avg = traits.length / monsters.length;\r\n            while (target.traits.filter(t => t.type === type).length < avg) {\r\n                const index = Math.floor(Math.random() * distinct.length);\r\n                const t = distinct[index].trait;\r\n                this.copyTrait(target, t);\r\n                distinct.splice(index, 1);\r\n            }\r\n        });\r\n    }\r\n\r\n    public static setRandomValue(target: Monster, field: string, monsters: Monster[]) {\r\n        const index = Math.floor(Math.random() * monsters.length);\r\n        const m = monsters[index];\r\n\r\n        let source: any = m;\r\n        let value = null;\r\n        const tokens = field.split('.');\r\n        tokens.forEach(token => {\r\n            if (token === tokens[tokens.length - 1]) {\r\n                value = source[token];\r\n            } else {\r\n                source = source[token];\r\n            }\r\n        });\r\n\r\n        this.changeValue(target, field, value);\r\n    }\r\n\r\n    public static addRandomTrait(target: Monster, type: string, monsters: Monster[]) {\r\n        const traits: Trait[] = [];\r\n        monsters.forEach(m => {\r\n            m.traits.filter(t => t.type === type)\r\n                .forEach(t => {\r\n                    traits.push(t);\r\n                });\r\n        });\r\n\r\n        const index = Math.floor(Math.random() * traits.length);\r\n        const trait = traits[index];\r\n\r\n        this.copyTrait(target, trait);\r\n    }\r\n}\r\n","import Factory from './factory';\r\nimport Utils from './utils';\r\n\r\nimport { Combat, Combatant } from '../models/combat';\r\nimport { Map } from '../models/map-folio';\r\n\r\nexport default class Mercator {\r\n    public static scatterCombatants(combat: Combat, type: 'pc' | 'monster') {\r\n        if (!combat.map) {\r\n            return;\r\n        }\r\n\r\n        // Remove all monsters from the map\r\n        combat.map.items = combat.map.items.filter(item => item.type !== type);\r\n\r\n        // Find map dimensions\r\n        const tiles = combat.map.items.filter(item => item.type === 'tile');\r\n        if (tiles.length > 0) {\r\n            const dimensions = Mercator.mapDimensions(combat.map);\r\n            if (dimensions) {\r\n                const monsters = combat.combatants.filter(combatant => combatant.type === type);\r\n                monsters.forEach(combatant => {\r\n                    const candidateSquares: {x: number, y: number}[] = [];\r\n\r\n                    // Find all squares that we could add this monster to\r\n                    for (let x = dimensions.minX; x <= dimensions.maxX; ++x) {\r\n                        for (let y = dimensions.minY; y <= dimensions.maxY; ++y) {\r\n                            // Could we add this monster to this square?\r\n                            const canAddHere = Mercator.canAddMonsterHere(combat.map as Map, combatant, x, y);\r\n                            if (canAddHere) {\r\n                                candidateSquares.push({x: x, y: y});\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if ((candidateSquares.length > 0) && combat.map) {\r\n                        const index = Math.floor(Math.random() * candidateSquares.length);\r\n                        const square = candidateSquares[index];\r\n                        const size = Utils.miniSize(combatant.displaySize);\r\n\r\n                        const item = Factory.createMapItem();\r\n                        item.id = combatant.id;\r\n                        item.type = type;\r\n                        item.x = square.x;\r\n                        item.y = square.y;\r\n                        item.height = size;\r\n                        item.width = size;\r\n                        combat.map.items.push(item);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private static mapDimensions(map: Map) {\r\n        const tiles = map.items.filter(item => item.type === 'tile');\r\n        if (tiles.length > 0) {\r\n            let minX: number = tiles[0].x;\r\n            let minY: number = tiles[0].y;\r\n            let maxX: number = tiles[0].x + tiles[0].width - 1;\r\n            let maxY: number = tiles[0].y + tiles[0].height - 1;\r\n            tiles.forEach(tile => {\r\n                minX = Math.min(minX, tile.x);\r\n                minY = Math.min(minY, tile.y);\r\n                maxX = Math.max(maxX, tile.x + tile.width - 1);\r\n                maxY = Math.max(maxY, tile.y + tile.height - 1);\r\n            });\r\n\r\n            return {\r\n                minX: minX,\r\n                minY: minY,\r\n                maxX: maxX,\r\n                maxY: maxY\r\n            };\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    private static canAddMonsterHere(map: Map, combatant: Combatant, x: number, y: number) {\r\n        const coveredSquares: boolean[] = [];\r\n\r\n        const size = Utils.miniSize(combatant.displaySize);\r\n        const right = x + Math.max(1, size) - 1;\r\n        const bottom = y + Math.max(1, size) - 1;\r\n        for (let x1 = x; x1 <= right; ++x1) {\r\n            for (let y1 = y; y1 <= bottom; ++y1) {\r\n                // Is this square on an empty tile?\r\n                const occupants = Mercator.itemsAt(map as Map, x1, y1);\r\n                const canOccupy = (occupants.length > 0) && occupants.every(item => item.type === 'tile');\r\n                coveredSquares.push(canOccupy);\r\n            }\r\n        }\r\n\r\n        return coveredSquares.every(square => square);\r\n    }\r\n\r\n    private static itemsAt(map: Map, x: number, y: number) {\r\n        return map.items.filter(item => {\r\n            const left = item.x;\r\n            const right = item.x + item.width - 1;\r\n            const top = item.y;\r\n            const bottom = item.y + item.height - 1;\r\n            return (x >= left) && (x <= right) && (y >= top) && (y <= bottom);\r\n        });\r\n    }\r\n\r\n    public static rotateMap(map: Map) {\r\n        map.items.forEach(item => {\r\n            const newX = (item.y + item.height - 1) * -1;\r\n            const newY = item.x;\r\n            const newWidth = item.height;\r\n            const newHeight = item.width;\r\n\r\n            item.x = newX;\r\n            item.y = newY;\r\n            item.width = newWidth;\r\n            item.height = newHeight;\r\n        });\r\n    }\r\n}\r\n","import Factory from './factory';\r\nimport Utils from './utils';\r\n\r\nimport { Encounter, EncounterSlot, MonsterFilter } from '../models/encounter';\r\nimport { Monster, MonsterGroup } from '../models/monster-group';\r\n\r\nexport default class Napoleon {\r\n    public static getMonsterCount(encounter: Encounter) {\r\n        let count = 0;\r\n\r\n        let slots: EncounterSlot[] = [];\r\n        slots = slots.concat(encounter.slots);\r\n        encounter.waves.forEach(wave => {\r\n            slots = slots.concat(wave.slots);\r\n        });\r\n\r\n        slots.forEach(slot => {\r\n            count += slot.count;\r\n        });\r\n\r\n        return count;\r\n    }\r\n\r\n    public static getEncounterXP(encounter: Encounter, getMonster: (monsterName: string, groupName: string) => Monster | null) {\r\n        let xp = 0;\r\n\r\n        let slots: EncounterSlot[] = [];\r\n        slots = slots.concat(encounter.slots);\r\n        encounter.waves.forEach(wave => {\r\n            slots = slots.concat(wave.slots);\r\n        });\r\n\r\n        slots.forEach(slot => {\r\n            const monster = getMonster(slot.monsterName, slot.monsterGroupName);\r\n            if (monster) {\r\n                xp += Utils.experience(monster.challenge) * slot.count;\r\n            }\r\n        });\r\n\r\n        return xp;\r\n    }\r\n\r\n    public static getAdjustedEncounterXP(encounter: Encounter, getMonster: (monsterName: string, groupName: string) => Monster | null) {\r\n        let count = 0;\r\n        let xp = 0;\r\n\r\n        let slots: EncounterSlot[] = [];\r\n        slots = slots.concat(encounter.slots);\r\n        encounter.waves.forEach(wave => {\r\n            slots = slots.concat(wave.slots);\r\n        });\r\n\r\n        slots.forEach(slot => {\r\n            count += slot.count;\r\n            const monster = getMonster(slot.monsterName, slot.monsterGroupName);\r\n            if (monster) {\r\n                xp += Utils.experience(monster.challenge) * slot.count;\r\n            }\r\n        });\r\n\r\n        return xp * Utils.experienceFactor(count);\r\n    }\r\n\r\n    public static getFilterDescription(filter: MonsterFilter) {\r\n        let summary = '';\r\n        if (filter.size !== 'all sizes') {\r\n            summary += summary ? ' ' + filter.size : filter.size;\r\n        }\r\n        if (filter.category !== 'all types') {\r\n            summary += summary ? ' ' + filter.category : filter.category;\r\n        }\r\n        const min = Utils.challenge(filter.challengeMin);\r\n        const max = Utils.challenge(filter.challengeMax);\r\n        const cr =  (filter.challengeMin === filter.challengeMax) ? min : min + ' to ' + max;\r\n        summary += ' monsters of cr ' + cr;\r\n        return summary;\r\n    }\r\n\r\n    public static buildEncounter(\r\n        encounter: Encounter, xp: number, filter: MonsterFilter, groups: MonsterGroup[],\r\n        getMonster: (monsterName: string, groupName: string) => Monster | null) {\r\n\r\n        while (Napoleon.getAdjustedEncounterXP(encounter, (monsterName, groupName) => getMonster(monsterName, groupName)) <= xp) {\r\n            if ((encounter.slots.length > 0) && (Utils.dieRoll(3) > 1)) {\r\n                // Increment a slot\r\n                const index = Math.floor(Math.random() * encounter.slots.length);\r\n                const slot = encounter.slots[index];\r\n                slot.count += 1;\r\n            } else {\r\n                // Pick a new monster\r\n                const candidates: { groupName: string, monsterName: string }[] = [];\r\n                groups.forEach(group => {\r\n                    group.monsters\r\n                        .filter(monster => Napoleon.matchMonster(monster, filter))\r\n                        .filter(monster => !encounter.slots.find(slot => (slot.monsterGroupName === group.name) && (slot.monsterName === monster.name)))\r\n                        .forEach(monster => candidates.push({groupName: group.name, monsterName: monster.name}));\r\n                });\r\n                if (candidates.length > 0) {\r\n                    const index = Math.floor(Math.random() * candidates.length);\r\n                    const slot = Factory.createEncounterSlot();\r\n                    slot.monsterGroupName = candidates[index].groupName;\r\n                    slot.monsterName = candidates[index].monsterName;\r\n                    encounter.slots.push(slot);\r\n                } else {\r\n                    if (encounter.slots.length === 0) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Split into waves\r\n        while ((encounter.slots.length > 1) && (Utils.dieRoll(10) === 10)) {\r\n            const index = Math.floor(Math.random() * encounter.slots.length);\r\n            const slot = encounter.slots[index];\r\n            encounter.slots = encounter.slots.filter(s => s.id !== slot.id);\r\n            const wave = Factory.createEncounterWave();\r\n            wave.name = 'wave ' + (encounter.waves.length + 2);\r\n            wave.slots.push(slot);\r\n            encounter.waves.push(wave);\r\n        }\r\n    }\r\n\r\n    public static matchMonster(monster: Monster, filter: MonsterFilter) {\r\n        if (monster.challenge < filter.challengeMin) {\r\n            return false;\r\n        }\r\n\r\n        if (monster.challenge > filter.challengeMax) {\r\n            return false;\r\n        }\r\n\r\n        if (filter.name !== '') {\r\n            if (!Utils.match(filter.name, monster.name)) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (filter.category !== 'all types') {\r\n            if (monster.category !== filter.category) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (filter.size !== 'all sizes') {\r\n            if (monster.size !== filter.size) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { Condition } from './condition';\r\nimport { Map } from './map-folio';\r\nimport { Monster, Trait } from './monster-group';\r\nimport { PC } from './party';\r\n\r\nexport interface CombatSetup {\r\n    partyID: string | null;\r\n    encounterID: string | null;\r\n    waveID: string | null;\r\n    folioID: string | null;\r\n    mapID: string | null;\r\n    monsterNames: { id: string, names: string[] }[];\r\n    encounterInitMode: 'manual' | 'individual' | 'group';\r\n}\r\n\r\nexport interface Combat {\r\n    id: string;\r\n    name: string;\r\n    encounterID: string | null;\r\n    combatants: ((Combatant & PC) | (Combatant & Monster))[];\r\n    map: Map | null;\r\n    round: number;\r\n    notifications: Notification[];\r\n    issues: string[];\r\n    timestamp: string | null;\r\n}\r\n\r\nexport interface Combatant {\r\n    id: string;\r\n    displayName: string;\r\n    displaySize: string;\r\n    showOnMap: boolean;\r\n    current: boolean;\r\n    pending: boolean;\r\n    active: boolean;\r\n    defeated: boolean;\r\n    initiative: number | null;\r\n    hp: number | null;\r\n    conditions: Condition[];\r\n    tags: string[];\r\n    altitude: number;\r\n    aura: {\r\n        radius: number;\r\n        style: 'square' | 'rounded' | 'circle';\r\n        color: string;\r\n    };\r\n}\r\n\r\nexport interface Notification {\r\n    id: string;\r\n    type: 'condition-save' | 'condition-end' | 'trait-recharge';\r\n    data: Condition | Trait | null;\r\n    combatant: (Combatant & Monster) | null;\r\n}\r\n\r\nexport const COMBAT_TAGS = [\r\n    'conc',\r\n    'bane',\r\n    'bless',\r\n    'hex'\r\n];\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    label: string;\r\n    display: 'switch' | 'button';\r\n    checked: boolean;\r\n    changeValue: (value: boolean) => void;\r\n    disabled: boolean;\r\n}\r\n\r\nexport default class Checkbox extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        display: 'switch',\r\n        disabled: false\r\n    };\r\n\r\n    private click(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        this.props.changeValue(!this.props.checked);\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let style = 'checkbox ' + this.props.display;\r\n            if (this.props.checked) {\r\n                style += ' checked';\r\n            }\r\n            if (this.props.disabled) {\r\n                style += ' disabled';\r\n            }\r\n\r\n            let toggle = null;\r\n            if (this.props.display === 'switch') {\r\n                toggle = (\r\n                    <div className='toggle-container'>\r\n                        <div className='toggle'/>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className={style} onClick={e => this.click(e)}>\r\n                    <div className='checkbox-label'>{this.props.label}</div>\r\n                    {toggle}\r\n                </div>\r\n            );\r\n\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport warning from '../../resources/icons/warning.svg';\r\n\r\ninterface Props {\r\n    text: string;\r\n    callback: () => void;\r\n    details: string;\r\n    disabled: boolean;\r\n}\r\n\r\ninterface State {\r\n    pressed: boolean;\r\n}\r\n\r\nexport default class ConfirmButton extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        details: null,\r\n        disabled: false\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            pressed: false\r\n        };\r\n    }\r\n\r\n    private toggle() {\r\n        this.setState({\r\n            pressed: !this.state.pressed\r\n        });\r\n    }\r\n\r\n    private perform() {\r\n        this.toggle();\r\n        this.props.callback();\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let content = null;\r\n            if (this.state.pressed) {\r\n                content = (\r\n                    <div>\r\n                        <div className='title'>{this.props.text} - are you sure?</div>\r\n                        <img className='image' src={warning} alt='warning' />\r\n                        {this.props.details ? <div className='details'>{this.props.details}</div> : null}\r\n                        <div className='confirmation'>\r\n                            <div className='destructive' onClick={() => this.perform()}>yes</div>\r\n                            <div className='non-destructive' onClick={() => this.toggle()}>no</div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            } else {\r\n                content = (\r\n                    <div>\r\n                        <div className='title'>{this.props.text}</div>\r\n                        <img className='image' src={warning} alt='warning' />\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <button className={this.props.disabled ? 'disabled' : ''} onClick={() => this.toggle()}>\r\n                    {content}\r\n                </button>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    controls: JSX.Element[];\r\n    disabled: boolean;\r\n}\r\n\r\nexport default class ControlRow extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        disabled: false\r\n    };\r\n\r\n    public render() {\r\n        try {\r\n            let style = 'control-row';\r\n            if (this.props.disabled) {\r\n                style += ' disabled';\r\n            }\r\n            switch (this.props.controls.length) {\r\n                case 1:\r\n                    style += ' one';\r\n                    break;\r\n                case 2:\r\n                    style += ' two';\r\n                    break;\r\n                case 3:\r\n                    style += ' three';\r\n                    break;\r\n                case 4:\r\n                    style += ' four';\r\n                    break;\r\n                case 5:\r\n                    style += ' five';\r\n                    break;\r\n            }\r\n\r\n            return (\r\n                <div className={style}>\r\n                    {this.props.controls}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport ellipsis from '../../resources/icons/ellipsis.svg';\r\nimport clear from '../../resources/icons/x.svg';\r\n\r\ninterface Props {\r\n    options: { id: string; text: string; disabled?: boolean }[];\r\n    select: (optionID: string) => void;\r\n    clear: () => void;\r\n    selectedID: string;\r\n    placeholder: string;\r\n    disabled: boolean;\r\n}\r\n\r\ninterface State {\r\n    open: boolean;\r\n}\r\n\r\nexport default class Dropdown extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        selectedID: null,\r\n        placeholder: 'select...',\r\n        disabled: false,\r\n        clear: null\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            open: false\r\n        };\r\n    }\r\n\r\n    private toggleOpen(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        this.setState({\r\n            open: !this.state.open\r\n        });\r\n    }\r\n\r\n    private select(optionID: string) {\r\n        this.setState({\r\n            open: false\r\n        });\r\n        this.props.select(optionID);\r\n    }\r\n\r\n    private clear(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        this.props.clear();\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            if (this.props.options.length === 0) {\r\n                return null;\r\n            }\r\n\r\n            let style = this.props.disabled ? 'dropdown disabled' : 'dropdown';\r\n            const content = [];\r\n\r\n            let option: { id: string; text: string; disabled?: boolean } | undefined;\r\n            if (this.props.selectedID) {\r\n                option = this.props.options.find(o => o.id === this.props.selectedID);\r\n            }\r\n\r\n            content.push(\r\n                <div key='selection' className='dropdown-top' title={option ? option.text : this.props.placeholder}>\r\n                    <div className='item-text'>{option ? option.text : this.props.placeholder}</div>\r\n                    <img\r\n                        className={option && this.props.clear ? 'clear' : 'arrow'}\r\n                        alt={option && this.props.clear ? 'clear' : 'arrow'}\r\n                        src={option && this.props.clear ? clear : ellipsis}\r\n                        onClick={e => option && this.props.clear ? this.clear(e) : null}\r\n                    />\r\n                </div>\r\n            );\r\n\r\n            if (this.state.open) {\r\n                style += ' open';\r\n\r\n                const items = this.props.options.map(o => {\r\n                    if (o.text === null) {\r\n                        return <div key={o.id} className='divider' />;\r\n                    } else {\r\n                        return (\r\n                            <DropdownOption\r\n                                key={o.id}\r\n                                option={o}\r\n                                selected={o.id === this.props.selectedID}\r\n                                select={optionID => this.select(optionID)}\r\n                            />\r\n                        );\r\n                    }\r\n                });\r\n\r\n                content.push(\r\n                    <div key='options' className='dropdown-options'>\r\n                        {items}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className={style} onClick={e => this.toggleOpen(e)}>\r\n                    {content}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\r\ninterface DropdownOptionProps {\r\n    option: { id: string; text: string; disabled?: boolean };\r\n    selected: boolean;\r\n    select: (optionID: string) => void;\r\n}\r\n\r\nclass DropdownOption extends React.Component<DropdownOptionProps> {\r\n    private click(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        if (!this.props.option.disabled) {\r\n            this.props.select(this.props.option.id);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let style = 'dropdown-option';\r\n            if (this.props.selected) {\r\n                style += ' selected';\r\n            }\r\n            if (this.props.option.disabled) {\r\n                style += ' disabled';\r\n            }\r\n\r\n            return (\r\n                <div className={style} title={this.props.option.text} onClick={e => this.click(e)}>\r\n                    {this.props.option.text}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport arrow from '../../resources/icons/down-arrow-black.svg';\r\n\r\ninterface Props {\r\n    text: string;\r\n    content: string | JSX.Element;\r\n    disabled: boolean;\r\n}\r\n\r\ninterface State {\r\n    expanded: boolean;\r\n}\r\n\r\nexport default class Expander extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        disabled: false\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            expanded: false\r\n        };\r\n    }\r\n\r\n    private toggle() {\r\n        this.setState({\r\n            expanded: !this.state.expanded\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let style = this.props.disabled ? 'expander disabled' : 'expander';\r\n            if (this.state.expanded) {\r\n                style += ' expanded';\r\n            }\r\n\r\n            let content = null;\r\n            if (this.state.expanded) {\r\n                content = (\r\n                    <div className='expander-content'>\r\n                        {this.props.content}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className={style}>\r\n                    <div className='expander-header' onClick={() => this.toggle()}>\r\n                        <div className='expander-text'>{this.props.text}</div>\r\n                        <img className='expander-button' src={arrow} alt='arrow' />\r\n                    </div>\r\n                    {content}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    click: (dir: string, dir2: 'in' | 'out' | null) => void;\r\n    direction: 'out' | 'in' | 'both' | 'eight';\r\n    disabled: boolean;\r\n}\r\n\r\nexport default class Radial extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        direction: 'out',\r\n        disabled: false\r\n    };\r\n\r\n    private click(e: React.MouseEvent, dir: string, dir2: 'in' | 'out' | null = null) {\r\n        e.stopPropagation();\r\n        this.props.click(dir, dir2);\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let style = 'radial ' + (this.props.direction || 'out');\r\n            if (this.props.disabled) {\r\n                style += ' disabled';\r\n            }\r\n\r\n            const showOut = (this.props.direction === 'out') || (this.props.direction === 'both') || (this.props.direction === 'eight');\r\n            const showIn = (this.props.direction === 'in') || (this.props.direction === 'both');\r\n            const showDiag = (this.props.direction === 'eight');\r\n\r\n            return (\r\n                <div className={style}>\r\n                    <div className='cell' style={{ display: showDiag ? 'none' : 'inline-block' }} />\r\n                    <div className='cell' style={{ display: showDiag ? 'inline-block' : 'none' }}>\r\n                        <div className='arrow diag' style={{ display: showOut ? 'block' : 'none' }} onClick={e => this.click(e, 'NW')}>\r\n                            &#8598;\r\n                        </div>\r\n                    </div>\r\n                    <div className='cell'>\r\n                        <div className='arrow vertical' style={{ display: showOut ? 'block' : 'none' }} onClick={e => this.click(e, 'N', 'out')}>\r\n                            &#8593;\r\n                        </div>\r\n                        <div className='arrow vertical' style={{ display: showIn ? 'block' : 'none' }} onClick={e => this.click(e, 'N', 'in')}>\r\n                            &#8595;\r\n                        </div>\r\n                    </div>\r\n                    <div className='cell' style={{ display: showDiag ? 'none' : 'inline-block' }} />\r\n                    <div className='cell' style={{ display: showDiag ? 'inline-block' : 'none' }}>\r\n                        <div className='arrow diag' style={{ display: showOut ? 'block' : 'none' }} onClick={e => this.click(e, 'NE')}>\r\n                            &#8599;\r\n                        </div>\r\n                    </div>\r\n                    <div className='cell'>\r\n                        <div className='arrow horizontal' style={{ display: showOut ? 'inline-block' : 'none' }} onClick={e => this.click(e, 'W', 'out')}>\r\n                            &#8592;\r\n                        </div>\r\n                        <div className='arrow horizontal' style={{ display: showIn ? 'inline-block' : 'none' }} onClick={e => this.click(e, 'W', 'in')}>\r\n                            &#8594;\r\n                        </div>\r\n                    </div>\r\n                    <div className='cell' />\r\n                    <div className='cell'>\r\n                        <div className='arrow horizontal' style={{ display: showIn ? 'inline-block' : 'none' }} onClick={e => this.click(e, 'E', 'in')}>\r\n                            &#8592;\r\n                        </div>\r\n                        <div className='arrow horizontal' style={{ display: showOut ? 'inline-block' : 'none' }} onClick={e => this.click(e, 'E', 'out')}>\r\n                            &#8594;\r\n                        </div>\r\n                    </div>\r\n                    <div className='cell' style={{ display: showDiag ? 'none' : 'inline-block' }} />\r\n                    <div className='cell' style={{ display: showDiag ? 'inline-block' : 'none' }}>\r\n                        <div className='arrow diag' style={{ display: showOut ? 'block' : 'none' }} onClick={e => this.click(e, 'SW')}>\r\n                            &#8601;\r\n                        </div>\r\n                    </div>\r\n                    <div className='cell'>\r\n                        <div className='arrow vertical' style={{ display: showIn ? 'block' : 'none' }} onClick={e => this.click(e, 'S', 'in')}>\r\n                            &#8593;\r\n                        </div>\r\n                        <div className='arrow vertical' style={{ display: showOut ? 'block' : 'none' }} onClick={e => this.click(e, 'S', 'out')}>\r\n                            &#8595;\r\n                        </div>\r\n                    </div>\r\n                    <div className='cell' style={{ display: showDiag ? 'none' : 'inline-block' }} />\r\n                    <div className='cell' style={{ display: showDiag ? 'inline-block' : 'none' }}>\r\n                        <div className='arrow diag' style={{ display: showOut ? 'block' : 'none' }} onClick={e => this.click(e, 'SE', 'out')}>\r\n                            &#8600;\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    options: { id: string; text: string; disabled?: boolean }[];\r\n    selectedID: string | null;\r\n    select: (optionID: string) => void;\r\n    tabs: boolean;\r\n    disabled: boolean;\r\n    itemsPerRow: number;\r\n}\r\n\r\nexport default class Selector extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        tabs: false,\r\n        disabled: false,\r\n        itemsPerRow: null\r\n    };\r\n\r\n    public render() {\r\n        try {\r\n            let style = this.props.tabs ? 'selector tabs' : 'selector radio';\r\n            if (this.props.disabled) {\r\n                style += ' disabled';\r\n            }\r\n\r\n            const itemsPerRow = this.props.itemsPerRow ? this.props.itemsPerRow : this.props.options.length;\r\n            const rowCount = Math.ceil(this.props.options.length / itemsPerRow);\r\n            const rowContents: JSX.Element[][] = [];\r\n            for (let n = 0; n !== rowCount; ++n) {\r\n                rowContents.push([]);\r\n            }\r\n\r\n            this.props.options.forEach(option => {\r\n                const index = this.props.options.indexOf(option);\r\n                const rowIndex = Math.floor(index / itemsPerRow);\r\n                const row = rowContents[rowIndex];\r\n                row.push(\r\n                    <SelectorOption\r\n                        key={option.id}\r\n                        option={option}\r\n                        selected={option.id === this.props.selectedID}\r\n                        count={itemsPerRow}\r\n                        select={(optionID: string) => this.props.select(optionID)}\r\n                    />\r\n                );\r\n            });\r\n\r\n            const rowSections = rowContents.map(row => {\r\n                const index = rowContents.indexOf(row);\r\n                return <div key={index}>{row}</div>;\r\n            });\r\n\r\n            return (\r\n                <div className={style}>\r\n                    {rowSections}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\r\ninterface SelectorOptionInterface {\r\n    option: { id: string; text: string; disabled?: boolean };\r\n    selected: boolean;\r\n    count: number;\r\n    select: (optionID: string) => void;\r\n}\r\n\r\nclass SelectorOption extends React.Component<SelectorOptionInterface> {\r\n    private click(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        if (!this.props.option.disabled) {\r\n            this.props.select(this.props.option.id);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const width = 'calc(((100% - 1px) / ' + this.props.count + ') - 2px )';\r\n\r\n            let style = 'option';\r\n            if (this.props.selected) {\r\n                style += ' selected';\r\n            }\r\n            if (this.props.option.disabled) {\r\n                style += ' disabled';\r\n            }\r\n\r\n            return (\r\n                <div key={this.props.option.id} className={style} style={{ width: width }} title={this.props.option.text} onClick={e => this.click(e)}>\r\n                    {this.props.option.text}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    source: any;\r\n    name: string;\r\n    nudgeValue: (delta: number) => void;\r\n    label: string;\r\n    disabled: boolean;\r\n    factors: number[];\r\n    display: ((value: number) => string) | null;\r\n}\r\n\r\nexport default class Spin extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        label: null,\r\n        disabled: false,\r\n        factors: null,\r\n        display: null\r\n    };\r\n\r\n    private click(e: React.MouseEvent, delta: number) {\r\n        e.stopPropagation();\r\n        this.props.nudgeValue(delta);\r\n    }\r\n\r\n    private touchEnd(e: React.TouchEvent, delta: number) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        this.props.nudgeValue(delta);\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let style = 'info-value';\r\n            let value = this.props.source[this.props.name];\r\n            if (value === 0) {\r\n                style += ' dimmed';\r\n            }\r\n\r\n            if (this.props.display) {\r\n                value = this.props.display(value);\r\n            }\r\n\r\n            const minusBtns: JSX.Element[] = [];\r\n            const plusBtns: JSX.Element[] = [];\r\n\r\n            const factors = this.props.factors || [1];\r\n            factors.forEach(factor => {\r\n                minusBtns.push(\r\n                    <div\r\n                        key={'minus' + factor}\r\n                        className={factors.length > 1 ? 'spin-button factor' : 'spin-button factor single'}\r\n                        onTouchEnd={e => this.touchEnd(e, -1 * factor)}\r\n                        onClick={e => this.click(e, -1 * factor)}\r\n                    >\r\n                        {factors.length > 1 ? '-' + factor : '-'}\r\n                    </div>\r\n                );\r\n\r\n                plusBtns.push(\r\n                    <div\r\n                        key={'plus' + factor}\r\n                        className={factors.length > 1 ? 'spin-button factor' : 'spin-button factor single'}\r\n                        onTouchEnd={e => this.touchEnd(e, +1 * factor)}\r\n                        onClick={e => this.click(e, +1 * factor)}\r\n                    >\r\n                        {factors.length > 1 ? '+' + factor : '+'}\r\n                    </div>\r\n                );\r\n            });\r\n\r\n            minusBtns.reverse();\r\n\r\n            return (\r\n                <div className={this.props.disabled ? 'spin disabled' : 'spin'}>\r\n                    <div className='minus'>\r\n                        {minusBtns}\r\n                    </div>\r\n                    <div className='info' style={{ width: 'calc(100% - ' + (80 * factors.length) + 'px)' }}>\r\n                        <div className='info-label'>{this.props.label}</div>\r\n                        <div className={style}>{value}</div>\r\n                    </div>\r\n                    <div className='plus'>\r\n                        {plusBtns}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Monster } from '../../models/monster-group';\r\n\r\nimport Spin from '../controls/spin';\r\n\r\ninterface Props {\r\n    combatant: Monster;\r\n    edit: boolean;\r\n    nudgeValue: (combatant: Monster, field: string, delta: number) => void;\r\n}\r\n\r\ninterface State {\r\n    showAbilityScores: boolean;\r\n}\r\n\r\nexport default class AbilityScorePanel extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        edit: null,\r\n        nudgeValue: null\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            showAbilityScores: false\r\n        };\r\n    }\r\n\r\n    private toggleAbilityScores() {\r\n        this.setState({\r\n            showAbilityScores: !this.state.showAbilityScores\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let result = null;\r\n\r\n            if (this.props.edit) {\r\n                result = (\r\n                    <div>\r\n                        <Spin\r\n                            source={this.props.combatant.abilityScores}\r\n                            name='str'\r\n                            label='strength'\r\n                            nudgeValue={(delta: number) => this.props.nudgeValue(this.props.combatant, 'abilityScores.str', delta)}\r\n                        />\r\n                        <Spin\r\n                            source={this.props.combatant.abilityScores}\r\n                            name='dex'\r\n                            label='dexterity'\r\n                            nudgeValue={(delta: number) => this.props.nudgeValue(this.props.combatant, 'abilityScores.dex', delta)}\r\n                        />\r\n                        <Spin\r\n                            source={this.props.combatant.abilityScores}\r\n                            name='con'\r\n                            label='constitution'\r\n                            nudgeValue={(delta: number) => this.props.nudgeValue(this.props.combatant, 'abilityScores.con', delta)}\r\n                        />\r\n                        <Spin\r\n                            source={this.props.combatant.abilityScores}\r\n                            name='int'\r\n                            label='intelligence'\r\n                            nudgeValue={(delta: number) => this.props.nudgeValue(this.props.combatant, 'abilityScores.int', delta)}\r\n                        />\r\n                        <Spin\r\n                            source={this.props.combatant.abilityScores}\r\n                            name='wis'\r\n                            label='wisdom'\r\n                            nudgeValue={(delta: number) => this.props.nudgeValue(this.props.combatant, 'abilityScores.wis', delta)}\r\n                        />\r\n                        <Spin\r\n                            source={this.props.combatant.abilityScores}\r\n                            name='cha'\r\n                            label='charisma'\r\n                            nudgeValue={(delta: number) => this.props.nudgeValue(this.props.combatant, 'abilityScores.cha', delta)}\r\n                        />\r\n                    </div>\r\n                );\r\n            } else {\r\n                result = (\r\n                    <div className='ability-scores' onClick={() => this.toggleAbilityScores()}>\r\n                        <div className='ability-score'>\r\n                            <div className='ability-heading'>str</div>\r\n                            <div className='ability-value'>\r\n                                {\r\n                                    this.state.showAbilityScores\r\n                                    ? this.props.combatant.abilityScores.str\r\n                                    : Utils.modifier(this.props.combatant.abilityScores.str)\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                        <div className='ability-score'>\r\n                            <div className='ability-heading'>dex</div>\r\n                            <div className='ability-value'>\r\n                                {\r\n                                    this.state.showAbilityScores\r\n                                    ? this.props.combatant.abilityScores.dex\r\n                                    : Utils.modifier(this.props.combatant.abilityScores.dex)\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                        <div className='ability-score'>\r\n                            <div className='ability-heading'>con</div>\r\n                            <div className='ability-value'>\r\n                                {\r\n                                    this.state.showAbilityScores\r\n                                    ? this.props.combatant.abilityScores.con\r\n                                    : Utils.modifier(this.props.combatant.abilityScores.con)\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                        <div className='ability-score'>\r\n                            <div className='ability-heading'>int</div>\r\n                            <div className='ability-value'>\r\n                                {\r\n                                    this.state.showAbilityScores\r\n                                    ? this.props.combatant.abilityScores.int\r\n                                    : Utils.modifier(this.props.combatant.abilityScores.int)\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                        <div className='ability-score'>\r\n                            <div className='ability-heading'>wis</div>\r\n                            <div className='ability-value'>\r\n                                {\r\n                                    this.state.showAbilityScores\r\n                                    ? this.props.combatant.abilityScores.wis\r\n                                    : Utils.modifier(this.props.combatant.abilityScores.wis)\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                        <div className='ability-score'>\r\n                            <div className='ability-heading'>cha</div>\r\n                            <div className='ability-value'>\r\n                                {\r\n                                    this.state.showAbilityScores\r\n                                    ? this.props.combatant.abilityScores.cha\r\n                                    : Utils.modifier(this.props.combatant.abilityScores.cha)\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return result;\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Combat, Combatant } from '../../models/combat';\r\nimport { Condition } from '../../models/condition';\r\n\r\nimport Expander from '../controls/expander';\r\nimport Spin from '../controls/spin';\r\n\r\ninterface Props {\r\n    combatant: Combatant;\r\n    combat: Combat;\r\n    nudgeConditionValue: (condition: Condition, field: string, delta: number) => void;\r\n    addCondition: () => void;\r\n    editCondition: (condition: Condition) => void;\r\n    removeCondition: (conditionID: string) => void;\r\n}\r\n\r\nexport default class ConditionsPanel extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const conditions = [];\r\n            if (this.props.combatant.conditions) {\r\n                for (let n = 0; n !== this.props.combatant.conditions.length; ++n) {\r\n                    const c = this.props.combatant.conditions[n];\r\n                    conditions.push(\r\n                        <ConditionPanel\r\n                            key={n}\r\n                            condition={c}\r\n                            combat={this.props.combat}\r\n                            nudgeConditionValue={(condition, type, delta) => this.props.nudgeConditionValue(condition, type, delta)}\r\n                            editCondition={condition => this.props.editCondition(condition)}\r\n                            removeCondition={conditionID => this.props.removeCondition(conditionID)}\r\n                        />\r\n                    );\r\n                }\r\n            }\r\n\r\n            return (\r\n                <div className='section'>\r\n                    {conditions}\r\n                    <button onClick={() => this.props.addCondition()}>add a condition</button>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface ConditionPanelProps {\r\n    condition: Condition;\r\n    combat: Combat;\r\n    nudgeConditionValue: (condition: Condition, field: string, delta: number) => void;\r\n    editCondition: (condition: Condition) => void;\r\n    removeCondition: (conditionID: string) => void;\r\n}\r\n\r\nclass ConditionPanel extends React.Component<ConditionPanelProps> {\r\n    public render() {\r\n        try {\r\n            let name: string = this.props.condition.name || 'condition';\r\n            if (this.props.condition.name === 'exhaustion') {\r\n                name += ' (' + this.props.condition.level + ')';\r\n            }\r\n            if ((this.props.condition.name === 'custom') && (this.props.condition.text !== null)) {\r\n                name = this.props.condition.text;\r\n            }\r\n\r\n            if (this.props.condition.duration !== null) {\r\n                name += ' ' + Utils.conditionDurationText(this.props.condition, this.props.combat);\r\n            }\r\n\r\n            const description = [];\r\n            if (this.props.condition.name === 'exhaustion') {\r\n                description.push(\r\n                    <div key='level' className='section'>\r\n                        <Spin\r\n                            source={this.props.condition}\r\n                            name='level'\r\n                            label='level'\r\n                            nudgeValue={delta => this.props.nudgeConditionValue(this.props.condition, 'level', delta)}\r\n                        />\r\n                    </div>\r\n                );\r\n            }\r\n            const text = Utils.conditionText(this.props.condition);\r\n            for (let n = 0; n !== text.length; ++n) {\r\n                description.push(<div key={n} className='section'>{text[n]}</div>);\r\n            }\r\n\r\n            return (\r\n                <Expander\r\n                    text={name}\r\n                    content={(\r\n                        <div>\r\n                            {description}\r\n                            <div className='divider' />\r\n                            <button onClick={() => this.props.editCondition(this.props.condition)}>edit</button>\r\n                            <button onClick={() => this.props.removeCondition(this.props.condition.id)}>remove</button>\r\n                        </div>\r\n                    )}\r\n                />\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Monster } from '../../models/monster-group';\r\nimport { PC } from '../../models/party';\r\n\r\nimport none from '../../resources/images/no-portrait.png';\r\n\r\ninterface Props {\r\n    source: PC | Monster;\r\n    setValue: (value: string) => void;\r\n}\r\n\r\nexport default class PortraitPanel extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        setValue: null\r\n    };\r\n\r\n    private onFileSelected(e: React.ChangeEvent<HTMLInputElement>) {\r\n        if (e.target.files) {\r\n            const reader = new FileReader();\r\n            reader.onload = progress => {\r\n                if (progress.target) {\r\n                    const content = progress.target.result as string;\r\n                    this.props.setValue(content);\r\n                }\r\n            };\r\n            reader.readAsDataURL(e.target.files[0]);\r\n        }\r\n    }\r\n\r\n    private getEditor() {\r\n        let clear = null;\r\n        if (this.props.source.portrait) {\r\n            clear = (\r\n                <button onClick={() => this.props.setValue('')}>clear image</button>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div className='portrait editing'>\r\n                <div className='section centered'>\r\n                    <img src={this.props.source.portrait ? this.props.source.portrait : none} alt='portrait' />\r\n                </div>\r\n                <button onClick={() => (document.getElementById('file-upload') as HTMLInputElement).click()}>select image</button>\r\n                <input\r\n                    type='file'\r\n                    id='file-upload'\r\n                    accept='image/*'\r\n                    style={{ display: 'none' }}\r\n                    onChange={e => this.onFileSelected(e)}\r\n                />\r\n                {clear}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getDisplay() {\r\n        if (!this.props.source.portrait) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <div className='portrait'>\r\n                <div className='section centered'>\r\n                    <img src={this.props.source.portrait} alt='portrait' />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            return this.props.setValue ? this.getEditor() : this.getDisplay();\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport ellipsis from '../../resources/icons/ellipsis.svg';\r\n\r\ninterface Props {\r\n    text: string;\r\n    content: JSX.Element;\r\n    disabled: boolean;\r\n}\r\n\r\ninterface State {\r\n    open: boolean;\r\n}\r\n\r\nexport default class Menu extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        disabled: false\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            open: false\r\n        };\r\n    }\r\n\r\n    private toggleOpen(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        this.setState({\r\n            open: !this.state.open\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let style = this.props.disabled ? 'menu disabled' : 'menu';\r\n            const content = [];\r\n\r\n            content.push(\r\n                <div key='selection' className='menu-top'>\r\n                    <div className='menu-text'>{this.props.text}</div>\r\n                    <img className='arrow' src={ellipsis} alt='arrow' />\r\n                </div>\r\n            );\r\n\r\n            if (this.state.open) {\r\n                style += ' open';\r\n\r\n                content.push(\r\n                    <div key='options' className='menu-content'>\r\n                        {this.props.content}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className={style} onClick={e => this.toggleOpen(e)}>\r\n                    {content}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    content: string | JSX.Element | JSX.Element[];\r\n    white: boolean;\r\n}\r\n\r\nexport default class Note extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        white: false\r\n    };\r\n\r\n    public render() {\r\n        try {\r\n            let style = 'descriptive';\r\n            if (this.props.white) {\r\n                style += ' white';\r\n            }\r\n\r\n            return (\r\n                <div className={style}>\r\n                    {this.props.content}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport Showdown from 'showdown';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Combatant } from '../../models/combat';\r\nimport { Monster, Trait, TRAIT_TYPES } from '../../models/monster-group';\r\n\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport Expander from '../controls/expander';\r\nimport Menu from '../controls/menu';\r\nimport Note from '../panels/note';\r\n\r\nimport arrow from '../../resources/icons/down-arrow-black.svg';\r\n\r\nconst showdown = new Showdown.Converter();\r\n\r\ninterface Props {\r\n    combatant: Monster | (Combatant & Monster);\r\n    mode: 'view' | 'edit' | 'template' | 'combat' | 'combat-special';\r\n    filter: string;\r\n    addTrait: (traitType: 'trait' | 'action' | 'bonus' | 'reaction' | 'legendary' | 'lair') => void;\r\n    copyTrait: (trait: Trait) => void;\r\n    removeTrait: (trait: Trait) => void;\r\n    changeValue: (trait: Trait, field: string, value: any) => void;\r\n    swapTraits: (t1: Trait, t2: Trait) => void;\r\n}\r\n\r\nexport default class TraitsPanel extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        mode: 'view',\r\n        filter: '',\r\n        addTrait: null,\r\n        copyTrait: null,\r\n        removeTrait: null,\r\n        changeValue: null,\r\n        swapTraits: null\r\n    };\r\n\r\n    private createTraitPanel(trait: Trait, prevTrait: Trait | null, nextTrait: Trait | null) {\r\n        return (\r\n            <TraitPanel\r\n                key={trait.id}\r\n                trait={trait}\r\n                mode={this.props.mode}\r\n                prevTrait={prevTrait}\r\n                nextTrait={nextTrait}\r\n                changeValue={(action, type, value) => this.props.changeValue(action, type, value)}\r\n                removeTrait={action => this.props.removeTrait(action)}\r\n                copyTrait={action => this.props.copyTrait(action)}\r\n                swapTraits={(t1, t2) => this.props.swapTraits(t1, t2)}\r\n            />\r\n        );\r\n    }\r\n\r\n    private createSection(traitsByType: { [id: string]: JSX.Element[] }, type: string, showInfo: boolean = false) {\r\n        const traits = traitsByType[type];\r\n        if (traits.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        let info: JSX.Element | null = null;\r\n        if (showInfo) {\r\n            switch (type) {\r\n                case 'legendary':\r\n                    /* tslint:disable:max-line-length */\r\n                    info = (\r\n                        <Note\r\n                            content={'one legendary action can be used at the end of each other combatant\\'s turn; spent actions are refreshed at the start of the monster\\'s turn'}\r\n                            white={true}\r\n                        />\r\n                    );\r\n                    /* tslint:enable:max-line-length */\r\n                    break;\r\n                case 'lair':\r\n                    info = (\r\n                        <Note\r\n                            content={'one lair action can be taken each round on initiative 20'}\r\n                            white={true}\r\n                        />\r\n                    );\r\n                    break;\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div className={this.props.mode === 'edit' ? 'group-panel' : 'section'}>\r\n                <div className='section subheading'>{Utils.traitType(type, true)}</div>\r\n                {info}\r\n                {traits}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const traitsByType: { [id: string]: JSX.Element[] } = {};\r\n\r\n            TRAIT_TYPES.forEach(type => {\r\n                const traits = this.props.combatant.traits\r\n                    .filter(t => t.type === type)\r\n                    .filter(t => Utils.match(this.props.filter, t.name));\r\n\r\n                const list: JSX.Element[] = [];\r\n                for (let n = 0; n !== traits.length; ++n) {\r\n                    const trait = traits[n];\r\n                    const prevTrait = n !== 0 ? traits[n - 1] : null;\r\n                    const nextTrait = n !== traits.length - 1 ? traits[n + 1] : null;\r\n                    list.push(this.createTraitPanel(trait, prevTrait, nextTrait));\r\n                }\r\n\r\n                traitsByType[type] = list;\r\n            });\r\n\r\n            if (this.props.mode === 'edit') {\r\n                return (\r\n                    <div>\r\n                        <Menu\r\n                            text='add a new...'\r\n                            content={(\r\n                                <div>\r\n                                    <button key='trait' onClick={() => this.props.addTrait('trait')}>add a new trait</button>\r\n                                    <button key='action' onClick={() => this.props.addTrait('action')}>add a new action</button>\r\n                                    <button key='bonus' onClick={() => this.props.addTrait('bonus')}>add a new bonus action</button>\r\n                                    <button key='reaction' onClick={() => this.props.addTrait('reaction')}>add a new reaction</button>\r\n                                    <button key='legendary' onClick={() => this.props.addTrait('legendary')}>add a new legendary action</button>\r\n                                    <button key='lair' onClick={() => this.props.addTrait('lair')}>add a new lair action</button>\r\n                                </div>\r\n                            )}\r\n                        />\r\n                        <div className='divider' />\r\n                        {this.createSection(traitsByType, 'trait')}\r\n                        {this.createSection(traitsByType, 'action')}\r\n                        {this.createSection(traitsByType, 'bonus')}\r\n                        {this.createSection(traitsByType, 'reaction')}\r\n                        {this.createSection(traitsByType, 'legendary')}\r\n                        {this.createSection(traitsByType, 'lair')}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            if (this.props.combatant.traits.length === 0) {\r\n                return (\r\n                    <div><i>no traits or actions</i></div>\r\n                );\r\n            }\r\n\r\n            if (this.props.mode === 'combat') {\r\n                return (\r\n                    <div>\r\n                        {this.createSection(traitsByType, 'trait')}\r\n                        {this.createSection(traitsByType, 'action')}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            if (this.props.mode === 'combat-special') {\r\n                return (\r\n                    <div>\r\n                        {this.createSection(traitsByType, 'legendary', true)}\r\n                        {this.createSection(traitsByType, 'lair', true)}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div>\r\n                    {this.createSection(traitsByType, 'trait')}\r\n                    {this.createSection(traitsByType, 'action')}\r\n                    {this.createSection(traitsByType, 'bonus')}\r\n                    {this.createSection(traitsByType, 'reaction')}\r\n                    {this.createSection(traitsByType, 'legendary')}\r\n                    {this.createSection(traitsByType, 'lair')}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface TraitPanelProps {\r\n    trait: Trait;\r\n    mode: 'view' | 'edit' | 'template' | 'combat' | 'combat-special';\r\n    prevTrait: Trait | null;\r\n    nextTrait: Trait | null;\r\n    changeValue: (trait: Trait, field: string, value: any) => void;\r\n    copyTrait: (trait: Trait) => void;\r\n    removeTrait: (trait: Trait) => void;\r\n    swapTraits: (t1: Trait, t2: Trait) => void;\r\n}\r\n\r\nclass TraitPanel extends React.Component<TraitPanelProps> {\r\n    public render() {\r\n        try {\r\n            let maxUses = 0;\r\n            let heading = this.props.trait.name || 'unnamed ' + Utils.traitType(this.props.trait.type, false);\r\n\r\n            if (this.props.trait.usage) {\r\n                let used = '';\r\n                if (this.props.trait.usage.toLowerCase().startsWith('recharge ')) {\r\n                    maxUses = 1;\r\n                    if (this.props.trait.uses > 0) {\r\n                        used = '; used';\r\n                    }\r\n                }\r\n                const found = this.props.trait.usage.toLowerCase().match(/(\\d+)\\s*\\/\\s*day/);\r\n                if (found) {\r\n                    maxUses = parseInt(found[1], 10);\r\n                    if (this.props.trait.uses > 0) {\r\n                        used = '; used ' + this.props.trait.uses;\r\n                    }\r\n                }\r\n                heading += ' *(' + this.props.trait.usage + used + ')*';\r\n            }\r\n            if (this.props.trait.type === 'legendary') {\r\n                maxUses = 1;\r\n                if (this.props.trait.uses > 0) {\r\n                    heading += ' *(used)*';\r\n                }\r\n            }\r\n            const markdown = '**' + heading + '** ' + this.props.trait.text;\r\n\r\n            switch (this.props.mode) {\r\n                case 'view':\r\n                    return (\r\n                        <div key={this.props.trait.id} className='section trait'>\r\n                            <div dangerouslySetInnerHTML={{ __html: showdown.makeHtml(markdown) }} />\r\n                        </div>\r\n                    );\r\n                case 'edit':\r\n                    const details = (\r\n                        <div className='section'>\r\n                            <div className='row'>\r\n                                <div className='columns small-6 medium-8 large-8'>\r\n                                    <input\r\n                                        type='text'\r\n                                        placeholder='name'\r\n                                        value={this.props.trait.name}\r\n                                        onChange={event => this.props.changeValue(this.props.trait, 'name', event.target.value)}\r\n                                    />\r\n                                    <input\r\n                                        type='text'\r\n                                        placeholder='usage'\r\n                                        value={this.props.trait.usage}\r\n                                        onChange={event => this.props.changeValue(this.props.trait, 'usage', event.target.value)}\r\n                                    />\r\n                                </div>\r\n                                <div className='columns small-6 medium-4 large-4'>\r\n                                    <div className='trait-ordering'>\r\n                                        <img\r\n                                            className={this.props.prevTrait ? 'up' : 'up disabled'}\r\n                                            src={arrow}\r\n                                            alt='move up'\r\n                                            onClick={() => this.props.swapTraits(this.props.trait, this.props.prevTrait as Trait)}\r\n                                        />\r\n                                        <img\r\n                                            className={this.props.nextTrait ? '' : 'disabled'}\r\n                                            src={arrow}\r\n                                            alt='move down'\r\n                                            onClick={() => this.props.swapTraits(this.props.trait, this.props.nextTrait as Trait)}\r\n                                        />\r\n                                    </div>\r\n                                    <ConfirmButton text='delete' callback={() => this.props.removeTrait(this.props.trait)} />\r\n                                </div>\r\n                            </div>\r\n                            <textarea\r\n                                placeholder='details'\r\n                                value={this.props.trait.text}\r\n                                onChange={event => this.props.changeValue(this.props.trait, 'text', event.target.value)}\r\n                            />\r\n                        </div>\r\n                    );\r\n\r\n                    let name = this.props.trait.name || 'unnamed ' + Utils.traitType(this.props.trait.type, false);\r\n                    if (this.props.trait.usage) {\r\n                        name += ' (' + this.props.trait.usage + ')';\r\n                    }\r\n                    return (\r\n                        <Expander\r\n                            text={name}\r\n                            content={details}\r\n                        />\r\n                    );\r\n                case 'template':\r\n                    return (\r\n                        <div key={this.props.trait.id} className='section trait'>\r\n                            <div dangerouslySetInnerHTML={{ __html: showdown.makeHtml(markdown) }} />\r\n                            <button onClick={() => this.props.copyTrait(this.props.trait)}>copy</button>\r\n                        </div>\r\n                    );\r\n                case 'combat':\r\n                case 'combat-special':\r\n                    let style = '';\r\n                    let usage = null;\r\n                    if (maxUses > 0) {\r\n                        const isTapped = this.props.trait.uses >= maxUses;\r\n                        if (isTapped) {\r\n                            style = 'strikethrough';\r\n                            usage = <button onClick={() => this.props.changeValue(this.props.trait, 'uses', 0)}>recharge</button>;\r\n                        } else {\r\n                            usage = <button onClick={() => this.props.changeValue(this.props.trait, 'uses', this.props.trait.uses + 1)}>use</button>;\r\n                        }\r\n                    }\r\n                    return (\r\n                        <div key={this.props.trait.id} className='section trait'>\r\n                            <div className={style} dangerouslySetInnerHTML={{ __html: showdown.makeHtml(markdown) }} />\r\n                            {usage}\r\n                        </div>\r\n                    );\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    heading: string | JSX.Element | JSX.Element[] | null;\r\n    content: string | JSX.Element | JSX.Element[] | null;\r\n}\r\n\r\nexport default class InfoCard extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        heading: null,\r\n        content: null\r\n    };\r\n\r\n    public render() {\r\n        try {\r\n            return (\r\n                <div className='card'>\r\n                    {this.props.heading}\r\n                    <div className='card-content'>\r\n                        {this.props.content}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Combat, COMBAT_TAGS, Combatant } from '../../models/combat';\r\nimport { Condition } from '../../models/condition';\r\nimport { Encounter, EncounterSlot, EncounterWave } from '../../models/encounter';\r\nimport { Monster, MonsterGroup, Trait } from '../../models/monster-group';\r\n\r\nimport Checkbox from '../controls/checkbox';\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport ControlRow from '../controls/control-row';\r\nimport Dropdown from '../controls/dropdown';\r\nimport Expander from '../controls/expander';\r\nimport Radial from '../controls/radial';\r\nimport Selector from '../controls/selector';\r\nimport Spin from '../controls/spin';\r\nimport AbilityScorePanel from '../panels/ability-score-panel';\r\nimport ConditionsPanel from '../panels/conditions-panel';\r\nimport PortraitPanel from '../panels/portrait-panel';\r\nimport TraitsPanel from '../panels/traits-panel';\r\nimport InfoCard from './info-card';\r\n\r\nimport arrow from '../../resources/icons/down-arrow.svg';\r\n\r\ninterface Props {\r\n    combatant: Monster | (Monster & Combatant);\r\n    mode: string;\r\n    library: MonsterGroup[];\r\n    changeValue: (monster: any, field: string, value: any) => void;\r\n    nudgeValue: (source: any, field: string, delta: number) => void;\r\n    // Library\r\n    filter: string;\r\n    editMonster: (monster: Monster) => void;\r\n    removeMonster: (monster: Monster) => void;\r\n    cloneMonster: (monster: Monster, name: string) => void;\r\n    moveToGroup: (monster: Monster, group: string) => void;\r\n    copyTrait: (trait: Trait) => void;\r\n    selectMonster: (monster: Monster) => void;\r\n    deselectMonster: (monster: Monster) => void;\r\n    // Encounter builder\r\n    encounter: Encounter;\r\n    slot: EncounterSlot;\r\n    addEncounterSlot: (monster: Monster, waveID: string | null) => void;\r\n    removeEncounterSlot: (slot: EncounterSlot) => void;\r\n    // Combat\r\n    combat: Combat;\r\n    makeCurrent: (combatant: Combatant) => void;\r\n    makeActive: (combatant: Combatant) => void;\r\n    makeDefeated: (combatant: Combatant) => void;\r\n    endTurn: (combatant: Combatant) => void;\r\n    mapAdd: (combatant: Combatant) => void;\r\n    mapMove: (combatant: Combatant, dir: string) => void;\r\n    mapRemove: (combatant: Combatant) => void;\r\n    removeCombatant: (combatant: Combatant) => void;\r\n    changeHP: (combatant: Combatant, hp: number, tempHP: number) => void;\r\n    addCondition: (combatant: Combatant) => void;\r\n    editCondition: (combatant: Combatant, condition: Condition) => void;\r\n    removeCondition: (combatant: Combatant, conditionID: string) => void;\r\n    nudgeConditionValue: (condition: Condition, field: string, delta: number) => void;\r\n    toggleTag: (combatant: Combatant, tag: string) => void;\r\n}\r\n\r\ninterface State {\r\n    showDetails: boolean;\r\n    cloneName: string;\r\n    combatMode: string;\r\n    damageOrHealing: number;\r\n}\r\n\r\nexport default class MonsterCard extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        library: null,\r\n        changeValue: null,\r\n        nudgeValue: null,\r\n        filter: '',\r\n        editMonster: null,\r\n        removeMonster: null,\r\n        cloneMonster: null,\r\n        moveToGroup: null,\r\n        copyTrait: null,\r\n        selectMonster: null,\r\n        deselectMonster: null,\r\n        encounter: null,\r\n        slot: null,\r\n        addEncounterSlot: null,\r\n        removeEncounterSlot: null,\r\n        combat: null,\r\n        makeCurrent: null,\r\n        makeActive: null,\r\n        makeDefeated: null,\r\n        endTurn: null,\r\n        mapAdd: null,\r\n        mapMove: null,\r\n        mapRemove: null,\r\n        removeCombatant: null,\r\n        changeHP: null,\r\n        addCondition: null,\r\n        editCondition: null,\r\n        removeCondition: null,\r\n        nudgeConditionValue: null,\r\n        toggleTag: null\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            showDetails: false,\r\n            cloneName: props.combatant.name + ' copy',\r\n            combatMode: 'main',\r\n            damageOrHealing: 0\r\n        };\r\n    }\r\n\r\n    private setCloneName(cloneName: string) {\r\n        this.setState({\r\n            cloneName: cloneName\r\n        });\r\n    }\r\n\r\n    private toggleDetails() {\r\n        this.setState({\r\n            showDetails: !this.state.showDetails\r\n        });\r\n    }\r\n\r\n    private setDamage(value: number) {\r\n        this.setState({\r\n            damageOrHealing: value\r\n        });\r\n    }\r\n\r\n    private nudgeDamage(delta: number) {\r\n        this.setState({\r\n            damageOrHealing: Math.max(this.state.damageOrHealing + delta, 0)\r\n        });\r\n    }\r\n\r\n    private setCombatMode(mode: string) {\r\n        this.setState({\r\n            combatMode: mode\r\n        });\r\n    }\r\n\r\n    private heal() {\r\n        const combatant = this.props.combatant as Combatant;\r\n\r\n        let hp = (combatant.hp ? combatant.hp : 0) + this.state.damageOrHealing;\r\n        hp = Math.min(hp, this.props.combatant.hpMax);\r\n\r\n        this.setState({\r\n            damageOrHealing: 0\r\n        }, () => {\r\n            this.props.changeHP(combatant, hp, this.props.combatant.hpTemp);\r\n        });\r\n    }\r\n\r\n    private damage() {\r\n        const combatant = this.props.combatant as Combatant;\r\n\r\n        let hp = (combatant.hp ? combatant.hp : 0);\r\n        let temp = this.props.combatant.hpTemp;\r\n\r\n        let damage = this.state.damageOrHealing;\r\n\r\n        // Take damage off temp HP first\r\n        const val = Math.min(damage, temp);\r\n        damage -= val;\r\n        temp -= val;\r\n\r\n        // Take the rest off HP\r\n        hp -= damage;\r\n        hp = Math.max(hp, 0);\r\n\r\n        this.setState({\r\n            damageOrHealing: 0\r\n        }, () => {\r\n            this.props.changeHP(combatant, hp, temp);\r\n        });\r\n    }\r\n\r\n    private description() {\r\n        let size = this.props.combatant.size;\r\n        const combatant = this.props.combatant as (Monster & Combatant);\r\n        if (combatant) {\r\n            size = combatant.displaySize || size;\r\n        }\r\n        let sizeAndType = (size + ' ' + this.props.combatant.category).toLowerCase();\r\n        if (this.props.combatant.tag) {\r\n            sizeAndType += ' (' + this.props.combatant.tag.toLowerCase() + ')';\r\n        }\r\n        sizeAndType += ', ';\r\n\r\n        let align = '';\r\n        if (this.props.combatant.alignment) {\r\n            align = this.props.combatant.alignment.toLowerCase() + ', ';\r\n        }\r\n\r\n        const cr = 'cr ' + Utils.challenge(this.props.combatant.challenge);\r\n\r\n        return sizeAndType + align + cr;\r\n    }\r\n\r\n    private monsterIsInWave(wave: EncounterWave) {\r\n        return wave.slots.some(s => {\r\n            const group = this.props.library.find(g => g.monsters.includes(this.props.combatant));\r\n            return !!group && (s.monsterGroupName === group.name) && (s.monsterName === this.props.combatant.name);\r\n        });\r\n    }\r\n\r\n    private getHP() {\r\n        if (this.props.combatant.hitDice === 0) {\r\n            return this.props.combatant.hpMax;\r\n        }\r\n\r\n        const die = Utils.hitDieType(this.props.combatant.size);\r\n        const conMod = Utils.modifierValue(this.props.combatant.abilityScores.con) * this.props.combatant.hitDice;\r\n        let conModStr = '';\r\n        if (conMod > 0) {\r\n            conModStr = ' +' + conMod;\r\n        }\r\n        if (conMod < 0) {\r\n            conModStr = ' ' + conMod;\r\n        }\r\n        return this.props.combatant.hpMax + ' (' + this.props.combatant.hitDice + 'd' + die + conModStr + ')';\r\n    }\r\n\r\n    private getCombatControls() {\r\n        const combatant = this.props.combatant as Combatant;\r\n\r\n        const options = [];\r\n\r\n        const combatModes = ['main', 'hp', 'cond', 'map', 'adv'].map(m => {\r\n            return {\r\n                id: m,\r\n                text: m\r\n            };\r\n        });\r\n        if (this.props.mode.indexOf('tactical') === -1) {\r\n            // No combat map, so remove the map option\r\n            combatModes.splice(3, 1);\r\n        }\r\n        options.push(\r\n            <Selector\r\n                key='selector'\r\n                options={combatModes}\r\n                selectedID={this.state.combatMode}\r\n                select={option => this.setCombatMode(option)}\r\n            />\r\n        );\r\n        options.push(<div key='selector-sep' className='divider' />);\r\n\r\n        switch (this.state.combatMode) {\r\n            case 'main':\r\n                if (!combatant.pending && combatant.active && !combatant.defeated) {\r\n                    if (combatant.current) {\r\n                        options.push(<button key='endTurn' onClick={() => this.props.endTurn(combatant)}>end turn</button>);\r\n                        options.push(<button key='makeDefeated' onClick={() => this.props.makeDefeated(combatant)}>mark as defeated and end turn</button>);\r\n                    } else {\r\n                        options.push(<button key='makeCurrent' onClick={() => this.props.makeCurrent(combatant)}>start turn</button>);\r\n                        options.push(<button key='makeDefeated' onClick={() => this.props.makeDefeated(combatant)}>mark as defeated</button>);\r\n                    }\r\n                }\r\n                if (!combatant.pending && !combatant.active && combatant.defeated) {\r\n                    options.push(<button key='makeActive' onClick={() => this.props.makeActive(combatant)}>mark as active</button>);\r\n                }\r\n                options.push(<div key='tag-sep' className='divider' />);\r\n                if (this.props.mode.indexOf('tactical') !== -1) {\r\n                    options.push(\r\n                        <Checkbox\r\n                            key='hidden'\r\n                            label='hidden'\r\n                            display='switch'\r\n                            checked={!combatant.showOnMap}\r\n                            changeValue={value => this.props.changeValue(combatant, 'showOnMap', !value)}\r\n                        />\r\n                    );\r\n                }\r\n                options.push(\r\n                    <ControlRow\r\n                        key='tags'\r\n                        controls={COMBAT_TAGS.map(tag =>\r\n                            <Checkbox\r\n                                key={tag}\r\n                                label={tag}\r\n                                display='button'\r\n                                checked={combatant.tags.includes(tag)}\r\n                                changeValue={value => this.props.toggleTag(combatant, tag)}\r\n                            />\r\n                        )}\r\n                    />\r\n                );\r\n                break;\r\n            case 'hp':\r\n                options.push(\r\n                    <div key='hp'>\r\n                        <Spin\r\n                            source={this.props.combatant}\r\n                            name='hp'\r\n                            label='hit points'\r\n                            factors={[1, 10]}\r\n                            nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'hp', delta)}\r\n                        />\r\n                        <Spin\r\n                            source={this.props.combatant}\r\n                            name='hpTemp'\r\n                            label='temp hp'\r\n                            factors={[1, 10]}\r\n                            nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'hpTemp', delta)}\r\n                        />\r\n                        <div className='divider' />\r\n                        <div className='section' style={{ display: this.props.combatant.damage.resist !== '' ? '' : 'none' }}>\r\n                            <b>damage resistances</b> {this.props.combatant.damage.resist}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.damage.vulnerable !== '' ? '' : 'none' }}>\r\n                            <b>damage vulnerabilities</b> {this.props.combatant.damage.vulnerable}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.damage.immune !== '' ? '' : 'none' }}>\r\n                            <b>damage immunities</b> {this.props.combatant.damage.immune}\r\n                        </div>\r\n                        <Spin\r\n                            source={this.state}\r\n                            name='damageOrHealing'\r\n                            factors={[1, 10]}\r\n                            nudgeValue={delta => this.nudgeDamage(delta)}\r\n                        />\r\n                        <ControlRow\r\n                            controls={[\r\n                                <button key='heal' onClick={() => this.heal()}>heal</button>,\r\n                                <button key='reset' onClick={() => this.setDamage(0)}>reset</button>,\r\n                                <button key='damage' onClick={() => this.damage()}>damage</button>\r\n                            ]}\r\n                            disabled={this.state.damageOrHealing === 0}\r\n                        />\r\n                    </div>\r\n                );\r\n                break;\r\n            case 'cond':\r\n                options.push(\r\n                    <div key='conditions'>\r\n                        <div className='section' style={{ display: this.props.combatant.conditionImmunities !== '' ? '' : 'none' }}>\r\n                            <b>condition immunities</b> {this.props.combatant.conditionImmunities}\r\n                        </div>\r\n                        <ConditionsPanel\r\n                            combatant={this.props.combatant as Combatant}\r\n                            combat={this.props.combat}\r\n                            addCondition={() => this.props.addCondition(this.props.combatant as Combatant)}\r\n                            editCondition={condition => this.props.editCondition(this.props.combatant as Combatant, condition)}\r\n                            removeCondition={conditionID => this.props.removeCondition(this.props.combatant as Combatant, conditionID)}\r\n                            nudgeConditionValue={(condition, type, delta) => this.props.nudgeConditionValue(condition, type, delta)}\r\n                        />\r\n                    </div>\r\n                );\r\n                break;\r\n            case 'map':\r\n                if (this.props.mode.indexOf('on-map') !== -1) {\r\n                    options.push(\r\n                        <div key='mapMove' className='section centered'>\r\n                            <Radial\r\n                                direction='eight'\r\n                                click={dir => this.props.mapMove(combatant, dir)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                    options.push(<div key='move-sep' className='divider' />);\r\n                    options.push(\r\n                        <Spin\r\n                            key='altitude'\r\n                            source={combatant}\r\n                            name='altitude'\r\n                            label='altitude'\r\n                            display={value => value + ' ft.'}\r\n                            nudgeValue={delta => this.props.nudgeValue(combatant, 'altitude', delta * 5)}\r\n                        />\r\n                    );\r\n                    let auraDetails = null;\r\n                    if (combatant.aura.radius > 0) {\r\n                        const auraStyleOptions = [\r\n                            {\r\n                                id: 'square',\r\n                                text: 'square'\r\n                            },\r\n                            {\r\n                                id: 'rounded',\r\n                                text: 'rounded'\r\n                            },\r\n                            {\r\n                                id: 'circle',\r\n                                text: 'circle'\r\n                            }\r\n                        ];\r\n                        auraDetails = (\r\n                            <div>\r\n                                <Selector\r\n                                    options={auraStyleOptions}\r\n                                    selectedID={combatant.aura.style}\r\n                                    select={optionID => this.props.changeValue(combatant.aura, 'style', optionID)}\r\n                                />\r\n                                <input\r\n                                    type='color'\r\n                                    value={combatant.aura.color}\r\n                                    onChange={event => this.props.changeValue(combatant.aura, 'color', event.target.value)}\r\n                                />\r\n                            </div>\r\n                        );\r\n                    }\r\n                    options.push(\r\n                        <Expander\r\n                            key='aura'\r\n                            text='aura'\r\n                            content={(\r\n                                <div>\r\n                                    <Spin\r\n                                        source={combatant.aura}\r\n                                        name='radius'\r\n                                        label='size'\r\n                                        display={value => value + ' ft.'}\r\n                                        nudgeValue={delta => this.props.nudgeValue(combatant.aura, 'radius', delta * 5)}\r\n                                    />\r\n                                    {auraDetails}\r\n                                </div>\r\n                            )}\r\n                        />\r\n                    );\r\n                    options.push(<button key='mapRemove' onClick={() => this.props.mapRemove(combatant)}>remove from map</button>);\r\n                }\r\n                if (this.props.mode.indexOf('off-map') !== -1) {\r\n                    options.push(<button key='mapAdd' onClick={() => this.props.mapAdd(combatant)}>add to map</button>);\r\n                }\r\n                break;\r\n            case 'adv':\r\n                if (!combatant.current) {\r\n                    options.push(<ConfirmButton key='remove' text='remove from encounter' callback={() => this.props.removeCombatant(combatant)} />);\r\n                }\r\n                if (!combatant.pending) {\r\n                    options.push(\r\n                        <Expander\r\n                            key='init'\r\n                            text='change initiative score'\r\n                            content={(\r\n                                <div>\r\n                                    <Spin\r\n                                        source={this.props.combatant}\r\n                                        name='initiative'\r\n                                        label='initiative'\r\n                                        nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'initiative', delta)}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n                        />\r\n                    );\r\n                }\r\n                options.push(\r\n                    <Expander\r\n                        key='size'\r\n                        text='change size'\r\n                        content={(\r\n                            <div>\r\n                                <Spin\r\n                                    source={this.props.combatant}\r\n                                    name='displaySize'\r\n                                    label='size'\r\n                                    nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'displaySize', delta)}\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    />\r\n                );\r\n                options.push(\r\n                    <Expander\r\n                        key='rename'\r\n                        text='change name'\r\n                        content={(\r\n                            <div>\r\n                                <input\r\n                                    type='text'\r\n                                    value={combatant.displayName}\r\n                                    onChange={event => this.props.changeValue(this.props.combatant, 'displayName', event.target.value)}\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    />\r\n                );\r\n                break;\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='group-panel'>\r\n                    {options}\r\n                </div>\r\n                <div className='divider' />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const options = [];\r\n            if (this.props.mode.indexOf('no-buttons') === -1) {\r\n                if (this.props.mode.indexOf('view') !== -1) {\r\n                    if (this.props.mode.indexOf('editable') !== -1) {\r\n                        options.push(\r\n                            <button key='edit' onClick={() => this.props.editMonster(this.props.combatant)}>edit monster</button>\r\n                        );\r\n\r\n                        options.push(\r\n                            <Expander\r\n                                key='clone'\r\n                                text='clone monster'\r\n                                content={\r\n                                    <div>\r\n                                        <input\r\n                                            type='text'\r\n                                            placeholder='monster name'\r\n                                            value={this.state.cloneName}\r\n                                            onChange={event => this.setCloneName(event.target.value)}\r\n                                        />\r\n                                        <button onClick={() => this.props.cloneMonster(this.props.combatant, this.state.cloneName)}>create copy</button>\r\n                                    </div>\r\n                                }\r\n                            />\r\n                        );\r\n\r\n                        const groupOptions: { id: string, text: string }[] = [];\r\n                        this.props.library.forEach(group => {\r\n                            if (group.monsters.indexOf(this.props.combatant) === -1) {\r\n                                groupOptions.push({\r\n                                    id: group.id,\r\n                                    text: group.name\r\n                                });\r\n                            }\r\n                        });\r\n                        options.push(\r\n                            <Dropdown\r\n                                key='move'\r\n                                options={groupOptions}\r\n                                placeholder='move to group...'\r\n                                select={optionID => this.props.moveToGroup(this.props.combatant, optionID)}\r\n                            />\r\n                        );\r\n\r\n                        options.push(<ConfirmButton key='remove' text='delete monster' callback={() => this.props.removeMonster(this.props.combatant)} />);\r\n                    }\r\n                    if (this.props.mode.indexOf('encounter') !== -1) {\r\n                        if (this.props.slot) {\r\n                            // This card is in an encounter or a wave\r\n                            options.push(\r\n                                <button key='remove' onClick={() => this.props.removeEncounterSlot(this.props.slot)}>\r\n                                    remove from encounter\r\n                                </button>\r\n                            );\r\n                        } else {\r\n                            let canAdd = false;\r\n                            // This card is in the library list\r\n                            if (!this.monsterIsInWave(this.props.encounter)) {\r\n                                options.push(\r\n                                    <button key='add encounter' onClick={() => this.props.addEncounterSlot(this.props.combatant, null)}>\r\n                                        add to encounter\r\n                                    </button>\r\n                                );\r\n                                canAdd = true;\r\n                            }\r\n                            this.props.encounter.waves.forEach(wave => {\r\n                                if (!this.monsterIsInWave(wave)) {\r\n                                    options.push(\r\n                                        <button key={'add ' + wave.id} onClick={() => this.props.addEncounterSlot(this.props.combatant, wave.id)}>\r\n                                            add to {wave.name}\r\n                                        </button>\r\n                                    );\r\n                                    canAdd = true;\r\n                                }\r\n                            });\r\n                            // If we can't add it anywhere, don't show it\r\n                            if (!canAdd) {\r\n                                return (\r\n                                    <InfoCard\r\n                                        heading={\r\n                                            (\r\n                                                <div className='heading'>\r\n                                                    <div className='title'>{this.props.combatant.name}</div>\r\n                                                </div>\r\n                                            )\r\n                                        }\r\n                                        content={\r\n                                            (\r\n                                                <div className='section centered'>\r\n                                                    <i>this monster is already part of this encounter</i>\r\n                                                </div>\r\n                                            )\r\n                                        }\r\n                                    />\r\n                                );\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.props.mode.indexOf('candidate') !== -1) {\r\n                        if (this.props.mode.indexOf('selected') === -1) {\r\n                            options.push(\r\n                                <button key='select' onClick={() => this.props.selectMonster(this.props.combatant)}>select monster</button>\r\n                            );\r\n                        } else {\r\n                            options.push(\r\n                                <button key='deselect' onClick={() => this.props.deselectMonster(this.props.combatant)}>deselect monster</button>\r\n                            );\r\n                        }\r\n                    }\r\n                }\r\n                if (this.props.mode.indexOf('template') !== -1) {\r\n                    // None\r\n                }\r\n            }\r\n\r\n            let combat = null;\r\n            if (this.props.mode.indexOf('combat') !== -1) {\r\n                combat = this.getCombatControls();\r\n            }\r\n\r\n            let stats = null;\r\n            if (this.props.mode.indexOf('view') !== -1) {\r\n                let slotSection = null;\r\n                if (this.props.slot) {\r\n                    slotSection = (\r\n                        <div>\r\n                            <div className='divider' />\r\n                            <Spin\r\n                                source={this.props.slot}\r\n                                name='count'\r\n                                label='count'\r\n                                nudgeValue={delta => this.props.nudgeValue(this.props.slot, 'count', delta)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                let details = null;\r\n                if (this.state.showDetails || (this.props.mode.indexOf('generated') !== -1)) {\r\n                    details = (\r\n                        <div>\r\n                            <div className='divider' />\r\n                            <div className='section'>\r\n                                <b>ac</b> {this.props.combatant.ac}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.hpMax !== 0 ? '' : 'none' }}>\r\n                                <b>hp</b> {this.getHP()}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.speed !== '' ? '' : 'none' }}>\r\n                                <b>speed</b> {this.props.combatant.speed}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <AbilityScorePanel combatant={this.props.combatant} />\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.savingThrows !== '' ? '' : 'none' }}>\r\n                                <b>saving throws</b> {this.props.combatant.savingThrows}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.skills !== '' ? '' : 'none' }}>\r\n                                <b>skills</b> {this.props.combatant.skills}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.damage.resist !== '' ? '' : 'none' }}>\r\n                                <b>damage resistances</b> {this.props.combatant.damage.resist}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.damage.vulnerable !== '' ? '' : 'none' }}>\r\n                                <b>damage vulnerabilities</b> {this.props.combatant.damage.vulnerable}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.damage.immune !== '' ? '' : 'none' }}>\r\n                                <b>damage immunities</b> {this.props.combatant.damage.immune}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.conditionImmunities !== '' ? '' : 'none' }}>\r\n                                <b>condition immunities</b> {this.props.combatant.conditionImmunities}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.senses !== '' ? '' : 'none' }}>\r\n                                <b>senses</b> {this.props.combatant.senses}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.languages !== '' ? '' : 'none' }}>\r\n                                <b>languages</b> {this.props.combatant.languages}\r\n                            </div>\r\n                            <div className='section' style={{ display: this.props.combatant.equipment !== '' ? '' : 'none' }}>\r\n                                <b>equipment</b> {this.props.combatant.equipment}\r\n                            </div>\r\n                            <div className='divider' />\r\n                            <TraitsPanel combatant={this.props.combatant} />\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                stats = (\r\n                    <div className='stats'>\r\n                        <PortraitPanel source={this.props.combatant} />\r\n                        <div className='section centered'>\r\n                            <i>{this.description()}</i>\r\n                        </div>\r\n                        {slotSection}\r\n                        {details}\r\n                    </div>\r\n                );\r\n            }\r\n            if (this.props.mode.indexOf('combat') !== -1) {\r\n                stats = (\r\n                    <div className='stats'>\r\n                        <PortraitPanel source={this.props.combatant} />\r\n                        <div className='section centered'>\r\n                            <i>{this.description()}</i>\r\n                        </div>\r\n                        <div className='divider' />\r\n                        {combat}\r\n                        <div className='section'>\r\n                            <AbilityScorePanel combatant={this.props.combatant} />\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.ac !== 0 ? '' : 'none' }}>\r\n                            <b>ac</b> {this.props.combatant.ac}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.savingThrows !== '' ? '' : 'none' }}>\r\n                            <b>saving throws</b> {this.props.combatant.savingThrows}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.skills !== '' ? '' : 'none' }}>\r\n                            <b>skills</b> {this.props.combatant.skills}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.speed !== '' ? '' : 'none' }}>\r\n                            <b>speed</b> {this.props.combatant.speed}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.senses !== '' ? '' : 'none' }}>\r\n                            <b>senses</b> {this.props.combatant.senses}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.damage.resist !== '' ? '' : 'none' }}>\r\n                            <b>damage resistances</b> {this.props.combatant.damage.resist}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.damage.vulnerable !== '' ? '' : 'none' }}>\r\n                            <b>damage vulnerabilities</b> {this.props.combatant.damage.vulnerable}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.damage.immune !== '' ? '' : 'none' }}>\r\n                            <b>damage immunities</b> {this.props.combatant.damage.immune}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.conditionImmunities !== '' ? '' : 'none' }}>\r\n                            <b>condition immunities</b> {this.props.combatant.conditionImmunities}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.languages !== '' ? '' : 'none' }}>\r\n                            <b>languages</b> {this.props.combatant.languages}\r\n                        </div>\r\n                        <div className='section' style={{ display: this.props.combatant.equipment !== '' ? '' : 'none' }}>\r\n                            <b>equipment</b> {this.props.combatant.equipment}\r\n                        </div>\r\n                        <div className='divider' />\r\n                        <TraitsPanel\r\n                            combatant={this.props.combatant}\r\n                            mode='combat'\r\n                            changeValue={(trait, field, value) => this.props.changeValue(trait, field, value)}\r\n                        />\r\n                    </div>\r\n                );\r\n            }\r\n            if (this.props.mode.indexOf('template') !== -1) {\r\n                if (this.props.mode.indexOf('overview') !== -1) {\r\n                    stats = (\r\n                        <div>\r\n                        <PortraitPanel source={this.props.combatant} />\r\n                            <div className='section centered'>\r\n                                <i>{this.description()}</i>\r\n                            </div>\r\n                            <div className='divider' />\r\n                            <div className='section'>\r\n                                <b>speed</b> {this.props.combatant.speed || '-'}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>senses</b> {this.props.combatant.senses || '-'}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>languages</b> {this.props.combatant.languages || '-'}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>equipment</b> {this.props.combatant.equipment || '-'}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                }\r\n                if (this.props.mode.indexOf('abilities') !== -1) {\r\n                    stats = (\r\n                        <div>\r\n                            <div className='section'>\r\n                                <AbilityScorePanel combatant={this.props.combatant} />\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>saving throws</b> {this.props.combatant.savingThrows || '-'}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>skills</b> {this.props.combatant.skills || '-'}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                }\r\n                if (this.props.mode.indexOf('cbt-stats') !== -1) {\r\n                    stats = (\r\n                        <div>\r\n                            <div className='section'>\r\n                                <b>ac</b> {this.props.combatant.ac}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>hp</b> {this.getHP()}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>damage immunity</b> {this.props.combatant.damage.immune || '-'}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>damage resistance</b> {this.props.combatant.damage.resist || '-'}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>damage vulnerability</b> {this.props.combatant.damage.vulnerable || '-'}\r\n                            </div>\r\n                            <div className='section'>\r\n                                <b>condition immunities</b> {this.props.combatant.conditionImmunities || '-'}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                }\r\n                if (this.props.mode.indexOf('actions') !== -1) {\r\n                    stats = (\r\n                        <TraitsPanel\r\n                            combatant={this.props.combatant}\r\n                            mode='template'\r\n                            filter={this.props.filter}\r\n                            copyTrait={trait => this.props.copyTrait(trait)}\r\n                        />\r\n                    );\r\n                }\r\n            }\r\n\r\n            let toggle = null;\r\n            if (this.props.mode.indexOf('combat') !== -1) {\r\n                // Don't show toggle button for combatant\r\n            } else if (this.props.mode.indexOf('template') !== -1) {\r\n                // Don't show toggle button for template\r\n            } else if (this.props.mode.indexOf('view generated') !== -1) {\r\n                // Don't show toggle button for generated monster\r\n            } else {\r\n                const imageStyle = this.state.showDetails ? 'image rotate' : 'image';\r\n                toggle = (\r\n                    <img className={imageStyle} src={arrow} alt='arrow' onClick={() => this.toggleDetails()} />\r\n                );\r\n            }\r\n\r\n            const name = (this.props.combatant as Combatant ? (this.props.combatant as Combatant).displayName : null)\r\n                || this.props.combatant.name\r\n                || 'unnamed monster';\r\n\r\n            return (\r\n                <div className='card monster'>\r\n                    <div className='heading'>\r\n                        <div className='title'>\r\n                            {name}\r\n                        </div>\r\n                        {toggle}\r\n                    </div>\r\n                    <div className='card-content'>\r\n                        {stats}\r\n                        <div style={{ display: options.length > 0 ? '' : 'none' }}>\r\n                            <div className='divider' />\r\n                            <div className='section'>{options}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Combat, COMBAT_TAGS, Combatant } from '../../models/combat';\r\nimport { Condition } from '../../models/condition';\r\nimport { PC } from '../../models/party';\r\n\r\nimport Checkbox from '../controls/checkbox';\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport ControlRow from '../controls/control-row';\r\nimport Expander from '../controls/expander';\r\nimport Radial from '../controls/radial';\r\nimport Selector from '../controls/selector';\r\nimport Spin from '../controls/spin';\r\nimport ConditionsPanel from '../panels/conditions-panel';\r\nimport PortraitPanel from '../panels/portrait-panel';\r\n\r\ninterface Props {\r\n    combatant: PC | (PC & Combatant);\r\n    mode: string;\r\n    changeValue: (pc: any, field: string, value: any) => void;\r\n    nudgeValue: (pc: any, field: string, delta: number) => void;\r\n    removePC: (pc: PC) => void;\r\n    editPC: (pc: PC) => void;\r\n    // Combat\r\n    combat: Combat;\r\n    makeCurrent: (combatant: Combatant) => void;\r\n    makeActive: (combatant: Combatant) => void;\r\n    makeDefeated: (combatant: Combatant) => void;\r\n    endTurn: (combatant: Combatant) => void;\r\n    mapAdd: (combatant: Combatant) => void;\r\n    mapMove: (combatant: Combatant, dir: string) => void;\r\n    mapRemove: (combatant: Combatant) => void;\r\n    removeCombatant: (combatant: Combatant) => void;\r\n    addCondition: (combatant: Combatant) => void;\r\n    editCondition: (combatant: Combatant, condition: Condition) => void;\r\n    removeCondition: (combatant: Combatant, conditionID: string) => void;\r\n    nudgeConditionValue: (condition: Condition, field: string, delta: number) => void;\r\n    toggleTag: (combatant: Combatant, tag: string) => void;\r\n}\r\n\r\ninterface State {\r\n    combatMode: string;\r\n}\r\n\r\nexport default class PCCard extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        removePC: null,\r\n        editPC: null,\r\n        combat: null,\r\n        makeCurrent: null,\r\n        makeActive: null,\r\n        makeDefeated: null,\r\n        endTurn: null,\r\n        mapAdd: null,\r\n        mapMove: null,\r\n        mapRemove: null,\r\n        removeCombatant: null,\r\n        addCondition: null,\r\n        editCondition: null,\r\n        removeCondition: null,\r\n        nudgeConditionValue: null,\r\n        toggleTag: null\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            combatMode: 'main'\r\n        };\r\n    }\r\n\r\n    private setCombatMode(mode: string) {\r\n        this.setState({\r\n            combatMode: mode\r\n        });\r\n    }\r\n\r\n    private getCombatControls() {\r\n        const combatant = this.props.combatant as Combatant;\r\n\r\n        const options = [];\r\n\r\n        const combatModes = ['main', 'cond', 'map', 'adv'].map(m => {\r\n            return {\r\n                id: m,\r\n                text: m\r\n            };\r\n        });\r\n        if (this.props.mode.indexOf('tactical') === -1) {\r\n            // No combat map, so remove the map option\r\n            combatModes.splice(2, 1);\r\n        }\r\n        options.push(\r\n            <Selector\r\n                key='selector'\r\n                options={combatModes}\r\n                selectedID={this.state.combatMode}\r\n                select={option => this.setCombatMode(option)}\r\n            />\r\n        );\r\n        options.push(<div key='selector-sep' className='divider' />);\r\n\r\n        switch (this.state.combatMode) {\r\n            case 'main':\r\n                if (combatant.pending && !combatant.active && !combatant.defeated) {\r\n                    options.push(<div key='pending' className='section'>pending initiative entry</div>);\r\n                }\r\n                if (!combatant.pending && combatant.active && !combatant.defeated) {\r\n                    if (combatant.current) {\r\n                        options.push(<button key='endTurn' onClick={() => this.props.endTurn(combatant)}>end turn</button>);\r\n                        options.push(<button key='makeDefeated' onClick={() => this.props.makeDefeated(combatant)}>mark as defeated and end turn</button>);\r\n                    } else {\r\n                        options.push(<button key='makeCurrent' onClick={() => this.props.makeCurrent(combatant)}>start turn</button>);\r\n                        options.push(<button key='makeDefeated' onClick={() => this.props.makeDefeated(combatant)}>mark as defeated</button>);\r\n                    }\r\n                }\r\n                if (!combatant.pending && !combatant.active && combatant.defeated) {\r\n                    options.push(<button key='makeActive' onClick={() => this.props.makeActive(combatant)}>mark as active</button>);\r\n                }\r\n                if (!combatant.pending && combatant.active && !combatant.defeated) {\r\n                    options.push(<div key='tag-sep' className='divider' />);\r\n                    options.push(\r\n                        <ControlRow\r\n                            key='tags'\r\n                            controls={COMBAT_TAGS.map(tag =>\r\n                                <Checkbox\r\n                                    key={tag}\r\n                                    label={tag}\r\n                                    display='button'\r\n                                    checked={combatant.tags.includes(tag)}\r\n                                    changeValue={value => this.props.toggleTag(combatant, tag)}\r\n                                />\r\n                            )}\r\n                        />\r\n                    );\r\n                }\r\n                break;\r\n            case 'cond':\r\n                options.push(\r\n                    <div key='conditions'>\r\n                        <ConditionsPanel\r\n                            combatant={this.props.combatant as Combatant}\r\n                            combat={this.props.combat}\r\n                            addCondition={() => this.props.addCondition(this.props.combatant as Combatant)}\r\n                            editCondition={condition => this.props.editCondition(this.props.combatant as Combatant, condition)}\r\n                            removeCondition={conditionID => this.props.removeCondition(this.props.combatant as Combatant, conditionID)}\r\n                            nudgeConditionValue={(condition, type, delta) => this.props.nudgeConditionValue(condition, type, delta)}\r\n                        />\r\n                    </div>\r\n                );\r\n                break;\r\n            case 'map':\r\n                if (this.props.mode.indexOf('on-map') !== -1) {\r\n                    options.push(\r\n                        <div key='mapMove' className='section centered'>\r\n                            <Radial\r\n                                direction='eight'\r\n                                click={dir => this.props.mapMove(combatant, dir)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                    options.push(<div key='move-sep' className='divider' />);\r\n                    options.push(\r\n                        <Spin\r\n                            key='altitude'\r\n                            source={this.props.combatant}\r\n                            name='altitude'\r\n                            label='altitude'\r\n                            display={value => value + ' ft.'}\r\n                            nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'altitude', delta * 5)}\r\n                        />\r\n                    );\r\n                    let auraDetails = null;\r\n                    if (combatant.aura.radius > 0) {\r\n                        const auraStyleOptions = [\r\n                            {\r\n                                id: 'square',\r\n                                text: 'square'\r\n                            },\r\n                            {\r\n                                id: 'rounded',\r\n                                text: 'rounded'\r\n                            },\r\n                            {\r\n                                id: 'circle',\r\n                                text: 'circle'\r\n                            }\r\n                        ];\r\n                        auraDetails = (\r\n                            <div>\r\n                                <Selector\r\n                                    options={auraStyleOptions}\r\n                                    selectedID={combatant.aura.style}\r\n                                    select={optionID => this.props.changeValue(combatant.aura, 'style', optionID)}\r\n                                />\r\n                                <input\r\n                                    type='color'\r\n                                    value={combatant.aura.color}\r\n                                    onChange={event => this.props.changeValue(combatant.aura, 'color', event.target.value)}\r\n                                />\r\n                            </div>\r\n                        );\r\n                    }\r\n                    options.push(\r\n                        <Expander\r\n                            key='aura'\r\n                            text='aura'\r\n                            content={(\r\n                                <div>\r\n                                    <Spin\r\n                                        source={combatant.aura}\r\n                                        name='radius'\r\n                                        label='size'\r\n                                        display={value => value + ' ft.'}\r\n                                        nudgeValue={delta => this.props.nudgeValue(combatant.aura, 'radius', delta * 5)}\r\n                                    />\r\n                                    {auraDetails}\r\n                                </div>\r\n                            )}\r\n                        />\r\n                    );\r\n                    options.push(<button key='mapRemove' onClick={() => this.props.mapRemove(combatant)}>remove from map</button>);\r\n                }\r\n                if (this.props.mode.indexOf('off-map') !== -1) {\r\n                    options.push(<button key='mapAdd' onClick={() => this.props.mapAdd(combatant)}>add to map</button>);\r\n                }\r\n                break;\r\n            case 'adv':\r\n                if (!combatant.current) {\r\n                    options.push(<ConfirmButton key='remove' text='remove from encounter' callback={() => this.props.removeCombatant(combatant)} />);\r\n                }\r\n                if (!combatant.pending) {\r\n                    options.push(\r\n                        <Expander\r\n                            key='init'\r\n                            text='change initiative score'\r\n                            content={(\r\n                                <div>\r\n                                    <Spin\r\n                                        source={this.props.combatant}\r\n                                        name='initiative'\r\n                                        label='initiative'\r\n                                        nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'initiative', delta)}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n                        />\r\n                    );\r\n                }\r\n                options.push(\r\n                    <Expander\r\n                        key='size'\r\n                        text='change size'\r\n                        content={(\r\n                            <div>\r\n                                <Spin\r\n                                    source={this.props.combatant}\r\n                                    name='displaySize'\r\n                                    label='size'\r\n                                    nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'displaySize', delta)}\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    />\r\n                );\r\n                break;\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='group-panel'>\r\n                    {options}\r\n                </div>\r\n                <div className='divider' />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const options = [];\r\n            if (this.props.mode.indexOf('edit') !== -1) {\r\n                options.push(<button key='edit' onClick={() => this.props.editPC(this.props.combatant)}>edit pc</button>);\r\n                if (this.props.combatant.active) {\r\n                    options.push(\r\n                        <button key='toggle-active' onClick={() => this.props.changeValue(this.props.combatant, 'active', false)}>\r\n                            mark pc as inactive\r\n                        </button>\r\n                    );\r\n                } else {\r\n                    options.push(\r\n                        <button key='toggle-active' onClick={() => this.props.changeValue(this.props.combatant, 'active', true)}>\r\n                            mark pc as active\r\n                        </button>\r\n                    );\r\n                }\r\n                options.push(<ConfirmButton key='remove' text='delete pc' callback={() => this.props.removePC(this.props.combatant)} />);\r\n            }\r\n\r\n            let combat = null;\r\n            if (this.props.mode.indexOf('combat') !== -1) {\r\n                combat = this.getCombatControls();\r\n            }\r\n\r\n            const desc = (this.props.combatant.race || 'unknown race')\r\n                + ' ' + (this.props.combatant.classes || 'unknown class')\r\n                + ', level ' + this.props.combatant.level;\r\n\r\n            let companions = null;\r\n            if (this.props.combatant.companions.length > 0) {\r\n                companions = this.props.combatant.companions.map(companion => (\r\n                    <div key={companion.id}>{companion.name}</div>\r\n                ));\r\n            }\r\n\r\n            const name = (this.props.combatant as Combatant ? (this.props.combatant as Combatant).displayName : null)\r\n                || this.props.combatant.name\r\n                || 'unnamed pc';\r\n\r\n            return (\r\n                <div className='card pc'>\r\n                    <div className='heading'>\r\n                        <div className='title'>\r\n                            {name}\r\n                        </div>\r\n                    </div>\r\n                    <div className='card-content'>\r\n                        <div className='stats'>\r\n                            <PortraitPanel source={this.props.combatant} />\r\n                            <div className='section centered lowercase'>\r\n                                <i>{desc}</i>\r\n                                <div style={{ display: this.props.combatant.url ? '' : 'none' }}>\r\n                                    <a href={this.props.combatant.url} target='_blank' rel='noopener noreferrer'>d&d beyond sheet</a>\r\n                                </div>\r\n                            </div>\r\n                            <div className='divider' />\r\n                            {combat}\r\n                            <div className='section subheading'>languages</div>\r\n                            <div className='section'>\r\n                                {this.props.combatant.languages || '-'}\r\n                            </div>\r\n                            <div className='section subheading'>passive skills</div>\r\n                            <div className='section'>\r\n                                <div><b>insight</b> {this.props.combatant.passiveInsight}</div>\r\n                                <div><b>investigation</b> {this.props.combatant.passiveInvestigation}</div>\r\n                                <div><b>perception</b> {this.props.combatant.passivePerception}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div style={{ display: this.props.combatant.companions.length > 0 ? '' : 'none' }}>\r\n                            <div className='section subheading'>companions</div>\r\n                            <div className='section'>\r\n                                {companions}\r\n                            </div>\r\n                        </div>\r\n                        <div style={{ display: options.length > 0 ? '' : 'none' }}>\r\n                            <div className='divider' />\r\n                            <div className='section'>\r\n                                {options}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Combatant } from '../../models/combat';\r\nimport { Monster } from '../../models/monster-group';\r\n\r\ninterface Props {\r\n    combatant: Combatant & Monster;\r\n}\r\n\r\nexport default class HitPointGauge extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const hpCurrent = this.props.combatant.hp || 0;\r\n            const hpMax = this.props.combatant.hpMax + this.props.combatant.hpTemp;\r\n            const hpBloodied = this.props.combatant.hpMax / 2;\r\n            const hpWidth = 100 * Math.max(hpCurrent, 0) / hpMax;\r\n\r\n            let style = '';\r\n            if (hpCurrent >= this.props.combatant.hpMax) {\r\n                style = 'bar unhurt';\r\n            } else if (hpCurrent <= hpBloodied) {\r\n                style = 'bar bloodied';\r\n            } else {\r\n                style = 'bar injured';\r\n            }\r\n\r\n            let hpTempBar = null;\r\n            if (this.props.combatant.hpTemp > 0) {\r\n                const hpTempWidth = 100 * Math.max(this.props.combatant.hpTemp, 0) / hpMax;\r\n                hpTempBar = <div className='bar temp' style={{ width: hpTempWidth + '%' }} />;\r\n            }\r\n\r\n            return (\r\n                <div className='hp-gauge'>\r\n                    <div className={style} style={{ width: hpWidth + '%' }} />\r\n                    {hpTempBar}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Combatant } from '../../models/combat';\r\nimport { Map, MapItem } from '../../models/map-folio';\r\nimport { Monster } from '../../models/monster-group';\r\nimport { PC } from '../../models/party';\r\n\r\nimport HitPointGauge from './hit-point-gauge';\r\n\r\nimport none from '../../resources/images/no-portrait.png';\r\n\r\ninterface Props {\r\n    map: Map;\r\n    mode: 'edit' | 'thumbnail' | 'combat' | 'combat-player';\r\n    size: number;\r\n    combatants: ((Combatant & PC) | (Combatant & Monster))[];\r\n    showOverlay: boolean;\r\n    selectedItemID: string;\r\n    setSelectedItemID: (itemID: string | null) => void;\r\n    gridSquareClicked: (x: number, y: number) => void;\r\n}\r\n\r\ninterface MapDimensions {\r\n    minX: number;\r\n    maxX: number;\r\n    minY: number;\r\n    maxY: number;\r\n}\r\n\r\ninterface MapItemStyle {\r\n    left: string;\r\n    top: string;\r\n    width: string;\r\n    height: string;\r\n    borderRadius: string;\r\n    backgroundSize: string;\r\n    backgroundColor?: string;\r\n}\r\n\r\nexport default class MapPanel extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        combatants: null,\r\n        showOverlay: false,\r\n        selectedItemID: null,\r\n        setSelectedItemID: null,\r\n        gridSquareClicked: null\r\n    };\r\n\r\n    private setZoom(value: number) {\r\n        this.setState({\r\n            zoom: Math.max(5, value)\r\n        });\r\n    }\r\n\r\n    private getMapDimensions(border: number): MapDimensions | null {\r\n        let dimensions: MapDimensions | null = null;\r\n\r\n        this.props.map.items.filter(i => {\r\n            if (this.props.mode === 'edit') {\r\n                return i.type === 'tile';\r\n            }\r\n            return true;\r\n        }).forEach(i => {\r\n            if (!dimensions) {\r\n                dimensions = {\r\n                    minX: i.x,\r\n                    maxX: i.x + i.width - 1,\r\n                    minY: i.y,\r\n                    maxY: i.y + i.height - 1\r\n                };\r\n            } else {\r\n                dimensions.minX = Math.min(dimensions.minX, i.x);\r\n                dimensions.maxX = Math.max(dimensions.maxX, i.x + i.width - 1);\r\n                dimensions.minY = Math.min(dimensions.minY, i.y);\r\n                dimensions.maxY = Math.max(dimensions.maxY, i.y + i.height - 1);\r\n            }\r\n        });\r\n\r\n        if (this.props.combatants) {\r\n            this.props.combatants.filter(c => c.aura.radius > 0).forEach(c => {\r\n                const mi = this.props.map.items.find(i => i.id === c.id);\r\n                if (mi) {\r\n                    const sizeInSquares = c.aura.radius / 5;\r\n                    let miniSize = 1;\r\n                    const m = c as Monster;\r\n                    if (m) {\r\n                        miniSize = Utils.miniSize(m.size);\r\n                    }\r\n                    const minX = mi.x - sizeInSquares;\r\n                    const maxX = mi.x + (miniSize - 1) + sizeInSquares;\r\n                    const minY = mi.y - sizeInSquares;\r\n                    const maxY = mi.y + (miniSize - 1) + sizeInSquares;\r\n\r\n                    if (dimensions) {\r\n                        dimensions.minX = Math.min(dimensions.minX, minX);\r\n                        dimensions.maxX = Math.max(dimensions.maxX, maxX);\r\n                        dimensions.minY = Math.min(dimensions.minY, minY);\r\n                        dimensions.maxY = Math.max(dimensions.maxY, maxY);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (!dimensions) {\r\n            // The map is blank\r\n            if (this.props.mode === 'thumbnail') {\r\n                return null;\r\n            }\r\n\r\n            dimensions = {\r\n                minX: 0,\r\n                maxX: 0,\r\n                minY: 0,\r\n                maxY: 0\r\n            };\r\n        }\r\n\r\n        // Apply the border\r\n        dimensions.minX -= border;\r\n        dimensions.maxX += border;\r\n        dimensions.minY -= border;\r\n        dimensions.maxY += border;\r\n\r\n        return dimensions;\r\n    }\r\n\r\n    private getStyle(x: number, y: number, width: number, height: number, style: 'square' | 'rounded' | 'circle' | null, dim: MapDimensions): MapItemStyle {\r\n        let offsetX = 0;\r\n        let offsetY = 0;\r\n        if (width < 1) {\r\n            offsetX = (1 - width) / 2;\r\n        }\r\n        if (height < 1) {\r\n            offsetY = (1 - height) / 2;\r\n        }\r\n\r\n        let radius = '0';\r\n        switch (style) {\r\n            case 'rounded':\r\n                radius = this.props.size + 'px';\r\n                break;\r\n            case 'circle':\r\n                radius = '50%';\r\n                break;\r\n        }\r\n\r\n        return {\r\n            left: 'calc(' + this.props.size + 'px * ' + (x + offsetX - dim.minX) + ')',\r\n            top: 'calc(' + this.props.size + 'px * ' + (y + offsetY - dim.minY) + ')',\r\n            width: 'calc((' + this.props.size + 'px * ' + width + ') + 1px)',\r\n            height: 'calc((' + this.props.size + 'px * ' + height + ') + 1px)',\r\n            borderRadius: radius,\r\n            backgroundSize: this.props.size + 'px'\r\n        };\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const border = (this.props.mode === 'edit') ? 2 : 0;\r\n            const mapDimensions = this.getMapDimensions(border);\r\n            if (!mapDimensions) {\r\n                return (\r\n                    <div>(blank map)</div>\r\n                );\r\n            }\r\n\r\n            // Draw the grid squares\r\n            const grid = [];\r\n            if (this.props.mode === 'edit') {\r\n                for (let y = mapDimensions.minY; y !== mapDimensions.maxY + 1; ++y) {\r\n                    for (let x = mapDimensions.minX; x !== mapDimensions.maxX + 1; ++x) {\r\n                        const gridStyle = this.getStyle(x, y, 1, 1, 'square', mapDimensions);\r\n                        grid.push(\r\n                            <GridSquare\r\n                                key={x + ',' + y}\r\n                                x={x}\r\n                                y={y}\r\n                                style={gridStyle}\r\n                                onClick={() => this.props.setSelectedItemID(null)}\r\n                            />\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Draw the map tiles\r\n            const tiles = this.props.map.items\r\n                .filter(i => i.type === 'tile')\r\n                .map(i => {\r\n                    const tileStyle = this.getStyle(i.x, i.y, i.width, i.height, i.style, mapDimensions);\r\n                    return (\r\n                        <MapTile\r\n                            key={i.id}\r\n                            tile={i}\r\n                            style={tileStyle}\r\n                            selectable={this.props.mode === 'edit'}\r\n                            selected={this.props.selectedItemID === i.id}\r\n                            select={id => this.props.mode === 'edit' ? this.props.setSelectedItemID(id) : null}\r\n                        />\r\n                    );\r\n                });\r\n\r\n            // Draw token auras\r\n            let auras: JSX.Element[] = [];\r\n            if ((this.props.mode !== 'edit') && (this.props.mode !== 'thumbnail')) {\r\n                auras = this.props.combatants\r\n                    .filter(c => c.aura.radius > 0)\r\n                    .filter(c => c.showOnMap || (this.props.mode !== 'combat-player'))\r\n                    .map(c => {\r\n                        const mi = this.props.map.items.find(i => i.id === c.id);\r\n                        if (mi) {\r\n                            const sizeInSquares = c.aura.radius / 5;\r\n                            const miniSize = Utils.miniSize(c.displaySize);\r\n                            const dim = (sizeInSquares * 2) + miniSize;\r\n                            const auraStyle = this.getStyle(mi.x - sizeInSquares, mi.y - sizeInSquares, dim, dim, c.aura.style, mapDimensions);\r\n                            auraStyle.backgroundColor = c.aura.color;\r\n                            return (\r\n                                <div\r\n                                    key={c.id + ' aura'}\r\n                                    className={'aura'}\r\n                                    style={auraStyle}\r\n                                />\r\n                            );\r\n                        }\r\n                        return null;\r\n                    })\r\n                    .filter(mt => mt !== null) as JSX.Element[];\r\n            }\r\n\r\n            // Draw the tokens\r\n            let tokens: JSX.Element[] = [];\r\n            if (this.props.mode !== 'edit') {\r\n                tokens = this.props.map.items\r\n                    .filter(i => (i.type === 'monster') || (i.type === 'pc'))\r\n                    .map(i => {\r\n                        const combatant = this.props.combatants.find(c => c.id === i.id);\r\n                        if (combatant) {\r\n                            const miniSize = Utils.miniSize(combatant.displaySize);\r\n                            const tokenStyle = this.getStyle(i.x, i.y, miniSize, miniSize, 'circle', mapDimensions);\r\n                            return (\r\n                                <MapToken\r\n                                    key={i.id}\r\n                                    token={i}\r\n                                    combatant={combatant}\r\n                                    style={tokenStyle}\r\n                                    simple={this.props.mode === 'thumbnail'}\r\n                                    showGauge={this.props.mode === 'combat'}\r\n                                    showHidden={this.props.mode === 'combat'}\r\n                                    selectable={(this.props.mode === 'combat') || (this.props.mode === 'combat-player')}\r\n                                    selected={this.props.selectedItemID ===  i.id}\r\n                                    select={id => this.props.setSelectedItemID(id)}\r\n                                />\r\n                            );\r\n                        }\r\n\r\n                        return null;\r\n                    })\r\n                    .filter(mt => mt !== null) as JSX.Element[];\r\n            }\r\n\r\n            // Draw the drag overlay\r\n            const dragOverlay = [];\r\n            if (this.props.showOverlay) {\r\n                for (let yOver = mapDimensions.minY; yOver !== mapDimensions.maxY + 1; ++yOver) {\r\n                    for (let xOver = mapDimensions.minX; xOver !== mapDimensions.maxX + 1; ++xOver) {\r\n                        const overlayStyle = this.getStyle(xOver, yOver, 1, 1, 'square', mapDimensions);\r\n                        dragOverlay.push(\r\n                            <GridSquare\r\n                                key={xOver + ',' + yOver}\r\n                                x={xOver}\r\n                                y={yOver}\r\n                                style={overlayStyle}\r\n                                overlay={true}\r\n                                onClick={(posX, posY) => this.props.gridSquareClicked(posX, posY)}\r\n                            />\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n\r\n            const style = 'map-panel ' + this.props.mode;\r\n            const mapHeight = 1 + mapDimensions.maxY - mapDimensions.minY;\r\n            return (\r\n                <div className={style} onClick={() => this.props.setSelectedItemID(null)}>\r\n                    <div className='grid' style={{ height: ((this.props.size * mapHeight) + 1) + 'px' }}>\r\n                        {grid}\r\n                        {tiles}\r\n                        {auras}\r\n                        {tokens}\r\n                        {dragOverlay}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface GridSquareProps {\r\n    x: number;\r\n    y: number;\r\n    style: MapItemStyle;\r\n    overlay: boolean;\r\n    onClick: (x: number, y: number) => void;\r\n    onDoubleClick: (x: number, y: number) => void;\r\n}\r\n\r\nclass GridSquare extends React.Component<GridSquareProps> {\r\n    public static defaultProps = {\r\n        overlay: false,\r\n        onDoubleClick: null\r\n    };\r\n\r\n    private click(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        if (this.props.onClick) {\r\n            this.props.onClick(this.props.x, this.props.y);\r\n        }\r\n    }\r\n\r\n    private doubleClick(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        if (this.props.onDoubleClick) {\r\n            this.props.onDoubleClick(this.props.x, this.props.y);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        let style = 'grid-square';\r\n        if (this.props.overlay) {\r\n            style += ' grid-overlay';\r\n        }\r\n\r\n        return (\r\n            <div\r\n                className={style}\r\n                style={this.props.style}\r\n                onClick={e => this.click(e)}\r\n                onDoubleClick={e => this.doubleClick(e)}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\ninterface MapTileProps {\r\n    tile: MapItem;\r\n    style: MapItemStyle;\r\n    selectable: boolean;\r\n    selected: boolean;\r\n    select: (tileID: string) => void;\r\n}\r\n\r\nclass MapTile extends React.Component<MapTileProps> {\r\n    private select(e: React.MouseEvent) {\r\n        if (this.props.selectable) {\r\n            e.stopPropagation();\r\n            this.props.select(this.props.tile.id);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        let style = 'tile ' + this.props.tile.terrain;\r\n        if (this.props.selected) {\r\n            style += ' selected';\r\n        }\r\n\r\n        let content = null;\r\n        if (this.props.tile.terrain === 'custom') {\r\n            content = (\r\n                <img className='custom-image' src={this.props.tile.customBackground ? this.props.tile.customBackground : none} alt='map tile' />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div\r\n                className={style}\r\n                style={this.props.style}\r\n                onClick={e => this.select(e)}\r\n            >\r\n                {content}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ninterface MapTokenProps {\r\n    token: MapItem;\r\n    combatant: (Combatant & PC) | (Combatant & Monster);\r\n    style: MapItemStyle;\r\n    simple: boolean;\r\n    showGauge: boolean;\r\n    showHidden: boolean;\r\n    selectable: boolean;\r\n    selected: boolean;\r\n    select: (tokenID: string) => void;\r\n}\r\n\r\nclass MapToken extends React.Component<MapTokenProps> {\r\n    private select(e: React.MouseEvent) {\r\n        if (this.props.selectable) {\r\n            e.stopPropagation();\r\n            this.props.select(this.props.token.id);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const name = this.props.combatant.displayName || this.props.combatant.name || 'combatant';\r\n\r\n        let style = 'token ' + this.props.token.type;\r\n        if (this.props.selected) {\r\n            style += ' selected';\r\n        }\r\n        if (this.props.combatant.current) {\r\n            style += ' current';\r\n        }\r\n        if (!this.props.combatant.showOnMap) {\r\n            if (this.props.showHidden) {\r\n                style += ' hidden';\r\n            } else {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        let content = null;\r\n        let hpGauge = null;\r\n        let altitudeBadge = null;\r\n        let conditionsBadge = null;\r\n        if (!this.props.simple) {\r\n            if (this.props.combatant.portrait) {\r\n                content = (\r\n                    <img className='portrait' src={this.props.combatant.portrait} alt={name} />\r\n                );\r\n            } else {\r\n                content = (\r\n                    <div className='initials'>{name.split(' ').map(s => s[0])}</div>\r\n                );\r\n            }\r\n\r\n            if (this.props.combatant.type === 'monster' && this.props.showGauge) {\r\n                const c = this.props.combatant as Combatant & Monster;\r\n                const current = c.hp || 0;\r\n                if (current < c.hpMax) {\r\n                    hpGauge = (\r\n                        <HitPointGauge combatant={this.props.combatant as Combatant & Monster} />\r\n                    );\r\n                }\r\n            }\r\n\r\n            if (this.props.combatant.altitude > 0) {\r\n                altitudeBadge = (\r\n                    <div className='badge altitude' title='above the map'>&#9206;</div>\r\n                );\r\n            }\r\n\r\n            if (this.props.combatant.altitude < 0) {\r\n                altitudeBadge = (\r\n                    <div className='badge altitude' title='below the map'>&#9207;</div>\r\n                );\r\n            }\r\n\r\n            if ((this.props.combatant.conditions) && (this.props.combatant.conditions.length > 0)) {\r\n                conditionsBadge = (\r\n                    <div className='badge' title='affected by conditions'>&#9670;</div>\r\n                );\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div\r\n                className={style}\r\n                style={this.props.style}\r\n                title={name}\r\n                onClick={e => this.select(e)}\r\n            >\r\n                {content}\r\n                {hpGauge}\r\n                {altitudeBadge}\r\n                {conditionsBadge}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Combat } from '../../models/combat';\r\n\r\nimport MapPanel from '../panels/map-panel';\r\n\r\ninterface Props {\r\n    combat: Combat;\r\n    selected: boolean;\r\n    setSelection: (combat: Combat) => void;\r\n}\r\n\r\nexport default class CombatListItem extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            let map = null;\r\n            if (this.props.combat.map) {\r\n                map = (\r\n                    <MapPanel\r\n                        map={this.props.combat.map}\r\n                        mode='thumbnail'\r\n                        size={10}\r\n                        combatants={this.props.combat.combatants}\r\n                    />\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className={this.props.selected ? 'list-item selected' : 'list-item'} onClick={() => this.props.setSelection(this.props.combat)}>\r\n                    <div className='heading'>{this.props.combat.name || 'unnamed combat'}</div>\r\n                    <div className='section'>paused at {this.props.combat.timestamp}</div>\r\n                    {map}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport arrow from '../../resources/icons/down-arrow-black.svg';\r\nimport close from '../../resources/icons/x.svg';\r\n\r\ninterface Props {\r\n    content: any[];\r\n    heading: string;\r\n    hidden: boolean;\r\n    showToggle: boolean;\r\n    close: () => void;\r\n}\r\n\r\ninterface State {\r\n    showCards: boolean;\r\n}\r\n\r\nexport default class CardGroup extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        heading: null,\r\n        hidden: false,\r\n        showToggle: false,\r\n        close: null\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            showCards: true\r\n        };\r\n    }\r\n\r\n    private toggleCards() {\r\n        this.setState({\r\n            showCards: !this.state.showCards\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            if (this.props.hidden) {\r\n                return null;\r\n            }\r\n\r\n            let heading = null;\r\n            if (this.props.heading) {\r\n                let closeBtn = null;\r\n                if (this.props.close) {\r\n                    closeBtn = (\r\n                        <img className='image' src={close} alt='close' onClick={() => this.props.close()} />\r\n                    );\r\n                }\r\n\r\n                let toggle = null;\r\n                if (this.props.showToggle) {\r\n                    const style = this.state.showCards ? 'image rotate' : 'image';\r\n                    toggle = (\r\n                        <img className={style} src={arrow} alt='arrow' onClick={() => this.toggleCards()} />\r\n                    );\r\n                }\r\n\r\n                heading = (\r\n                    <div className='heading'>\r\n                        <div className='title'>{this.props.heading}</div>\r\n                        {toggle}\r\n                        {closeBtn}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            let cards = [];\r\n            if ((this.props.content.length > 0) && this.state.showCards) {\r\n                cards = this.props.content;\r\n            }\r\n\r\n            return (\r\n                <div className='card-group'>\r\n                    {heading}\r\n                    <div className='row small-up-1 medium-up-2 large-up-3 collapse'>\r\n                        {cards}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\ninterface Props {\r\n    title: string;\r\n    closeWindow: () => void;\r\n}\r\n\r\ninterface State {\r\n    externalWindow: Window | null;\r\n    containerElement: HTMLElement | null;\r\n}\r\n\r\nexport default class Popout extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            externalWindow: null,\r\n            containerElement: null\r\n        };\r\n    }\r\n\r\n    public componentDidMount() {\r\n        const externalWindow = window.open('', '', 'width=800, height=500, left=200, top=200');\r\n\r\n        let containerElement = null;\r\n        if (externalWindow) {\r\n            containerElement = externalWindow.document.createElement('div');\r\n            containerElement.className = 'dojo popout';\r\n            externalWindow.document.body.appendChild(containerElement);\r\n\r\n            const stylesheets = Array.from(document.styleSheets);\r\n            stylesheets.forEach(stylesheet => {\r\n                const css = stylesheet as CSSStyleSheet;\r\n\r\n                if (stylesheet.href) {\r\n                    const newStyleElement = document.createElement('link');\r\n                    newStyleElement.rel = 'stylesheet';\r\n                    newStyleElement.href = stylesheet.href;\r\n                    externalWindow.document.head.appendChild(newStyleElement);\r\n                } else if (css && css.cssRules && css.cssRules.length > 0) {\r\n                    const newStyleElement = document.createElement('style');\r\n                    Array.from(css.cssRules).forEach(rule => {\r\n                        newStyleElement.appendChild(document.createTextNode(rule.cssText));\r\n                    });\r\n                    externalWindow.document.head.appendChild(newStyleElement);\r\n                }\r\n            });\r\n\r\n            externalWindow.document.title = this.props.title;\r\n            externalWindow.addEventListener('beforeunload', () => {\r\n                this.props.closeWindow();\r\n            });\r\n        }\r\n\r\n        this.setState({\r\n            externalWindow: externalWindow,\r\n            containerElement: containerElement\r\n        });\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        if (this.state.externalWindow) {\r\n            this.state.externalWindow.close();\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        if (!this.state.containerElement) {\r\n            return null;\r\n        }\r\n\r\n        return ReactDOM.createPortal(this.props.children, this.state.containerElement);\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Combat, COMBAT_TAGS, Combatant, Notification } from '../../models/combat';\r\nimport { Condition, ConditionDurationSaves } from '../../models/condition';\r\nimport { Monster, Trait } from '../../models/monster-group';\r\nimport { PC } from '../../models/party';\r\n\r\nimport MonsterCard from '../cards/monster-card';\r\nimport PCCard from '../cards/pc-card';\r\nimport Checkbox from '../controls/checkbox';\r\nimport ControlRow from '../controls/control-row';\r\nimport Radial from '../controls/radial';\r\nimport Spin from '../controls/spin';\r\nimport CombatListItem from '../list-items/combat-list-item';\r\nimport CardGroup from '../panels/card-group';\r\nimport HitPointGauge from '../panels/hit-point-gauge';\r\nimport MapPanel from '../panels/map-panel';\r\nimport Note from '../panels/note';\r\nimport TraitsPanel from '../panels/traits-panel';\r\nimport Popout from '../portals/popout';\r\n\r\ninterface Props {\r\n    combats: Combat[];\r\n    combat: Combat | null;\r\n    filter: string;\r\n    createCombat: () => void;\r\n    resumeEncounter: (combat: Combat) => void;\r\n    close: (notification: Notification, removeCondition: boolean) => void;\r\n    mapAdd: (combatant: (Combatant & PC) | (Combatant & Monster), x: number, y: number) => void;\r\n    makeCurrent: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    makeActive: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    makeDefeated: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    removeCombatant: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    addCondition: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    editCondition: (combatant: (Combatant & PC) | (Combatant & Monster), condition: Condition) => void;\r\n    removeCondition: (combatant: (Combatant & PC) | (Combatant & Monster), conditionID: string) => void;\r\n    mapMove: (combatant: (Combatant & PC) | (Combatant & Monster), dir: string) => void;\r\n    mapRemove: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    endTurn: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    changeHP: (combatant: Combatant & Monster, hp: number, temp: number) => void;\r\n    changeValue: (source: {}, type: string, value: any) => void;\r\n    nudgeValue: (source: {}, type: string, delta: number) => void;\r\n    toggleTag: (combatant: Combatant, tag: string) => void;\r\n    scatterCombatants: (type: 'pc' | 'monster') => void;\r\n    rotateMap: () => void;\r\n}\r\n\r\ninterface State {\r\n    selectedTokenID: string | null;\r\n    addingToMapID: string | null;\r\n    mapSize: number;\r\n    playerView: {\r\n        open: boolean;\r\n        showControls: boolean;\r\n        mapSize: number;\r\n    };\r\n}\r\n\r\nexport default class CombatManagerScreen extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            selectedTokenID: null,  // The ID of the combatant that's selected\r\n            addingToMapID: null,    // The ID of the combatant we're adding to the map\r\n            mapSize: 30,\r\n            playerView: {\r\n                open: false,\r\n                showControls: true,\r\n                mapSize: 30\r\n            }\r\n        };\r\n    }\r\n\r\n    public componentDidMount() {\r\n        window.addEventListener('beforeunload', () => {\r\n            this.setPlayerViewOpen(false);\r\n        });\r\n    }\r\n\r\n    private setSelectedTokenID(id: string | null) {\r\n        this.setState({\r\n            selectedTokenID: id\r\n        });\r\n    }\r\n\r\n    private setAddingToMapID(id: string | null) {\r\n        this.setState({\r\n            addingToMapID: id\r\n        });\r\n    }\r\n\r\n    private nudgeMapSize(value: number) {\r\n        this.setState({\r\n            mapSize: this.state.mapSize + value\r\n        });\r\n    }\r\n\r\n    private setPlayerViewOpen(show: boolean) {\r\n        // eslint-disable-next-line\r\n        this.state.playerView.open = show;\r\n        this.setState({\r\n            playerView: this.state.playerView\r\n        });\r\n    }\r\n\r\n    private setPlayerViewShowControls(show: boolean) {\r\n        // eslint-disable-next-line\r\n        this.state.playerView.showControls = show;\r\n        this.setState({\r\n            playerView: this.state.playerView\r\n        });\r\n    }\r\n\r\n    private nudgePlayerViewMapSize(value: number) {\r\n        // eslint-disable-next-line\r\n        this.state.playerView.mapSize = this.state.playerView.mapSize + value;\r\n        this.setState({\r\n            playerView: this.state.playerView\r\n        });\r\n    }\r\n\r\n    private getPlayerView(combat: Combat) {\r\n        if (!this.state.playerView.open) {\r\n            return null;\r\n        }\r\n\r\n        const init = combat.combatants\r\n            .filter(c => c.showOnMap)\r\n            .filter(combatant => !combatant.pending && combatant.active && !combatant.defeated)\r\n            .map(combatant => {\r\n                switch (combatant.type) {\r\n                    case 'pc':\r\n                        return (\r\n                            <PCRow\r\n                                key={combatant.id}\r\n                                combatant={combatant as Combatant & PC}\r\n                                minimal={true}\r\n                                combat={this.props.combat as Combat}\r\n                                select={c => this.setSelectedTokenID(c.id)}\r\n                                selected={combatant.id === this.state.selectedTokenID}\r\n                            />\r\n                        );\r\n                    case 'monster':\r\n                        return (\r\n                            <MonsterRow\r\n                                key={combatant.id}\r\n                                combatant={combatant as Combatant & Monster}\r\n                                minimal={true}\r\n                                combat={this.props.combat as Combat}\r\n                                select={c => this.setSelectedTokenID(c.id)}\r\n                                selected={combatant.id === this.state.selectedTokenID}\r\n                            />\r\n                        );\r\n                    default:\r\n                        return null;\r\n                }\r\n            });\r\n\r\n        if (combat.map) {\r\n            let controls = null;\r\n            if (combat.map && this.state.playerView.showControls) {\r\n                let selection = combat.combatants\r\n                    .filter(c => combat.map !== null ? combat.map.items.find(item => item.id === c.id) : false)\r\n                    .filter(c => c.showOnMap)\r\n                    .find(c => c.id === this.state.selectedTokenID);\r\n                if (!selection) {\r\n                    selection = combat.combatants\r\n                        .filter(c => combat.map !== null ? combat.map.items.find(item => item.id === c.id) : false)\r\n                        .filter(c => c.showOnMap)\r\n                        .find(c => c.current);\r\n                }\r\n\r\n                if (selection) {\r\n                    const token = selection as ((Combatant & PC) | (Combatant & Monster));\r\n                    controls = (\r\n                        <div>\r\n                            <div className='heading lowercase'>{token.displayName}</div>\r\n                            <div className='section centered'>\r\n                                <Radial\r\n                                    direction='eight'\r\n                                    click={dir => this.props.mapMove(token, dir)}\r\n                                />\r\n                            </div>\r\n                            <div className='divider' />\r\n                            <Spin\r\n                                key='altitude'\r\n                                source={token}\r\n                                name='altitude'\r\n                                label='altitude'\r\n                                display={value => value + ' ft.'}\r\n                                nudgeValue={delta => this.props.nudgeValue(token, 'altitude', delta * 5)}\r\n                            />\r\n                            <ControlRow\r\n                                key='tags'\r\n                                controls={COMBAT_TAGS.map(tag =>\r\n                                    <Checkbox\r\n                                        key={tag}\r\n                                        label={tag}\r\n                                        display='button'\r\n                                        checked={token.tags.includes(tag)}\r\n                                        changeValue={value => this.props.toggleTag(token, tag)}\r\n                                    />\r\n                                )}\r\n                            />\r\n                        </div>\r\n                    );\r\n                }\r\n            }\r\n\r\n            return (\r\n                <Popout title='Encounter' closeWindow={() => this.setPlayerViewOpen(false)}>\r\n                    <div className='row'>\r\n                        <div className='columns small-12 medium-6 large-8 scrollable scrollable-both'>\r\n                            <MapPanel\r\n                                key='map'\r\n                                map={combat.map}\r\n                                mode='combat-player'\r\n                                size={this.state.playerView.mapSize}\r\n                                combatants={combat.combatants}\r\n                                selectedItemID={this.state.selectedTokenID ? this.state.selectedTokenID : undefined}\r\n                                setSelectedItemID={id => this.setSelectedTokenID(id)}\r\n                            />\r\n                        </div>\r\n                        <div className='columns small-12 medium-6 large-4 scrollable'>\r\n                            {controls}\r\n                            <div className='heading'>initiative order</div>\r\n                            {init}\r\n                        </div>\r\n                    </div>\r\n                </Popout>\r\n            );\r\n        } else {\r\n            return (\r\n                <Popout title='Encounter' closeWindow={() => this.setPlayerViewOpen(false)}>\r\n                    <div className='row'>\r\n                        <div className='columns small-12 medium-12 large-12 scrollable'>\r\n                            <div className='heading'>initiative order</div>\r\n                            {init}\r\n                        </div>\r\n                    </div>\r\n                </Popout>\r\n            );\r\n        }\r\n    }\r\n\r\n    private createCard(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        let mode = 'combat';\r\n        if (this.props.combat && this.props.combat.map) {\r\n            mode += ' tactical';\r\n            const onMap = this.props.combat.map.items.find(i => i.id === combatant.id);\r\n            mode += onMap ? ' on-map' : ' off-map';\r\n        }\r\n\r\n        switch (combatant.type) {\r\n            case 'pc':\r\n                return (\r\n                    <PCCard\r\n                        key='selected'\r\n                        combatant={combatant as Combatant & PC}\r\n                        mode={mode}\r\n                        combat={this.props.combat as Combat}\r\n                        changeValue={(source, type, value) => this.props.changeValue(source, type, value)}\r\n                        nudgeValue={(source, type, delta) => this.props.nudgeValue(source, type, delta)}\r\n                        makeCurrent={c => this.props.makeCurrent(c as Combatant & PC)}\r\n                        makeActive={c => this.props.makeActive(c as Combatant & PC)}\r\n                        makeDefeated={c => this.defeatCombatant(c as Combatant & PC)}\r\n                        removeCombatant={c => this.props.removeCombatant(c as Combatant & PC)}\r\n                        addCondition={c => this.props.addCondition(c as Combatant & Monster)}\r\n                        editCondition={(c, condition) => this.props.editCondition(c as Combatant & Monster, condition)}\r\n                        removeCondition={(c, conditionID) => this.props.removeCondition(c as Combatant & Monster, conditionID)}\r\n                        nudgeConditionValue={(c, type, delta) => this.props.nudgeValue(c, type, delta)}\r\n                        mapAdd={c => this.setAddingToMapID(this.state.addingToMapID ? null : c.id)}\r\n                        mapMove={(c, dir) => this.props.mapMove(c as Combatant & PC, dir)}\r\n                        mapRemove={c => this.props.mapRemove(c as Combatant & PC)}\r\n                        endTurn={c => this.props.endTurn(c as Combatant & PC)}\r\n                        toggleTag={(c, tag) => this.props.toggleTag(c, tag)}\r\n                    />\r\n                );\r\n            case 'monster':\r\n                return (\r\n                    <MonsterCard\r\n                        key='selected'\r\n                        combatant={combatant as Combatant & Monster}\r\n                        mode={mode}\r\n                        combat={this.props.combat as Combat}\r\n                        changeValue={(c, type, value) => this.props.changeValue(c, type, value)}\r\n                        nudgeValue={(c, type, delta) => this.props.nudgeValue(c, type, delta)}\r\n                        makeCurrent={c => this.props.makeCurrent(c as Combatant & Monster)}\r\n                        makeActive={c => this.props.makeActive(c as Combatant & Monster)}\r\n                        makeDefeated={c => this.defeatCombatant(c as Combatant & Monster)}\r\n                        removeCombatant={c => this.props.removeCombatant(c as Combatant & Monster)}\r\n                        addCondition={c => this.props.addCondition(c as Combatant & Monster)}\r\n                        editCondition={(c, condition) => this.props.editCondition(c as Combatant & Monster, condition)}\r\n                        removeCondition={(c, conditionID) => this.props.removeCondition(c as Combatant & Monster, conditionID)}\r\n                        nudgeConditionValue={(c, type, delta) => this.props.nudgeValue(c, type, delta)}\r\n                        mapAdd={c => this.setAddingToMapID(this.state.addingToMapID ? null : c.id)}\r\n                        mapMove={(c, dir) => this.props.mapMove(c as Combatant & Monster, dir)}\r\n                        mapRemove={c => this.props.mapRemove(c as Combatant & Monster)}\r\n                        endTurn={(c) => this.props.endTurn(c as Combatant & Monster)}\r\n                        changeHP={(c, hp, temp) => this.props.changeHP(c as Combatant & Monster, hp, temp)}\r\n                        toggleTag={(c, tag) => this.props.toggleTag(c, tag)}\r\n                    />\r\n                );\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    private defeatCombatant(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        if (this.state.selectedTokenID === combatant.id) {\r\n            this.setState({\r\n                selectedTokenID: null\r\n            });\r\n        }\r\n\r\n        this.props.makeDefeated(combatant);\r\n    }\r\n\r\n    private addCombatantToMap(x: number, y: number) {\r\n        if (this.props.combat) {\r\n            const combatant = this.props.combat.combatants.find(c => c.id === this.state.addingToMapID);\r\n            if (combatant) {\r\n                this.props.mapAdd(combatant, x, y);\r\n            }\r\n            this.setAddingToMapID(null);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            if (this.props.combat) {\r\n                const current: JSX.Element[] = [];\r\n                let pending: JSX.Element[] = [];\r\n                let active: JSX.Element[] = [];\r\n                const defeated: JSX.Element[] = [];\r\n\r\n                this.props.combat.combatants.forEach(combatant => {\r\n                    if (combatant.current) {\r\n                        current.push(\r\n                            <div key={combatant.id}>\r\n                                {this.createCard(combatant)}\r\n                            </div>\r\n                        );\r\n                    }\r\n                    if (combatant.pending && !combatant.active && !combatant.defeated) {\r\n                        pending.push(\r\n                            <PendingCombatantRow\r\n                                key={combatant.id}\r\n                                combatant={combatant}\r\n                                select={c => this.setSelectedTokenID(c.id)}\r\n                                selected={combatant.id === this.state.selectedTokenID}\r\n                                nudgeValue={(c, type, delta) => this.props.nudgeValue(c, type, delta)}\r\n                                makeActive={c => this.props.makeActive(c)}\r\n                            />\r\n                        );\r\n                    }\r\n                    if (!combatant.pending && combatant.active && !combatant.defeated) {\r\n                        switch (combatant.type) {\r\n                            case 'pc':\r\n                                active.push(\r\n                                    <PCRow\r\n                                        key={combatant.id}\r\n                                        combatant={combatant as Combatant & PC}\r\n                                        combat={this.props.combat as Combat}\r\n                                        select={c => this.setSelectedTokenID(c.id)}\r\n                                        selected={combatant.id === this.state.selectedTokenID}\r\n                                    />\r\n                                );\r\n                                break;\r\n                            case 'monster':\r\n                                active.push(\r\n                                    <MonsterRow\r\n                                        key={combatant.id}\r\n                                        combatant={combatant as Combatant & Monster}\r\n                                        combat={this.props.combat as Combat}\r\n                                        select={c => this.setSelectedTokenID(c.id)}\r\n                                        selected={combatant.id === this.state.selectedTokenID}\r\n                                    />\r\n                                );\r\n                                break;\r\n                        }\r\n                    }\r\n                    if (!combatant.pending && !combatant.active && combatant.defeated) {\r\n                        switch (combatant.type) {\r\n                            case 'pc':\r\n                                defeated.push(\r\n                                    <PCRow\r\n                                        key={combatant.id}\r\n                                        combatant={combatant as Combatant & PC}\r\n                                        combat={this.props.combat as Combat}\r\n                                        select={c => this.setSelectedTokenID(c.id)}\r\n                                        selected={combatant.id === this.state.selectedTokenID}\r\n                                    />\r\n                                );\r\n                                break;\r\n                            case 'monster':\r\n                                defeated.push(\r\n                                    <MonsterRow\r\n                                        key={combatant.id}\r\n                                        combatant={combatant as Combatant & Monster}\r\n                                        combat={this.props.combat as Combat}\r\n                                        select={c => this.setSelectedTokenID(c.id)}\r\n                                        selected={combatant.id === this.state.selectedTokenID}\r\n                                    />\r\n                                );\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (pending.length !== 0) {\r\n                    const pendingHelp = (\r\n                        <div key='pending-help'>\r\n                            <Note\r\n                                content={\r\n                                    <div>\r\n                                        <div className='section'>these combatants are not yet part of the encounter</div>\r\n                                        <div className='section'>set initiative on each of them, then add them to the encounter</div>\r\n                                    </div>\r\n                                }\r\n                            />\r\n                        </div>\r\n                    );\r\n                    pending = [pendingHelp].concat(pending);\r\n                }\r\n\r\n                if (current.length === 0) {\r\n                    const activeHelp = (\r\n                        /* tslint:disable:max-line-length */\r\n                        <div key='active-help'>\r\n                            <Note\r\n                                content={\r\n                                    <div>\r\n                                        <div className='section'>these are the combatants taking part in this encounter; you can select them to see their stat blocks (on the right)</div>\r\n                                        <div className='section'>they are listed in initiative order (with the highest initiative score at the top of the list, and the lowest at the bottom)</div>\r\n                                        <div className='section'>when you're ready to begin the encounter, select the first combatant and press the <b>start turn</b> button on their stat block</div>\r\n                                    </div>\r\n                                }\r\n                            />\r\n                        </div>\r\n                        /* tslint:enable:max-line-length */\r\n                    );\r\n                    active = [activeHelp].concat(active);\r\n                }\r\n\r\n                if (current.length === 0) {\r\n                    current.push(\r\n                        <Note\r\n                            key='current'\r\n                            content={\r\n                                <div className='section'>\r\n                                    the current initiative holder will be displayed here\r\n                                </div>\r\n                            }\r\n                        />\r\n                    );\r\n                }\r\n\r\n                let notificationSection = null;\r\n                if (this.props.combat.notifications.length > 0) {\r\n                    const notifications = this.props.combat.notifications.map(n => (\r\n                        <NotificationPanel\r\n                            key={n.id}\r\n                            notification={n}\r\n                            close={(notification, removeCondition) => this.props.close(notification, removeCondition)}\r\n                        />\r\n                    ));\r\n                    notificationSection = (\r\n                        <div className='notifications'>\r\n                            {notifications}\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                let mapSection = null;\r\n                if (this.props.combat.map) {\r\n                    mapSection = (\r\n                        <div key='map'>\r\n                            <MapPanel\r\n                                map={this.props.combat.map}\r\n                                mode='combat'\r\n                                size={this.state.mapSize}\r\n                                showOverlay={this.state.addingToMapID !== null}\r\n                                combatants={this.props.combat.combatants}\r\n                                selectedItemID={this.state.selectedTokenID ? this.state.selectedTokenID : undefined}\r\n                                setSelectedItemID={id => this.setSelectedTokenID(id)}\r\n                                gridSquareClicked={(x, y) => this.addCombatantToMap(x, y)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                const toolsSection = (\r\n                    <CardGroup\r\n                        heading='tools'\r\n                        content={[\r\n                            <div key='map' style={{ display: this.props.combat.map ? 'block' : 'none' }}>\r\n                                <div className='subheading'>map</div>\r\n                                <button onClick={() => this.props.scatterCombatants('monster')}>scatter monsters</button>\r\n                                <button onClick={() => this.props.scatterCombatants('pc')}>scatter pcs</button>\r\n                                <button onClick={() => this.props.rotateMap()}>rotate</button>\r\n                                <Spin\r\n                                    source={this.state}\r\n                                    name={'mapSize'}\r\n                                    display={value => 'zoom'}\r\n                                    nudgeValue={delta => this.nudgeMapSize(delta * 5)}\r\n                                />\r\n                            </div>,\r\n                            <div key='playerview'>\r\n                                <div className='subheading'>player view</div>\r\n                                <Checkbox\r\n                                    label='show player view'\r\n                                    checked={this.state.playerView.open}\r\n                                    changeValue={value => this.setPlayerViewOpen(value)}\r\n                                />\r\n                                <div style={{ display: this.props.combat.map ? 'block' : 'none' }}>\r\n                                    <Checkbox\r\n                                        label='show map controls'\r\n                                        checked={this.state.playerView.showControls}\r\n                                        changeValue={value => this.setPlayerViewShowControls(value)}\r\n                                    />\r\n                                    <Spin\r\n                                        source={this.state.playerView}\r\n                                        name={'mapSize'}\r\n                                        display={value => 'zoom'}\r\n                                        nudgeValue={delta => this.nudgePlayerViewMapSize(delta * 5)}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        ]}\r\n                        showToggle={true}\r\n                    />\r\n                );\r\n\r\n                const special: JSX.Element[] = [];\r\n                this.props.combat.combatants.forEach(c => {\r\n                    const monster = c as (Combatant & Monster);\r\n                    const legendary = monster && monster.traits && monster.traits.some(t => t.type === 'legendary') && !monster.current;\r\n                    const lair = monster && monster.traits && monster.traits.some(t => t.type === 'lair');\r\n                    if (legendary || lair) {\r\n                        special.push(\r\n                            <div className='card monster' key={monster.id}>\r\n                                <div className='heading'><div className='title'>{monster.name}</div></div>\r\n                                <div className='card-content'>\r\n                                    <TraitsPanel\r\n                                        combatant={monster}\r\n                                        mode='combat-special'\r\n                                        changeValue={(source, type, value) => this.props.changeValue(source, type, value)}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    }\r\n                });\r\n\r\n                let selectedCombatant = null;\r\n                if (this.state.selectedTokenID) {\r\n                    const combatant = this.props.combat.combatants.find(c => c.id === this.state.selectedTokenID);\r\n                    if (combatant && !combatant.current) {\r\n                        selectedCombatant = this.createCard(combatant);\r\n                    }\r\n                }\r\n                if (!selectedCombatant) {\r\n                    selectedCombatant = (\r\n                        <Note\r\n                            key='selected'\r\n                            content={\r\n                                <div className='section'>\r\n                                    select a pc or monster from the <b>initiative order</b> list to see its details here\r\n                                </div>\r\n                            }\r\n                        />\r\n                    );\r\n                }\r\n\r\n                return (\r\n                    <div className='combat-manager row collapse'>\r\n                        <div className='columns small-4 medium-4 large-4 scrollable'>\r\n                            <CardGroup\r\n                                heading='initiative holder'\r\n                                content={current}\r\n                            />\r\n                        </div>\r\n                        <div className='columns small-4 medium-4 large-4 scrollable'>\r\n                            {notificationSection}\r\n                            <CardGroup\r\n                                heading='waiting for intiative to be entered'\r\n                                content={pending}\r\n                                hidden={pending.length === 0}\r\n                                showToggle={true}\r\n                            />\r\n                            <CardGroup\r\n                                heading='encounter map'\r\n                                content={[mapSection]}\r\n                                hidden={mapSection === null}\r\n                                showToggle={true}\r\n                            />\r\n                            <CardGroup\r\n                                heading='initiative order'\r\n                                content={active}\r\n                                hidden={active.length === 0}\r\n                                showToggle={true}\r\n                            />\r\n                            <CardGroup\r\n                                heading='defeated'\r\n                                content={defeated}\r\n                                hidden={defeated.length === 0}\r\n                                showToggle={true}\r\n                            />\r\n                        </div>\r\n                        <div className='columns small-4 medium-4 large-4 scrollable'>\r\n                            {toolsSection}\r\n                            {this.getPlayerView(this.props.combat)}\r\n                            <CardGroup\r\n                                heading={'don\\'t forget'}\r\n                                content={special}\r\n                                hidden={special.length === 0}\r\n                                showToggle={true}\r\n                            />\r\n                            <CardGroup\r\n                                heading='selected combatant'\r\n                                content={[selectedCombatant]}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                );\r\n            } else {\r\n                let listItems = this.props.combats.filter(c => Utils.match(this.props.filter, c.name)).map(c => {\r\n                    return (\r\n                        <CombatListItem\r\n                            key={c.id}\r\n                            combat={c}\r\n                            selected={false}\r\n                            setSelection={combat => this.props.resumeEncounter(combat)}\r\n                        />\r\n                    );\r\n                });\r\n                if (listItems.length === 0) {\r\n                    listItems = [(\r\n                        <Note\r\n                            key='empty'\r\n                            content={'you have no in-progress encounters'}\r\n                        />\r\n                    )];\r\n                }\r\n\r\n                return (\r\n                    <div className='combat-manager row collapse'>\r\n                        <div className='columns small-4 medium-4 large-3 scrollable list-column'>\r\n                            <button onClick={() => this.props.createCombat()}>start a new combat</button>\r\n                            <div className='divider' />\r\n                            {listItems}\r\n                        </div>\r\n                        <div className='columns small-8 medium-8 large-9 scrollable'>\r\n                            <div className='vertical-center-outer'>\r\n                                <div className='vertical-center-middle'>\r\n                                    <div className='vertical-center-inner'>\r\n                                        <HelpCard combats={this.props.combats} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface HelpCardProps {\r\n    combats: Combat[];\r\n}\r\n\r\nclass HelpCard extends React.Component<HelpCardProps> {\r\n    public render() {\r\n        let action: JSX.Element | null = null;\r\n        if (this.props.combats.length === 0) {\r\n            action = (\r\n                <div className='section'>to start a combat encounter, press the <b>start a new combat</b> button</div>\r\n            );\r\n        } else {\r\n            action = (\r\n                <div>\r\n                    <div className='section'>on the left you will see a list of encounters that you have paused</div>\r\n                    <div className='section'>you can resume a paused combat by selecting it</div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <Note\r\n                content={\r\n                    <div>\r\n                        <div className='section'>here you can run a combat encounter by specifying a party and an encounter, and optionally a map</div>\r\n                        <div className='divider' />\r\n                        {action}\r\n                    </div>\r\n                }\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\ninterface NotificationProps {\r\n    notification: Notification;\r\n    close: (notification: Notification, removeCondition: boolean) => void;\r\n}\r\n\r\nclass NotificationPanel extends React.Component<NotificationProps> {\r\n    private success() {\r\n        switch (this.props.notification.type) {\r\n            case 'condition-save':\r\n            case 'condition-end':\r\n                const condition = this.props.notification.data as Condition;\r\n                if (condition.duration) {\r\n                    // Reduce save by 1\r\n                    if ((condition.duration.type === 'saves') || (condition.duration.type === 'rounds')) {\r\n                        condition.duration.count -= 1;\r\n                        if (condition.duration.count === 0) {\r\n                            // Remove the condition\r\n                            this.close(true);\r\n                        } else {\r\n                            this.close();\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            case 'trait-recharge':\r\n                // Mark trait as recharged\r\n                const trait = this.props.notification.data as Trait;\r\n                trait.uses = 0;\r\n                this.close();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private close(removeCondition = false) {\r\n        this.props.close(this.props.notification, removeCondition);\r\n    }\r\n\r\n    public render() {\r\n        const combatant = this.props.notification.combatant as (Combatant & Monster);\r\n        const condition = this.props.notification.data as Condition;\r\n        const trait = this.props.notification.data as Trait;\r\n\r\n        const name = combatant.displayName || combatant.name || 'unnamed monster';\r\n        switch (this.props.notification.type) {\r\n            case 'condition-save':\r\n                const duration = condition.duration as ConditionDurationSaves;\r\n                let saveType = duration.saveType.toString();\r\n                if (saveType !== 'death') {\r\n                    saveType = saveType.toUpperCase();\r\n                }\r\n                return (\r\n                    <div key={this.props.notification.id} className='descriptive'>\r\n                        <div className='text'>\r\n                            {name} must make a {saveType} save against dc {duration.saveDC}\r\n                        </div>\r\n                        <ControlRow\r\n                            controls={[\r\n                                <button key='success' onClick={() => this.success()}>success</button>,\r\n                                <button key='close' onClick={() => this.close()}>close</button>\r\n                            ]}\r\n                        />\r\n                    </div>\r\n                );\r\n            case 'condition-end':\r\n                return (\r\n                    <div key={this.props.notification.id} className='descriptive'>\r\n                        <div className='text'>\r\n                            {name} is no longer affected by condition {condition.name}\r\n                        </div>\r\n                        <ControlRow\r\n                            controls={[\r\n                                <button key='close' onClick={() => this.close()}>close</button>\r\n                            ]}\r\n                        />\r\n                    </div>\r\n                );\r\n            case 'trait-recharge':\r\n                return (\r\n                    <div key={this.props.notification.id} className='descriptive'>\r\n                        <div className='text'>\r\n                            {name} can attempt to recharge {trait.name} ({trait.usage})\r\n                        </div>\r\n                        <ControlRow\r\n                            controls={[\r\n                                <button key='recharge' onClick={() => this.success()}>recharge</button>,\r\n                                <button key='close' onClick={() => this.close()}>close</button>\r\n                            ]}\r\n                        />\r\n                    </div>\r\n                );\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n}\r\n\r\ninterface PendingCombatantRowProps {\r\n    combatant: (Combatant & PC) | (Combatant & Monster);\r\n    selected: boolean;\r\n    select: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n    nudgeValue: (combatant: (Combatant & PC) | (Combatant & Monster), field: string, delta: number) => void;\r\n    makeActive: (combatant: (Combatant & PC) | (Combatant & Monster)) => void;\r\n}\r\n\r\nclass PendingCombatantRow extends React.Component<PendingCombatantRowProps> {\r\n    private getInformationText() {\r\n        if (this.props.selected) {\r\n            return 'selected';\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private onClick(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        if (this.props.select) {\r\n            this.props.select(this.props.combatant);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        let style = 'combatant-row ' + this.props.combatant.type;\r\n        if (this.props.combatant.current || this.props.selected) {\r\n            style += ' highlight';\r\n        }\r\n\r\n        return (\r\n            <div className={style} onClick={e => this.onClick(e)}>\r\n                <div className='name'>\r\n                    {this.props.combatant.displayName || this.props.combatant.name || 'combatant'}\r\n                    <span className='info'>{this.getInformationText()}</span>\r\n                </div>\r\n                <div className='content'>\r\n                    <Spin\r\n                        source={this.props.combatant}\r\n                        name='initiative'\r\n                        label='initiative'\r\n                        nudgeValue={delta => this.props.nudgeValue(this.props.combatant, 'initiative', delta)}\r\n                    />\r\n                    <button onClick={e => { e.stopPropagation(); this.props.makeActive(this.props.combatant); }}>add to encounter</button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ninterface PCRowProps {\r\n    combatant: Combatant & PC;\r\n    minimal: boolean;\r\n    combat: Combat;\r\n    selected: boolean;\r\n    select: (combatant: Combatant & PC) => void;\r\n}\r\n\r\nclass PCRow extends React.Component<PCRowProps> {\r\n    public static defaultProps = {\r\n        minimal: false\r\n    };\r\n\r\n    private getInformationText() {\r\n        if (this.props.combatant.current) {\r\n            return 'current turn';\r\n        }\r\n\r\n        if (this.props.selected) {\r\n            return 'selected';\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private onClick(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        if (!this.props.selected && this.props.select) {\r\n            this.props.select(this.props.combatant);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        let style = 'combatant-row ' + this.props.combatant.type;\r\n        if (this.props.selected) {\r\n            style += ' highlight';\r\n        }\r\n\r\n        let desc = null;\r\n        if (!this.props.minimal) {\r\n            const race = this.props.combatant.race || 'unknown race';\r\n            const cls = this.props.combatant.classes || 'unknown class';\r\n            desc = (\r\n                <div className='section lowercase'>\r\n                    {race + ' ' + cls + ', level ' + this.props.combatant.level}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        let conditions = null;\r\n        if (this.props.combatant.conditions) {\r\n            conditions = this.props.combatant.conditions.map(c => {\r\n                let name = c.name;\r\n                if (c.name === 'exhaustion') {\r\n                    name += ' (' + c.level + ')';\r\n                }\r\n                if ((c.name === 'custom') && (c.text)) {\r\n                    name = c.text;\r\n                }\r\n                if (c.duration) {\r\n                    name += ' ' + Utils.conditionDurationText(c, this.props.combat);\r\n                }\r\n                const description = [];\r\n                const text = Utils.conditionText(c);\r\n                for (let n = 0; n !== text.length; ++n) {\r\n                    description.push(<li key={n} className='condition-text'>{text[n]}</li>);\r\n                }\r\n                return (\r\n                    <Note\r\n                        key={c.id}\r\n                        white={true}\r\n                        content={\r\n                            <div className='condition'>\r\n                                <div className='condition-name'>{name}</div>\r\n                                <ul>\r\n                                    {description}\r\n                                </ul>\r\n                            </div>\r\n                        }\r\n                    />\r\n                );\r\n            });\r\n        }\r\n\r\n        const notes = [];\r\n        if (this.props.combat.map) {\r\n            if (!this.props.combatant.pending && !this.props.combat.map.items.find(i => i.id === this.props.combatant.id)) {\r\n                notes.push(\r\n                    <Note key='not-on-map' white={true} content='not on the map' />\r\n                );\r\n            }\r\n        }\r\n        this.props.combatant.tags.forEach(tag => {\r\n            notes.push(\r\n                <Note key={tag} white={true} content={Utils.getTagDescription(tag)} />\r\n            );\r\n        });\r\n\r\n        let companions = null;\r\n        if (this.props.combatant.companions.length > 0) {\r\n            companions = (\r\n                <div className='section'>\r\n                    <b>companions:</b> {this.props.combatant.companions.map(companion => companion.name).join(', ')}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div className={style} onClick={e => this.onClick(e)}>\r\n                <div className='name'>\r\n                    {this.props.combatant.displayName || this.props.combatant.name || 'combatant'}\r\n                    {this.props.combatant.player ? ' | ' + this.props.combatant.player : ''}\r\n                    <span className='info'>{this.getInformationText()}</span>\r\n                </div>\r\n                <div className='content'>\r\n                    {desc}\r\n                    {conditions}\r\n                    {notes}\r\n                    {companions}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ninterface MonsterRowProps {\r\n    combatant: Combatant & Monster;\r\n    minimal: boolean;\r\n    combat: Combat;\r\n    selected: boolean;\r\n    select: (combatant: Combatant & Monster) => void;\r\n}\r\n\r\nclass MonsterRow extends React.Component<MonsterRowProps> {\r\n    public static defaultProps = {\r\n        minimal: false\r\n    };\r\n\r\n    private getInformationText() {\r\n        if (this.props.combatant.current) {\r\n            return 'current turn';\r\n        }\r\n\r\n        if (this.props.selected) {\r\n            return 'selected';\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private onClick(e: React.MouseEvent) {\r\n        e.stopPropagation();\r\n        if (!this.props.selected && this.props.select) {\r\n            this.props.select(this.props.combatant);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        let style = 'combatant-row ' + this.props.combatant.type;\r\n        if (this.props.selected) {\r\n            style += ' highlight';\r\n        }\r\n\r\n        let hp = (this.props.combatant.hp ? this.props.combatant.hp : 0).toString();\r\n        if (this.props.combatant.hpTemp > 0) {\r\n            hp += '+' + this.props.combatant.hpTemp;\r\n        }\r\n\r\n        let gauge = null;\r\n        if (!this.props.combatant.pending) {\r\n            gauge = (\r\n                <HitPointGauge combatant={this.props.combatant} />\r\n            );\r\n        }\r\n\r\n        let conditions = null;\r\n        if (this.props.combatant.conditions) {\r\n            conditions = this.props.combatant.conditions.map(c => {\r\n                let name = c.name;\r\n                if (c.name === 'exhaustion') {\r\n                    name += ' (' + c.level + ')';\r\n                }\r\n                if ((c.name === 'custom') && (c.text)) {\r\n                    name = c.text;\r\n                }\r\n                if (c.duration) {\r\n                    name += ' ' + Utils.conditionDurationText(c, this.props.combat);\r\n                }\r\n                const description = [];\r\n                const text = Utils.conditionText(c);\r\n                for (let n = 0; n !== text.length; ++n) {\r\n                    description.push(<li key={n} className='condition-text'>{text[n]}</li>);\r\n                }\r\n                return (\r\n                    <Note\r\n                        key={c.id}\r\n                        white={true}\r\n                        content={\r\n                            <div className='condition'>\r\n                                <div className='condition-name'>{name}</div>\r\n                                <ul>\r\n                                    {description}\r\n                                </ul>\r\n                            </div>\r\n                        }\r\n                    />\r\n                );\r\n            });\r\n        }\r\n\r\n        const notes = [];\r\n        if (this.props.combat.map) {\r\n            if (!this.props.combatant.pending && !this.props.combat.map.items.find(i => i.id === this.props.combatant.id)) {\r\n                notes.push(\r\n                    <Note key='not-on-map' white={true} content='not on the map' />\r\n                );\r\n            }\r\n        }\r\n        this.props.combatant.tags.forEach(tag => {\r\n            notes.push(\r\n                <Note key={tag} white={true} content={Utils.getTagDescription(tag)} />\r\n            );\r\n        });\r\n\r\n        let dmInfo = null;\r\n        if (!this.props.minimal) {\r\n            dmInfo = (\r\n                <div>\r\n                    <div className='section key-stats'>\r\n                        <div className='key-stat'>\r\n                            <div className='stat-label'>ac</div>\r\n                            <div className='stat-value'>{this.props.combatant.ac}</div>\r\n                        </div>\r\n                        <div className='key-stat'>\r\n                            <div className='stat-value'>{hp}</div>\r\n                            <div className='stat-label'>hp</div>\r\n                        </div>\r\n                    </div>\r\n                    {gauge}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div className={style} onClick={e => this.onClick(e)}>\r\n                <div className='name'>\r\n                    {this.props.combatant.displayName || this.props.combatant.name || 'combatant'}\r\n                    <span className='info'>{this.getInformationText()}</span>\r\n                </div>\r\n                <div className='content'>\r\n                    {dmInfo}\r\n                    {conditions}\r\n                    {notes}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Encounter } from '../../models/encounter';\r\n\r\ninterface Props {\r\n    encounter: Encounter;\r\n    selected: boolean;\r\n    setSelection: (encounter: Encounter) => void;\r\n}\r\n\r\nexport default class EncounterListItem extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const slots = [];\r\n\r\n            this.props.encounter.slots.forEach(slot => {\r\n                let text = slot.monsterName || 'unnamed monster';\r\n                if (slot.count > 1) {\r\n                    text += ' x' + slot.count;\r\n                }\r\n                slots.push(<div key={slot.id} className='section'>{text}</div>);\r\n            });\r\n\r\n            if (slots.length === 0) {\r\n                slots.push(<div key='empty' className='section'>no monsters</div>);\r\n            }\r\n\r\n            this.props.encounter.waves.forEach(wave => {\r\n                slots.push(<div key={'name ' + wave.id} className='section subheading'>{wave.name || 'unnamed wave'}</div>);\r\n                wave.slots.forEach(slot => {\r\n                    let text = slot.monsterName || 'unnamed monster';\r\n                    if (slot.count > 1) {\r\n                        text += ' x' + slot.count;\r\n                    }\r\n                    slots.push(<div key={slot.id} className='section'>{text}</div>);\r\n                });\r\n                if (slots.length === 0) {\r\n                    slots.push(<div key={'empty ' + wave.id} className='section'>no monsters</div>);\r\n                }\r\n            });\r\n\r\n            return (\r\n                <div className={this.props.selected ? 'list-item selected' : 'list-item'} onClick={() => this.props.setSelection(this.props.encounter)}>\r\n                    <div className='heading'>{this.props.encounter.name || 'unnamed encounter'}</div>\r\n                    {slots}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Napoleon from '../../utils/napoleon';\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Encounter } from '../../models/encounter';\r\nimport { Monster } from '../../models/monster-group';\r\nimport { Party } from '../../models/party';\r\n\r\nimport Dropdown from '../controls/dropdown';\r\n\r\ninterface Props {\r\n    encounter: Encounter;\r\n    parties: Party[];\r\n    party: Party | null;\r\n    getMonster: (monsterName: string, groupName: string) => Monster | null;\r\n}\r\n\r\ninterface State {\r\n    selectedPartyID: string | null;\r\n}\r\n\r\nexport default class DifficultyChartPanel extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        party: null\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            selectedPartyID: props.party ? props.party.id : null\r\n        };\r\n    }\r\n\r\n    private selectParty(partyID: string | null) {\r\n        this.setState({\r\n            selectedPartyID: partyID\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const monsterCount = Napoleon.getMonsterCount(this.props.encounter);\r\n        const monsterXP = Napoleon.getEncounterXP(this.props.encounter, this.props.getMonster);\r\n        const adjustedXP = Napoleon.getAdjustedEncounterXP(this.props.encounter, this.props.getMonster);\r\n\r\n        const basicData = (\r\n            <div>\r\n                <div className='divider' />\r\n                <div className='section'>\r\n                    xp for this encounter\r\n                    <div className='right'>{monsterXP} xp</div>\r\n                </div>\r\n                <div className='section' style={{ display: (adjustedXP === monsterXP) ? 'none' : ''}}>\r\n                    effective xp for {monsterCount} monster(s)\r\n                    <div className='right'>{adjustedXP} xp</div>\r\n                </div>\r\n            </div>\r\n        );\r\n\r\n        let xpThresholds;\r\n        let diffSection;\r\n        const party = this.props.parties.find(p => p.id === this.state.selectedPartyID);\r\n        if (party) {\r\n            let xpEasy = 0;\r\n            let xpMedium = 0;\r\n            let xpHard = 0;\r\n            let xpDeadly = 0;\r\n\r\n            const pcs = party.pcs.filter(pc => pc.active);\r\n            pcs.forEach(pc => {\r\n                xpEasy += Utils.pcExperience(pc.level, 'easy');\r\n                xpMedium += Utils.pcExperience(pc.level, 'medium');\r\n                xpHard += Utils.pcExperience(pc.level, 'hard');\r\n                xpDeadly += Utils.pcExperience(pc.level, 'deadly');\r\n            });\r\n\r\n            let difficulty = 'trivial';\r\n            let adjustedDifficulty = 'trivial';\r\n            if (adjustedXP > 0) {\r\n                if (adjustedXP >= xpEasy) {\r\n                    difficulty = 'easy';\r\n                    adjustedDifficulty = 'easy';\r\n                }\r\n                if (adjustedXP >= xpMedium) {\r\n                    difficulty = 'medium';\r\n                    adjustedDifficulty = 'medium';\r\n                }\r\n                if (adjustedXP >= xpHard) {\r\n                    difficulty = 'hard';\r\n                    adjustedDifficulty = 'hard';\r\n                }\r\n                if (adjustedXP >= xpDeadly) {\r\n                    difficulty = 'deadly';\r\n                    adjustedDifficulty = 'deadly';\r\n                }\r\n\r\n                if ((pcs.length < 3) || (pcs.length > 5)) {\r\n                    const small = pcs.length < 3;\r\n                    switch (difficulty) {\r\n                        case 'trivial':\r\n                            adjustedDifficulty = small ? 'easy' : 'trivial';\r\n                            break;\r\n                        case 'easy':\r\n                            adjustedDifficulty = small ? 'medium' : 'trivial';\r\n                            break;\r\n                        case 'medium':\r\n                            adjustedDifficulty = small ? 'hard' : 'easy';\r\n                            break;\r\n                        case 'hard':\r\n                            adjustedDifficulty = small ? 'deadly' : 'medium';\r\n                            break;\r\n                        case 'deadly':\r\n                            adjustedDifficulty = small ? 'deadly' : 'hard';\r\n                            break;\r\n                        default:\r\n                            adjustedDifficulty = '';\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            xpThresholds = (\r\n                <div className='table'>\r\n                    <div>\r\n                        <div className='cell four easy'><b>easy</b></div>\r\n                        <div className='cell four medium'><b>medium</b></div>\r\n                        <div className='cell four hard'><b>hard</b></div>\r\n                        <div className='cell four deadly'><b>deadly</b></div>\r\n                    </div>\r\n                    <div>\r\n                        <div className='cell four'>{xpEasy} xp</div>\r\n                        <div className='cell four'>{xpMedium} xp</div>\r\n                        <div className='cell four'>{xpHard} xp</div>\r\n                        <div className='cell four'>{xpDeadly} xp</div>\r\n                    </div>\r\n                </div>\r\n            );\r\n\r\n            const getLeft = (xp: number) => {\r\n                const max = Math.max(adjustedXP, (xpDeadly * 1.2));\r\n                return (100 * xp) / max;\r\n            };\r\n\r\n            const getRight = (xp: number) => {\r\n                return 100 - getLeft(xp);\r\n            };\r\n\r\n            diffSection = (\r\n                <div>\r\n                    <div className='difficulty-gauge'>\r\n                        <div className='bar-container'>\r\n                            <div className='bar trivial' style={{ left: '0', right: getRight(xpEasy) + '%' }} />\r\n                        </div>\r\n                        <div className='bar-container'>\r\n                            <div className='bar easy' style={{ left: getLeft(xpEasy) + '%', right: getRight(xpMedium) + '%' }} />\r\n                        </div>\r\n                        <div className='bar-container'>\r\n                            <div className='bar medium' style={{ left: getLeft(xpMedium) + '%', right: getRight(xpHard) + '%' }} />\r\n                        </div>\r\n                        <div className='bar-container'>\r\n                            <div className='bar hard' style={{ left: getLeft(xpHard) + '%', right: getRight(xpDeadly) + '%' }} />\r\n                        </div>\r\n                        <div className='bar-container'>\r\n                            <div className='bar deadly' style={{ left: getLeft(xpDeadly) + '%', right: '0' }} />\r\n                        </div>\r\n                        <div className='encounter-container'>\r\n                            <div className='encounter' style={{ left: (getLeft(adjustedXP) - 0.5) + '%' }} />\r\n                        </div>\r\n                    </div>\r\n                    {basicData}\r\n                    <div className='section'>\r\n                        difficulty for this party\r\n                        <div className='right'>{difficulty}</div>\r\n                    </div>\r\n                    <div className='section' style={{ display: (adjustedDifficulty === difficulty) ? 'none' : ''}}>\r\n                        effective difficulty for {pcs.length} pc(s)\r\n                        <div className='right'><b>{adjustedDifficulty}</b></div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } else {\r\n            diffSection = basicData;\r\n        }\r\n\r\n        let partySelection = null;\r\n        if (!this.props.party) {\r\n            const partyOptions = [];\r\n            if (this.props.parties) {\r\n                for (let n = 0; n !== this.props.parties.length; ++n) {\r\n                    const p = this.props.parties[n];\r\n                    partyOptions.push({\r\n                        id: p.id,\r\n                        text: p.name\r\n                    });\r\n                }\r\n            }\r\n\r\n            partySelection = (\r\n                <Dropdown\r\n                    options={partyOptions}\r\n                    placeholder='select party...'\r\n                    selectedID={this.state.selectedPartyID ? this.state.selectedPartyID : undefined}\r\n                    select={optionID => this.selectParty(optionID)}\r\n                    clear={() => this.selectParty(null)}\r\n                />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div className='group-panel'>\r\n                <div className='subheading'>difficulty</div>\r\n                {partySelection}\r\n                {xpThresholds}\r\n                {diffSection}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Napoleon from '../../utils/napoleon';\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { MonsterFilter } from '../../models/encounter';\r\nimport { CATEGORY_TYPES, SIZE_TYPES } from '../../models/monster-group';\r\n\r\nimport Dropdown from '../controls/dropdown';\r\nimport Expander from '../controls/expander';\r\nimport Spin from '../controls/spin';\r\n\r\ninterface Props {\r\n    filter: MonsterFilter;\r\n    changeValue: (type: 'name' | 'challengeMin' | 'challengeMax' | 'category' | 'size', value: any) => void;\r\n    nudgeValue: (type: 'challengeMin' | 'challengeMax', delta: number) => void;\r\n    resetFilter: () => void;\r\n}\r\n\r\nexport default class FilterPanel extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const sizes = ['all sizes'].concat(SIZE_TYPES);\r\n            const sizeOptions = sizes.map(size => ({ id: size, text: size }));\r\n\r\n            const categories = ['all types'].concat(CATEGORY_TYPES);\r\n            const catOptions = categories.map(cat => ({ id: cat, text: cat }));\r\n\r\n            const content = (\r\n                <div>\r\n                    <input\r\n                        type='text'\r\n                        placeholder='name'\r\n                        value={this.props.filter.name}\r\n                        onChange={event => this.props.changeValue('name', event.target.value)}\r\n                    />\r\n                    <Spin\r\n                        source={this.props.filter}\r\n                        name='challengeMin'\r\n                        label='min cr'\r\n                        display={value => Utils.challenge(value)}\r\n                        nudgeValue={delta => this.props.nudgeValue('challengeMin', delta)}\r\n                    />\r\n                    <Spin\r\n                        source={this.props.filter}\r\n                        name='challengeMax'\r\n                        label='max cr'\r\n                        display={value => Utils.challenge(value)}\r\n                        nudgeValue={delta => this.props.nudgeValue('challengeMax', delta)}\r\n                    />\r\n                    <Dropdown\r\n                        options={sizeOptions}\r\n                        placeholder='filter by size...'\r\n                        selectedID={this.props.filter.size}\r\n                        select={optionID => this.props.changeValue('size', optionID)}\r\n                    />\r\n                    <Dropdown\r\n                        options={catOptions}\r\n                        placeholder='filter by type...'\r\n                        selectedID={this.props.filter.category}\r\n                        select={optionID => this.props.changeValue('category', optionID)}\r\n                    />\r\n                    <div className='divider' />\r\n                    <div className='section'>\r\n                        <button onClick={() => this.props.resetFilter()}>clear filter</button>\r\n                    </div>\r\n                </div>\r\n            );\r\n\r\n            const summary = 'showing ' + Napoleon.getFilterDescription(this.props.filter);\r\n\r\n            return (\r\n                <Expander\r\n                    text={summary}\r\n                    content={content}\r\n                />\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Factory from '../../utils/factory';\r\nimport Napoleon from '../../utils/napoleon';\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Encounter, EncounterSlot, EncounterWave, MonsterFilter } from '../../models/encounter';\r\nimport { Monster, MonsterGroup } from '../../models/monster-group';\r\nimport { Party } from '../../models/party';\r\n\r\nimport MonsterCard from '../cards/monster-card';\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport Expander from '../controls/expander';\r\nimport Selector from '../controls/selector';\r\nimport Spin from '../controls/spin';\r\nimport EncounterListItem from '../list-items/encounter-list-item';\r\nimport CardGroup from '../panels/card-group';\r\nimport DifficultyChartPanel from '../panels/difficulty-chart-panel';\r\nimport FilterPanel from '../panels/filter-panel';\r\nimport Note from '../panels/note';\r\n\r\ninterface Props {\r\n    encounters: Encounter[];\r\n    selection: Encounter | null;\r\n    parties: Party[];\r\n    library: MonsterGroup[];\r\n    filter: string;\r\n    selectEncounter: (encounter: Encounter | null) => void;\r\n    addEncounter: () => void;\r\n    clearEncounter: () => void;\r\n    removeEncounter: () => void;\r\n    buildEncounter: (xp: number, filter: MonsterFilter) => void;\r\n    addEncounterSlot: (monster: Monster, waveID: string | null) => void;\r\n    removeEncounterSlot: (encounterSlot: EncounterSlot, waveID: string | null) => void;\r\n    addWave: () => void;\r\n    removeWave: (wave: EncounterWave) => void;\r\n    changeValue: (source: any, field: string, value: any) => void;\r\n    nudgeValue: (source: any, field: string, value: number) => void;\r\n    getMonster: (monsterName: string, groupName: string) => Monster | null;\r\n}\r\n\r\ninterface State {\r\n    filter: MonsterFilter;\r\n}\r\n\r\nexport default class EncounterBuilderScreen extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            filter: Factory.createMonsterFilter()\r\n        };\r\n    }\r\n\r\n    private matchMonster(monster: Monster) {\r\n        return Napoleon.matchMonster(monster, this.state.filter);\r\n    }\r\n\r\n    private changeFilterValue(type: 'name' | 'challengeMin' | 'challengeMax' | 'category' | 'size', value: any) {\r\n        // eslint-disable-next-line\r\n        this.state.filter[type] = value as never;\r\n        this.setState({\r\n            filter: this.state.filter\r\n        });\r\n    }\r\n\r\n    private nudgeFilterValue(type: 'challengeMin' | 'challengeMax', delta: number) {\r\n        const value = Utils.nudgeChallenge(this.state.filter[type], delta);\r\n        this.changeFilterValue(type, value);\r\n    }\r\n\r\n    private resetFilter() {\r\n        this.setState({\r\n            filter: Factory.createMonsterFilter()\r\n        });\r\n    }\r\n\r\n    private getMonsterCards(slots: EncounterSlot[], waveID: string | null) {\r\n        const cards = [];\r\n\r\n        slots.forEach(slot => {\r\n            const monster = this.props.getMonster(slot.monsterName, slot.monsterGroupName);\r\n            if (monster) {\r\n                cards.push(\r\n                    <div className='column' key={monster.id}>\r\n                        <MonsterCard\r\n                            combatant={monster}\r\n                            slot={slot}\r\n                            encounter={this.props.selection as Encounter}\r\n                            mode={'view encounter'}\r\n                            nudgeValue={(source, type, delta) => this.props.nudgeValue(source, type, delta)}\r\n                            removeEncounterSlot={source => this.props.removeEncounterSlot(source, waveID)}\r\n                        />\r\n                    </div>\r\n                );\r\n            } else {\r\n                const index = slots.indexOf(slot);\r\n                const error = 'unknown monster: ' + slot.monsterName + ' in group ' + slot.monsterGroupName;\r\n                cards.push(\r\n                    <div className='column' key={index}>\r\n                        <div className='card error'>\r\n                            <div className='card-content'>\r\n                                <div className='section'>\r\n                                    {error}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n        });\r\n\r\n        if (slots.length === 0) {\r\n            if (waveID) {\r\n                cards.push(\r\n                    <div className='column' key='empty'>\r\n                        <Note\r\n                            content={\r\n                                <div>\r\n                                    <p>there are no monsters in this wave</p>\r\n                                </div>\r\n                            }\r\n                        />\r\n                    </div>\r\n                );\r\n            } else {\r\n                cards.push(\r\n                    <div className='column' key='empty'>\r\n                        <Note\r\n                            content={\r\n                                <div>\r\n                                    <p>there are no monsters in this encounter</p>\r\n                                    <p>you can add monsters from the list below, or try 'build a random encounter'</p>\r\n                                </div>\r\n                            }\r\n                        />\r\n                    </div>\r\n                );\r\n            }\r\n        }\r\n\r\n        return cards;\r\n    }\r\n\r\n    private getLibrarySection() {\r\n        if (!this.props.selection) {\r\n            return null;\r\n        }\r\n\r\n        const monsters: Monster[] = [];\r\n        if (this.props.selection) {\r\n            this.props.library.forEach(group => {\r\n                group.monsters.forEach(monster => {\r\n                    if (this.matchMonster(monster)) {\r\n                        monsters.push(monster);\r\n                    }\r\n                });\r\n            });\r\n            monsters.sort((a, b) => {\r\n                if (a.name < b.name) { return -1; }\r\n                if (a.name > b.name) { return 1; }\r\n                return 0;\r\n            });\r\n        }\r\n\r\n        const libraryCards = monsters.map(monster => {\r\n            return (\r\n                <div className='column' key={monster.id}>\r\n                    <MonsterCard\r\n                        key={monster.id}\r\n                        combatant={monster}\r\n                        encounter={this.props.selection as Encounter}\r\n                        library={this.props.library}\r\n                        mode={'view encounter'}\r\n                        addEncounterSlot={(combatant, waveID) => this.props.addEncounterSlot(combatant, waveID)}\r\n                    />\r\n                </div>\r\n            );\r\n        });\r\n\r\n        if (libraryCards.length === 0) {\r\n            libraryCards.push(\r\n                <div className='column' key='empty'>\r\n                    <Note\r\n                        content={\r\n                            <div>\r\n                                <p>there are no monsters that meet the criteria <i>{Napoleon.getFilterDescription(this.state.filter)}</i></p>\r\n                            </div>\r\n                        }\r\n                    />\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <CardGroup\r\n                heading='monster library'\r\n                content={libraryCards}\r\n                showToggle={true}\r\n            />\r\n        );\r\n    }\r\n\r\n    private showEncounter(enc: Encounter) {\r\n        return Utils.match(this.props.filter, enc.name);\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let leftColumn = null;\r\n            if (this.props.selection) {\r\n                leftColumn = (\r\n                    <div>\r\n                        <EncounterInfo\r\n                            selection={this.props.selection}\r\n                            parties={this.props.parties}\r\n                            filter={this.props.filter}\r\n                            monsterFilter={this.state.filter}\r\n                            changeValue={(source, type, value) => this.props.changeValue(source, type, value)}\r\n                            addWave={() => this.props.addWave()}\r\n                            removeWave={wave => this.props.removeWave(wave)}\r\n                            clearEncounter={() => this.props.clearEncounter()}\r\n                            removeEncounter={() => this.props.removeEncounter()}\r\n                            buildEncounter={xp => this.props.buildEncounter(xp, this.state.filter)}\r\n                            getMonster={(monsterName, monsterGroupName) => this.props.getMonster(monsterName, monsterGroupName)}\r\n                            changeFilterValue={(type, value) => this.changeFilterValue(type, value)}\r\n                            nudgeFilterValue={(type, delta) => this.nudgeFilterValue(type, delta)}\r\n                            resetFilter={() => this.resetFilter()}\r\n                        />\r\n                        <div className='divider' />\r\n                        <button onClick={() => this.props.selectEncounter(null)}>&larr; back to list</button>\r\n                    </div>\r\n                );\r\n            } else {\r\n                let listItems = this.props.encounters.filter(e => this.showEncounter(e)).map(e => {\r\n                    return (\r\n                        <EncounterListItem\r\n                            key={e.id}\r\n                            encounter={e}\r\n                            selected={e === this.props.selection}\r\n                            setSelection={encounter => this.props.selectEncounter(encounter)}\r\n                        />\r\n                    );\r\n                });\r\n                if (listItems.length === 0) {\r\n                    listItems = [(\r\n                        <Note\r\n                            key='empty'\r\n                            content={'you have not defined any encounters yet'}\r\n                        />\r\n                    )];\r\n                }\r\n\r\n                leftColumn = (\r\n                    <div>\r\n                        <button onClick={() => this.props.addEncounter()}>add a new encounter</button>\r\n                        <div className='divider' />\r\n                        {listItems}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            let encounterName;\r\n            const encounterCards: JSX.Element[] = [];\r\n            let waves: JSX.Element[] = [];\r\n\r\n            if (this.props.selection) {\r\n                encounterName = this.props.selection.name || 'unnamed encounter';\r\n\r\n                this.getMonsterCards(this.props.selection.slots, null)\r\n                    .forEach(card => encounterCards.push(card));\r\n\r\n                waves = this.props.selection.waves.map(w => {\r\n                    return (\r\n                        <CardGroup\r\n                            key={w.id}\r\n                            heading={w.name || 'unnamed wave'}\r\n                            content={this.getMonsterCards(w.slots, w.id)}\r\n                            showToggle={true}\r\n                        />\r\n                    );\r\n                });\r\n            }\r\n\r\n            let watermark;\r\n            if (!this.props.selection) {\r\n                watermark = (\r\n                    <div className='vertical-center-outer'>\r\n                        <div className='vertical-center-middle'>\r\n                            <div className='vertical-center-inner'>\r\n                                <HelpCard encounters={this.props.encounters} />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='encounter-builder row collapse'>\r\n                    <div className='columns small-4 medium-4 large-3 scrollable list-column'>\r\n                        {leftColumn}\r\n                    </div>\r\n                    <div className='columns small-8 medium-8 large-9 scrollable'>\r\n                        <CardGroup\r\n                            content={encounterCards}\r\n                            heading={encounterName}\r\n                            hidden={!this.props.selection}\r\n                        />\r\n                        {waves}\r\n                        {this.getLibrarySection()}\r\n                        {watermark}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface HelpCardProps {\r\n    encounters: Encounter[];\r\n}\r\n\r\nclass HelpCard extends React.Component<HelpCardProps> {\r\n    public render() {\r\n        try {\r\n            let action: JSX.Element | null = null;\r\n            if (this.props.encounters.length === 0) {\r\n                action = (\r\n                    <div className='section'>to start building an encounter, press the <b>add a new encounter</b> button</div>\r\n                );\r\n            } else {\r\n                action = (\r\n                    <div>\r\n                        <div className='section'>on the left you will see a list of encounters that you have created</div>\r\n                        <div className='section'>select an encounter from the list to add monsters to it</div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <Note\r\n                    content={\r\n                        <div>\r\n                            <div className='section'>on this page you can set up encounters</div>\r\n                            <div className='section'>\r\n                                when you have created an encounter you can add monsters to it, then gauge its difficulty for a party of pcs\r\n                            </div>\r\n                            <div className='section'>when you have set up a party and an encounter you can run the encounter in the combat manager</div>\r\n                            <div className='divider'/>\r\n                            {action}\r\n                        </div>\r\n                    }\r\n                />\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n        }\r\n    }\r\n}\r\n\r\ninterface EncounterInfoProps {\r\n    selection: Encounter;\r\n    parties: Party[];\r\n    filter: string;\r\n    monsterFilter: MonsterFilter;\r\n    changeValue: (source: any, field: string, value: any) => void;\r\n    addWave: () => void;\r\n    removeWave: (wave: EncounterWave) => void;\r\n    clearEncounter: () => void;\r\n    removeEncounter: () => void;\r\n    buildEncounter: (xp: number) => void;\r\n    getMonster: (monsterName: string, groupName: string) => Monster | null;\r\n    changeFilterValue: (type: 'name' | 'challengeMin' | 'challengeMax' | 'category' | 'size', value: any) => void;\r\n    nudgeFilterValue: (type: 'challengeMin' | 'challengeMax', delta: number) => void;\r\n    resetFilter: () => void;\r\n}\r\n\r\ninterface EncounterInfoState {\r\n    randomEncounterXP: number;\r\n    randomEncounterStep: number;\r\n}\r\n\r\nclass EncounterInfo extends React.Component<EncounterInfoProps, EncounterInfoState> {\r\n    constructor(props: EncounterInfoProps) {\r\n        super(props);\r\n        this.state = {\r\n            randomEncounterXP: 100,\r\n            randomEncounterStep: 100\r\n        };\r\n    }\r\n\r\n    private setRandomEncounterXP(value: number) {\r\n        this.setState({\r\n            randomEncounterXP: Math.max(0, value)\r\n        });\r\n    }\r\n\r\n    private setRandomEncounterStep(value: number) {\r\n        this.setState({\r\n            randomEncounterStep: value\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const waves = this.props.selection.waves.map(wave => (\r\n                <div key={wave.id} className='group-panel'>\r\n                    <input\r\n                        type='text'\r\n                        placeholder='wave name'\r\n                        value={wave.name}\r\n                        onChange={event => this.props.changeValue(wave, 'name', event.target.value)}\r\n                    />\r\n                    <ConfirmButton text='delete wave' callback={() => this.props.removeWave(wave)} />\r\n                </div>\r\n            ));\r\n\r\n            return (\r\n                <div>\r\n                    <div className='section'>\r\n                        <div className='subheading'>encounter name</div>\r\n                        <input\r\n                            type='text'\r\n                            placeholder='encounter name'\r\n                            value={this.props.selection.name}\r\n                            disabled={!!this.props.filter}\r\n                            onChange={event => this.props.changeValue(this.props.selection, 'name', event.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div className='section'>\r\n                        <div className='subheading'>waves</div>\r\n                        {waves}\r\n                        <button className={this.props.filter ? 'disabled' : ''} onClick={() => this.props.addWave()}>add a new wave</button>\r\n                    </div>\r\n                    <div className='divider' />\r\n                    <DifficultyChartPanel\r\n                        encounter={this.props.selection}\r\n                        parties={this.props.parties}\r\n                        getMonster={(monsterName, monsterGroupName) => this.props.getMonster(monsterName, monsterGroupName)}\r\n                    />\r\n                    <div className='divider' />\r\n                    <div className='section'>\r\n                        <FilterPanel\r\n                            filter={this.props.monsterFilter}\r\n                            changeValue={(type, value) => this.props.changeFilterValue(type, value)}\r\n                            nudgeValue={(type, delta) => this.props.nudgeFilterValue(type, delta)}\r\n                            resetFilter={() => this.props.resetFilter()}\r\n                        />\r\n                    </div>\r\n                    <div className='divider' />\r\n                    <div className='section'>\r\n                        <Expander\r\n                            text='build a random encounter'\r\n                            content={(\r\n                                <div>\r\n                                    <p>add random monsters to this encounter until its adjusted xp value is at least the following value</p>\r\n                                    <Spin\r\n                                        source={this.state}\r\n                                        name='randomEncounterXP'\r\n                                        label='xp'\r\n                                        nudgeValue={delta => this.setRandomEncounterXP(this.state.randomEncounterXP + (delta * this.state.randomEncounterStep))}\r\n                                    />\r\n                                    <Selector\r\n                                        options={['10', '100', '1000'].map(t => {\r\n                                            return { id: t, text: t };\r\n                                        })}\r\n                                        selectedID={this.state.randomEncounterStep.toString()}\r\n                                        select={optionID => this.setRandomEncounterStep(Number.parseInt(optionID, 10))}\r\n                                    />\r\n                                    <button onClick={() => this.props.buildEncounter(this.state.randomEncounterXP)}>build encounter</button>\r\n                                </div>\r\n                            )}\r\n                        />\r\n                        <ConfirmButton text='clear encounter' callback={() => this.props.clearEncounter()} />\r\n                        <ConfirmButton text='delete encounter' callback={() => this.props.removeEncounter()} />\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    content: string | JSX.Element | JSX.Element[];\r\n}\r\n\r\nexport default class Readaloud extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            return (\r\n                <div className='readaloud'>\r\n                    {this.props.content}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { MonsterGroup } from '../../models/monster-group';\r\n\r\nimport Readaloud from '../panels/readaloud';\r\n\r\ninterface Props {\r\n    library: MonsterGroup[];\r\n    addOpenGameContent: () => void;\r\n}\r\n\r\nexport default class HomeScreen extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            let monsters = null;\r\n            if (this.props.library.length === 0) {\r\n                monsters = (\r\n                    <div>\r\n                        <div className='divider' />\r\n                        <div className='section'>\r\n                            since your collection of monsters is empty, you might want to start by pressing the button below to add monsters from the&nbsp;\r\n                            <a href='http://dnd.wizards.com/articles/features/systems-reference-document-srd' target='_blank' rel='noopener noreferrer'>\r\n                                system reference document\r\n                            </a>\r\n                        </div>\r\n                        <div className='section'>\r\n                            <button onClick={() => this.props.addOpenGameContent()}>add monsters</button>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            const content = (\r\n                <Readaloud\r\n                    content={(\r\n                        <div>\r\n                            <div className='heading'>welcome to <b>dojo</b></div>\r\n                            <div className='divider' />\r\n                            <div className='section'>\r\n                                <b>dojo</b> is an app for dms of dungeons and dragons fifth edition\r\n                            </div>\r\n                            <div className='section'>\r\n                                with <b>dojo</b> you can:\r\n                                <ul>\r\n                                    <li>build unique, challenging monsters</li>\r\n                                    <li>create encounters of just the right difficulty for your players</li>\r\n                                    <li>design intricate tactical maps</li>\r\n                                    <li>run combat without the book-keeping</li>\r\n                                </ul>\r\n                            </div>\r\n                            {monsters}\r\n                            <div className='divider' />\r\n                            <div className='section'>\r\n                                use the buttons at the bottom of the screen to explore the app's main features,\r\n                                or press the tools button at the top right for additional dm tools\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                />\r\n            );\r\n\r\n            return (\r\n                <div className='home scrollable'>\r\n                    <div className='vertical-center-outer'>\r\n                        <div className='vertical-center-middle'>\r\n                            <div className='vertical-center-inner'>\r\n                                {content}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Map } from '../../models/map-folio';\r\n\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport MapPanel from '../panels/map-panel';\r\n\r\ninterface Props {\r\n    map: Map;\r\n    changeValue: (map: Map, field: string, value: string) => void;\r\n    editMap: (map: Map) => void;\r\n    removeMap: (map: Map) => void;\r\n}\r\n\r\nexport default class MapCard extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            return (\r\n                <div className='card map'>\r\n                    <div className='heading'>\r\n                        <div className='title'>{this.props.map.name || 'unnamed map'}</div>\r\n                    </div>\r\n                    <div className='card-content'>\r\n                        <div className='section'>\r\n                            <MapPanel\r\n                                map={this.props.map}\r\n                                mode='thumbnail'\r\n                                size={10}\r\n                            />\r\n                        </div>\r\n                        <div className='divider' />\r\n                        <button onClick={() => this.props.editMap(this.props.map)}>edit map</button>\r\n                        <ConfirmButton text='delete map' callback={() => this.props.removeMap(this.props.map)} />\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { MapFolio } from '../../models/map-folio';\r\n\r\ninterface Props {\r\n    mapFolio: MapFolio;\r\n    selected: boolean;\r\n    filter: string;\r\n    setSelection: (mapFolio: MapFolio) => void;\r\n}\r\n\r\nexport default class MapFolioListItem extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const matchFolio = Utils.match(this.props.filter, this.props.mapFolio.name);\r\n\r\n            const maps = [];\r\n            for (let n = 0; n !== this.props.mapFolio.maps.length; ++n) {\r\n                const map = this.props.mapFolio.maps[n];\r\n                const name = map.name || 'unnamed map';\r\n                if (matchFolio || Utils.match(this.props.filter, name)) {\r\n                    maps.push(<div key={map.id} className='section'>{name}</div>);\r\n                }\r\n            }\r\n            if (maps.length === 0) {\r\n                maps.push(<div key='empty' className='section'>no maps</div>);\r\n            }\r\n\r\n            return (\r\n                <div className={this.props.selected ? 'list-item selected' : 'list-item'} onClick={() => this.props.setSelection(this.props.mapFolio)}>\r\n                    <div className='heading'>{this.props.mapFolio.name || 'unnamed folio'}</div>\r\n                    {maps}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Map, MapFolio } from '../../models/map-folio';\r\n\r\nimport MapCard from '../cards/map-card';\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport MapFolioListItem from '../list-items/map-folio-list-item';\r\nimport CardGroup from '../panels/card-group';\r\nimport Note from '../panels/note';\r\n\r\ninterface Props {\r\n    mapFolios: MapFolio[];\r\n    selection: MapFolio | null;\r\n    filter: string;\r\n    selectMapFolio: (mapFolio: MapFolio | null) => void;\r\n    addMapFolio: () => void;\r\n    removeMapFolio: () => void;\r\n    addMap: () => void;\r\n    editMap: (map: Map) => void;\r\n    removeMap: (map: Map) => void;\r\n    changeValue: (source: {}, field: string, value: any) => void;\r\n}\r\n\r\nexport default class MapFoliosScreen extends React.Component<Props> {\r\n    private showMapFolio(folio: MapFolio) {\r\n        let result = Utils.match(this.props.filter, folio.name);\r\n\r\n        if (!result) {\r\n            folio.maps.forEach(map => {\r\n                result = Utils.match(this.props.filter, map.name) || result;\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let leftColumn = null;\r\n            if (this.props.selection) {\r\n                leftColumn = (\r\n                    <div>\r\n                        <MapFolioInfo\r\n                            selection={this.props.selection}\r\n                            filter={this.props.filter}\r\n                            addMap={() => this.props.addMap()}\r\n                            removeMapFolio={() => this.props.removeMapFolio()}\r\n                            changeValue={(source, field, value) => this.props.changeValue(source, field, value)}\r\n                        />\r\n                        <div className='divider' />\r\n                        <button onClick={() => this.props.selectMapFolio(null)}>&larr; back to list</button>\r\n                    </div>\r\n                );\r\n            } else {\r\n                let listItems = this.props.mapFolios.filter(f => this.showMapFolio(f)).map(mapFolio => {\r\n                    return (\r\n                        <MapFolioListItem\r\n                            key={mapFolio.id}\r\n                            mapFolio={mapFolio}\r\n                            filter={this.props.filter}\r\n                            selected={mapFolio === this.props.selection}\r\n                            setSelection={f => this.props.selectMapFolio(f)}\r\n                        />\r\n                    );\r\n                });\r\n                if (listItems.length === 0) {\r\n                    listItems = [(\r\n                        <Note\r\n                            key='empty'\r\n                            content={'you have not set up any tactical maps yet'}\r\n                        />\r\n                    )];\r\n                }\r\n\r\n                leftColumn = (\r\n                    <div>\r\n                        <button onClick={() => this.props.addMapFolio()}>add a new map folio</button>\r\n                        <div className='divider' />\r\n                        {listItems}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            let folio = null;\r\n            if (this.props.selection) {\r\n                const folioCards = [];\r\n\r\n                this.props.selection.maps.filter(m => Utils.match(this.props.filter, m.name)).forEach(m => {\r\n                    folioCards.push(\r\n                        <div className='column' key={m.id}>\r\n                            <MapCard\r\n                                map={m}\r\n                                editMap={map => this.props.editMap(map)}\r\n                                removeMap={map => this.props.removeMap(map)}\r\n                                changeValue={(source, type, value) => this.props.changeValue(source, type, value)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                });\r\n\r\n                if (folioCards.length === 0) {\r\n                    folioCards.push(\r\n                        <div className='column' key='empty'>\r\n                            <Note content={<div className='section'>there are no maps in this folio</div>} />\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                folio = (\r\n                    <CardGroup\r\n                        content={folioCards}\r\n                        heading={this.props.selection.name || 'unnamed folio'}\r\n                    />\r\n                );\r\n            }\r\n\r\n            let watermark;\r\n            if (!this.props.selection) {\r\n                watermark = (\r\n                    <div className='vertical-center-outer'>\r\n                        <div className='vertical-center-middle'>\r\n                            <div className='vertical-center-inner'>\r\n                                <HelpCard mapFolios={this.props.mapFolios} />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='map-builder row collapse'>\r\n                    <div className='columns small-4 medium-4 large-3 scrollable list-column'>\r\n                        {leftColumn}\r\n                    </div>\r\n                    <div className='columns small-8 medium-8 large-9 scrollable'>\r\n                        {folio}\r\n                        {watermark}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface HelpCardProps {\r\n    mapFolios: MapFolio[];\r\n}\r\n\r\nclass HelpCard extends React.Component<HelpCardProps> {\r\n    public render() {\r\n        try {\r\n            let action: JSX.Element | null = null;\r\n            if (this.props.mapFolios.length === 0) {\r\n                action = (\r\n                    <div className='section'>to start a new folio, press the <b>add a new map folio</b> button</div>\r\n                );\r\n            } else {\r\n                action = (\r\n                    <div>\r\n                        <div className='section'>on the left you will see a list of map folios</div>\r\n                        <div className='section'>select a folio from the list to see the maps it contains</div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <Note\r\n                    content={\r\n                        <div>\r\n                            <div className='section'>on this page you can set up folios containing tactical maps</div>\r\n                            <div className='section'>when you have created a map you can use it in the combat manager</div>\r\n                            <div className='divider'/>\r\n                            {action}\r\n                        </div>\r\n                    }\r\n                />\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n        }\r\n    }\r\n}\r\n\r\ninterface MapFolioInfoProps {\r\n    selection: MapFolio;\r\n    filter: string | null;\r\n    changeValue: (source: MapFolio, field: string, value: string) => void;\r\n    addMap: () => void;\r\n    removeMapFolio: () => void;\r\n}\r\n\r\nclass MapFolioInfo extends React.Component<MapFolioInfoProps> {\r\n    public render() {\r\n        try {\r\n            return (\r\n                <div>\r\n                    <div className='section'>\r\n                        <div className='subheading'>map folio name</div>\r\n                        <input\r\n                            type='text'\r\n                            placeholder='map folio name'\r\n                            value={this.props.selection.name}\r\n                            disabled={!!this.props.filter}\r\n                            onChange={event => this.props.changeValue(this.props.selection, 'name', event.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div className='divider' />\r\n                    <div className='section'>\r\n                        <button className={this.props.filter ? 'disabled' : ''} onClick={() => this.props.addMap()}>add a new map</button>\r\n                        <ConfirmButton text='delete folio' callback={() => this.props.removeMapFolio()} />\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { MonsterGroup } from '../../models/monster-group';\r\n\r\ninterface Props {\r\n    group: MonsterGroup;\r\n    selected: boolean;\r\n    filter: string;\r\n    setSelection: (group: MonsterGroup) => void;\r\n}\r\n\r\nexport default class MonsterGroupListItem extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const matchGroup = Utils.match(this.props.filter, this.props.group.name);\r\n\r\n            const monsters = [];\r\n            for (let n = 0; n !== this.props.group.monsters.length; ++n) {\r\n                const monster = this.props.group.monsters[n];\r\n                const name = monster.name || 'unnamed monster';\r\n                if (matchGroup || Utils.match(this.props.filter, name)) {\r\n                    monsters.push(<div key={monster.id} className='section'>{name}</div>);\r\n                }\r\n            }\r\n            if (monsters.length === 0) {\r\n                monsters.push(<div key='empty' className='section'>no monsters</div>);\r\n            }\r\n\r\n            return (\r\n                <div className={this.props.selected ? 'list-item selected' : 'list-item'} onClick={() => this.props.setSelection(this.props.group)}>\r\n                    <div className='heading'>{this.props.group.name || 'unnamed group'}</div>\r\n                    {monsters}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Monster, MonsterGroup } from '../../models/monster-group';\r\n\r\nimport MonsterCard from '../cards/monster-card';\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport MonsterGroupListItem from '../list-items/monster-group-list-item';\r\nimport CardGroup from '../panels/card-group';\r\nimport Note from '../panels/note';\r\n\r\ninterface Props {\r\n    library: MonsterGroup[];\r\n    selection: MonsterGroup | null;\r\n    filter: string;\r\n    selectMonsterGroup: (group: MonsterGroup | null) => void;\r\n    addMonsterGroup: () => void;\r\n    removeMonsterGroup: () => void;\r\n    addMonster: () => void;\r\n    removeMonster: (monster: Monster) => void;\r\n    editMonster: (monster: Monster) => void;\r\n    cloneMonster: (monster: Monster, name: string) => void;\r\n    sortMonsters: () => void;\r\n    moveToGroup: (monster: Monster, groupID: string) => void;\r\n    changeValue: (source: any, field: string, value: any) => void;\r\n    nudgeValue: (source: any, field: string, value: number) => void;\r\n}\r\n\r\nexport default class MonsterLibraryScreen extends React.Component<Props> {\r\n    private showMonsterGroup(group: MonsterGroup) {\r\n        let result = Utils.match(this.props.filter, group.name);\r\n\r\n        if (!result) {\r\n            group.monsters.forEach(monster => {\r\n                result = Utils.match(this.props.filter, monster.name) || result;\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let leftColumn = null;\r\n            if (this.props.selection) {\r\n                leftColumn = (\r\n                    <div>\r\n                        <MonsterInfo\r\n                            selection={this.props.selection}\r\n                            filter={this.props.filter}\r\n                            addMonster={() => this.props.addMonster()}\r\n                            sortMonsters={() => this.props.sortMonsters()}\r\n                            changeValue={(type, value) => this.props.changeValue(this.props.selection, type, value)}\r\n                            removeMonsterGroup={() => this.props.removeMonsterGroup()}\r\n                        />\r\n                        <div className='divider' />\r\n                        <button onClick={() => this.props.selectMonsterGroup(null)}>&larr; back to list</button>\r\n                    </div>\r\n                );\r\n            } else {\r\n                let listItems = this.props.library.filter(group => this.showMonsterGroup(group)).map(group => {\r\n                    return (\r\n                        <MonsterGroupListItem\r\n                            key={group.id}\r\n                            group={group}\r\n                            filter={this.props.filter}\r\n                            selected={group === this.props.selection}\r\n                            setSelection={grp => this.props.selectMonsterGroup(grp)}\r\n                        />\r\n                    );\r\n                });\r\n                if (listItems.length === 0) {\r\n                    listItems = [(\r\n                        <Note\r\n                            key='empty'\r\n                            content={'you do not have any monsters in your library'}\r\n                        />\r\n                    )];\r\n                }\r\n\r\n                leftColumn = (\r\n                    <div>\r\n                        <button onClick={() => this.props.addMonsterGroup()}>add a new monster group</button>\r\n                        <div className='divider' />\r\n                        {listItems}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            const cards: JSX.Element[] = [];\r\n\r\n            if (this.props.selection) {\r\n                const monsters = this.props.selection.monsters.filter(monster => {\r\n                    return Utils.match(this.props.filter, monster.name);\r\n                });\r\n\r\n                if (monsters.length !== 0) {\r\n                    monsters.forEach(m => {\r\n                        cards.push(\r\n                            <div className='column' key={m.id}>\r\n                                <MonsterCard\r\n                                    combatant={m}\r\n                                    mode={'view editable'}\r\n                                    library={this.props.library}\r\n                                    changeValue={(source, type, value) => this.props.changeValue(source, type, value)}\r\n                                    nudgeValue={(source, type, delta) => this.props.nudgeValue(source, type, delta)}\r\n                                    moveToGroup={(monster, groupID) => this.props.moveToGroup(monster, groupID)}\r\n                                    removeMonster={monster => this.props.removeMonster(monster)}\r\n                                    editMonster={monster => this.props.editMonster(monster)}\r\n                                    cloneMonster={(monster, monsterName) => this.props.cloneMonster(monster, monsterName)}\r\n                                />\r\n                            </div>\r\n                        );\r\n                    });\r\n                } else {\r\n                    cards.push(\r\n                        <div className='column' key='empty'>\r\n                            <Note content={<div className='section'>there are no monsters in this group</div>} />\r\n                        </div>\r\n                    );\r\n                }\r\n            }\r\n\r\n            let name;\r\n            if (this.props.selection) {\r\n                name = this.props.selection.name;\r\n                if (!name) {\r\n                    name = 'unnamed group';\r\n                }\r\n            }\r\n\r\n            let watermark;\r\n            if (!this.props.selection) {\r\n                watermark = (\r\n                    <div className='vertical-center-outer'>\r\n                        <div className='vertical-center-middle'>\r\n                            <div className='vertical-center-inner'>\r\n                                <HelpCard library={this.props.library} />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='monster-library row collapse'>\r\n                    <div className='columns small-4 medium-4 large-3 scrollable list-column'>\r\n                        {leftColumn}\r\n                    </div>\r\n                    <div className='columns small-8 medium-8 large-9 scrollable'>\r\n                        <CardGroup\r\n                            content={cards}\r\n                            heading={name}\r\n                            hidden={!this.props.selection}\r\n                        />\r\n                        {watermark}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface HelpCardProps {\r\n    library: MonsterGroup[];\r\n}\r\n\r\nclass HelpCard extends React.Component<HelpCardProps> {\r\n    public render() {\r\n        let action: JSX.Element | null = null;\r\n        if (this.props.library.length === 0) {\r\n            action = (\r\n                <div className='section'>to start adding monsters, press the <b>add a new monster group</b> button</div>\r\n            );\r\n        } else {\r\n            action = (\r\n                <div>\r\n                    <div className='section'>on the left you will see a list of monster groups</div>\r\n                    <div className='section'>select a monster group from the list to see stat blocks for monsters in that group</div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <Note\r\n                content={\r\n                    <div>\r\n                        <div className='section'>you can maintain your menagerie of monsters here</div>\r\n                        <div className='section'>you can then use these monsters to design combat encounters in the encounter builder</div>\r\n                        <div className='divider'/>\r\n                        {action}\r\n                    </div>\r\n                }\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\ninterface MonsterInfoProps {\r\n    selection: MonsterGroup;\r\n    filter: string | null;\r\n    changeValue: (field: string, value: string) => void;\r\n    addMonster: () => void;\r\n    sortMonsters: () => void;\r\n    removeMonsterGroup: () => void;\r\n}\r\n\r\nclass MonsterInfo extends React.Component<MonsterInfoProps> {\r\n    public render() {\r\n        try {\r\n            return (\r\n                <div>\r\n                    <div className='section'>\r\n                        <div className='subheading'>monster group name</div>\r\n                        <input\r\n                            type='text'\r\n                            placeholder='monster group name'\r\n                            value={this.props.selection.name}\r\n                            disabled={!!this.props.filter}\r\n                            onChange={event => this.props.changeValue('name', event.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div className='divider' />\r\n                    <div className='section'>\r\n                        <button className={this.props.filter ? 'disabled' : ''} onClick={() => this.props.addMonster()}>add a new monster</button>\r\n                        <button className={this.props.filter ? 'disabled' : ''} onClick={() => this.props.sortMonsters()}>sort monsters</button>\r\n                        <ConfirmButton text='delete group' callback={() => this.props.removeMonsterGroup()} />\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Party } from '../../models/party';\r\n\r\ninterface Props {\r\n    party: Party;\r\n    selected: boolean;\r\n    filter: string;\r\n    setSelection: (party: Party) => void;\r\n}\r\n\r\nexport default class PartyListItem extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const matchParty = Utils.match(this.props.filter, this.props.party.name);\r\n\r\n            const pcs = [];\r\n            for (let n = 0; n !== this.props.party.pcs.length; ++n) {\r\n                const pc = this.props.party.pcs[n];\r\n                let name = pc.name || 'unnamed pc';\r\n                if (pc.player) {\r\n                    name += ' (' + pc.player + ')';\r\n                }\r\n                if (matchParty || Utils.match(this.props.filter, name)) {\r\n                    pcs.push(<div key={pc.id} className='section'>{name}</div>);\r\n                }\r\n            }\r\n            if (pcs.length === 0) {\r\n                pcs.push(<div key='empty' className='section'>no pcs</div>);\r\n            }\r\n\r\n            return (\r\n                <div className={this.props.selected ? 'list-item selected' : 'list-item'} onClick={() => this.props.setSelection(this.props.party)}>\r\n                    <div className='heading'>{this.props.party.name || 'unnamed party'}</div>\r\n                    {pcs}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Party, PC } from '../../models/party';\r\n\r\nimport PCCard from '../cards/pc-card';\r\nimport ConfirmButton from '../controls/confirm-button';\r\nimport PartyListItem from '../list-items/party-list-item';\r\nimport CardGroup from '../panels/card-group';\r\nimport Note from '../panels/note';\r\n\r\ninterface Props {\r\n    parties: Party[];\r\n    selection: Party | null;\r\n    filter: string;\r\n    selectParty: (party: Party | null) => void;\r\n    addParty: () => void;\r\n    removeParty: () => void;\r\n    addPC: () => void;\r\n    editPC: (pc: PC) => void;\r\n    removePC: (pc: PC) => void;\r\n    sortPCs: () => void;\r\n    changeValue: (source: any, field: string, value: any) => void;\r\n    nudgeValue: (source: any, field: string, value: number) => void;\r\n}\r\n\r\nexport default class PartiesScreen extends React.Component<Props> {\r\n    private showParty(party: Party) {\r\n        let result = Utils.match(this.props.filter, party.name);\r\n\r\n        if (!result) {\r\n            party.pcs.forEach(pc => {\r\n                result = Utils.match(this.props.filter, pc.name) || result;\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let leftColumn = null;\r\n            if (this.props.selection) {\r\n                leftColumn = (\r\n                    <div>\r\n                        <PartyInfo\r\n                            selection={this.props.selection}\r\n                            filter={this.props.filter}\r\n                            addPC={() => this.props.addPC()}\r\n                            sortPCs={() => this.props.sortPCs()}\r\n                            changeValue={(type, value) => this.props.changeValue(this.props.selection, type, value)}\r\n                            removeParty={() => this.props.removeParty()}\r\n                        />\r\n                        <div className='divider' />\r\n                        <button onClick={() => this.props.selectParty(null)}>&larr; back to list</button>\r\n                    </div>\r\n                );\r\n            } else {\r\n                let listItems = this.props.parties.filter(p => this.showParty(p)).map(p => {\r\n                    return (\r\n                        <PartyListItem\r\n                            key={p.id}\r\n                            party={p}\r\n                            filter={this.props.filter}\r\n                            selected={p === this.props.selection}\r\n                            setSelection={party => this.props.selectParty(party)}\r\n                        />\r\n                    );\r\n                });\r\n                if (listItems.length === 0) {\r\n                    listItems = [(\r\n                        <Note\r\n                            key='empty'\r\n                            content={'you have not set up any parties yet'}\r\n                        />\r\n                    )];\r\n                }\r\n\r\n                leftColumn = (\r\n                    <div>\r\n                        <button onClick={() => this.props.addParty()}>add a new party</button>\r\n                        <div className='divider' />\r\n                        {listItems}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            const activeCards: JSX.Element[] = [];\r\n            const inactiveCards: JSX.Element[] = [];\r\n\r\n            if (this.props.selection) {\r\n                const pcs = this.props.selection.pcs.filter(pc => {\r\n                    return Utils.match(this.props.filter, pc.name);\r\n                });\r\n\r\n                const activePCs = pcs.filter(pc => pc.active);\r\n                activePCs.forEach(activePC => {\r\n                    activeCards.push(\r\n                        <div className='column' key={activePC.id}>\r\n                            <PCCard\r\n                                combatant={activePC}\r\n                                mode={'edit'}\r\n                                changeValue={(pc, type, value) => this.props.changeValue(pc, type, value)}\r\n                                nudgeValue={(pc, type, delta) => this.props.nudgeValue(pc, type, delta)}\r\n                                editPC={pc => this.props.editPC(pc)}\r\n                                removePC={pc => this.props.removePC(pc)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                });\r\n\r\n                const inactivePCs = pcs.filter(pc => !pc.active);\r\n                inactivePCs.forEach(inactivePC => {\r\n                    inactiveCards.push(\r\n                        <div className='column' key={inactivePC.id}>\r\n                            <PCCard\r\n                                combatant={inactivePC}\r\n                                mode={'edit'}\r\n                                changeValue={(pc, type, value) => this.props.changeValue(pc, type, value)}\r\n                                nudgeValue={(pc, type, delta) => this.props.nudgeValue(pc, type, delta)}\r\n                                editPC={pc => this.props.editPC(pc)}\r\n                                removePC={pc => this.props.removePC(pc)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                });\r\n\r\n                if (activePCs.length === 0) {\r\n                    activeCards.push(\r\n                        <div className='column' key='empty'>\r\n                            <Note content={<div className='section'>there are no pcs in this party</div>} />\r\n                        </div>\r\n                    );\r\n                }\r\n            }\r\n\r\n            let name;\r\n            if (this.props.selection) {\r\n                name = this.props.selection.name || 'unnamed party';\r\n            }\r\n\r\n            let watermark;\r\n            if (!this.props.selection) {\r\n                watermark = (\r\n                    <div className='vertical-center-outer'>\r\n                        <div className='vertical-center-middle'>\r\n                            <div className='vertical-center-inner'>\r\n                                <HelpCard parties={this.props.parties} />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='parties row collapse'>\r\n                    <div className='columns small-4 medium-4 large-3 scrollable list-column'>\r\n                        {leftColumn}\r\n                    </div>\r\n                    <div className='columns small-8 medium-8 large-9 scrollable'>\r\n                        <CardGroup\r\n                            content={activeCards}\r\n                            heading={name}\r\n                            hidden={!this.props.selection}\r\n                        />\r\n                        <CardGroup\r\n                            content={inactiveCards}\r\n                            heading='inactive pcs'\r\n                            hidden={inactiveCards.length === 0}\r\n                        />\r\n                        {watermark}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface HelpCardProps {\r\n    parties: Party[];\r\n}\r\n\r\nclass HelpCard extends React.Component<HelpCardProps> {\r\n    public render() {\r\n        try {\r\n            let action: JSX.Element | null = null;\r\n            if (this.props.parties.length === 0) {\r\n                action = (\r\n                    <div className='section'>to start adding a party, press the <b>add a new party</b> button</div>\r\n                );\r\n            } else {\r\n                action = (\r\n                    <div>\r\n                        <div className='section'>on the left you will see a list of parties that you have created</div>\r\n                        <div className='section'>select a party from the list to see pc details</div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <Note\r\n                    content={\r\n                        <div>\r\n                            <div className='section'>this page is where you can tell dojo all about your pcs</div>\r\n                            <div className='section'>you can add a party for each of your gaming groups</div>\r\n                            <div className='section'>when you have set up a party and an encounter you can run the encounter in the combat manager</div>\r\n                            <div className='divider'/>\r\n                            {action}\r\n                        </div>\r\n                    }\r\n                />\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n        }\r\n    }\r\n}\r\n\r\ninterface PartyInfoProps {\r\n    selection: Party;\r\n    filter: string | null;\r\n    changeValue: (field: string, value: string) => void;\r\n    addPC: () => void;\r\n    sortPCs: () => void;\r\n    removeParty: () => void;\r\n}\r\n\r\nclass PartyInfo extends React.Component<PartyInfoProps> {\r\n    private getSummary() {\r\n        const activePCs = this.props.selection.pcs.filter(pc => pc.active);\r\n        if (activePCs.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        let languages = '';\r\n        let insightSummary = '-';\r\n        let investigationSummary = '-';\r\n        let perceptionSummary = '-';\r\n\r\n        languages = activePCs\r\n            .map(pc => pc.languages)\r\n            .join(', ')\r\n            .split(/[ ,;]+/)\r\n            .reduce((array: string[], value) => {\r\n                if (array.indexOf(value) === -1) {\r\n                    array.push(value);\r\n                }\r\n                return array;\r\n            }, [])\r\n            .sort((a, b) => {\r\n                if (a === 'Common') {\r\n                    return -1;\r\n                }\r\n                if (b === 'Common') {\r\n                    return 1;\r\n                }\r\n                return a.localeCompare(b);\r\n            })\r\n            .join(', ');\r\n\r\n        const insight: { min: number | null, max: number | null } = { min: null, max: null };\r\n        const invest: { min: number | null, max: number | null } = { min: null, max: null };\r\n        const percep: { min: number | null, max: number | null } = { min: null, max: null };\r\n\r\n        activePCs.forEach(pc => {\r\n            insight.min = insight.min === null ? pc.passiveInsight : Math.min(insight.min, pc.passiveInsight);\r\n            insight.max = insight.max === null ? pc.passiveInsight : Math.max(insight.max, pc.passiveInsight);\r\n            invest.min = invest.min === null ? pc.passiveInvestigation : Math.min(invest.min, pc.passiveInvestigation);\r\n            invest.max = invest.max === null ? pc.passiveInvestigation : Math.max(invest.max, pc.passiveInvestigation);\r\n            percep.min = percep.min === null ? pc.passivePerception : Math.min(percep.min, pc.passivePerception);\r\n            percep.max = percep.max === null ? pc.passivePerception : Math.max(percep.max, pc.passivePerception);\r\n        });\r\n\r\n        insightSummary = insight.min === insight.max ? (insight.min as number).toString() : insight.min + ' - ' + insight.max;\r\n        investigationSummary = invest.min === invest.max ? (invest.min as number).toString() : invest.min + ' - ' + invest.max;\r\n        perceptionSummary = percep.min === percep.max ? (percep.min as number).toString() : percep.min + ' - ' + percep.max;\r\n\r\n        return (\r\n            <div className='group-panel'>\r\n                <div className='section' style={{ display: languages !== '' ? 'block' : 'none' }}>\r\n                    <div className='subheading'>party languages</div>\r\n                </div>\r\n                <div className='section'>\r\n                    {languages}\r\n                </div>\r\n                <div className='section'>\r\n                    <div className='subheading'>party passive skills</div>\r\n                </div>\r\n                <div className='table'>\r\n                    <div>\r\n                        <div className='cell three'><b>insight</b></div>\r\n                        <div className='cell three'><b>invest.</b></div>\r\n                        <div className='cell three'><b>percep.</b></div>\r\n                    </div>\r\n                    <div>\r\n                        <div className='cell three'>{insightSummary}</div>\r\n                        <div className='cell three'>{investigationSummary}</div>\r\n                        <div className='cell three'>{perceptionSummary}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            return (\r\n                <div>\r\n                    <div className='section'>\r\n                        <div className='subheading'>party name</div>\r\n                        <input\r\n                            type='text'\r\n                            placeholder='party name'\r\n                            value={this.props.selection.name}\r\n                            disabled={!!this.props.filter}\r\n                            onChange={event => this.props.changeValue('name', event.target.value)}\r\n                        />\r\n                    </div>\r\n                    {this.getSummary()}\r\n                    <div className='divider' />\r\n                    <div className='section'>\r\n                        <button className={this.props.filter ? 'disabled' : ''} onClick={() => this.props.addPC()}>add a new pc</button>\r\n                        <button className={this.props.filter ? 'disabled' : ''} onClick={() => this.props.sortPCs()}>sort pcs</button>\r\n                        <ConfirmButton text='delete party' callback={() => this.props.removeParty()} />\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Napoleon from '../../utils/napoleon';\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { EncounterSlot, MonsterFilter } from '../../models/encounter';\r\nimport { Monster, MonsterGroup } from '../../models/monster-group';\r\n\r\nimport Factory from '../../utils/factory';\r\nimport MonsterCard from '../cards/monster-card';\r\nimport FilterPanel from '../panels/filter-panel';\r\nimport Note from '../panels/note';\r\n\r\ninterface Props {\r\n    combatantSlots: EncounterSlot[];\r\n    library: MonsterGroup[];\r\n}\r\n\r\ninterface State {\r\n    combatantSlots: EncounterSlot[];\r\n    filter: MonsterFilter;\r\n}\r\n\r\nexport default class AddCombatantsModal extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            combatantSlots: props.combatantSlots,\r\n            filter: Factory.createMonsterFilter()\r\n        };\r\n    }\r\n\r\n    private changeFilterValue(type: 'name' | 'challengeMin' | 'challengeMax' | 'category' | 'size', value: any) {\r\n        // eslint-disable-next-line\r\n        this.state.filter[type] = value as never;\r\n        this.setState({\r\n            filter: this.state.filter\r\n        });\r\n    }\r\n\r\n    private nudgeFilterValue(type: 'challengeMin' | 'challengeMax', delta: number) {\r\n        const value = Utils.nudgeChallenge(this.state.filter[type], delta);\r\n        this.changeFilterValue(type, value);\r\n    }\r\n\r\n    private resetFilter() {\r\n        this.setState({\r\n            filter: Factory.createMonsterFilter()\r\n        });\r\n    }\r\n\r\n    private matchMonster(monster: Monster) {\r\n        return Napoleon.matchMonster(monster, this.state.filter);\r\n    }\r\n\r\n    private selectMonster(monster: Monster) {\r\n        const slot = Factory.createEncounterSlot();\r\n        slot.monsterGroupName = Utils.getMonsterGroup(monster, this.props.library).name;\r\n        slot.monsterName = monster.name;\r\n        this.state.combatantSlots.push(slot);\r\n        this.state.combatantSlots.sort((a, b) => {\r\n            if (a.monsterName < b.monsterName) { return -1; }\r\n            if (a.monsterName > b.monsterName) { return 1; }\r\n            return 0;\r\n        });\r\n        this.setState({\r\n            combatantSlots: this.state.combatantSlots\r\n        });\r\n    }\r\n\r\n    private deselectMonster(monster: Monster) {\r\n        const group = Utils.getMonsterGroup(monster, this.props.library);\r\n        const slot = this.state.combatantSlots.find(s => (s.monsterGroupName === group.name) && (s.monsterName === monster.name));\r\n        if (slot) {\r\n            const index = this.state.combatantSlots.indexOf(slot);\r\n            this.state.combatantSlots.splice(index, 1);\r\n            this.setState({\r\n                combatantSlots: this.state.combatantSlots\r\n            });\r\n        }\r\n    }\r\n\r\n    private nudgeMonsterCount(slot: EncounterSlot, delta: number) {\r\n        slot.count += delta;\r\n        if (slot.count === 0) {\r\n            const group = this.props.library.find(g => g.name === slot.monsterGroupName);\r\n            if (group) {\r\n                const monster = group.monsters.find(m => m.name === slot.monsterName);\r\n                if (monster) {\r\n                    this.deselectMonster(monster);\r\n                }\r\n            }\r\n        } else {\r\n            this.setState({\r\n                combatantSlots: this.state.combatantSlots\r\n            });\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const monsters: Monster[] = [];\r\n            this.props.library.forEach(group => {\r\n                group.monsters.forEach(monster => {\r\n                    if (this.matchMonster(monster)) {\r\n                        monsters.push(monster);\r\n                    }\r\n                });\r\n            });\r\n            monsters.sort((a, b) => {\r\n                if (a.name < b.name) { return -1; }\r\n                if (a.name > b.name) { return 1; }\r\n                return 0;\r\n            });\r\n            const currentIDs = this.state.combatantSlots.map(slot => {\r\n                const group = this.props.library.find(g => g.name === slot.monsterGroupName);\r\n                if (group) {\r\n                    const monster = group.monsters.find(m => m.name === slot.monsterName);\r\n                    if (monster) {\r\n                        return monster.id;\r\n                    }\r\n                }\r\n                return null;\r\n            }).filter(id => !!id);\r\n            let allCombatants: JSX.Element | JSX.Element[] = monsters.filter(m => !currentIDs.includes(m.id)).map(m => {\r\n                return (\r\n                    <MonsterCard key={m.id} combatant={m} mode='view candidate' selectMonster={monster => this.selectMonster(monster)} />\r\n                );\r\n            });\r\n            if (allCombatants.length === 0) {\r\n                allCombatants = (\r\n                    <Note\r\n                        content={(\r\n                            <div className='section'>\r\n                                there are no monsters that match the above criteria (or you have already selected them all)\r\n                            </div>\r\n                        )}\r\n                    />\r\n                );\r\n            }\r\n\r\n            const selectedCombatants: (JSX.Element | null)[] = this.state.combatantSlots.map(slot => {\r\n                const group = this.props.library.find(g => g.name === slot.monsterGroupName);\r\n                if (group) {\r\n                    const monster = group.monsters.find(m => m.name === slot.monsterName);\r\n                    if (monster) {\r\n                        return (\r\n                            <MonsterCard\r\n                                key={monster.id}\r\n                                combatant={monster}\r\n                                slot={slot}\r\n                                mode='view candidate selected'\r\n                                deselectMonster={m => this.deselectMonster(m)}\r\n                                nudgeValue={(source, field, delta) => this.nudgeMonsterCount(slot, delta)}\r\n                            />\r\n                        );\r\n                    }\r\n                }\r\n                return null;\r\n            });\r\n\r\n            return (\r\n                <div className='add-combatants-modal'>\r\n                    <div className='row' style={{ height: '100%' }}>\r\n                        <div className='columns small-6 medium-6 large-6 scrollable'>\r\n                            <div className='heading'>all combatants</div>\r\n                            <FilterPanel\r\n                                filter={this.state.filter}\r\n                                changeValue={(type, value) => this.changeFilterValue(type, value)}\r\n                                nudgeValue={(type, delta) => this.nudgeFilterValue(type, delta)}\r\n                                resetFilter={() => this.resetFilter()}\r\n                            />\r\n                            <div className='divider' />\r\n                            {allCombatants}\r\n                        </div>\r\n                        <div className='columns small-6 medium-6 large-6 scrollable'>\r\n                            <div className='heading'>selected combatants</div>\r\n                            {selectedCombatants}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { CombatSetup } from '../../models/combat';\r\nimport { Encounter, EncounterSlot } from '../../models/encounter';\r\nimport { MapFolio } from '../../models/map-folio';\r\nimport { Monster } from '../../models/monster-group';\r\nimport { Party } from '../../models/party';\r\n\r\nimport Dropdown from '../controls/dropdown';\r\nimport Selector from '../controls/selector';\r\nimport DifficultyChartPanel from '../panels/difficulty-chart-panel';\r\nimport MapPanel from '../panels/map-panel';\r\n\r\ninterface Props {\r\n    combatSetup: CombatSetup;\r\n    parties: Party[];\r\n    encounters: Encounter[];\r\n    mapFolios: MapFolio[];\r\n    getMonster: (monsterName: string, groupName: string) => Monster | null;\r\n    notify: () => void;\r\n}\r\n\r\ninterface State {\r\n    combatSetup: CombatSetup;\r\n}\r\n\r\nexport default class CombatStartModal extends React.Component<Props, State> {\r\n    public static defaultProps = {\r\n        parties: null,\r\n        mapFolios: null\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            combatSetup: props.combatSetup\r\n        };\r\n    }\r\n\r\n    private setParty(partyID: string | null) {\r\n        // eslint-disable-next-line\r\n        this.state.combatSetup.partyID = partyID;\r\n        this.setState({\r\n            combatSetup: this.state.combatSetup\r\n        }, () => this.props.notify());\r\n    }\r\n\r\n    private setEncounter(encounterID: string | null) {\r\n        // eslint-disable-next-line\r\n        this.state.combatSetup.encounterID = encounterID;\r\n        const enc = this.props.encounters.find(e => e.id === encounterID);\r\n        if (enc) {\r\n            // eslint-disable-next-line\r\n            this.state.combatSetup.monsterNames = Utils.getMonsterNames(enc);\r\n        }\r\n        this.setState({\r\n            combatSetup: this.state.combatSetup\r\n        }, () => this.props.notify());\r\n    }\r\n\r\n    private setFolioID(id: string | null) {\r\n        if (id && (id !== '')) {\r\n            const folio = this.props.mapFolios.find(f => f.id === id);\r\n            if (folio) {\r\n                // eslint-disable-next-line\r\n                this.state.combatSetup.folioID = folio.id;\r\n                // eslint-disable-next-line\r\n                this.state.combatSetup.mapID = folio.maps.length === 1 ? folio.maps[0].id : null;\r\n            }\r\n        } else {\r\n            // eslint-disable-next-line\r\n            this.state.combatSetup.folioID = null;\r\n            // eslint-disable-next-line\r\n            this.state.combatSetup.mapID = null;\r\n        }\r\n        this.setState({\r\n            combatSetup: this.state.combatSetup\r\n        });\r\n    }\r\n\r\n    private setMapID(id: string) {\r\n        // eslint-disable-next-line\r\n        this.state.combatSetup.mapID = id;\r\n        this.setState({\r\n            combatSetup: this.state.combatSetup\r\n        });\r\n    }\r\n\r\n    private setWave(waveID: string | null) {\r\n        // eslint-disable-next-line\r\n        this.state.combatSetup.waveID = waveID;\r\n        const enc = this.props.encounters.find(e => e.id === this.state.combatSetup.encounterID);\r\n        if (enc) {\r\n            const wave = enc.waves.find(w => w.id === waveID);\r\n            if (wave) {\r\n                // eslint-disable-next-line\r\n                this.state.combatSetup.monsterNames = Utils.getMonsterNames(wave);\r\n            }\r\n        }\r\n        this.setState({\r\n            combatSetup: this.state.combatSetup\r\n        }, () => this.props.notify());\r\n    }\r\n\r\n    private setEncounterInitMode(mode: 'manual' | 'individual' | 'group') {\r\n        // eslint-disable-next-line\r\n        this.state.combatSetup.encounterInitMode = mode;\r\n        this.setState({\r\n            combatSetup: this.state.combatSetup\r\n        });\r\n    }\r\n\r\n    private changeName(slotID: string, index: number, name: string) {\r\n        const slot = this.state.combatSetup.monsterNames.find(s => s.id === slotID);\r\n        if (slot) {\r\n            slot.names[index] = name;\r\n            this.setState({\r\n                combatSetup: this.state.combatSetup\r\n            });\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    private getPartySection() {\r\n        if (this.props.parties.length === 0) {\r\n            return (\r\n                <div className='section'>you have not defined any parties</div>\r\n            );\r\n        }\r\n\r\n        const partyOptions = this.props.parties.map(party => {\r\n            return {\r\n                id: party.id,\r\n                text: party.name || 'unnamed party'\r\n            };\r\n        });\r\n\r\n        let partyContent = null;\r\n        if (this.state.combatSetup.partyID) {\r\n            const selectedParty = this.props.parties.find(p => p.id === this.state.combatSetup.partyID);\r\n            if (selectedParty) {\r\n                const pcs = selectedParty.pcs.filter(pc => pc.active);\r\n\r\n                const pcSections = pcs.map(pc =>\r\n                    (\r\n                        <li key={pc.id}>\r\n                            {pc.name || 'unnamed pc'} (level {pc.level})\r\n                        </li>\r\n                    )\r\n                );\r\n\r\n                if (pcSections.length === 0) {\r\n                    pcSections.push(\r\n                        <li key={'empty'}>no pcs</li>\r\n                    );\r\n                }\r\n\r\n                partyContent = (\r\n                    <div>\r\n                        <div className='subheading'>pcs</div>\r\n                        <ul>{pcSections}</ul>\r\n                    </div>\r\n                );\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='heading'>party</div>\r\n                <Dropdown\r\n                    options={partyOptions}\r\n                    placeholder='select party...'\r\n                    selectedID={this.state.combatSetup.partyID ? this.state.combatSetup.partyID : undefined}\r\n                    select={optionID => this.setParty(optionID)}\r\n                    clear={() => this.setParty(null)}\r\n                />\r\n                {partyContent}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getEncounterSection() {\r\n        if (this.props.encounters.length === 0) {\r\n            return (\r\n                <div className='section'>you have not built any encounters</div>\r\n            );\r\n        }\r\n\r\n        const encounterOptions = this.props.encounters.map(encounter => {\r\n            return {\r\n                id: encounter.id,\r\n                text: encounter.name || 'unnamed encounter'\r\n            };\r\n        });\r\n\r\n        let encounterContent = null;\r\n        if (this.state.combatSetup.encounterID) {\r\n            const selectedEncounter = this.props.encounters.find(e => e.id === this.state.combatSetup.encounterID);\r\n            if (selectedEncounter) {\r\n                const monsterSections = selectedEncounter.slots.map(slot => {\r\n                    let name = slot.monsterName || 'unnamed monster';\r\n                    if (slot.count > 1) {\r\n                        name += ' (x' + slot.count + ')';\r\n                    }\r\n                    return (\r\n                        <li key={slot.id}>{name}</li>\r\n                    );\r\n                });\r\n\r\n                if (monsterSections.length === 0) {\r\n                    monsterSections.push(\r\n                        <li key={'empty'}>no monsters</li>\r\n                    );\r\n                }\r\n\r\n                const waves = selectedEncounter.waves.map(wave => {\r\n                    if (wave.slots.length === 0) {\r\n                        return null;\r\n                    }\r\n\r\n                    const waveMonsters = wave.slots.map(slot => {\r\n                        let name = slot.monsterName || 'unnamed monster';\r\n                        if (slot.count > 1) {\r\n                            name += ' x' + slot.count;\r\n                        }\r\n                        return (\r\n                            <li key={slot.id}>{name}</li>\r\n                        );\r\n                    });\r\n\r\n                    return (\r\n                        <div key={wave.id}>\r\n                            <div className='subheading'>{wave.name || 'unnamed wave'}</div>\r\n                            <ul>{waveMonsters}</ul>\r\n                        </div>\r\n                    );\r\n                });\r\n\r\n                encounterContent = (\r\n                    <div>\r\n                        <div className='subheading'>monsters</div>\r\n                        <ul>{monsterSections}</ul>\r\n                        {waves}\r\n                    </div>\r\n                );\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='heading'>encounter</div>\r\n                <Dropdown\r\n                    options={encounterOptions}\r\n                    placeholder='select encounter...'\r\n                    selectedID={this.state.combatSetup.encounterID ? this.state.combatSetup.encounterID : undefined}\r\n                    select={optionID => this.setEncounter(optionID)}\r\n                    clear={() => this.setEncounter(null)}\r\n                />\r\n                {encounterContent}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getMapSection() {\r\n        const folios = this.props.mapFolios.filter(folio => folio.maps.length > 0);\r\n        if (folios.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        const folioOptions = [{\r\n            id: '',\r\n            text: 'none'\r\n        }].concat(folios.map(folio => {\r\n            return {\r\n                id: folio.id,\r\n                text: folio.name || 'unnamed folio'\r\n            };\r\n        }));\r\n\r\n        let selectMapSection = null;\r\n        let thumbnailSection = null;\r\n\r\n        if (this.state.combatSetup.folioID) {\r\n            const folio = this.props.mapFolios.find(f => f.id === this.state.combatSetup.folioID);\r\n            if (folio) {\r\n                const mapOptions = folio.maps.map(m => {\r\n                    return {\r\n                        id: m.id,\r\n                        text: m.name || 'unnamed map'\r\n                    };\r\n                });\r\n\r\n                if (mapOptions.length !== 1) {\r\n                    selectMapSection = (\r\n                        <Selector\r\n                            options={mapOptions}\r\n                            selectedID={this.state.combatSetup.mapID}\r\n                            select={optionID => this.setMapID(optionID)}\r\n                        />\r\n                    );\r\n                }\r\n\r\n                if (this.state.combatSetup.mapID) {\r\n                    const map = folio.maps.find(m => m.id === this.state.combatSetup.mapID);\r\n                    if (map) {\r\n                        thumbnailSection = (\r\n                            <MapPanel\r\n                                map={map}\r\n                                mode='thumbnail'\r\n                                size={10}\r\n                            />\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='heading'>map</div>\r\n                <Dropdown\r\n                    options={folioOptions}\r\n                    placeholder='select map folio...'\r\n                    selectedID={this.state.combatSetup.folioID ? this.state.combatSetup.folioID : undefined}\r\n                    select={optionID => this.setFolioID(optionID)}\r\n                    clear={() => this.setFolioID(null)}\r\n                />\r\n                {selectMapSection}\r\n                {thumbnailSection}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getWaveSection() {\r\n        if (this.state.combatSetup.encounterID === null) {\r\n            return (\r\n                <div className='section'>you have not selected an encounter</div>\r\n            );\r\n        }\r\n\r\n        const selectedEncounter = this.props.encounters.find(e => e.id === this.state.combatSetup.encounterID);\r\n        if (selectedEncounter) {\r\n            if (selectedEncounter.waves.length === 0) {\r\n                return (\r\n                    <div className='section'>you have not defined any waves</div>\r\n                );\r\n            }\r\n\r\n            const waveOptions = selectedEncounter.waves.map(wave => {\r\n                return {\r\n                    id: wave.id,\r\n                    text: wave.name || 'unnamed wave'\r\n                };\r\n            });\r\n\r\n            let waveContent = null;\r\n            if (this.state.combatSetup.waveID) {\r\n                const selectedWave = selectedEncounter.waves.find(w => w.id === this.state.combatSetup.waveID);\r\n                if (selectedWave) {\r\n                    const monsterSections = selectedWave.slots.map(slot => {\r\n                        let name = slot.monsterName || 'unnamed monster';\r\n                        if (slot.count > 1) {\r\n                            name += ' (x' + slot.count + ')';\r\n                        }\r\n                        return (\r\n                            <li key={slot.id}>{name}</li>\r\n                        );\r\n                    });\r\n\r\n                    if (monsterSections.length === 0) {\r\n                        monsterSections.push(\r\n                            <li key={'empty'}>no monsters</li>\r\n                        );\r\n                    }\r\n\r\n                    waveContent = (\r\n                        <div>\r\n                            <div className='subheading'>monsters</div>\r\n                            <ul>{monsterSections}</ul>\r\n                        </div>\r\n                    );\r\n                }\r\n            }\r\n\r\n            return (\r\n                <div>\r\n                    <div className='heading'>wave</div>\r\n                    <Dropdown\r\n                        options={waveOptions}\r\n                        placeholder='select wave...'\r\n                        selectedID={this.state.combatSetup.waveID ? this.state.combatSetup.waveID : undefined}\r\n                        select={optionID => this.setWave(optionID)}\r\n                        clear={() => this.setWave(null)}\r\n                    />\r\n                    {waveContent}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private getDifficultySection() {\r\n        const party = this.props.parties.find(p => p.id === this.state.combatSetup.partyID);\r\n        const encounter = this.props.encounters.find(enc => enc.id === this.state.combatSetup.encounterID);\r\n\r\n        if (party && encounter) {\r\n            return (\r\n                <div>\r\n                    <div className='heading'>encounter difficulty</div>\r\n                    <DifficultyChartPanel\r\n                        parties={this.props.parties}\r\n                        party={party}\r\n                        encounter={encounter}\r\n                        getMonster={(monsterName, monsterGroupName) => this.props.getMonster(monsterName, monsterGroupName)}\r\n                    />\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='heading'>encounter difficulty</div>\r\n                <div className='section'>select a party and an encounter on the left to see difficulty information.</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getMonsterSection() {\r\n        if (this.state.combatSetup.encounterID === null) {\r\n            return (\r\n                <div>\r\n                    <div className='heading'>monsters</div>\r\n                    <div className='section'>select an encounter to see monster options here.</div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (!this.props.parties && this.state.combatSetup.waveID === null) {\r\n            return (\r\n                <div>\r\n                    <div className='heading'>monsters</div>\r\n                    <div className='section'>select a wave to see monster options here.</div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        const selectedEncounter = this.props.encounters.find(e => e.id === this.state.combatSetup.encounterID);\r\n        if (selectedEncounter) {\r\n            let slotsContainer: { slots: EncounterSlot[] } = selectedEncounter;\r\n            if (this.state.combatSetup.waveID) {\r\n                const selectedWave = selectedEncounter.waves.find(w => w.id === this.state.combatSetup.waveID);\r\n                if (selectedWave) {\r\n                    slotsContainer = selectedWave;\r\n                }\r\n            }\r\n\r\n            if (slotsContainer.slots.length === 0) {\r\n                return null;\r\n            }\r\n\r\n            const initOptions = [\r\n                {\r\n                    id: 'manual',\r\n                    text: 'enter manually'\r\n                },\r\n                {\r\n                    id: 'individual',\r\n                    text: 'roll individually'\r\n                },\r\n                {\r\n                    id: 'group',\r\n                    text: 'roll in groups'\r\n                }\r\n            ];\r\n\r\n            const names = this.state.combatSetup.monsterNames.map(slotNames => {\r\n                const slot = slotsContainer.slots.find(s => s.id === slotNames.id);\r\n                if (slot) {\r\n                    const inputs = [];\r\n                    for (let n = 0; n !== slotNames.names.length; ++n) {\r\n                        inputs.push(\r\n                            <div key={n}>\r\n                                <MonsterName\r\n                                    value={slotNames.names[n]}\r\n                                    slotID={slot.id}\r\n                                    index={n}\r\n                                    changeName={(slotID, index, value) => this.changeName(slotID, index, value)}\r\n                                />\r\n                            </div>\r\n                        );\r\n                    }\r\n                    return (\r\n                        <div key={slotNames.id} className='name-row'>\r\n                            <div className='name-label'>\r\n                                {slot.monsterName}\r\n                            </div>\r\n                            <div className='name-inputs'>\r\n                                {inputs}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                }\r\n                return null;\r\n            });\r\n\r\n            return (\r\n                <div>\r\n                    <div className='heading'>monsters</div>\r\n                    <div className='subheading'>initiative</div>\r\n                    <Selector\r\n                        options={initOptions}\r\n                        selectedID={this.state.combatSetup.encounterInitMode}\r\n                        select={optionID => this.setEncounterInitMode(optionID as 'manual' | 'individual' | 'group')}\r\n                    />\r\n                    <div className='subheading'>names</div>\r\n                    <div>{names}</div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    public render() {\r\n        try {\r\n            let leftSection = null;\r\n            let rightSection = null;\r\n\r\n            if (this.props.parties) {\r\n                leftSection = (\r\n                    <div>\r\n                        {this.getPartySection()}\r\n                        {this.getEncounterSection()}\r\n                        {this.getMapSection()}\r\n                    </div>\r\n                );\r\n\r\n                rightSection = (\r\n                    <div>\r\n                        {this.getDifficultySection()}\r\n                        {this.getMonsterSection()}\r\n                    </div>\r\n                );\r\n            } else {\r\n                leftSection = (\r\n                    <div>\r\n                        {this.getWaveSection()}\r\n                    </div>\r\n                );\r\n\r\n                rightSection = (\r\n                    <div>\r\n                        {this.getMonsterSection()}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='row' style={{ height: '100%', margin: '0 -15px' }}>\r\n                    <div className='column small-6 medium-6 large-6 scrollable'>\r\n                        {leftSection}\r\n                    </div>\r\n                    <div className='column small-6 medium-6 large-6 scrollable'>\r\n                        {rightSection}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\ninterface MonsterNameProps {\r\n    slotID: string;\r\n    index: number;\r\n    value: string;\r\n    changeName: (slotID: string, index: number, value: string) => void;\r\n}\r\n\r\nclass MonsterName extends React.Component<MonsterNameProps> {\r\n    public render() {\r\n        return (\r\n            <input type='text' value={this.props.value} onChange={event => this.props.changeName(this.props.slotID, this.props.index, event.target.value)} />\r\n        );\r\n    }\r\n}\r\n","export interface Condition {\r\n    id: string;\r\n    name: string;\r\n    level: number;\r\n    text: string | null;\r\n    duration: ConditionDurationSaves | ConditionDurationCombatant | ConditionDurationRounds | null;\r\n}\r\n\r\nexport interface ConditionDurationSaves {\r\n    type: 'saves';\r\n    count: number;\r\n    saveType: 'str' | 'dex' | 'con' | 'int' | 'wis' | 'cha' | 'death';\r\n    saveDC: number;\r\n    point: 'start' | 'end';\r\n}\r\n\r\nexport interface ConditionDurationCombatant {\r\n    type: 'combatant';\r\n    point: 'start' | 'end';\r\n    combatantID: string | null;\r\n}\r\n\r\nexport interface ConditionDurationRounds {\r\n    type: 'rounds';\r\n    count: number;\r\n}\r\n\r\nexport const CONDITION_TYPES = [\r\n    'blinded',\r\n    'charmed',\r\n    'deafened',\r\n    'exhaustion',\r\n    'frightened',\r\n    'grappled',\r\n    'incapacitated',\r\n    'invisible',\r\n    'paralyzed',\r\n    'petrified',\r\n    'poisoned',\r\n    'prone',\r\n    'restrained',\r\n    'stunned',\r\n    'unconscious',\r\n    'custom'\r\n];\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    items: { id: string; text: string; details: JSX.Element | string; disabled?: boolean }[];\r\n    selectedItemID: string | null;\r\n    select: (itemID: string) => void;\r\n}\r\n\r\nexport default class RadioGroup extends React.Component<Props> {\r\n    public static defaultProps = {\r\n        // No default property values\r\n    };\r\n\r\n    public render() {\r\n        try {\r\n            const content = this.props.items.map(item => {\r\n                return (\r\n                    <RadioGroupItem\r\n                        key={item.id}\r\n                        item={item}\r\n                        selected={this.props.selectedItemID === item.id}\r\n                        select={(itemID: string) => this.props.select(itemID)}\r\n                    />\r\n                );\r\n            });\r\n\r\n            return (\r\n                <div className='radio-group'>\r\n                    {content}\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\r\ninterface RadioGroupItemProps {\r\n    item: { id: string; text: string; details: JSX.Element | string; disabled?: boolean };\r\n    selected: boolean;\r\n    select: (itemID: string) => void;\r\n}\r\n\r\nclass RadioGroupItem extends React.Component<RadioGroupItemProps> {\r\n    public render() {\r\n        let style = 'radio-item';\r\n        let details = null;\r\n\r\n        if (this.props.selected) {\r\n            style += ' selected';\r\n            details = (\r\n                <div className='radio-item-details'>\r\n                    {this.props.item.details}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (this.props.item.disabled) {\r\n            style += ' disabled';\r\n        }\r\n\r\n        return (\r\n            <div className={style} onClick={() => this.props.select(this.props.item.id)}>\r\n                <div className='radio-item-text'>{this.props.item.text}</div>\r\n                {details}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Factory from '../../utils/factory';\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Combat, Combatant } from '../../models/combat';\r\nimport { Condition, CONDITION_TYPES, ConditionDurationCombatant, ConditionDurationSaves } from '../../models/condition';\r\nimport { Monster } from '../../models/monster-group';\r\n\r\nimport Dropdown from '../controls/dropdown';\r\nimport RadioGroup from '../controls/radio-group';\r\nimport Selector from '../controls/selector';\r\nimport Spin from '../controls/spin';\r\n\r\ninterface Props {\r\n    condition: Condition;\r\n    combatant: Combatant & Monster;\r\n    combat: Combat;\r\n}\r\n\r\ninterface State {\r\n    condition: Condition;\r\n}\r\n\r\nexport default class ConditionModal extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            condition: props.condition\r\n        };\r\n    }\r\n\r\n    private setCondition(conditionName: string) {\r\n        // eslint-disable-next-line\r\n        this.state.condition.name = conditionName;\r\n        // eslint-disable-next-line\r\n        this.state.condition.level = 1;\r\n        // eslint-disable-next-line\r\n        this.state.condition.text = conditionName === 'custom' ? 'custom condition' : null;\r\n\r\n        this.setState({\r\n            condition: this.state.condition\r\n        });\r\n    }\r\n\r\n    private setDuration(durationType: 'saves' | 'combatant' | 'rounds') {\r\n        let duration = null;\r\n\r\n        switch (durationType) {\r\n            case 'saves':\r\n                duration = Factory.createConditionDurationSaves();\r\n                break;\r\n            case 'combatant':\r\n                duration = Factory.createConditionDurationCombatant();\r\n                duration.combatantID = this.props.combatant.id;\r\n                break;\r\n            case 'rounds':\r\n                duration = Factory.createConditionDurationRounds();\r\n                break;\r\n            default:\r\n                // Do nothing\r\n                break;\r\n        }\r\n\r\n        // eslint-disable-next-line\r\n        this.state.condition.duration = duration;\r\n        this.setState({\r\n            condition: this.state.condition\r\n        });\r\n    }\r\n\r\n    private changeValue(object: any, field: string, value: any) {\r\n        object[field] = value;\r\n\r\n        this.setState({\r\n            condition: this.state.condition\r\n        });\r\n    }\r\n\r\n    private nudgeValue(object: any, field: string, delta: number) {\r\n        let value = object[field] + delta;\r\n        if (field === 'level') {\r\n            value = Math.max(value, 1);\r\n            value = Math.min(value, 6);\r\n        }\r\n        if (field === 'count') {\r\n            value = Math.max(value, 1);\r\n        }\r\n        if (field === 'saveDC') {\r\n            value = Math.max(value, 0);\r\n        }\r\n        object[field] = value;\r\n\r\n        this.setState({\r\n            condition: this.state.condition\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const conditions = CONDITION_TYPES.map(condition => {\r\n                const controls = [];\r\n                const description = [];\r\n                if (condition === this.state.condition.name) {\r\n                    if (condition === 'custom') {\r\n                        controls.push(\r\n                            <input\r\n                                type='text'\r\n                                placeholder='custom condition'\r\n                                value={this.state.condition.text ? this.state.condition.text : ''}\r\n                                onChange={event => this.changeValue(this.state.condition, 'text', event.target.value)}\r\n                            />\r\n                        );\r\n                    }\r\n                    if (condition === 'exhaustion') {\r\n                        controls.push(\r\n                            <Spin\r\n                                key='exhaustion-spin'\r\n                                source={this.props.condition}\r\n                                name='level'\r\n                                label='exhaustion'\r\n                                nudgeValue={delta => this.nudgeValue(this.props.condition, 'level', delta)}\r\n                            />\r\n                        );\r\n                    }\r\n                    const text = Utils.conditionText(this.state.condition);\r\n                    for (let n = 0; n !== text.length; ++n) {\r\n                        description.push(<li key={n} className='section'>{text[n]}</li>);\r\n                    }\r\n                }\r\n\r\n                return {\r\n                    id: condition,\r\n                    text: condition,\r\n                    details: (\r\n                        <div key={condition}>\r\n                            {controls}\r\n                            <ul>\r\n                                {description}\r\n                            </ul>\r\n                        </div>\r\n                    ),\r\n                    disabled: this.props.combatant.conditionImmunities ? this.props.combatant.conditionImmunities.indexOf(condition) !== -1 : false\r\n                };\r\n            });\r\n\r\n            const saveOptions = ['str', 'dex', 'con', 'int', 'wis', 'cha', 'death'].map(c => ({ id: c, text: c }));\r\n            const pointOptions = [\r\n                {\r\n                    id: 'start',\r\n                    text: 'start of turn'\r\n                },\r\n                {\r\n                    id: 'end',\r\n                    text: 'end of turn'\r\n                }\r\n            ];\r\n            const combatantOptions = this.props.combat.combatants.map(c => ({ id: c.id, text: (c.displayName || c.name || 'unnamed monster') }));\r\n\r\n            const durations = [\r\n                {\r\n                    id: 'none',\r\n                    text: 'until removed (default)',\r\n                    details: (\r\n                        <div className='section'>\r\n                            <div>the condition persists until it is manually removed</div>\r\n                        </div>\r\n                    )\r\n                },\r\n                {\r\n                    id: 'saves',\r\n                    text: 'until a successful save',\r\n                    details: (\r\n                        <div>\r\n                            <div className='section'>\r\n                                <div className='subheading'>number of saves required</div>\r\n                                <Spin\r\n                                    source={this.props.condition.duration}\r\n                                    name='count'\r\n                                    nudgeValue={delta => this.nudgeValue(this.props.condition.duration, 'count', delta)}\r\n                                />\r\n                            </div>\r\n                            <div className='section'>\r\n                                <div className='subheading'>save dc</div>\r\n                                <Spin\r\n                                    source={this.props.condition.duration}\r\n                                    name='saveDC'\r\n                                    nudgeValue={delta => this.nudgeValue(this.props.condition.duration, 'saveDC', delta)}\r\n                                />\r\n                            </div>\r\n                            <div className='section'>\r\n                                <div className='subheading'>type of save</div>\r\n                                <Selector\r\n                                    options={saveOptions}\r\n                                    selectedID={\r\n                                        (this.props.condition.duration as ConditionDurationSaves)\r\n                                        ? (this.props.condition.duration as ConditionDurationSaves).saveType\r\n                                        : null\r\n                                    }\r\n                                    select={optionID => this.changeValue(this.props.condition.duration, 'saveType', optionID)}\r\n                                />\r\n                            </div>\r\n                            <div className='section'>\r\n                                <div className='subheading'>make the save at the start or end of the turn</div>\r\n                                <Selector\r\n                                    options={pointOptions}\r\n                                    selectedID={\r\n                                        (this.props.condition.duration as ConditionDurationSaves)\r\n                                        ? (this.props.condition.duration as ConditionDurationSaves).point\r\n                                        : null\r\n                                    }\r\n                                    select={optionID => this.changeValue(this.props.condition.duration, 'point', optionID)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                },\r\n                {\r\n                    id: 'combatant',\r\n                    text: 'until someone\\'s next turn',\r\n                    details: (\r\n                        <div>\r\n                            <div className='section'>\r\n                                <div className='subheading'>combatant</div>\r\n                                <Dropdown\r\n                                    options={combatantOptions}\r\n                                    selectedID={\r\n                                        (this.props.condition.duration as ConditionDurationCombatant)\r\n                                        ? (this.props.condition.duration as ConditionDurationCombatant).combatantID || undefined\r\n                                        : undefined\r\n                                    }\r\n                                    select={optionID => this.changeValue(this.props.condition.duration, 'combatantID', optionID)}\r\n                                />\r\n                            </div>\r\n                            <div className='section'>\r\n                                <div className='subheading'>start or end of the turn</div>\r\n                                <Selector\r\n                                    options={pointOptions}\r\n                                    selectedID={\r\n                                        (this.props.condition.duration as ConditionDurationCombatant)\r\n                                        ? (this.props.condition.duration as ConditionDurationCombatant).point\r\n                                        : null\r\n                                    }\r\n                                    select={optionID => this.changeValue(this.props.condition.duration, 'point', optionID)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                },\r\n                {\r\n                    id: 'rounds',\r\n                    text: 'for a number of rounds',\r\n                    details: (\r\n                        <div>\r\n                            <div className='section'>\r\n                                <div className='subheading'>number of rounds</div>\r\n                                <Spin\r\n                                    source={this.props.condition.duration}\r\n                                    name='count'\r\n                                    nudgeValue={delta => this.nudgeValue(this.props.condition.duration, 'count', delta)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n            ];\r\n\r\n            return (\r\n                <div className='condition-modal'>\r\n                    <div className='row' style={{ height: '100%' }}>\r\n                        <div className='columns small-6 medium-6 large-6 scrollable'>\r\n                            <div className='heading'>condition</div>\r\n                            <RadioGroup\r\n                                items={conditions}\r\n                                selectedItemID={this.state.condition.name}\r\n                                select={itemID => this.setCondition(itemID)}\r\n                            />\r\n                        </div>\r\n                        <div className='columns small-6 medium-6 large-6 scrollable'>\r\n                            <div className='heading'>duration</div>\r\n                            <RadioGroup\r\n                                items={durations}\r\n                                selectedItemID={this.state.condition.duration ? this.state.condition.duration.type : 'none'}\r\n                                select={itemID => this.setDuration(itemID as 'saves' | 'combatant' | 'rounds')}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { CATEGORY_TYPES, Monster, MonsterGroup, SIZE_TYPES } from '../../models/monster-group';\r\n\r\nimport Selector from '../controls/selector';\r\n\r\ninterface Props {\r\n    library: MonsterGroup[];\r\n}\r\n\r\ninterface State {\r\n    chart: string;\r\n}\r\n\r\nexport default class DemographicsSidebar extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            chart: 'challenge'\r\n        };\r\n    }\r\n\r\n    private selectChart(chart: string) {\r\n        this.setState({\r\n            chart: chart\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let demographics = null;\r\n\r\n            const allMonsters: Monster[] = [];\r\n            this.props.library.forEach(group => group.monsters.forEach(monster => allMonsters.push(monster)));\r\n            if (allMonsters.length !== 0) {\r\n                const buckets: { value: any, title: string }[] = [];\r\n                let maxBucketSize = 0;\r\n                const monsters: { [key: string]: Monster[] } = {};\r\n\r\n                switch (this.state.chart) {\r\n                    case 'challenge':\r\n                        const challenges = [\r\n                            0, 0.125, 0.25, 0.5, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30\r\n                        ];\r\n                        challenges.forEach(cr => {\r\n                            buckets.push({\r\n                                value: cr,\r\n                                title: 'challenge ' + Utils.challenge(cr)\r\n                            });\r\n                        });\r\n\r\n                        buckets.forEach(bucket => {\r\n                            const cr = bucket.value;\r\n                            monsters[cr.toString()] = allMonsters.filter(monster => monster.challenge === cr);\r\n                        });\r\n\r\n                        buckets.forEach(bucket => {\r\n                            const cr = bucket.value;\r\n                            maxBucketSize = Math.max(monsters[cr].length, maxBucketSize);\r\n                        });\r\n                        break;\r\n                    case 'size':\r\n                        SIZE_TYPES.forEach(size => {\r\n                            buckets.push({\r\n                                value: size,\r\n                                title: size\r\n                            });\r\n                        });\r\n\r\n                        buckets.forEach(bucket => {\r\n                            const size = bucket.value;\r\n                            monsters[size.toString()] = allMonsters.filter(monster => monster.size === size);\r\n                        });\r\n\r\n                        buckets.forEach(bucket => {\r\n                            const size = bucket.value;\r\n                            maxBucketSize = Math.max(monsters[size].length, maxBucketSize);\r\n                        });\r\n                        break;\r\n                    case 'type':\r\n                        CATEGORY_TYPES.forEach(type => {\r\n                            buckets.push({\r\n                                value: type,\r\n                                title: type\r\n                            });\r\n                        });\r\n\r\n                        buckets.forEach(bucket => {\r\n                            const type = bucket.value;\r\n                            monsters[type.toString()] = allMonsters.filter(monster => monster.category === type);\r\n                        });\r\n\r\n                        buckets.forEach(bucket => {\r\n                            const type = bucket.value;\r\n                            maxBucketSize = Math.max(monsters[type].length, maxBucketSize);\r\n                        });\r\n                        break;\r\n                    default:\r\n                        // Do nothing\r\n                        break;\r\n                }\r\n\r\n                const bars = [];\r\n                for (let index = 0; index !== buckets.length; ++index) {\r\n                    const bucket = buckets[index];\r\n                    const set = monsters[bucket.value];\r\n                    const count = set ? set.length : 0;\r\n                    bars.push(\r\n                        <div\r\n                            key={bucket.title}\r\n                            className='bar-container'\r\n                            title={bucket.title + ': ' + set.length + ' monsters'}\r\n                        >\r\n                            <div\r\n                                className='bar'\r\n                                style={{\r\n                                    width: 'calc((100% - 1px) * ' + count + ' / ' + maxBucketSize + ')'\r\n                                }}\r\n                            />\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                const chartOptions = [\r\n                    {\r\n                        id: 'challenge',\r\n                        text: 'challenge rating'\r\n                    },\r\n                    {\r\n                        id: 'size',\r\n                        text: 'size'\r\n                    },\r\n                    {\r\n                        id: 'type',\r\n                        text: 'type'\r\n                    }\r\n                ];\r\n\r\n                demographics = (\r\n                    <div>\r\n                        <div className='heading'>monster demographics</div>\r\n                        <Selector\r\n                            options={chartOptions}\r\n                            selectedID={this.state.chart}\r\n                            select={optionID => this.selectChart(optionID)}\r\n                        />\r\n                        <div className='chart'>\r\n                            <div className='plot'>{bars}</div>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return demographics;\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","export interface MapFolio {\r\n    id: string;\r\n    name: string;\r\n    maps: Map[];\r\n}\r\n\r\nexport interface Map {\r\n    id: string;\r\n    name: string;\r\n    items: MapItem[];\r\n}\r\n\r\nexport interface MapItem {\r\n    id: string;\r\n    type: 'tile' | 'pc' | 'monster';\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    terrain: string | null;\r\n    customBackground: string;\r\n    style: 'square' | 'rounded' | 'circle' | null;\r\n}\r\n\r\nexport const TERRAIN_TYPES = [\r\n    'cavern',\r\n    'dirt',\r\n    'flagstone',\r\n    'floorboard',\r\n    'grassland',\r\n    'pit',\r\n    'sand',\r\n    'snow',\r\n    'water',\r\n    'custom'\r\n];\r\n","import React from 'react';\r\n\r\nimport { MapItem, TERRAIN_TYPES } from '../../models/map-folio';\r\n\r\nimport Dropdown from '../controls/dropdown';\r\nimport Radial from '../controls/radial';\r\nimport Selector from '../controls/selector';\r\n\r\ninterface Props {\r\n    tile: MapItem;\r\n    changeValue: (tile: MapItem, field: string, value: any) => void;\r\n    moveMapItem: (tile: MapItem, dir: string) => void;\r\n    resizeMapItem: (tile: MapItem, dir: string, dir2: 'in' | 'out' | null) => void;\r\n    cloneMapItem: (tile: MapItem) => void;\r\n    removeMapItem: (tile: MapItem) => void;\r\n}\r\n\r\nexport default class MapTileCard extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const terrainOptions = TERRAIN_TYPES.map(t => {\r\n                return { id: t, text: t };\r\n            });\r\n\r\n            const styleOptions = ['square', 'rounded', 'circle'].map(t => {\r\n                return { id: t, text: t };\r\n            });\r\n\r\n            let customSection = null;\r\n            if (this.props.tile.terrain === 'custom') {\r\n                customSection = (\r\n                    <div>\r\n                        <div className='subheading'>custom image</div>\r\n                        <button onClick={() => (document.getElementById('file-upload') as HTMLElement).click()}>select image</button>\r\n                        <input\r\n                            type='file'\r\n                            id='file-upload'\r\n                            accept='image/*'\r\n                            style={{ display: 'none' }}\r\n                            onChange={e => {\r\n                                if (e.target.files) {\r\n                                    const reader = new FileReader();\r\n                                    reader.onload = readerEvent => {\r\n                                        if (readerEvent.target) {\r\n                                            const content = readerEvent.target.result as string;\r\n                                            this.props.changeValue(this.props.tile, 'customBackground', content);\r\n                                        }\r\n                                    };\r\n                                    reader.readAsDataURL(e.target.files[0]);\r\n                                }\r\n                            }}\r\n                        />\r\n                        <button onClick={() => this.props.changeValue(this.props.tile, 'customBackground', '')}>clear image</button>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='card map-tile'>\r\n                    <div className='heading'>\r\n                        <div className='title'>map tile</div>\r\n                    </div>\r\n                    <div className='card-content'>\r\n                        <div className='subheading'>size</div>\r\n                        <div className='section'>{this.props.tile.width} sq x {this.props.tile.height} sq</div>\r\n                        <div className='section'>{this.props.tile.width * 5} ft x {this.props.tile.height * 5} ft</div>\r\n                        <div className='divider' />\r\n                        <div className='subheading'>terrain</div>\r\n                        <Dropdown\r\n                            options={terrainOptions}\r\n                            placeholder='select terrain'\r\n                            selectedID={this.props.tile.terrain ? this.props.tile.terrain : undefined}\r\n                            select={optionID => this.props.changeValue(this.props.tile, 'terrain', optionID)}\r\n                        />\r\n                        {customSection}\r\n                        <div className='divider' />\r\n                        <div className='subheading'>style</div>\r\n                        <Selector\r\n                            options={styleOptions}\r\n                            selectedID={this.props.tile.style}\r\n                            select={optionID => this.props.changeValue(this.props.tile, 'style', optionID)}\r\n                        />\r\n                        <div className='divider' />\r\n                        <div className='subheading'>move</div>\r\n                        <div className='section centered'>\r\n                            <Radial direction='out' click={dir => this.props.moveMapItem(this.props.tile, dir)} />\r\n                        </div>\r\n                        <div className='divider' />\r\n                        <div className='subheading'>resize</div>\r\n                        <div className='section centered'>\r\n                            <Radial direction='both' click={(dir, dir2) => this.props.resizeMapItem(this.props.tile, dir, dir2)} />\r\n                        </div>\r\n                        <div className='divider' />\r\n                        <div className='section'>\r\n                            <button onClick={() => this.props.cloneMapItem(this.props.tile)}>clone tile</button>\r\n                            <button onClick={() => this.props.removeMapItem(this.props.tile)}>remove tile</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Factory from '../../utils/factory';\r\nimport Mercator from '../../utils/mercator';\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { Map, MapItem } from '../../models/map-folio';\r\n\r\nimport MapTileCard from '../cards/map-tile-card';\r\nimport Spin from '../controls/spin';\r\nimport MapPanel from '../panels/map-panel';\r\nimport Note from '../panels/note';\r\n\r\ninterface Props {\r\n    map: Map;\r\n}\r\n\r\ninterface State {\r\n    map: Map;\r\n    selectedTileID: string | null;\r\n    addingTile: boolean;\r\n    mapSize: number;\r\n}\r\n\r\nexport default class MapEditorModal extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            map: props.map,\r\n            selectedTileID: null,\r\n            addingTile: false,\r\n            mapSize: 30\r\n        };\r\n    }\r\n\r\n    private setSelectedTileID(id: string | null) {\r\n        this.setState({\r\n            selectedTileID: id\r\n        });\r\n    }\r\n\r\n    private toggleAddingTile() {\r\n        this.setState({\r\n            addingTile: !this.state.addingTile\r\n        });\r\n    }\r\n\r\n    private nudgeMapSize(value: number) {\r\n        this.setState({\r\n            mapSize: this.state.mapSize + value\r\n        });\r\n    }\r\n\r\n    private addMapTile(x: number, y: number) {\r\n        const tile = Factory.createMapItem();\r\n        tile.x = x;\r\n        tile.y = y;\r\n        tile.style = 'square';\r\n        tile.terrain = 'flagstone';\r\n        this.state.map.items.push(tile);\r\n\r\n        this.setState({\r\n            map: this.state.map,\r\n            selectedTileID: tile.id,\r\n            addingTile: false\r\n        });\r\n    }\r\n\r\n    private moveMapItem(item: MapItem, dir: string) {\r\n        switch (dir) {\r\n            case 'N':\r\n                item.y -= 1;\r\n                break;\r\n            case 'E':\r\n                item.x += 1;\r\n                break;\r\n            case 'S':\r\n                item.y += 1;\r\n                break;\r\n            case 'W':\r\n                item.x -= 1;\r\n                break;\r\n            default:\r\n                // Do nothing\r\n                break;\r\n        }\r\n\r\n        this.setState({\r\n            map: this.state.map\r\n        });\r\n    }\r\n\r\n    private bigMapItem(item: MapItem, dir: string) {\r\n        switch (dir) {\r\n            case 'N':\r\n                item.y -= 1;\r\n                item.height += 1;\r\n                break;\r\n            case 'E':\r\n                item.width += 1;\r\n                break;\r\n            case 'S':\r\n                item.height += 1;\r\n                break;\r\n            case 'W':\r\n                item.x -= 1;\r\n                item.width += 1;\r\n                break;\r\n            default:\r\n                // Do nothing\r\n                break;\r\n        }\r\n\r\n        this.setState({\r\n            map: this.state.map\r\n        });\r\n    }\r\n\r\n    private smallMapItem(item: MapItem, dir: string) {\r\n        switch (dir) {\r\n            case 'N':\r\n                if (item.height > 1) {\r\n                    item.y += 1;\r\n                    item.height -= 1;\r\n                }\r\n                break;\r\n            case 'E':\r\n                if (item.width > 1) {\r\n                    item.width -= 1;\r\n                }\r\n                break;\r\n            case 'S':\r\n                if (item.height > 1) {\r\n                    item.height -= 1;\r\n                }\r\n                break;\r\n            case 'W':\r\n                if (item.width > 1) {\r\n                    item.x += 1;\r\n                    item.width -= 1;\r\n                }\r\n                break;\r\n            default:\r\n                // Do nothing\r\n                break;\r\n        }\r\n\r\n        this.setState({\r\n            map: this.state.map\r\n        });\r\n    }\r\n\r\n    private resizeMapItem(item: MapItem, dir: string, dir2: 'in' | 'out') {\r\n        switch (dir2) {\r\n            case 'in':\r\n                this.smallMapItem(item, dir);\r\n                break;\r\n            case 'out':\r\n                this.bigMapItem(item, dir);\r\n                break;\r\n            default:\r\n                // Do nothing\r\n                break;\r\n        }\r\n    }\r\n\r\n    private cloneMapItem(item: MapItem) {\r\n        const copy = JSON.parse(JSON.stringify(item));\r\n        copy.id = Utils.guid();\r\n        copy.x += 1;\r\n        copy.y += 1;\r\n        this.state.map.items.push(copy);\r\n\r\n        this.setState({\r\n            map: this.state.map,\r\n            selectedTileID: copy.id\r\n        });\r\n    }\r\n\r\n    private removeMapItem(item: MapItem) {\r\n        const index = this.state.map.items.indexOf(item);\r\n        this.state.map.items.splice(index, 1);\r\n\r\n        this.setState({\r\n            map: this.state.map,\r\n            selectedTileID: null\r\n        });\r\n    }\r\n\r\n    private rotateMap() {\r\n        Mercator.rotateMap(this.state.map);\r\n\r\n        this.setState({\r\n            map: this.state.map\r\n        });\r\n    }\r\n\r\n    private clearMap() {\r\n        // eslint-disable-next-line\r\n        this.state.map.items = [];\r\n\r\n        this.setState({\r\n            map: this.state.map,\r\n            selectedTileID: null\r\n        });\r\n    }\r\n\r\n    private changeValue(source: any, field: string, value: any) {\r\n        source[field] = value;\r\n\r\n        this.setState({\r\n            map: this.state.map\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            let tools = null;\r\n            if (this.state.selectedTileID) {\r\n                const item = this.state.map.items.find(i => i.id === this.state.selectedTileID);\r\n                if (item) {\r\n                    tools = (\r\n                        <div className='tools'>\r\n                            <MapTileCard\r\n                                tile={item}\r\n                                moveMapItem={(mapItem, dir) => this.moveMapItem(mapItem, dir)}\r\n                                resizeMapItem={(mapItem, dir, dir2) => this.resizeMapItem(mapItem, dir, dir2 as 'in' | 'out')}\r\n                                cloneMapItem={mapItem => this.cloneMapItem(mapItem)}\r\n                                removeMapItem={mapItem => this.removeMapItem(mapItem)}\r\n                                changeValue={(source, field, value) => this.changeValue(source, field, value)}\r\n                            />\r\n                        </div>\r\n                    );\r\n                }\r\n            } else {\r\n                tools = (\r\n                    <div className='tools'>\r\n                        <Note\r\n                            content={\r\n                                <div>\r\n                                    <p>to add a new tile to the map, click on the button below</p>\r\n                                    <p>to edit an existing tile, click on it to select it</p>\r\n                                </div>\r\n                            }\r\n                        />\r\n                        <div className='divider' />\r\n                        <div className='subheading'>map name</div>\r\n                        <input\r\n                            type='text'\r\n                            placeholder='map name'\r\n                            value={this.state.map.name}\r\n                            onChange={event => this.changeValue(this.state.map, 'name', event.target.value)}\r\n                        />\r\n                        <div className='divider' />\r\n                        <button onClick={() => this.toggleAddingTile()}>\r\n                            {this.state.addingTile ? 'click somewhere on the map to add your new tile, or click here to cancel' : 'add a new tile'}\r\n                        </button>\r\n                        <Spin\r\n                            source={this.state}\r\n                            name={'mapSize'}\r\n                            display={value => 'zoom'}\r\n                            nudgeValue={delta => this.nudgeMapSize(delta * 5)}\r\n                        />\r\n                        <button onClick={() => this.rotateMap()}>rotate the map</button>\r\n                        <button onClick={() => this.clearMap()}>clear all tiles</button>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='map-editor'>\r\n                    {tools}\r\n                    <MapPanel\r\n                        map={this.state.map}\r\n                        mode='edit'\r\n                        size={this.state.mapSize}\r\n                        selectedItemID={this.state.selectedTileID ? this.state.selectedTileID : undefined}\r\n                        showOverlay={this.state.addingTile}\r\n                        setSelectedItemID={id => this.setSelectedTileID(id)}\r\n                        gridSquareClicked={(x, y) => this.addMapTile(x, y)}\r\n                    />\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Factory from '../../utils/factory';\r\nimport Frankenstein from '../../utils/frankenstein';\r\nimport Napoleon from '../../utils/napoleon';\r\nimport Utils from '../../utils/utils';\r\n\r\nimport { MonsterFilter } from '../../models/encounter';\r\nimport { CATEGORY_TYPES, Monster, MonsterGroup, Trait, TRAIT_TYPES } from '../../models/monster-group';\r\n\r\nimport MonsterCard from '../cards/monster-card';\r\nimport Checkbox from '../controls/checkbox';\r\nimport Dropdown from '../controls/dropdown';\r\nimport Expander from '../controls/expander';\r\nimport Selector from '../controls/selector';\r\nimport Spin from '../controls/spin';\r\nimport AbilityScorePanel from '../panels/ability-score-panel';\r\nimport FilterPanel from '../panels/filter-panel';\r\nimport Note from '../panels/note';\r\nimport PortraitPanel from '../panels/portrait-panel';\r\nimport TraitsPanel from '../panels/traits-panel';\r\n\r\ninterface Props {\r\n    monster: Monster;\r\n    library: MonsterGroup[];\r\n    showSidebar: boolean;\r\n}\r\n\r\ninterface State {\r\n    monster: Monster;\r\n    page: 'overview' | 'abilities' | 'cbt-stats' | 'actions';\r\n    showFilter: boolean;\r\n    helpSection: string;\r\n    sidebar: 'similar' | 'scratchpad';\r\n    similarFilter: {\r\n        size: boolean,\r\n        type: boolean,\r\n        subtype: boolean,\r\n        alignment: boolean,\r\n        challenge: boolean,\r\n        text: string\r\n    };\r\n    scratchpadFilter: MonsterFilter;\r\n    scratchpadList: Monster[];\r\n}\r\n\r\nexport default class MonsterEditorModal extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            monster: props.monster,\r\n            page: 'overview',\r\n            showFilter: false,\r\n            helpSection: 'speed',\r\n            sidebar: 'similar',\r\n            similarFilter: {\r\n                size: true,\r\n                type: true,\r\n                subtype: false,\r\n                alignment: false,\r\n                challenge: true,\r\n                text: ''\r\n            },\r\n            scratchpadFilter: Factory.createMonsterFilter(),\r\n            scratchpadList: []\r\n        };\r\n    }\r\n\r\n    private setPage(page: 'overview' | 'abilities' | 'cbt-stats' | 'actions') {\r\n        const sections = this.getHelpOptionsForPage(page);\r\n        this.setState({\r\n            page: page,\r\n            helpSection: sections[0]\r\n        });\r\n    }\r\n\r\n    private toggleFilter() {\r\n        this.setState({\r\n            showFilter: !this.state.showFilter\r\n        });\r\n    }\r\n\r\n    private setHelpSection(section: string) {\r\n        this.setState({\r\n            helpSection: section\r\n        });\r\n    }\r\n\r\n    private toggleMatch(type: 'size' | 'type' | 'subtype' | 'alignment' | 'challenge') {\r\n        // eslint-disable-next-line\r\n        this.state.similarFilter[type] = !this.state.similarFilter[type];\r\n        this.setState({\r\n            similarFilter: this.state.similarFilter\r\n        });\r\n    }\r\n\r\n    private setFilterText(value: string) {\r\n        // eslint-disable-next-line\r\n        this.state.similarFilter.text = value;\r\n        this.setState({\r\n            similarFilter: this.state.similarFilter\r\n        });\r\n    }\r\n\r\n    private addToScratchpadList(monster: Monster) {\r\n        // eslint-disable-next-line\r\n        this.state.scratchpadList.push(monster);\r\n        // eslint-disable-next-line\r\n        Utils.sort(this.state.scratchpadList);\r\n        this.setState({\r\n            scratchpadList: this.state.scratchpadList\r\n        });\r\n    }\r\n\r\n    private removeFromScratchpadList(monster: Monster) {\r\n        const index = this.state.scratchpadList.indexOf(monster);\r\n        this.state.scratchpadList.splice(index, 1);\r\n        this.setState({\r\n            scratchpadList: this.state.scratchpadList\r\n        });\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Helper methods\r\n\r\n    private getHelpOptionsForPage(page: 'overview' | 'abilities' | 'cbt-stats' | 'actions') {\r\n        switch (page) {\r\n            case 'overview':\r\n                return ['speed', 'senses', 'languages', 'equipment'];\r\n            case 'abilities':\r\n                return ['str', 'dex', 'con', 'int', 'wis', 'cha', 'saves', 'skills'];\r\n            case 'cbt-stats':\r\n                return ['armor class', 'hit dice', 'resistances', 'vulnerabilities', 'immunities', 'conditions'];\r\n            case 'actions':\r\n                return ['actions'];\r\n            default:\r\n                return [];\r\n        }\r\n    }\r\n\r\n    private getMonsters() {\r\n        const monsters: Monster[] = [];\r\n        this.props.library.forEach(group => {\r\n            group.monsters.forEach(monster => {\r\n                let match = true;\r\n\r\n                if (this.state.monster.id === monster.id) {\r\n                    match = false;\r\n                }\r\n\r\n                if (this.state.similarFilter.size && (this.state.monster.size !== monster.size)) {\r\n                    match = false;\r\n                }\r\n\r\n                if (this.state.similarFilter.type && (this.state.monster.category !== monster.category)) {\r\n                    match = false;\r\n                }\r\n\r\n                if (this.state.similarFilter.subtype && (this.state.monster.tag !== monster.tag)) {\r\n                    match = false;\r\n                }\r\n\r\n                if (this.state.similarFilter.alignment && (this.state.monster.alignment !== monster.alignment)) {\r\n                    match = false;\r\n                }\r\n\r\n                if (this.state.similarFilter.challenge && (this.state.monster.challenge !== monster.challenge)) {\r\n                    match = false;\r\n                }\r\n\r\n                if (match) {\r\n                    monsters.push(monster);\r\n                }\r\n            });\r\n        });\r\n\r\n        return monsters;\r\n    }\r\n\r\n    private setRandomValue(field: string, monsters: Monster[]) {\r\n        Frankenstein.setRandomValue(this.state.monster, field, monsters);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private spliceMonsters(monsters: Monster[]) {\r\n        Frankenstein.spliceMonsters(this.state.monster, monsters);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private addTrait(type: 'trait' | 'action' | 'bonus' | 'reaction' | 'legendary' | 'lair') {\r\n        Frankenstein.addTrait(this.state.monster, type);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private addRandomTrait(type: string, monsters: Monster[]) {\r\n        Frankenstein.addRandomTrait(this.state.monster, type, monsters);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private removeTrait(trait: Trait) {\r\n        Frankenstein.removeTrait(this.state.monster, trait);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private swapTraits(t1: Trait, t2: Trait) {\r\n        Frankenstein.swapTraits(this.state.monster, t1, t2);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private copyTrait(trait: Trait) {\r\n        Frankenstein.copyTrait(this.state.monster, trait);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private changeTrait(trait: Trait, field: string, value: any) {\r\n        (trait as any)[field] = value;\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private nudgeValue(field: string, delta: number) {\r\n        Frankenstein.nudgeValue(this.state.monster, field, delta);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private changeValue(field: string, value: any) {\r\n        Frankenstein.changeValue(this.state.monster, field, value);\r\n        this.setState({\r\n            monster: this.state.monster\r\n        });\r\n    }\r\n\r\n    private changeFilterValue(type: 'name' | 'challengeMin' | 'challengeMax' | 'category' | 'size', value: any) {\r\n        // eslint-disable-next-line\r\n        this.state.scratchpadFilter[type] = value as never;\r\n        this.setState({\r\n            scratchpadFilter: this.state.scratchpadFilter\r\n        });\r\n    }\r\n\r\n    private nudgeFilterValue(type: 'challengeMin' | 'challengeMax', delta: number) {\r\n        const value = Utils.nudgeChallenge(this.state.scratchpadFilter[type], delta);\r\n        this.changeFilterValue(type, value);\r\n    }\r\n\r\n    private resetFilter() {\r\n        this.setState({\r\n            scratchpadFilter: Factory.createMonsterFilter()\r\n        });\r\n    }\r\n\r\n    private matchMonster(monster: Monster) {\r\n        return Napoleon.matchMonster(monster, this.state.scratchpadFilter);\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // HTML render methods\r\n\r\n    private getHelpSection(monsters: Monster[]) {\r\n        switch (this.state.helpSection) {\r\n            case 'speed':\r\n                return this.getValueSection('speed', 'text', monsters);\r\n            case 'senses':\r\n                return this.getValueSection('senses', 'text', monsters);\r\n            case 'languages':\r\n                return this.getValueSection('languages', 'text', monsters);\r\n            case 'equipment':\r\n                return this.getValueSection('equipment', 'text', monsters);\r\n            case 'str':\r\n                return this.getValueSection('abilityScores.str', 'number', monsters);\r\n            case 'dex':\r\n                return this.getValueSection('abilityScores.dex', 'number', monsters);\r\n            case 'con':\r\n                return this.getValueSection('abilityScores.con', 'number', monsters);\r\n            case 'int':\r\n                return this.getValueSection('abilityScores.int', 'number', monsters);\r\n            case 'wis':\r\n                return this.getValueSection('abilityScores.wis', 'number', monsters);\r\n            case 'cha':\r\n                return this.getValueSection('abilityScores.cha', 'number', monsters);\r\n            case 'saves':\r\n                return this.getValueSection('savingThrows', 'text', monsters);\r\n            case 'skills':\r\n                return this.getValueSection('skills', 'text', monsters);\r\n            case 'armor class':\r\n                return this.getValueSection('ac', 'number', monsters);\r\n            case 'hit dice':\r\n                return this.getValueSection('hitDice', 'number', monsters);\r\n            case 'resistances':\r\n                return this.getValueSection('damage.resist', 'text', monsters);\r\n            case 'vulnerabilities':\r\n                return this.getValueSection('damage.vulnerable', 'text', monsters);\r\n            case 'immunities':\r\n                return this.getValueSection('damage.immune', 'text', monsters);\r\n            case 'conditions':\r\n                return this.getValueSection('conditionImmunities', 'text', monsters);\r\n            case 'actions':\r\n                return this.getActionsSection(monsters);\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    private getValueSection(field: string, dataType: 'text' | 'number', monsters: Monster[]) {\r\n        const values: any[] = monsters\r\n            .map(m => {\r\n                const tokens = field.split('.');\r\n                let source: any = m;\r\n                let value = null;\r\n                tokens.forEach(token => {\r\n                    if (token === tokens[tokens.length - 1]) {\r\n                        value = source[token];\r\n                    } else {\r\n                        source = source[token];\r\n                    }\r\n                });\r\n                if ((dataType === 'text') && (value === '')) {\r\n                    value = null;\r\n                }\r\n                return value;\r\n            })\r\n            .filter(v => v !== null);\r\n\r\n        const distinct: { value: any, count: number }[] = [];\r\n        if (dataType === 'number') {\r\n            let min: number | null = null;\r\n            let max: number | null = null;\r\n            values.forEach(v => {\r\n                if ((min === null) || (v < min)) {\r\n                    min = v;\r\n                }\r\n                if ((max === null) || (v > max)) {\r\n                    max = v;\r\n                }\r\n            });\r\n            if ((min !== null) && (max !== null)) {\r\n                for (let n = min; n <= max; ++n) {\r\n                    distinct.push({\r\n                        value: n,\r\n                        count: 0\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        values.forEach(v => {\r\n            const current = distinct.find(d => d.value === v);\r\n            if (current) {\r\n                current.count += 1;\r\n            } else {\r\n                distinct.push({\r\n                    value: v,\r\n                    count: 1\r\n                });\r\n            }\r\n        });\r\n\r\n        switch (dataType) {\r\n            case 'number':\r\n                Utils.sort(distinct, [{ field: 'value', dir: 'asc' }]);\r\n                break;\r\n            case 'text':\r\n                Utils.sort(distinct, [{ field: 'count', dir: 'desc' }, { field: 'value', dir: 'asc' }]);\r\n                break;\r\n            default:\r\n                // Do nothing\r\n                break;\r\n        }\r\n\r\n        if (dataType === 'text') {\r\n            const count = monsters.length - values.length;\r\n            if (count !== 0) {\r\n                distinct.push({\r\n                    value: '',\r\n                    count: monsters.length - values.length\r\n                });\r\n            }\r\n        }\r\n\r\n        const valueSections = distinct.map(d => {\r\n            const width = 100 * d.count / monsters.length;\r\n            return (\r\n                <div className='row small-up-3 medium-up-3 large-up-3 value-list' key={distinct.indexOf(d)}>\r\n                    <div className='column'>\r\n                        <div className='text-container'>\r\n                            {d.value || '(none specified)'}\r\n                        </div>\r\n                    </div>\r\n                    <div className='column'>\r\n                        <div className='bar-container'>\r\n                            <div className='bar' style={{ width: width + '%' }} />\r\n                        </div>\r\n                    </div>\r\n                    <div className='column'>\r\n                        <button onClick={() => this.changeValue(field, d.value)}>use this value</button>\r\n                    </div>\r\n                </div>\r\n            );\r\n        });\r\n\r\n        return (\r\n            <div>\r\n                {valueSections}\r\n                <button onClick={() => this.setRandomValue(field, monsters)}>select random value</button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getActionsSection(monsters: Monster[]) {\r\n        const rows = [];\r\n        rows.push(\r\n            <div className='row small-up-4 medium-up-4 large-up-4 value-list' key='header'>\r\n                <div className='column'>\r\n                    <div className='text-container'>\r\n                        <b>type</b>\r\n                    </div>\r\n                </div>\r\n                <div className='column'>\r\n                    <div className='text-container number'>\r\n                        <b>average number</b>\r\n                    </div>\r\n                </div>\r\n                <div className='column'>\r\n                    <div className='text-container number'>\r\n                        <b>min - max</b>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n\r\n        TRAIT_TYPES.forEach(type => {\r\n            let min: number | null = null;\r\n            let max: number | null = null;\r\n            let count = 0;\r\n            monsters.forEach(m => {\r\n                const n = m.traits.filter(t => t.type === type).length;\r\n                if ((min === null) || (n < min)) {\r\n                    min = n;\r\n                }\r\n                if ((max === null) || (n > max)) {\r\n                    max = n;\r\n                }\r\n                count += n;\r\n            });\r\n            const avg = Math.round(count / monsters.length);\r\n\r\n            rows.push(\r\n                <div className='row small-up-4 medium-up-4 large-up-4 value-list' key={type}>\r\n                    <div className='column'>\r\n                        <div className={count === 0 ? 'text-container disabled' : 'text-container'}>\r\n                            {Utils.traitType(type, true)}\r\n                        </div>\r\n                    </div>\r\n                    <div className='column'>\r\n                        <div className={count === 0 ? 'text-container number disabled' : 'text-container number'}>\r\n                            {avg}\r\n                        </div>\r\n                    </div>\r\n                    <div className='column'>\r\n                        <div className={count === 0 ? 'text-container number disabled' : 'text-container number'}>\r\n                            {min} - {max}\r\n                        </div>\r\n                    </div>\r\n                    <div className='column'>\r\n                        <button className={count === 0 ? 'disabled' : ''} onClick={() => this.addRandomTrait(type, monsters)}>add random</button>\r\n                    </div>\r\n                </div>\r\n            );\r\n        });\r\n\r\n        return (\r\n            <div>\r\n                {rows}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getMonsterCards(monsters: Monster[]) {\r\n        const sorted = Utils.sort(monsters);\r\n        const monsterCards = sorted.map(m => {\r\n            const showMonster = m.traits.some((t: Trait) => Utils.match(this.state.similarFilter.text, t.name));\r\n            if (showMonster) {\r\n                return (\r\n                    <div className='section' key={m.id}>\r\n                        <MonsterCard\r\n                            combatant={m}\r\n                            mode={'template ' + this.state.page}\r\n                            filter={this.state.similarFilter.text}\r\n                            copyTrait={trait => this.copyTrait(trait)}\r\n                        />\r\n                    </div>\r\n                );\r\n            } else {\r\n                return null;\r\n            }\r\n        }).filter(m => !!m);\r\n\r\n        if (monsterCards.length === 0) {\r\n            let info = '';\r\n            switch (this.state.sidebar) {\r\n                case 'similar':\r\n                    info = 'there are no monsters in your library which match the above criteria.';\r\n                    break;\r\n                case 'scratchpad':\r\n                    info = 'your scratchpad list is empty; you can add monsters to it to see their stats here.';\r\n                    break;\r\n            }\r\n\r\n            return (\r\n                <Note content={info} />\r\n            );\r\n        }\r\n\r\n        return monsterCards;\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    public render() {\r\n        try {\r\n            const pages = [\r\n                {\r\n                    id: 'overview',\r\n                    text: 'overview'\r\n                },\r\n                {\r\n                    id: 'abilities',\r\n                    text: 'abilities'\r\n                },\r\n                {\r\n                    id: 'cbt-stats',\r\n                    text: 'combat'\r\n                },\r\n                {\r\n                    id: 'actions',\r\n                    text: 'actions'\r\n                }\r\n            ];\r\n\r\n            let monsters: Monster[] = [];\r\n            if (this.props.showSidebar) {\r\n                switch (this.state.sidebar) {\r\n                    case 'similar':\r\n                        monsters = this.getMonsters();\r\n                        break;\r\n                    case 'scratchpad':\r\n                        monsters = this.state.scratchpadList;\r\n                        break;\r\n                }\r\n            }\r\n\r\n            let content = null;\r\n            switch (this.state.page) {\r\n                case 'overview':\r\n                    const catOptions = CATEGORY_TYPES.map(cat => ({ id: cat, text: cat }));\r\n\r\n                    content = (\r\n                        <div className='row'>\r\n                            <div className='columns small-6 medium-6 large-6'>\r\n                                <div className='subheading'>name</div>\r\n                                <input type='text' value={this.state.monster.name} onChange={event => this.changeValue('name', event.target.value)} />\r\n                                <div className='subheading'>size</div>\r\n                                <Spin\r\n                                    source={this.state.monster}\r\n                                    name='size'\r\n                                    nudgeValue={delta => this.nudgeValue('size', delta)}\r\n                                />\r\n                                <div className='subheading'>type</div>\r\n                                <Dropdown\r\n                                    options={catOptions}\r\n                                    selectedID={this.state.monster.category}\r\n                                    select={optionID => this.changeValue('category', optionID)}\r\n                                />\r\n                                <div className='subheading'>subtype</div>\r\n                                <input type='text' value={this.state.monster.tag} onChange={event => this.changeValue('tag', event.target.value)} />\r\n                                <div className='subheading'>alignment</div>\r\n                                <input type='text' value={this.state.monster.alignment} onChange={event => this.changeValue('alignment', event.target.value)} />\r\n                                <div className='subheading'>challenge rating</div>\r\n                                <Spin\r\n                                    source={this.state.monster}\r\n                                    name='challenge'\r\n                                    display={value => Utils.challenge(value)}\r\n                                    nudgeValue={delta => this.nudgeValue('challenge', delta)}\r\n                                />\r\n                            </div>\r\n                            <div className='columns small-6 medium-6 large-6'>\r\n                                <div className='subheading'>speed</div>\r\n                                <input type='text' value={this.state.monster.speed} onChange={event => this.changeValue('speed', event.target.value)} />\r\n                                <div className='subheading'>senses</div>\r\n                                <input type='text' value={this.state.monster.senses} onChange={event => this.changeValue('senses', event.target.value)} />\r\n                                <div className='subheading'>languages</div>\r\n                                <input type='text' value={this.state.monster.languages} onChange={event => this.changeValue('languages', event.target.value)} />\r\n                                <div className='subheading'>equipment</div>\r\n                                <input type='text' value={this.state.monster.equipment} onChange={event => this.changeValue('equipment', event.target.value)} />\r\n                                <div className='subheading'>portrait</div>\r\n                                <PortraitPanel source={this.state.monster} setValue={value => this.changeValue('portrait', value)} />\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                    break;\r\n                case 'abilities':\r\n                    content = (\r\n                        <div className='row'>\r\n                            <div className='columns small-6 medium-6 large-6'>\r\n                                <div className='subheading'>ability scores</div>\r\n                                <AbilityScorePanel\r\n                                    edit={true}\r\n                                    combatant={this.state.monster}\r\n                                    nudgeValue={(source, type, delta) => this.nudgeValue(type, delta)}\r\n                                />\r\n                            </div>\r\n                            <div className='columns small-6 medium-6 large-6'>\r\n                                <div className='subheading'>saving throws</div>\r\n                                <input\r\n                                    type='text'\r\n                                    value={this.state.monster.savingThrows}\r\n                                    onChange={event => this.changeValue('savingThrows', event.target.value)}\r\n                                />\r\n                                <div className='subheading'>skills</div>\r\n                                <input\r\n                                    type='text'\r\n                                    value={this.state.monster.skills}\r\n                                    onChange={event => this.changeValue('skills', event.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                    break;\r\n                case 'cbt-stats':\r\n                    content = (\r\n                        <div className='row'>\r\n                            <div className='columns small-6 medium-6 large-6'>\r\n                                <div className='subheading'>armor class</div>\r\n                                <Spin\r\n                                    source={this.state.monster}\r\n                                    name='ac'\r\n                                    nudgeValue={delta => this.nudgeValue('ac', delta)}\r\n                                />\r\n                                <div className='subheading'>hit dice</div>\r\n                                <Spin\r\n                                    source={this.state.monster}\r\n                                    name='hitDice'\r\n                                    display={value => value + 'd' + Utils.hitDieType(this.state.monster.size)}\r\n                                    nudgeValue={delta => this.nudgeValue('hitDice', delta)}\r\n                                />\r\n                                <div className='subheading'>hit points</div>\r\n                                <div className='hp-value'>{this.state.monster.hpMax} hp</div>\r\n                            </div>\r\n                            <div className='columns small-6 medium-6 large-6'>\r\n                                <div className='subheading'>damage resistances</div>\r\n                                <input\r\n                                    type='text'\r\n                                    value={this.state.monster.damage.resist}\r\n                                    onChange={event => this.changeValue('damage.resist', event.target.value)}\r\n                                />\r\n                                <div className='subheading'>damage vulnerabilities</div>\r\n                                <input\r\n                                    type='text'\r\n                                    value={this.state.monster.damage.vulnerable}\r\n                                    onChange={event => this.changeValue('damage.vulnerable', event.target.value)}\r\n                                />\r\n                                <div className='subheading'>damage immunities</div>\r\n                                <input\r\n                                    type='text'\r\n                                    value={this.state.monster.damage.immune}\r\n                                    onChange={event => this.changeValue('damage.immune', event.target.value)}\r\n                                />\r\n                                <div className='subheading'>condition immunities</div>\r\n                                <input\r\n                                    type='text'\r\n                                    value={this.state.monster.conditionImmunities}\r\n                                    onChange={event => this.changeValue('conditionImmunities', event.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                    break;\r\n                case 'actions':\r\n                    content = (\r\n                        <TraitsPanel\r\n                            combatant={this.state.monster}\r\n                            mode='edit'\r\n                            addTrait={type => this.addTrait(type)}\r\n                            removeTrait={trait => this.removeTrait(trait)}\r\n                            swapTraits={(t1, t2) => this.swapTraits(t1, t2)}\r\n                            changeValue={(trait, type, value) => this.changeTrait(trait, type, value)}\r\n                        />\r\n                    );\r\n                    break;\r\n                default:\r\n                    // Do nothing\r\n                    break;\r\n            }\r\n\r\n            let help = null;\r\n            if (this.props.showSidebar && (monsters.length > 1)) {\r\n                let selector = null;\r\n                if (this.getHelpOptionsForPage(this.state.page).length > 1) {\r\n                    const options = this.getHelpOptionsForPage(this.state.page).map(s => {\r\n                        return {\r\n                            id: s,\r\n                            text: s\r\n                        };\r\n                    });\r\n                    selector = (\r\n                        <div>\r\n                            <div className='subheading'>fields</div>\r\n                            <Selector\r\n                                tabs={false}\r\n                                options={options}\r\n                                selectedID={this.state.helpSection}\r\n                                select={optionID => this.setHelpSection(optionID)}\r\n                            />\r\n                            <div className='subheading'>values</div>\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                help = (\r\n                    <div className='monster-help group-panel'>\r\n                        <div className='heading'>information from sidebar monsters</div>\r\n                        {selector}\r\n                        {this.getHelpSection(monsters)}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            let sidebar = null;\r\n            if (this.props.showSidebar) {\r\n                let sidebarContent = null;\r\n                switch (this.state.sidebar) {\r\n                    case 'similar':\r\n                        sidebarContent = (\r\n                            <Expander\r\n                                text='similarity criteria'\r\n                                content={\r\n                                    <div>\r\n                                        <Checkbox\r\n                                            label={'size ' + this.state.monster.size}\r\n                                            checked={this.state.similarFilter.size}\r\n                                            changeValue={value => this.toggleMatch('size')}\r\n                                        />\r\n                                        <Checkbox\r\n                                            label={'type ' + this.state.monster.category}\r\n                                            checked={this.state.similarFilter.type}\r\n                                            changeValue={value => this.toggleMatch('type')}\r\n                                        />\r\n                                        <Checkbox\r\n                                            label={this.state.monster.tag ? 'subtype ' + this.state.monster.tag : 'subtype'}\r\n                                            checked={this.state.similarFilter.subtype}\r\n                                            disabled={!this.state.monster.tag}\r\n                                            changeValue={value => this.toggleMatch('subtype')}\r\n                                        />\r\n                                        <Checkbox\r\n                                            label={this.state.monster.alignment ? 'alignment ' + this.state.monster.alignment : 'alignment'}\r\n                                            checked={this.state.similarFilter.alignment}\r\n                                            disabled={!this.state.monster.alignment}\r\n                                            changeValue={value => this.toggleMatch('alignment')}\r\n                                        />\r\n                                        <Checkbox\r\n                                            label={'challenge rating ' + Utils.challenge(this.state.monster.challenge)}\r\n                                            checked={this.state.similarFilter.challenge}\r\n                                            changeValue={value => this.toggleMatch('challenge')}\r\n                                        />\r\n                                    </div>\r\n                                }\r\n                            />\r\n                        );\r\n                        break;\r\n                    case 'scratchpad':\r\n                        {\r\n                            const searchResults: Monster[] = [];\r\n                            this.props.library.forEach(group => {\r\n                                group.monsters.forEach(m => {\r\n                                    if (!monsters.includes(m) && this.matchMonster(m)) {\r\n                                        searchResults.push(m);\r\n                                    }\r\n                                });\r\n                            });\r\n                            Utils.sort(searchResults);\r\n                            let resultsRows = searchResults.map(m =>\r\n                                <button key={m.id} onClick={() => this.addToScratchpadList(m)}>{m.name}</button>\r\n                            );\r\n                            if (searchResults.length === 0) {\r\n                                resultsRows = [(\r\n                                    <Note key='none' content='no monsters found' />\r\n                                )];\r\n                            }\r\n                            let removeSection = null;\r\n                            if (monsters.length > 0) {\r\n                                const deleteRows = monsters.map(m =>\r\n                                    <button key={m.id} onClick={() => this.removeFromScratchpadList(m)}>{m.name}</button>\r\n                                );\r\n                                removeSection = (\r\n                                    <Expander\r\n                                        text='remove monsters from the list'\r\n                                        content={\r\n                                            <div>\r\n                                                {deleteRows}\r\n                                            </div>\r\n                                        }\r\n                                    />\r\n                                );\r\n                            }\r\n                            sidebarContent = (\r\n                                <div>\r\n                                    <Expander\r\n                                        text='add monsters to the list'\r\n                                        content={\r\n                                            <div>\r\n                                                <FilterPanel\r\n                                                    filter={this.state.scratchpadFilter}\r\n                                                    changeValue={(type, value) => this.changeFilterValue(type, value)}\r\n                                                    nudgeValue={(type, delta) => this.nudgeFilterValue(type, delta)}\r\n                                                    resetFilter={() => this.resetFilter()}\r\n                                                />\r\n                                                <div className='divider' />\r\n                                                {resultsRows}\r\n                                            </div>\r\n                                        }\r\n                                    />\r\n                                    {removeSection}\r\n                                </div>\r\n                            );\r\n                        }\r\n                        break;\r\n                }\r\n                const sidebarOptions = [\r\n                    {\r\n                        id: 'similar',\r\n                        text: 'similar'\r\n                    },\r\n                    {\r\n                        id: 'scratchpad',\r\n                        text: 'scratchpad'\r\n                    }\r\n                ];\r\n                sidebar = (\r\n                    <div className='columns small-4 medium-4 large-4 scrollable wide-column'>\r\n                        <Selector\r\n                            tabs={true}\r\n                            options={sidebarOptions}\r\n                            selectedID={this.state.sidebar}\r\n                            select={optionID => this.setState({sidebar: optionID as 'similar' | 'scratchpad'})}\r\n                        />\r\n                        {sidebarContent}\r\n                        <div className='divider'/>\r\n                        <button className={monsters.length < 2 ? 'disabled' : ''} onClick={() => this.spliceMonsters(monsters)}>\r\n                            build random monster\r\n                        </button>\r\n                        <div className='divider'/>\r\n                        {this.getMonsterCards(monsters)}\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='row' style={{ height: '100%', margin: '0 -5px' }}>\r\n                    <div\r\n                        className={\r\n                            this.props.showSidebar\r\n                            ? 'columns small-8 medium-8 large-8 scrollable wide-column'\r\n                            : 'columns small-12 medium-12 large-12 scrollable wide-column'\r\n                        }\r\n                        style={{ transition: 'none' }}\r\n                    >\r\n                        <div className='section'>\r\n                            <Selector\r\n                                tabs={true}\r\n                                options={pages}\r\n                                selectedID={this.state.page}\r\n                                select={optionID => this.setPage(optionID as 'overview' | 'abilities' | 'cbt-stats' | 'actions')}\r\n                            />\r\n                            {content}\r\n                            {help}\r\n                        </div>\r\n                    </div>\r\n                    {sidebar}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Factory from '../../utils/factory';\r\n\r\nimport { PC } from '../../models/party';\r\n\r\nimport Spin from '../controls/spin';\r\nimport PortraitPanel from '../panels/portrait-panel';\r\n\r\ninterface Props {\r\n    pc: PC;\r\n}\r\n\r\ninterface State {\r\n    pc: PC;\r\n}\r\n\r\nexport default class PCEditorModal extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            pc: props.pc\r\n        };\r\n    }\r\n\r\n    private addCompanion() {\r\n        const companion = Factory.createCompanion();\r\n        companion.name = 'new companion';\r\n        this.state.pc.companions.push(companion);\r\n        this.setState({\r\n            pc: this.state.pc\r\n        });\r\n    }\r\n\r\n    private removeCompanion(id: string) {\r\n        // eslint-disable-next-line\r\n        this.state.pc.companions = this.state.pc.companions.filter(c => c.id !== id);\r\n        this.setState({\r\n            pc: this.state.pc\r\n        });\r\n    }\r\n\r\n    private changeValue(source: any, field: string, value: any) {\r\n        source[field] = value;\r\n\r\n        this.setState({\r\n            pc: this.state.pc\r\n        });\r\n    }\r\n\r\n    private nudgeValue(source: any, field: string, delta: number) {\r\n        const value = source[field] + delta;\r\n        this.changeValue(source, field, value);\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const companions = this.state.pc.companions.map(comp => (\r\n                <div className='row companion' key={comp.id}>\r\n                    <div className='columns small-12 medium-8 large-8'>\r\n                        <input\r\n                            type='text'\r\n                            value={comp.name}\r\n                            onChange={event => this.changeValue(comp, 'name', event.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div className='columns small-12 medium-4 large-4'>\r\n                        <button onClick={() => this.removeCompanion(comp.id)}>delete</button>\r\n                    </div>\r\n                </div>\r\n            ));\r\n\r\n            if (companions.length === 0) {\r\n                companions.push(\r\n                    <div className='section' key='empty'>\r\n                        <i>no companions (pets, retainers, mounts, etc)</i>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <div className='pc-editor'>\r\n                    <div className='row section'>\r\n                        <div className='columns small-12 medium-6 large-6'>\r\n                            <div className='subheading'>character name:</div>\r\n                            <input\r\n                                type='text'\r\n                                value={this.state.pc.name}\r\n                                onChange={event => this.changeValue(this.state.pc, 'name', event.target.value)}\r\n                            />\r\n                            <div className='subheading'>player name:</div>\r\n                            <input\r\n                                type='text'\r\n                                value={this.state.pc.player}\r\n                                onChange={event => this.changeValue(this.state.pc, 'player', event.target.value)}\r\n                            />\r\n                            <div className='subheading'>race:</div>\r\n                            <input\r\n                                type='text'\r\n                                value={this.state.pc.race}\r\n                                onChange={event => this.changeValue(this.state.pc, 'race', event.target.value)}\r\n                            />\r\n                            <div className='subheading'>class:</div>\r\n                            <input\r\n                                type='text'\r\n                                value={this.state.pc.classes}\r\n                                onChange={event => this.changeValue(this.state.pc, 'classes', event.target.value)}\r\n                            />\r\n                            <div className='subheading'>level:</div>\r\n                            <Spin\r\n                                source={this.state.pc}\r\n                                name='level'\r\n                                nudgeValue={delta => this.nudgeValue(this.state.pc, 'level', delta)}\r\n                            />\r\n                            <div className='subheading'>passive skills</div>\r\n                            <Spin\r\n                                source={this.state.pc}\r\n                                name='passiveInsight'\r\n                                label='insight'\r\n                                nudgeValue={delta => this.nudgeValue(this.state.pc, 'passiveInsight', delta)}\r\n                            />\r\n                            <Spin\r\n                                source={this.state.pc}\r\n                                name='passiveInvestigation'\r\n                                label='investigation'\r\n                                nudgeValue={delta => this.nudgeValue(this.state.pc, 'passiveInvestigation', delta)}\r\n                            />\r\n                            <Spin\r\n                                source={this.state.pc}\r\n                                name='passivePerception'\r\n                                label='perception'\r\n                                nudgeValue={delta => this.nudgeValue(this.state.pc, 'passivePerception', delta)}\r\n                            />\r\n                        </div>\r\n                        <div className='columns small-12 medium-6 large-6'>\r\n                            <div className='subheading'>languages:</div>\r\n                            <input\r\n                                type='text'\r\n                                value={this.state.pc.languages}\r\n                                onChange={event => this.changeValue(this.state.pc, 'languages', event.target.value)}\r\n                            />\r\n                            <div className='subheading'>d&d beyond link:</div>\r\n                            <input\r\n                                type='text'\r\n                                value={this.state.pc.url}\r\n                                placeholder='https://ddb.ac/characters/...'\r\n                                onChange={event => this.changeValue(this.state.pc, 'url', event.target.value)}\r\n                            />\r\n                            <div className='subheading'>portrait</div>\r\n                            <PortraitPanel source={this.state.pc} setValue={value => this.changeValue(this.state.pc, 'portrait', value)} />\r\n                            <div className='subheading'>companions:</div>\r\n                            {companions}\r\n                            <button onClick={() => this.addCompanion()}>add a new companion</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport pkg from '../../../../package.json';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\nexport default class AboutModule extends React.Component<Props> {\r\n    public render() {\r\n        /* tslint:disable:max-line-length */\r\n        return (\r\n            <div>\r\n                <div className='section'>designed by <a href='mailto:andy.aiken@live.co.uk'>andy aiken</a></div>\r\n                <div className='section'>version <b>{pkg.version}</b></div>\r\n                <div className='section'>if you would like to raise a bug or request a new feature, you can do so <a href='https://github.com/andyaiken/dojo' target='_blank' rel='noopener noreferrer'>here</a></div>\r\n            </div>\r\n        );\r\n        /* tslint:enable:max-line-length */\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\nexport default class OGLModule extends React.Component<Props> {\r\n    public render() {\r\n        /* tslint:disable:max-line-length */\r\n        return (\r\n            <div>\r\n                <div className='heading'>open game license</div>\r\n                <div className='section'>The following text is the property of Wizards of the Coast, Inc. and is Copyright 2000 Wizards of the Coast, Inc ('Wizards'). All Rights Reserved.</div>\r\n                <ol>\r\n                    <li>Definitions: (a)'Contributors' means the copyright and/or trademark owners who have contributed Open Game Content; (b)'Derivative Material' means copyrighted material including derivative works and translations (including into other computer languages), potation, modification, correction, addition, extension, upgrade, improvement, compilation, abridgment or other form in which an existing work may be recast, transformed or adapted; (c) 'Distribute' means to reproduce, license, rent, lease, sell, broadcast, publicly display, transmit or otherwise distribute; (d)'Open Game Content' means the game mechanic and includes the methods, procedures, processes and routines to the extent such content does not embody the Product Identity and is an enhancement over the prior art and any additional content clearly identified as Open Game Content by the Contributor, and means any work covered by this License, including translations and derivative works under copyright law, but specifically excludes Product Identity. (e) 'Product Identity' means product and product line names, logos and identifying marks including trade dress; artifacts; creatures characters; stories, storylines, plots, thematic elements, dialogue, incidents, language, artwork, symbols, designs, depictions, likenesses, formats, poses, concepts, themes and graphic, photographic and other visual or audio representations; names and descriptions of characters, spells, enchantments, personalities, teams, personas, likenesses and special abilities; places, locations, environments, creatures, equipment, magical or supernatural abilities or effects, logos, symbols, or graphic designs; and any other trademark or registered trademark clearly identified as Product identity by the owner of the Product Identity, and which specifically excludes the Open Game Content; (f) 'Trademark' means the logos, names, mark, sign, motto, designs that are used by a Contributor to identify itself or its products or the associated products contributed to the Open Game License by the Contributor (g) 'Use', 'Used' or 'Using' means to use, Distribute, copy, edit, format, modify, translate and otherwise create Derivative Material of Open Game Content. (h) 'You' or 'Your' means the licensee in terms of this agreement.</li>\r\n                    <li>The License: This License applies to any Open Game Content that contains a notice indicating that the Open Game Content may only be Used under and in terms of this License. You must affix such a notice to any Open Game Content that you Use. No terms may be added to or subtracted from this License except as described by the License itself. No other terms or conditions may be applied to any Open Game Content distributed using this License.</li>\r\n                    <li>Offer and Acceptance: By Using the Open Game Content You indicate Your acceptance of the terms of this License.</li>\r\n                    <li>Grant and Consideration: In consideration for agreeing to use this License, the Contributors grant You a perpetual, worldwide, royalty-free, non-exclusive license with the exact terms of this License to Use, the Open Game Content.</li>\r\n                    <li>Representation of Authority to Contribute: If You are contributing original material as Open Game Content, You represent that Your Contributions are Your original creation and/or You have sufficient rights to grant the rights conveyed by this License.</li>\r\n                    <li>Notice of License Copyright: You must update the COPYRIGHT NOTICE portion of this License to include the exact text of the COPYRIGHT NOTICE of any Open Game Content You are copying, modifying or distributing, and You must add the title, the copyright date, and the copyright holder's name to the COPYRIGHT NOTICE of any original Open Game Content you Distribute.</li>\r\n                    <li>Use of Product Identity: You agree not to Use any Product Identity, including as an indication as to compatibility, except as expressly licensed in another, independent Agreement with the owner of each element of that Product Identity. You agree not to indicate compatibility or co-adaptability with any Trademark or Registered Trademark in conjunction with a work containing Open Game Content except as expressly licensed in another, independent Agreement with the owner of such Trademark or Registered Trademark. The use of any Product Identity in Open Game Content does not constitute a challenge to the ownership of that Product Identity. The owner of any Product Identity used in Open Game Content shall retain all rights, title and interest in and to that Product Identity.</li>\r\n                    <li>Identification: If you distribute Open Game Content You must clearly indicate which portions of the work that you are distributing are Open Game Content.</li>\r\n                    <li>Updating the License: Wizards or its designated Agents may publish updated versions of this License. You may use any authorized version of this License to copy, modify and distribute any Open Game Content originally distributed under any version of this License.</li>\r\n                    <li>Copy of this License: You MUST include a copy of this License with every copy of the Open Game Content You Distribute.</li>\r\n                    <li>Use of Contributor Credits: You may not market or advertise the Open Game Content using the name of any Contributor unless You have written permission from the Contributor to do so.</li>\r\n                    <li>Inability to Comply: If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Open Game Content due to statute, judicial order, or governmental regulation then You may not Use any Open Game Material so affected.</li>\r\n                    <li>Termination: This License will terminate automatically if You fail to comply with all terms herein and fail to cure such breach within 30 days of becoming aware of the breach. All sublicenses shall survive the termination of this License.</li>\r\n                    <li>Reformation: If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable.</li>\r\n                    <li>COPYRIGHT NOTICE Open Game License v 1.0 Copyright 2000, Wizards of the Coast, Inc.</li>\r\n                </ol>\r\n            </div>\r\n        );\r\n        /* tslint:enable:max-line-length */\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport ConfirmButton from '../../controls/confirm-button';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    resetAll: () => void;\r\n}\r\n\r\nexport default class OptionsModule extends React.Component<Props> {\r\n    public render() {\r\n        return (\r\n            <div>\r\n                <div className='section'>this will reset the entire app and cannot be undone</div>\r\n                <div className='section'>use it at your own risk</div>\r\n                <ConfirmButton text='clear all data' callback={() => this.props.resetAll()} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Selector from '../controls/selector';\r\nimport AboutModule from './about/about-module';\r\nimport OGLModule from './about/ogl-module';\r\nimport OptionsModule from './about/options-module';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    resetAll: () => void;\r\n}\r\n\r\ninterface State {\r\n    view: string;\r\n}\r\n\r\nexport default class AboutTool extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            view: 'about'\r\n        };\r\n    }\r\n\r\n    private setView(view: string) {\r\n        this.setState({\r\n            view: view\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const options = [\r\n            {\r\n                id: 'about',\r\n                text: 'about dojo'\r\n            },\r\n            {\r\n                id: 'ogl',\r\n                text: 'ogl'\r\n            },\r\n            {\r\n                id: 'options',\r\n                text: 'options'\r\n            }\r\n        ];\r\n\r\n        let content = null;\r\n        switch (this.state.view) {\r\n            case 'about':\r\n                content = (\r\n                    <AboutModule />\r\n                );\r\n                break;\r\n            case 'ogl':\r\n                content = (\r\n                    <OGLModule />\r\n                );\r\n                break;\r\n            case 'options':\r\n                content = (\r\n                    <OptionsModule resetAll={() => this.props.resetAll()} />\r\n                );\r\n                break;\r\n        }\r\n\r\n        return (\r\n            <div className='about'>\r\n                <Selector\r\n                    options={options}\r\n                    selectedID={this.state.view}\r\n                    select={optionID => this.setView(optionID)}\r\n                />\r\n                <div className='divider' />\r\n                {content}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Utils from '../../../utils/utils';\r\n\r\nimport Checkbox from '../../controls/checkbox';\r\nimport ControlRow from '../../controls/control-row';\r\nimport Selector from '../../controls/selector';\r\nimport Spin from '../../controls/spin';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    dice: string;\r\n    count: number;\r\n    options: string[];\r\n    rolls: number[] | null;\r\n    result: number | null;\r\n}\r\n\r\nexport default class DieRollerModule extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            dice: '20',\r\n            count: 1,\r\n            options: [],\r\n            rolls: null,\r\n            result: null\r\n        };\r\n    }\r\n\r\n    private setDice(dice: string) {\r\n        this.setState({\r\n            dice: dice\r\n        });\r\n    }\r\n\r\n    private nudgeCount(delta: number) {\r\n        this.setState({\r\n            count: Math.max(1, this.state.count + delta)\r\n        });\r\n    }\r\n\r\n    private toggleOption(option: string) {\r\n        if (this.state.options.includes(option)) {\r\n            // Remove option\r\n            const index = this.state.options.indexOf(option);\r\n            this.state.options.splice(index, 1);\r\n        } else {\r\n            // Add option\r\n            this.state.options.push(option);\r\n            // Make sure we don't have both advantage and disadvantage\r\n            if (this.state.options.includes('advantage') && this.state.options.includes('disadvantage')) {\r\n                const index = this.state.options.indexOf(option === 'advantage' ? 'disadvantage' : 'advantage');\r\n                this.state.options.splice(index, 1);\r\n            }\r\n        }\r\n        this.setState({\r\n            options: this.state.options\r\n        });\r\n    }\r\n\r\n    private roll() {\r\n        const sides = parseInt(this.state.dice, 10);\r\n\r\n        const rolls: number[] = [];\r\n        let count = this.state.count;\r\n        if (this.state.options.includes('advantage') || this.state.options.includes('disadvantage')) {\r\n            count = 2;\r\n        }\r\n        for (let n = 0; n !== count; ++n) {\r\n            rolls.push(Utils.dieRoll(sides));\r\n        }\r\n        rolls.sort((a, b) => a - b);\r\n\r\n        let result = 0;\r\n        if (this.state.options.includes('advantage')) {\r\n            result = Math.max(...rolls);\r\n        } else if (this.state.options.includes('disadvantage')) {\r\n            result = Math.min(...rolls);\r\n        } else {\r\n            rolls.forEach(roll => result += roll);\r\n            if (this.state.options.includes('drop lowest')) {\r\n                result -= Math.min(...rolls);\r\n            }\r\n            if (this.state.options.includes('drop highest')) {\r\n                result -= Math.max(...rolls);\r\n            }\r\n        }\r\n\r\n        this.setState({\r\n            rolls: rolls,\r\n            result: result\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const options = [\r\n            {\r\n                id: '4',\r\n                text: 'd4'\r\n            },\r\n            {\r\n                id: '6',\r\n                text: 'd6'\r\n            },\r\n            {\r\n                id: '8',\r\n                text: 'd8'\r\n            },\r\n            {\r\n                id: '10',\r\n                text: 'd10'\r\n            },\r\n            {\r\n                id: '12',\r\n                text: 'd12'\r\n            },\r\n            {\r\n                id: '20',\r\n                text: 'd20'\r\n            },\r\n            {\r\n                id: '100',\r\n                text: 'd100'\r\n            }\r\n        ];\r\n\r\n        let optionsSection = null;\r\n        if ((this.state.dice === '20') && (this.state.count === 1)) {\r\n            optionsSection = (\r\n                <ControlRow\r\n                    controls={[\r\n                        <Checkbox\r\n                            key='advantage'\r\n                            label='advantage'\r\n                            checked={this.state.options.includes('advantage')}\r\n                            changeValue={value => this.toggleOption('advantage')}\r\n                        />,\r\n                        <Checkbox\r\n                            key='disadvantage'\r\n                            label='disadvantage'\r\n                            checked={this.state.options.includes('disadvantage')}\r\n                            changeValue={value => this.toggleOption('disadvantage')}\r\n                        />\r\n                    ]}\r\n                />\r\n            );\r\n        } else if (this.state.count > 1) {\r\n            optionsSection = (\r\n                <ControlRow\r\n                    controls={[\r\n                        <Checkbox\r\n                            key='drop-lowest'\r\n                            label='drop lowest'\r\n                            checked={this.state.options.includes('drop lowest')}\r\n                            changeValue={value => this.toggleOption('drop lowest')}\r\n                        />,\r\n                        <Checkbox\r\n                            key='drop-highest'\r\n                            label='drop highest'\r\n                            checked={this.state.options.includes('drop highest')}\r\n                            changeValue={value => this.toggleOption('drop highest')}\r\n                        />\r\n                    ]}\r\n                />\r\n            );\r\n        }\r\n\r\n        let rollsSection = null;\r\n        if ((this.state.rolls !== null) && (this.state.rolls.length > 1)) {\r\n            rollsSection = (\r\n                <div className='section die-rolls'>{this.state.rolls.join(', ')}</div>\r\n            );\r\n        }\r\n\r\n        let resultSection = null;\r\n        if (this.state.result !== null) {\r\n            resultSection = (\r\n                <div className='section die-result'>{this.state.result}</div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='subheading'>die type</div>\r\n                <Selector\r\n                    options={options}\r\n                    selectedID={this.state.dice}\r\n                    select={optionID => this.setDice(optionID)}\r\n                />\r\n                <div className='subheading'>number of dice to roll</div>\r\n                <Spin\r\n                    source={this.state}\r\n                    name='count'\r\n                    display={count => count + 'd' + this.state.dice}\r\n                    nudgeValue={delta => this.nudgeCount(delta)}\r\n                />\r\n                {optionsSection ? <div className='subheading'>options</div> : null}\r\n                {optionsSection}\r\n                <div className='divider' />\r\n                <button onClick={() => this.roll()}>roll dice</button>\r\n                {rollsSection}\r\n                {resultSection}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import Utils from './utils';\r\n\r\ninterface ModelLine {\r\n    prev: string;\r\n    freq: ModelChar[];\r\n}\r\n\r\ninterface ModelChar {\r\n    char: string;\r\n    count: number;\r\n}\r\n\r\nexport default class Shakespeare {\r\n\r\n    private static model: ModelLine[] = [];\r\n    private static maxLength: number = 0;\r\n\r\n    public static initModel(sources: string[]) {\r\n        const model: ModelLine[] = [];\r\n        let maxLength: number = 0;\r\n\r\n        sources.forEach(source => {\r\n            const lines = source.split(/\\r?\\n/);\r\n            lines.forEach(line => {\r\n                if (line) {\r\n                    Shakespeare.addLineToModel(line, model);\r\n                    maxLength = Math.max(maxLength, line.length);\r\n                }\r\n            });\r\n        });\r\n\r\n        Shakespeare.model = model;\r\n        Shakespeare.maxLength = maxLength;\r\n    }\r\n\r\n    private static addLineToModel(line: string, model: ModelLine[]) {\r\n        line = String.fromCharCode(0, 1) + line + String.fromCharCode(2);\r\n\r\n        for (let index = 2; index !== line.length; ++index) {\r\n            const prev = line.substr(index - 2, 2);\r\n            const char = line.substr(index, 1);\r\n\r\n            let item = model.find(x => x.prev === prev);\r\n            if (!item) {\r\n                item = {\r\n                    prev: prev,\r\n                    freq: []\r\n                };\r\n                model.push(item);\r\n            }\r\n\r\n            let freq = item.freq.find(x => x.char === char);\r\n            if (!freq) {\r\n                freq = {\r\n                    char: char,\r\n                    count: 0\r\n                };\r\n                item.freq.push(freq);\r\n            }\r\n\r\n            freq.count += 1;\r\n        }\r\n    }\r\n\r\n    public static generate(requiredResults: number): { line: string, fit: number }[] {\r\n        const lines: { line: string, fit: number }[] = [];\r\n        const allowedFailures = 100;\r\n        let failures = 0;\r\n\r\n        while ((lines.length < requiredResults) && (failures < allowedFailures)) {\r\n            const line = Shakespeare.extractLine();\r\n            if (line && !lines.map(l => l.line).includes(line) && line.length <= Shakespeare.maxLength) {\r\n                const fit = Shakespeare.fit(line);\r\n                lines.push({ line, fit });\r\n            } else {\r\n                failures += 1;\r\n            }\r\n        }\r\n\r\n        return lines;\r\n    }\r\n\r\n    private static extractLine() {\r\n        let line = String.fromCharCode(0, 1);\r\n\r\n        while (true) {\r\n            const prev = line.substr(line.length - 2, 2);\r\n\r\n            const item = Shakespeare.model.find(x => x.prev === prev);\r\n            if (item) {\r\n                let candidates = '';\r\n                item.freq.forEach(freq => {\r\n                    candidates += freq.char.repeat(freq.count);\r\n                });\r\n\r\n                const index = Math.floor(Math.random() * candidates.length);\r\n                let char = candidates[index];\r\n                if (char === String.fromCharCode(2)) {\r\n                    line = line.substr(2);\r\n                    return line;\r\n                } else {\r\n                    if (Utils.dieRoll() === 1) {\r\n                        // TODO: Mutate choice\r\n                        const groups = ['bdg', 'ptk', 'sz', 'aeiouy', 'lr', 'ckq', 'vf'];\r\n                        groups.forEach(g => {\r\n                            if (g.includes(char)) {\r\n                                const n = Math.floor(Math.random() * g.length);\r\n                                char = g[n];\r\n                            }\r\n                        });\r\n                    }\r\n                    line += char;\r\n                }\r\n            } else {\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n\r\n    private static fit(text: string): number {\r\n        text = String.fromCharCode(0, 1) + text + String.fromCharCode(2);\r\n\r\n        const values: number[] = [];\r\n        for (let n = 2; n !== text.length; ++n) {\r\n            const prev = text.substr(n - 2, 2);\r\n            const ch = text[n];\r\n\r\n            const line = Shakespeare.model.find(m => m.prev === prev);\r\n            if (line) {\r\n                const mc = line.freq.find(f => f.char === ch);\r\n                if (mc) {\r\n                    const maxCount = line.freq.reduce((max, value) => Math.max(max, value.count), 0);\r\n                    const fit = mc.count / maxCount;\r\n                    values.push(fit);\r\n                } else {\r\n                    values.push(0);\r\n                }\r\n            }\r\n        }\r\n\r\n        return values.reduce((sum, value) => sum + value, 0) / values.length;\r\n    }\r\n}\r\n","export default class Ustinov {\r\n    public static async say(text: string, languages: string[]) {\r\n        // If we're  already saying something, stop it\r\n        window.speechSynthesis.cancel();\r\n\r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n        utterance.voice = await Ustinov.chooseVoice(languages);\r\n        utterance.rate = Ustinov.randomValue(0.5, 1.5);\r\n        utterance.pitch = Ustinov.randomValue(0.5, 1.5);\r\n\r\n        window.speechSynthesis.speak(utterance);\r\n    }\r\n\r\n    private static async chooseVoice(languages: string[]) {\r\n        const voices = await Ustinov.getVoices();\r\n\r\n        // Get language codes for the selected languages\r\n        const langCodes = languages.map(lang => Ustinov.getLanguageCode(lang));\r\n\r\n        // Filter voice list by these language codes\r\n        let candidates = voices.filter(v => langCodes.includes(v.lang.substr(0, 2)));\r\n        if (candidates.length === 0) {\r\n            candidates = voices.filter(v => v.default);\r\n        }\r\n        if (candidates.length === 0) {\r\n            candidates = voices;\r\n        }\r\n\r\n        const index = Math.floor(Math.random() * candidates.length);\r\n        return candidates[index];\r\n    }\r\n\r\n    private static getVoices() {\r\n        return new Promise<SpeechSynthesisVoice[]>(resolve => {\r\n            let list = window.speechSynthesis.getVoices();\r\n            if (list.length > 0) {\r\n                resolve(list);\r\n                return;\r\n            }\r\n            speechSynthesis.onvoiceschanged = () => {\r\n                list = window.speechSynthesis.getVoices();\r\n                resolve(list);\r\n            };\r\n        });\r\n    }\r\n\r\n    private static getLanguageCode(language: string) {\r\n        switch (language) {\r\n            case 'armenian':\r\n                return 'hy';\r\n            case 'basque':\r\n                return 'eu';\r\n            case 'bulgarian':\r\n                return 'bg';\r\n            case 'chichewa':\r\n                return 'ny';\r\n            case 'chinese':\r\n                return 'zh';\r\n            case 'croatian':\r\n                return 'hr';\r\n            case 'czech':\r\n                return 'cs';\r\n            case 'dutch':\r\n                return 'nl';\r\n            case 'german':\r\n                return 'de';\r\n            case 'greek':\r\n                return 'el';\r\n            case 'icelandic':\r\n                return 'is';\r\n            case 'irish':\r\n                return 'ga';\r\n            case 'kannada':\r\n                return 'kn';\r\n            case 'kazakh':\r\n                return 'kk';\r\n            case 'latvian':\r\n                return 'lv';\r\n            case 'lithuanian':\r\n                return 'lt';\r\n            case 'macedonian':\r\n                return 'mk';\r\n            case 'malay':\r\n                return 'ms';\r\n            case 'maltese':\r\n                return 'mt';\r\n            case 'maori':\r\n                return 'mi';\r\n            case 'polish':\r\n                return 'pl';\r\n            case 'portuguese':\r\n                return 'pt';\r\n            case 'punjabi':\r\n                return 'pa';\r\n            case 'samoan':\r\n                return 'sm';\r\n            case 'serbian':\r\n                return 'sr';\r\n            case 'shona':\r\n                return 'sn';\r\n            case 'spanish':\r\n                return 'es';\r\n            case 'swedish':\r\n                return 'sv';\r\n            case 'turkish':\r\n                return 'tr';\r\n            case 'welsh':\r\n                return 'cy';\r\n            default:\r\n                return language.substr(0, 2);\r\n        }\r\n    }\r\n\r\n    private static randomValue(min: number, max: number) {\r\n        const x = (Math.random() + Math.random() + Math.random()) / 3;\r\n        const range = max - min;\r\n        return min + (x * range);\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Shakespeare from '../../../utils/shakespeare';\r\nimport Ustinov from '../../../utils/ustinov';\r\n\r\nimport Checkbox from '../../controls/checkbox';\r\nimport ControlRow from '../../controls/control-row';\r\nimport Expander from '../../controls/expander';\r\nimport Selector from '../../controls/selector';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    sources: { [id: string]: string; };\r\n    output: string[];\r\n}\r\n\r\ninterface Preset {\r\n    name: string;\r\n    languages: string[];\r\n}\r\n\r\nexport default class LanguageModule extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            sources: {},\r\n            output: []\r\n        };\r\n    }\r\n\r\n    private getLanguages(): string[] {\r\n        // Note: When adding a language to this list, also check the Speech.getLanguageCode() method\r\n        return [\r\n            'afrikaans',\r\n            'amharic',\r\n            'armenian',\r\n            'basque',\r\n            'belarusian',\r\n            'bulgarian',\r\n            'chichewa',\r\n            'chinese',\r\n            'croatian',\r\n            'czech',\r\n            'danish',\r\n            'dutch',\r\n            'english',\r\n            'finnish',\r\n            'french',\r\n            'german',\r\n            'greek',\r\n            'hawaiian',\r\n            'hindi',\r\n            'hungarian',\r\n            'icelandic',\r\n            'irish',\r\n            'italian',\r\n            'japanese',\r\n            'kannada',\r\n            'kazakh',\r\n            'korean',\r\n            'kyrgyz',\r\n            'latvian',\r\n            'lithuanian',\r\n            'macedonian',\r\n            'malay',\r\n            'maltese',\r\n            'maori',\r\n            'myanmar',\r\n            'nepali',\r\n            'norwegian',\r\n            'polish',\r\n            'portuguese',\r\n            'punjabi',\r\n            'romanian',\r\n            'russian',\r\n            'samoan',\r\n            'serbian',\r\n            'shona',\r\n            'somali',\r\n            'spanish',\r\n            'swahili',\r\n            'swedish',\r\n            'thai',\r\n            'turkish',\r\n            'welsh',\r\n            'yiddish',\r\n            'zulu'\r\n        ];\r\n    }\r\n\r\n    private getPresets(): Preset[] {\r\n        return [\r\n            {\r\n                name: 'draconic',\r\n                languages: ['armenian', 'irish', 'maltese']\r\n            },\r\n            {\r\n                name: 'dwarvish',\r\n                languages: ['czech', 'german', 'yiddish']\r\n            },\r\n            {\r\n                name: 'elvish',\r\n                languages: ['finnish', 'spanish', 'welsh']\r\n            },\r\n            {\r\n                name: 'goblin',\r\n                languages: ['hawaiian', 'kyrgyz', 'somali']\r\n            },\r\n            {\r\n                name: 'orc',\r\n                languages: ['macedonian', 'russian', 'turkish']\r\n            }\r\n        ];\r\n    }\r\n\r\n    private async addLanguage(language: string) {\r\n        const response = await fetch('./data/langs/' + language + '.txt');\r\n        this.state.sources[language] = await response.text();\r\n        this.setState({\r\n            sources: this.state.sources\r\n        });\r\n    }\r\n\r\n    private removeLanguage(language: string) {\r\n        delete this.state.sources[language];\r\n        this.setState({\r\n            sources: this.state.sources\r\n        });\r\n    }\r\n\r\n    private usePreset(presetName: string) {\r\n        const preset = this.getPresets().find(p => p.name === presetName);\r\n        if (preset) {\r\n            this.setState({\r\n                sources: {},\r\n                output: []\r\n            }, () => {\r\n                preset.languages.forEach(lang => {\r\n                    this.addLanguage(lang);\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    private random() {\r\n        const languages = this.getLanguages();\r\n\r\n        const selection: string[] = [];\r\n        while (selection.length !== 3) {\r\n            const n = Math.floor(Math.random() * languages.length);\r\n            const lang = languages[n];\r\n            if (!selection.includes(lang)) {\r\n                selection.push(lang);\r\n            }\r\n        }\r\n\r\n        this.setState({\r\n            sources: {},\r\n            output: []\r\n        }, () => {\r\n            selection.forEach(lang => {\r\n                this.addLanguage(lang);\r\n            });\r\n        });\r\n    }\r\n\r\n    private generate() {\r\n        const sources: string[] = [];\r\n        Object.keys(this.state.sources).forEach(key => {\r\n            const src = this.state.sources[key];\r\n            sources.push(src);\r\n        });\r\n        Shakespeare.initModel(sources);\r\n        this.setState({\r\n            output: Shakespeare.generate(5).map(l => l.line)\r\n        });\r\n    }\r\n\r\n    private reset() {\r\n        this.setState({\r\n            sources: {},\r\n            output: []\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const presetOptions = this.getPresets().map(p => {\r\n            return {\r\n                id: p.name,\r\n                text: p.name\r\n            };\r\n        });\r\n\r\n        let selectedPreset = '';\r\n        this.getPresets().forEach(p => {\r\n            const selected = Object.keys(this.state.sources).sort().join(', ');\r\n            const setting = p.languages.sort().join(', ');\r\n            if (selected === setting) {\r\n                selectedPreset = p.name;\r\n            }\r\n        });\r\n\r\n        let selectedLanguages = Object.keys(this.state.sources).sort().join(', ');\r\n        if (selectedLanguages === '') {\r\n            selectedLanguages = 'none';\r\n        }\r\n\r\n        const languages = this.getLanguages()\r\n            .map(lang => {\r\n                const isSelected = Object.keys(this.state.sources).includes(lang);\r\n                return (\r\n                    <div className='column' key={lang}>\r\n                        <Checkbox\r\n                            label={lang}\r\n                            display='button'\r\n                            checked={isSelected}\r\n                            changeValue={value => value ? this.addLanguage(lang) : this.removeLanguage(lang)}\r\n                        />\r\n                    </div>\r\n                );\r\n            });\r\n\r\n        const allowGenerate = Object.keys(this.state.sources).length > 0;\r\n        const allowReset = allowGenerate || this.state.output.length > 0;\r\n\r\n        const output = [];\r\n        if (this.state.output.length > 0) {\r\n            output.push(\r\n                <div key='div' className='divider' />\r\n            );\r\n        }\r\n        for (let n = 0; n !== this.state.output.length; ++n) {\r\n            output.push(\r\n                <GeneratedText\r\n                    key={n}\r\n                    text={this.state.output[n]}\r\n                    languages={Object.keys(this.state.sources)}\r\n                />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='subheading'>presets</div>\r\n                <Selector\r\n                    options={presetOptions}\r\n                    selectedID={selectedPreset}\r\n                    select={optionID => this.usePreset(optionID)}\r\n                />\r\n                <div className='divider' />\r\n                <Expander\r\n                    text={'selected languages: ' + selectedLanguages}\r\n                    content={\r\n                        <div className='row collapse small-up-1 medium-up-2 large-up-3 language-options'>\r\n                            {languages}\r\n                        </div>\r\n                    }\r\n                />\r\n                <div className='divider' />\r\n                <ControlRow\r\n                    controls={[\r\n                        <button key='generate' className={allowGenerate ? '' : 'disabled'} onClick={() => this.generate()}>generate text</button>,\r\n                        <button key='reset' className={allowReset ? '' : 'disabled'} onClick={() => this.reset()}>reset</button>,\r\n                        <button key='random' onClick={() => this.random()}>random sources</button>\r\n                    ]}\r\n                />\r\n                <div className='language-output'>\r\n                    {output}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ninterface GeneratedTextProps {\r\n    text: string;\r\n    languages: string[];\r\n}\r\n\r\nclass GeneratedText extends React.Component<GeneratedTextProps> {\r\n    private copy(e: React.MouseEvent) {\r\n        e.preventDefault();\r\n        navigator.clipboard.writeText(this.props.text);\r\n    }\r\n\r\n    private say(e: React.MouseEvent) {\r\n        e.preventDefault();\r\n        Ustinov.say(this.props.text, this.props.languages);\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <Expander\r\n                text={this.props.text.toLowerCase()}\r\n                content={\r\n                    <div>\r\n                        <button onClick={e => this.copy(e)}>copy to clipboard</button>\r\n                        <button onClick={e => this.say(e)}>say</button>\r\n                        <div className='section'>\r\n                            <b>note:</b> speech may not work consistently on all platforms\r\n                        </div>\r\n                    </div>\r\n                }\r\n            />\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Shakespeare from '../../../utils/shakespeare';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    output: {\r\n        male: string[],\r\n        female: string[],\r\n        surname: string[]\r\n    };\r\n}\r\n\r\nexport default class NameModule extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            output: {\r\n                male: [],\r\n                female: [],\r\n                surname: []\r\n            }\r\n        };\r\n    }\r\n\r\n    private async generate(type: 'male' | 'female' | 'surname') {\r\n        const response = await fetch('./data/names/' + type + '.txt');\r\n        const input = await response.text();\r\n\r\n        Shakespeare.initModel([input]);\r\n        const names = Shakespeare.generate(10).map(n => n.line).sort();\r\n\r\n        this.state.output[type] = names;\r\n        this.setState({\r\n            output: this.state.output\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const male = [];\r\n        for (let n = 0; n !== this.state.output.male.length; ++n) {\r\n            male.push(\r\n                <div key={n} className='section'>\r\n                    {this.state.output.male[n].toLowerCase()}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        const female = [];\r\n        for (let n = 0; n !== this.state.output.female.length; ++n) {\r\n            female.push(\r\n                <div key={n} className='section'>\r\n                    {this.state.output.female[n].toLowerCase()}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        const surname = [];\r\n        for (let n = 0; n !== this.state.output.surname.length; ++n) {\r\n            surname.push(\r\n                <div key={n} className='section'>\r\n                    {this.state.output.surname[n].toLowerCase()}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <div className='name-output'>\r\n                    <div className='row'>\r\n                        <div className='columns small-4 medium-4 large-4'>\r\n                            <div className='heading'>male names</div>\r\n                            <button onClick={() => this.generate('male')}>generate</button>\r\n                            {male}\r\n                        </div>\r\n                        <div className='columns small-4 medium-4 large-4'>\r\n                            <div className='heading'>female names</div>\r\n                            <button onClick={() => this.generate('female')}>generate</button>\r\n                            {female}\r\n                        </div>\r\n                        <div className='columns small-4 medium-4 large-4'>\r\n                            <div className='heading'>surnames</div>\r\n                            <button onClick={() => this.generate('surname')}>generate</button>\r\n                            {surname}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Selector from '../controls/selector';\r\nimport DieRollerModule from './dm/die-roller-module';\r\nimport LanguageModule from './dm/language-module';\r\nimport NameModule from './dm/name-module';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    view: string;\r\n}\r\n\r\nexport default class DMTool extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            view: 'die'\r\n        };\r\n    }\r\n\r\n    private setView(view: string) {\r\n        this.setState({\r\n            view: view\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const options = [\r\n            {\r\n                id: 'die',\r\n                text: 'die roller'\r\n            },\r\n            {\r\n                id: 'language',\r\n                text: 'language generator'\r\n            },\r\n            {\r\n                id: 'name',\r\n                text: 'name generator'\r\n            }\r\n        ];\r\n\r\n        let content = null;\r\n        switch (this.state.view) {\r\n            case 'die':\r\n                content = (\r\n                    <DieRollerModule />\r\n                );\r\n                break;\r\n            case 'language':\r\n                content = (\r\n                    <LanguageModule />\r\n                );\r\n                break;\r\n            case 'name':\r\n                content = (\r\n                    <NameModule />\r\n                );\r\n                break;\r\n        }\r\n\r\n        return (\r\n            <div className='tools'>\r\n                <Selector\r\n                    options={options}\r\n                    selectedID={this.state.view}\r\n                    select={optionID => this.setView(optionID)}\r\n                />\r\n                <div className='divider' />\r\n                {content}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport ellipsis from '../../resources/icons/ellipsis.svg';\r\n\r\ninterface Props {\r\n    loaded: boolean;\r\n}\r\n\r\nexport default class LoadingWrapper extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            if (this.props.loaded) {\r\n                return this.props.children;\r\n            }\r\n\r\n            return (\r\n                <div className='loading-wrapper'>\r\n                    <img className='rotate-forever' src={ellipsis} alt='loading' />\r\n                </div>\r\n            );\r\n        } catch (ex) {\r\n            console.error(ex);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport Showdown from 'showdown';\r\n\r\nimport LoadingWrapper from '../../controls/loading-wrapper';\r\n\r\nconst showdown = new Showdown.Converter();\r\nshowdown.setOption('tables', true);\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    source: string | null;\r\n}\r\n\r\nexport default class ActionsModule extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            source: null\r\n        };\r\n    }\r\n\r\n    private async fetchData() {\r\n        const response = await fetch('./data/actions.md');\r\n        const text = await response.text();\r\n        this.setState({\r\n            source: text\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        if (!this.state.source) {\r\n            this.fetchData();\r\n        }\r\n\r\n        return (\r\n            <LoadingWrapper loaded={this.state.source !== null}>\r\n                <div dangerouslySetInnerHTML={{ __html: showdown.makeHtml(this.state.source || '') }} />\r\n            </LoadingWrapper>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\nimport Showdown from 'showdown';\r\n\r\nimport LoadingWrapper from '../../controls/loading-wrapper';\r\n\r\nconst showdown = new Showdown.Converter();\r\nshowdown.setOption('tables', true);\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    source: string | null;\r\n}\r\n\r\nexport default class ConditionsModule extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            source: null\r\n        };\r\n    }\r\n\r\n    private async fetchData() {\r\n        const response = await fetch('./data/conditions.md');\r\n        const text = await response.text();\r\n        this.setState({\r\n            source: text\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        if (!this.state.source) {\r\n            this.fetchData();\r\n        }\r\n\r\n        return (\r\n            <LoadingWrapper loaded={this.state.source !== null}>\r\n                <div dangerouslySetInnerHTML={{ __html: showdown.makeHtml(this.state.source || '') }} />\r\n            </LoadingWrapper>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\nimport Showdown from 'showdown';\r\n\r\nimport LoadingWrapper from '../../controls/loading-wrapper';\r\n\r\nconst showdown = new Showdown.Converter();\r\nshowdown.setOption('tables', true);\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    source: string | null;\r\n}\r\n\r\nexport default class SkillsModule extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            source: null\r\n        };\r\n    }\r\n\r\n    private async fetchData() {\r\n        const response = await fetch('./data/skills.md');\r\n        const text = await response.text();\r\n        this.setState({\r\n            source: text\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        if (!this.state.source) {\r\n            this.fetchData();\r\n        }\r\n\r\n        return (\r\n            <LoadingWrapper loaded={this.state.source !== null}>\r\n                <div dangerouslySetInnerHTML={{ __html: showdown.makeHtml(this.state.source || '') }} />\r\n            </LoadingWrapper>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Selector from '../controls/selector';\r\nimport ActionsModule from './reference/actions-module';\r\nimport ConditionsModule from './reference/conditions-module';\r\nimport SkillsModule from './reference/skills-module';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    //\r\n}\r\n\r\ninterface State {\r\n    view: string;\r\n}\r\n\r\nexport default class ReferenceTool extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            view: 'skills'\r\n        };\r\n    }\r\n\r\n    private setView(view: string) {\r\n        this.setState({\r\n            view: view\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const options = [\r\n            {\r\n                id: 'skills',\r\n                text: 'skills'\r\n            },\r\n            {\r\n                id: 'conditions',\r\n                text: 'conditions'\r\n            },\r\n            {\r\n                id: 'actions',\r\n                text: 'actions'\r\n            }\r\n        ];\r\n\r\n        let content = null;\r\n        switch (this.state.view) {\r\n            case 'skills':\r\n                content = (\r\n                    <SkillsModule />\r\n                );\r\n                break;\r\n            case 'conditions':\r\n                content = (\r\n                    <ConditionsModule />\r\n                );\r\n                break;\r\n            case 'actions':\r\n                content = (\r\n                    <ActionsModule />\r\n                );\r\n                break;\r\n        }\r\n\r\n        return (\r\n            <div className='reference'>\r\n                <Selector\r\n                    options={options}\r\n                    selectedID={this.state.view}\r\n                    select={optionID => this.setView(optionID)}\r\n                />\r\n                <div className='divider' />\r\n                {content}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Selector from '../controls/selector';\r\nimport AboutTool from '../tools/about-tool';\r\nimport DMTool from '../tools/dm-tool';\r\nimport ReferenceTool from '../tools/reference-tool';\r\n\r\ninterface Props {\r\n    resetAll: () => void;\r\n}\r\n\r\ninterface State {\r\n    view: string;\r\n}\r\n\r\nexport default class ToolsSidebar extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            view: 'ref'\r\n        };\r\n    }\r\n\r\n    private setView(view: string) {\r\n        this.setState({\r\n            view: view\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const options = [\r\n                {\r\n                    id: 'ref',\r\n                    text: 'reference'\r\n                },\r\n                {\r\n                    id: 'dm',\r\n                    text: 'dm tools'\r\n                },\r\n                {\r\n                    id: 'about',\r\n                    text: 'about'\r\n                }\r\n            ];\r\n\r\n            let content = null;\r\n            switch (this.state.view) {\r\n                case 'ref':\r\n                    content = <ReferenceTool />;\r\n                    break;\r\n                case 'dm':\r\n                    content = <DMTool />;\r\n                    break;\r\n                case 'about':\r\n                    content = <AboutTool resetAll={() => this.props.resetAll()} />;\r\n                    break;\r\n            }\r\n\r\n            return (\r\n                <div className='about'>\r\n                    <Selector\r\n                        tabs={true}\r\n                        options={options}\r\n                        selectedID={this.state.view}\r\n                        select={optionID => this.setView(optionID)}\r\n                    />\r\n                    {content}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Encounter } from '../../models/encounter';\r\nimport { MonsterGroup } from '../../models/monster-group';\r\nimport { Party } from '../../models/party';\r\n\r\ninterface Props {\r\n    view: string;\r\n    blur: boolean;\r\n    library: MonsterGroup[];\r\n    parties: Party[];\r\n    encounters: Encounter[];\r\n    setView: (view: string) => void;\r\n}\r\n\r\nexport default class Navbar extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            const partiesStyle = this.props.view === 'parties' ? 'navigator-item selected' : 'navigator-item';\r\n            const libraryStyle = this.props.view === 'library' ? 'navigator-item selected' : 'navigator-item';\r\n            let encounterStyle = this.props.view === 'encounter' ? 'navigator-item selected' : 'navigator-item';\r\n            const mapStyle = this.props.view === 'maps' ? 'navigator-item selected' : 'navigator-item';\r\n            let combatStyle = this.props.view === 'combat' ? 'navigator-item selected' : 'navigator-item';\r\n\r\n            const encountersEnabled = this.props.library.length !== 0;\r\n            const combatEnabled = (this.props.parties.length !== 0) && (this.props.encounters.length !== 0);\r\n            if (!encountersEnabled) {\r\n                encounterStyle += ' disabled';\r\n            }\r\n            if (!combatEnabled) {\r\n                combatStyle += ' disabled';\r\n            }\r\n\r\n            return (\r\n                <div className={this.props.blur ? 'navbar blur' : 'navbar'}>\r\n                    <div className={partiesStyle} onClick={() => this.props.setView('parties')}>player characters</div>\r\n                    <div className={libraryStyle} onClick={() => this.props.setView('library')}>monster library</div>\r\n                    <div className={encounterStyle} onClick={() => encountersEnabled ? this.props.setView('encounter') : null}>encounter builder</div>\r\n                    <div className={mapStyle} onClick={() => this.props.setView('maps')}>map folios</div>\r\n                    <div className={combatStyle} onClick={() => combatEnabled ? this.props.setView('combat') : null}>combat manager</div>\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport cog from '../../resources/icons/settings.svg';\r\n\r\ninterface Props {\r\n    actions: JSX.Element | null;\r\n    blur: boolean;\r\n    openHome: () => void;\r\n    openTools: () => void;\r\n}\r\n\r\nexport default class Titlebar extends React.Component<Props> {\r\n    public render() {\r\n        try {\r\n            return (\r\n                <div className={this.props.blur ? 'titlebar blur' : 'titlebar'}>\r\n                    <div className='app-name' onClick={() => this.props.openHome()}>dojo</div>\r\n                    {this.props.actions}\r\n                    <img className='tools-icon' src={cog} title='tools' alt='tools' onClick={() => this.props.openTools()} />\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\n\r\nimport Factory from '../utils/factory';\r\nimport Frankenstein from '../utils/frankenstein';\r\nimport Mercator from '../utils/mercator';\r\nimport Napoleon from '../utils/napoleon';\r\nimport Utils from '../utils/utils';\r\n\r\nimport { Combat, Combatant, CombatSetup, Notification } from '../models/combat';\r\nimport { Condition } from '../models/condition';\r\nimport { Encounter, EncounterSlot, EncounterWave, MonsterFilter } from '../models/encounter';\r\nimport { Map, MapFolio } from '../models/map-folio';\r\nimport { Monster, MonsterGroup } from '../models/monster-group';\r\nimport { Party, PC } from '../models/party';\r\n\r\nimport CombatManagerScreen from './screens/combat-manager-screen';\r\nimport EncounterBuilderScreen from './screens/encounter-builder-screen';\r\nimport HomeScreen from './screens/home-screen';\r\nimport MapFoliosScreen from './screens/map-folios-screen';\r\nimport MonsterLibraryScreen from './screens/monster-library-screen';\r\nimport PartiesScreen from './screens/parties-screen';\r\n\r\nimport AddCombatantsModal from './modals/add-combatants-modal';\r\nimport CombatStartModal from './modals/combat-start-modal';\r\nimport ConditionModal from './modals/condition-modal';\r\nimport DemographicsSidebar from './modals/demographics-sidebar';\r\nimport MapEditorModal from './modals/map-editor-modal';\r\nimport MonsterEditorModal from './modals/monster-editor-modal';\r\nimport PCEditorModal from './modals/pc-editor-modal';\r\nimport ToolsSidebar from './modals/tools-sidebar';\r\n\r\nimport Navbar from './panels/navbar';\r\nimport Titlebar from './panels/titlebar';\r\n\r\nimport Checkbox from './controls/checkbox';\r\nimport Menu from './controls/menu';\r\n\r\nimport close from '../resources/icons/x.svg';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\ninterface Props {\r\n    // No props; this is the root component\r\n}\r\n\r\ninterface State {\r\n    view: string;\r\n    modal: any;\r\n    filter: string;\r\n\r\n    parties: Party[];\r\n    library: MonsterGroup[];\r\n    encounters: Encounter[];\r\n    mapFolios: MapFolio[];\r\n    combats: Combat[];\r\n\r\n    selectedPartyID: string | null;\r\n    selectedMonsterGroupID: string | null;\r\n    selectedEncounterID: string | null;\r\n    selectedMapFolioID: string | null;\r\n    selectedCombatID: string | null;\r\n}\r\n\r\nexport default class Dojo extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            view: 'home',\r\n            modal: null,\r\n            filter: '',\r\n            parties: [],\r\n            library: [],\r\n            encounters: [],\r\n            mapFolios: [],\r\n            combats: [],\r\n            selectedPartyID: null,\r\n            selectedMonsterGroupID: null,\r\n            selectedEncounterID: null,\r\n            selectedMapFolioID: null,\r\n            selectedCombatID: null\r\n        };\r\n\r\n        try {\r\n            let data: State | null = null;\r\n\r\n            try {\r\n                const json = window.localStorage.getItem('data');\r\n                if (json) {\r\n                    data = JSON.parse(json);\r\n                }\r\n            } catch (ex) {\r\n                console.error('Could not parse JSON: ', ex);\r\n                data = null;\r\n            }\r\n\r\n            if (data !== null) {\r\n                data.parties.forEach(p => {\r\n                    p.pcs.forEach(pc => {\r\n                        if (pc.companions === undefined) {\r\n                            pc.companions = [];\r\n                        }\r\n                    });\r\n                });\r\n                data.library.forEach(g => {\r\n                    g.monsters.forEach(m => {\r\n                        m.traits.forEach(t => {\r\n                            if (t.uses === undefined) {\r\n                                t.uses = 0;\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n\r\n                data.encounters.forEach(enc => {\r\n                    if (!enc.waves) {\r\n                        enc.waves = [];\r\n                    }\r\n                });\r\n\r\n                if (!data.mapFolios) {\r\n                    data.mapFolios = [];\r\n                    data.selectedMapFolioID = null;\r\n                }\r\n\r\n                data.mapFolios.forEach(folio => {\r\n                    folio.maps.forEach(map => {\r\n                        map.items.forEach(item => {\r\n                            if (item.style === undefined) {\r\n                                item.style = null;\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n\r\n                data.combats.forEach(combat => {\r\n                    if (!combat.notifications) {\r\n                        combat.notifications = [];\r\n                    }\r\n                    combat.combatants.forEach(c => {\r\n                        if (c.showOnMap === undefined) {\r\n                            c.showOnMap = true;\r\n                        }\r\n\r\n                        if (c.altitude === undefined) {\r\n                            c.altitude = 0;\r\n                        }\r\n\r\n                        if (c.tags === undefined) {\r\n                            c.tags = [];\r\n                        }\r\n\r\n                        if (c.aura === undefined) {\r\n                            c.aura = { radius: 0, style: 'rounded', color: '#005080' };\r\n                        }\r\n\r\n                        if (c.type === 'monster') {\r\n                            const m = c as Combatant & Monster;\r\n                            m.traits.forEach(t => {\r\n                                if (t.uses === undefined) {\r\n                                    t.uses = 0;\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                });\r\n\r\n                data.view = 'home';\r\n                data.modal = null;\r\n                data.filter = '';\r\n\r\n                this.state = data;\r\n            }\r\n        } catch (ex) {\r\n            console.error(ex);\r\n        }\r\n    }\r\n\r\n    public componentDidUpdate() {\r\n        let json = null;\r\n        try {\r\n            json = JSON.stringify(this.state);\r\n        } catch (ex) {\r\n            console.error('Could not stringify data: ', ex);\r\n            json = null;\r\n        }\r\n\r\n        if (json !== null) {\r\n            window.localStorage.setItem('data', json);\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Party screen\r\n\r\n    private addParty() {\r\n        const party = Factory.createParty();\r\n        party.name = 'new party';\r\n        const parties: Party[] = ([] as Party[]).concat(this.state.parties, [party]);\r\n        Utils.sort(parties);\r\n        this.setState({\r\n            parties: parties,\r\n            selectedPartyID: party.id\r\n        });\r\n    }\r\n\r\n    private removeParty() {\r\n        const party = this.state.parties.find(p => p.id === this.state.selectedPartyID);\r\n        if (party) {\r\n            const index = this.state.parties.indexOf(party);\r\n            this.state.parties.splice(index, 1);\r\n            this.setState({\r\n                parties: this.state.parties,\r\n                selectedPartyID: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private addPC() {\r\n        const party = this.state.parties.find(p => p.id === this.state.selectedPartyID);\r\n        if (party) {\r\n            const pc = Factory.createPC();\r\n            pc.name = 'new pc';\r\n            party.pcs.push(pc);\r\n            this.setState({\r\n                parties: this.state.parties\r\n            });\r\n        }\r\n    }\r\n\r\n    private removePC(pc: PC) {\r\n        const party = this.state.parties.find(p => p.id === this.state.selectedPartyID);\r\n        if (party) {\r\n            const index = party.pcs.indexOf(pc);\r\n            party.pcs.splice(index, 1);\r\n            this.setState({\r\n                parties: this.state.parties\r\n            });\r\n        }\r\n    }\r\n\r\n    private sortPCs() {\r\n        const party = this.state.parties.find(p => p.id === this.state.selectedPartyID);\r\n        if (party) {\r\n            Utils.sort(party.pcs);\r\n            this.setState({\r\n                parties: this.state.parties\r\n            });\r\n        }\r\n    }\r\n\r\n    private editPC(pc: PC) {\r\n        const copy = JSON.parse(JSON.stringify(pc));\r\n        this.setState({\r\n            modal: {\r\n                type: 'pc',\r\n                pc: copy\r\n            }\r\n        });\r\n    }\r\n\r\n    private savePC() {\r\n        Utils.sort(this.state.modal.pc.companions);\r\n        const party = this.state.parties.find(p => p.id === this.state.selectedPartyID);\r\n        if (party) {\r\n            const original = party.pcs.find(pc => pc.id === this.state.modal.pc.id);\r\n            if (original) {\r\n                const index = party.pcs.indexOf(original);\r\n                party.pcs[index] = this.state.modal.pc;\r\n                this.setState({\r\n                    library: this.state.library,\r\n                    modal: null\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Library screen\r\n\r\n    private addMonsterGroup() {\r\n        const group = Factory.createMonsterGroup();\r\n        group.name = 'new group';\r\n        const library = ([] as MonsterGroup[]).concat(this.state.library, [group]);\r\n        Utils.sort(library);\r\n        this.setState({\r\n            library: library,\r\n            selectedMonsterGroupID: group.id\r\n        });\r\n    }\r\n\r\n    private removeMonsterGroup() {\r\n        const group = this.state.library.find(g => g.id === this.state.selectedMonsterGroupID);\r\n        if (group) {\r\n            const index = this.state.library.indexOf(group);\r\n            this.state.library.splice(index, 1);\r\n            this.setState({\r\n                library: this.state.library,\r\n                selectedMonsterGroupID: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private addMonster() {\r\n        const monster = Factory.createMonster();\r\n        monster.name = 'new monster';\r\n        const group = this.state.library.find(g => g.id === this.state.selectedMonsterGroupID);\r\n        if (group) {\r\n            group.monsters.push(monster);\r\n            this.setState({\r\n                library: this.state.library\r\n            });\r\n        }\r\n    }\r\n\r\n    private removeMonster(monster: Monster) {\r\n        const group = this.state.library.find(g => g.id === this.state.selectedMonsterGroupID);\r\n        if (group) {\r\n            const index = group.monsters.indexOf(monster);\r\n            group.monsters.splice(index, 1);\r\n            this.setState({\r\n                library: this.state.library\r\n            });\r\n        }\r\n    }\r\n\r\n    private sortMonsters() {\r\n        const group = this.state.library.find(g => g.id === this.state.selectedMonsterGroupID);\r\n        if (group) {\r\n            Utils.sort(group.monsters);\r\n            this.setState({\r\n                library: this.state.library\r\n            });\r\n        }\r\n    }\r\n\r\n    private moveToGroup(monster: Monster, groupID: string) {\r\n        const sourceGroup = this.state.library.find(group => group.monsters.includes(monster));\r\n        if (sourceGroup) {\r\n            const index = sourceGroup.monsters.indexOf(monster);\r\n            sourceGroup.monsters.splice(index, 1);\r\n\r\n            const group = this.state.library.find(g => g.id === groupID);\r\n            if (group) {\r\n                group.monsters.push(monster);\r\n                Utils.sort(group.monsters);\r\n\r\n                this.setState({\r\n                    library: this.state.library\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private editMonster(monster: Monster) {\r\n        const copy = JSON.parse(JSON.stringify(monster));\r\n        this.setState({\r\n            modal: {\r\n                type: 'monster',\r\n                monster: copy,\r\n                showSidebar: false\r\n            }\r\n        });\r\n    }\r\n\r\n    private saveMonster() {\r\n        const group = this.state.library.find(g => g.id === this.state.selectedMonsterGroupID);\r\n        if (group) {\r\n            const original = group.monsters.find(m => m.id === this.state.modal.monster.id);\r\n            if (original) {\r\n                // We are editing a monster\r\n                const index = group.monsters.indexOf(original);\r\n                group.monsters[index] = this.state.modal.monster;\r\n                this.setState({\r\n                    library: this.state.library,\r\n                    modal: null\r\n                });\r\n            } else {\r\n                // We are adding a new monster\r\n                group.monsters.push(this.state.modal.monster);\r\n                this.setState({\r\n                    library: this.state.library,\r\n                    modal: null\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private toggleShowSidebar() {\r\n        // eslint-disable-next-line\r\n        this.state.modal.showSidebar = !this.state.modal.showSidebar;\r\n        this.setState({\r\n            modal: this.state.modal\r\n        });\r\n    }\r\n\r\n    private openDemographics() {\r\n        this.setState({\r\n            modal: {\r\n                type: 'demographics'\r\n            }\r\n        });\r\n    }\r\n\r\n    private cloneMonster(monster: Monster, name: string) {\r\n        const group = this.state.library.find(g => g.monsters.includes(monster));\r\n        if (group) {\r\n            const clone = Frankenstein.clone(monster, name);\r\n            group.monsters.push(clone);\r\n            Utils.sort(group.monsters);\r\n\r\n            this.setState({\r\n                library: this.state.library\r\n            });\r\n        }\r\n    }\r\n\r\n    private addOpenGameContent() {\r\n        fetch('./data/monsters.json')\r\n            .then(response => response.json())\r\n            .then(json => {\r\n                json.forEach((data: any) => {\r\n                    try {\r\n                        if (data.name) {\r\n                            const monster = Frankenstein.createFromJSON(data);\r\n\r\n                            let groupName = monster.tag || monster.category;\r\n                            if (groupName.indexOf('swarm') === 0) {\r\n                                groupName = 'swarm';\r\n                            }\r\n                            if (groupName === 'any race') {\r\n                                groupName = 'npc';\r\n                            }\r\n\r\n                            let group = this.state.library.find(p => p.name === groupName);\r\n                            if (!group) {\r\n                                group = {\r\n                                    id: Utils.guid(),\r\n                                    name: groupName,\r\n                                    monsters: []\r\n                                };\r\n                                this.state.library.push(group);\r\n                            }\r\n                            group.monsters.push(monster);\r\n                        }\r\n                    } catch (e) {\r\n                        console.error(e);\r\n                    }\r\n                });\r\n\r\n                Utils.sort(this.state.library);\r\n\r\n                this.setState({\r\n                    view: 'library',\r\n                    library: this.state.library\r\n                });\r\n            });\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Encounter screen\r\n\r\n    private addEncounter() {\r\n        const encounter = Factory.createEncounter();\r\n        encounter.name = 'new encounter';\r\n        const encounters = ([] as Encounter[]).concat(this.state.encounters, [encounter]);\r\n        Utils.sort(encounters);\r\n\r\n        this.setState({\r\n            encounters: encounters,\r\n            selectedEncounterID: encounter.id\r\n        });\r\n    }\r\n\r\n    private clearEncounter() {\r\n        const encounter = this.state.encounters.find(e => e.id === this.state.selectedEncounterID);\r\n        if (encounter) {\r\n            encounter.slots = [];\r\n            encounter.waves = [];\r\n\r\n            this.setState({\r\n                encounters: this.state.encounters\r\n            });\r\n        }\r\n    }\r\n\r\n    private removeEncounter() {\r\n        const encounter = this.state.encounters.find(e => e.id === this.state.selectedEncounterID);\r\n        if (encounter) {\r\n            const index = this.state.encounters.indexOf(encounter);\r\n            this.state.encounters.splice(index, 1);\r\n\r\n            this.setState({\r\n                encounters: this.state.encounters,\r\n                selectedEncounterID: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private buildEncounter(xp: number, filter: MonsterFilter) {\r\n        const encounter = this.state.encounters.find(e => e.id === this.state.selectedEncounterID);\r\n        if (encounter) {\r\n            encounter.slots = [];\r\n            encounter.waves = [];\r\n\r\n            Napoleon.buildEncounter(encounter, xp, filter, this.state.library, (monsterName, groupName) => this.getMonster(monsterName, groupName));\r\n            this.sortEncounterSlots(encounter);\r\n\r\n            this.setState({\r\n                encounters: this.state.encounters\r\n            });\r\n        }\r\n    }\r\n\r\n    private addEncounterSlot(monster: Monster, waveID: string | null) {\r\n        const group = this.state.library.find(g => g.monsters.includes(monster));\r\n        if (group) {\r\n            const slot = Factory.createEncounterSlot();\r\n            slot.monsterGroupName = group.name;\r\n            slot.monsterName = monster.name;\r\n            const encounter = this.state.encounters.find(e => e.id === this.state.selectedEncounterID);\r\n            if (encounter) {\r\n                if (waveID !== null) {\r\n                    const wave = encounter.waves.find(w => w.id === waveID);\r\n                    if (wave) {\r\n                        wave.slots.push(slot);\r\n                        this.sortEncounterSlots(wave);\r\n                    }\r\n                } else {\r\n                    encounter.slots.push(slot);\r\n                    this.sortEncounterSlots(encounter);\r\n                }\r\n\r\n                this.setState({\r\n                    encounters: this.state.encounters\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private removeEncounterSlot(slot: EncounterSlot, waveID: string | null) {\r\n        const encounter = this.state.encounters.find(e => e.id === this.state.selectedEncounterID);\r\n        if (encounter) {\r\n            if (waveID) {\r\n                const wave = encounter.waves.find(w => w.id === waveID);\r\n                if (wave) {\r\n                    const index = wave.slots.indexOf(slot);\r\n                    wave.slots.splice(index, 1);\r\n                }\r\n            } else {\r\n                const n = encounter.slots.indexOf(slot);\r\n                encounter.slots.splice(n, 1);\r\n            }\r\n\r\n            this.setState({\r\n                encounters: this.state.encounters\r\n            });\r\n        }\r\n    }\r\n\r\n    private sortEncounterSlots(slotContainer: { slots: EncounterSlot[] }) {\r\n        slotContainer.slots.sort((a, b) => {\r\n            const aName = a.monsterName.toLowerCase();\r\n            const bName = b.monsterName.toLowerCase();\r\n            if (aName < bName) { return -1; }\r\n            if (aName > bName) { return 1; }\r\n            return 0;\r\n        });\r\n    }\r\n\r\n    private addWaveToEncounter() {\r\n        const encounter = this.state.encounters.find(e => e.id === this.state.selectedEncounterID);\r\n        if (encounter) {\r\n            const wave = Factory.createEncounterWave();\r\n            wave.name = 'wave ' + (encounter.waves.length + 2);\r\n            encounter.waves.push(wave);\r\n\r\n            this.setState({\r\n                encounters: this.state.encounters\r\n            });\r\n        }\r\n    }\r\n\r\n    private removeWave(wave: EncounterWave) {\r\n        const encounter = this.state.encounters.find(e => e.id === this.state.selectedEncounterID);\r\n        if (encounter) {\r\n            const index = encounter.waves.indexOf(wave);\r\n            encounter.waves.splice(index, 1);\r\n\r\n            this.setState({\r\n                encounters: this.state.encounters\r\n            });\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Map screen\r\n\r\n    private addMapFolio() {\r\n        const folio = Factory.createMapFolio();\r\n        folio.name = 'new folio';\r\n        const folios = ([] as MapFolio[]).concat(this.state.mapFolios, [folio]);\r\n        Utils.sort(folios);\r\n\r\n        this.setState({\r\n            mapFolios: folios,\r\n            selectedMapFolioID: folio.id\r\n        });\r\n    }\r\n\r\n    private removeMapFolio() {\r\n        const folio = this.state.mapFolios.find(f => f.id === this.state.selectedMapFolioID);\r\n        if (folio) {\r\n            const index = this.state.mapFolios.indexOf(folio);\r\n            this.state.mapFolios.splice(index, 1);\r\n\r\n            this.setState({\r\n                mapFolios: this.state.mapFolios,\r\n                selectedMapFolioID: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private addMap() {\r\n        const folio = this.state.mapFolios.find(f => f.id === this.state.selectedMapFolioID);\r\n        if (folio) {\r\n            const map = Factory.createMap();\r\n            map.name = 'new map';\r\n            folio.maps.push(map);\r\n\r\n            this.setState({\r\n                mapFolios: this.state.mapFolios\r\n            });\r\n        }\r\n    }\r\n\r\n    private editMap(map: Map) {\r\n        const copy = JSON.parse(JSON.stringify(map));\r\n        this.setState({\r\n            modal: {\r\n                type: 'map',\r\n                map: copy\r\n            }\r\n        });\r\n    }\r\n\r\n    private saveMap() {\r\n        const folio = this.state.mapFolios.find(f => f.id === this.state.selectedMapFolioID);\r\n        if (folio) {\r\n            const original = folio.maps.find(m => m.id === this.state.modal.map.id);\r\n            if (original) {\r\n                const index = folio.maps.indexOf(original);\r\n                folio.maps[index] = this.state.modal.map;\r\n                this.setState({\r\n                    mapFolios: this.state.mapFolios,\r\n                    modal: null\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private removeMap(map: Map) {\r\n        const folio = this.state.mapFolios.find(f => f.id === this.state.selectedMapFolioID);\r\n        if (folio) {\r\n            const index = folio.maps.indexOf(map);\r\n            folio.maps.splice(index, 1);\r\n            this.setState({\r\n                mapFolios: this.state.mapFolios\r\n            });\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Combat screen\r\n\r\n    private createCombat() {\r\n        const party = this.state.parties.length === 1 ? this.state.parties[0] : null;\r\n        const encounter = this.state.encounters.length === 1 ? this.state.encounters[0] : null;\r\n\r\n        const setup = Factory.createCombatSetup();\r\n        setup.partyID = party ? party.id : null;\r\n        setup.encounterID = encounter ? encounter.id : null;\r\n        if (encounter) {\r\n            setup.monsterNames = Utils.getMonsterNames(encounter);\r\n        }\r\n\r\n        this.setState({\r\n            modal: {\r\n                type: 'combat-start',\r\n                combatSetup: setup\r\n            }\r\n        });\r\n    }\r\n\r\n    private startCombat() {\r\n        const combatSetup: CombatSetup = this.state.modal.combatSetup;\r\n        const party = this.state.parties.find(p => p.id === combatSetup.partyID);\r\n        const encounter = this.state.encounters.find(e => e.id === combatSetup.encounterID);\r\n        if (party && encounter) {\r\n            const partyName = party.name || 'unnamed party';\r\n            const encounterName = encounter.name || 'unnamed encounter';\r\n\r\n            const combat = Factory.createCombat();\r\n            combat.name = partyName + ' vs ' + encounterName;\r\n            combat.encounterID = encounter.id;\r\n\r\n            // Add a copy of each PC to the encounter\r\n            party.pcs.filter(pc => pc.active).forEach(pc => {\r\n                this.addPCToCombat(pc, combat);\r\n            });\r\n\r\n            encounter.slots.forEach(slot => {\r\n                const monster = this.getMonster(slot.monsterName, slot.monsterGroupName);\r\n                if (monster) {\r\n                    const groupInitRoll = Utils.dieRoll();\r\n\r\n                    for (let n = 0; n !== slot.count; ++n) {\r\n                        let displayName = null;\r\n                        if (combatSetup.monsterNames) {\r\n                            const slotNames = combatSetup.monsterNames.find(names => names.id === slot.id);\r\n                            if (slotNames) {\r\n                                displayName = slotNames.names[n];\r\n                            }\r\n                        }\r\n\r\n                        this.addMonsterToCombat(monster, combat, displayName, combatSetup.encounterInitMode, groupInitRoll);\r\n                    }\r\n                } else {\r\n                    combat.issues.push('unknown monster: ' + slot.monsterName + ' in group ' + slot.monsterGroupName);\r\n                }\r\n            });\r\n\r\n            this.sortCombatants(combat);\r\n\r\n            if (combatSetup.folioID && combatSetup.mapID) {\r\n                const folio = this.state.mapFolios.find(f => f.id === combatSetup.folioID);\r\n                if (folio) {\r\n                    const map = folio.maps.find(m => m.id === combatSetup.mapID);\r\n                    if (map) {\r\n                        combat.map = JSON.parse(JSON.stringify(map));\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.setState({\r\n                combats: ([] as Combat[]).concat(this.state.combats, [combat]),\r\n                selectedCombatID: combat.id,\r\n                modal: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private addPCToCombat(pc: PC, combat: Combat) {\r\n        const combatant = JSON.parse(JSON.stringify(pc));\r\n\r\n        combatant.current = false;\r\n        combatant.pending = true;\r\n        combatant.active = false;\r\n        combatant.defeated = false;\r\n\r\n        combatant.displayName = pc.name;\r\n        combatant.displaySize = 'medium';\r\n        combatant.showOnMap = true;\r\n        combatant.initiative = 10;\r\n        combatant.hp = null;\r\n        combatant.conditions = [];\r\n        combatant.tags = [];\r\n        combatant.altitude = 0;\r\n        combatant.aura = { radius: 0, style: 'rounded', color: '#005080' };\r\n\r\n        combat.combatants.push(combatant);\r\n    }\r\n\r\n    private addMonsterToCombat(\r\n        monster: Monster,\r\n        combat: Combat, displayName: string | null = null,\r\n        initMode: 'manual' | 'individual' | 'group' = 'individual',\r\n        groupInitRoll: number = 0) {\r\n\r\n        const combatant = JSON.parse(JSON.stringify(monster));\r\n        combatant.id = Utils.guid();\r\n\r\n        switch (initMode) {\r\n            case 'group':\r\n                combatant.initiative = Utils.modifierValue(monster.abilityScores.dex) + groupInitRoll;\r\n                break;\r\n            case 'individual':\r\n                combatant.initiative = Utils.modifierValue(monster.abilityScores.dex) + Utils.dieRoll();\r\n                break;\r\n            default:\r\n                combatant.initiative = 10;\r\n                break;\r\n        }\r\n\r\n        combatant.current = false;\r\n        combatant.pending = (initMode === 'manual');\r\n        combatant.active = (initMode !== 'manual');\r\n        combatant.defeated = false;\r\n\r\n        combatant.displayName = displayName;\r\n        combatant.displaySize = monster.size;\r\n        combatant.showOnMap = true;\r\n        combatant.hp = combatant.hpMax;\r\n        combatant.conditions = [];\r\n        combatant.tags = [];\r\n        combatant.altitude = 0;\r\n        combatant.aura = { radius: 0, style: 'rounded', color: '#005080' };\r\n\r\n        combat.combatants.push(combatant);\r\n    }\r\n\r\n    private openWaveModal() {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            const encounter = this.state.encounters.find(e => e.id === combat.encounterID);\r\n            if (encounter) {\r\n                const setup = Factory.createCombatSetup();\r\n                setup.encounterID = combat.encounterID;\r\n                setup.monsterNames = Utils.getMonsterNames(encounter);\r\n\r\n                this.setState({\r\n                    modal: {\r\n                        type: 'combat-wave',\r\n                        combatSetup: setup\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private addToEncounter() {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            this.setState({\r\n                modal: {\r\n                    type: 'combat-add-combatants',\r\n                    combatantSlots: [],\r\n                    combat: combat\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private addCombatantsFromModal() {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            this.state.modal.combatantSlots.forEach((slot: EncounterSlot) => {\r\n                const m = this.getMonster(slot.monsterName, slot.monsterGroupName);\r\n                if (m) {\r\n                    const roll = Utils.dieRoll();\r\n                    for (let n = 0; n !== slot.count; ++n) {\r\n                        let displayName = m.name;\r\n                        if (slot.count > 1) {\r\n                            displayName += ' ' + (n + 1);\r\n                        }\r\n                        this.addMonsterToCombat(m, combat, displayName, 'group', roll);\r\n                    }\r\n                }\r\n            });\r\n\r\n            this.sortCombatants(combat);\r\n\r\n            this.setState({\r\n                combats: this.state.combats,\r\n                modal: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private pauseCombat() {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            combat.timestamp = new Date().toLocaleString();\r\n            this.setState({\r\n                combats: this.state.combats,\r\n                selectedCombatID: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private resumeCombat(combat: Combat) {\r\n        this.setState({\r\n            selectedCombatID: combat.id\r\n        });\r\n    }\r\n\r\n    private endCombat() {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            const index = this.state.combats.indexOf(combat);\r\n            this.state.combats.splice(index, 1);\r\n            this.setState({\r\n                combats: this.state.combats,\r\n                selectedCombatID: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private makeCurrent(combatant: (Combatant & PC) | (Combatant & Monster) | null, newRound: boolean) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            // Handle start-of-turn conditions\r\n            combat.combatants.filter(actor => actor.conditions).forEach(actor => {\r\n                actor.conditions.forEach(c => {\r\n                    if (c.duration) {\r\n                        switch (c.duration.type) {\r\n                            case 'saves':\r\n                                // If it's my condition, and point is START, notify the user\r\n                                if (combat && combatant && (actor.id === combatant.id) && (c.duration.point === 'start')) {\r\n                                    combat.notifications.push({\r\n                                        id: Utils.guid(),\r\n                                        type: 'condition-save',\r\n                                        data: c,\r\n                                        combatant: combatant as Combatant & Monster\r\n                                    });\r\n                                }\r\n                                break;\r\n                            case 'combatant':\r\n                                // If this refers to me, and point is START, remove it\r\n                                if (combat && combatant && (c.duration.combatantID === combatant.id) && (c.duration.point === 'start')) {\r\n                                    const index = actor.conditions.indexOf(c);\r\n                                    actor.conditions.splice(index, 1);\r\n                                    // Notify the user\r\n                                    combat.notifications.push({\r\n                                        id: Utils.guid(),\r\n                                        type: 'condition-end',\r\n                                        data: c,\r\n                                        combatant: combatant as Combatant & Monster\r\n                                    });\r\n                                }\r\n                                break;\r\n                            case 'rounds':\r\n                                // If it's my condition, decrement the condition\r\n                                if (combatant && (actor.id === combatant.id)) {\r\n                                    c.duration.count -= 1;\r\n                                }\r\n                                // If it's now at 0, remove it\r\n                                if (c.duration.count === 0) {\r\n                                    const n = actor.conditions.indexOf(c);\r\n                                    actor.conditions.splice(n, 1);\r\n                                    if (combat) {\r\n                                        // Notify the user\r\n                                        combat.notifications.push({\r\n                                            id: Utils.guid(),\r\n                                            type: 'condition-end',\r\n                                            data: c,\r\n                                            combatant: combatant as Combatant & Monster\r\n                                        });\r\n                                    }\r\n                                }\r\n                                break;\r\n                            default:\r\n                                // Do nothing\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            // Handle recharging traits\r\n            if (combatant && (combatant.type === 'monster')) {\r\n                (combatant as Monster).traits\r\n                    .filter(t => (t.uses > 0) && t.usage.toLowerCase().startsWith('recharge '))\r\n                    .forEach(t => {\r\n                        combat.notifications.push({\r\n                            id: Utils.guid(),\r\n                            type: 'trait-recharge',\r\n                            data: t,\r\n                            combatant: combatant as Combatant & Monster\r\n                        });\r\n                    });\r\n                (combatant as Monster).traits\r\n                    .filter(t => t.type === 'legendary')\r\n                    .forEach(t => {\r\n                        t.uses = 0;\r\n                    });\r\n            }\r\n\r\n            combat.combatants.forEach(c => {\r\n                c.current = false;\r\n            });\r\n            if (combatant) {\r\n                combatant.current = true;\r\n            }\r\n\r\n            if (newRound) {\r\n                combat.round += 1;\r\n            }\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private makeActive(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            combatant.pending = false;\r\n            combatant.active = true;\r\n            combatant.defeated = false;\r\n\r\n            this.sortCombatants(combat);\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private makeDefeated(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        combatant.pending = false;\r\n        combatant.active = false;\r\n        combatant.defeated = true;\r\n\r\n        if (combatant.type === 'monster') {\r\n            // If this monster is on the map, remove them from it\r\n            const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n            if (combat && combat.map) {\r\n                combat.map.items = combat.map.items.filter(item => item.id !== combatant.id);\r\n            }\r\n        }\r\n\r\n        if (combatant.current) {\r\n            this.endTurn(combatant);\r\n        } else {\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private addWaveToCombat() {\r\n        const combatSetup: CombatSetup = this.state.modal.combatSetup;\r\n        const encounter = this.state.encounters.find(e => e.id === combatSetup.encounterID);\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combatSetup && encounter && combat) {\r\n            const wave = encounter.waves.find(w => w.id === combatSetup.waveID);\r\n            if (wave) {\r\n                wave.slots.forEach(slot => {\r\n                    const monster = this.getMonster(slot.monsterName, slot.monsterGroupName);\r\n                    if (monster) {\r\n                        const init = parseInt(Utils.modifier(monster.abilityScores.dex), 10);\r\n                        const groupRoll = Utils.dieRoll();\r\n\r\n                        for (let n = 0; n !== slot.count; ++n) {\r\n                            const singleRoll = Utils.dieRoll();\r\n\r\n                            const combatant = JSON.parse(JSON.stringify(monster));\r\n                            combatant.id = Utils.guid();\r\n\r\n                            combatant.displayName = null;\r\n                            if (combatSetup.monsterNames) {\r\n                                const slotNames = combatSetup.monsterNames.find(names => names.id === slot.id);\r\n                                if (slotNames) {\r\n                                    combatant.displayName = slotNames.names[n];\r\n                                }\r\n                            }\r\n\r\n                            combatant.displaySize = monster.size;\r\n\r\n                            switch (combatSetup.encounterInitMode) {\r\n                                case 'manual':\r\n                                    combatant.initiative = 10;\r\n                                    break;\r\n                                case 'group':\r\n                                    combatant.initiative = init + groupRoll;\r\n                                    break;\r\n                                case 'individual':\r\n                                    combatant.initiative = init + singleRoll;\r\n                                    break;\r\n                                default:\r\n                                    // Do nothing\r\n                                    break;\r\n                            }\r\n\r\n                            combatant.showOnMap = true;\r\n                            combatant.current = false;\r\n                            combatant.pending = (this.state.modal.combatSetup.encounterInitMode === 'manual');\r\n                            combatant.active = (this.state.modal.combatSetup.encounterInitMode !== 'manual');\r\n                            combatant.defeated = false;\r\n\r\n                            combatant.hp = combatant.hpMax;\r\n                            combatant.conditions = [];\r\n                            combatant.tags = [];\r\n                            combatant.altitude = 0;\r\n                            combatant.aura = { radius: 0, style: 'rounded', color: '#005080' };\r\n\r\n                            if (combat) {\r\n                                combat.combatants.push(combatant);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        if (combat) {\r\n                            const issue = 'unknown monster: ' + slot.monsterName + ' in group ' + slot.monsterGroupName;\r\n                            combat.issues.push(issue);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                this.sortCombatants(combat);\r\n\r\n                this.setState({\r\n                    combats: this.state.combats,\r\n                    modal: null\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private removeCombatant(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            const index = combat.combatants.indexOf(combatant);\r\n            combat.combatants.splice(index, 1);\r\n\r\n            if (combat.map) {\r\n                const item = combat.map.items.find(i => i.id === combatant.id);\r\n                if (item) {\r\n                    const n = combat.map.items.indexOf(item);\r\n                    combat.map.items.splice(n, 1);\r\n                }\r\n            }\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private mapAdd(combatant: ((Combatant & PC) | (Combatant & Monster)), x: number, y: number) {\r\n        const item = Factory.createMapItem();\r\n        item.id = combatant.id;\r\n        item.type = combatant.type as 'pc' | 'monster';\r\n        item.x = x;\r\n        item.y = y;\r\n        let size = 1;\r\n        if (combatant.type === 'monster') {\r\n            size = Utils.miniSize((combatant as Monster).size);\r\n        }\r\n        item.height = size;\r\n        item.width = size;\r\n\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat && combat.map) {\r\n            combat.map.items.push(item);\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private mapMove(combatant: (Combatant & PC) | (Combatant & Monster), dir: string) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat && combat.map) {\r\n            const item = combat.map.items.find(i => i.id === combatant.id);\r\n            if (item) {\r\n                switch (dir) {\r\n                    case 'N':\r\n                        item.y -= 1;\r\n                        break;\r\n                    case 'NE':\r\n                        item.x += 1;\r\n                        item.y -= 1;\r\n                        break;\r\n                    case 'E':\r\n                        item.x += 1;\r\n                        break;\r\n                    case 'SE':\r\n                        item.x += 1;\r\n                        item.y += 1;\r\n                        break;\r\n                    case 'S':\r\n                        item.y += 1;\r\n                        break;\r\n                    case 'SW':\r\n                        item.x -= 1;\r\n                        item.y += 1;\r\n                        break;\r\n                    case 'W':\r\n                        item.x -= 1;\r\n                        break;\r\n                    case 'NW':\r\n                        item.x -= 1;\r\n                        item.y -= 1;\r\n                        break;\r\n                    default:\r\n                        // Do nothing\r\n                        break;\r\n                }\r\n\r\n                this.setState({\r\n                    combats: this.state.combats\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private mapRemove(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat && combat.map) {\r\n            const item = combat.map.items.find(i => i.id === combatant.id);\r\n            if (item) {\r\n                const index = combat.map.items.indexOf(item);\r\n                combat.map.items.splice(index, 1);\r\n\r\n                this.setState({\r\n                    combats: this.state.combats\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private endTurn(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            // Handle end-of-turn conditions\r\n            combat.combatants.filter(actor => actor.conditions).forEach(actor => {\r\n                actor.conditions.forEach(c => {\r\n                    if (c.duration) {\r\n                        switch (c.duration.type) {\r\n                            case 'saves':\r\n                                // If it's my condition, and point is END, notify the user\r\n                                if (combat && (actor.id === combatant.id) && (c.duration.point === 'end')) {\r\n                                    const saveNotification = Factory.createNotification();\r\n                                    saveNotification.type = 'condition-save';\r\n                                    saveNotification.data = c;\r\n                                    saveNotification.combatant = combatant as Combatant & Monster;\r\n                                    combat.notifications.push(saveNotification);\r\n                                }\r\n                                break;\r\n                            case 'combatant':\r\n                                // If this refers to me, and point is END, remove it\r\n                                if (combat && (c.duration.combatantID === combatant.id) && (c.duration.point === 'end')) {\r\n                                    const n = actor.conditions.indexOf(c);\r\n                                    actor.conditions.splice(n, 1);\r\n                                    // Notify the user\r\n                                    const endNotification = Factory.createNotification();\r\n                                    endNotification.type = 'condition-end';\r\n                                    endNotification.data = c;\r\n                                    endNotification.combatant = combatant as Combatant & Monster;\r\n                                    combat.notifications.push(endNotification);\r\n                                }\r\n                                break;\r\n                            case 'rounds':\r\n                                // We check this at the beginning of each turn, not at the end\r\n                                break;\r\n                            default:\r\n                                // Do nothing\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            const active = combat.combatants.filter(c => {\r\n                return c.current || (!c.pending && c.active && !c.defeated);\r\n            });\r\n            if (active.length === 0) {\r\n                // There's no-one left in the fight\r\n                this.makeCurrent(null, false);\r\n            } else if ((active.length === 1) && (active[0].defeated)) {\r\n                // The only person in the fight is me, and I'm defeated\r\n                this.makeCurrent(null, false);\r\n            } else {\r\n                let index = active.indexOf(combatant) + 1;\r\n                let newRound = false;\r\n                if (index >= active.length) {\r\n                    index = 0;\r\n                    newRound = true;\r\n                }\r\n                this.makeCurrent(active[index], newRound);\r\n            }\r\n        }\r\n    }\r\n\r\n    private changeHP(combatant: Combatant & Monster, hp: number, temp: number) {\r\n        combatant.hp = hp;\r\n        combatant.hpTemp = temp;\r\n\r\n        this.setState({\r\n            combats: this.state.combats\r\n        });\r\n    }\r\n\r\n    private addCondition(combatant: (Combatant & PC) | (Combatant & Monster)) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            const condition = Factory.createCondition();\r\n            condition.name = 'blinded';\r\n\r\n            this.setState({\r\n                modal: {\r\n                    type: 'condition-add',\r\n                    condition: condition,\r\n                    combatant: combatant,\r\n                    combat: combat\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private addConditionFromModal() {\r\n        this.state.modal.combatant.conditions.push(this.state.modal.condition);\r\n\r\n        this.setState({\r\n            combats: this.state.combats,\r\n            modal: null\r\n        });\r\n    }\r\n\r\n    private editCondition(combatant: (Combatant & PC) | (Combatant & Monster), condition: Condition) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            this.setState({\r\n                modal: {\r\n                    type: 'condition-edit',\r\n                    condition: condition,\r\n                    combatant: combatant,\r\n                    combat: combat\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private editConditionFromModal() {\r\n        const conditions: Condition[] = this.state.modal.combatant.conditions;\r\n        const original = conditions.find(c => c.id === this.state.modal.condition.id);\r\n        if (original) {\r\n            const index = conditions.indexOf(original);\r\n            // eslint-disable-next-line\r\n            conditions[index] = this.state.modal.condition;\r\n\r\n            this.setState({\r\n                combats: this.state.combats,\r\n                modal: null\r\n            });\r\n        }\r\n    }\r\n\r\n    private removeCondition(combatant: (Combatant & PC) | (Combatant & Monster), conditionID: string) {\r\n        const condition = combatant.conditions.find(c => c.id === conditionID);\r\n        if (condition) {\r\n            const index = combatant.conditions.indexOf(condition);\r\n            combatant.conditions.splice(index, 1);\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private sortCombatants(combat: Combat) {\r\n        combat.combatants.sort((a, b) => {\r\n            // First sort by initiative, descending\r\n            if (a.initiative && b.initiative && (a.initiative < b.initiative)) { return 1; }\r\n            if (a.initiative && b.initiative && (a.initiative > b.initiative)) { return -1; }\r\n            // Then sort by name, ascending\r\n            if (a.name < b.name) { return -1; }\r\n            if (a.name > b.name) { return 1; }\r\n            return 0;\r\n        });\r\n    }\r\n\r\n    private closeNotification(notification: Notification, removeCondition: boolean) {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat) {\r\n            const index = combat.notifications.indexOf(notification);\r\n            combat.notifications.splice(index, 1);\r\n\r\n            if (removeCondition && notification.combatant && notification.data) {\r\n                const conditionIndex = notification.combatant.conditions.indexOf(notification.data as Condition);\r\n                notification.combatant.conditions.splice(conditionIndex, 1);\r\n            }\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private toggleTag(combatant: Combatant, tag: string) {\r\n        if (combatant.tags.includes(tag)) {\r\n            combatant.tags = combatant.tags.filter(t => t !== tag);\r\n        } else {\r\n            combatant.tags.push(tag);\r\n        }\r\n\r\n        this.setState({\r\n            combats: this.state.combats\r\n        });\r\n    }\r\n\r\n    private scatterCombatants(type: 'pc' | 'monster') {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat && combat.map) {\r\n            Mercator.scatterCombatants(combat, type);\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    private rotateMap() {\r\n        const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n        if (combat && combat.map) {\r\n            Mercator.rotateMap(combat.map);\r\n\r\n            this.setState({\r\n                combats: this.state.combats\r\n            });\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    private setView(view: string) {\r\n        this.setState({\r\n            view: view\r\n        });\r\n    }\r\n\r\n    private openToolsSidebar() {\r\n        this.setState({\r\n            modal: {\r\n                type: 'tools-sidebar'\r\n            }\r\n        });\r\n    }\r\n\r\n    private closeModal() {\r\n        this.setState({\r\n            modal: null\r\n        });\r\n    }\r\n\r\n    private selectParty(party: Party | null) {\r\n        this.setState({\r\n            selectedPartyID: party ? party.id : null\r\n        });\r\n    }\r\n\r\n    private selectMonsterGroup(group: MonsterGroup | null) {\r\n        this.setState({\r\n            selectedMonsterGroupID: group ? group.id : null\r\n        });\r\n    }\r\n\r\n    private selectEncounter(encounter: Encounter | null) {\r\n        this.setState({\r\n            selectedEncounterID: encounter ? encounter.id : null\r\n        });\r\n    }\r\n\r\n    private selectMapFolio(mapFolio: MapFolio | null) {\r\n        this.setState({\r\n            selectedMapFolioID: mapFolio ? mapFolio.id : null\r\n        });\r\n    }\r\n\r\n    private resetAll() {\r\n        this.setState({\r\n            parties: [],\r\n            selectedPartyID: null,\r\n            library: [],\r\n            selectedMonsterGroupID: null,\r\n            encounters: [],\r\n            selectedEncounterID: null,\r\n            mapFolios: [],\r\n            selectedMapFolioID: null,\r\n            combats: [],\r\n            selectedCombatID: null\r\n        });\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    private getMonster(monsterName: string, groupName: string) {\r\n        const group = this.state.library.find(p => p.name === groupName);\r\n        if (group) {\r\n            const monster = group.monsters.find(m => m.name === monsterName);\r\n            if (monster) {\r\n                return monster;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private changeValue(combatant: any, type: string, value: any) {\r\n        switch (type) {\r\n            case 'hp':\r\n                value = Math.min(value, combatant.hpMax);\r\n                value = Math.max(value, 0);\r\n                break;\r\n            case 'hpTemp':\r\n                value = Math.max(value, 0);\r\n                break;\r\n            case 'level':\r\n                value = Math.max(value, 1);\r\n                value = (combatant.player !== undefined) ? Math.min(value, 20) : Math.min(value, 6);\r\n                break;\r\n            case 'count':\r\n                value = Math.max(value, 1);\r\n                break;\r\n            case 'hitDice':\r\n                value = Math.max(value, 1);\r\n                break;\r\n            default:\r\n                // Do nothing\r\n                break;\r\n        }\r\n\r\n        const tokens = type.split('.');\r\n        let obj = combatant;\r\n        for (let n = 0; n !== tokens.length; ++n) {\r\n            const token = tokens[n];\r\n            if (n === tokens.length - 1) {\r\n                obj[token] = value;\r\n            } else {\r\n                obj = obj[token];\r\n            }\r\n        }\r\n\r\n        Utils.sort(this.state.parties);\r\n        Utils.sort(this.state.library);\r\n        Utils.sort(this.state.encounters);\r\n\r\n        if (type === 'initiative') {\r\n            if (!(combatant as Combatant).pending) {\r\n                const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n                this.sortCombatants(combat as Combat);\r\n            }\r\n        }\r\n\r\n        this.setState({\r\n            parties: this.state.parties,\r\n            library: this.state.library,\r\n            encounters: this.state.encounters,\r\n            combats: this.state.combats,\r\n            selectedPartyID: this.state.selectedPartyID,\r\n            selectedMonsterGroupID: this.state.selectedMonsterGroupID,\r\n            selectedEncounterID: this.state.selectedEncounterID,\r\n            selectedCombatID: this.state.selectedCombatID,\r\n            modal: this.state.modal\r\n        });\r\n    }\r\n\r\n    private nudgeValue(combatant: any, type: string, delta: number) {\r\n        const tokens = type.split('.');\r\n        let obj = combatant;\r\n        for (let n = 0; n !== tokens.length; ++n) {\r\n            const token = tokens[n];\r\n            if (n === tokens.length - 1) {\r\n                let value = null;\r\n                switch (token) {\r\n                    case 'challenge':\r\n                        value = Utils.nudgeChallenge(obj[token], delta);\r\n                        break;\r\n                    case 'size':\r\n                    case 'displaySize':\r\n                        value = Utils.nudgeSize(obj[token], delta);\r\n                        break;\r\n                    default:\r\n                        value = obj[token] + delta;\r\n                }\r\n                this.changeValue(combatant, type, value);\r\n            } else {\r\n                obj = obj[token];\r\n            }\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    private getActions() {\r\n        switch (this.state.view) {\r\n            case 'parties':\r\n            case 'encounter':\r\n            case 'maps':\r\n                return (\r\n                    <div className='actions'>\r\n                        <div className='section'>\r\n                            <input\r\n                                type='text'\r\n                                placeholder='search'\r\n                                value={this.state.filter}\r\n                                onChange={event => this.changeValue(this.state, 'filter', event.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                );\r\n            case 'library':\r\n                return (\r\n                    <div className='actions'>\r\n                        <div className='section'>\r\n                            <button onClick={() => this.openDemographics()}>demographics</button>\r\n                        </div>\r\n                        <div className='section'>\r\n                            <input\r\n                                type='text'\r\n                                placeholder='search'\r\n                                value={this.state.filter}\r\n                                onChange={event => this.changeValue(this.state, 'filter', event.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                );\r\n            case 'combat':\r\n                const combat = this.state.combats.find(c => c.id === this.state.selectedCombatID);\r\n                if (combat) {\r\n                    let xp = 0;\r\n                    let allowWave = false;\r\n                    const encounter = this.state.encounters.find(e => e.id === combat.encounterID);\r\n                    if (encounter) {\r\n                        combat.combatants.filter(c => c.type === 'monster')\r\n                            .forEach(combatant => {\r\n                                xp += Utils.experience((combatant as Combatant & Monster).challenge);\r\n                            });\r\n                        allowWave = (encounter.waves.length !== 0);\r\n                    }\r\n                    return (\r\n                        <div className='actions'>\r\n                            <div className='section'>\r\n                                <div className='text'>round: {combat.round}</div>\r\n                            </div>\r\n                            <div className='section'>\r\n                                <div className='text'>xp: {xp}</div>\r\n                            </div>\r\n                            <div className='section'>\r\n                                <Menu\r\n                                    text='add'\r\n                                    content={(\r\n                                        <div>\r\n                                            <button onClick={() => this.addToEncounter()}>add combatants</button>\r\n                                            <button onClick={() => this.openWaveModal()} className={allowWave ? '' : 'disabled'}>add wave</button>\r\n                                        </div>\r\n                                    )}\r\n                                />\r\n                            </div>\r\n                            <div className='section'>\r\n                                <button onClick={() => this.pauseCombat()}>pause encounter</button>\r\n                            </div>\r\n                            <div className='section'>\r\n                                <button onClick={() => this.endCombat()}>end encounter</button>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                } else {\r\n                    return (\r\n                        <div className='actions'>\r\n                            <div className='section'>\r\n                                <input\r\n                                    type='text'\r\n                                    placeholder='search'\r\n                                    value={this.state.filter}\r\n                                    onChange={event => this.changeValue(this.state, 'filter', event.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private getContent() {\r\n        switch (this.state.view) {\r\n            case 'home':\r\n                return (\r\n                    <HomeScreen\r\n                        library={this.state.library}\r\n                        addOpenGameContent={() => this.addOpenGameContent()}\r\n                    />\r\n                );\r\n            case 'parties':\r\n                return (\r\n                    <PartiesScreen\r\n                        parties={this.state.parties}\r\n                        selection={this.state.parties.find(p => p.id === this.state.selectedPartyID) || null}\r\n                        filter={this.state.filter}\r\n                        selectParty={party => this.selectParty(party)}\r\n                        addParty={() => this.addParty()}\r\n                        removeParty={() => this.removeParty()}\r\n                        addPC={() => this.addPC()}\r\n                        editPC={pc => this.editPC(pc)}\r\n                        removePC={pc => this.removePC(pc)}\r\n                        sortPCs={() => this.sortPCs()}\r\n                        changeValue={(combatant, type, value) => this.changeValue(combatant, type, value)}\r\n                        nudgeValue={(combatant, type, delta) => this.nudgeValue(combatant, type, delta)}\r\n                    />\r\n                );\r\n            case 'library':\r\n                return (\r\n                    <MonsterLibraryScreen\r\n                        library={this.state.library}\r\n                        selection={this.state.library.find(g => g.id === this.state.selectedMonsterGroupID) || null}\r\n                        filter={this.state.filter}\r\n                        selectMonsterGroup={group => this.selectMonsterGroup(group)}\r\n                        addMonsterGroup={() => this.addMonsterGroup()}\r\n                        removeMonsterGroup={() => this.removeMonsterGroup()}\r\n                        addMonster={() => this.addMonster()}\r\n                        removeMonster={monster => this.removeMonster(monster)}\r\n                        sortMonsters={() => this.sortMonsters()}\r\n                        changeValue={(combatant, type, value) => this.changeValue(combatant, type, value)}\r\n                        nudgeValue={(combatant, type, delta) => this.nudgeValue(combatant, type, delta)}\r\n                        editMonster={combatant => this.editMonster(combatant)}\r\n                        cloneMonster={(combatant, name) => this.cloneMonster(combatant, name)}\r\n                        moveToGroup={(combatant, groupID) => this.moveToGroup(combatant, groupID)}\r\n                    />\r\n                );\r\n            case 'encounter':\r\n                return (\r\n                    <EncounterBuilderScreen\r\n                        encounters={this.state.encounters}\r\n                        selection={this.state.encounters.find(e => e.id === this.state.selectedEncounterID) || null}\r\n                        filter={this.state.filter}\r\n                        parties={this.state.parties}\r\n                        library={this.state.library}\r\n                        selectEncounter={encounter => this.selectEncounter(encounter)}\r\n                        addEncounter={() => this.addEncounter()}\r\n                        clearEncounter={() => this.clearEncounter()}\r\n                        removeEncounter={() => this.removeEncounter()}\r\n                        buildEncounter={(xp, filter) => this.buildEncounter(xp, filter)}\r\n                        addWave={() => this.addWaveToEncounter()}\r\n                        removeWave={wave => this.removeWave(wave)}\r\n                        getMonster={(monsterName, groupName) => this.getMonster(monsterName, groupName)}\r\n                        addEncounterSlot={(monster, waveID) => this.addEncounterSlot(monster, waveID)}\r\n                        removeEncounterSlot={(slot, waveID) => this.removeEncounterSlot(slot, waveID)}\r\n                        nudgeValue={(slot, type, delta) => this.nudgeValue(slot, type, delta)}\r\n                        changeValue={(combatant, type, value) => this.changeValue(combatant, type, value)}\r\n                    />\r\n                );\r\n            case 'maps':\r\n                return (\r\n                    <MapFoliosScreen\r\n                        mapFolios={this.state.mapFolios}\r\n                        selection={this.state.mapFolios.find(f => f.id === this.state.selectedMapFolioID) || null}\r\n                        filter={this.state.filter}\r\n                        selectMapFolio={folio => this.selectMapFolio(folio)}\r\n                        addMapFolio={() => this.addMapFolio()}\r\n                        removeMapFolio={() => this.removeMapFolio()}\r\n                        addMap={() => this.addMap()}\r\n                        editMap={map => this.editMap(map)}\r\n                        removeMap={map => this.removeMap(map)}\r\n                        changeValue={(source, type, value) => this.changeValue(source, type, value)}\r\n                    />\r\n                );\r\n            case 'combat':\r\n                return (\r\n                    <CombatManagerScreen\r\n                        combats={this.state.combats}\r\n                        combat={this.state.combats.find(c => c.id === this.state.selectedCombatID) || null}\r\n                        filter={this.state.filter}\r\n                        createCombat={() => this.createCombat()}\r\n                        resumeEncounter={pausedCombat => this.resumeCombat(pausedCombat)}\r\n                        nudgeValue={(combatant, type, delta) => this.nudgeValue(combatant, type, delta)}\r\n                        changeValue={(combatant, type, value) => this.changeValue(combatant, type, value)}\r\n                        makeCurrent={(combatant) => this.makeCurrent(combatant, false)}\r\n                        makeActive={(combatant) => this.makeActive(combatant)}\r\n                        makeDefeated={(combatant) => this.makeDefeated(combatant)}\r\n                        removeCombatant={(combatant) => this.removeCombatant(combatant)}\r\n                        addCondition={(combatant) => this.addCondition(combatant)}\r\n                        editCondition={(combatant, condition) => this.editCondition(combatant, condition)}\r\n                        removeCondition={(combatant, conditionID) => this.removeCondition(combatant, conditionID)}\r\n                        mapAdd={(combatant, x, y) => this.mapAdd(combatant, x, y)}\r\n                        mapMove={(combatant, dir) => this.mapMove(combatant, dir)}\r\n                        mapRemove={combatant => this.mapRemove(combatant)}\r\n                        endTurn={(combatant) => this.endTurn(combatant)}\r\n                        changeHP={(combatant, hp, temp) => this.changeHP(combatant, hp, temp)}\r\n                        close={(notification, removeCondition) => this.closeNotification(notification, removeCondition)}\r\n                        toggleTag={(combatant, tag) => this.toggleTag(combatant, tag)}\r\n                        scatterCombatants={type => this.scatterCombatants(type)}\r\n                        rotateMap={() => this.rotateMap()}\r\n                    />\r\n                );\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private getModal() {\r\n        if (this.state.modal) {\r\n            let modalSidebar = false;\r\n            let modalTitle = null;\r\n            let modalContent = null;\r\n            let modalAllowScroll = true;\r\n\r\n            const modalButtons = {\r\n                left: [] as JSX.Element[],\r\n                right: [\r\n                    <button key='close' onClick={() => this.closeModal()}>close</button>\r\n                ] as JSX.Element[]\r\n            };\r\n\r\n            switch (this.state.modal.type) {\r\n                case 'tools-sidebar':\r\n                    modalSidebar = true;\r\n                    modalContent = (\r\n                        <ToolsSidebar\r\n                            resetAll={() => this.resetAll()}\r\n                        />\r\n                    );\r\n                    modalButtons.right = [];\r\n                    break;\r\n                case 'demographics':\r\n                    modalSidebar = true;\r\n                    modalContent = (\r\n                        <DemographicsSidebar\r\n                            library={this.state.library}\r\n                        />\r\n                    );\r\n                    modalButtons.right = [];\r\n                    break;\r\n                case 'pc':\r\n                        modalTitle = 'pc editor';\r\n                        modalContent = (\r\n                            <PCEditorModal\r\n                                pc={this.state.modal.pc}\r\n                            />\r\n                        );\r\n                        modalButtons.right = [\r\n                            <button key='save' onClick={() => this.savePC()}>save</button>,\r\n                            <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                        ];\r\n                        break;\r\n                case 'monster':\r\n                    modalTitle = 'monster editor';\r\n                    modalContent = (\r\n                        <MonsterEditorModal\r\n                            monster={this.state.modal.monster}\r\n                            library={this.state.library}\r\n                            showSidebar={this.state.modal.showSidebar}\r\n                        />\r\n                    );\r\n                    modalAllowScroll = false;\r\n                    modalButtons.left = [\r\n                        (\r\n                            <Checkbox\r\n                                key='sidebar'\r\n                                label='advanced tools'\r\n                                checked={this.state.modal.showSidebar}\r\n                                changeValue={() => this.toggleShowSidebar()}\r\n                            />\r\n                        )\r\n                    ];\r\n                    modalButtons.right = [\r\n                        <button key='save' onClick={() => this.saveMonster()}>save</button>,\r\n                        <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                    ];\r\n                    break;\r\n                case 'map':\r\n                    modalTitle = 'map editor';\r\n                    modalContent = (\r\n                        <MapEditorModal\r\n                            map={this.state.modal.map}\r\n                        />\r\n                    );\r\n                    modalAllowScroll = false;\r\n                    modalButtons.right = [\r\n                        <button key='save' onClick={() => this.saveMap()}>save</button>,\r\n                        <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                    ];\r\n                    break;\r\n                case 'combat-start':\r\n                    modalTitle = 'start a new encounter';\r\n                    modalContent = (\r\n                        <CombatStartModal\r\n                            combatSetup={this.state.modal.combatSetup}\r\n                            parties={this.state.parties}\r\n                            encounters={this.state.encounters}\r\n                            mapFolios={this.state.mapFolios}\r\n                            getMonster={(monsterName, groupName) => this.getMonster(monsterName, groupName)}\r\n                            notify={() => this.setState({modal: this.state.modal})}\r\n                        />\r\n                    );\r\n                    modalAllowScroll = false;\r\n                    modalButtons.right = [\r\n                        (\r\n                            <button\r\n                                key='start encounter'\r\n                                className={this.state.modal.combatSetup.partyID && this.state.modal.combatSetup.encounterID ? '' : 'disabled'}\r\n                                onClick={() => this.startCombat()}\r\n                            >\r\n                                start encounter\r\n                            </button>\r\n                        ),\r\n                        <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                    ];\r\n                    break;\r\n                case 'combat-wave':\r\n                    modalTitle = 'encounter waves';\r\n                    modalContent = (\r\n                        <CombatStartModal\r\n                            combatSetup={this.state.modal.combatSetup}\r\n                            encounters={this.state.encounters}\r\n                            getMonster={(monsterName, groupName) => this.getMonster(monsterName, groupName)}\r\n                            notify={() => this.setState({modal: this.state.modal})}\r\n                        />\r\n                    );\r\n                    modalAllowScroll = false;\r\n                    modalButtons.right = [\r\n                        (\r\n                            <button\r\n                                key='add wave'\r\n                                className={this.state.modal.combatSetup.waveID !== null ? '' : 'disabled'}\r\n                                onClick={() => this.addWaveToCombat()}\r\n                            >\r\n                                add wave\r\n                            </button>\r\n                        ),\r\n                        <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                    ];\r\n                    break;\r\n                case 'combat-add-combatants':\r\n                        modalTitle = 'add combatants';\r\n                        modalContent = (\r\n                            <AddCombatantsModal\r\n                                combatantSlots={this.state.modal.combatantSlots}\r\n                                library={this.state.library}\r\n                            />\r\n                        );\r\n                        modalAllowScroll = false;\r\n                        modalButtons.right = [\r\n                            (\r\n                                <button\r\n                                    key='add combatants'\r\n                                    onClick={() => this.addCombatantsFromModal()}\r\n                                >\r\n                                    add combatants\r\n                                </button>\r\n                            ),\r\n                            <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                        ];\r\n                        break;\r\n                case 'condition-add':\r\n                    modalTitle = 'add a condition';\r\n                    modalContent = (\r\n                        <ConditionModal\r\n                            condition={this.state.modal.condition}\r\n                            combatant={this.state.modal.combatant}\r\n                            combat={this.state.modal.combat}\r\n                        />\r\n                    );\r\n                    modalAllowScroll = false;\r\n                    modalButtons.right = [\r\n                        <button key='add' onClick={() => this.addConditionFromModal()}>add</button>,\r\n                        <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                    ];\r\n                    break;\r\n                case 'condition-edit':\r\n                    modalTitle = 'edit condition';\r\n                    modalContent = (\r\n                        <ConditionModal\r\n                            condition={this.state.modal.condition}\r\n                            combatant={this.state.modal.combatant}\r\n                            combat={this.state.modal.combat}\r\n                        />\r\n                    );\r\n                    modalButtons.right = [\r\n                        <button key='save' onClick={() => this.editConditionFromModal()}>save</button>,\r\n                        <button key='cancel' onClick={() => this.closeModal()}>cancel</button>\r\n                    ];\r\n                    break;\r\n                default:\r\n                    // Do nothing\r\n                    break;\r\n            }\r\n\r\n            return (\r\n                <div className='overlay' onClick={() => modalSidebar ? this.closeModal() : null}>\r\n                    <div className={modalSidebar ? 'modal sidebar' : 'modal'} onClick={e => e.stopPropagation()}>\r\n                        <div className='modal-header'>\r\n                            <div className='title'>{modalTitle}</div>\r\n                            {modalSidebar ? <img className='image' src={close} alt='close' onClick={() => this.closeModal()} /> : null}\r\n                        </div>\r\n                        <div className={modalAllowScroll ? 'modal-content scrollable' : 'modal-content'}>\r\n                            {modalContent}\r\n                        </div>\r\n                        <div className='modal-footer'>\r\n                            <div className='left'>{modalButtons.left}</div>\r\n                            <div className='right'>{modalButtons.right}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public render() {\r\n        try {\r\n            const content = this.getContent();\r\n            const actions = this.getActions();\r\n            const modal = this.getModal();\r\n\r\n            return (\r\n                <div className='dojo'>\r\n                    <Titlebar\r\n                        actions={actions}\r\n                        blur={modal !== null}\r\n                        openHome={() => this.setView('home')}\r\n                        openTools={() => this.openToolsSidebar()}\r\n                    />\r\n                    <div className={(modal === null) ? 'page-content' : 'page-content blur'}>\r\n                        {content}\r\n                    </div>\r\n                    <Navbar\r\n                        view={this.state.view}\r\n                        parties={this.state.parties}\r\n                        library={this.state.library}\r\n                        encounters={this.state.encounters}\r\n                        blur={modal !== null}\r\n                        setView={view => this.setView(view)}\r\n                    />\r\n                    {modal}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport './style/css/foundation.css';\r\nimport './style/scss/app.scss';\r\nimport './style/scss/controls.scss';\r\n\r\nimport Dojo from './components/dojo';\r\n\r\nReactDOM.render(<Dojo />, document.getElementById('root'));\r\n"],"sourceRoot":""}