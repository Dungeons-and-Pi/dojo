(this.webpackJsonpdojo=this.webpackJsonpdojo||[]).push([[0],{122:function(e){e.exports=JSON.parse('{"name":"dojo","version":"9.6.3","license":"MIT","repository":"https://github.com/andyaiken/dojo.git","homepage":"https://andyaiken.github.io/dojo/","dependencies":{"@ant-design/icons":"^4.2.2","antd":"^4.6.1","mousetrap":"^1.6.5","peerjs":"^1.3.1","react":"^16.13.1","react-debounce-input":"^3.2.2","react-dom":"^16.13.1","react-movable":"^2.5.1","react-router-dom":"^5.2.0","showdown":"^1.9.1"},"devDependencies":{"@types/mousetrap":"^1.6.3","@types/react":"^16.9.46","@types/react-dom":"^16.9.8","@types/react-router-dom":"^5.1.5","@types/showdown":"^1.9.3","gh-pages":"^2.2.0","node-sass":"^4.14.0","react-scripts":"^3.4.3","tslint":"^5.20.1","tslint-react":"^3.6.0","typescript":"^3.9.7"},"scripts":{"update":"npm update && npm update --save-dev && npm audit fix","start":"react-scripts start --display-error-details","lint":"tslint --config tslint.json --format verbose \'src/**/*.{ts,tsx}\'","predeploy":"react-scripts build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":["eslint-recommended","react-app"]},"browserslist":[">0.2%","not dead","not ie <= 11","not op_mini all"]}')},130:function(e,t,a){e.exports=a(214)},135:function(e,t,a){},201:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=201},214:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(14),i=a.n(s),o=(a(135),a(1)),c=a(2),l=a(4),u=a(3),m=a(125),p=a(21),d=a(222),h=a(269),f=a(221),v=a(88),g=a.n(v),b=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"guid",value:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===t.length&&(t=[{field:"name",dir:"asc"}]);var a=function(e,t,a){if(void 0!==e[a]&&void 0!==t[a]){if(e[a]<t[a])return-1;if(e[a]>t[a])return 1}return 0};return e.sort((function(e,n){var r=0;return t.forEach((function(t){0===r&&(r=a(e,n,t.field)*("asc"===t.dir?1:-1))})),r})),e}},{key:"debounce",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){clearTimeout(t),t=setTimeout(e,a)}}},{key:"toData",value:function(e){var t=e/1073741824;if(t>=1)return t.toFixed(2)+" GB";var a=e/1048576;if(a>=1)return a.toFixed(2)+" MB";var n=e/1024;return n>=1?n.toFixed(2)+" KB":e+" B"}},{key:"saveFile",value:function(e,t){var a=JSON.stringify(t,null,"\t"),n=new Blob([a],{type:"application/json"}),r=document.createElement("a");r.download=e,r.href=window.URL.createObjectURL(n),r.click()}},{key:"randomNumber",value:function(e){return e<=0?0:Math.floor(Math.random()*e)}},{key:"randomBoolean",value:function(){return 0===e.randomNumber(2)}}]),e}(),y=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"createParty",value:function(){return{id:b.guid(),name:"",pcs:[]}}},{key:"createPC",value:function(){return{id:b.guid(),type:"pc",active:!0,player:"",name:"",size:"medium",race:"",classes:"",level:1,languages:"Common",passiveInsight:10,passiveInvestigation:10,passivePerception:10,portrait:"",url:"",companions:[]}}},{key:"createCompanion",value:function(){return{id:b.guid(),name:"",monsterID:null}}},{key:"createMonsterGroup",value:function(){return{id:b.guid(),name:"",monsters:[]}}},{key:"createMonster",value:function(){return{id:b.guid(),type:"monster",name:"",size:"medium",role:"",category:"humanoid",tag:"",alignment:"",challenge:1,abilityScores:{str:10,dex:10,con:10,int:10,wis:10,cha:10},ac:10,acInfo:"",hitDice:1,damage:{resist:"",vulnerable:"",immune:""},savingThrows:"",speed:"",skills:"",senses:"",languages:"",equipment:"",traits:[],conditionImmunities:"",portrait:"",legendaryActions:0}}},{key:"createTrait",value:function(){return{id:b.guid(),name:"",usage:"",type:"action",text:"",uses:0}}},{key:"createEncounter",value:function(){return{id:b.guid(),name:"",slots:[],waves:[],notes:""}}},{key:"createEncounterSlot",value:function(){return{id:b.guid(),monsterID:"",monsterGroupName:"",monsterName:"",roles:[],count:1,faction:"foe"}}},{key:"createEncounterWave",value:function(){return{id:b.guid(),name:"",slots:[]}}},{key:"createMonsterFilter",value:function(){return{name:"",challengeMin:0,challengeMax:5,category:"all types",size:"all sizes",role:"all roles"}}},{key:"createMap",value:function(){return{id:b.guid(),name:"",items:[],areas:[]}}},{key:"createMapItem",value:function(){return{id:b.guid(),type:"tile",x:0,y:0,width:4,height:4,terrain:"",customBackground:"",content:null,size:"medium",color:"",opacity:255,style:null}}},{key:"createMapArea",value:function(){return{id:b.guid(),name:"",text:"",x:0,y:0,width:1,height:1}}},{key:"createExploration",value:function(){return{id:b.guid(),name:"",map:this.createMap(),partyID:"",fog:[],combatants:[]}}},{key:"createCombatSetup",value:function(){return{party:null,encounter:null,waveID:null,map:null,fog:[],combatants:[],slotInfo:[]}}},{key:"createCombatSlotInfo",value:function(){return{id:"",useGroupHP:!0,useGroupInit:!0,hp:0,init:0,members:[]}}},{key:"createCombatSlotMember",value:function(){return{id:b.guid(),name:"",hp:0,init:0}}},{key:"createCombat",value:function(){return{id:b.guid(),name:"",encounter:e.createEncounter(),combatants:[],map:null,fog:[],round:1,notifications:[],issues:[],report:[]}}},{key:"createNotification",value:function(){return{id:b.guid(),type:"condition-save",data:null,combatant:null}}},{key:"createCombatReportEntry",value:function(){return{id:b.guid(),type:"combat-start",timestamp:Date.now(),combatantID:"",value:0}}},{key:"createCondition",value:function(){return{id:b.guid(),name:"",level:1,text:"",duration:null}}},{key:"createConditionDurationSaves",value:function(){return{type:"saves",count:1,saveType:"str",saveDC:10,point:"start"}}},{key:"createConditionDurationCombatant",value:function(){return{type:"combatant",point:"start",combatantID:null}}},{key:"createConditionDurationRounds",value:function(){return{type:"rounds",count:1}}}]),e}(),E=a(22),k=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"modifierValue",value:function(e){return Math.floor((e-10)/2)}},{key:"modifier",value:function(e){var t=this.modifierValue(e),a=t.toString();return t>=0&&(a="+"+a),a}},{key:"dieRoll",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=0,n=0;n!==t;++n)a+=b.randomNumber(e)+1;return a}},{key:"rollDice",value:function(t,a,n){var r={id:b.guid(),rolls:[],constant:a,mode:n};return[4,6,8,10,12,20,100].forEach((function(a){for(var n=t[a],s=0;s!==n;++s){var i=e.dieRoll(a);switch(r.mode){case"advantage":i=Math.max(i,e.dieRoll(a));break;case"disadvantage":i=Math.min(i,e.dieRoll(a))}r.rolls.push({id:b.guid(),sides:a,value:i})}})),r}},{key:"miniSize",value:function(e){switch(e){case"tiny":return.4;case"small":return.6;case"medium":return 1;case"large":return 2;case"huge":return 3;case"gargantuan":return 4;default:return 1}}},{key:"hitDieType",value:function(e){switch(e){case"tiny":return 4;case"small":return 6;case"medium":return 8;case"large":return 10;case"huge":return 12;case"gargantuan":return 20;default:return 8}}},{key:"proficiency",value:function(e){return e<5?2:e<9?3:e<13?4:e<17?5:6}},{key:"challenge",value:function(e){switch(e){case.125:return"1/8";case.25:return"1/4";case.5:return"1/2";default:return e.toString()}}},{key:"parseChallenge",value:function(e){switch(e){case"1/8":return.125;case"1/4":return.25;case"1/2":return.5;default:return parseInt(e,10)}}},{key:"challengeDetails",value:function(){return[{cr:0,ac:13,hpMin:1,hpMax:6,attack:3,dmgMin:0,dmgMax:1,save:13},{cr:.125,ac:13,hpMin:7,hpMax:35,attack:3,dmgMin:2,dmgMax:3,save:13},{cr:.25,ac:13,hpMin:36,hpMax:49,attack:3,dmgMin:4,dmgMax:5,save:13},{cr:.5,ac:13,hpMin:50,hpMax:70,attack:3,dmgMin:6,dmgMax:8,save:13},{cr:1,ac:13,hpMin:71,hpMax:85,attack:3,dmgMin:9,dmgMax:14,save:13},{cr:2,ac:13,hpMin:86,hpMax:100,attack:3,dmgMin:15,dmgMax:20,save:13},{cr:3,ac:13,hpMin:101,hpMax:115,attack:4,dmgMin:21,dmgMax:26,save:13},{cr:4,ac:14,hpMin:116,hpMax:130,attack:5,dmgMin:27,dmgMax:32,save:14},{cr:5,ac:15,hpMin:131,hpMax:145,attack:6,dmgMin:33,dmgMax:38,save:15},{cr:6,ac:15,hpMin:146,hpMax:160,attack:6,dmgMin:39,dmgMax:44,save:15},{cr:7,ac:15,hpMin:161,hpMax:175,attack:6,dmgMin:45,dmgMax:50,save:15},{cr:8,ac:16,hpMin:176,hpMax:190,attack:7,dmgMin:51,dmgMax:56,save:16},{cr:9,ac:16,hpMin:191,hpMax:205,attack:7,dmgMin:57,dmgMax:62,save:16},{cr:10,ac:17,hpMin:206,hpMax:220,attack:7,dmgMin:63,dmgMax:68,save:16},{cr:11,ac:17,hpMin:221,hpMax:235,attack:8,dmgMin:69,dmgMax:74,save:17},{cr:12,ac:17,hpMin:236,hpMax:250,attack:8,dmgMin:75,dmgMax:80,save:17},{cr:13,ac:18,hpMin:251,hpMax:265,attack:8,dmgMin:81,dmgMax:86,save:18},{cr:14,ac:18,hpMin:266,hpMax:280,attack:8,dmgMin:87,dmgMax:92,save:18},{cr:15,ac:18,hpMin:281,hpMax:295,attack:8,dmgMin:93,dmgMax:98,save:18},{cr:16,ac:18,hpMin:296,hpMax:310,attack:9,dmgMin:99,dmgMax:104,save:18},{cr:17,ac:19,hpMin:311,hpMax:325,attack:10,dmgMin:105,dmgMax:110,save:19},{cr:18,ac:19,hpMin:326,hpMax:340,attack:10,dmgMin:111,dmgMax:116,save:19},{cr:19,ac:19,hpMin:341,hpMax:355,attack:10,dmgMin:117,dmgMax:122,save:19},{cr:20,ac:19,hpMin:356,hpMax:400,attack:10,dmgMin:123,dmgMax:140,save:19},{cr:21,ac:19,hpMin:401,hpMax:445,attack:11,dmgMin:141,dmgMax:158,save:20},{cr:22,ac:19,hpMin:446,hpMax:490,attack:11,dmgMin:159,dmgMax:176,save:20},{cr:23,ac:19,hpMin:491,hpMax:535,attack:11,dmgMin:177,dmgMax:194,save:20},{cr:24,ac:19,hpMin:536,hpMax:580,attack:12,dmgMin:195,dmgMax:212,save:21},{cr:25,ac:19,hpMin:581,hpMax:625,attack:12,dmgMin:213,dmgMax:230,save:21},{cr:26,ac:19,hpMin:626,hpMax:670,attack:12,dmgMin:231,dmgMax:248,save:21},{cr:27,ac:19,hpMin:671,hpMax:715,attack:13,dmgMin:249,dmgMax:266,save:22},{cr:28,ac:19,hpMin:716,hpMax:760,attack:13,dmgMin:267,dmgMax:284,save:22},{cr:29,ac:19,hpMin:761,hpMax:805,attack:13,dmgMin:285,dmgMax:302,save:22},{cr:30,ac:19,hpMin:806,hpMax:850,attack:14,dmgMin:303,dmgMax:320,save:23}]}},{key:"experience",value:function(e){switch(e){case 0:return 10;case.125:return 25;case.25:return 50;case.5:return 100;case 1:return 200;case 2:return 450;case 3:return 700;case 4:return 1100;case 5:return 1800;case 6:return 2300;case 7:return 2900;case 8:return 3900;case 9:return 5e3;case 10:return 5900;case 11:return 7200;case 12:return 8400;case 13:return 1e4;case 14:return 11500;case 15:return 13e3;case 16:return 15e3;case 17:return 18e3;case 18:return 2e4;case 19:return 22e3;case 20:return 25e3;case 21:return 33e3;case 22:return 41e3;case 23:return 5e4;case 24:return 62e3;case 30:return 155e3;default:return 0}}},{key:"experienceFactor",value:function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 1.5;case 3:case 4:case 5:case 6:return 2;case 7:case 8:case 9:case 10:return 2.5;case 11:case 12:case 13:case 14:return 3;default:return 4}}},{key:"pcExperience",value:function(e,t){switch(t){case"easy":switch(e){case 1:return 25;case 2:return 50;case 3:return 75;case 4:return 125;case 5:return 250;case 6:return 300;case 7:return 350;case 8:return 450;case 9:return 550;case 10:return 600;case 11:return 800;case 12:return 1e3;case 13:return 1100;case 14:return 1250;case 15:return 1400;case 16:return 1600;case 17:return 2e3;case 18:return 2100;case 19:return 2400;case 20:return 2800;default:return 0}case"medium":switch(e){case 1:return 50;case 2:return 100;case 3:return 150;case 4:return 250;case 5:return 500;case 6:return 600;case 7:return 750;case 8:return 900;case 9:return 1100;case 10:return 1200;case 11:return 1600;case 12:return 2e3;case 13:return 2200;case 14:return 2500;case 15:return 2800;case 16:return 3200;case 17:return 3900;case 18:return 4200;case 19:return 4900;case 20:return 5700;default:return 0}case"hard":switch(e){case 1:return 75;case 2:return 150;case 3:return 225;case 4:return 375;case 5:return 750;case 6:return 900;case 7:return 1100;case 8:return 1400;case 9:return 1600;case 10:return 1900;case 11:return 2400;case 12:return 3e3;case 13:return 3400;case 14:return 3800;case 15:return 4300;case 16:return 4800;case 17:return 5900;case 18:return 6300;case 19:return 7300;case 20:return 8500;default:return 0}case"deadly":switch(e){case 1:return 100;case 2:return 200;case 3:return 400;case 4:return 500;case 5:return 1100;case 6:return 1400;case 7:return 1700;case 8:return 2100;case 9:return 2400;case 10:return 2800;case 11:return 3600;case 12:return 4500;case 13:return 5100;case 14:return 5700;case 15:return 6400;case 16:return 7200;case 17:return 8800;case 18:return 9500;case 19:return 10900;case 20:return 12700;default:return 0}default:return 0}}},{key:"traitType",value:function(e,t){var a="";switch(e){case"trait":a="trait";break;case"action":a="action";break;case"reaction":a="reaction";break;default:a=e+" action"}return t&&(a+="s"),a}},{key:"nudgeChallenge",value:function(e,t){var a=0;switch(e){case 0:-1===t&&(a=0),1===t&&(a=.125);break;case.125:-1===t&&(a=0),1===t&&(a=.25);break;case.25:-1===t&&(a=.125),1===t&&(a=.5);break;case.5:-1===t&&(a=.25),1===t&&(a=1);break;case 1:-1===t&&(a=.5),1===t&&(a=2);break;default:a=e+t}return a}},{key:"nudgeSize",value:function(e,t){var a=["tiny","small","medium","large","huge","gargantuan"],n=a.indexOf(e)+t;return n<0&&(n=0),n>=a.length&&(n=a.length-1),a[n]}},{key:"conditionText",value:function(e){switch(e.name){case"blinded":return["a blinded creature can\u2019t see and automatically fails any ability check that requires sight","attack rolls against the creature have advantage, and the creature\u2019s attack rolls have disadvantage"];case"charmed":return["a charmed creature can\u2019t attack the charmer or target the charmer with harmful abilities or magical effects","the charmer has advantage on any ability check to interact socially with the creature"];case"deafened":return["a deafened creature can\u2019t hear and automatically fails any ability check that requires hearing."];case"exhaustion":switch(e.level){case 1:return["disadvantage on ability checks"];case 2:return["disadvantage on ability checks","speed halved"];case 3:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws"];case 4:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved"];case 5:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0"];case 6:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0","death"];default:return[]}case"frightened":return["a frightened creature has disadvantage on ability checks and attack rolls while the source of its fear is within line of sight","the creature can\u2019t willingly move closer to the source of its fear"];case"grappled":return["a grappled creature\u2019s speed becomes 0, and it can\u2019t benefit from any bonus to its speed","the condition ends if the grappler is incapacitated","the condition also ends if an effect removes the grappled creature from the reach of the grappler or grappling effect"];case"incapacitated":return["an incapacitated creature can\u2019t take actions or reactions","being incapacitated breaks concentration"];case"invisible":return["an invisible creature is impossible to see without the aid of magic or a special sense","for the purpose of hiding, the creature is heavily obscured","the creature\u2019s location can be detected by any noise it makes or any tracks it leaves","attack rolls against the creature have disadvantage, and the creature\u2019s attack rolls have advantage"];case"paralyzed":return["a paralyzed creature is incapacitated (can\u2019t take actions or reactions) and can\u2019t move or speak","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];case"petrified":return["a petrified creature is transformed, along with any nonmagical objects it is wearing or carrying, into a solid inanimate substance (usually stone)","its weight increases by a factor of ten, and it ceases aging","the creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move or speak, and is unaware of its surroundings","attack rolls against the creature have advantage","the creature automatically fails strength and dexterity saving throws","the creature has resistance to all damage","the creature is immune to poison and disease, although a poison or disease already in its system is suspended, not neutralized"];case"poisoned":return["a poisoned creature has disadvantage on attack rolls and ability checks"];case"prone":return["a prone creature\u2019s only movement option is to crawl, unless it stands up (using half its speed) and thereby ends the condition","the creature has disadvantage on attack rolls","an attack roll against the creature has advantage if the attacker is Within 5 feet of the creature; otherwise, the attack roll has disadvantage"];case"restrained":return["a restrained creature\u2019s speed becomes 0, and it can\u2019t benefit from any bonus to its speed","attack rolls against the creature have advantage, and the creature\u2019s attack rolls have disadvantage","the creature has disadvantage on dexterity saving throws"];case"stunned":return["a stunned creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move, and can speak only falteringly","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage"];case"unconscious":return["an unconscious creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move or speak, and is unaware of its surroundings","the creature drops whatever its holding and falls prone","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];default:return[]}}},{key:"conditionDurationText",value:function(e,t){if(null!==e.duration)switch(e.duration.type){case"saves":var a=e.duration,n=a.saveType.toString();"death"!==n&&(n=n.toUpperCase());var r=a.count>1?"saves":"save";return"until you make "+a.count+" "+n+" "+r+" at dc "+a.saveDC;case"combatant":var s=e.duration,i=s.point,o=t.find((function(e){return e.id===s.combatantID}));return"until the "+i+" of "+(o?(o.displayName||o.name||"unnamed monster")+"'s":"their")+" next turn";case"rounds":var c=e.duration,l=c.count>1?"rounds":"round";return"for "+c.count+" "+l;default:return null}return null}},{key:"getCombatSlotData",value:function(e,t){var a=this,n=[];return e&&e.slots.forEach((function(e){var r=t.find((function(t){return t.name===e.monsterGroupName}));if(r){var s=r.monsters.find((function(t){return t.name===e.monsterName}));if(s){var i=y.createCombatSlotInfo();i.id=e.id,i.init=a.dieRoll()+a.modifierValue(s.abilityScores.dex),i.hp=M.getTypicalHP(s);for(var o=0;o!==e.count;++o){var c=y.createCombatSlotMember();c.init=i.init,c.hp=i.hp,c.name=e.monsterName,i.members.push(c)}if(e.count>1)for(var l=0;l!==e.count;++l)i.members[l].name=e.monsterName+" "+(l+1);n.push(i)}}})),n}},{key:"getTagTitle",value:function(e){if(e.startsWith("engaged"))return"engaged";switch(e){case"conc":return"concentrating";case"bane":return"affected by bane";case"bless":return"affected by bless";default:return e}}},{key:"getTagDescription",value:function(e){if(e.startsWith("engaged"))return e.split(":")[1];switch(e){case"conc":return"if damaged, must make con save (dc is half damage taken or 10, whichever is higher) or lose concentration";case"bane":return"subtract d4 from attack rolls and saving throws";case"bless":return"add d4 to attack rolls and saving throws";default:return e}}}]),e}(),w=["blinded","charmed","deafened","exhaustion","frightened","grappled","incapacitated","invisible","paralyzed","petrified","poisoned","prone","restrained","stunned","unconscious"],N=["tiny","small","medium","large","huge","gargantuan"],C=["aberration","beast","celestial","construct","dragon","elemental","fey","fiend","giant","humanoid","monstrosity","ooze","plant","undead"],x=["artillery","boss","controller","skirmisher","sneak","soldier","tank"],S=["trait","action","bonus","reaction","legendary","mythic","lair"],M=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getTypicalHP",value:function(e){var t=(k.hitDieType(e.size)+1)/2+k.modifierValue(e.abilityScores.con);return Math.floor(e.hitDice*t)}},{key:"getTypicalHPString",value:function(e){var t=k.hitDieType(e.size),a=k.modifierValue(e.abilityScores.con)*e.hitDice,n="";return a>0&&(n=" + "+a),a<0&&(n=" - "+Math.abs(a)),e.hitDice+"d"+t+n}},{key:"nudgeValue",value:function(t,a,n){var r,s=t,i=null,o=a.split(".");switch(o.forEach((function(e){e===o[o.length-1]?i=s[e]:s=s[e]})),a){case"challenge":r=k.nudgeChallenge(i,n);break;case"size":r=k.nudgeSize(i,n);break;default:r=(i||0)+n,r=Math.max(r,0)}e.changeValue(t,a,r)}},{key:"changeValue",value:function(e,t,a){var n=e,r=t.split(".");r.forEach((function(e){e===r[r.length-1]?n[e]=a:n=n[e]}))}},{key:"clear",value:function(e){e.name="",e.size="medium",e.role="",e.category="beast",e.tag="",e.alignment="",e.challenge=1,e.abilityScores.str=10,e.abilityScores.dex=10,e.abilityScores.con=10,e.abilityScores.int=10,e.abilityScores.wis=10,e.abilityScores.cha=10,e.ac=10,e.acInfo="",e.hitDice=1,e.damage.resist="",e.damage.vulnerable="",e.damage.immune="",e.savingThrows="",e.speed="",e.skills="",e.senses="",e.languages="",e.equipment="",e.traits=[],e.conditionImmunities="",e.portrait="",e.legendaryActions=0}},{key:"createFromJSON",value:function(e){var t=this,a=y.createMonster();a.type="monster",a.name=e.name,a.size=e.size.toLowerCase(),a.role="",a.category=e.type,a.tag=e.subtype,a.alignment=e.alignment,a.challenge=k.parseChallenge(e.challenge_rating),a.ac=e.armor_class,a.acInfo="",a.speed=e.speed,a.senses=e.senses,a.languages=e.languages;var n=e.hit_dice.indexOf("d");a.hitDice=parseInt(e.hit_dice.substring(0,n),10),a.abilityScores.str=e.strength,a.abilityScores.dex=e.dexterity,a.abilityScores.con=e.constitution,a.abilityScores.int=e.intelligence,a.abilityScores.wis=e.wisdom,a.abilityScores.cha=e.charisma,a.damage.resist=e.damage_resistances,a.damage.vulnerable=e.damage_vulnerabilities,a.damage.immune=e.damage_immunities,a.conditionImmunities=e.condition_immunities,a.legendaryActions=0;[{field:"strength_save",text:"Strength"},{field:"dexterity_save",text:"Dexterity"},{field:"constitution_save",text:"Constitution"},{field:"intelligence_save",text:"Intelligence"},{field:"wisdom_save",text:"Wisdom"},{field:"charisma_save",text:"Charisma"}].forEach((function(t){if(e[t.field]){var n=t.text+" "+e[t.field];a.savingThrows+=""===a.savingThrows?n:", "+n}}));return[{field:"acrobatics",text:"Acrobatics"},{field:"animal_handling",text:"Animal handling"},{field:"arcana",text:"Arcana"},{field:"athletics",text:"Athletics"},{field:"deception",text:"Deception"},{field:"history",text:"History"},{field:"insight",text:"Insight"},{field:"intimidation",text:"Intimidation"},{field:"investigation",text:"Investigation"},{field:"medicine",text:"Medicine"},{field:"nature",text:"Nature"},{field:"perception",text:"Perception"},{field:"performance",text:"Performance"},{field:"persuasion",text:"Persuasion"},{field:"religion",text:"Religion"},{field:"sleight_of_hand",text:"Sleight of hand"},{field:"stealth",text:"Stealth"},{field:"survival",text:"Survival"}].forEach((function(t){if(e[t.field]){var n=t.text+" "+e[t.field];a.skills+=""===a.skills?n:", "+n}})),e.special_abilities&&e.special_abilities.forEach((function(e){var n=t.buildTrait(e,"trait");a.traits.push(n)})),e.actions&&e.actions.forEach((function(e){var n=t.buildTrait(e,"action");a.traits.push(n)})),e.reactions&&e.reactions.forEach((function(e){var n=t.buildTrait(e,"reaction");a.traits.push(n)})),e.legendary_actions&&e.legendary_actions.forEach((function(e){var n=t.buildTrait(e,"legendary");a.traits.push(n)})),a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(a.legendaryActions=3),a.role=this.getRole(a),a}},{key:"buildTrait",value:function(e,t){var a="",n="",r=e.name.indexOf("(");if(-1===r)a=e.name;else{var s=e.name.indexOf(")");a=e.name.substring(0,r-1),n=e.name.substring(r+1,s).toLowerCase()}var i=e.desc.replace(/\u2022/g,"*"),o=t;return"Lair Actions"===a&&(o="lair"),0===i.indexOf("As a bonus action")&&(o="bonus"),{id:b.guid(),type:o,name:a,usage:n,text:i,uses:0}}},{key:"import",value:function(t,a){e.clear(a);var n=(new DOMParser).parseFromString(t,"text/html");try{a.name=n.getElementsByClassName("mon-stat-block__name")[0].innerText.trim();var r=n.getElementsByClassName("mon-stat-block__meta")[0].innerText.toLowerCase().trim(),s=r.indexOf(" ");a.size=r.substring(0,s).trim();var i=(r=r.substring(s+1).trim()).indexOf(",");a.alignment=r.substring(i+1).trim();var o=(r=r.substring(0,i).trim()).indexOf("("),c=r.indexOf(")");-1!==o&&-1!==c&&(a.tag=r.substring(o+1,c).trim(),r=r.substring(0,o).trim()),a.category=r}catch(G){console.error(G)}try{for(var l=n.getElementsByClassName("mon-stat-block__attribute"),u=0;u!==l.length;++u){var m=l[u],p=m.getElementsByClassName("mon-stat-block__attribute-label")[0].innerText.toLowerCase().trim(),d=m.getElementsByClassName("mon-stat-block__attribute-data-value")[0].innerText.toLowerCase().trim();switch(p){case"armor class":a.ac=Number.parseInt(d,10);var h=m.getElementsByClassName("mon-stat-block__attribute-data-extra")[0].innerText.toLowerCase().trim();h.startsWith("(")&&(h=h.substr(1,h.length-2)),a.acInfo=h;break;case"hit points":var f=m.getElementsByClassName("mon-stat-block__attribute-data-extra")[0].innerText.toLowerCase().trim();a.hitDice=Number.parseInt(f.substring(1,f.indexOf("d")),10);break;case"speed":a.speed=d}}}catch(G){console.error(G)}try{for(var v=n.getElementsByClassName("ability-block__stat"),g=0;g!==v.length;++g){var b=v[g],E=b.getElementsByClassName("ability-block__heading")[0].innerText.toLowerCase().trim(),k=b.getElementsByClassName("ability-block__score")[0].innerText.toLowerCase().trim(),w=Number.parseInt(k,10);a.abilityScores[E]=w}}catch(G){console.error(G)}try{for(var N=n.getElementsByClassName("mon-stat-block__tidbit"),C=0;C!==N.length;++C){var x=N[C],S=x.getElementsByClassName("mon-stat-block__tidbit-label")[0].innerText.toLowerCase().trim(),M=x.getElementsByClassName("mon-stat-block__tidbit-data")[0].innerText.toLowerCase().trim();switch(S){case"saving throws":a.savingThrows=M;break;case"skills":a.skills=M;break;case"damage vulnerabilities":a.damage.vulnerable=M;break;case"damage resistances":a.damage.resist=M;break;case"damage immunities":a.damage.immune=M;break;case"condition immunities":a.conditionImmunities=M;break;case"senses":a.senses=M;break;case"languages":a.languages=M;break;case"challenge":var I=M.indexOf(" ");a.challenge=Number.parseInt(M.substring(0,I),10)}}}catch(G){console.error(G)}try{for(var O=n.getElementsByClassName("mon-stat-block__description-block"),D=0;D!==O.length;++D){var j=O[D],T="trait",V=j.getElementsByClassName("mon-stat-block__description-block-heading");if(V.length>0)switch(V[0].innerText.toLowerCase().trim()){case"actions":T="action";break;case"bonus actions":T="bonus";break;case"reactions":T="reaction";break;case"legendary actions":T="legendary";break;case"mythic actions":T="mythic";break;case"lair actions":T="lair"}for(var P=j.getElementsByTagName("p"),A=0;A!==P.length;++A){var R=P[A].innerText.trim(),z=y.createTrait();z.type=T;var L=R.indexOf(".");z.text=R.substring(L+1).trim();var q=(R=R.substring(0,L)).indexOf("("),F=R.indexOf(")");if(-1!==q&&-1!==F&&(z.usage=R.substring(q+1,F).trim(),R=R.substring(0,q).trim()),z.name=R,z.name)a.traits.push(z);else{var B=a.traits[a.traits.length-1];B.text+="\n",B.text+=z.text}}}}catch(G){console.error(G)}a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(a.legendaryActions=3),a.role=this.getRole(a)}},{key:"copyTrait",value:function(e,t){var a=JSON.parse(JSON.stringify(t));a.id=b.guid(),e.traits.push(a)}},{key:"addTrait",value:function(e,t){var a=y.createTrait();a.type=t,a.name="New "+k.traitType(t,!1).toLowerCase(),e.traits.push(a)}},{key:"moveTrait",value:function(e,t,a){var n,r=e.traits.splice(t,1);(n=e.traits).splice.apply(n,[a,0].concat(Object(E.a)(r)))}},{key:"removeTrait",value:function(e,t){var a=e.traits.indexOf(t);e.traits.splice(a,1)}},{key:"swapTraits",value:function(e,t,a){var n=e.traits.indexOf(t),r=e.traits.indexOf(a);e.traits[r]=t,e.traits[n]=a}},{key:"spliceMonsters",value:function(e,t){var a=this;["size","category","tag","alignment","challenge","speed","senses","languages","equipment","abilityScores.str","abilityScores.dex","abilityScores.con","abilityScores.int","abilityScores.wis","abilityScores.cha","savingThrows","skills","ac","acInfo","hitDice","damage.resist","damage.vulnerable","damage.immune","conditionImmunities"].forEach((function(n){a.setRandomValue(e,n,t)})),e.traits=[],S.forEach((function(n){var r=[];t.forEach((function(e){e.traits.filter((function(e){return e.type===n})).forEach((function(e){return r.push(e)}))}));var s=[];r.forEach((function(e){var t=s.find((function(t){return t.trait.name===e.name}));t?t.count+=1:s.push({trait:e,count:1})}));var i=[];s.filter((function(e){return e.count===t.length})).forEach((function(t){a.copyTrait(e,t.trait),i.push(t.trait.id)})),i.forEach((function(e){var t=s.findIndex((function(t){return t.trait.id===e}));s.splice(t,1)}));for(var o=r.length/t.length;e.traits.filter((function(e){return e.type===n})).length<o;){var c=Math.floor(Math.random()*s.length),l=s[c].trait;a.copyTrait(e,l),s.splice(c,1)}})),e.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(e.legendaryActions=3),e.role=this.getRole(e)}},{key:"setRandomValue",value:function(e,t,a){var n=a[Math.floor(Math.random()*a.length)],r=null,s=t.split(".");s.forEach((function(e){e===s[s.length-1]?r=n[e]:n=n[e]})),this.changeValue(e,t,r)}},{key:"addRandomTrait",value:function(e,t,a){var n=[];a.forEach((function(e){e.traits.filter((function(e){return e.type===t})).forEach((function(e){n.push(e)}))}));var r=Math.floor(Math.random()*n.length),s=n[r];this.copyTrait(e,s)}},{key:"getToHitExpressions",value:function(e){return Array.from(e.text.matchAll(/([+-])\s*(\d+)\s*to hit/g)).map((function(e){var t=e[0],a=parseInt(e[2],10);return"-"===e[1]&&(a*=-1),{expression:t,bonus:a}}))}},{key:"getDiceExpressions",value:function(e){return Array.from(e.text.matchAll(/(\d*)[dD](\d+)\s*(([+-])\s*(\d*))?/g)).map((function(e){var t,a=e[0],n=null!==(t=parseInt(e[1],10))&&void 0!==t?t:1,r=parseInt(e[2],10),s=0;return e[3]&&e[4]&&e[5]&&(s=parseInt(e[5],10),"-"===e[4]&&(s*=-1)),{expression:a,count:n,sides:r,bonus:s}}))}},{key:"getSaveExpressions",value:function(e){return Array.from(e.text.matchAll(/(dc|DC)\s*(\d+)/g)).map((function(e){return{expression:e[0],dc:parseInt(e[2],10)}}))}},{key:"getRole",value:function(t){var a=this;if(t.legendaryActions>0)return"boss";if(t.traits.some((function(e){return e.text.toLowerCase().includes("teleport")})))return"skirmisher";var n=t.skills.toLowerCase();if(n.includes("deception")||n.includes("stealth"))return"sneak";if(t.traits.some((function(e){return e.text.toLowerCase().includes("indistinguishable")})))return"sneak";var r=k.challengeDetails().find((function(e){return e.cr===t.challenge}));if(r){if(e.getTypicalHP(t)>r.hpMax)return"tank";var s=t.traits.filter((function(e){var t=a.getToHitExpressions(e),n=a.getDiceExpressions(e).map((function(e){return e.count*(e.sides+1)/2+e.bonus})),s=a.getSaveExpressions(e);return t.some((function(e){return e.bonus>r.attack}))||n.some((function(e){return e>r.dmgMax}))||s.some((function(e){return e.dc>r.save}))}));if(s.length>0){var i=s.filter((function(e){var t=e.text.toLowerCase();return t.includes("ranged")&&t.includes("attack")})).length;return i>=s.length-i?"artillery":"soldier"}}var o=0;return w.forEach((function(e){t.traits.some((function(t){return t.text.toLowerCase().includes(e.toLowerCase())}))&&(o+=1)})),o>=2?"controller":"skirmisher"}}]),e}(),I=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"initModel",value:function(t){var a=[],n=0;t.forEach((function(t){t.split(/\r?\n/).forEach((function(t){t&&(e.addLineToModel(t,a),n=Math.max(n,t.length))}))})),e.model=a,e.maxLength=n}},{key:"addLineToModel",value:function(e,t){e=String.fromCharCode(0,1)+e+String.fromCharCode(2);for(var a=function(a){var n=e.substr(a-2,2),r=e.substr(a,1),s=t.find((function(e){return e.prev===n}));s||(s={prev:n,freq:[]},t.push(s));var i=s.freq.find((function(e){return e.char===r}));i||(i={char:r,count:0},s.freq.push(i)),i.count+=1},n=2;n!==e.length;++n)a(n)}},{key:"generate",value:function(t){for(var a=[],n=0;a.length<t&&n<100;){var r=e.extractLine();if(r&&!a.map((function(e){return e.line})).includes(r)&&r.length<=e.maxLength){var s=e.fit(r);a.push({line:r,fit:s})}else n+=1}return a}},{key:"extractLine",value:function(){for(var t=String.fromCharCode(0,1),a=function(){var a=t.substr(t.length-2,2),n=e.model.find((function(e){return e.prev===a}));if(!n)return{v:null};var r="";n.freq.forEach((function(e){r+=e.char.repeat(e.count)}));var s=Math.floor(Math.random()*r.length),i=r[s];if(i===String.fromCharCode(2))return{v:t=t.substr(2)};if(1===k.dieRoll()){["bdg","ptk","sz","aeiouy","lr","ckq","vf"].forEach((function(e){if(e.includes(i)){var t=Math.floor(Math.random()*e.length);i=e[t]}}))}t+=i};;){var n=a();if("object"===typeof n)return n.v}}},{key:"fit",value:function(t){t=String.fromCharCode(0,1)+t+String.fromCharCode(2);for(var a=[],n=function(n){var r=t.substr(n-2,2),s=t[n],i=e.model.find((function(e){return e.prev===r}));if(i){var o=i.freq.find((function(e){return e.char===s}));if(o){var c=i.freq.reduce((function(e,t){return Math.max(e,t.count)}),0),l=o.count/c;a.push(l)}else a.push(0)}},r=2;r!==t.length;++r)n(r);return a.reduce((function(e,t){return e+t}),0)/a.length}},{key:"startsWithVowel",value:function(e){var t=!1;return["a","e","i","o","u"].forEach((function(a){e.toLowerCase().startsWith(a)&&(t=!0)})),t}},{key:"capitalise",value:function(e){return e.split(" ").map((function(e){return e[0].toUpperCase()+(e.length>1?e.substring(1):"")})).join(" ")}},{key:"getMultipleValues",value:function(e){var t=1;switch(b.randomNumber(10)){case 0:case 1:case 2:case 3:case 4:t=1;break;case 5:case 6:case 7:t=2;break;case 8:case 9:t=3}for(var a=[];a.length<t;){var n=e[b.randomNumber(e.length)];a.includes(n)||a.push(n)}return a.join(", ")}},{key:"generateName",value:function(){var e=["As Has Khe Zash Gl Ig Iv Kos Miv Pav Ser Dar Even Gor Rand Sto Tam Barer Keth Mum","Mar Burg Al Hel Wrayt S Eag Eath Joan Answ L Ot Ced At Tal Ham Jasm Mail Yash Row","Adr Alber Ba Bar Gar Kildr Kath Dies Eld Gurd Har Morg Or Rur Mar Vis Jen Torg Tak Thor End Ris Em Gunn","Ad All Aram Berri Car Enial Gann Im Per Sorvi Var Adr An Beth Bir Jelen Key Lesh Mer Mia Naiv Quel Sar Shan","Al An C Cor Eld Er Finn Gar Lin Mer Os Per Ros An Cal Cor Kith Lav Ned Pae Seraph T V Chen","Are Bala Bhar Don Gh Hesk Med Meh Nad Pand Patr Sham Shed Ak Bir Farid Fla Ka Ko Mish Thav Uad Eder Hener","Alu Stos Fa Ravay Leo Stok Vic El Yeng Car Ric Ar Guir Es My Pey"].join(" ").toLowerCase().split(" "),t=["Eir Eid Eed El Ar An Or Ef Al Vin Orn Dur Stag Elm Ur Us","Ik Ich Ern End Tor Nor In Rak Gen Sik Gran Linn Vok Brek Dal Gar","An Ar Il Rian Ric Is Dan Arai Meral Cian En Rion Ialis Ior Nan Kas","Ton Der Ade Rin Don Rich Nan Ret Al Born Coe By Fire Yas Dal Yle","Han Asar Ash Aar Esch An Rash En Arr Jed Rin Gar Ash Dinn Hun Rek","Orel Aadi Ahn Aver Eiros Kain Retor Lannan Pet Ikos","Er Ey A E Il Elia Ya Ed Eue Ild Oane Yne Orna Ie Ala Erri Ea Ia","Ber Tin Hild Dryn A Eth Runn Ellen Loda Dis Ja Lin Ra Tyrd De Rasa","Rie Aea Striana Inua Rynna Ilia Na Neth Leth Iel Lee Qui Astra Ia Ania Ynn","Dry Ree Lie Ora Emia Ian Ri Inia Ina Aena Ani Erna Lyse La Da Aela","Ra Ir Eh Ann Ilar Rinn Ann La Ra A Ina Va Hit Ederei Ere Eila","Ina Ceryn Vyn Ella Aella Vyre"].join(" ").toLowerCase().split(" "),a=Math.floor(Math.random()*e.length),n=Math.floor(Math.random()*t.length),r="";if(1===k.dieRoll(10)){var s=["-","'"," "];r=s[Math.floor(Math.random()*s.length)]}return e[a]+r+t[n]}},{key:"generatePotion",value:function(){var t="",a=e.potionColour(!0),n=e.potionLiquid(),r=e.potionAdjective(),s=e.potionFeature();switch(b.randomNumber(5)){case 0:t=a+" "+n;break;case 1:t=a+" "+n+" "+s;break;case 2:t=r+" "+a+" "+n;break;case 3:t=r+" "+a+" "+n+" "+s;break;case 4:t=r+" "+n+", "+a+" "+s}switch(t=(e.startsWithVowel(t)?"an":"a")+" "+t+" in "+e.potionContainer(),b.randomNumber(6)){case 0:t+="; it smells "+e.potionSmell();break;case 1:t+="; it tastes "+e.potionSmell();break;case 2:t+="; it smells "+e.potionSmell()+" but tastes "+e.potionSmell();break;case 3:t+="; it smells and tastes "+e.potionSmell()}return t}},{key:"generateBookTitle",value:function(){var t="",a=e.bookNounPhrase(b.randomBoolean(),b.randomBoolean());switch(b.randomNumber(5)){case 0:t=a+"'s "+e.bookNounPhrase(b.randomBoolean(),!1);break;case 1:t=a+" "+e.bookPreposition()+" "+e.bookNounPhrase(b.randomBoolean(),!0);break;case 2:t=e.bookGerund()+" "+e.bookNounPhrase(b.randomBoolean(),!0);break;case 3:t=e.bookAbout()+" "+a;break;case 4:t=a}if(0===b.randomNumber(10)&&(t+=": "+e.bookAbout()+" "+e.bookNounPhrase(b.randomBoolean(),b.randomBoolean())),0===b.randomNumber(10)){var n="";switch(b.randomNumber(3)){case 0:n="volume";break;case 1:n="part";break;case 2:n="book"}switch(b.randomNumber(5)){case 0:t+=", "+n+" one";break;case 1:t+=", "+n+" two";break;case 2:t+=", "+n+" three";break;case 3:t+=", "+n+" four";break;case 4:t+=", "+n+" five"}}return t}},{key:"generateNPC",value:function(){var t=["elderly","middle-aged","teenage","youthful","young","old"],a=t[b.randomNumber(t.length)],n=["apothecary","architect","armourer","arrowsmith","astrologer","baker","barber","lawyer","beggar","bellfounder","blacksmith","bookbinder","brewer","bricklayer","butcher","carpenter","carter","cartwright","chandler","peddler","clerk","clockmaker","cobbler","cook","cooper","merchant","embroiderer","engraver","fisherman","fishmonger","forester","furrier","gardener","gemcutter","glassblower","goldsmith","grocer","haberdasher","stableman","courtier","herbalist","innkeeper","ironmonger","labourer","painter","locksmith","mason","messenger","miller","miner","minstrel","ploughman","farmer","porter","sailor","scribe","seamstress","shepherd","shipwright","soapmaker","tailor","tinker","vintner","weaver"],r=n[b.randomNumber(n.length)],s="";switch(b.randomNumber(3)){case 0:case 1:s=r;break;case 2:s=a+" "+r}s=(e.startsWithVowel(s)?"an":"a")+" "+s;var i=["gangly","gigantic","hulking","lanky","short","small","stumpy","tall","tiny","willowy"],o=i[b.randomNumber(i.length)],c=["broad-shouldered","fat","gaunt","heavy-set","obese","plump","pot-bellied","rotund","skinny","slender","slim","statuesque","stout","thin"],l=c[b.randomNumber(c.length)],u="";switch(b.randomNumber(4)){case 0:case 1:u=o+" and "+l;break;case 2:u=o;break;case 3:u=l}var m=["short","cropped","long","braided","dreadlocked","shoulder-length","wiry","balding","receeding","curly","tightly-curled","straight","greasy","limp","sparse","thinning","wavy"],p=["black","brown","dark brown","light brown","red","ginger","strawberry blonde","blonde","ash blonde","graying","silver","white","gray","auburn"],d=m[b.randomNumber(m.length)]+" "+p[b.randomNumber(p.length)],h="";switch(b.randomNumber(4)){case 0:case 1:h=s+", "+u+" with "+d+" hair";break;case 2:h=s+" with "+d+" hair";break;case 3:h=s+", "+u}return h}},{key:"generateNPCPhysical",value:function(){return e.getMultipleValues(["bearded","buck-toothed","chiselled","doe-eyed","fine-featured","florid","gap-toothed","goggle-eyed","grizzled","jowly","jug-eared","pock-marked","broken nose","red-cheeked","scarred","squinting","thin-lipped","toothless","weather-beaten","wrinkled"])}},{key:"generateNPCMental",value:function(){return e.getMultipleValues(["hot-tempered","overbearing","antagonistic","haughty","elitist","proud","rude","aloof","mischievous","impulsive","lusty","irreverent","madcap","thoughtless","absent-minded","insensitive","brave","craven","shy","fearless","obsequious","inquisitive","prying","intellectual","perceptive","keen","perfectionist","stern","harsh","punctual","driven","trusting","kind-hearted","forgiving","easy-going","compassionate","miserly","hard-hearted","covetous","avaricious","thrifty","wastrel","spendthrift","extravagant","kind","charitable","gloomy","morose","compulsive","irritable","vengeful","honest","truthful","innocent","gullible","bigoted","biased","narrow-minded","cheerful","happy","diplomatic","pleasant","foolhardy","affable","fatalistic","depressing","cynical","sarcastic","realistic","secretive","retiring","practical","level-headed","dull","reverent","scheming","paranoid","cautious","deceitful","nervous","uncultured","boorish","barbaric","graceless","crude","cruel","sadistic","immoral","jealous","belligerent","argumentative","arrogant","careless","curious","exacting","friendly","greedy","generous","moody","naive","opinionated","optimistic","pessimistic","quiet","sober","suspicious","uncivilised","violent","peaceful"])}},{key:"generateNPCSpeech",value:function(){return e.getMultipleValues(["accented","articulate","garrulous","breathless","crisp","gutteral","high-pitched","lisping","loud","nasal","slow","fast","squeaky","stuttering","wheezy","whiny","whispery","soft-spoken","laconic","blustering"])}},{key:"generateTreasure",value:function(){var t="",a=["diamond","ruby","sapphire","emerald","amethyst","garnet","topaz","pearl","black pearl","opal","fire opal","amber","coral","agate","carnelian","jade","peridot","moonstone","alexandrite","aquamarine","jacinth","marble"];switch(b.randomNumber(12)){case 0:case 1:case 2:var n=a[b.randomNumber(a.length)];switch(b.randomBoolean()){case!0:n+=" gemstone";break;case!1:n="piece of "+n}switch(b.randomNumber(12)){case 0:n="well cut "+n;break;case 1:n="rough-cut "+n;break;case 2:n="poorly cut "+n;break;case 3:n="small "+n;break;case 4:n="large "+n;break;case 5:n="oddly shaped "+n;break;case 6:n="highly polished "+n}t=n;break;case 3:case 4:case 5:var r=["medal","statuette","sculpture","idol","chalice","goblet","dish","bowl"],s=r[b.randomNumber(r.length)],i=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];t=i[b.randomNumber(i.length)]+" "+s;break;case 6:case 7:case 8:var o=["ring","necklace","crown","circlet","bracelet","anklet","torc","brooch","pendant","locket","diadem","tiara","earring"],c=o[b.randomNumber(o.length)],l=["gold","silver","bronze","platinum","electrum","mithral","orium","adamantine"];switch(t=l[b.randomNumber(l.length)]+" "+c,b.randomNumber(5)){case 0:t=(b.randomBoolean()?"enamelled":"laquered")+" "+t;break;case 1:t=l[b.randomNumber(l.length)]+"-"+(b.randomBoolean()?"plated":"filigreed")+" "+t}switch(b.randomNumber(10)){case 0:t="delicate "+t;break;case 1:t="intricate "+t;break;case 2:t="elegant "+t;break;case 3:t="simple "+t;break;case 4:t="plain "+t}break;case 9:case 10:var u="";switch(b.randomBoolean()){case!0:switch(u="painting",b.randomBoolean()){case!0:u="oil "+u;break;case!1:u="watercolour "+u}break;case!1:switch(u="drawing",b.randomNumber(3)){case 0:u="pencil "+u;break;case 1:u="charcoal "+u;break;case 2:u="pastel "+u}}var m=["small","large","delicate","fragile","elegant","detailed"],p=["canvas","paper","parchment","wood panels","fabric"];t=m[b.randomNumber(m.length)]+" "+u+" on "+p[b.randomNumber(p.length)];break;case 11:var d=["lute","lyre","mandolin","violin","drum","flute","clarinet","accordion","banjo","bodhran","ocarina","zither","djembe","shawm"],h=d[b.randomNumber(d.length)],f=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];t=f[b.randomNumber(f.length)]+" "+h}switch(b.randomNumber(5)){case 0:var v=["feywild","shadowfell","elemental chaos","astral plane","abyss","distant north","distant east","distant west","distant south"];t+=" from the "+v[b.randomNumber(v.length)];break;case 1:var g=["decorated with","inscribed with","engraved with","embossed with","carved with"],y=["indecipherable","ancient","curious","unusual","dwarven","eladrin","elven","draconic","gith"],E=["script","designs","sigils","runes","glyphs","patterns"];t+=" "+g[b.randomNumber(g.length)]+" "+y[b.randomNumber(y.length)]+" "+E[b.randomNumber(E.length)];break;case 2:var k=["glowing with","suffused with","infused with","humming with","pulsing with"],w=["arcane","divine","primal","psionic","dark","shadow","elemental","ethereal","unknown"],N=["energy","power","magic"];t+=" "+k[b.randomNumber(k.length)]+" "+w[b.randomNumber(w.length)]+" "+N[b.randomNumber(N.length)];break;case 4:var C=a[b.randomNumber(a.length)];b.randomBoolean()?C+="s":C="a single "+C;var x=["set with","inlaid with","studded with","with shards of"];t+=" "+x[b.randomNumber(x.length)]+" "+C}return(e.startsWithVowel(t)?"an ":"a ")+t}},{key:"generateRoomName",value:function(){var e=["antechamber","arena","armoury","aviary","audience chamber","banquet hall","bath chamber","barracks","bedroom","boudoir","bestiary","burial chamber","cells","chamber","chantry","chapel","classroom","closet","court","crypt","dining room","dormitory","dressing room","dumping ground","entrance hall","gallery","game room","great hall","guard post","hall","harem","hoard","infirmary","kennels","kitchens","laboratory","lair","library","mausoleum","meditation room","museum","nursery","observatory","office","pantry","prison","quarters","reception room","refectory","ritual chamber","shrine","smithy","stable","storeroom","study","temple","throne room","torture chamber","trophy room","training area","treasury","waiting room","workroom","workshop","vault","vestibule"];return e[b.randomNumber(e.length)]}},{key:"potionColour",value:function(e){var t=["red","scarlet","crimson","carmine","vermillion","pink","blue","royal blue","sky blue","light blue","dark blue","midnight blue","indigo","yellow","lemon yellow","amber","green","light green","dark green","sea green","turquoise","aquamarine","emerald","purple","lavender","lilac","mauve","orange","brown","maroon","ochre","black","dark grey","grey","light grey","off-white","white","golden","silver"];if(e&&(t=t.concat(["blood red","cherry red","ruby-coloured","rose-coloured","sapphire-coloured","straw-coloured","olive-coloured","plum-coloured","mud-coloured","cream-coloured","ivory-coloured","bronze-coloured","colourless","clear","transparent"])),e&&0===b.randomNumber(5)){var a=b.randomNumber(t.length),n=b.randomNumber(t.length),r=[t[a],t[n]];return b.sort(r,[{field:"length",dir:"asc"}]),r[0]+" and "+r[1]}return t[b.randomNumber(t.length)]}},{key:"potionAdjective",value:function(){var e=["watery","syrupy","thick","viscous","gloopy","thin","runny","translucent","effervescent","fizzing","bubbling","foaming","volatile","smoking","fuming","vaporous","steaming","cold","icy cold","hot","sparkling","iridescent","cloudy","opalescent","luminous","phosphorescent","glowing"];return e[b.randomNumber(e.length)]}},{key:"potionFeature",value:function(){switch(b.randomNumber(6)){case 0:return"with "+this.potionColour(!0)+" specks";case 1:return"with flecks of "+this.potionColour(!1);case 2:var t=this.potionColour(!0);return"with "+(e.startsWithVowel(t)?"an":"a")+" "+t+" suspension";case 3:return"with a floating "+this.potionColour(!0)+" layer";case 4:return"with a ribbon of "+this.potionColour(!1);case 5:return"with "+this.potionColour(!0)+" marbling"}return""}},{key:"potionLiquid",value:function(){var e=["liquid","solution","draught","oil","elixir","potion"];return e[b.randomNumber(e.length)]}},{key:"potionContainer",value:function(){var t=["small","rounded","tall","square","irregularly-shaped","long-necked","cylindrical","round-bottomed"],a=["glass","metal","ceramic","crystal"],n=["vial","jar","bottle","flask"],r=t[b.randomNumber(t.length)],s=a[b.randomNumber(a.length)],i=n[b.randomNumber(n.length)];0===b.randomNumber(3)&&(s=this.potionColour(!0)+" "+s);var o="";switch(b.randomBoolean()){case!0:o=s+" "+i;break;case!1:o=r+" "+s+" "+i}return(e.startsWithVowel(o)?"an":"a")+" "+o}},{key:"potionSmell",value:function(){var e=["acidic","acrid","of ammonia","of apples","bitter","brackish","buttery","of cherries","delicious","earthy","of earwax","of fish","floral","of lavender","lemony","of honey","fruity","meaty","metallic","musty","of onions","of oranges","peppery","of perfume","rotten","salty","sickly sweet","starchy","sugary","smokey","sour","spicy","of sweat","sweet","unpleasant","vile","vinegary"];return e[b.randomNumber(e.length)]}},{key:"bookNounPhrase",value:function(t,a){var n=e.bookNoun(t),r=!1;(t&&0===b.randomNumber(5)&&(n+="s",r=!0),0===b.randomNumber(3))&&(n=e.bookAdjective()+" "+n);if(a&&b.randomBoolean())switch(b.randomBoolean()){case!0:n="the "+n;break;case!1:if(r)switch(b.randomNumber(6)){case 0:n="two "+n;break;case 1:n="three "+n;break;case 2:n="four "+n;break;case 3:n="five "+n;break;case 4:n="six "+n;break;case 5:n="seven "+n}else switch(b.randomBoolean()){case!0:n=(e.startsWithVowel(n)?"an":"a")+" "+n;break;case!1:n="one "+n}}return n}},{key:"bookNoun",value:function(e){var t=["elf","halfling","dwarf","gnome","tiefling","dragonborn","goliath","changeling","drow","minotaur","beast","orc","goblin","hobgoblin","dragon","demon","devil","angel","god","gith","night","day","eclipse","shadow","sky","sun","moon","star","void","battle","war","brawl","fist","blade","arrow","spell","prayer","eye","wing","army","legion","brigade","galleon","warship","frigate","potion","jewel","ring","amulet","cloak","sword","spear","helm","wizard","king","queen","prince","princess","warlock","barbarian","sorcerer","thief","mage","child","wayfarer","adventurer","pirate","spy","sage","assassin","mountain","forest","peak","cave","cavern","lake","swamp","marshland","island","shore","city","town","village","tower","arena","castle","citadel","bridge","game","wager","quest","challenge","rose","lily","thorn","leaf","word","snake","serpent","song","lament","dirge","elegy","storm","tempest"];return e||(t=t.concat(["darkness","light","dusk","twilight","revenge","vengeance","blood","earth","water","ice","wood","metal","lightning","thunder","mist","snow","flame","fire","wind","stone","destruction","life","death","time","end","danger","luck","chaos","truth","untruth","lie","deception","music","sound","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"])),t[b.randomNumber(t.length)]}},{key:"bookAdjective",value:function(){var e=["dark","bright","tyrannous","devout","noble","eldritch","mystical","magical","sorcerous","savage","silent","lonely","violent","peaceful","black","white","gold","silver","red","pale","dying","living","ascending","defiled","mythical","legendary","heroic","empty","mighty","despairing","spellbound","enchanted","soaring","falling","visionary","bold","perilous"];return e[b.randomNumber(e.length)]}},{key:"bookGerund",value:function(){var e=["killing","murdering","watching","examining","enchanting","destroying","defying","betraying","protecting","silencing","bearing","fighting"];return e[b.randomNumber(e.length)]}},{key:"bookPreposition",value:function(){var e=["and","in","of","with","against","for","to","towards"];return e[b.randomNumber(e.length)]}},{key:"bookAbout",value:function(){var t=["treatise","essay","monograph","discourse","dissertation","primer","history","enchiridion"],a=t[b.randomNumber(t.length)];b.randomBoolean()?a=(e.startsWithVowel(a)?"an ":"a ")+a:a+="s";var n=["about","on","concerning","regarding","on the subject of"];return a+" "+n[b.randomNumber(n.length)]}}]),e}();I.model=[],I.maxLength=0;var O=["default","cavern","dirt","flagstone","floorboard","grassland","pit","sand","snow","water","custom"],D=["single","double","arch","bars"],j=["stairs","spiral","ladder"],T=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"scatterCombatants",value:function(t,a,n){if(t.map&&(t.map.items=t.map.items.filter((function(e){return e.type!==a})),t.map.items.filter((function(e){return"tile"===e.type})).length>0)){var r=null;if(n){var s=t.map.areas.find((function(e){return e.id===n}));s&&(r={minX:s.x,minY:s.y,maxX:s.x+s.width-1,maxY:s.y+s.height-1})}var i=r||e.mapDimensions(t.map.items);if(i)t.combatants.filter((function(e){return e.type===a})).forEach((function(n){for(var r=[],s=i.minX;s<=i.maxX;++s)for(var o=i.minY;o<=i.maxY;++o){e.canAddMonsterHere(t.map,n,s,o)&&r.push({x:s,y:o})}if(r.length>0&&t.map){var c=r[Math.floor(Math.random()*r.length)],l=k.miniSize(n.displaySize),u=y.createMapItem();u.id=n.id,u.type=a,u.x=c.x,u.y=c.y,u.height=l,u.width=l,t.map.items.push(u)}}))}}},{key:"mapDimensions",value:function(e){var t=e.filter((function(e){return"tile"===e.type}));if(t.length>0){var a=t[0].x,n=t[0].y,r=t[0].x+t[0].width-1,s=t[0].y+t[0].height-1;return t.forEach((function(e){a=Math.min(a,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x+e.width-1),s=Math.max(s,e.y+e.height-1)})),{minX:a,minY:n,maxX:r,maxY:s}}return null}},{key:"canAddTileHere",value:function(t,a,n,r,s,i,o){for(var c=[],l=n-o,u=a+(r-1)+i,m=n+(s-1)+o,p=a-i;p<=u;++p)for(var d=l;d<=m;++d){var h=e.itemsAt(t,p,d).every((function(e){return"tile"!==e.type}));c.push(h)}return c.every((function(e){return e}))}},{key:"canAddMonsterHere",value:function(t,a,n,r){for(var s=[],i=k.miniSize(a.displaySize),o=n+Math.max(1,i)-1,c=r+Math.max(1,i)-1,l=n;l<=o;++l)for(var u=r;u<=c;++u){var m=e.itemsAt(t,l,u),p=m.length>0&&m.every((function(e){return"tile"===e.type}));s.push(p)}return s.every((function(e){return e}))}},{key:"itemsAt",value:function(e,t,a){return e.items.filter((function(e){var n=e.x,r=e.x+e.width-1,s=e.y,i=e.y+e.height-1;return t>=n&&t<=r&&a>=s&&a<=i}))}},{key:"rotateMap",value:function(e){e.items.forEach((function(e){var t=-1*(e.y+e.height-1),a=e.x,n=e.height,r=e.width;e.x=t,e.y=a,e.width=n,e.height=r,e.content&&(e.content.orientation="horizontal"===e.content.orientation?"vertical":"horizontal")})),e.areas.forEach((function(e){var t=-1*(e.y+e.height-1),a=e.x,n=e.height,r=e.width;e.x=t,e.y=a,e.width=n,e.height=r}))}},{key:"mapSize",value:function(t){return t.items.filter((function(e){return"tile"===e.type})).reduce((function(t,a){return t+e.mapTileSize(a)}),0)}},{key:"mapTileSize",value:function(e){return"tile"===e.type?e.width*e.height:0}},{key:"generate",value:function(t,a){switch(t){case"dungeon":for(var n=0;n<10;)e.addRoom(a)&&(n+=1);break;case"delve":for(var r=0;r<3;)e.addRoom(a)&&(r+=1);break;case"room":for(var s=!1;!s;)s=e.addRoom(a)}}},{key:"addRoom",value:function(t){var a=y.createMapItem();a.type="tile",a.terrain="default",a.style="square",a.width=k.dieRoll(6,2)+2,a.height=k.dieRoll(6,2)+2;var n=null,r=e.mapDimensions(t.items);if(r){r.minX-=a.width+2,r.minY-=a.height+2,r.maxX+=2,r.maxY+=2;for(var s=[],i=r.minX;i!==r.maxX;++i)for(var o=r.minY;o!==r.maxY;++o){e.canAddTileHere(t,i,o,a.width,a.height,1,1)&&s.push({x:i,y:o})}if(!(s.length>0))return!1;var c=Math.floor(Math.random()*s.length);a.x=s[c].x,a.y=s[c].y;var l=[];if(t.items.filter((function(e){return"tile"===e.type})).forEach((function(n){var r=Math.max(a.x,n.x),s=Math.min(a.x+a.width-1,n.x+n.width-1);if(s-r+1>=2)for(var i=Math.min(a.y+a.height-1,n.y+n.height-1)+1,o=Math.max(a.y,n.y)-1,c=r;c<=s-1;++c){var u=y.createMapItem();u.type="tile",u.terrain="default",u.style="square",u.x=c,u.y=i,u.width=2,u.height=o-i+1,e.canAddTileHere(t,u.x,u.y,u.width,u.height,1,0)&&l.push({tile:u,horizontal:!1})}var m=Math.max(a.y,n.y),p=Math.min(a.y+a.height-1,n.y+n.height-1);if(p-m+1>=2)for(var d=Math.min(a.x+a.width-1,n.x+n.width-1)+1,h=Math.max(a.x,n.x)-1,f=m;f<=p-1;++f){var v=y.createMapItem();v.type="tile",v.terrain="default",v.style="square",v.x=d,v.y=f,v.width=h-d+1,v.height=2,e.canAddTileHere(t,v.x,v.y,v.width,v.height,0,1)&&l.push({tile:v,horizontal:!0})}})),!(l.length>0))return!1;var u=Math.floor(Math.random()*l.length),m=l[u];if(!m.horizontal&&1===m.tile.height||m.horizontal&&1===m.tile.width)2===k.dieRoll(2)&&(m.tile.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:m.horizontal?"vertical":"horizontal"});else{if(!m.horizontal&&m.tile.height>=4||m.horizontal&&m.tile.width>=4){if(2===k.dieRoll(2)){var p=y.createMapItem();p.type="tile",p.terrain="default",p.style="square",p.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:""},m.horizontal?(p.x=m.tile.x,p.y=m.tile.y,p.width=1,p.height=2,p.content.orientation="vertical",m.tile.x+=1,m.tile.width-=1):(p.x=m.tile.x,p.y=m.tile.y,p.width=2,p.height=1,p.content.orientation="horizontal",m.tile.y+=1,m.tile.height-=1),t.items.push(p)}if(2===k.dieRoll(2)){var d=y.createMapItem();d.type="tile",d.terrain="default",d.style="square",d.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:""},m.horizontal?(d.x=m.tile.x+m.tile.width-1,d.y=m.tile.y,d.width=1,d.height=2,d.content.orientation="vertical",m.tile.width-=1):(d.x=m.tile.x,d.y=m.tile.y+m.tile.height-1,d.width=2,d.height=1,d.content.orientation="horizontal",m.tile.height-=1),t.items.push(d)}}(!m.horizontal&&m.tile.height<=4||m.horizontal&&m.tile.width<=4)&&3===k.dieRoll(3)&&(m.tile.content={type:"stairway",style:"stairs",orientation:m.horizontal?"vertical":"horizontal"})}n=this.getRoomAdjunct(a,t),t.items.push(m.tile),t.items.push(a),n&&t.items.push(n)}else n=this.getRoomAdjunct(a,t),t.items.push(a),n&&t.items.push(n);var h=[a];n&&h.push(n);var f=this.mapDimensions(h);if(f){var v=y.createMapArea();v.name=I.capitalise(I.generateRoomName()),v.x=f.minX-1,v.y=f.minY-1,v.width=f.maxX-f.minX+3,v.height=f.maxY-f.minY+3,t.areas.push(v)}return!0}},{key:"getRoomAdjunct",value:function(t,a){if(b.randomBoolean())return null;var n=0,r=0,s=[];switch(b.randomNumber(2)){case 0:n=b.randomNumber(t.width-2)+2,r=k.dieRoll(4,2);for(var i=t.width-n,o=0;o!==i;++o){var c=t.x+o,l=t.y-r;e.canAddTileHere(a,c,l,n,r,1,1)&&s.push({x:c,y:l});var u=t.y+t.height;e.canAddTileHere(a,c,u,n,r,1,1)&&s.push({x:c,y:u})}break;case 1:n=k.dieRoll(4,2),r=b.randomNumber(t.height-2)+2;for(var m=t.height-r,p=0;p!==m;++p){var d=t.y+p,h=t.x-n;e.canAddTileHere(a,h,d,n,r,1,1)&&s.push({x:h,y:d});var f=t.x+t.width;e.canAddTileHere(a,f,d,n,r,1,1)&&s.push({x:f,y:d})}}if(s.length>0){var v=s[b.randomNumber(s.length)],g=y.createMapItem();return g.type="tile",g.terrain="default",g.style="square",g.x=v.x,g.y=v.y,g.width=n,g.height=r,g}return null}},{key:"getRandomDoorwayStyle",value:function(){var e=Math.floor(Math.random()*D.length);return D[e]}}]),e}(),V=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"matchParty",value:function(t,a){return!!e.match(t,a.name)||a.pcs.some((function(a){return e.matchPC(t,a)}))}},{key:"matchPC",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.player)||(!!e.match(t,a.race)||(!!e.match(t,a.classes)||a.companions.some((function(a){return e.matchCompanion(t,a)})))))}},{key:"matchCompanion",value:function(t,a){return!!e.match(t,a.name)}},{key:"matchGroup",value:function(t,a){return!!e.match(t,a.name)||a.monsters.some((function(a){return e.matchMonster(t,a)}))}},{key:"matchMonster",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.category)||(!!e.match(t,a.tag)||(!!e.match(t,a.senses)||(!!e.match(t,a.languages)||(!!e.match(t,a.equipment)||a.traits.some((function(a){return e.matchTrait(t,a)})))))))}},{key:"matchTrait",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.usage)||!!e.match(t,a.text))}},{key:"matchEncounter",value:function(t,a){return!!e.match(t,a.name)||(!!a.waves.some((function(a){return e.matchEncounterWave(t,a)}))||a.slots.some((function(a){return e.matchEncounterSlot(t,a)})))}},{key:"matchEncounterWave",value:function(t,a){return!!e.match(t,a.name)||a.slots.some((function(a){return e.matchEncounterSlot(t,a)}))}},{key:"matchEncounterSlot",value:function(t,a){return!!e.match(t,a.monsterName)}},{key:"matchMap",value:function(t,a){return!!e.match(t,a.name)||a.areas.some((function(a){return e.matchMapArea(t,a)}))}},{key:"matchMapArea",value:function(t,a){return!!e.match(t,a.name)||!!e.match(t,a.text)}},{key:"match",value:function(e,t){if(!e)return!0;var a=!0;return e.toLowerCase().split(" ").forEach((function(e){-1===t.toLowerCase().indexOf(e)&&(a=!1)})),a}}]),e}(),P=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getMonsterCount",value:function(e,t){var a=0,n=[];return null!==t&&t!==e.id||(n=n.concat(e.slots)),e.waves.forEach((function(e){null!==t&&t!==e.id||(n=n.concat(e.slots))})),n.filter((function(e){return"foe"===e.faction})).forEach((function(e){a+=e.count})),a}},{key:"getEncounterXP",value:function(e,t,a){var n=0,r=[];return null!==t&&t!==e.id||(r=r.concat(e.slots)),e.waves.forEach((function(e){null!==t&&t!==e.id||(r=r.concat(e.slots))})),r.filter((function(e){return"foe"===e.faction})).forEach((function(e){var t=a(e.monsterID);t&&(n+=k.experience(t.challenge)*e.count)})),n}},{key:"getAdjustedEncounterXP",value:function(e,t,a){var n=this.getMonsterCount(e,t);return this.getEncounterXP(e,t,a)*k.experienceFactor(n)}},{key:"getCombatXP",value:function(e){var t=0;return e.combatants.filter((function(e){return"monster"===e.type})).filter((function(e){return"foe"===e.faction})).forEach((function(e){var a=e;t+=k.experience(a.challenge)})),t}},{key:"getFilterDescription",value:function(e){var t="";"all sizes"!==e.size&&(t+=t?" "+e.size:e.size),"all types"!==e.category&&(t+=t?" "+e.category:e.category),"all roles"!==e.role&&(t+=t?" "+e.role:e.role);var a=k.challenge(e.challengeMin),n=k.challenge(e.challengeMax);return t+=" monsters of cr "+(e.challengeMin===e.challengeMax?a:a+" to "+n)}},{key:"buildEncounter",value:function(t,a,n,r,s){for(;e.getAdjustedEncounterXP(t,null,(function(e){return s(e)}))<=a;)if(t.slots.length>0&&k.dieRoll(3)>1){var i=Math.floor(Math.random()*t.slots.length);t.slots[i].count+=1}else{if("break"===function(){var a=[];if(r.forEach((function(r){r.monsters.filter((function(t){return e.matchMonster(t,n)})).filter((function(e){return!t.slots.find((function(t){return t.monsterGroupName===r.name&&t.monsterName===e.name}))})).forEach((function(e){return a.push({id:e.id,monsterName:e.name,groupName:r.name})}))})),a.length>0){var s=Math.floor(Math.random()*a.length),i=y.createEncounterSlot();i.monsterID=a[s].id,i.monsterName=a[s].monsterName,i.monsterGroupName=a[s].groupName,t.slots.push(i)}else if(0===t.slots.length)return"break"}())break}for(var o=function(){var e=Math.floor(Math.random()*t.slots.length),a=t.slots[e];t.slots=t.slots.filter((function(e){return e.id!==a.id}));var n=y.createEncounterWave();n.name="wave "+(t.waves.length+2),n.slots.push(a),t.waves.push(n)};t.slots.length>1&&10===k.dieRoll(10);)o()}},{key:"matchMonster",value:function(e,t){return!(e.challenge<t.challengeMin)&&(!(e.challenge>t.challengeMax)&&(!(""!==t.name&&!V.match(t.name,e.name))&&(("all types"===t.category||e.category===t.category)&&(("all sizes"===t.size||e.size===t.size)&&("all roles"===t.role||e.role===t.role)))))}},{key:"sortCombatants",value:function(e){e.combatants.sort((function(e,t){return e.initiative&&t.initiative&&e.initiative<t.initiative?1:e.initiative&&t.initiative&&e.initiative>t.initiative||e.displayName<t.displayName?-1:e.displayName>t.displayName?1:0}))}},{key:"combatHasLairActions",value:function(e){var t=!1;return e.combatants.filter((function(e){return!e.pending&&e.active&&!e.defeated})).forEach((function(e){var a=e;a&&a.traits&&a.traits.some((function(e){return"lair"===e.type}))&&(t=!0)})),t}},{key:"encounterHasMonster",value:function(e,t){var a=e.slots.map((function(e){return e.monsterID}));return e.waves.forEach((function(e){a=a.concat(e.slots.map((function(e){return e.monsterID})))})),!!a.find((function(e){return e===t}))}},{key:"convertPCToCombatant",value:function(e){var t=JSON.parse(JSON.stringify(e));return t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e.name,t.displaySize=e.size,t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.altitude=0,t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t}},{key:"convertMonsterToCombatant",value:function(e,t,a,n,r){var s=JSON.parse(JSON.stringify(e));return s.id=b.guid(),s.current=!1,s.pending=!1,s.active=!0,s.defeated=!1,s.faction=r,s.displayName=n,s.displaySize=e.size,s.showOnMap=!0,s.initiative=t,s.hpMax=a,s.hpCurrent=a,s.hpTemp=0,s.conditions=[],s.tags=[],s.note="",s.altitude=0,s.aura={radius:0,style:"rounded",color:"#005080"},s.mountID=null,s.mountType="controlled",s}},{key:"convertCompanionToCombatant",value:function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return t.id=e?e.id:b.guid(),t.type="companion",t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e?e.name:"companion",t.displaySize="medium",t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.altitude=0,t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t}},{key:"convertPlaceholderToCombatant",value:function(){return{id:b.guid(),type:"placeholder",current:!1,pending:!1,active:!0,defeated:!1,faction:"neutral",displayName:"lair actions",displaySize:"medium",showOnMap:!0,initiative:20,hpMax:null,hpCurrent:null,hpTemp:null,conditions:[],tags:[],note:"",altitude:0,aura:{radius:0,style:"rounded",color:"#005080"},mountID:null,mountType:"controlled"}}},{key:"encounterTemplates",value:function(){return[{name:"battlefield control",slots:[{roles:["controller"],count:1},{roles:["skirmisher","sneak"],count:5}]},{name:"commander and troops",slots:[{roles:["controller","soldier"],count:1},{roles:["soldier","tank"],count:5}]},{name:"dragon's den",slots:[{roles:["boss"],count:1}]},{name:"double line",slots:[{roles:["soldier","tank"],count:3},{roles:["artillery","controller"],count:2}]},{name:"wolf pack",slots:[{roles:["skirmisher"],count:6}]}]}}]),e}(),A=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.onChecked(!this.props.checked)}},{key:"render",value:function(){var e=this;try{var t="checkbox "+this.props.display;this.props.checked&&(t+=" checked"),this.props.disabled&&(t+=" disabled");var a=null;return"switch"===this.props.display&&(a=r.a.createElement("div",{className:"toggle-container"},r.a.createElement("div",{className:"toggle"}))),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)}},r.a.createElement("div",{className:"checkbox-label"},this.props.label),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);A.defaultProps={display:"switch",disabled:!1};var R=a(230),z=a(246),L=a(218),q=a(261),F=a(244),B=a(233),G=a(237),H=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={visible:!1},n}return Object(c.a)(a,[{key:"onClick",value:function(e){e.stopPropagation(),this.setState({visible:!0})}},{key:"onClose",value:function(e,t){e.stopPropagation(),t&&this.props.onConfirm(),this.setState({visible:!1})}},{key:"render",value:function(){var e=this;try{return r.a.createElement(G.a,{content:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement(B.a,{style:{color:"red"}}),r.a.createElement("span",{style:{marginLeft:"10px"}},this.props.prompt)),this.props.info,r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(t){return e.onClose(t,!0)}},"confirm"),r.a.createElement("button",{onClick:function(t){return e.onClose(t,!1)}},"cancel")),trigger:"click",visible:this.state.visible},r.a.createElement("button",{className:this.props.disabled?"danger disabled":"danger",onClick:function(t){return e.onClick(t)}},this.props.text))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);H.defaultProps={prompt:"are you sure you want to do this?",info:null,disabled:!1};var W=a(229),_=a(89),J=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"keyDown",value:function(e){"Enter"===e.key&&this.props.onPressEnter&&this.props.onPressEnter()}},{key:"render",value:function(){var e=this;try{var t="";return this.props.disabled&&(t="disabled"),this.props.noMargins&&(t+=" no-margins"),this.props.multiLine?r.a.createElement(_.DebounceInput,{element:"textarea",minLength:this.props.minLength,debounceTimeout:this.props.debounce?500:100,className:t,value:this.props.text,placeholder:this.props.placeholder,rows:10,onChange:function(t){return e.props.onChange(t.target.value)}}):r.a.createElement(_.DebounceInput,{minLength:this.props.minLength,debounceTimeout:this.props.debounce?500:100,className:t,value:this.props.text,placeholder:this.props.placeholder,onChange:function(t){return e.props.onChange(t.target.value)},onKeyDown:function(t){return e.keyDown(t)}})}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);J.defaultProps={placeholder:"",multiLine:!1,minLength:0,disabled:!1,debounce:!0,noMargins:!1,onPressEnter:null};var Y=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={open:!1,filterText:""},n}return Object(c.a)(a,[{key:"toggleOpen",value:function(e){e.stopPropagation(),this.setState({open:!this.state.open})}},{key:"setFilterText",value:function(e){this.setState({filterText:e})}},{key:"select",value:function(e){this.setState({open:!1}),this.props.onSelect(e)}},{key:"clear",value:function(e){e.stopPropagation(),this.props.onClear()}},{key:"render",value:function(){var e=this;try{if(0===this.props.options.length)return null;var t,a=this.props.disabled?"dropdown disabled":"dropdown",n=[];this.props.selectedID&&(t=this.props.options.find((function(t){return t.id===e.props.selectedID})));var s=t&&this.props.onClear;if(n.push(r.a.createElement("div",{key:"selection",className:"dropdown-top",title:t?t.text:this.props.placeholder},t?t.display:null,r.a.createElement("div",{className:"item-text"},t?t.text:this.props.placeholder),s?r.a.createElement(R.a,{onClick:function(t){return e.clear(t)}}):r.a.createElement(W.a,null))),this.state.open){a+=" open";var i=null;this.props.options.length>15&&(i=r.a.createElement("div",{className:"dropdown-filter",onClick:function(e){return e.stopPropagation()}},r.a.createElement(J,{text:this.state.filterText,placeholder:"search this list...",onChange:function(t){return e.setFilterText(t)}})));var o=this.props.options.map((function(t){return null===t.text?r.a.createElement("hr",{key:t.id}):V.match(e.state.filterText,t.text)?r.a.createElement(U,{key:t.id,option:t,selected:t.id===e.props.selectedID,select:function(t){return e.select(t)}}):null})).filter((function(e){return!!e}));n.push(r.a.createElement("div",{key:"options",className:"dropdown-options"},i,o))}return r.a.createElement("div",{className:a,onClick:function(t){return e.toggleOpen(t)}},n)}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Y.defaultProps={selectedID:null,placeholder:"select...",disabled:!1,onClear:null,onDisplay:null};var U=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.select(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="dropdown-option";return this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled"),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)}},this.props.option.display,this.props.option.text)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),X=a(268),K=a(219),Z=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e="expander";return this.props.disabled&&(e+=" disabled"),r.a.createElement(K.a,{className:e,bordered:!1,defaultActiveKey:[],expandIcon:function(e){return r.a.createElement(X.a,{rotate:e.isActive?-180:0})},expandIconPosition:"right"},r.a.createElement(K.a.Panel,{key:"one",header:r.a.createElement("div",{className:"collapse-header-text"},this.props.text)},this.props.children))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Z.defaultProps={disabled:!1};var Q=a(266),$=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getEditor",value:function(){var e=this,t=null;this.props.source.portrait&&(t=r.a.createElement(R.a,{className:"clear",onClick:function(){return e.props.clear()}}));var a=null,n=window.localStorage.getItem("image-"+this.props.source.portrait);if(n){var s=JSON.parse(n);a=r.a.createElement("img",{className:"circle",src:s.data,alt:"portrait",onClick:function(){return e.props.edit()}})}else a=r.a.createElement(Q.a,{className:"circle",style:{opacity:.5},onClick:function(){return e.props.edit()}});return r.a.createElement("div",{className:"portrait editing"},r.a.createElement("div",{className:"section centered"},a,t))}},{key:"getDisplay",value:function(){if(!this.props.source.portrait)return null;var e=window.localStorage.getItem("image-"+this.props.source.portrait);if(!e)return null;var t=JSON.parse(e);if(!t.data)return null;var a="portrait";return this.props.inline?a+=" inline":a+=" section centered",r.a.createElement("div",{className:a},r.a.createElement("img",{className:"circle",src:t.data,alt:"portrait"}))}},{key:"render",value:function(){try{return null!==this.props.edit?this.getEditor():this.getDisplay()}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);$.defaultProps={inline:!1,edit:null,clear:null};var ee=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={cloneName:e.monster.name+" copy"},n}return Object(c.a)(a,[{key:"setCloneName",value:function(e){this.setState({cloneName:e})}},{key:"getTags",value:function(){var e=[],t=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(t+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(r.a.createElement(F.a,{key:"tag-main"},t)),this.props.monster.alignment&&e.push(r.a.createElement(F.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(r.a.createElement(F.a,{key:"tag-cr"},"cr ",k.challenge(this.props.monster.challenge))),e}},{key:"getButtons",value:function(){var e=this;if("editable"===this.props.mode){var t=[];this.props.library.forEach((function(a){-1===a.monsters.indexOf(e.props.monster)&&t.push({id:a.id,text:a.name})}));var a=this.props.encounters.some((function(t){return P.encounterHasMonster(t,e.props.monster.id)}));return r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.viewMonster(e.props.monster)}},"statblock"),r.a.createElement("button",{onClick:function(){return e.props.editMonster(e.props.monster)}},"edit monster"),r.a.createElement("button",{onClick:function(){return e.props.exportMonster(e.props.monster)}},"export monster"),r.a.createElement(Z,{text:"copy monster"},r.a.createElement(J,{text:this.state.cloneName,placeholder:"monster name",onChange:function(t){return e.setCloneName(t)}}),r.a.createElement("button",{onClick:function(){return e.props.cloneMonster(e.props.monster,e.state.cloneName)}},"create copy")),r.a.createElement(Y,{options:t,placeholder:"move to group...",onSelect:function(t){return e.props.moveToGroup(e.props.monster,t)}}),r.a.createElement(H,{text:"delete monster",disabled:a,onConfirm:function(){return e.props.removeMonster(e.props.monster)}}))}return null}},{key:"getIcon",value:function(){var e=this;return"candidate"===this.props.mode?r.a.createElement(q.a,{onClick:function(){return e.props.selectMonster(e.props.monster)}}):null}},{key:"render",value:function(){try{var e=this.props.monster.name||"unnamed monster";return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:e},e),this.getIcon()),r.a.createElement("div",{className:"card-content"},r.a.createElement($,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),this.getButtons()))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ee.defaultProps={mode:"editable",library:null,encounters:null,viewMonster:null,editMonster:null,removeMonster:null,exportMonster:null,cloneMonster:null,moveToGroup:null,selectMonster:null};var te=a(259),ae=a(258),ne=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e,t){e.stopPropagation(),this.props.onNudgeValue(t)}},{key:"touchEnd",value:function(e,t){e.preventDefault(),e.stopPropagation(),this.props.onNudgeValue(t)}},{key:"render",value:function(){var e=this;try{var t="info-value";0===this.props.value&&(t+=" disabled");var a=[],n=[],s=this.props.factors||[1];s.forEach((function(t){a.push(r.a.createElement("div",{key:"minus"+t,className:1===t?"spin-button":"spin-button multiple",onTouchEnd:function(a){return e.touchEnd(a,-1*t)},onClick:function(a){return e.click(a,-1*t)}},1===t?r.a.createElement(te.a,null):r.a.createElement("div",null,t))),n.push(r.a.createElement("div",{key:"plus"+t,className:1===t?"spin-button":"spin-button multiple",onTouchEnd:function(a){return e.touchEnd(a,1*t)},onClick:function(a){return e.click(a,1*t)}},1===t?r.a.createElement(ae.a,null):r.a.createElement("div",null,t)))})),a.reverse();var i="minus",o="plus";return this.props.downEnabled||(i+=" disabled"),this.props.upEnabled||(o+=" disabled"),r.a.createElement("div",{className:this.props.disabled?"number-spin disabled":"number-spin"},r.a.createElement("div",{className:i},a),r.a.createElement("div",{className:"info",style:{width:"calc(100% - "+60*s.length+"px)"}},r.a.createElement("div",{className:"info-label"},this.props.label),r.a.createElement("div",{className:t},this.props.value)),r.a.createElement("div",{className:o},n))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ne.defaultProps={label:null,upEnabled:!0,downEnabled:!0,disabled:!1,factors:null};var re=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{for(var t=this.props.itemsPerRow?this.props.itemsPerRow:this.props.options.length,a=Math.ceil(this.props.options.length/t),n=[],s=0;s!==a;++s)n.push([]);this.props.options.forEach((function(a){var s=e.props.options.indexOf(a),i=Math.floor(s/t);n[i].push(r.a.createElement(se,{key:a.id,option:a,selected:a.id===e.props.selectedID,onSelect:function(t){return e.props.onSelect(t)}}))}));var i=n.map((function(e){var t=n.indexOf(e);return r.a.createElement("div",{key:t,className:"selector-row"},e)}));return r.a.createElement("div",{className:this.props.disabled?"selector disabled":"selector"},i)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);re.defaultProps={itemsPerRow:null,disabled:!1};var se=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="option";return this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled"),r.a.createElement("div",{key:this.props.option.id,className:t,title:this.props.option.text,onClick:function(t){return e.click(t)}},this.props.option.text)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ie=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={selectedPartyID:e.party?e.party.id:null,selectedWaveID:null},n}return Object(c.a)(a,[{key:"selectParty",value:function(e){this.setState({selectedPartyID:e})}},{key:"setWave",value:function(e){this.setState({selectedWaveID:e})}},{key:"render",value:function(){var e=this;try{var t=P.getMonsterCount(this.props.encounter,this.state.selectedWaveID),a=P.getEncounterXP(this.props.encounter,this.state.selectedWaveID,this.props.getMonster),n=P.getAdjustedEncounterXP(this.props.encounter,this.state.selectedWaveID,this.props.getMonster),s=null;if(this.props.encounter.waves.length>0){var i=[{id:this.props.encounter.id,text:"encounter"}];this.props.encounter.waves.forEach((function(e){i.push({id:e.id,text:e.name||"unnamed wave"})})),s=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(Y,{placeholder:"encounter plus all waves",options:i,selectedID:this.state.selectedWaveID,onSelect:function(t){return e.setWave(t)},onClear:function(){return e.setWave(null)}}))}var o,c,l=r.a.createElement("div",null,s,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"xp for these monsters"),r.a.createElement(h.a,{span:8,className:"statistic-value"},a," xp"))),r.a.createElement("div",{className:"section",style:{display:n===a?"none":""}},r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"effective xp for ",t," monster(s)"),r.a.createElement(h.a,{span:8,className:"statistic-value"},n," xp")))),u=this.props.parties.find((function(t){return t.id===e.state.selectedPartyID}));if(u){var m=0,p=0,f=0,v=0,g=u.pcs.filter((function(e){return e.active}));g.forEach((function(e){m+=k.pcExperience(e.level,"easy"),p+=k.pcExperience(e.level,"medium"),f+=k.pcExperience(e.level,"hard"),v+=k.pcExperience(e.level,"deadly")}));var b="trivial",y="trivial";if(n>0&&(n>=m&&(b="easy",y="easy"),n>=p&&(b="medium",y="medium"),n>=f&&(b="hard",y="hard"),n>=v&&(b="deadly",y="deadly"),v>0&&n>=10*v&&(b="tpk",y="tpk"),v>0&&n>=100*v&&(b="dm with a grudge",y="dm with a grudge"),v>0&&n>=1e3*v&&(b="now you're just being silly",y="now you're just being silly"),g.length<3||g.length>5)){var E=g.length<3;switch(b){case"trivial":y=E?"easy":"trivial";break;case"easy":y=E?"medium":"trivial";break;case"medium":y=E?"hard":"easy";break;case"hard":y=E?"deadly":"medium";break;case"deadly":y=E?"deadly":"hard";break;default:y=""}}o=r.a.createElement("div",{className:"table"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell easy"},r.a.createElement("b",null,"easy")),r.a.createElement("div",{className:"table-cell medium"},r.a.createElement("b",null,"medium")),r.a.createElement("div",{className:"table-cell hard"},r.a.createElement("b",null,"hard")),r.a.createElement("div",{className:"table-cell deadly"},r.a.createElement("b",null,"deadly"))),r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell"},m," xp"),r.a.createElement("div",{className:"table-cell"},p," xp"),r.a.createElement("div",{className:"table-cell"},f," xp"),r.a.createElement("div",{className:"table-cell"},v," xp")));var w=function(e){return 100*e/Math.max(n,1.2*v)},N=function(e){return 100-w(e)};c=r.a.createElement("div",null,r.a.createElement("div",{className:"difficulty-gauge"},r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar trivial",style:{left:"0",right:N(m)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar easy",style:{left:w(m)+"%",right:N(p)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar medium",style:{left:w(p)+"%",right:N(f)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar hard",style:{left:w(f)+"%",right:N(v)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar deadly",style:{left:w(v)+"%",right:"0"}})),r.a.createElement("div",{className:"encounter-container"},r.a.createElement("div",{className:"encounter",style:{left:w(n)-.5+"%"}}))),l,r.a.createElement("div",{className:"section"},r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"difficulty for this party"),r.a.createElement(h.a,{span:8,className:"statistic-value"},b))),r.a.createElement("div",{className:"section",style:{display:y===b?"none":""}},r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"effective difficulty for ",g.length," pc(s)"),r.a.createElement(h.a,{span:8,className:"statistic-value"},y))))}else c=l;var C=null;if(!this.props.party){var x=[];if(this.props.parties)for(var S=0;S!==this.props.parties.length;++S){var M=this.props.parties[S];x.push({id:M.id,text:M.name})}C=r.a.createElement(Y,{options:x,placeholder:"select party...",selectedID:this.state.selectedPartyID?this.state.selectedPartyID:void 0,onSelect:function(t){return e.selectParty(t)},onClear:function(){return e.selectParty(null)}})}return C?r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"subheading"},"difficulty"),C,o,c):r.a.createElement("div",null,o,c)}catch(I){return console.error(I),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ie.defaultProps={party:null};var oe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;t=r.a.createElement(L.a,{range:!0,min:0,max:30,value:[this.props.filter.challengeMin,this.props.filter.challengeMax],onChange:function(t){return e.props.changeValue("challenge",t)}});var a=null,n=["all sizes"].concat(N).map((function(e){return{id:e,text:e}}));a=r.a.createElement(Y,{options:n,placeholder:"filter by size...",selectedID:this.props.filter.size,onSelect:function(t){return e.props.changeValue("size",t)}});var s=null,i=["all types"].concat(C).map((function(e){return{id:e,text:e}})),o=i.find((function(e){return"aberration"===e.id}));o&&(o.text="aberr.");var c=i.find((function(e){return"celestial"===e.id}));c&&(c.text="celest.");var l=i.find((function(e){return"construct"===e.id}));l&&(l.text="const.");var u=i.find((function(e){return"elemental"===e.id}));u&&(u.text="elem.");var m=i.find((function(e){return"humanoid"===e.id}));m&&(m.text="human.");var p=i.find((function(e){return"monstrosity"===e.id}));p&&(p.text="monst."),s=r.a.createElement(re,{options:i,selectedID:this.props.filter.category,itemsPerRow:3,onSelect:function(t){return e.props.changeValue("category",t)}});var d=null;if(this.props.showRoles){var h=["all roles"].concat(x).map((function(e){return{id:e,text:e}}));d=r.a.createElement(re,{options:h,selectedID:this.props.filter.role,itemsPerRow:2,onSelect:function(t){return e.props.changeValue("role",t)}})}return r.a.createElement("div",null,r.a.createElement(J,{key:"search",text:this.props.filter.name,placeholder:"filter by name",noMargins:!0,onChange:function(t){return e.props.changeValue("name",t)}}),r.a.createElement(Z,{text:"showing "+P.getFilterDescription(this.props.filter)},t,a,s,d,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.resetFilter()}},"clear filter"))))}catch(f){return console.error(f),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);oe.defaultProps={showRoles:!0};var ce=a(249),le=a(248),ue=a(247),me=a(62),pe=a(37),de=a.n(pe),he=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e=this.props.combatant.hpCurrent||0,t=this.props.combatant.hpMax||0,a=this.props.combatant.hpTemp||0,n=t/2,s=100*Math.max(e,0)/(t+a),i="";i=e>=t?"bar unhurt":e<=n?"bar bloodied":"bar injured";var o=null;if(null!==this.props.combatant.hpTemp&&this.props.combatant.hpTemp>0){var c=100*Math.max(this.props.combatant.hpTemp,0)/(t+a);o=r.a.createElement("div",{className:"bar temp",style:{width:c+"%"}})}return r.a.createElement("div",{className:"hp-gauge"},r.a.createElement("div",{className:i,style:{width:s+"%"}}),o)}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),fe=new de.a.Converter;fe.setOption("tables",!0);var ve=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={size:"thumbnail"===e.mode?15:45,selectionStartSquare:null,selectionEndSquare:null},n}return Object(c.a)(a,[{key:"gridSquareMouseDown",value:function(e,t){this.setState({selectionStartSquare:{x:e,y:t},selectionEndSquare:null})}},{key:"gridSquareEntered",value:function(e,t){this.state.selectionStartSquare?this.setState({selectionEndSquare:{x:e,y:t}}):this.props.gridSquareEntered&&this.props.gridSquareEntered(e,t)}},{key:"gridSquareMouseUp",value:function(e,t){var a=this;if(this.state.selectionStartSquare){var n=this.state.selectionStartSquare.x,r=this.state.selectionStartSquare.y;this.setState({selectionStartSquare:null,selectionEndSquare:null},(function(){if(n===e&&r===t)a.props.gridSquareClicked&&a.props.gridSquareClicked(e,t);else if(a.props.gridRectangleSelected){var s=Math.min(n,e),i=Math.min(r,t),o=Math.max(n,e),c=Math.max(r,t);a.props.gridRectangleSelected(s,i,o,c)}}))}}},{key:"isSelected",value:function(e,t){if(this.state.selectionStartSquare&&this.state.selectionEndSquare){var a=Math.min(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),n=Math.min(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y),r=Math.max(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),s=Math.max(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y);return e>=a&&e<=r&&t>=n&&t<=s}return!1}},{key:"getMapDimensions",value:function(){var e=this,t=this.props.viewport;t||(this.props.map.items.filter((function(t){return"edit"!==e.props.mode||"tile"===t.type})).forEach((function(e){t?(t.minX=Math.min(t.minX,e.x),t.maxX=Math.max(t.maxX,e.x+e.width-1),t.minY=Math.min(t.minY,e.y),t.maxY=Math.max(t.maxY,e.y+e.height-1)):t={minX:e.x,maxX:e.x+e.width-1,minY:e.y,maxY:e.y+e.height-1}})),this.props.map.areas.forEach((function(e){t&&(t.minX=Math.min(t.minX,e.x),t.maxX=Math.max(t.maxX,e.x+e.width-1),t.minY=Math.min(t.minY,e.y),t.maxY=Math.max(t.maxY,e.y+e.height-1))})),this.props.combatants.filter((function(e){return e.aura.radius>0})).forEach((function(a){var n=e.props.map.items.find((function(e){return e.id===a.id}));if(n){var r=a.aura.radius/5,s=1,i=a;i&&(s=Math.max(k.miniSize(i.size),1));var o=n.x-r,c=n.x+(s-1)+r,l=n.y-r,u=n.y+(s-1)+r;t&&(t.minX=Math.min(t.minX,o),t.maxX=Math.max(t.maxX,c),t.minY=Math.min(t.minY,l),t.maxY=Math.max(t.maxY,u))}})));if(!t){if("thumbnail"===this.props.mode)return null;t={minX:0,maxX:0,minY:0,maxY:0}}if("thumbnail"===this.props.mode||"combat-player"===this.props.mode){for(var a=[],n=function(n){for(var r=function(t){e.props.fog.find((function(e){return e.x===n&&e.y===t}))||a.push({x:n,y:t})},s=t.minY;s<=t.maxY;++s)r(s)},r=t.minX;r<=t.maxX;++r)n(r);if(a.length>0){var s=a.map((function(e){return e.x})),i=a.map((function(e){return e.y}));t={minX:Math.min.apply(Math,Object(E.a)(s)),maxX:Math.max.apply(Math,Object(E.a)(s)),minY:Math.min.apply(Math,Object(E.a)(i)),maxY:Math.max.apply(Math,Object(E.a)(i))}}}return t.minX-=this.props.paddingSquares,t.maxX+=this.props.paddingSquares,t.minY-=this.props.paddingSquares,t.maxY+=this.props.paddingSquares,t}},{key:"getStyle",value:function(e,t,a,n,r,s){var i=0,o=0;a<1&&(i=(1-a)/2),n<1&&(o=(1-n)/2);var c="0";switch(r){case"rounded":c=this.state.size+"px";break;case"circle":c="50%"}return{left:"calc("+this.state.size+"px * "+(e+i-s.minX)+")",top:"calc("+this.state.size+"px * "+(t+o-s.minY)+")",width:"calc(("+this.state.size+"px * "+a+") + 1px)",height:"calc(("+this.state.size+"px * "+n+") + 1px)",borderRadius:c,backgroundSize:this.state.size+"px"}}},{key:"render",value:function(){var e=this;try{var t=null;"thumbnail"!==this.props.mode&&(t=r.a.createElement(ge,{mapSize:this.state.size,setMapSize:function(t){return e.setState({size:t})},showAreas:"combat"===this.props.mode&&this.props.map.areas.length>0,areas:this.props.map.areas,selectArea:function(t){return e.props.areaSelected(t)}}));var a=this.getMapDimensions();if(!a)return r.a.createElement("div",{className:"section centered"},"(blank map)");var n=[];"edit"!==this.props.mode&&"combat"!==this.props.mode||(n=this.props.map.areas.map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,"square",a);return r.a.createElement(be,{key:t.id,style:n,selected:e.props.selectedItemIDs.includes(t.id)})})));var s=this.props.map.items.filter((function(e){return"tile"===e.type})).map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,t.style,a);return r.a.createElement(Ee,{key:t.id,tile:t,style:n,selectable:"edit"===e.props.mode,selected:e.props.selectedItemIDs.includes(t.id),select:function(t,a){return"edit"===e.props.mode?e.props.itemSelected(t,a):null}})})),i=[];this.props.showAreaNames&&(i=this.props.map.areas.map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,null,a);return r.a.createElement("div",{key:t.id+" name",className:"map-area-name",style:n},t.name)})));var o=[];"edit"!==this.props.mode&&(o=this.props.fog.map((function(t){var n=e.getStyle(t.x,t.y,1,1,"square",a);return r.a.createElement(ye,{key:t.x+","+t.y,x:t.x,y:t.y,style:n,mode:"fog"})})));var c=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(c=this.props.map.items.filter((function(e){return"overlay"===e.type})).map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,t.style,a);return n.backgroundColor=t.color+t.opacity.toString(16),r.a.createElement(ke,{key:t.id,overlay:t,style:n,selected:e.props.selectedItemIDs.includes(t.id),select:function(t,a){return e.props.itemSelected(t,a)}})})));var l=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(l=this.props.combatants.filter((function(e){return e.aura.radius>0})).filter((function(t){return t.showOnMap||"combat-player"!==e.props.mode})).map((function(t){var n=e.props.map.items.find((function(e){return e.id===t.id}));if(n){var s=t.aura.radius/5,i=2*s+Math.max(k.miniSize(t.displaySize),1),o=e.getStyle(n.x-s,n.y-s,i,i,t.aura.style,a);return o.backgroundColor=t.aura.color,r.a.createElement("div",{key:t.id+" aura",className:"aura",style:o})}return null})).filter((function(e){return null!==e})));var u=[];if("edit"!==this.props.mode){var m=this.props.combatants.map((function(e){return e.mountID||""})).filter((function(e){return""!==e}));u=this.props.map.items.filter((function(e){return"monster"===e.type||"pc"===e.type||"companion"===e.type||"token"===e.type})).filter((function(e){return!m.includes(e.id)})).sort((function(t,a){var n=e.props.combatants.find((function(e){return e.id===t.id})),r=e.props.combatants.find((function(e){return e.id===a.id})),s=n?n.displaySize:t.size,i=r?r.displaySize:a.size;return k.miniSize(i)-k.miniSize(s)})).map((function(t){var n=k.miniSize(t.size),s=!1,i=e.props.combatants.find((function(e){return e.id===t.id}));if(i){var o=i.displaySize;if(i.mountID){var c=e.props.combatants.find((function(e){return e.id===i.mountID}));c&&(o=c.displaySize)}n=k.miniSize(o),s="pc"===i.type}var l=e.getStyle(t.x,t.y,n,n,"circle",a);return r.a.createElement(we,{key:t.id,token:t,combatant:i||null,style:l,simple:"thumbnail"===e.props.mode,showGauge:"combat"===e.props.mode,showHidden:"combat"===e.props.mode||s,selectable:"combat"===e.props.mode||"combat-player"===e.props.mode,selected:e.props.selectedItemIDs.includes(t.id),select:function(t,a){return e.props.itemSelected(t,a)}})}))}var p=[];if(this.props.showGrid)for(var d=a.minY;d!==a.maxY+1;++d)for(var h=a.minX;h!==a.maxX+1;++h){var f=this.getStyle(h,d,1,1,"square",a);p.push(r.a.createElement(ye,{key:h+","+d,x:h,y:d,style:f,mode:"cell",selected:this.isSelected(h,d),onMouseDown:function(t,a){return e.gridSquareMouseDown(t,a)},onMouseUp:function(t,a){return e.gridSquareMouseUp(t,a)},onMouseEnter:function(t,a){return e.gridSquareEntered(t,a)}}))}var v=null;if(this.props.focussedSquare){var g=this.getStyle(this.props.focussedSquare.x-1,this.props.focussedSquare.y-1,3,3,"circle",a);v=r.a.createElement("div",{className:"grid-focus",style:g})}var b="map-panel "+this.props.mode,y=1+a.maxX-a.minX,E=1+a.maxY-a.minY,w=this.state.size*y+2,N=this.state.size*E+2;return t&&(N+=42),r.a.createElement("div",{className:b,style:{width:w+"px",height:N+"px"},onClick:function(){return e.props.itemSelected?e.props.itemSelected(null,!1):null}},t,r.a.createElement("div",{className:"grid"},n,s,i,o,c,l,u,p,v))}catch(C){return console.error(C),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ve.defaultProps={mode:"thumbnail",viewport:null,paddingSquares:0,combatants:[],showGrid:!1,showAreaNames:!1,selectedItemIDs:[],fog:[],focussedSquare:null,itemSelected:null,areaSelected:null,gridSquareEntered:null,gridSquareClicked:null,gridRectangleUpdated:null,gridRectangleSelected:null};var ge=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"nudgeSize",value:function(e){var t=Math.max(this.props.mapSize+e,3);this.props.setMapSize(t)}},{key:"render",value:function(){var e=this;try{var t=[];if(t.push(r.a.createElement(ne,{key:"zoom",value:"zoom",downEnabled:this.props.mapSize>3,onNudgeValue:function(t){return e.nudgeSize(3*t)}})),this.props.showAreas){var a=[{id:"",text:"whole map"}];this.props.areas.forEach((function(e){a.push({id:e.id,text:e.name})})),t.push(r.a.createElement(Y,{key:"areas",options:a,placeholder:"select a map area...",onSelect:function(t){return e.props.selectArea(t)}}))}return r.a.createElement("div",{className:"map-menu"},t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),be=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e="map-area";return this.props.selected&&(e+=" selected"),r.a.createElement("div",{className:e,style:this.props.style})}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ye=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"mouseDown",value:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(this.props.x,this.props.y)}},{key:"mouseUp",value:function(e){e.stopPropagation(),this.props.onMouseUp&&this.props.onMouseUp(this.props.x,this.props.y)}},{key:"mouseEnter",value:function(e){e.stopPropagation(),this.props.onMouseEnter&&this.props.onMouseEnter(this.props.x,this.props.y)}},{key:"doubleClick",value:function(e){e.stopPropagation(),this.props.onDoubleClick&&this.props.onDoubleClick(this.props.x,this.props.y)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"grid-square "+this.props.mode+(this.props.selected?" selected":""),style:this.props.style,onMouseDown:function(t){return e.mouseDown(t)},onMouseUp:function(t){return e.mouseUp(t)},onMouseEnter:function(t){return e.mouseEnter(t)},onDoubleClick:function(t){return e.doubleClick(t)}})}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ye.defaultProps={selected:!1,onMouseDown:null,onMouseUp:null,onMouseEnter:null,onDoubleClick:null};var Ee=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"select",value:function(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.tile.id,e.ctrlKey))}},{key:"render",value:function(){var e=this;try{var t="tile "+this.props.tile.terrain;this.props.selected&&(t+=" selected");var a=null;if("custom"===this.props.tile.terrain){var n=window.localStorage.getItem("image-"+this.props.tile.customBackground);if(n){var s=JSON.parse(n);a=r.a.createElement("img",{className:"custom-image",alt:"map tile",src:s.data})}}var i=null;if(this.props.tile.content)switch(this.props.tile.content.type){case"doorway":switch(this.props.tile.content.style){case"single":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}))}break;case"double":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"25%",x2:"50%",y2:"75%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}),r.a.createElement("line",{className:"thin",x1:"25%",y1:"50%",x2:"75%",y2:"50%"}))}break;case"arch":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"20%",y2:"50%"}),r.a.createElement("line",{className:"thick",x1:"80%",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"20%",y2:"80%"}),r.a.createElement("line",{className:"medium",x1:"80%",y1:"20%",x2:"80%",y2:"80%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"20%"}),r.a.createElement("line",{className:"thick",x1:"50%",y1:"80%",x2:"50%",y2:"100%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"80%",y2:"20%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"80%",x2:"80%",y2:"80%"}))}break;case"bars":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"10%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"30%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"70%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"90%",cy:"50%",r:"5%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"10%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"30%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"70%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"90%",r:"5%"}))}}break;case"stairway":switch(this.props.tile.content.style){case"stairs":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thin",x1:"0",y1:"12.5%",x2:"100%",y2:"12.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"25%",x2:"100%",y2:"25%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"37.5%",x2:"100%",y2:"37.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"62.5%",x2:"100%",y2:"62.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"75%",x2:"100%",y2:"75%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"87.5%",x2:"100%",y2:"87.5%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thin",x1:"12.5%",y1:"0",x2:"12.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"25%",y1:"0",x2:"25%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"37.5%",y1:"0",x2:"37.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"62.5%",y1:"0",x2:"62.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"75%",y1:"0",x2:"75%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"87.5%",y1:"0",x2:"87.5%",y2:"100%"}))}break;case"spiral":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("ellipse",{className:"thin outline",cx:"50%",cy:"50%",rx:"40%",ry:"40%"}),r.a.createElement("ellipse",{className:"thin filled",cx:"50%",cy:"50%",rx:"10%",ry:"10%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"10%",x2:"50%",y2:"90%"}),r.a.createElement("line",{className:"thin",x1:"10%",y1:"50%",x2:"90%",y2:"50%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"20%",x2:"80%",y2:"80%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"80%",x2:"80%",y2:"20%"}));break;case"ladder":switch(this.props.tile.content.orientation){case"horizontal":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"20%",cy:"50%",r:"7%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"50%",x2:"80%",y2:"50%"}),r.a.createElement("circle",{className:"thin filled",cx:"80%",cy:"50%",r:"7%"}));break;case"vertical":i=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"20%",r:"7%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"20%",x2:"50%",y2:"80%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"80%",r:"7%"}))}}}return r.a.createElement("div",{className:t,style:this.props.style,onClick:function(t){return e.select(t)}},a,i)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ke=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"select",value:function(e){e.stopPropagation(),this.props.select(this.props.overlay.id,e.ctrlKey)}},{key:"render",value:function(){var e=this;try{var t="overlay";return this.props.selected&&(t+=" selected"),r.a.createElement("div",{className:t,style:this.props.style,onClick:function(t){return e.select(t)}})}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),we=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"select",value:function(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.token.id,e.ctrlKey))}},{key:"getNoteText",value:function(){var e=this.props.combatant?"**"+this.props.combatant.displayName+"**":"";return this.props.combatant&&(this.props.combatant.showOnMap||(e+="\n\n",e+="**hidden**"),this.props.combatant.tags.forEach((function(t){e+="\n\n",e+="**"+k.getTagTitle(t)+"**",e+="\n\n",e+="* "+k.getTagDescription(t)})),this.props.combatant.conditions.forEach((function(t){e+="\n\n",e+="**"+t.name+"**",k.conditionText(t).forEach((function(t){e+="\n\n",e+="* "+t}))}))),e.trim()}},{key:"render",value:function(){var e=this;try{var t="token",a="token";if(this.props.selected&&(a+=" selected"),this.props.combatant&&(t=this.props.combatant.displayName||"combatant",a+=" "+this.props.combatant.faction,this.props.combatant.current&&(a+=" current"),!this.props.combatant.showOnMap)){if(!this.props.showHidden)return null;a+=" hidden"}var n=null,s=null,i=null,o=null;if(this.props.combatant&&!this.props.simple){var c="",l=this.props.combatant;if(l&&l.portrait){var u=window.localStorage.getItem("image-"+l.portrait);if(u)c=JSON.parse(u).data}if(c)n=r.a.createElement("img",{className:"portrait",src:c,alt:t});else{var m=t.toUpperCase().replace(/[^A-Z0-9 ]/,"").split(" ").map((function(e){return e[0]})).join("");n=r.a.createElement("div",{className:"initials"},m)}if("monster"===this.props.combatant.type&&this.props.showGauge)(this.props.combatant.hpCurrent||0)<(this.props.combatant.hpMax||0)&&(s=r.a.createElement(he,{combatant:this.props.combatant}));this.props.combatant.altitude>0&&(i=r.a.createElement("div",{className:"badge"},r.a.createElement(ce.a,{twoToneColor:"#3c78dc"}))),this.props.combatant.altitude<0&&(i=r.a.createElement("div",{className:"badge"},r.a.createElement(le.a,{twoToneColor:"#3c78dc"})));var p=0;this.props.combatant.conditions&&(p+=this.props.combatant.conditions.length),this.props.combatant.tags&&(p+=this.props.combatant.tags.filter((function(e){return!e.startsWith("engaged")})).length),p>0&&(o=r.a.createElement("div",{className:"conditions"},r.a.createElement(ue.a,{twoToneColor:"#3c78dc"})))}var d=r.a.createElement("div",{className:a,style:this.props.style,onClick:function(t){return e.select(t)}},n,s,i,o),h=this.getNoteText();return h?r.a.createElement(me.a,{placement:"bottom",title:r.a.createElement("div",{dangerouslySetInnerHTML:{__html:fe.makeHtml(h)}})},d):d}catch(f){return console.error(f),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ne=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e="note";return this.props.white&&(e+=" white"),r.a.createElement("div",{className:e},this.props.children)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ne.defaultProps={white:!1};var Ce=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={combatSetup:e.combatSetup,partyFixed:!!e.combatSetup.party,encounterFixed:!!e.combatSetup.encounter,mapFixed:!!e.combatSetup.map},n}return Object(c.a)(a,[{key:"setPartyID",value:function(e){var t=this,a=this.state.combatSetup,n=this.props.parties.find((function(t){return t.id===e}));a.party=n?JSON.parse(JSON.stringify(n)):null,this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"setEncounterID",value:function(e){var t=this,a=this.state.combatSetup,n=this.props.encounters.find((function(t){return t.id===e}));a.encounter=n?JSON.parse(JSON.stringify(n)):null,a.slotInfo=k.getCombatSlotData(a.encounter,this.props.library),this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"setMapID",value:function(e){var t=this.props.maps.find((function(t){return t.id===e})),a=this.state.combatSetup;a.map=t||null,this.setState({combatSetup:a})}},{key:"setWaveID",value:function(e){var t=this,a=this.state.combatSetup;if(a.waveID=e,a.encounter){var n=a.encounter.waves.find((function(t){return t.id===e}));n&&(a.slotInfo=k.getCombatSlotData(n,this.props.library))}this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"generateEncounter",value:function(e){var t=this,a=y.createEncounter();a.name="new encounter";var n=y.createMonsterFilter(),r=0,s=0;if(this.state.combatSetup.party){var i=this.state.combatSetup.party.pcs.filter((function(e){return e.active}));i.forEach((function(t){r+=k.pcExperience(t.level,e),s+=t.level}));var o=s/i.length;n.challengeMax=Math.max(o,5)}P.buildEncounter(a,r,n,this.props.library,this.props.getMonster);var c=this.state.combatSetup;c.encounter=a,c.slotInfo=k.getCombatSlotData(a,this.props.library),this.setState({combatSetup:c},(function(){return t.props.notify()}))}},{key:"generateMap",value:function(e){var t=this,a=y.createMap();a.name="new map",T.generate(e,a);var n=this.state.combatSetup;n.map=a,this.setState({combatSetup:n},(function(){return t.props.notify()}))}},{key:"changeValue",value:function(e,t,a){e[t]=a;var n=e;n.members&&("init"===t&&n.members.forEach((function(e){return e.init=a})),"hp"===t&&n.members.forEach((function(e){return e.hp=a}))),this.setState({combatSetup:this.state.combatSetup})}},{key:"nudgeValue",value:function(e,t,a){e[t]=e[t]+a;var n=this.state.combatSetup;if(n.encounter){if(n.waveID){var r=n.encounter.waves.find((function(e){return e.id===n.waveID}));r&&(n.slotInfo=k.getCombatSlotData(r,this.props.library))}else n.slotInfo=k.getCombatSlotData(n.encounter,this.props.library);this.setState({combatSetup:n})}}},{key:"render",value:function(){var e=this;try{var t=null,a=null;switch(this.props.type){case"start":t=r.a.createElement("div",null,r.a.createElement(xe,{combatSetup:this.state.combatSetup,parties:this.props.parties,fixed:this.state.partyFixed,setPartyID:function(t){return e.setPartyID(t)}}),r.a.createElement(Se,{combatSetup:this.state.combatSetup,encounters:this.props.encounters,fixed:this.state.encounterFixed,setEncounterID:function(t){return e.setEncounterID(t)},generateEncounter:function(t){return e.generateEncounter(t)}}),r.a.createElement(Me,{combatSetup:this.state.combatSetup,maps:this.props.maps,fixed:this.state.mapFixed,setMapID:function(t){return e.setMapID(t)},generateMap:function(t){return e.generateMap(t)}})),a=r.a.createElement("div",null,r.a.createElement(De,{combatSetup:this.state.combatSetup,parties:this.props.parties,encounters:this.props.encounters,getMonster:function(t){return e.props.getMonster(t)}}),r.a.createElement(je,{type:this.props.type,combatSetup:this.state.combatSetup,parties:this.props.parties,getMonster:function(t){return e.props.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}));break;case"add-wave":t=r.a.createElement("div",null,r.a.createElement(Ie,{combatSetup:this.state.combatSetup,setWaveID:function(t){return e.setWaveID(t)}})),a=r.a.createElement("div",null,r.a.createElement(je,{type:this.props.type,combatSetup:this.state.combatSetup,parties:this.props.parties,getMonster:function(t){return e.props.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}));break;case"add-combatants":t=r.a.createElement("div",null,r.a.createElement(Oe,{combatSetup:this.state.combatSetup,library:this.props.library,addMonster:function(t){return e.props.addMonster(t)}})),a=r.a.createElement("div",null,r.a.createElement(je,{type:this.props.type,combatSetup:this.state.combatSetup,parties:this.props.parties,getMonster:function(t){return e.props.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}))}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},t),r.a.createElement(h.a,{span:12,className:"scrollable"},a))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ce.defaultProps={parties:null,encounters:null,maps:null,addMonster:null};var xe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;if(0===this.props.parties.length)return r.a.createElement("div",{className:"section"},"you have not defined any parties");var t=null;if(!this.props.combatSetup.party){var a=this.props.parties.map((function(e){return{id:e.id,text:e.name||"unnamed party"}}));t=r.a.createElement(Y,{options:a,placeholder:"select a party",onSelect:function(t){return e.props.setPartyID(t)}})}var n=null;if(this.props.combatSetup.party){var s=this.props.combatSetup.party.pcs.filter((function(e){return e.active})).map((function(e){return r.a.createElement("div",{key:e.id,className:"group-panel"},e.name||"unnamed pc"," (level ",e.level,")")}));0===s.length&&s.push(r.a.createElement(Ne,{key:"empty"},"no pcs")),n=r.a.createElement("div",null,s)}var i=null;return this.props.combatSetup.party&&!this.props.fixed&&(i=r.a.createElement(R.a,{onClick:function(){return e.props.setPartyID(null)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"party",i),t,n)}}]),a}(r.a.Component),Se=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=null;if(!this.props.combatSetup.encounter){var a=null;if(this.props.encounters.length>0){var n=this.props.encounters.map((function(e){return{id:e.id,text:e.name||"unnamed encounter"}}));a=r.a.createElement(Y,{options:n,placeholder:"select an encounter",onSelect:function(t){return e.props.setEncounterID(t)}})}var s=null;this.props.combatSetup.party&&(s=r.a.createElement("button",{onClick:function(){return e.props.generateEncounter("medium")}},"generate a random encounter")),t=r.a.createElement("div",null,a,s)}var i=null;if(this.props.combatSetup.encounter){var o=this.props.combatSetup.encounter.slots.map((function(e){var t=e.monsterName||"unnamed monster";return e.count>1&&(t+=" (x"+e.count+")"),r.a.createElement("div",{key:e.id,className:"group-panel"},t)}));0===o.length&&o.push(r.a.createElement(Ne,{key:"empty"},"no monsters")),i=r.a.createElement("div",null,o)}var c=null;return this.props.combatSetup.encounter&&!this.props.fixed&&(c=r.a.createElement(R.a,{onClick:function(){return e.props.setEncounterID(null)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"encounter",c),t,i)}}]),a}(r.a.Component),Me=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=null;if(!this.props.combatSetup.map){var a=null;if(this.props.maps.length>0){var n=this.props.maps.map((function(e){return{id:e.id,text:e.name||"unnamed map",display:r.a.createElement(ve,{map:e})}}));a=r.a.createElement(Y,{options:n,placeholder:"select a map",onSelect:function(t){return e.props.setMapID(t)}})}t=r.a.createElement("div",null,r.a.createElement(Ne,null,"this is optional - you don't have to use a map to run an encounter"),a,r.a.createElement("button",{onClick:function(){return e.props.generateMap("delve")}},"generate a random delve"))}var s=null;this.props.combatSetup.map&&(s=r.a.createElement(ve,{map:this.props.combatSetup.map,combatants:this.props.combatSetup.combatants}));var i=null;return this.props.combatSetup.map&&!this.props.fixed&&(i=r.a.createElement(R.a,{onClick:function(){return e.props.setMapID(null)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"map",i),t,s)}}]),a}(r.a.Component),Ie=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;if(null===this.props.combatSetup.encounter)return r.a.createElement("div",{className:"section"},"you have not selected an encounter");if(0===this.props.combatSetup.encounter.waves.length)return r.a.createElement("div",{className:"section"},"you have not defined any waves");var t=this.props.combatSetup.encounter.waves.map((function(e){return{id:e.id,text:e.name||"unnamed wave"}})),a=null;if(this.props.combatSetup.waveID){var n=this.props.combatSetup.encounter.waves.find((function(t){return t.id===e.props.combatSetup.waveID}));if(n){var s=n.slots.map((function(e){var t=e.monsterName||"unnamed monster";return e.count>1&&(t+=" (x"+e.count+")"),r.a.createElement("div",{key:e.id,className:"group-panel"},t)}));0===s.length&&s.push(r.a.createElement(Ne,{key:"empty"},"no monsters")),a=r.a.createElement("div",null,s)}}return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"wave"),r.a.createElement(Y,{options:t,placeholder:"select wave",selectedID:this.props.combatSetup.waveID?this.props.combatSetup.waveID:void 0,onSelect:function(t){return e.props.setWaveID(t)},onClear:function(){return e.props.setWaveID(null)}}),a)}}]),a}(r.a.Component),Oe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={filter:y.createMonsterFilter()},n}return Object(c.a)(a,[{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:y.createMonsterFilter()})}},{key:"matchMonster",value:function(e){return P.matchMonster(e,this.state.filter)}},{key:"render",value:function(){var e=this,t=[];this.props.library.forEach((function(a){a.monsters.forEach((function(a){e.matchMonster(a)&&t.push(a)}))})),t.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var a=this.props.combatSetup.slotInfo.map((function(e){return e.id})),n=t.filter((function(e){return!a.includes(e.id)})).map((function(t){return r.a.createElement(ee,{key:t.id,monster:t,mode:"candidate",selectMonster:function(t){return e.props.addMonster(t)}})}));return 0===n.length&&(n=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"there are no monsters that match the above criteria (or you have already selected them all)"))),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement(oe,{filter:this.state.filter,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}}),n)}}]),a}(r.a.Component),De=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return this.props.combatSetup.party&&this.props.combatSetup.encounter?r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"encounter difficulty"),r.a.createElement(ie,{parties:this.props.parties,party:this.props.combatSetup.party,encounter:this.props.combatSetup.encounter,getMonster:function(t){return e.props.getMonster(t)}})):r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"encounter difficulty"),r.a.createElement("div",{className:"section"},"select a party and an encounter on the left to see difficulty information."))}}]),a}(r.a.Component),je=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"initiative"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"render",value:function(){var e,t=this;if("start"===this.props.type&&!this.props.combatSetup.encounter)return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement("div",{className:"section"},"select an encounter to see monster information here."));if("add-wave"===this.props.type&&!this.props.combatSetup.waveID)return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement("div",{className:"section"},"select a wave to see monster information here."));if("add-combatants"===this.props.type&&0===(null===(e=this.props.combatSetup.encounter)||void 0===e?void 0:e.slots.length))return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement("div",{className:"section"},"add monsters to see their information here."));if(this.props.combatSetup.encounter){var a=this.props.combatSetup.encounter;if(this.props.combatSetup.waveID){var n=this.props.combatSetup.encounter.waves.find((function(e){return e.id===t.props.combatSetup.waveID}));n&&(a=n)}if(0===a.slots.length)return null;var s=["initiative","hit points","names","advanced"].map((function(e){return{id:e,text:e}})),i=this.props.combatSetup.slotInfo.map((function(e){var n=a.slots.find((function(t){return t.id===e.id}));if(!n)return null;var s=t.props.getMonster(n.monsterID);return s?r.a.createElement(Te,{key:e.id,slotInfo:e,encounterSlot:n,monster:s,view:t.state.view,changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeValue:function(e,a,n){return t.props.nudgeValue(e,a,n)}}):null}));return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement(re,{options:s,selectedID:this.state.view,onSelect:function(e){return t.setView(e)}}),r.a.createElement("hr",null),r.a.createElement("div",null,i))}return null}}]),a}(r.a.Component),Te=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"rollInit",value:function(e){var t=k.dieRoll(),a=k.modifierValue(this.props.monster.abilityScores.dex);this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"init",t+a)}},{key:"rollHP",value:function(e){var t=k.hitDieType(this.props.monster.size),a=k.dieRoll(t,this.props.monster.hitDice),n=k.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice;this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"hp",a+n)}},{key:"getValueSection",value:function(e,t,a,n,s){var i=this;return r.a.createElement(d.a,{align:"middle"},r.a.createElement(h.a,{span:20},r.a.createElement(L.a,{min:e,max:t,value:a[n],onChange:function(e){return i.props.changeValue(a,n,e)}})),r.a.createElement(h.a,{span:4},r.a.createElement("div",{className:"combatant-value"},a[n],r.a.createElement(z.a,{onClick:function(){return s()}}))))}},{key:"getInitSection",value:function(){var e=this,t=null;this.props.encounterSlot.count>1&&(t=r.a.createElement(A,{label:"roll initiative once for this group",checked:this.props.slotInfo.useGroupInit,onChecked:function(t){return e.props.changeValue(e.props.slotInfo,"useGroupInit",t)}}));var a=k.modifierValue(this.props.monster.abilityScores.dex),n=1+a,s=20+a,i=[];return this.props.slotInfo.useGroupInit?i.push(r.a.createElement("div",{key:"init"},this.getValueSection(n,s,this.props.slotInfo,"init",(function(){return e.rollInit(null)})))):this.props.slotInfo.members.forEach((function(t){i.push(r.a.createElement("div",{key:t.id},r.a.createElement("div",{className:"combatant-name"},t.name),e.getValueSection(n,s,t,"init",(function(){return e.rollInit(t)}))))})),r.a.createElement("div",null,t,i)}},{key:"getHPSection",value:function(){var e=this,t=null;this.props.encounterSlot.count>1&&(t=r.a.createElement(A,{label:"roll hit points once for this group",checked:this.props.slotInfo.useGroupHP,onChecked:function(t){return e.props.changeValue(e.props.slotInfo,"useGroupHP",t)}}));var a=M.getTypicalHP(this.props.monster),n=k.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice,s=this.props.monster.hitDice+n,i=this.props.monster.hitDice*k.hitDieType(this.props.monster.size)+n,o=[];return this.props.slotInfo.useGroupHP?o.push(r.a.createElement("div",{key:"hp"},this.getValueSection(s,i,this.props.slotInfo,"hp",(function(){return e.rollHP(null)})),r.a.createElement("button",{className:this.props.slotInfo.hp!==a?"":"disabled",onClick:function(){return e.props.changeValue(e.props.slotInfo,"hp",a)}},"reset to average hp"))):this.props.slotInfo.members.forEach((function(t){o.push(r.a.createElement("div",{key:t.id},r.a.createElement("div",{className:"combatant-name"},t.name),e.getValueSection(s,i,t,"hp",(function(){return e.rollHP(t)})),r.a.createElement("button",{className:t.hp!==a?"":"disabled",onClick:function(){return e.props.changeValue(t,"hp",a)}},"reset to average hp")))})),r.a.createElement("div",null,t,o)}},{key:"getNameSection",value:function(){var e=this;return this.props.slotInfo.members.map((function(t){return r.a.createElement(J,{key:t.id,text:t.name,onChange:function(a){return e.props.changeValue(t,"name",a)}})}))}},{key:"getCountSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(ne,{value:"count: "+this.props.encounterSlot.count,downEnabled:this.props.encounterSlot.count>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.encounterSlot,"count",t)}}),r.a.createElement(Y,{options:["foe","neutral","ally"].map((function(e){return{id:e,text:"faction: "+e}})),selectedID:this.props.encounterSlot.faction,onSelect:function(t){return e.props.changeValue(e.props.encounterSlot,"faction",t)}}))}},{key:"render",value:function(){var e=this.props.encounterSlot.monsterName,t=null;switch(this.props.view){case"initiative":e+=" (1d20 "+k.modifier(this.props.monster.abilityScores.dex)+")",t=this.getInitSection();break;case"hit points":e+=" ("+M.getTypicalHPString(this.props.monster)+")",t=this.getHPSection();break;case"names":t=this.getNameSection();break;case"advanced":t=this.getCountSection()}return r.a.createElement("div",{className:"group-panel combatant-setup"},r.a.createElement("div",{className:"subheading"},e),r.a.createElement("hr",null),t)}}]),a}(r.a.Component),Ve=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.items.map((function(t){return r.a.createElement(Pe,{key:t.id,item:t,selected:e.props.selectedItemID===t.id,onSelect:function(t){return e.props.onSelect(t)}})}));return r.a.createElement("div",{className:"radio-group"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Pe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.onSelect(this.props.item.id)}},{key:"render",value:function(){var e=this;try{var t="radio-item",a=null;return this.props.selected&&(t+=" selected",this.props.item.details&&(a=r.a.createElement("div",{className:"radio-item-details"},this.props.item.details))),this.props.item.disabled&&(t+=" disabled"),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)}},r.a.createElement("div",{className:"radio-item-top"},r.a.createElement("div",{className:"radio-item-text"},this.props.item.text),r.a.createElement("div",{className:"radio-item-info"},this.props.item.info)),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ae=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={condition:e.condition},n}return Object(c.a)(a,[{key:"setCondition",value:function(e){if(this.state.condition.name!==e){var t=this.state.condition;t.name=e,t.level=1,t.text="",this.setState({condition:t})}}},{key:"setDuration",value:function(e){var t=null;switch(e){case"saves":t=y.createConditionDurationSaves();break;case"combatant":t=y.createConditionDurationCombatant();break;case"rounds":t=y.createConditionDurationRounds()}var a=this.state.condition;a.duration=t,this.setState({condition:a})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({condition:this.state.condition})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t]+a;"level"===t&&(n=Math.max(n,1),n=Math.min(n,6)),"count"===t&&(n=Math.max(n,1)),"saveDC"===t&&(n=Math.max(n,0)),e[t]=n,this.setState({condition:this.state.condition})}},{key:"render",value:function(){var e=this;try{var t=w.map((function(t){var a=[],n=[];if(t===e.state.condition.name){"exhaustion"===t&&a.push(r.a.createElement(ne,{key:"exhaustion-spin",value:e.props.condition.level,label:"exhaustion",downEnabled:e.props.condition.level>1,upEnabled:e.props.condition.level<6,onNudgeValue:function(t){return e.nudgeValue(e.props.condition,"level",t)}}));for(var s=k.conditionText(e.state.condition),i=0;i!==s.length;++i)n.push(r.a.createElement("li",{key:i,className:"section"},s[i]))}var o=e.props.combatants.filter((function(e){return"monster"===e.type})).some((function(e){return!!e&&-1!==e.conditionImmunities.indexOf(t)}));return{id:t,text:t,details:r.a.createElement("div",{key:t},a,r.a.createElement("ul",null,n)),disabled:o}})),a=["str","dex","con","int","wis","cha","death"].map((function(e){return{id:e,text:e}})),n=[{id:"start",text:"start of turn"},{id:"end",text:"end of turn"}],s=this.props.allCombatants.filter((function(e){return"placeholder"!==e.type})).map((function(e){var t=e;return{id:t.id,text:t.displayName||t.name||"unnamed monster"}}));b.sort(s,[{field:"text",dir:"asc"}]);var i=[{id:"none",text:"until removed (default)",details:r.a.createElement("div",{className:"section"},r.a.createElement("div",null,"the condition persists until it is manually removed"))},{id:"saves",text:"until a successful save",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"number of saves required"),r.a.createElement(ne,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"count",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"save dc"),r.a.createElement(ne,{value:this.props.condition.duration?"dc "+this.props.condition.duration.saveDC:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.saveDC>0,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"saveDC",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"type of save"),r.a.createElement(re,{options:a,selectedID:this.props.condition.duration?this.props.condition.duration.saveType:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"saveType",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"make the save at the start or end of the turn"),r.a.createElement(re,{options:n,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"point",t)}})))},{id:"combatant",text:"until someone's next turn",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"start or end of the turn"),r.a.createElement(re,{options:n,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"point",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"combatant"),r.a.createElement(Y,{options:s,selectedID:this.props.condition.duration&&this.props.condition.duration.combatantID||void 0,onSelect:function(t){return e.changeValue(e.props.condition.duration,"combatantID",t)}})))},{id:"rounds",text:"for a number of rounds",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"number of rounds"),r.a.createElement(ne,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"count",t)}})))}];return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"heading"},"condition"),r.a.createElement(Ve,{items:t,selectedItemID:this.state.condition.name,onSelect:function(t){return e.setCondition(t)}})),r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"heading"},"duration"),r.a.createElement(Ve,{items:i,selectedItemID:this.state.condition.duration?this.state.condition.duration.type:"none",onSelect:function(t){return e.setDuration(t)}})))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Re=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{if(0===this.props.data.length)return null;var t,a=Math.max.apply(Math,Object(E.a)(this.props.data.map((function(e){return e.value}))));if(this.props.collapse)t=this.props.data.filter((function(e){return e.value>0}));else{var n=this.props.data.find((function(e){return e.value>0}));this.props.data.reverse();var s=this.props.data.find((function(e){return e.value>0}));this.props.data.reverse();var i=n?this.props.data.indexOf(n):0,o=s?this.props.data.indexOf(s):this.props.data.length-1;t=this.props.data.slice(i,o+1)}var c=t.map((function(t){return r.a.createElement("div",{key:t.text,className:"bar-container"},r.a.createElement("div",{className:"bar",style:{width:"calc((100% - 1px) * "+t.value+" / "+a+")"}},r.a.createElement("div",{className:"label"},t.text,": ",e.props.onFormatValue(t.value))))}));return r.a.createElement("div",{className:"plot"},c)}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Re.defaultProps={collapse:!1,onFormatValue:function(e){return e.toString()}};var ze=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={chart:"challenge"},n}return Object(c.a)(a,[{key:"selectChart",value:function(e){this.setState({chart:e})}},{key:"render",value:function(){var e=this;try{var t=[];if(this.props.groups.forEach((function(e){return e.monsters.forEach((function(e){return t.push(e)}))})),0===t.length)return null;var a=[];switch(this.state.chart){case"challenge":a=[0,.125,.25,.5,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30].map((function(e){return{text:"cr "+k.challenge(e),value:t.filter((function(t){return t.challenge===e})).length}}));break;case"size":a=N.map((function(e){return{text:e,value:t.filter((function(t){return t.size===e})).length}}));break;case"type":a=C.map((function(e){return{text:e,value:t.filter((function(t){return t.category===e})).length}}))}return r.a.createElement("div",{className:"scrollable padded"},r.a.createElement(re,{options:[{id:"challenge",text:"challenge rating"},{id:"size",text:"size"},{id:"type",text:"type"}],selectedID:this.state.chart,onSelect:function(t){return e.selectChart(t)}}),r.a.createElement(Re,{data:a}))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Le=a(223),qe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t="monster",a=null,n=[];if(this.props.monster){t=this.props.monster.name;var s=[],i=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();this.props.monster.tag&&(i+=" ("+this.props.monster.tag.toLowerCase()+")"),s.push(r.a.createElement(F.a,{key:"tag-main"},i)),this.props.monster.alignment&&s.push(r.a.createElement(F.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),s.push(r.a.createElement(F.a,{key:"tag-cr"},"cr ",k.challenge(this.props.monster.challenge))),a=r.a.createElement("div",{className:"stats"},r.a.createElement($,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},s)),n.push(r.a.createElement("button",{key:"view",onClick:function(){return e.props.viewMonster(e.props.monster)}},"statblock"))}else a=r.a.createElement(Ne,{white:!0},r.a.createElement("div",{className:"section"},"this empty slot has been added because you are creating an encounter from a template"),r.a.createElement("div",{className:"section"},"when you press ",r.a.createElement("b",null,"choose a monster")," you will be able to select a monster of this type:"),r.a.createElement("div",{className:"section centered"},r.a.createElement("b",null,this.props.slot.roles.join(", ")))),n.push(r.a.createElement("button",{key:"select",onClick:function(){return e.props.select(e.props.slot)}},"choose a monster"));if(this.props.encounter.waves.length>0){var o=this.props.encounter.slots,c=[];this.props.encounter.slots.includes(this.props.slot)||c.push({id:"",text:"main encounter"}),this.props.encounter.waves.forEach((function(t){t.slots.includes(e.props.slot)?o=t.slots:c.push({id:t.id,text:t.name})})),n.push(r.a.createElement(Y,{key:"move",placeholder:"move to...",options:c,onSelect:function(t){return e.props.moveToWave(e.props.slot,o,t)}}))}return n.push(r.a.createElement(Y,{key:"faction",options:["foe","neutral","ally"].map((function(e){return{id:e,text:e}})),selectedID:this.props.slot.faction,onSelect:function(t){return e.props.changeValue(e.props.slot,"faction",t)}})),n.push(r.a.createElement("button",{key:"remove",onClick:function(){return e.props.remove(e.props.slot)}},"remove")),r.a.createElement("div",{className:"card "+this.props.slot.faction},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},t)),r.a.createElement("div",{className:"card-content"},a,r.a.createElement("hr",null),r.a.createElement(ne,{value:this.props.slot.count,label:"count",downEnabled:this.props.slot.count>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.slot,"count",t)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},n)))}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Fe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={showContent:!0},n}return Object(c.a)(a,[{key:"toggleContentVisible",value:function(){this.setState({showContent:!this.state.showContent})}},{key:"render",value:function(){var e=this;try{var t=this.props.content.filter((function(e){return!!e}));if(0===t.length)return null;var a=null;if(this.props.heading){var n=null;this.props.showToggle&&(n=r.a.createElement(X.a,{className:this.state.showContent?"rotate":"",onClick:function(){return e.toggleContentVisible()}})),a=r.a.createElement("div",{className:"heading fixed-top"},r.a.createElement("div",{className:"title"},this.props.heading),n)}var s=null;if(this.state.showContent){var i={xs:24,sm:24,md:12,lg:8,xl:6};switch(this.props.columns){case 1:i={xs:24,sm:24,md:24,lg:24,xl:24};break;case 2:i={xs:24,sm:24,md:12,lg:12,xl:12};break;case 3:i={xs:24,sm:24,md:8,lg:8,xl:8}}s=r.a.createElement(d.a,{align:"top",gutter:10},t.map((function(e){return r.a.createElement(h.a,{key:t.indexOf(e),xs:i.xs,sm:i.sm,md:i.md,lg:i.lg,xl:i.xl},e)})))}return r.a.createElement("div",{className:"grid-panel"},a,s)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Fe.defaultProps={columns:0,heading:null,showToggle:!1};var Be=a(238),Ge=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={showAbilityScores:!1},n}return Object(c.a)(a,[{key:"toggleAbilityScores",value:function(){this.setState({showAbilityScores:!this.state.showAbilityScores})}},{key:"roll",value:function(e,t){e.stopPropagation();var a=this.props.combatant.abilityScores[t],n=k.modifierValue(a);this.props.onRollDice(1,20,n)}},{key:"getAbilityScore",value:function(e){var t=this,a=this.props.combatant.abilityScores[e],n=k.modifier(a),s=r.a.createElement("div",null,r.a.createElement("div",{className:"ability-heading"},e),r.a.createElement("div",{className:"ability-value"},r.a.createElement("div",null,this.state.showAbilityScores?a:n)));return this.props.showRollButtons?r.a.createElement("div",{className:"ability-score link",onClick:function(a){return t.roll(a,e)}},s):r.a.createElement("div",{className:"ability-score"},s)}},{key:"render",value:function(){var e=this;try{return this.props.edit?r.a.createElement("div",null,r.a.createElement(ne,{value:this.props.combatant.abilityScores.str,label:"strength",downEnabled:this.props.combatant.abilityScores.str>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.str",t)}}),r.a.createElement(ne,{value:this.props.combatant.abilityScores.dex,label:"dexterity",downEnabled:this.props.combatant.abilityScores.dex>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.dex",t)}}),r.a.createElement(ne,{value:this.props.combatant.abilityScores.con,label:"constitution",downEnabled:this.props.combatant.abilityScores.con>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.con",t)}}),r.a.createElement(ne,{value:this.props.combatant.abilityScores.int,label:"intelligence",downEnabled:this.props.combatant.abilityScores.int>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.int",t)}}),r.a.createElement(ne,{value:this.props.combatant.abilityScores.wis,label:"wisdom",downEnabled:this.props.combatant.abilityScores.wis>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.wis",t)}}),r.a.createElement(ne,{value:this.props.combatant.abilityScores.cha,label:"charisma",downEnabled:this.props.combatant.abilityScores.cha>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.cha",t)}})):r.a.createElement("div",{className:"ability-scores",onClick:function(){return e.toggleAbilityScores()}},this.getAbilityScore("str"),this.getAbilityScore("dex"),this.getAbilityScore("con"),this.getAbilityScore("int"),this.getAbilityScore("wis"),this.getAbilityScore("cha"))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ge.defaultProps={edit:!1,showRollButtons:!1,onNudgeValue:null,onRollDice:null};var He=a(240),We=a(239),_e=new de.a.Converter;_e.setOption("tables",!0);var Je=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"createSection",value:function(e,t){var a=e[t];if(0===a.length)return null;var n=null;if("legendary"===this.props.mode||"lair"===this.props.mode)switch(t){case"legendary":case"mythic":var s=null,i=null;if(this.props.combatant.legendaryActions>0&&(s=r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round"),r.a.createElement("hr",null)),"legendary"===this.props.mode)){var o=0;this.props.combatant.traits.filter((function(e){return("legendary"===e.type||"mythic"===e.type)&&e.uses>0})).forEach((function(e){var t=1;if(e.usage){var a=e.usage.toLowerCase().match(/\D*(\d*)\D*/);a&&(t=parseInt(a[1],10))}o+=t})),o=Math.min(o,this.props.combatant.legendaryActions);for(var c=Math.max(this.props.combatant.legendaryActions-o,0),l=[],u=0;u!==o;++u)l.push(r.a.createElement(He.a,{key:"used "+u}));for(var m=0;m!==c;++m)l.push(r.a.createElement(We.a,{key:"unused "+m}));i=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section centered legendary-usage"},l))}"legendary"===t&&(n=r.a.createElement(Ne,{white:!0},s,r.a.createElement("div",null,"one legendary action can be used at the end of each other combatant's turn; spent actions are refreshed at the start of the monster's turn"),i)),"mythic"===t&&(n=r.a.createElement(Ne,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));break;case"lair":n=r.a.createElement(Ne,{white:!0},"one lair action can be taken each round on initiative 20")}else"legendary"===t&&(n=r.a.createElement(Ne,{white:!0},r.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round")),"mythic"===t&&(n=r.a.createElement(Ne,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));return r.a.createElement("div",null,r.a.createElement("div",{className:"section subheading"},k.traitType(t,!0)),n,a)}},{key:"render",value:function(){var e=this;try{var t={};return S.forEach((function(a){t[a]=e.props.combatant.traits.filter((function(e){return e.type===a})).map((function(t){return r.a.createElement(Ye,{key:t.id,trait:t,mode:e.props.mode,showRollButtons:e.props.showRollButtons,copyTrait:function(t){return e.props.copyTrait(t)},useTrait:function(t){return e.props.useTrait(t)},rechargeTrait:function(t){return e.props.rechargeTrait(t)},onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}})}))})),0===this.props.combatant.traits.length?r.a.createElement("div",null,r.a.createElement("i",null,"no traits or actions")):"combat"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"trait"),this.createSection(t,"action"),this.createSection(t,"bonus"),this.createSection(t,"reaction")):"legendary"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"legendary"),this.createSection(t,"mythic")):"lair"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"lair")):r.a.createElement("div",null,this.createSection(t,"trait"),this.createSection(t,"action"),this.createSection(t,"bonus"),this.createSection(t,"reaction"),this.createSection(t,"legendary"),this.createSection(t,"mythic"),this.createSection(t,"lair"))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Je.defaultProps={mode:"view",showRollButtons:!1,copyTrait:null,useTrait:null,rechargeTrait:null,onRollDice:null};var Ye=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=0,a=this.props.trait.name||"unnamed "+k.traitType(this.props.trait.type,!1);if(this.props.trait.usage){var n="";this.props.trait.usage.toLowerCase().startsWith("recharge ")&&(t=1,this.props.trait.uses>0&&(n="; used"));var s=this.props.trait.usage.toLowerCase().match(/(\d+)\s*\/\s*day/);s&&(t=parseInt(s[1],10),this.props.trait.uses>0&&(n="; used "+this.props.trait.uses)),a+=" *("+this.props.trait.usage+n+")*"}"legendary"!==this.props.trait.type&&"mythic"!==this.props.trait.type||(t=1,this.props.trait.uses>0&&(a+=" *(used)*"));var i="**"+a+"** "+this.props.trait.text;switch(this.props.mode){case"view":return r.a.createElement("div",{key:this.props.trait.id,className:"section trait"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:_e.makeHtml(i)}}));case"template":return r.a.createElement("div",{key:this.props.trait.id,className:"section trait trait-template",onClick:function(){return e.props.copyTrait(e.props.trait)}},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:_e.makeHtml(i)}}));case"combat":case"legendary":case"lair":var o="",c=[];t>0&&(this.props.trait.uses>=t?(o="strikethrough",c.push(r.a.createElement("button",{key:"use",className:"link",onClick:function(){return e.props.rechargeTrait(e.props.trait)}},"recharge"))):c.push(r.a.createElement("button",{key:"use",className:"link",onClick:function(){return e.props.useTrait(e.props.trait)}},"use"))),this.props.showRollButtons&&(M.getToHitExpressions(this.props.trait).forEach((function(t){c.push(r.a.createElement("button",{key:t.expression,className:"link",onClick:function(){return e.props.onRollDice(1,20,t.bonus)}},t.expression))})),M.getDiceExpressions(this.props.trait).forEach((function(t){c.push(r.a.createElement("button",{key:t.expression,className:"link",onClick:function(){return e.props.onRollDice(t.count,t.sides,t.bonus)}},t.expression))})));var l=null;return c.length>0&&(l=r.a.createElement("div",{className:"trait-buttons"},c)),r.a.createElement("div",{key:this.props.trait.id,className:"section trait"},r.a.createElement("div",{className:o,dangerouslySetInnerHTML:{__html:_e.makeHtml(i)}}),l)}}catch(u){return console.error(u),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ue=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getAC",value:function(){var e=this.props.monster.ac.toString();return this.props.monster.acInfo&&(e+=" ("+this.props.monster.acInfo+")"),e}},{key:"getHP",value:function(){var e,t,a,n=this.props.monster;if(null===n.hpCurrent||void 0===n.hpCurrent)return M.getTypicalHP(this.props.monster)+" ("+M.getTypicalHPString(this.props.monster)+")";var r=null!==(e=n.hpCurrent)&&void 0!==e?e:0,s=null!==(t=n.hpMax)&&void 0!==t?t:0,i=null!==(a=n.hpTemp)&&void 0!==a?a:0,o=r.toString();return i>0&&(o+="+"+i),s>0&&r!==s&&(o+=" / "+s),o}},{key:"statSection",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return null;var s=!0,i=null;if(n){var o=t,c=[];Array.from(t.matchAll(/([^,;:/]*)\s+([+-]?)\s*(\d+)/g)).forEach((function(e){var t=e[0],n=e[2]||"+",s=parseInt(e[3],10)*("+"===n?1:-1);c.push(r.a.createElement("button",{key:t,className:"link",onClick:function(){return a.props.onRollDice(1,20,s)}},t)),o=o.replace(t,"")})),s=!!o.match(/[a-zA-Z]/),i=r.a.createElement("div",{className:"roll-buttons"},c)}return r.a.createElement("div",{className:"section"},r.a.createElement("b",null,e)," ",s?t:null,i)}},{key:"getTags",value:function(){var e=[],t=this.props.monster.size,a=this.props.monster;a&&(t=a.displaySize||t);var n=(t+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(n+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(r.a.createElement(F.a,{key:"tag-main"},n)),this.props.monster.alignment&&e.push(r.a.createElement(F.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(r.a.createElement(F.a,{key:"tag-cr"},"cr ",k.challenge(this.props.monster.challenge))),e}},{key:"getStats",value:function(){var e=this;if("template"===this.props.mode)switch(this.props.section){case"overview":return r.a.createElement("div",{className:"stats"},r.a.createElement($,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),r.a.createElement("hr",null),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment));case"abilities":return r.a.createElement("div",{className:"stats"},r.a.createElement("div",{className:"section"},r.a.createElement(Ge,{combatant:this.props.monster})),this.statSection("saving throws",this.props.monster.savingThrows),this.statSection("skills",this.props.monster.skills));case"cbt-stats":return r.a.createElement("div",{className:"stats"},this.statSection("ac",this.getAC()),this.statSection("hp",this.getHP()),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities));case"actions":return r.a.createElement(Je,{combatant:this.props.monster,mode:"template",copyTrait:function(t){return e.props.copyTrait(t)}})}return r.a.createElement("div",{className:"stats"},r.a.createElement($,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(Ge,{combatant:this.props.monster,showRollButtons:this.props.showRollButtons,onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}})),this.statSection("ac",this.getAC()),this.statSection("hp",this.getHP()),this.statSection("saving throws",this.props.monster.savingThrows,this.props.showRollButtons),this.statSection("skills",this.props.monster.skills,this.props.showRollButtons),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment),r.a.createElement("hr",null),r.a.createElement(Je,{combatant:this.props.monster,mode:this.props.combat?"combat":"view",showRollButtons:this.props.showRollButtons,useTrait:function(t){return e.props.useTrait(t)},rechargeTrait:function(t){return e.props.rechargeTrait(t)},onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}}))}},{key:"getIcon",value:function(){var e=this;return"template"===this.props.mode?r.a.createElement(Be.a,{onClick:function(){return e.props.deselectMonster(e.props.monster)}}):null}},{key:"render",value:function(){try{var e=(this.props.monster?this.props.monster.displayName:null)||this.props.monster.name||"unnamed monster";return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:e},e),this.getIcon()),r.a.createElement("div",{className:"card-content"},this.getStats()))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ue.defaultProps={mode:"full",section:null,combat:!1,showRollButtons:!1,library:null,encounters:null,copyTrait:null,deselectMonster:null,useTrait:null,rechargeTrait:null,onRollDice:null};var Xe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=[];"edit"===this.props.mode&&(t.push(r.a.createElement("button",{key:"edit",onClick:function(){return e.props.editPC(e.props.pc)}},"edit pc")),this.props.pc.url&&t.push(r.a.createElement("button",{key:"import",onClick:function(){return e.props.updatePC(e.props.pc)}},"update pc from d&d beyond")),t.push(r.a.createElement("button",{key:"export",onClick:function(){return e.props.exportPC(e.props.pc)}},"export pc")),this.props.pc.active?t.push(r.a.createElement("button",{key:"toggle-active",onClick:function(){return e.props.changeValue(e.props.pc,"active",!1)}},"mark pc as inactive")):t.push(r.a.createElement("button",{key:"toggle-active",onClick:function(){return e.props.changeValue(e.props.pc,"active",!0)}},"mark pc as active")),t.push(r.a.createElement(H,{key:"remove",text:"delete pc",onConfirm:function(){return e.props.removePC(e.props.pc)}})));var a=null;this.props.pc.companions.length>0&&(a=this.props.pc.companions.map((function(e){return r.a.createElement("div",{key:e.id},e.name)})));var n=(this.props.pc?this.props.pc.displayName:null)||this.props.pc.name||"unnamed pc";return r.a.createElement("div",{className:"card pc"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:n},n)),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"stats"},r.a.createElement($,{source:this.props.pc}),r.a.createElement("div",{className:"section centered lowercase"},r.a.createElement(F.a,null,this.props.pc.race||"unknown race"),r.a.createElement(F.a,null,this.props.pc.classes||"unknown class"),r.a.createElement(F.a,null,"level "+this.props.pc.level)),r.a.createElement("div",{className:"section centered",style:{display:this.props.pc.url?"":"none"}},r.a.createElement("a",{href:this.props.pc.url,target:"_blank",rel:"noopener noreferrer"},"d&d beyond sheet")),r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"size"),r.a.createElement("div",{className:"section"},this.props.pc.size),r.a.createElement("div",{className:"section subheading"},"languages"),r.a.createElement("div",{className:"section"},this.props.pc.languages||"-"),r.a.createElement("div",{className:"section subheading"},"passive skills"),r.a.createElement("div",{className:"section"},r.a.createElement("div",null,r.a.createElement("b",null,"insight")," ",this.props.pc.passiveInsight),r.a.createElement("div",null,r.a.createElement("b",null,"investigation")," ",this.props.pc.passiveInvestigation),r.a.createElement("div",null,r.a.createElement("b",null,"perception")," ",this.props.pc.passivePerception)),r.a.createElement("div",{style:{display:this.props.pc.companions.length>0?"":"none"}},r.a.createElement("div",{className:"section subheading"},"companions"),r.a.createElement("div",{className:"section"},a))),r.a.createElement("div",{style:{display:t.length>0?"":"none"}},r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},t))))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Xe.defaultProps={mode:"view",changeValue:null,removePC:null,editPC:null,updatePC:null,exportPC:null};var Ke=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{if(!this.props.source)return null;var e=null;switch(this.props.source.type){case"pc":e=r.a.createElement(Xe,{pc:this.props.source});break;case"monster":e=r.a.createElement(Ue,{monster:this.props.source})}return r.a.createElement("div",{className:"scrollable padded"},e)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ze=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={encounter:e.encounter,view:"monsters",filter:y.createMonsterFilter(),selectedWaveID:null,selectedSlotID:null,showLibrary:!1,selectedMonster:null,randomEncounterXP:1e3},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"openSlot",value:function(e,t){this.setState({filter:y.createMonsterFilter(),selectedWaveID:e,selectedSlotID:t,showLibrary:!0})}},{key:"setShowLibrary",value:function(e){this.setState({showLibrary:e,selectedMonster:null})}},{key:"setSelectedMonster",value:function(e){this.setState({selectedMonster:e})}},{key:"setRandomEncounterXP",value:function(e){this.setState({randomEncounterXP:Math.max(0,e)})}},{key:"addWave",value:function(){var e=y.createEncounterWave();e.name="wave "+(this.state.encounter.waves.length+2),this.state.encounter.waves.push(e),this.setState({encounter:this.state.encounter})}},{key:"removeWave",value:function(e){var t=this.state.encounter.waves.indexOf(e);this.state.encounter.waves.splice(t,1),this.setState({encounter:this.state.encounter})}},{key:"buildEncounter",value:function(){var e=this,t=this.state.encounter;t.slots=[],t.waves=[],P.buildEncounter(t,this.state.randomEncounterXP,this.state.filter,this.props.library,this.props.getMonster),this.sortEncounterSlots(t),t.waves.forEach((function(t){return e.sortEncounterSlots(t)})),this.setState({encounter:t})}},{key:"clearEncounter",value:function(){var e=this.state.encounter;e.slots=[],e.waves=[],this.setState({encounter:e})}},{key:"addToEncounterSlot",value:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.state.encounter.slots;if(this.state.selectedWaveID){var r=this.state.encounter.waves.find((function(e){return e.id===t.state.selectedWaveID}));r&&(n=r.slots)}var s,i=null;this.state.selectedSlotID&&(i=null!==(s=n.find((function(e){return e.id===t.state.selectedSlotID})))&&void 0!==s?s:null);i||(i=y.createEncounterSlot(),n.push(i));var o=this.props.library.find((function(t){return t.monsters.includes(e)}));o&&(i.monsterID=e.id,i.monsterName=e.name,i.monsterGroupName=o.name,this.sortEncounterSlots(this.state.encounter),this.state.encounter.waves.forEach((function(e){return t.sortEncounterSlots(e)})),this.setState({encounter:this.state.encounter,selectedSlotID:null,showLibrary:!a,selectedMonster:null}))}},{key:"sortEncounterSlots",value:function(e){var t=[];e.slots.forEach((function(e){var a=t.find((function(t){return t.monsterGroupName===e.monsterGroupName&&t.monsterName===e.monsterName&&t.roles.join(",")===e.roles.join(",")}));a?a.count+=e.count:(a=e,t.push(e))})),e.slots=t,e.slots.sort((function(e,t){var a=e.monsterName.toLowerCase(),n=t.monsterName.toLowerCase();return a<n?-1:a>n?1:0}))}},{key:"removeEncounterSlot",value:function(e,t){if(t){var a=this.state.encounter.waves.find((function(e){return e.id===t}));if(a){var n=a.slots.indexOf(e);a.slots.splice(n,1)}}else{var r=this.state.encounter.slots.indexOf(e);this.state.encounter.slots.splice(r,1)}this.setState({encounter:this.state.encounter})}},{key:"moveToWave",value:function(e,t,a){var n=t.indexOf(e);if(t.splice(n,1),a){var r=this.state.encounter.waves.find((function(e){return e.id===a}));r&&(r.slots.push(e),this.sortEncounterSlots(r))}else this.state.encounter.slots.push(e),this.sortEncounterSlots(this.state.encounter);this.setState({encounter:this.state.encounter})}},{key:"useTemplate",value:function(e){var t=P.encounterTemplates().find((function(t){return t.name===e}));if(t){var a=this.state.encounter;a.slots=t.slots.map((function(e){var t=y.createEncounterSlot();return t.roles=e.roles,t.count=e.count,t})),a.waves=[],this.setState({encounter:a})}}},{key:"fillTemplate",value:function(){var e=this,t=[];this.props.library.forEach((function(a){a.monsters.forEach((function(n){e.state.encounter.slots.some((function(e){return e.monsterName===n.name&&e.monsterGroupName===a.name}))||t.push(n)}))})),this.state.encounter.slots.filter((function(e){return e.roles.length>0})).forEach((function(a){var n=t.filter((function(e){return a.roles.includes(e.role)}));if(n.length>0){var r=n[b.randomNumber(n.length)],s=e.props.library.find((function(e){return e.monsters.includes(r)}));s&&(a.monsterName=r.name,a.monsterGroupName=s.name)}})),this.setState({encounter:this.state.encounter})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({encounter:this.state.encounter})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t];n+=a,"count"===t&&(n=Math.max(n,1)),this.changeValue(e,t,n)}},{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:y.createMonsterFilter()})}},{key:"getMonsterCards",value:function(e,t){var a=this,n=[];return e.forEach((function(e){n.push(r.a.createElement(qe,{slot:e,monster:a.props.getMonster(e.monsterID),encounter:a.props.encounter,library:a.props.library,changeValue:function(e,t,n){return a.changeValue(e,t,n)},nudgeValue:function(e,t,n){return a.nudgeValue(e,t,n)},select:function(e){return a.openSlot(t,e.id)},remove:function(e){return a.removeEncounterSlot(e,t)},moveToWave:function(e,t,n){return a.moveToWave(e,t,n)},viewMonster:function(e){return a.setSelectedMonster(e)}}))})),0===e.length&&(t?n.push(r.a.createElement(Ne,null,"there are no monsters in this wave")):n.push(r.a.createElement(Ne,null,r.a.createElement("p",null,"there are no monsters in this encounter"),r.a.createElement("p",null,"you can click the button below to add a monster, or try ",r.a.createElement("b",null,"build a random encounter")," or ",r.a.createElement("b",null,"use an encounter template"))))),n}},{key:"getCandidateSection",value:function(){var e=this,t=this.state.encounter.slots;if(this.state.selectedWaveID){var a=this.state.encounter.waves.find((function(t){return t.id===e.state.selectedWaveID}));a&&(t=a.slots)}var n,s=null;this.state.selectedSlotID&&(s=null!==(n=t.find((function(t){return t.id===e.state.selectedSlotID})))&&void 0!==n?n:null);var i=[];this.props.library.forEach((function(a){a.monsters.forEach((function(n){var r=P.matchMonster(n,e.state.filter),o=!s||s.roles.includes(n.role),c=t.some((function(e){return e.monsterName===n.name&&e.monsterGroupName===a.name}));r&&o&&!c&&i.push(n)}))})),i.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var o=!!s&&s.roles.length>0,c=r.a.createElement(Ve,{items:i.map((function(e){return{id:e.id,text:e.name,info:"cr "+k.challenge(e.challenge)}})),selectedItemID:this.state.selectedMonster?this.state.selectedMonster.id:null,onSelect:function(t){var a;return e.setSelectedMonster(null!==(a=i.find((function(e){return e.id===t})))&&void 0!==a?a:null)}});if(0===i.length){var l=P.getFilterDescription(this.state.filter);c=r.a.createElement(Ne,{key:"empty"},"there are no monsters that meet the criteria ",r.a.createElement("i",null,l)," (or they are all already part of the encounter)")}var u=r.a.createElement(Ne,null,"select a monster from the list at the left to see its statblock here");this.state.selectedMonster&&(u=r.a.createElement(Ke,{source:this.state.selectedMonster}));var m=null;return m=o?r.a.createElement("button",{className:this.state.selectedMonster?"":"disabled",onClick:function(){return e.addToEncounterSlot(e.state.selectedMonster)}},"add this monster to the encounter"):r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:12},r.a.createElement("button",{className:this.state.selectedMonster?"":"disabled",onClick:function(){return e.addToEncounterSlot(e.state.selectedMonster,!1)}},"add this monster to the encounter")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.setShowLibrary(!1)}},"close"))),r.a.createElement("div",{className:"full-height"},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},"choose a monster")),r.a.createElement("div",{className:"drawer-content"},r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:10,className:"scrollable"},r.a.createElement("div",{className:"section"},r.a.createElement(oe,{filter:this.state.filter,showRoles:!o,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}})),r.a.createElement("hr",null),c),r.a.createElement(h.a,{span:14,className:"scrollable"},u))),r.a.createElement("div",{className:"drawer-footer"},m))}},{key:"getStatblockSection",value:function(){return r.a.createElement("div",{className:"full-height"},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},"statblock")),r.a.createElement("div",{className:"drawer-content"},r.a.createElement("div",{className:"scrollable"},r.a.createElement(Ke,{source:this.state.selectedMonster}))),r.a.createElement("div",{className:"drawer-footer"}))}},{key:"render",value:function(){var e=this;try{var t=null,a=null;switch(this.state.view){case"monsters":var n=this.props.encounter.waves.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement(J,{text:t.name,placeholder:"wave name",onChange:function(a){return e.changeValue(t,"name",a)}}),r.a.createElement(H,{text:"delete wave",onConfirm:function(){return e.removeWave(t)}}))})),s=null;this.state.encounter.slots.some((function(e){return e.roles.length>0}))&&(s=r.a.createElement("button",{onClick:function(){return e.fillTemplate()}},"choose monsters")),t=r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"waves"),n,r.a.createElement("button",{onClick:function(){return e.addWave()}},"add a new wave")),r.a.createElement("hr",null),r.a.createElement(ie,{encounter:this.props.encounter,parties:this.props.parties,getMonster:function(t){return e.props.getMonster(t)}}),r.a.createElement("hr",null),r.a.createElement(Z,{text:"build a random encounter"},r.a.createElement("p",null,"add random monsters to this encounter until its (effective) xp value is at least the following value"),r.a.createElement(Le.a,{value:this.state.randomEncounterXP,min:0,step:1e3,onChange:function(t){var a=parseInt((null!==t&&void 0!==t?t:0).toString(),10);e.setRandomEncounterXP(a)}}),r.a.createElement("button",{onClick:function(){return e.buildEncounter()}},"build encounter")),r.a.createElement(Z,{text:"use an encounter template"},r.a.createElement("p",null,"select one of these options to create an encounter based on a predefined template"),r.a.createElement(Ve,{items:P.encounterTemplates().map((function(e){return{id:e.name,text:e.name}})),selectedItemID:null,onSelect:function(t){return e.useTemplate(t)}})),s,r.a.createElement("hr",null),r.a.createElement(H,{text:"clear encounter",onConfirm:function(){return e.clearEncounter()}}));var i=this.props.encounter.waves.map((function(t){return r.a.createElement("div",{key:t.id},r.a.createElement(Fe,{heading:t.name||"unnamed wave",content:e.getMonsterCards(t.slots,t.id),columns:3}),r.a.createElement(d.a,null,r.a.createElement(h.a,{xs:24,sm:24,md:8,lg:8,xl:8},r.a.createElement("button",{onClick:function(){return e.openSlot(t.id,null)}},"add a monster to this wave"))))}));a=r.a.createElement("div",null,r.a.createElement(Fe,{heading:"encounter",content:this.getMonsterCards(this.props.encounter.slots,null),columns:3}),r.a.createElement(d.a,null,r.a.createElement(h.a,{xs:24,sm:24,md:8,lg:8,xl:8},r.a.createElement("button",{onClick:function(){return e.openSlot(null,null)}},"add a monster to the encounter"))),i);break;case"notes":t=null,a=r.a.createElement("div",null,r.a.createElement(Fe,{columns:1,content:[r.a.createElement(J,{key:"notes",text:this.props.encounter.notes,placeholder:"notes",multiLine:!0,onChange:function(t){return e.changeValue(e.props.encounter,"notes",t)}})],heading:"notes"}))}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement("div",{className:"section subheading"},"encounter name"),r.a.createElement(J,{text:this.props.encounter.name,placeholder:"encounter name",onChange:function(t){return e.changeValue(e.props.encounter,"name",t)}}),r.a.createElement(re,{options:["monsters","notes"].map((function(e){return{id:e,text:e}})),selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),t),r.a.createElement(h.a,{span:18,className:"scrollable"},a),r.a.createElement(f.a,{visible:this.state.showLibrary,width:"50%",closable:!1,maskClosable:!1,onClose:function(){return e.setShowLibrary(!1)}},this.getCandidateSection()),r.a.createElement(f.a,{visible:!this.state.showLibrary&&!!this.state.selectedMonster,width:"50%",closable:!1,onClose:function(){return e.setSelectedMonster(null)}},this.getStatblockSection()))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Qe=a(242),$e=a(263),et=a(225),tt=a(267),at=a(265),nt=a(264),rt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e,t){e.stopPropagation(),this.props.onClick(t)}},{key:"render",value:function(){var e=this;try{var t="radial "+this.props.mode;this.props.disabled&&(t+=" disabled");var a="eight"===this.props.mode;return r.a.createElement("div",{className:t},r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"NW")}},r.a.createElement(et.a,{rotate:-45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow vertical",onClick:function(t){return e.click(t,"N")}},r.a.createElement(et.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"NE")}},r.a.createElement(et.a,{rotate:45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow horizontal",onClick:function(t){return e.click(t,"W")}},r.a.createElement(tt.a,null))),r.a.createElement("div",{className:"cell"}),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow horizontal",onClick:function(t){return e.click(t,"E")}},r.a.createElement(at.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"SW")}},r.a.createElement(nt.a,{rotate:45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow vertical",onClick:function(t){return e.click(t,"S")}},r.a.createElement(nt.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"SE")}},r.a.createElement(nt.a,{rotate:-45}))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);rt.defaultProps={mode:"eight",disabled:!1};var st=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"randomName",value:function(){var e=I.capitalise(I.generateRoomName());this.props.changeValue(this.props.area,"name",e)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map area")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"section subheading"},"area name"),r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(J,{text:this.props.area.name,onChange:function(t){return e.props.changeValue(e.props.area,"name",t)}}),r.a.createElement("div",{className:"icons"},r.a.createElement($e.a,{onClick:function(){return e.randomName()},title:"generate a random name"}))),r.a.createElement("div",{className:"section subheading"},"notes"),r.a.createElement(J,{text:this.props.area.text,multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.area,"text",t)}}),r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement(rt,{onClick:function(t){return e.props.move(e.props.area,t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},5*this.props.area.width," ft x ",5*this.props.area.height," ft"),r.a.createElement("div",{className:"section"},r.a.createElement(ne,{value:this.props.area.width+" sq",label:"width",downEnabled:this.props.area.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.area,"width",t)}}),r.a.createElement(ne,{value:this.props.area.height+" sq",label:"height",downEnabled:this.props.area.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.area,"height",t)}})),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.remove(e.props.area)}},"remove area"))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),it=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"position"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"getPositionSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement(rt,{onClick:function(t){return e.props.move(e.props.tile,t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},5*this.props.tile.width," ft x ",5*this.props.tile.height," ft"),r.a.createElement("div",{className:"section"},r.a.createElement(ne,{value:this.props.tile.width+" sq",label:"width",downEnabled:this.props.tile.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.tile,"width",t)}}),r.a.createElement(ne,{value:this.props.tile.height+" sq",label:"height",downEnabled:this.props.tile.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.tile,"height",t)}})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.bringToFront(e.props.tile)}},"bring to front"),r.a.createElement("button",{onClick:function(){return e.props.sendToBack(e.props.tile)}},"send to back"))}},{key:"getStyleSection",value:function(){var e=this,t=O.map((function(e){return{id:e,text:e}})),a=null;"custom"===this.props.tile.terrain&&(a=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"custom image"),r.a.createElement("button",{onClick:function(){return e.props.toggleImageSelection()}},"select image"),r.a.createElement("button",{onClick:function(){return e.props.changeValue(e.props.tile,"customBackground","")}},"clear image")));var n=["square","rounded","circle"].map((function(e){return{id:e,text:e}}));return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"terrain"),r.a.createElement(Y,{options:t,placeholder:"select terrain",selectedID:this.props.tile.terrain?this.props.tile.terrain:void 0,onSelect:function(t){return e.props.changeValue(e.props.tile,"terrain",t)}}),a,r.a.createElement("div",{className:"subheading"},"shape"),r.a.createElement(re,{options:n,selectedID:this.props.tile.style,onSelect:function(t){return e.props.changeValue(e.props.tile,"style",t)}}),r.a.createElement("div",{className:"subheading"},"content"),r.a.createElement(Ve,{items:[{id:"none",text:"none"},{id:"doorway",text:"doorway",details:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,"style")),r.a.createElement(re,{options:D.map((function(e){return{id:e,text:e}})),itemsPerRow:2,selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"style",t)}}),r.a.createElement("div",null,r.a.createElement("b",null,"orientation")),r.a.createElement(re,{options:["horizontal","vertical"].map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"orientation",t)}}))},{id:"stairway",text:"stairway",details:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,"style")),r.a.createElement(re,{options:j.map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"style",t)}}),r.a.createElement("div",null,r.a.createElement("b",null,"orientation")),r.a.createElement(re,{options:["horizontal","vertical"].map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"orientation",t)}}))}],selectedItemID:this.props.tile.content?this.props.tile.content.type:"none",onSelect:function(t){var a=null;if("none"!==t){var n="";switch(t){case"doorway":n=D[0];break;case"stairway":n=j[0]}a={type:t,orientation:"horizontal",style:n}}e.props.changeValue(e.props.tile,"content",a)}}))}},{key:"render",value:function(){var e=this;try{var t=["position","style"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"position":a=this.getPositionSection();break;case"style":a=this.getStyleSection()}return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map tile")),r.a.createElement("div",{className:"card-content"},r.a.createElement(re,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),r.a.createElement("hr",null),a,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.rotate(e.props.tile)}},"rotate tile"),r.a.createElement("button",{onClick:function(){return e.props.clone(e.props.tile)}},"clone tile"),r.a.createElement("button",{onClick:function(){return e.props.remove(e.props.tile)}},"remove tile"))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ot=a(243),ct=a(220),lt=a(217),ut=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={images:n.listImages(),filter:""},n}return Object(c.a)(a,[{key:"listImages",value:function(){for(var e=[],t=0;t!==window.localStorage.length;++t){var a=window.localStorage.key(t);if(a&&a.startsWith("image-")){var n=window.localStorage.getItem(a);if(n){var r=JSON.parse(n);e.push({id:r.id,name:r.name,data:r.data})}}}return b.sort(e,[{field:"name",dir:"asc"}])}},{key:"setFilter",value:function(e){this.setState({filter:e})}},{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target){var n=a.target.result,r={id:b.guid(),name:e.name,data:n};try{var s=JSON.stringify(r);window.localStorage.setItem("image-"+r.id,s),t.setState({images:t.listImages()})}catch(i){ct.a.open({message:"can't upload this image",description:"not enough storage space; try reducing the resolution or removing unused images"})}}},a.readAsDataURL(e),!1}},{key:"render",value:function(){var e=this;try{var t=this.state.images.filter((function(t){return V.match(e.state.filter,t.name)})).map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"subheading"},t.name),r.a.createElement("img",{className:"section selectable-image",src:t.data,alt:t.name,onClick:function(){return e.props.select?e.props.select(t.id):null}}))}));return 0===t.length&&t.push(r.a.createElement(Ne,{key:"empty"},"no images")),this.state.images.length>0&&t.unshift(r.a.createElement(J,{key:"search",text:this.state.filter,placeholder:"search for an image",onChange:function(t){return e.setFilter(t)}})),r.a.createElement("div",{className:"full-height"},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},"select image")),r.a.createElement("div",{className:"drawer-content"},r.a.createElement("div",{className:"scrollable"},r.a.createElement("div",null,r.a.createElement(lt.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),t)),r.a.createElement("div",{className:"drawer-footer"},r.a.createElement("button",{onClick:function(){return e.props.cancel?e.props.cancel():null}},"cancel")))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),mt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={map:e.map,selectedTileID:null,selectedAreaID:null,addingTile:!1,addingArea:!1,showImageSelection:!1},n}return Object(c.a)(a,[{key:"setSelectedTileID",value:function(e){this.setState({selectedTileID:e})}},{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"toggleAddingTile",value:function(){this.setState({addingTile:!this.state.addingTile,addingArea:!1})}},{key:"toggleAddingArea",value:function(){this.setState({addingTile:!1,addingArea:!this.state.addingArea})}},{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"rectangleSelected",value:function(e,t,a,n){if(this.state.addingTile){var r=y.createMapItem();r.x=e,r.y=t,r.width=a-e+1,r.height=n-t+1,r.terrain="default",this.state.map.items.push(r),this.setState({map:this.state.map,selectedTileID:r.id,selectedAreaID:null,addingTile:!1,addingArea:!1})}if(this.state.addingArea){var s=y.createMapArea();s.name="new area",s.x=e,s.y=t,s.width=a-e+1,s.height=n-t+1,this.state.map.areas.push(s),b.sort(this.state.map.areas),this.setState({map:this.state.map,selectedTileID:null,selectedAreaID:s.id,addingTile:!1,addingArea:!1})}}},{key:"moveMapItem",value:function(e,t){switch(t){case"N":e.y-=1;break;case"NE":e.x+=1,e.y-=1;break;case"E":e.x+=1;break;case"SE":e.x+=1,e.y+=1;break;case"S":e.y+=1;break;case"SW":e.x-=1,e.y+=1;break;case"W":e.x-=1;break;case"NW":e.x-=1,e.y-=1}this.setState({map:this.state.map})}},{key:"rotateMapItem",value:function(e){var t=e.width;e.width=e.height,e.height=t;var a=Math.floor((e.width-e.height)/2);e.x-=a,e.y+=a,e.content&&(e.content.orientation="horizontal"===e.content.orientation?"vertical":"horizontal"),this.setState({map:this.state.map,addingTile:this.state.addingTile})}},{key:"sendToBack",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.state.map.items.unshift(e),this.setState({map:this.state.map})}},{key:"bringToFront",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.state.map.items.push(e),this.setState({map:this.state.map})}},{key:"cloneMapItem",value:function(e){var t=JSON.parse(JSON.stringify(e));t.id=b.guid(),t.x+=1,t.y+=1,this.state.map.items.push(t),this.setState({map:this.state.map,selectedTileID:t.id})}},{key:"removeMapItem",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.setState({map:this.state.map,selectedTileID:null})}},{key:"removeMapArea",value:function(e){var t=this.state.map.areas.indexOf(e);this.state.map.areas.splice(t,1),this.setState({map:this.state.map,selectedAreaID:null})}},{key:"setCustomImage",value:function(e){var t=this,a=this.state.map.items.find((function(e){return e.id===t.state.selectedTileID}));a&&this.changeValue(a,"customBackground",e)}},{key:"rotateMap",value:function(){T.rotateMap(this.state.map),this.setState({map:this.state.map,addingTile:!1})}},{key:"clearMapTiles",value:function(){var e=this.state.map;e.items=[],this.setState({map:e,selectedTileID:null,addingTile:!1})}},{key:"clearMapAreas",value:function(){var e=this.state.map;e.areas=[],this.setState({map:e,selectedAreaID:null,addingArea:!1})}},{key:"generate",value:function(e){T.generate(e,this.state.map),this.setState({map:this.state.map,addingTile:!1})}},{key:"changeValue",value:function(e,t,a){e[t]=a,b.sort(this.state.map.areas),this.setState({map:this.state.map,showImageSelection:!1})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t];n+=a,"width"!==t&&"height"!==t||(n=Math.max(n,1)),this.changeValue(e,t,n)}},{key:"render",value:function(){var e=this;try{var t=null;if(this.state.selectedTileID){var a=this.state.map.items.find((function(t){return t.id===e.state.selectedTileID}));a&&(t=r.a.createElement("div",null,r.a.createElement(it,{tile:a,toggleImageSelection:function(){return e.toggleImageSelection()},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},move:function(t,a){return e.moveMapItem(t,a)},clone:function(t){return e.cloneMapItem(t)},remove:function(t){return e.removeMapItem(t)},rotate:function(t){return e.rotateMapItem(t)},sendToBack:function(t){return e.sendToBack(t)},bringToFront:function(t){return e.bringToFront(t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.setSelectedTileID(null)}},r.a.createElement(Qe.a,{style:{fontSize:"10px"}})," back to the editor")))}if(this.state.selectedAreaID){var n=this.state.map.areas.find((function(t){return t.id===e.state.selectedAreaID}));n&&(t=r.a.createElement("div",null,r.a.createElement(st,{area:n,changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},move:function(t,a){return e.moveMapItem(t,a)},remove:function(t){return e.removeMapArea(t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.setSelectedAreaID(null)}},r.a.createElement(Qe.a,{style:{fontSize:"10px"}})," back to the editor")))}if(!t){var s=null;if(this.state.addingTile)s=r.a.createElement("button",{onClick:function(){return e.toggleAddingTile()}},"click and drag on the map to create a tile, or click here to cancel");else if(this.state.addingArea)s=r.a.createElement("button",{onClick:function(){return e.toggleAddingArea()}},"click and drag on the map to create a map area, or click here to cancel");else{var i=this.state.map.areas.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel clickable",onClick:function(){return e.setSelectedAreaID(t.id)}},t.name)}));s=r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.toggleAddingTile()}},"add a map tile"),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.generate("room")}},"add a random room"),r.a.createElement("button",{onClick:function(){return e.rotateMap()}},"rotate the map"),r.a.createElement(H,{text:"clear all tiles",onConfirm:function(){return e.clearMapTiles()}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"areas"),i,r.a.createElement("button",{onClick:function(){return e.toggleAddingArea()}},"add a map area"),r.a.createElement(H,{text:"clear all areas",onConfirm:function(){return e.clearMapAreas()}}))}t=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(J,{text:this.state.map.name,placeholder:"map name",onChange:function(t){return e.changeValue(e.state.map,"name",t)}}),r.a.createElement("hr",null),r.a.createElement(Ne,null,r.a.createElement("p",null,"to add a new tile to the map, click on ",r.a.createElement("b",null,"add a map tile")," below"),r.a.createElement("p",null,"to edit an existing tile, click on it to select it")),r.a.createElement("hr",null),s)}var o=[];return this.state.selectedTileID&&o.push(this.state.selectedTileID),this.state.selectedAreaID&&o.push(this.state.selectedAreaID),r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:6,className:"scrollable sidebar sidebar-left"},t),r.a.createElement(h.a,{span:18,className:"scrollable both-ways"},r.a.createElement(ve,{map:this.state.map,mode:"edit",paddingSquares:5,selectedItemIDs:o,showGrid:this.state.addingTile||this.state.addingArea,showAreaNames:!0,itemSelected:function(t,a){e.setSelectedTileID(t),e.setSelectedAreaID(null)},areaSelected:function(t){return e.setSelectedAreaID(t)},gridRectangleSelected:function(t,a,n,r){return e.rectangleSelected(t,a,n,r)}})),r.a.createElement(f.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(ut,{select:function(t){return e.setCustomImage(t)},cancel:function(){return e.toggleImageSelection()}})))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),pt=a(270),dt=a(121),ht=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.options.map((function(t){return r.a.createElement(ft,{key:t.id,option:t,selected:t.id===e.props.selectedID,onSelect:function(t){return e.props.onSelect(t)}})}));return r.a.createElement("div",{className:this.props.disabled?"tabs disabled":"tabs"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ht.defaultProps={disabled:!1};var ft=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="tab";this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled");var a=null;return a=this.props.option.display?this.props.option.display:r.a.createElement("div",null,this.props.option.text),r.a.createElement("div",{key:this.props.option.id,className:t,title:this.props.option.text,onClick:function(t){return e.click(t)}},a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),vt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={monster:e.monster,page:"overview",showFilter:!1,helpSection:"speed",sidebar:"similar",similarFilter:{size:!0,type:!0,subtype:!1,role:!1,alignment:!1,challenge:!0},scratchpadFilter:y.createMonsterFilter(),scratchpadList:[],showImageSelection:!1},n}return Object(c.a)(a,[{key:"setPage",value:function(e){var t=this.getHelpOptionsForPage(e);this.setState({page:e,helpSection:t[0]})}},{key:"setHelpSection",value:function(e){this.setState({helpSection:e})}},{key:"toggleMatch",value:function(e){var t=this.state.similarFilter;t[e]=!t[e],this.setState({similarFilter:t})}},{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"addToScratchpad",value:function(e){var t=this.state.scratchpadList;t.push(e),b.sort(t),this.setState({scratchpadList:t})}},{key:"removeFromScratchpad",value:function(e){var t=this.state.scratchpadList.indexOf(e);this.state.scratchpadList.splice(t,1),this.setState({scratchpadList:this.state.scratchpadList})}},{key:"addAllToScratchpad",value:function(e){var t=this.state.scratchpadList;e.forEach((function(e){return t.push(e)})),b.sort(t),this.setState({scratchpadList:t})}},{key:"clearScratchpad",value:function(){this.setState({scratchpadList:[]})}},{key:"getHelpOptionsForPage",value:function(e){switch(e){case"overview":return["speed","senses","languages","equipment"];case"abilities":return["str","dex","con","int","wis","cha","saves","skills"];case"cbt-stats":return["armor class","hit dice","resist","vulnerable","immune","conditions"];case"actions":return["actions"];default:return[]}}},{key:"getSimilarMonsters",value:function(){var e=this,t=[];return this.props.library.forEach((function(a){a.monsters.forEach((function(a){var n=!0;e.state.monster.id===a.id&&(n=!1),e.state.similarFilter.size&&e.state.monster.size!==a.size&&(n=!1),e.state.similarFilter.type&&e.state.monster.category!==a.category&&(n=!1),e.state.similarFilter.subtype&&e.state.monster.tag!==a.tag&&(n=!1),e.state.similarFilter.role&&e.state.monster.role!==a.role&&(n=!1),e.state.similarFilter.alignment&&e.state.monster.alignment!==a.alignment&&(n=!1),e.state.similarFilter.challenge&&e.state.monster.challenge!==a.challenge&&(n=!1),n&&t.push(a)}))})),t}},{key:"recalculateRole",value:function(){var e=this.state.monster;e.role=M.getRole(e)}},{key:"setRandomValue",value:function(e,t){M.setRandomValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"spliceMonsters",value:function(e){M.spliceMonsters(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"addTrait",value:function(e){M.addTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"addRandomTrait",value:function(e,t){M.addRandomTrait(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"moveTrait",value:function(e,t){var a=this.state.monster.traits.indexOf(e),n=this.state.monster.traits.indexOf(t);M.moveTrait(this.state.monster,a,n),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"removeTrait",value:function(e){M.removeTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"copyTrait",value:function(e){M.copyTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"changeTrait",value:function(e,t,a){e[t]=a,this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"nudgeValue",value:function(e,t){M.nudgeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"changeValue",value:function(e,t){M.changeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster,showImageSelection:!1})}},{key:"changeFilterValue",value:function(e,t){var a=this.state.scratchpadFilter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({scratchpadFilter:a})}},{key:"resetFilter",value:function(){this.setState({scratchpadFilter:y.createMonsterFilter()})}},{key:"matchMonster",value:function(e){return P.matchMonster(e,this.state.scratchpadFilter)}},{key:"getHelpSection",value:function(e){switch(this.state.helpSection){case"speed":return this.getValueSection("speed","text",e);case"senses":return this.getValueSection("senses","text",e);case"languages":return this.getValueSection("languages","text",e);case"equipment":return this.getValueSection("equipment","text",e);case"str":return this.getValueSection("abilityScores.str","number",e);case"dex":return this.getValueSection("abilityScores.dex","number",e);case"con":return this.getValueSection("abilityScores.con","number",e);case"int":return this.getValueSection("abilityScores.int","number",e);case"wis":return this.getValueSection("abilityScores.wis","number",e);case"cha":return this.getValueSection("abilityScores.cha","number",e);case"saves":return this.getValueSection("savingThrows","text",e);case"skills":return this.getValueSection("skills","text",e);case"armor class":return this.getValueSection("ac","number",e);case"hit dice":return this.getValueSection("hitDice","number",e);case"resist":return this.getValueSection("damage.resist","text",e);case"vulnerable":return this.getValueSection("damage.vulnerable","text",e);case"immune":return this.getValueSection("damage.immune","text",e);case"conditions":return this.getValueSection("conditionImmunities","text",e);case"actions":return this.getActionsSection(e);default:return null}}},{key:"getValueSection",value:function(e,t,a){var n=this,s=a.map((function(a){var n=e.split("."),r=a,s=null;return n.forEach((function(e){e===n[n.length-1]?s=r[e]:r=r[e]})),"text"===t&&""===s&&(s=null),s})).filter((function(e){return null!==e})),i=[];if("number"===t){var o=null,c=null;if(s.forEach((function(e){(null===o||e<o)&&(o=e),(null===c||e>c)&&(c=e)})),null!==o&&null!==c)for(var l=o;l<=c;++l)i.push({value:l,count:0})}switch(s.forEach((function(e){var t=i.find((function(t){return t.value===e}));t?t.count+=1:i.push({value:e,count:1})})),t){case"number":b.sort(i,[{field:"value",dir:"asc"}]);break;case"text":b.sort(i,[{field:"count",dir:"desc"},{field:"value",dir:"asc"}])}"text"===t&&(0!==a.length-s.length&&i.push({value:"",count:a.length-s.length}));var u=i.map((function(t){var s=100*t.count/a.length;return r.a.createElement(d.a,{gutter:10,className:"value-list",key:i.indexOf(t)},r.a.createElement(h.a,{span:8,className:"text-container"},t.value||"(none specified)"),r.a.createElement(h.a,{span:8,className:"bar-container"},r.a.createElement("div",{className:"bar",style:{width:s+"%"}})),r.a.createElement(h.a,{span:8},r.a.createElement("button",{onClick:function(){return n.changeValue(e,t.value)}},"use this value")))}));return r.a.createElement("div",null,u,r.a.createElement("button",{onClick:function(){return n.setRandomValue(e,a)}},"select random value"))}},{key:"getActionsSection",value:function(e){var t=this,a=[];return a.push(r.a.createElement(d.a,{gutter:10,className:"value-list",key:"header"},r.a.createElement(h.a,{span:8,className:"text-container"},r.a.createElement("b",null,"type")),r.a.createElement(h.a,{span:4,className:"text-container number"},r.a.createElement("b",null,"avg")),r.a.createElement(h.a,{span:4,className:"text-container number"},r.a.createElement("b",null,"min - max")))),S.forEach((function(n){var s=null,i=null,o=0;e.forEach((function(e){var t=e.traits.filter((function(e){return e.type===n})).length;(null===s||t<s)&&(s=t),(null===i||t>i)&&(i=t),o+=t}));var c=Math.round(o/e.length);a.push(r.a.createElement(d.a,{gutter:10,className:"value-list",key:n},r.a.createElement(h.a,{span:8,className:0===o?"text-container disabled":"text-container"},k.traitType(n,!0)),r.a.createElement(h.a,{span:4,className:0===o?"text-container number disabled":"text-container number"},c),r.a.createElement(h.a,{span:4,className:0===o?"text-container number disabled":"text-container number"},s," - ",i),r.a.createElement(h.a,{span:8},r.a.createElement("button",{className:0===o?"disabled":"",onClick:function(){return t.addRandomTrait(n,e)}},"add random"))))})),r.a.createElement("div",null,a)}},{key:"getSidebar",value:function(){var e=this,t=null;if(this.props.showSidebar){var a=[];if(this.props.showSidebar)switch(this.state.sidebar){case"similar":a=this.getSimilarMonsters();break;case"all":this.props.library.forEach((function(t){t.monsters.forEach((function(t){!a.includes(t)&&e.matchMonster(t)&&a.push(t)}))}))}a=a.filter((function(t){return!e.state.scratchpadList.find((function(e){return e.id===t.id}))})),b.sort(a);var n=null;switch(this.state.sidebar){case"similar":n=r.a.createElement(Z,{text:"similarity criteria"},r.a.createElement(A,{label:"size "+this.state.monster.size,checked:this.state.similarFilter.size,onChecked:function(t){return e.toggleMatch("size")}}),r.a.createElement(A,{label:"type "+this.state.monster.category,checked:this.state.similarFilter.type,onChecked:function(t){return e.toggleMatch("type")}}),r.a.createElement(A,{label:this.state.monster.tag?"subtype "+this.state.monster.tag:"subtype",checked:this.state.similarFilter.subtype,disabled:!this.state.monster.tag,onChecked:function(t){return e.toggleMatch("subtype")}}),r.a.createElement(A,{label:this.state.monster.role?"role "+this.state.monster.role:"role",checked:this.state.similarFilter.role,disabled:!this.state.monster.role,onChecked:function(t){return e.toggleMatch("role")}}),r.a.createElement(A,{label:this.state.monster.alignment?"alignment "+this.state.monster.alignment:"alignment",checked:this.state.similarFilter.alignment,disabled:!this.state.monster.alignment,onChecked:function(t){return e.toggleMatch("alignment")}}),r.a.createElement(A,{label:"challenge rating "+k.challenge(this.state.monster.challenge),checked:this.state.similarFilter.challenge,onChecked:function(t){return e.toggleMatch("challenge")}}));break;case"all":n=r.a.createElement(oe,{filter:this.state.scratchpadFilter,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}})}var s=null;0===this.state.scratchpadList.length&&(s=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"this is your ",r.a.createElement("b",null,"scratchpad")," list; you can add monsters to it from the list to the right"),r.a.createElement("div",{className:"section"},"you might find this useful if you're creating a monster and want it to have similar abilities to other monsters"),r.a.createElement("div",{className:"section"},"when there are monsters in this list, their combined stats will be shown on the left"),r.a.createElement("div",{className:"section"},"you can also quickly blend together all the monters in this list to create a new monster by clicking the ",r.a.createElement("b",null,"generate hybrid monster")," button above")));var i=null;0===a.length&&(i=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"there are no monsters in your library which match the above criteria (or they are all in your scratchpad already)"))),t=r.a.createElement(h.a,{span:12,className:"scrollable sidebar sidebar-right"},r.a.createElement(d.a,{gutter:5},r.a.createElement(h.a,{span:12},r.a.createElement(ht,{options:[{id:"scratch",text:"scratchpad"}],selectedID:"scratch",onSelect:function(){return null}}),r.a.createElement("button",{className:this.state.scratchpadList.length<2?"disabled":"",onClick:function(){return e.spliceMonsters(e.state.scratchpadList)}},"generate hybrid monster"),r.a.createElement("button",{className:0===this.state.scratchpadList.length?"disabled":"",onClick:function(){return e.clearScratchpad()}},"clear scratchpad"),r.a.createElement("hr",null),this.getMonsterCards(this.state.scratchpadList,!0),s),r.a.createElement(h.a,{span:12},r.a.createElement(ht,{options:[{id:"similar",text:"similar"},{id:"all",text:"all"}],selectedID:this.state.sidebar,onSelect:function(t){return e.setState({sidebar:t})}}),n,r.a.createElement("button",{className:0===a.length?"disabled":"",onClick:function(){return e.addAllToScratchpad(a)}},"add all to scratchpad"),r.a.createElement("hr",null),this.getMonsterCards(a,!1),i)))}else t=r.a.createElement(h.a,{span:12,className:"scrollable sidebar sidebar-right",style:{padding:"5px"}},r.a.createElement(Z,{text:"guidelines"},r.a.createElement(Nt,{monster:this.state.monster})),r.a.createElement("hr",null),r.a.createElement(Ue,{monster:this.state.monster}));return t}},{key:"getMonsterCards",value:function(e,t){var a=this;return b.sort(e).map((function(e){return t?r.a.createElement("div",{className:"section",key:e.id},r.a.createElement(Ue,{monster:e,mode:"template",section:a.state.page,copyTrait:function(e){return a.copyTrait(e)},deselectMonster:function(e){return a.removeFromScratchpad(e)}})):r.a.createElement("div",{className:"section",key:e.id},r.a.createElement(ee,{monster:e,mode:"candidate",selectMonster:function(e){return a.addToScratchpad(e)}}))})).filter((function(e){return!!e}))}},{key:"render",value:function(){var e=this;try{var t=null;switch(this.state.page){case"overview":t=r.a.createElement(gt,{monster:this.state.monster,toggleImageSelection:function(){return e.toggleImageSelection()},changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"abilities":t=r.a.createElement(bt,{monster:this.state.monster,changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"cbt-stats":t=r.a.createElement(yt,{monster:this.state.monster,changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"actions":t=r.a.createElement(Et,{monster:this.state.monster,addTrait:function(t){return e.addTrait(t)},moveTrait:function(t,a){return e.moveTrait(t,a)},removeTrait:function(t){return e.removeTrait(t)},changeValue:function(t,a,n){return e.changeTrait(t,a,n)}})}var a=null;if(this.props.showSidebar&&this.state.scratchpadList.length>0){var n=null;if(this.getHelpOptionsForPage(this.state.page).length>1){var s=this.getHelpOptionsForPage(this.state.page).map((function(e){return{id:e,text:e}}));n=r.a.createElement(re,{options:s,selectedID:this.state.helpSection,onSelect:function(t){return e.setHelpSection(t)}})}a=r.a.createElement("div",{className:"monster-help group-panel"},r.a.createElement("div",{className:"heading"},"information from scratchpad monsters"),n,this.getHelpSection(this.state.scratchpadList))}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement(ht,{options:[{id:"overview",text:"overview"},{id:"abilities",text:"abilities"},{id:"cbt-stats",text:"combat"},{id:"actions",text:"actions"}],selectedID:this.state.page,onSelect:function(t){return e.setPage(t)}}),t,a),this.getSidebar(),r.a.createElement(f.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(ut,{select:function(t){return e.changeValue("portrait",t)},cancel:function(){return e.toggleImageSelection()}})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),gt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"randomName",value:function(){var e=I.capitalise(I.generateName());this.props.changeValue("name",e)}},{key:"render",value:function(){var e=this;try{var t=C.map((function(e){return{id:e,text:e}}));return r.a.createElement(d.a,{gutter:10,key:"overview"},r.a.createElement(h.a,{span:24},r.a.createElement("div",{className:"subheading"},"name"),r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(J,{text:this.props.monster.name,onChange:function(t){return e.props.changeValue("name",t)}}),r.a.createElement("div",{className:"icons"},r.a.createElement($e.a,{onClick:function(){return e.randomName()},title:"generate a random name"})))),r.a.createElement(h.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"type"),r.a.createElement(Y,{options:t,selectedID:this.props.monster.category,onSelect:function(t){return e.props.changeValue("category",t)}}),r.a.createElement("div",{className:"subheading"},"subtype"),r.a.createElement(J,{text:this.props.monster.tag,placeholder:"none",onChange:function(t){return e.props.changeValue("tag",t)}}),r.a.createElement("div",{className:"subheading"},"alignment"),r.a.createElement(J,{text:this.props.monster.alignment,onChange:function(t){return e.props.changeValue("alignment",t)}}),r.a.createElement("div",{className:"subheading"},"challenge rating"),r.a.createElement(ne,{value:k.challenge(this.props.monster.challenge),downEnabled:this.props.monster.challenge>0,onNudgeValue:function(t){return e.props.nudgeValue("challenge",t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(ne,{value:this.props.monster.size,downEnabled:"tiny"!==this.props.monster.size,upEnabled:"gargantuan"!==this.props.monster.size,onNudgeValue:function(t){return e.props.nudgeValue("size",t)}})),r.a.createElement(h.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"speed"),r.a.createElement(J,{text:this.props.monster.speed,onChange:function(t){return e.props.changeValue("speed",t)}}),r.a.createElement("div",{className:"subheading"},"senses"),r.a.createElement(J,{text:this.props.monster.senses,onChange:function(t){return e.props.changeValue("senses",t)}}),r.a.createElement("div",{className:"subheading"},"languages"),r.a.createElement(J,{text:this.props.monster.languages,onChange:function(t){return e.props.changeValue("languages",t)}}),r.a.createElement("div",{className:"subheading"},"equipment"),r.a.createElement(J,{text:this.props.monster.equipment,onChange:function(t){return e.props.changeValue("equipment",t)}}),r.a.createElement("div",{className:"subheading"},"portrait"),r.a.createElement($,{source:this.props.monster,edit:function(){return e.props.toggleImageSelection()},clear:function(){return e.props.changeValue("portrait","")}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),bt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement(d.a,{gutter:10,key:"abilities"},r.a.createElement(h.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"ability scores"),r.a.createElement(Ge,{edit:!0,combatant:this.props.monster,onNudgeValue:function(t,a,n){return e.props.nudgeValue(a,n)}})),r.a.createElement(h.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"saving throws"),r.a.createElement(J,{text:this.props.monster.savingThrows,onChange:function(t){return e.props.changeValue("savingThrows",t)}}),r.a.createElement("div",{className:"subheading"},"skills"),r.a.createElement(J,{text:this.props.monster.skills,onChange:function(t){return e.props.changeValue("skills",t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),yt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement(d.a,{gutter:10,key:"cbt-stats"},r.a.createElement(h.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"armor class"),r.a.createElement(ne,{value:this.props.monster.ac,downEnabled:this.props.monster.ac>0,onNudgeValue:function(t){return e.props.nudgeValue("ac",t)}}),r.a.createElement("div",{className:"subheading"},"armor type"),r.a.createElement(J,{text:this.props.monster.acInfo,onChange:function(t){return e.props.changeValue("acInfo",t)}}),r.a.createElement("div",{className:"subheading"},"hit dice"),r.a.createElement(ne,{value:this.props.monster.hitDice,downEnabled:this.props.monster.hitDice>1,onNudgeValue:function(t){return e.props.nudgeValue("hitDice",t)}}),r.a.createElement("div",{className:"subheading"},"hit points"),r.a.createElement("div",{className:"hp-value"},M.getTypicalHP(this.props.monster)+" hp ("+M.getTypicalHPString(this.props.monster)+")"),r.a.createElement("div",{className:"subheading"},"legendary actions"),r.a.createElement(ne,{value:this.props.monster.legendaryActions,downEnabled:this.props.monster.legendaryActions>0,onNudgeValue:function(t){return e.props.nudgeValue("legendaryActions",t)}})),r.a.createElement(h.a,{xs:24,sm:24,md:24,lg:12,xl:12},r.a.createElement("div",{className:"subheading"},"damage resistances"),r.a.createElement(J,{text:this.props.monster.damage.resist,onChange:function(t){return e.props.changeValue("damage.resist",t)}}),r.a.createElement("div",{className:"subheading"},"damage vulnerabilities"),r.a.createElement(J,{text:this.props.monster.damage.vulnerable,onChange:function(t){return e.props.changeValue("damage.vulnerable",t)}}),r.a.createElement("div",{className:"subheading"},"damage immunities"),r.a.createElement(J,{text:this.props.monster.damage.immune,onChange:function(t){return e.props.changeValue("damage.immune",t)}}),r.a.createElement("div",{className:"subheading"},"condition immunities"),r.a.createElement(J,{text:this.props.monster.conditionImmunities,onChange:function(t){return e.props.changeValue("conditionImmunities",t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Et=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={selectedTraitID:null},n}return Object(c.a)(a,[{key:"setSelectedTraitID",value:function(e){this.setState({selectedTraitID:e})}},{key:"createSection",value:function(e,t){var a=this,n=e[t];return r.a.createElement("div",null,r.a.createElement("div",{className:"trait-header-bar"},r.a.createElement("div",{className:"subheading"},k.traitType(t,!0)),r.a.createElement(q.a,{title:"add",onClick:function(){return a.props.addTrait(t)}})),r.a.createElement(dt.List,{values:n,lockVertically:!0,onChange:function(e){var t=e.oldIndex,r=e.newIndex;return a.props.moveTrait(n[t],n[r])},renderList:function(e){var t=e.children,a=e.props;return r.a.createElement("div",a,t)},renderItem:function(e){var t=e.value,n=e.props,s=e.isDragged;return r.a.createElement("div",Object.assign({},n,{className:s?"dragged":""}),r.a.createElement(kt,{key:t.id,trait:t,isSelected:t.id===a.state.selectedTraitID,select:function(e){return a.setSelectedTraitID(e)}}))}}))}},{key:"render",value:function(){var e=this;try{var t=[],a={};S.forEach((function(n){t.push({id:n,text:k.traitType(n,!1)}),a[n]=e.props.monster.traits.filter((function(e){return e.type===n}))}));var n=this.props.monster.traits.find((function(t){return t.id===e.state.selectedTraitID})),s=null;return s=n?r.a.createElement(wt,{trait:n,removeTrait:function(t){return e.props.removeTrait(t)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)}}):r.a.createElement(Ne,null,"select one of the traits or actions from the column to the left to edit its details here"),r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:10},this.createSection(a,"trait"),this.createSection(a,"action"),this.createSection(a,"bonus"),this.createSection(a,"reaction"),this.createSection(a,"legendary"),this.createSection(a,"mythic"),this.createSection(a,"lair")),r.a.createElement(h.a,{span:14},s))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Et.defaultProps={addTrait:null,copyTrait:null,removeTrait:null,changeValue:null,swapTraits:null};var kt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:this.props.isSelected?"trait-bar selected":"trait-bar",onClick:function(){return e.props.select(e.props.trait.id)}},r.a.createElement(pt.a,{className:"grabber","data-movable-handle":!0}),r.a.createElement("div",{className:"name"},this.props.trait.name||"unnamed "+k.traitType(this.props.trait.type,!1)))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),wt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{key:this.props.trait.id,className:"section"},r.a.createElement("div",{className:"subheading"},"trait name"),r.a.createElement(J,{text:this.props.trait.name,onChange:function(t){return e.props.changeValue(e.props.trait,"name",t)}}),r.a.createElement("div",{className:"subheading"},"usage"),r.a.createElement(J,{text:this.props.trait.usage,onChange:function(t){return e.props.changeValue(e.props.trait,"usage",t)}}),r.a.createElement("div",{className:"subheading"},"details"),r.a.createElement(J,{text:this.props.trait.text,placeholder:"details",multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.trait,"text",t)}}),r.a.createElement("hr",null),r.a.createElement(H,{text:"remove this trait",onConfirm:function(){return e.props.removeTrait(e.props.trait)}}))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Nt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=k.challengeDetails(),a=1;this.props.monster.damage.immune?a=this.props.monster.challenge<11?2:this.props.monster.challenge<17?1.5:1.25:this.props.monster.damage.resist&&(a=this.props.monster.challenge<5?2:this.props.monster.challenge<11?1.5:this.props.monster.challenge<17?1.25:1);var n=M.getTypicalHP(this.props.monster)*a,s=[],i=[];this.props.monster.traits.forEach((function(e){i=i.concat(M.getToHitExpressions(e).map((function(e){return e.bonus}))),s=s.concat(M.getSaveExpressions(e).map((function(e){return e.dc})))}));var o=Math.min.apply(Math,Object(E.a)(i)),c=Math.max.apply(Math,Object(E.a)(i)),l=Math.min.apply(Math,Object(E.a)(s)),u=Math.max.apply(Math,Object(E.a)(s));return r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("p",null,"this table shows typical values for certain stats (ac, hp, etc) for a given challenge rating"),r.a.createElement("p",null,"to gauge a monster's cr, take the average of its defensive cr (from ac and hp) and offensive cr (from attack bonus, save dc, and damage per round)")),r.a.createElement("div",{className:"table alternating"},r.a.createElement(d.a,{className:"table-row table-row-header"},r.a.createElement(h.a,{span:4,className:"table-cell"},"cr"),r.a.createElement(h.a,{span:4,className:"table-cell"},"ac"),r.a.createElement(h.a,{span:4,className:"table-cell"},"effective hp"),r.a.createElement(h.a,{span:4,className:"table-cell"},"attack bonus"),r.a.createElement(h.a,{span:4,className:"table-cell"},"save dc"),r.a.createElement(h.a,{span:4,className:"table-cell"},"dmg / rnd")),t.map((function(t){var a=t.cr===e.props.monster.challenge,s=t.ac===e.props.monster.ac,i=t.hpMin<=n&&t.hpMax>=n,m=o<=t.attack&&c>=t.attack,p=l<=t.save&&u>=t.save;return r.a.createElement(d.a,{key:t.cr,className:"table-row"},r.a.createElement(h.a,{span:4,className:a?"table-cell table-cell-highlight":"table-cell"},k.challenge(t.cr)),r.a.createElement(h.a,{span:4,className:s?"table-cell table-cell-highlight":"table-cell"},t.ac),r.a.createElement(h.a,{span:4,className:i?"table-cell table-cell-highlight":"table-cell"},t.hpMin," - ",t.hpMax),r.a.createElement(h.a,{span:4,className:m?"table-cell table-cell-highlight":"table-cell"},"+",t.attack),r.a.createElement(h.a,{span:4,className:p?"table-cell table-cell-highlight":"table-cell"},t.save),r.a.createElement(h.a,{span:4,className:"table-cell"},t.dmgMin," - ",t.dmgMax))}))))}catch(m){return console.error(m),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ct=a(236),xt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={pc:e.pc,showImageSelection:!1},n}return Object(c.a)(a,[{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"addCompanion",value:function(){var e=y.createCompanion();e.name="new companion",this.state.pc.companions.push(e),this.setState({pc:this.state.pc})}},{key:"removeCompanion",value:function(e){var t=this.state.pc;t.companions=this.state.pc.companions.filter((function(t){return t.id!==e})),this.setState({pc:t})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({pc:this.state.pc,showImageSelection:!1})}},{key:"nudgeValue",value:function(e,t,a){var n,r=e[t];switch(t){case"size":n=k.nudgeSize(r,a);break;default:n=(r||0)+a}this.changeValue(e,t,n)}},{key:"render",value:function(){var e=this;try{var t=[];this.props.library.forEach((function(e){e.monsters.forEach((function(e){t.push({id:e.id,text:e.name})}))})),b.sort(t,[{field:"text",dir:"asc"}]);var a=this.state.pc.companions.map((function(a){return r.a.createElement("div",{className:"group-panel companion-list-item",key:a.id},r.a.createElement("div",{className:"companion-fields"},r.a.createElement(J,{text:a.name,onChange:function(t){return e.changeValue(a,"name",t)}}),r.a.createElement(Y,{options:t,placeholder:"select a stat block",selectedID:a.monsterID||void 0,onSelect:function(t){return e.changeValue(a,"monsterID",t)},onClear:function(){return e.changeValue(a,"monsterID",null)}})),r.a.createElement("div",{className:"companion-actions"},r.a.createElement(Ct.a,{onClick:function(){return e.removeCompanion(a.id)}})))}));return 0===a.length&&a.push(r.a.createElement("div",{className:"section",key:"empty"},r.a.createElement("i",null,"no companions (pets, retainers, mounts, etc)"))),r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"subheading"},"character name:"),r.a.createElement(J,{text:this.state.pc.name,onChange:function(t){return e.changeValue(e.state.pc,"name",t)}}),r.a.createElement("div",{className:"subheading"},"player name:"),r.a.createElement(J,{text:this.state.pc.player,onChange:function(t){return e.changeValue(e.state.pc,"player",t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(ne,{value:this.state.pc.size,downEnabled:"tiny"!==this.state.pc.size,upEnabled:"gargantuan"!==this.state.pc.size,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"size",t)}}),r.a.createElement("div",{className:"subheading"},"race:"),r.a.createElement(J,{text:this.state.pc.race,onChange:function(t){return e.changeValue(e.state.pc,"race",t)}}),r.a.createElement("div",{className:"subheading"},"class:"),r.a.createElement(J,{text:this.state.pc.classes,onChange:function(t){return e.changeValue(e.state.pc,"classes",t)}}),r.a.createElement("div",{className:"subheading"},"level:"),r.a.createElement(ne,{value:this.state.pc.level,downEnabled:this.state.pc.level>1,upEnabled:this.state.pc.level<20,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"level",t)}}),r.a.createElement("div",{className:"subheading"},"passive skills"),r.a.createElement(ne,{value:this.state.pc.passiveInsight,label:"insight",downEnabled:this.state.pc.passiveInsight>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passiveInsight",t)}}),r.a.createElement(ne,{value:this.state.pc.passiveInvestigation,label:"investigation",downEnabled:this.state.pc.passiveInvestigation>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passiveInvestigation",t)}}),r.a.createElement(ne,{value:this.state.pc.passivePerception,label:"perception",downEnabled:this.state.pc.passivePerception>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passivePerception",t)}})),r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"subheading"},"languages:"),r.a.createElement(J,{text:this.state.pc.languages,onChange:function(t){return e.changeValue(e.state.pc,"languages",t)}}),r.a.createElement("div",{className:"subheading"},"d&d beyond link:"),r.a.createElement(J,{text:this.state.pc.url,placeholder:"https://ddb.ac/characters/...",onChange:function(t){return e.changeValue(e.state.pc,"url",t)}}),r.a.createElement("div",{className:"subheading"},"portrait"),r.a.createElement($,{source:this.state.pc,edit:function(){return e.toggleImageSelection()},clear:function(){return e.changeValue(e.state.pc,"portrait","")}}),r.a.createElement("div",{className:"subheading"},"companions:"),a,r.a.createElement("button",{onClick:function(){return e.addCompanion()}},"add a new companion")),r.a.createElement(f.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(ut,{select:function(t){return e.changeValue(e.state.pc,"portrait",t)},cancel:function(){return e.toggleImageSelection()}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),St=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={map:e.map,imageID:null,size:0,square:0,imageDimensions:{width:0,height:0},mapDimensions:{width:0,height:0}},n}return Object(c.a)(a,[{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target){var n=a.target.result;t.state.imageID&&window.localStorage.removeItem("image-"+t.state.imageID);try{var r={id:b.guid(),name:e.name,data:n},s=JSON.stringify(r);window.localStorage.setItem("image-"+r.id,s);var i=new Image;i.onload=function(){var e=Math.round(Math.min(i.width,i.height)/10);t.setState({imageID:r.id,size:n.length,square:e,imageDimensions:{width:i.width,height:i.height},mapDimensions:{width:Math.round(i.width/e),height:Math.round(i.height/e)}},(function(){t.updateMap(r.name)}))},i.src=n}catch(o){ct.a.open({message:"can't upload this image",description:"not enough storage space for this image ("+b.toData(n.length)+"); try reducing the resolution or removing unused images"})}}},a.readAsDataURL(e),!1}},{key:"nudgeSquare",value:function(e){var t=this,a=Math.max(0,this.state.square+e);this.setState({square:a,mapDimensions:{width:Math.round(this.state.imageDimensions.width/a),height:Math.round(this.state.imageDimensions.height/a)}},(function(){t.updateMap(null)}))}},{key:"nudgeWidth",value:function(e){var t=this,a=Math.max(0,this.state.mapDimensions.width+e);this.setState({mapDimensions:{width:a,height:this.state.mapDimensions.height}},(function(){t.updateMap(null)}))}},{key:"nudgeHeight",value:function(e){var t=this,a=Math.max(0,this.state.mapDimensions.height+e);this.setState({mapDimensions:{width:this.state.mapDimensions.width,height:a}},(function(){t.updateMap(null)}))}},{key:"updateMap",value:function(e){var t=this.state.map;if(e&&(t.name=e),this.state.imageID){var a=y.createMapItem();a.type="tile",a.terrain="custom",a.customBackground=this.state.imageID,a.width=this.state.mapDimensions.width,a.height=this.state.mapDimensions.height,t.items=[a]}else t.items=[];this.setState({map:t})}},{key:"render",value:function(){var e=this;try{var t=null;return t=this.state.imageID&&this.state.imageDimensions?r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"this image is ",b.toData(this.state.size)),r.a.createElement("div",{className:"section"},"set the name and dimensions of this map image"),r.a.createElement("div",{className:"section"},"changing the size of a map square, in pixels, will change the map's dimensions"),r.a.createElement("div",{className:"section"},"you can then fine-tune the exact width and height of the map")),r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(J,{text:this.state.map.name,placeholder:"map name",onChange:function(t){return e.updateMap(t)}}),r.a.createElement("div",{className:"subheading"},"map square size"),r.a.createElement(ne,{value:this.state.square+" px",label:"square size",factors:[1,10],downEnabled:this.state.square>1,onNudgeValue:function(t){return e.nudgeSquare(t)}}),r.a.createElement("div",{className:"subheading"},"map dimensions"),r.a.createElement(ne,{value:this.state.mapDimensions.width+" sq",label:"width",downEnabled:this.state.mapDimensions.width>1,onNudgeValue:function(t){return e.nudgeWidth(t)}}),r.a.createElement(ne,{value:this.state.mapDimensions.height+" sq",label:"height",downEnabled:this.state.mapDimensions.height>1,onNudgeValue:function(t){return e.nudgeHeight(t)}})):r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(lt.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:8,className:"scrollable"},t),r.a.createElement(h.a,{span:16,className:"scrollable both-ways"},r.a.createElement(ve,{map:this.state.map,mode:"edit",showGrid:!0,gridSquareClicked:function(e,t){return null}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Mt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={group:e.group},n}return Object(c.a)(a,[{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e){var n=a[e];t.state.group[e]=n}})),t.state.group.monsters.forEach((function(e){e.id=b.guid(),e.portrait=""})),t.setState({group:t.state.group})})),!1}},{key:"render",value:function(){var e=this;try{return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(lt.a.Dragger,{accept:".monstergroup",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))),r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement(Fe,{heading:this.props.group.name,columns:1,content:this.props.group.monsters.map((function(e){return r.a.createElement(Ue,{key:e.id,monster:e})}))})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),It=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",monster:e.monster},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){M.import(this.state.source,this.state.monster),this.setState({monster:this.state.monster})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e&&"portrait"!==e){var n=a[e];t.state.monster[e]=n}})),t.setState({monster:t.state.monster})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":a=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"go to the following link to find the monster you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/monsters",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/monsters")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),r.a.createElement(J,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(lt.a.Dragger,{accept:".monster",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement(ht,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(h.a,{span:12,className:"scrollable",style:{padding:"5px"}},r.a.createElement(Ue,{monster:this.state.monster})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ot=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"importParty",value:function(t,a){a.name="",a.pcs=[];var n=(new DOMParser).parseFromString(t,"text/html");try{a.name=n.getElementsByClassName("page-title")[0].innerText.trim()}catch(u){console.error(u)}try{for(var r=n.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-active")[0].getElementsByClassName("ddb-campaigns-character-card"),s=0;s!==r.length;++s){var i=r[s];a.pcs.push(e.getCharacter(i,!0))}}catch(u){console.error(u)}try{for(var o=n.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-inactive")[0].getElementsByClassName("ddb-campaigns-character-card"),c=0;c!==o.length;++c){var l=o[c];a.pcs.push(e.getCharacter(l,!1))}}catch(u){console.error(u)}}},{key:"getCharacter",value:function(e,t){var a=y.createPC();a.name=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-primary")[0].innerText.trim(),a.player=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[1].innerText.trim().substring(8),a.active=t;var n=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[0].innerText.trim().split("|");a.level=Number.parseInt(n[0].substring(4).trim(),10),a.race=n[1].trim(),a.classes=n[2].trim();var r=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-details-link")[0];return a.url="https://www.dndbeyond.com"+r.getAttribute("href"),a}},{key:"importPC",value:function(e,t){try{var a=JSON.parse(e);t.name=a.character.name,t.size=a.character.race.size,t.race=a.character.race.fullName;var n=0,r="";a.character.classes.forEach((function(e){n+=e.level,""!==r&&(r+=" / "),r+=e.definition.name,e.subclassDefinition&&(r+=" ("+e.subclassDefinition.name+")")})),t.classes=r,t.level=n;var s=[].concat(a.character.modifiers.race).concat(a.character.modifiers.class).concat(a.character.modifiers.background).concat(a.character.modifiers.item).concat(a.character.modifiers.feat).concat(a.character.modifiers.condition),i=s.filter((function(e){return"language"===e.type})).map((function(e){return e.friendlySubtypeName}));t.languages=i.join(", ");var o=k.proficiency(n),c=a.character.stats[3].value,l=a.character.stats[4].value;s.filter((function(e){return"bonus"===e.type&&"intelligence-score"===e.subType})).forEach((function(e){return c+=e.value})),s.filter((function(e){return"bonus"===e.type&&"wisdom-score"===e.subType})).forEach((function(e){return l+=e.value}));var u=0,m=0,p=0,d=s.filter((function(e){return"insight"===e.subType||"wisdom-ability-checks"===e.subType})).map((function(e){return e.type}));d.includes("expertise")?u=2:d.includes("proficiency")?u=1:d.includes("half-proficiency-round-up")&&(u=.5);var h=s.filter((function(e){return"investigation"===e.subType||"intelligence-ability-checks"===e.subType})).map((function(e){return e.type}));h.includes("expertise")?m=2:h.includes("proficiency")?m=1:d.includes("half-proficiency-round-up")&&(m=.5);var f=s.filter((function(e){return"perception"===e.subType||"wisdom-ability-checks"===e.subType})).map((function(e){return e.type}));f.includes("expertise")?p=2:f.includes("proficiency")?p=1:d.includes("half-proficiency-round-up")&&(p=.5),t.passiveInsight=10+k.modifierValue(l)+Math.floor(o*u),t.passiveInvestigation=10+k.modifierValue(c)+Math.floor(o*m),t.passivePerception=10+k.modifierValue(l)+Math.floor(o*p),t.companions=[],a.character.creatures.forEach((function(e){var a=y.createCompanion();a.name=e.name,t.companions.push(a)}))}catch(v){console.error(v)}}}]),e}(),Dt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",party:e.party},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){Ot.importParty(this.state.source,this.state.party),this.setState({party:this.state.party})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e){var n=a[e];t.state.party[e]=n}})),t.state.party.pcs.forEach((function(e){e.id=b.guid(),e.portrait=""})),t.setState({party:t.state.party})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":a=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"go to the following link to find the party you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/my-campaigns",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/my-campaigns")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),r.a.createElement(J,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(lt.a.Dragger,{accept:".party",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement(ht,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement(Fe,{heading:this.props.party.name,columns:1,content:this.props.party.pcs.map((function(e){return r.a.createElement(Xe,{key:e.id,pc:e})}))})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),jt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",pc:e.pc},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){Ot.importPC(this.state.source,this.state.pc),this.setState({pc:this.state.pc})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e&&"portrait"!==e){var n=a[e];t.state.pc[e]=n}})),t.setState({pc:t.state.pc})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":var n=null,s=this.state.pc.url;""!==s?(s.endsWith("/")||(s+="/"),s+="json",n=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"go to the following link"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},s)),r.a.createElement("div",{className:"section"},"copy the data into the clipboard, paste it into the box below, and press the analyse button"))):n=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"go to the following link to find the pc you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),a=r.a.createElement("div",null,n,r.a.createElement(J,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(lt.a.Dragger,{accept:".pc",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement(ht,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(h.a,{span:12,className:"scrollable"},r.a.createElement(Xe,{pc:this.state.pc})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Tt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getKillsChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"kill"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=b.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"kills"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Re,{data:t}))}},{key:"getDamageChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"damage"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=a.value}})),t=b.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"damage dealt"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Re,{data:t}))}},{key:"getMobilityChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"movement"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=b.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mobility"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Re,{data:t}))}},{key:"getConditionsAddedChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"condition-add"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=b.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"conditions added"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Re,{data:t}))}},{key:"getConditionsRemovedChart",value:function(){var e=this,t=[];return this.props.combat.report.filter((function(e){return"condition-remove"===e.type})).forEach((function(a){var n=e.props.combat.combatants.find((function(e){return e.id===a.combatantID}));if(n&&"pc"===n.type){var r=t.find((function(e){return e.text===n.displayName}));void 0===r&&(r={text:n.displayName,value:0},t.push(r)),r.value+=1}})),t=b.sort(t,[{field:"value",dir:"desc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"conditions removed"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Re,{data:t}))}},{key:"getTurnLengthChart",value:function(){var e=this,t=[],a=null,n=[];return this.props.combat.report.forEach((function(r){switch(r.type){case"turn-start":a=r.timestamp;break;case"turn-end":if(null!==a){var s=e.props.combat.combatants.find((function(e){return e.id===r.combatantID}));if(s&&"pc"===s.type){var i=t.find((function(e){return e.text===s.displayName}));void 0===i&&(i={text:s.displayName,value:0},t.push(i));var o=r.timestamp-a;n.forEach((function(e){if(e.start&&e.end){var t=e.end-e.start;o-=t}})),i.value+=o}a=null,n=[]}break;case"combat-pause":n.push({start:r.timestamp,end:null});break;case"combat-resume":if(n.length>0)n[n.length-1].end=r.timestamp}})),t=b.sort(t,[{field:"value",dir:"asc"}]),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"turn length"),0===t.length?r.a.createElement("div",{className:"section"},"no data to display"):null,r.a.createElement(Re,{data:t,onFormatValue:function(e){var t=new Date(e);return t.getMinutes()+"m "+t.getSeconds()+"s"}}))}},{key:"render",value:function(){try{return r.a.createElement("div",{className:"scrollable padded"},this.getKillsChart(),this.getDamageChart(),this.getMobilityChart(),this.getConditionsAddedChart(),this.getConditionsRemovedChart(),this.getTurnLengthChart())}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Vt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={hasError:!1},n}return Object(c.a)(a,[{key:"componentDidCatch",value:function(e,t){console.error(e.name),console.error(e.message),console.error(e.stack),console.error(t.componentStack)}},{key:"render",value:function(){return this.state.hasError?r.a.createElement("div",{className:"render-error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),a}(r.a.Component),Pt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t="parties"===this.props.view?"navigator-item pcs selected":"navigator-item pcs",a="library"===this.props.view?"navigator-item monsters selected":"navigator-item monsters",n="encounters"===this.props.view?"navigator-item encounters selected":"navigator-item encounters",s="maps"===this.props.view?"navigator-item maps selected":"navigator-item maps";return r.a.createElement("div",{className:"page-footer"},r.a.createElement("div",{className:t,onClick:function(){return e.props.onSelectView("parties")}},"pcs"),r.a.createElement("div",{className:a,onClick:function(){return e.props.onSelectView("library")}},"monsters"),r.a.createElement("div",{className:n,onClick:function(){return e.props.onSelectView("encounters")}},"encounters"),r.a.createElement("div",{className:s,onClick:function(){return e.props.onSelectView("maps")}},"maps"))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),At=a(256),Rt=a(255),zt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.breadcrumbs.map((function(e){return r.a.createElement("div",{key:e.id,className:"breadcrumb",onClick:function(){return e.onClick()}},e.text)})),a=null;return this.props.onToggleSidebar&&(a=r.a.createElement(At.a,{className:"toggle",title:"show sidebar",onClick:function(){return e.props.onToggleSidebar()}}),this.props.sidebarVisible&&(a=r.a.createElement(Rt.a,{className:"toggle",title:"hide sidebar",onClick:function(){return e.props.onToggleSidebar()}}))),r.a.createElement("div",{className:"page-header"},r.a.createElement("div",{className:"app-title"},t),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);zt.defaultProps={sidebarVisible:!1,onToggleSidebar:null};var Lt=a(231),qt=a(228),Ft=a(227),Bt=a(226),Gt=a(262),Ht=a(260),Wt=a(122),_t=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"dojo"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"clearImages",value:function(){for(var e=this,t=[],a=0;a!==window.localStorage.length;++a){var n=window.localStorage.key(a);if(n&&n.startsWith("image-")){var r=window.localStorage.getItem(n);if(r){var s=JSON.parse(r);t.push({id:s.id,name:s.name,data:s.data})}}}t.forEach((function(t){var a=!1;e.props.parties.forEach((function(e){e.pcs.find((function(e){return e.portrait===t.id}))&&(a=!0)})),e.props.library.forEach((function(e){e.monsters.find((function(e){return e.portrait===t.id}))&&(a=!0)})),e.props.maps.forEach((function(e){e.items.find((function(e){return e.customBackground===t.id}))&&(a=!0)})),e.props.combats.forEach((function(e){e.map&&e.map.items.find((function(e){return e.customBackground===t.id}))&&(a=!0)})),a||window.localStorage.removeItem("image-"+t.id)})),this.setState({view:this.state.view})}},{key:"render",value:function(){var e=this;try{var t=["dojo","settings","ogl"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"dojo":a=r.a.createElement("div",null,r.a.createElement("div",{className:"section"},"designed by ",r.a.createElement("a",{href:"mailto:andy.aiken@live.co.uk"},"andy aiken")),r.a.createElement("div",{className:"section"},"version ",r.a.createElement("b",null,Wt.version)),r.a.createElement("div",{className:"section"},"if you would like to raise a bug or request a new feature, you can do so ",r.a.createElement("a",{href:"https://github.com/andyaiken/dojo",target:"_blank",rel:"noopener noreferrer"},"here")),r.a.createElement("div",{className:"section"},"the roadmap for planned new features can be found ",r.a.createElement("a",{href:"https://github.com/andyaiken/dojo/projects/8?fullscreen=true",target:"_blank",rel:"noopener noreferrer"},"here")));break;case"settings":for(var n=0,s=0,i=0;i!==window.localStorage.length;++i){var o=window.localStorage.key(i);if(o){var c=window.localStorage.getItem(o);c&&(o.startsWith("data")&&(n+=c.length),o.startsWith("image")&&(s+=c.length))}}a=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"the browser has a limited amount of image storage space"),r.a.createElement("div",{className:"section"},"use this button to delete anything that isn't currently being used")),r.a.createElement("button",{onClick:function(){return e.clearImages()}},"remove unused images"),r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"data"),r.a.createElement("div",{className:"section"},r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"total"),r.a.createElement(h.a,{span:8,className:"statistic-value"},b.toData(n+s))),r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"data"),r.a.createElement(h.a,{span:8,className:"statistic-value"},b.toData(n))),r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"images"),r.a.createElement(h.a,{span:8,className:"statistic-value"},b.toData(s)))));break;case"ogl":a=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"open game license"),r.a.createElement("div",{className:"section"},"The following text is the property of Wizards of the Coast, Inc. and is Copyright 2000 Wizards of the Coast, Inc ('Wizards'). All Rights Reserved."),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("b",null,"Definitions"),": (a)'Contributors' means the copyright and/or trademark owners who have contributed Open Game Content; (b)'Derivative Material' means copyrighted material including derivative works and translations (including into other computer languages), potation, modification, correction, addition, extension, upgrade, improvement, compilation, abridgment or other form in which an existing work may be recast, transformed or adapted; (c) 'Distribute' means to reproduce, license, rent, lease, sell, broadcast, publicly display, transmit or otherwise distribute; (d)'Open Game Content' means the game mechanic and includes the methods, procedures, processes and routines to the extent such content does not embody the Product Identity and is an enhancement over the prior art and any additional content clearly identified as Open Game Content by the Contributor, and means any work covered by this License, including translations and derivative works under copyright law, but specifically excludes Product Identity. (e) 'Product Identity' means product and product line names, logos and identifying marks including trade dress; artifacts; creatures characters; stories, storylines, plots, thematic elements, dialogue, incidents, language, artwork, symbols, designs, depictions, likenesses, formats, poses, concepts, themes and graphic, photographic and other visual or audio representations; names and descriptions of characters, spells, enchantments, personalities, teams, personas, likenesses and special abilities; places, locations, environments, creatures, equipment, magical or supernatural abilities or effects, logos, symbols, or graphic designs; and any other trademark or registered trademark clearly identified as Product identity by the owner of the Product Identity, and which specifically excludes the Open Game Content; (f) 'Trademark' means the logos, names, mark, sign, motto, designs that are used by a Contributor to identify itself or its products or the associated products contributed to the Open Game License by the Contributor (g) 'Use', 'Used' or 'Using' means to use, Distribute, copy, edit, format, modify, translate and otherwise create Derivative Material of Open Game Content. (h) 'You' or 'Your' means the licensee in terms of this agreement."),r.a.createElement("li",null,r.a.createElement("b",null,"The License"),": This License applies to any Open Game Content that contains a notice indicating that the Open Game Content may only be Used under and in terms of this License. You must affix such a notice to any Open Game Content that you Use. No terms may be added to or subtracted from this License except as described by the License itself. No other terms or conditions may be applied to any Open Game Content distributed using this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Offer and Acceptance"),": By Using the Open Game Content You indicate Your acceptance of the terms of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Grant and Consideration"),": In consideration for agreeing to use this License, the Contributors grant You a perpetual, worldwide, royalty-free, non-exclusive license with the exact terms of this License to Use, the Open Game Content."),r.a.createElement("li",null,r.a.createElement("b",null,"Representation of Authority to Contribute"),": If You are contributing original material as Open Game Content, You represent that Your Contributions are Your original creation and/or You have sufficient rights to grant the rights conveyed by this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Notice of License Copyright"),": You must update the COPYRIGHT NOTICE portion of this License to include the exact text of the COPYRIGHT NOTICE of any Open Game Content You are copying, modifying or distributing, and You must add the title, the copyright date, and the copyright holder's name to the COPYRIGHT NOTICE of any original Open Game Content you Distribute."),r.a.createElement("li",null,r.a.createElement("b",null,"Use of Product Identity"),": You agree not to Use any Product Identity, including as an indication as to compatibility, except as expressly licensed in another, independent Agreement with the owner of each element of that Product Identity. You agree not to indicate compatibility or co-adaptability with any Trademark or Registered Trademark in conjunction with a work containing Open Game Content except as expressly licensed in another, independent Agreement with the owner of such Trademark or Registered Trademark. The use of any Product Identity in Open Game Content does not constitute a challenge to the ownership of that Product Identity. The owner of any Product Identity used in Open Game Content shall retain all rights, title and interest in and to that Product Identity."),r.a.createElement("li",null,r.a.createElement("b",null,"Identification"),": If you distribute Open Game Content You must clearly indicate which portions of the work that you are distributing are Open Game Content."),r.a.createElement("li",null,r.a.createElement("b",null,"Updating the License"),": Wizards or its designated Agents may publish updated versions of this License. You may use any authorized version of this License to copy, modify and distribute any Open Game Content originally distributed under any version of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Copy of this License"),": You MUST include a copy of this License with every copy of the Open Game Content You Distribute."),r.a.createElement("li",null,r.a.createElement("b",null,"Use of Contributor Credits"),": You may not market or advertise the Open Game Content using the name of any Contributor unless You have written permission from the Contributor to do so."),r.a.createElement("li",null,r.a.createElement("b",null,"Inability to Comply"),": If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Open Game Content due to statute, judicial order, or governmental regulation then You may not Use any Open Game Material so affected."),r.a.createElement("li",null,r.a.createElement("b",null,"Termination"),": This License will terminate automatically if You fail to comply with all terms herein and fail to cure such breach within 30 days of becoming aware of the breach. All sublicenses shall survive the termination of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Reformation"),": If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable."),r.a.createElement("li",null,r.a.createElement("b",null,"COPYRIGHT NOTICE")," Open Game License v 1.0 Copyright 2000, Wizards of the Coast, Inc.")))}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement(re,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},a))}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Jt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={description:"",physical:"",mental:"",speech:""},n}return Object(c.a)(a,[{key:"generate",value:function(){this.setState({description:I.generateNPC(),physical:I.generateNPCPhysical(),mental:I.generateNPCMental(),speech:I.generateNPCSpeech()})}},{key:"render",value:function(){var e=this;try{var t=null;return this.state.description&&(t=r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},r.a.createElement("div",null,r.a.createElement("b",null,"npc:")," ",this.state.description),r.a.createElement("hr",null),r.a.createElement("div",{className:"smaller"},r.a.createElement("b",null,"physical:")," ",this.state.physical),r.a.createElement("div",{className:"smaller"},r.a.createElement("b",null,"personality:")," ",this.state.mental),r.a.createElement("div",{className:"smaller"},r.a.createElement("b",null,"speech:")," ",this.state.speech)))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t?r.a.createElement("hr",null):null,t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Yt=a(46),Ut=a.n(Yt),Xt=a(59),Kt=a(245),Zt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={source:null,values:[]},n}return Object(c.a)(a,[{key:"fetchData",value:function(){var e=Object(Xt.a)(Ut.a.mark((function e(){var t,a;return Ut.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/dojo/data/places.txt");case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,this.setState({source:a});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generate",value:function(){I.initModel([this.state.source]),this.setState({values:I.generate(10).map((function(e){return e.line}))})}},{key:"render",value:function(){var e=this;try{this.state.source||this.fetchData();for(var t=[],a=0;a!==this.state.values.length;++a)t.push(r.a.createElement(Qt,{key:a,text:this.state.values[a]}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t.length>0?r.a.createElement("hr",null):null,t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Qt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement(Kt.a,{title:"copy",onClick:function(t){return e.copy(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),$t=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={values:[]},n}return Object(c.a)(a,[{key:"generate",value:function(){for(var e=[];e.length<10;){var t="";switch(this.props.type){case"book":t=I.generateBookTitle();break;case"name":t=I.generateName();break;case"potion":t=I.generatePotion();break;case"treasure":t=I.generateTreasure()}e.includes(t)||e.push(t)}e.sort(),this.setState({values:e})}},{key:"render",value:function(){var e=this;try{for(var t=[],a=0;a!==this.state.values.length;++a)t.push(r.a.createElement(ea,{key:a,text:this.state.values[a]}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t.length>0?r.a.createElement("hr",null):null,t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ea=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement(Kt.a,{title:"copy",onClick:function(t){return e.copy(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ta=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"name":t=r.a.createElement($t,{key:"name",type:"name"});break;case"book":t=r.a.createElement($t,{key:"book",type:"book"});break;case"potion":t=r.a.createElement($t,{key:"potion",type:"potion"});break;case"treasure":t=r.a.createElement($t,{key:"treasure",type:"treasure"});break;case"place":t=r.a.createElement(Zt,null);break;case"npc":t=r.a.createElement(Jt,null)}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement(re,{options:[{id:"name",text:"names"},{id:"book",text:"book titles"},{id:"potion",text:"potions"},{id:"treasure",text:"treasures"},{id:"place",text:"place names"},{id:"npc",text:"npc"}],selectedID:this.props.view,itemsPerRow:3,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),aa=a(235),na=a(215),ra=new de.a.Converter;ra.setOption("tables",!0);var sa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={source:null},n}return Object(c.a)(a,[{key:"fetchData",value:function(){var e=Object(Xt.a)(Ut.a.mark((function e(){var t,a;return Ut.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.props.filename);case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,this.setState({source:a});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){try{return this.state.source||this.fetchData(),r.a.createElement(na.a,{spinning:null===this.state.source,indicator:r.a.createElement(aa.a,{style:{fontSize:20,marginTop:100}})},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ra.makeHtml(this.state.source||"")}}))}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ia=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.monsters.find((function(t){return t.id===e.props.selectedMonsterID})),a=null;return t&&(a=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(Ue,{monster:t}))),r.a.createElement("div",null,r.a.createElement(Y,{options:this.props.monsters.map((function(e){return{id:e.id,text:e.name}})),placeholder:"select a monster...",selectedID:this.props.selectedMonsterID,onSelect:function(t){return e.props.selectMonsterID(t)}}),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),oa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getSummary",value:function(){var e=this,t=this.props.parties.find((function(t){return t.id===e.props.selectedPartyID}));if(!t)return null;var a=t.pcs.filter((function(e){return e.active}));if(0===a.length)return r.a.createElement("div",{className:"section centered"},r.a.createElement("i",null,"no pcs"));var n=Math.round(a.reduce((function(e,t){return e+t.level}),0)/a.length),s=a.map((function(e){return e.languages.toLowerCase()})).join(", ").split(/[ ,;.:]+/).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]).sort((function(e,t){return"common"===e?-1:"common"===t?1:e.localeCompare(t)})).map((function(e){var t=a.filter((function(t){return t.languages.toLowerCase().includes(e)})),n=t.length===a.length?"all pcs":t.map((function(e){return e.name})).join(", "),s=e[0].toUpperCase()+e.substr(1);return r.a.createElement("div",{key:s,className:"table-row"},r.a.createElement("div",{className:"table-cell l"},s),r.a.createElement("div",{className:"table-cell l"},n))})),i={min:Number.MAX_VALUE,max:Number.MIN_VALUE},o={min:Number.MAX_VALUE,max:Number.MIN_VALUE},c={min:Number.MAX_VALUE,max:Number.MIN_VALUE};a.forEach((function(e){i.min=Math.min(i.min,e.passiveInsight),i.max=Math.max(i.max,e.passiveInsight),o.min=Math.min(o.min,e.passiveInvestigation),o.max=Math.max(o.max,e.passiveInvestigation),c.min=Math.min(c.min,e.passivePerception),c.max=Math.max(c.max,e.passivePerception)}));for(var l=Math.min(i.min,o.min,c.min),u=Math.max(i.max,o.max,c.max),m=[],p=function(e){var t=a.filter((function(t){return t.passiveInsight===e})).map((function(e){return e.name})).join(", "),n=a.filter((function(t){return t.passiveInvestigation===e})).map((function(e){return e.name})).join(", "),s=a.filter((function(t){return t.passivePerception===e})).map((function(e){return e.name})).join(", ");m.push(r.a.createElement("div",{key:e,className:"table-row"},r.a.createElement("div",{className:"table-cell l small"},e),r.a.createElement("div",{className:"table-cell l"},t),r.a.createElement("div",{className:"table-cell l"},n),r.a.createElement("div",{className:"table-cell l"},s)))},d=u;d>=l;--d)p(d);return r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"languages"),r.a.createElement("div",{className:"table alternating"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"language")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"spoken by"))),s),r.a.createElement("div",{className:"section subheading"},"passive skills"),r.a.createElement("div",{className:"table alternating"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell l small"}),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"insight")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"investigation")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"perception"))),m),r.a.createElement("div",{className:"section subheading"},"average level"),r.a.createElement("div",{className:"section"},n))}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement(Y,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"select a party...",selectedID:this.props.selectedPartyID,onSelect:function(t){return e.props.selectPartyID(t)}}),this.getSummary())}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ca=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"skills":t=r.a.createElement(sa,{key:"skills",filename:"/dojo/data/skills.md"});break;case"conditions":t=r.a.createElement(sa,{key:"conditions",filename:"/dojo/data/conditions.md"});break;case"actions":t=r.a.createElement(sa,{key:"actions",filename:"/dojo/data/actions.md"});break;case"party":t=r.a.createElement(oa,{selectedPartyID:this.props.selectedPartyID,parties:this.props.parties,selectPartyID:function(t){return e.props.selectPartyID(t)}});break;case"monster":t=r.a.createElement(ia,{selectedMonsterID:this.props.selectedMonsterID,monsters:this.props.monsters,selectMonsterID:function(t){return e.props.selectMonsterID(t)}})}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement(re,{options:[{id:"skills",text:"skills"},{id:"conditions",text:"conditions"},{id:"actions",text:"actions"},{id:"party",text:"party"},{id:"monster",text:"monster"}],selectedID:this.props.view,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),la=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={text:""},n}return Object(c.a)(a,[{key:"setSearchTerm",value:function(e){this.setState({text:e})}},{key:"render",value:function(){var e=this;try{var t=[];return this.state.text.length>2&&(this.props.parties.filter((function(t){return V.matchParty(e.state.text,t)})).forEach((function(a){var n=[];a.pcs.filter((function(t){return V.matchPC(e.state.text,t)})).forEach((function(t){var a=[];t.companions.filter((function(t){return V.matchCompanion(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.name)))})),n.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openParty(a.id)}},r.a.createElement("div",{className:"section"},a.name),n))})),this.props.library.filter((function(t){return V.matchGroup(e.state.text,t)})).forEach((function(a){var n=[];a.monsters.filter((function(t){return V.matchMonster(e.state.text,t)})).forEach((function(t){var a=[];t.traits.filter((function(t){return V.matchTrait(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.name)))})),n.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openGroup(a.id)}},r.a.createElement("div",{className:"section"},a.name),n))})),this.props.encounters.filter((function(t){return V.matchEncounter(e.state.text,t)})).forEach((function(a){var n=[];a.slots.filter((function(t){return V.matchEncounterSlot(e.state.text,t)})).forEach((function(e){n.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.monsterName)))}));var s=[];a.waves.filter((function(t){return V.matchEncounterWave(e.state.text,t)})).forEach((function(t){var a=[];t.slots.filter((function(t){return V.matchEncounterSlot(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.monsterName)))})),s.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openEncounter(a.id)}},r.a.createElement("div",{className:"section"},a.name),n,s))})),this.props.maps.filter((function(t){return V.matchMap(e.state.text,t)})).forEach((function(a){var n=[];a.areas.filter((function(t){return V.matchMapArea(e.state.text,t)})).forEach((function(e){n.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},"map area")))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openMap(a.id)}},r.a.createElement("div",{className:"section"},a.name),n))})),0===t.length&&t.push(r.a.createElement(Ne,{key:"empty"},"nothing found"))),r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement(J,{text:this.state.text,placeholder:"enter your search term here",minLength:3,onChange:function(t){return e.setSearchTerm(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ua=a(254),ma=a(253),pa=a(252),da=a(123),ha=a.n(da),fa=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"init",value:function(){this.peer||(this.peer=new ha.a(b.guid()),this.peer.on("open",(function(e){return console.info("peer "+e+" open")})),this.peer.on("close",(function(){return console.info("peer closed")})),this.peer.on("disconnected",(function(){return console.info("peer disconnected")})),this.peer.on("error",(function(e){return console.error(e)})))}},{key:"getID",value:function(){return this.peer?this.peer.id:""}},{key:"getName",value:function(e){var t=this.data.people.find((function(t){return t.id===e}));return t?t.name:"unknown person"}},{key:"getStatus",value:function(e){var t=this.data.people.find((function(t){return t.id===e}));return t?t.status:""}},{key:"createTextPacket",value:function(t,a){return{type:"message",payload:{id:b.guid(),from:e.getID(),to:t,type:"text",data:{text:a}}}}},{key:"createLinkPacket",value:function(t,a){return{type:"message",payload:{id:b.guid(),from:e.getID(),to:t,type:"link",data:{url:a}}}}},{key:"createImagePacket",value:function(t,a){return{type:"message",payload:{id:b.guid(),from:e.getID(),to:t,type:"image",data:{image:a}}}}},{key:"createRollPacket",value:function(t,a){return{type:"message",payload:{id:b.guid(),from:e.getID(),to:t,type:"roll",data:{roll:a}}}}},{key:"processPacket",value:function(e){switch(e.type){case"pulse":this.data.people=e.payload.people;break;case"player-info":var t=e.payload.player,a=this.data.people.find((function(e){return e.id===t}));a&&(a.status=e.payload.status);break;case"message":var n={id:e.payload.id,from:e.payload.from,to:e.payload.to,type:e.payload.type,data:e.payload.data};this.data.messages.push(n)}}}]),e}();fa.peer=null,fa.data={people:[],messages:[]};var va=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"init",value:function(){var e=this;this.initialised||fa.peer&&(fa.peer.on("connection",(function(t){e.connections.push(t),t.on("open",(function(){console.info("connection opened: "+t.label),e.sendPulse()})),t.on("close",(function(){console.info("connection closed: "+t.label);var a=e.connections.indexOf(t);e.connections.splice(a,1),e.onDataChanged()})),t.on("error",(function(a){console.error(a);var n=e.connections.indexOf(t);e.connections.splice(n,1),e.onDataChanged()})),t.on("data",(function(t){e.onDataReceived(t)}))})),setInterval((function(){e.sendPulse()}),3e4),this.initialised=!0)}},{key:"sendPulse",value:function(){var e=this.connections.filter((function(e){return e.open})).map((function(e){return{id:e.peer,name:e.label,status:fa.getStatus(e.peer)}}));b.sort(e),e.unshift({id:fa.getID(),name:"DM",status:""}),this.onDataReceived({type:"pulse",payload:{people:e}})}},{key:"sendMessage",value:function(e,t){this.onDataReceived(fa.createTextPacket(e,t))}},{key:"sendLink",value:function(e,t){this.onDataReceived(fa.createLinkPacket(e,t))}},{key:"sendImage",value:function(e,t){this.onDataReceived(fa.createImagePacket(e,t))}},{key:"sendRoll",value:function(e,t){this.onDataReceived(fa.createRollPacket(e,t))}},{key:"onDataReceived",value:function(e){fa.processPacket(e),this.onDataChanged(),this.broadcast(e)}},{key:"broadcast",value:function(e){this.connections.filter((function(e){return e.open})).forEach((function(t){return t.send(e)}))}}]),e}();va.initialised=!1,va.connections=[],va.onDataChanged=void 0;var ga=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getState",value:function(){return this.state}},{key:"connect",value:function(e,t){var a=this;if(fa.peer){this.state="connecting";var n=fa.peer.connect(e,{label:t,reliable:!0});this.connection=n,n.on("open",(function(){console.info("connection opened"),a.state="connected",a.onStateChanged()})),n.on("close",(function(){console.info("connection closed"),a.state="not connected",a.connection=null,a.onStateChanged()})),n.on("error",(function(e){console.error(e),a.state="not connected",a.connection=null,a.onStateChanged()})),n.on("data",(function(e){fa.processPacket(e),a.onDataChanged()}))}}},{key:"sendUpdate",value:function(e){this.sendPacket({type:"player-info",payload:{player:fa.getID(),status:e}})}},{key:"sendMessage",value:function(e,t){this.sendPacket(fa.createTextPacket(e,t))}},{key:"sendLink",value:function(e,t){this.sendPacket(fa.createLinkPacket(e,t))}},{key:"sendImage",value:function(e,t){this.sendPacket(fa.createImagePacket(e,t))}},{key:"sendRoll",value:function(e,t){this.sendPacket(fa.createRollPacket(e,t))}},{key:"sendPacket",value:function(e){this.connection&&this.connection.send(e)}}]),e}();ga.connection=null,ga.state="not connected",ga.onStateChanged=void 0,ga.onDataChanged=void 0;var ba=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getDieTypeBox",value:function(e){var t=this,a=this.props.dice[e];return r.a.createElement("div",{className:a>0?"die-type":"die-type none",onClick:function(a){return t.dieTypeClicked(a,e,!a.ctrlKey)},onContextMenu:function(a){return t.dieTypeClicked(a,e,!1)}},r.a.createElement("div",{className:"die-type-name"},"d",e),r.a.createElement("div",{className:"die-type-value"},a))}},{key:"getConstantBox",value:function(){var e=this,t=this.props.constant;return r.a.createElement("div",{className:t>0?"die-type":"die-type none",onClick:function(t){return e.dieTypeClicked(t,0,!t.ctrlKey)},onContextMenu:function(t){return e.dieTypeClicked(t,0,!1)}},r.a.createElement("div",{className:"die-type-name"},"+/-"),r.a.createElement("div",{className:"die-type-value"},t))}},{key:"dieTypeClicked",value:function(e,t,a){if(e.preventDefault(),0===t){var n=this.props.constant+(a?1:-1);this.props.setConstant(n)}else{var r=Math.max(this.props.dice[t]+(a?1:-1),0);this.props.setDie(t,r)}}},{key:"render",value:function(){var e=this,t=this.props.dice[4]+this.props.dice[6]+this.props.dice[8]+this.props.dice[10]+this.props.dice[12]+this.props.dice[20]+this.props.dice[100],a="";[100,20,12,10,8,6,4].forEach((function(t){0!==e.props.dice[t]&&(a&&(a+=" + "),a+=e.props.dice[t]+"d"+t)})),0!==this.props.constant&&(a&&(this.props.constant>0?a+=" + ":a+=" - "),a+=Math.abs(this.props.constant));var n=null;return n=1===t&&1===this.props.dice[20]?r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.rollDice("")}},"roll ",a)),r.a.createElement(h.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.rollDice("advantage")}},"advantage")),r.a.createElement(h.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.rollDice("disadvantage")}},"disadvantage"))):r.a.createElement("div",null,r.a.createElement("button",{className:t>0?"":"disabled",onClick:function(){return e.props.rollDice("")}},"roll ",a)),r.a.createElement("div",{className:"die-roll-panel"},r.a.createElement("div",{className:"die-types"},this.getDieTypeBox(4),this.getDieTypeBox(6),this.getDieTypeBox(8),this.getDieTypeBox(10),this.getDieTypeBox(12),this.getDieTypeBox(20),this.getDieTypeBox(100),this.getConstantBox()),r.a.createElement("hr",null),r.a.createElement(d.a,{gutter:10,align:"middle"},r.a.createElement(h.a,{span:22},n),r.a.createElement(h.a,{span:2,className:"section centered"},r.a.createElement(R.a,{className:t>0?"die-reset-button":"die-reset-button disabled",title:"reset dice",onClick:function(){return e.props.resetDice()}}))))}}]),a}(r.a.Component),ya=a(257),Ea=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=[],t=0;if(this.props.result.rolls.forEach((function(a){var n="";20===a.sides&&(1===a.value&&(n="nat1"),20===a.value&&(n="nat20")),e.push(r.a.createElement(F.a,{key:a.id,className:n},"d",a.sides,": ",r.a.createElement("b",null,a.value))),t+=a.value})),0!==this.props.result.constant){var a=this.props.result.constant>0?"+":"-";e.push(r.a.createElement(F.a,{key:"constant"},a," ",r.a.createElement("b",null,Math.abs(this.props.result.constant)))),t+=this.props.result.constant}var n=""===this.props.result.mode?null:r.a.createElement(ya.a,{className:"roll-icon "+this.props.result.mode,title:this.props.result.mode});return r.a.createElement("div",{className:"die-roll-result group-panel"},r.a.createElement("div",{className:"rolls"},e,n),r.a.createElement("div",{className:"sum"},t))}}]),a}(r.a.Component),ka=new de.a.Converter;ka.setOption("tables",!0);var wa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{switch(this.props.type){case"dm":return r.a.createElement(Na,null);case"player":return r.a.createElement(Ca,null)}}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Na=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={},va.init(),va.onDataChanged=function(){return n.setState(n.state)},n}return Object(c.a)(a,[{key:"componentWillUnmount",value:function(){va.onDataChanged=function(){return null}}},{key:"render",value:function(){try{var e=window.location+(window.location.toString().endsWith("/")?"":"/")+"player";return r.a.createElement("div",null,r.a.createElement(Z,{text:"information"},r.a.createElement(Ne,null,r.a.createElement("p",null,"give your dm code to your players, and ask them to open the player app in their browser")),r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},r.a.createElement("p",{className:"smallest"},"your dm code for this session:"),r.a.createElement("p",{className:"smallest strong"},fa.getID())),r.a.createElement("div",{className:"icon-section"},r.a.createElement(Kt.a,{title:"copy",onClick:function(e){return navigator.clipboard.writeText(fa.getID())}}))),r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},r.a.createElement("p",{className:"smallest"},"player app url:"),r.a.createElement("p",{className:"smallest strong"},e)),r.a.createElement("div",{className:"icon-section"},r.a.createElement(Kt.a,{title:"copy",onClick:function(t){return navigator.clipboard.writeText(e)}})))),r.a.createElement(Z,{text:"people"},r.a.createElement(xa,{people:fa.data.people})),r.a.createElement(Sa,{messages:fa.data.messages}),r.a.createElement(Ia,{sendMessage:function(e,t){return va.sendMessage(e,t)},sendLink:function(e,t){return va.sendLink(e,t)},sendImage:function(e,t){return va.sendImage(e,t)},sendRoll:function(e,t){return va.sendRoll(e,t)}}))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ca=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={code:"",name:"",status:""},ga.onStateChanged=function(){return n.setState(n.state)},ga.onDataChanged=function(){return n.setState(n.state)},n}return Object(c.a)(a,[{key:"componentWillUnmount",value:function(){ga.onStateChanged=function(){return null},ga.onDataChanged=function(){return null}}},{key:"setCode",value:function(e){this.setState({code:e})}},{key:"setName",value:function(e){this.setState({name:e})}},{key:"setStatus",value:function(e){this.setState({status:e})}},{key:"canConnect",value:function(){return""!==this.state.code&&""!==this.state.name}},{key:"connect",value:function(){this.canConnect()&&ga.connect(this.state.code,this.state.name)}},{key:"sendUpdate",value:function(){var e=this.state.status;this.setState({status:""},(function(){ga.sendUpdate(e)}))}},{key:"render",value:function(){var e=this;try{switch(ga.getState()){case"not connected":return r.a.createElement("div",{className:"connection-panel"},r.a.createElement("div",{className:"heading"},"connect"),r.a.createElement(J,{placeholder:"dm code",debounce:!1,text:this.state.code,onChange:function(t){return e.setCode(t)}}),r.a.createElement(J,{placeholder:"your name",debounce:!1,text:this.state.name,onChange:function(t){return e.setName(t)}}),r.a.createElement("button",{className:this.canConnect()?"":"disabled",onClick:function(){return e.connect()}},"connect"));case"connecting":return r.a.createElement("div",{className:"connection-panel"},r.a.createElement(Ne,null,r.a.createElement("p",null,"connecting...")));case"connected":return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(Ne,null,r.a.createElement("p",null,"you can set your status here")),r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"subheading"},fa.getName(fa.getID())),r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(J,{placeholder:"update your status",debounce:!1,text:this.state.status,onChange:function(t){return e.setStatus(t)},onPressEnter:function(){return e.sendUpdate()}}),r.a.createElement("div",{className:"icons"},r.a.createElement(ua.a,{onClick:function(){return e.sendUpdate()},title:"update status"})))),r.a.createElement(Ne,null,r.a.createElement("p",null,"the following people are connected")),r.a.createElement(xa,{people:fa.data.people})),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(Sa,{messages:fa.data.messages}),r.a.createElement(Ia,{sendMessage:function(e,t){return ga.sendMessage(e,t)},sendLink:function(e,t){return ga.sendLink(e,t)},sendImage:function(e,t){return ga.sendImage(e,t)},sendRoll:function(e,t){return ga.sendRoll(e,t)}})))}}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),xa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{if(this.props.people.length<2)return r.a.createElement(Ne,{key:"empty"},r.a.createElement("p",null,"no-one else is currently connected"));var e=this.props.people.map((function(e){return r.a.createElement("div",{key:e.id,className:"group-panel person"},r.a.createElement("div",{className:"name"},e.name),r.a.createElement("div",{className:"status"},e.status))}));return r.a.createElement("div",{className:"people-panel"},e)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Sa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"showMessage",value:function(e){var t=fa.getID();return e.from===t||0===e.to.length||e.to.includes(t)}},{key:"render",value:function(){var e=this;try{var t=this.props.messages.filter((function(t){return e.showMessage(t)})).map((function(e){return r.a.createElement(Ma,{key:e.id,message:e})}));return 0===t.length&&t.push(r.a.createElement(Ne,{key:"empty"},r.a.createElement("p",null,"no messages yet"))),r.a.createElement("div",{className:"message-panel"},r.a.createElement("div",{className:"heading"},"messages"),t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ma=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e,t=fa.getName(this.props.message.from),a="message",n="message-byline",s="message-content "+this.props.message.type,i=null;switch(this.props.message.from===fa.getID()?a+=" from-me":a+=" to-me",this.props.message.type){case"text":var o=this.props.message.data.text;o.startsWith("/")?(s+=" emote",e=r.a.createElement("div",null,fa.getName(this.props.message.from)+" "+o.substr(1))):e=r.a.createElement("div",{dangerouslySetInnerHTML:{__html:ka.makeHtml(o)}});break;case"link":var c=this.props.message.data.url;e=r.a.createElement("a",{className:"link",href:c,target:"_blank",rel:"noopener noreferrer"},c);break;case"image":var l=this.props.message.data.image;e=r.a.createElement("img",{className:"nonselectable-image",src:l,alt:""});break;case"roll":var u=this.props.message.data.roll;e=r.a.createElement(Ea,{result:u})}return 0!==this.props.message.to.length&&(t+=" to "+this.props.message.to.map((function(e){return fa.getName(e)})).join(", "),n+=" private",i=r.a.createElement(ma.a,{title:"private message"})),r.a.createElement("div",{className:a},r.a.createElement("div",{className:n},t,i),r.a.createElement("div",{className:s},e))}catch(m){return console.error(m),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ia=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(o.a)(this,a),n=t.call(this,e);var r={};return[4,6,8,10,12,20,100].forEach((function(e){return r[e]=0})),r[20]=1,n.state={type:"text",message:"",multiline:!1,image:"",dice:r,constant:0,mode:"public",recipients:[]},n}return Object(c.a)(a,[{key:"setType",value:function(e){this.setState({type:e})}},{key:"setMessage",value:function(e){this.setState({message:e})}},{key:"toggleMultiline",value:function(){this.setState({multiline:!this.state.multiline})}},{key:"setImage",value:function(e){this.setState({image:e})}},{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(e){if(e.target){var a=e.target.result;t.setImage(a)}},a.readAsDataURL(e),!1}},{key:"setDie",value:function(e,t){var a=this.state.dice;a[e]=t,this.setState({dice:a})}},{key:"setConstant",value:function(e){this.setState({constant:e})}},{key:"resetDice",value:function(){var e=this.state.dice;[4,6,8,10,12,20,100].forEach((function(t){return e[t]=0})),this.setState({dice:e})}},{key:"setMode",value:function(e){this.setState({mode:e,recipients:"public"===e?[]:this.state.recipients})}},{key:"addRecipient",value:function(e){var t=this.state.recipients;t.push(e),this.setState({recipients:t})}},{key:"removeRecipient",value:function(e){var t=this.state.recipients,a=t.indexOf(e);t.splice(a,1),this.setState({recipients:t})}},{key:"canSend",value:function(){var e=!1;switch(this.state.mode){case"public":e=!0;break;case"private":e=this.state.recipients.length>0}var t=!1;switch(this.state.type){case"text":case"link":t=""!==this.state.message;break;case"image":t=""!==this.state.image;break;case"roll":t=!0}return e&&t}},{key:"sendMessage",value:function(){var e=this;if(this.canSend()){var t=Object(E.a)(this.state.recipients),a=this.state.message.split("\n").join("\n\n");this.setState({message:""},(function(){e.props.sendMessage(t,a)}))}}},{key:"sendLink",value:function(){var e=this;if(this.canSend()){var t=Object(E.a)(this.state.recipients),a=this.state.message;this.setState({message:""},(function(){e.props.sendLink(t,a)}))}}},{key:"sendImage",value:function(){var e=this;if(this.canSend()){var t=Object(E.a)(this.state.recipients),a=this.state.image;this.setState({image:""},(function(){e.props.sendImage(t,a)}))}}},{key:"sendRoll",value:function(e){if(this.canSend()){var t=Object(E.a)(this.state.recipients),a=k.rollDice(this.state.dice,this.state.constant,e);this.props.sendRoll(t,a)}}},{key:"getMessageSection",value:function(){var e=this;switch(this.state.type){case"text":return r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(J,{placeholder:"send a message",multiLine:this.state.multiline,debounce:!1,text:this.state.message,onChange:function(t){return e.setMessage(t)},onPressEnter:function(){return e.sendMessage()}}),r.a.createElement("div",{className:"icons"},r.a.createElement(pa.a,{onClick:function(){return e.toggleMultiline()},title:"expand",className:this.state.multiline?"active":""}),r.a.createElement(ua.a,{onClick:function(){return e.sendMessage()},title:"send message",className:this.canSend()?"":"disabled"})));case"link":return r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(J,{placeholder:"send a link",debounce:!1,text:this.state.message,onChange:function(t){return e.setMessage(t)},onPressEnter:function(){return e.sendLink()}}),r.a.createElement("div",{className:"icons"},r.a.createElement(ua.a,{onClick:function(){return e.sendLink()},title:"send message",className:this.canSend()?"":"disabled"})));case"image":return""!==this.state.image?r.a.createElement("div",null,r.a.createElement("img",{className:"nonselectable-image",src:this.state.image,alt:""}),r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.setImage("")}},"clear")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.sendImage()}},"send")))):r.a.createElement("div",null,r.a.createElement(lt.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")));case"roll":return r.a.createElement(ba,{dice:this.state.dice,constant:this.state.constant,setDie:function(t,a){return e.setDie(t,a)},setConstant:function(t){return e.setConstant(t)},resetDice:function(){return e.resetDice()},rollDice:function(t){return e.sendRoll(t)}})}return null}},{key:"getSettingsSection",value:function(){var e=this,t=null;if("private"===this.state.mode){var a=fa.data.people.filter((function(e){return e.id!==fa.getID()})).map((function(t){return r.a.createElement(A,{key:t.id,label:t.name,checked:e.state.recipients.includes(t.id),display:"switch",onChecked:function(a){return a?e.addRecipient(t.id):e.removeRecipient(t.id)}})})),n=null;0===this.state.recipients.length&&(n=r.a.createElement(Ne,null,r.a.createElement("p",null,"for a private message, you must select at least one person"))),t=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"choose who to send your message to"),a,n)}return r.a.createElement(Z,{text:"settings"},r.a.createElement(re,{options:["public","private"].map((function(e){return{id:e,text:e}})),selectedID:this.state.mode,onSelect:function(t){return e.setMode(t)}}),t)}},{key:"render",value:function(){var e=this;try{return fa.data.people.length<2?null:r.a.createElement("div",{className:"send-message-panel"},r.a.createElement(re,{options:["text","link","image","roll"].map((function(e){return{id:e,text:e}})),selectedID:this.state.type,onSelect:function(t){return e.setType(t)}}),this.getMessageSection(),this.getSettingsSection())}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Oa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-content"},r.a.createElement(wa,{type:"dm"})))}}]),a}(r.a.Component),Da=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={results:[]},n}return Object(c.a)(a,[{key:"rollDice",value:function(e){var t=k.rollDice(this.props.dice,this.props.constant,e);this.state.results.unshift(t),this.setState({results:this.state.results})}},{key:"render",value:function(){var e=this;try{var t=this.state.results.map((function(e){return r.a.createElement(Ea,{key:e.id,result:e})}));return r.a.createElement("div",null,r.a.createElement(ba,{dice:this.props.dice,constant:this.props.constant,setDie:function(t,a){return e.props.setDie(t,a)},setConstant:function(t){return e.props.setConstant(t)},resetDice:function(){return e.props.resetDice()},rollDice:function(t){return e.rollDice(t)}}),r.a.createElement("hr",null),t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ja=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={externalWindow:null,containerElement:null},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=window.open("","","width=800, height=500, left=200, top=200"),a=null;t&&((a=t.document.createElement("div")).className="dojo popout",t.document.body.appendChild(a),Array.from(document.styleSheets).forEach((function(e){var a=e;if(e.href){var n=document.createElement("link");n.rel="stylesheet",n.href=e.href,t.document.head.appendChild(n)}else if(a&&a.cssRules&&a.cssRules.length>0){var r=document.createElement("style");Array.from(a.cssRules).forEach((function(e){r.appendChild(document.createTextNode(e.cssText))})),t.document.head.appendChild(r)}})),t.document.title=this.props.title,t.addEventListener("beforeunload",(function(){e.props.onCloseWindow()})));this.setState({externalWindow:t,containerElement:a})}},{key:"componentWillUnmount",value:function(){this.state.externalWindow&&this.state.externalWindow.close()}},{key:"render",value:function(){try{return this.state.containerElement?i.a.createPortal(this.props.children,this.state.containerElement):null}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ta=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={filename:null,data:null,playerViewOpen:!1},n}return Object(c.a)(a,[{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target){var n=a.target.result;t.setState({filename:e.name,data:n})}},a.readAsDataURL(e),!1}},{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"clear",value:function(){this.setState({filename:null,data:null,playerViewOpen:!1})}},{key:"getPlayerView",value:function(){var e=this;return this.state.playerViewOpen?r.a.createElement(ja,{title:"Handout",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("img",{className:"nonselectable-image",src:this.state.data||"",alt:this.state.filename||""})):null}},{key:"render",value:function(){var e=this;try{var t=null;return t=this.state.data?r.a.createElement("div",null,r.a.createElement("img",{className:"nonselectable-image",src:this.state.data||"",alt:this.state.filename||""}),r.a.createElement(A,{label:"show player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}}),r.a.createElement("button",{onClick:function(){return e.clear()}},"change handout")):r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("p",null,"you can use this tool to select an image and show it to your players")),r.a.createElement(lt.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ot.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),r.a.createElement("div",null,t,this.getPlayerView())}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Va=a(234),Pa=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"say",value:function(){var t=Object(Xt.a)(Ut.a.mark((function t(a,n){var r;return Ut.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.speechSynthesis.cancel(),r=new SpeechSynthesisUtterance(a),t.next=4,e.chooseVoice(n);case 4:r.voice=t.sent,r.rate=e.randomValue(.5,1.5),r.pitch=e.randomValue(.5,1.5),window.speechSynthesis.speak(r);case 8:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},{key:"chooseVoice",value:function(){var t=Object(Xt.a)(Ut.a.mark((function t(a){var n,r,s,i;return Ut.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getVoices();case 2:return n=t.sent,r=a.map((function(t){return e.getLanguageCode(t)})),0===(s=n.filter((function(e){return r.includes(e.lang.substr(0,2))}))).length&&(s=n.filter((function(e){return e.default}))),0===s.length&&(s=n),i=Math.floor(Math.random()*s.length),t.abrupt("return",s[i]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getVoices",value:function(){return new Promise((function(e){var t=window.speechSynthesis.getVoices();t.length>0?e(t):speechSynthesis.onvoiceschanged=function(){t=window.speechSynthesis.getVoices(),e(t)}}))}},{key:"getLanguageCode",value:function(e){switch(e){case"armenian":return"hy";case"basque":return"eu";case"bulgarian":return"bg";case"chichewa":return"ny";case"chinese":return"zh";case"croatian":return"hr";case"czech":return"cs";case"dutch":return"nl";case"german":return"de";case"greek":return"el";case"icelandic":return"is";case"irish":return"ga";case"kannada":return"kn";case"kazakh":return"kk";case"latvian":return"lv";case"lithuanian":return"lt";case"macedonian":return"mk";case"malay":return"ms";case"maltese":return"mt";case"maori":return"mi";case"polish":return"pl";case"portuguese":return"pt";case"punjabi":return"pa";case"samoan":return"sm";case"serbian":return"sr";case"shona":return"sn";case"spanish":return"es";case"swedish":return"sv";case"turkish":return"tr";case"welsh":return"cy";default:return e.substr(0,2)}}},{key:"randomValue",value:function(e,t){return e+(Math.random()+Math.random()+Math.random())/3*(t-e)}}]),e}(),Aa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={preset:null,languages:[],output:[]},n}return Object(c.a)(a,[{key:"getAllLanguages",value:function(){return["afrikaans","amharic","armenian","basque","belarusian","bulgarian","chichewa","chinese","croatian","czech","danish","dutch","english","finnish","french","german","greek","hawaiian","hindi","hungarian","icelandic","irish","italian","japanese","kannada","kazakh","korean","kyrgyz","latvian","lithuanian","macedonian","malay","maltese","maori","myanmar","nepali","norwegian","polish","portuguese","punjabi","romanian","russian","samoan","serbian","shona","somali","spanish","swahili","swedish","thai","turkish","welsh","yiddish","zulu"]}},{key:"addLanguage",value:function(e){this.state.languages.push(e),this.setState({languages:this.state.languages.sort()})}},{key:"removeLanguage",value:function(e){var t=this.state.languages.indexOf(e);this.state.languages.splice(t,1),this.setState({languages:this.state.languages})}},{key:"usePreset",value:function(e){var t=[];switch(e){case"draconic":t=["armenian","irish","maltese"];break;case"dwarvish":t=["czech","german","yiddish"];break;case"elvish":t=["finnish","spanish","welsh"];break;case"goblin":t=["hawaiian","kyrgyz","somali"];break;case"orc":t=["macedonian","russian","turkish"]}this.setState({preset:e,languages:t.sort(),output:[]})}},{key:"random",value:function(){for(var e=this.getAllLanguages(),t=[];3!==t.length;){var a=e[Math.floor(Math.random()*e.length)];t.includes(a)||t.push(a)}this.setState({languages:t,output:[]})}},{key:"generate",value:function(){var e=this,t=this.state.languages.map((function(e){return fetch("/dojo/data/langs/"+e+".txt")}));Promise.all(t).then((function(t){var a=t.map((function(e){return e.text()}));Promise.all(a).then((function(t){I.initModel(t),e.setState({output:I.generate(5).map((function(e){return e.line}))})}))}))}},{key:"reset",value:function(){this.setState({preset:null,languages:[],output:[]})}},{key:"render",value:function(){var e=this;try{var t=["draconic","dwarvish","elvish","goblin","orc","custom"].map((function(e){return{id:e,text:e}})),a=this.state.languages.length>0,n=null;if("custom"===this.state.preset){var s=this.state.languages.join(", ");""===s&&(s="none");var i=this.getAllLanguages().map((function(t){var a=e.state.languages.includes(t);return r.a.createElement(A,{key:t,label:t,checked:a,display:"button",onChecked:function(a){return a?e.addLanguage(t):e.removeLanguage(t)}})})),o=a||this.state.output.length>0;n=r.a.createElement("div",{className:"group-panel"},r.a.createElement(Z,{text:"selected languages: "+s},r.a.createElement("div",{className:"language-options"},r.a.createElement(Fe,{columns:3,content:i}))),r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.random()}},"random languages")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{className:o?"":"disabled",onClick:function(){return e.reset()}},"reset"))))}var c=[];this.state.output.length>0&&c.push(r.a.createElement("hr",{key:"div"}));for(var l=0;l!==this.state.output.length;++l)c.push(r.a.createElement(Ra,{key:l,text:this.state.output[l],languages:this.state.languages}));return r.a.createElement("div",null,r.a.createElement(re,{options:t,selectedID:this.state.preset,itemsPerRow:3,onSelect:function(t){return e.usePreset(t)}}),n,r.a.createElement("hr",null),r.a.createElement("button",{className:a?"":"disabled",onClick:function(){return e.generate()}},"generate text"),c)}catch(u){return console.error(u),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ra=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"say",value:function(e){e.stopPropagation(),Pa.say(this.props.text,this.props.languages)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement("div",null,r.a.createElement(Kt.a,{title:"copy",onClick:function(t){return e.copy(t)}})),r.a.createElement("div",null,r.a.createElement(Va.a,{title:"say (experimental)",onClick:function(t){return e.say(t)}}))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),za=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(o.a)(this,a);var r=[(n=t.call(this,e)).createCard("ace of swords","breakthrough, clarity, sharp mind","confusion, brutality, chaos"),n.createCard("two of swords","difficult choices, indecision, stalemate","lesser of two evils, no right choice, confusion"),n.createCard("three of swords","heartbreak, suffering, grief","recovery, forgiveness, moving on"),n.createCard("four of swords","rest, restoration, contemplation","restlessness, burnout, stress"),n.createCard("five of swords","unbridled ambition, win at all costs, sneakiness","lingering resentment, desire to reconcile, forgiveness"),n.createCard("six of swords","transition, leaving behind, moving on","emotional baggage, unresolved issues, resisting transition"),n.createCard("seven of swords","deception, trickery, tactics and strategy","coming clean, rethinking approach, deception"),n.createCard("eight of swords","imprisonment, entrapment, self-victimization","self acceptance, new perspective, freedom"),n.createCard("nine of swords","anxiety, hopelessness, trauma","hope, reaching out, despair"),n.createCard("ten of swords","failure, collapse, defeat","can't get worse, only upwards, inevitable end"),n.createCard("page of swords","curiosity, restlessness, mental energy","deception, manipulation, all talk"),n.createCard("knight of swords","action, impulsiveness, defending beliefs","no direction, disregard for consequences, unpredictability"),n.createCard("queen of swords","complexity, perceptiveness, clear mindedness","cold hearted, cruel, bitterness"),n.createCard("king of swords","head over heart, discipline, truth","manipulative, cruel, weakness"),n.createCard("ace of wands","creation, willpower, inspiration, desire","lack of energy, lack of passion, boredom"),n.createCard("two of wands","planning, making decisions, leaving home","fear of change, playing safe, bad planning"),n.createCard("three of wands","looking ahead, expansion, rapid growth","obstacles, delays, frustration"),n.createCard("four of wands","community, home, celebration","lack of support, transience, home conflicts"),n.createCard("five of wands","competition, rivalry, conflict","avoiding conflict, respecting differences"),n.createCard("six of wands","victory, success, public reward","excess pride, lack of recognition, punishment"),n.createCard("seven of wands","perseverance, defensive, maintaining control","give up, destroyed confidence, overwhelmed"),n.createCard("eight of wands","rapid action, movement, quick decisions","panic, waiting, slowdown"),n.createCard("nine of wands","resilience, grit, last stand","exhaustion, fatigue, questioning motivations"),n.createCard("ten of wands","accomplishment, responsibility, burden","inability to delegate, overstressed, burnt out"),n.createCard("page of wands","exploration, excitement, freedom","lack of direction, procrastination, creating conflict"),n.createCard("knight of wands","action, adventure, fearlessness","anger, impulsiveness, recklessness"),n.createCard("queen of wands","courage, determination, joy","selfishness, jealousy, insecurities"),n.createCard("king of wands","big picture, leader, overcoming challenges","impulsive, overbearing, unachievable expectations"),n.createCard("ace of cups","new feelings, spirituality, intuition","emotional loss, blocked creativity, emptiness"),n.createCard("two of cups","unity, partnership, connection","imbalance, broken communication, tension"),n.createCard("three of cups","friendship, community, happiness","overindulgence, gossip, isolation"),n.createCard("four of cups","apathy, contemplation, disconnectedness","sudden awareness, choosing happiness, acceptance"),n.createCard("five of cups","loss, grief, self-pity","acceptance, moving on, finding peace"),n.createCard("six of cups","familiarity, happy memories, healing","moving forward, leaving home, independence"),n.createCard("seven of cups","searching for purpose, choices, daydreaming","lack of purpose, diversion, confusion"),n.createCard("eight of cups","walking away, disillusionment, leaving behind","avoidance, fear of change, fear of loss"),n.createCard("nine of cups","satisfaction, emotional stability, luxury","lack of inner joy, smugness, dissatisfaction"),n.createCard("ten of cups","inner happiness, fulfillment, dreams coming true","shattered dreams, broken family, domestic disharmony"),n.createCard("page of cups","happy surprise, dreamer, sensitivity","emotional immaturity, insecurity, disappointment"),n.createCard("knight of cups","following the heart, idealist, romantic","moodiness, disappointment"),n.createCard("queen of cups","compassion, calm, comfort","martyrdom, insecurity, dependence"),n.createCard("king of cups","compassion, control, balance","coldness, moodiness, bad advice"),n.createCard("ace of pentacles","opportunity, prosperity, new venture","lost opportunity, missed chance, bad investment"),n.createCard("two of pentacles","balancing decisions, priorities, adapting to change","loss of balance, disorganized, overwhelmed"),n.createCard("three of pentacles","teamwork, collaboration, building","lack of teamwork, disorganized, group conflict"),n.createCard("four of pentacles","conservation, frugality, security","greediness, stinginess, possessiveness"),n.createCard("five of pentacles","need, poverty, insecurity","recovery, charity, improvement"),n.createCard("six of pentacles","charity, generosity, sharing","strings attached, stinginess, power and domination"),n.createCard("seven of pentacles","hard work, perseverance, diligence","work without results, distractions, lack of rewards"),n.createCard("eight of pentacles","apprenticeship, passion, high standards","lack of passion, uninspired, no motivation"),n.createCard("nine of pentacles","fruits of labor, rewards, luxury","reckless spending, living beyond means, false success"),n.createCard("ten of pentacles","legacy, culmination, inheritance","fleeting success, lack of stability, lack of resources"),n.createCard("page of pentacles","ambition, desire, diligence","lack of commitment, greediness, laziness"),n.createCard("knight of pentacles","efficiency, hard work, responsibility","laziness, obsessiveness, work without reward"),n.createCard("queen of pentacles","practicality, creature comforts, financial security","self-centeredness, jealousy, smothering"),n.createCard("king of pentacles","abundance, prosperity, security","greed, indulgence, sensuality"),n.createCard("the fool","innocence, new beginnings, free spirit","recklessness, taken advantage of, inconsideration"),n.createCard("the magician","willpower, desire, creation, manifestation","trickery, illusions, out of touch"),n.createCard("the high priestess","intuitive, unconscious, inner voice","lack of center, lost inner voice, repressed feelings"),n.createCard("the empress","motherhood, fertility, nature","dependence, smothering, emptiness, nosiness"),n.createCard("the emperor","authority, structure, control, fatherhood","tyranny, rigidity, coldness"),n.createCard("the hierophant","tradition, conformity, morality, ethics","rebellion, subversiveness, new approaches"),n.createCard("the lovers","partnerships, duality, union","loss of balance, one-sidedness, disharmony"),n.createCard("the chariot","direction, control, willpower","lack of control, lack of direction, aggression"),n.createCard("strength","inner strength, bravery, compassion, focus","self doubt, weakness, insecurity"),n.createCard("the hermit","contemplation, search for truth, inner guidance","loneliness, isolation, lost your way"),n.createCard("the wheel of fortune","change, cycles, inevitable fate","no control, clinging to control, bad luck"),n.createCard("justice","cause and effect, clarity, truth","dishonesty, unaccountability, unfairness"),n.createCard("the hanged man","sacrifice, release, martyrdom","stalling, needless sacrifice, fear of sacrifice"),n.createCard("death","end of cycle, beginnings, change, metamorphosis","fear of change, holding on, stagnation, decay"),n.createCard("temperance","middle path, patience, finding meaning","extremes, excess, lack of balance"),n.createCard("the devil","addiction, materialism, playfulness","freedom, release, restoring control"),n.createCard("the tower","sudden upheaval, broken pride, disaster","disaster avoided, delayed disaster, fear of suffering"),n.createCard("the star","hope, faith, rejuvenation","faithlessness, discouragement, insecurity"),n.createCard("the moon","unconscious, illusions, intuition","confusion, fear, misinterpretation"),n.createCard("the sun","joy, success, celebration, positivity","negativity, depression, sadness"),n.createCard("judgement","reflection, reckoning, awakening","lack of self awareness, doubt, self loathing"),n.createCard("the world","fulfillment, harmony, completion","incompletion, no closure")];return n.state={deck:r,draws:[]},n}return Object(c.a)(a,[{key:"createCard",value:function(e,t,a){return{id:b.guid(),name:e,meanings:{upright:t,reversed:a}}}},{key:"drawCards",value:function(e){for(var t=this,a=[],n=function(){var e=b.randomNumber(t.state.deck.length),n=t.state.deck[e];a.find((function(e){return e.cardID===n.id}))||a.push({id:b.guid(),cardID:n.id,reversed:b.randomBoolean()})};a.length<e;)n();this.setState({draws:a})}},{key:"render",value:function(){var e=this;try{var t=this.state.draws.map((function(t){var a=e.state.deck.find((function(e){return e.id===t.cardID}));return a?r.a.createElement(h.a,{span:8,key:t.id},r.a.createElement(La,{card:a,reversed:t.reversed})):null}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.drawCards(3)}},"draw cards"),r.a.createElement(d.a,null,t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),La=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={flipped:!1},n}return Object(c.a)(a,[{key:"flip",value:function(){this.setState({flipped:!this.state.flipped})}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:this.state.flipped?"oracle-card flipped":"oracle-card",onClick:function(){return e.flip()}},r.a.createElement("div",{className:"oracle-card-inner"},r.a.createElement("div",{className:"oracle-card-front"},"?"),r.a.createElement("div",{className:"oracle-card-back"},r.a.createElement("div",{className:"oracle-card-name"},this.props.card.name),r.a.createElement("div",{className:"oracle-card-reversed"},this.props.reversed?"(reversed)":""),r.a.createElement("div",{className:"oracle-card-meaning"},this.props.reversed?this.props.card.meanings.reversed:this.props.card.meanings.upright))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),qa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"die":t=r.a.createElement(Da,{dice:this.props.dice,constant:this.props.constant,setDie:function(t,a){return e.props.setDie(t,a)},setConstant:function(t){return e.props.setConstant(t)},resetDice:function(){return e.props.resetDice()}});break;case"handout":t=r.a.createElement(Ta,null);break;case"language":t=r.a.createElement(Aa,null);break;case"oracle":t=r.a.createElement(za,null)}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement(re,{options:[{id:"die",text:"die roller"},{id:"handout",text:"handout"},{id:"language",text:"language"},{id:"oracle",text:"oracle"}],selectedID:this.props.view,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Fa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{if(!this.props.sidebar.visible)return null;var t=null;switch(this.props.sidebar.type){case"tools":t=r.a.createElement(qa,{view:this.props.sidebar.subtype,setView:function(t){e.props.sidebar.subtype=t,e.props.onUpdateSidebar(e.props.sidebar)},dice:this.props.sidebar.dice,constant:this.props.sidebar.constant,setDie:function(t,a){e.props.sidebar.dice[t]=a,e.props.onUpdateSidebar(e.props.sidebar)},setConstant:function(t){e.props.sidebar.constant=t,e.props.onUpdateSidebar(e.props.sidebar)},resetDice:function(){var t=e.props.sidebar;[4,6,8,10,12,20,100].forEach((function(e){return t.dice[e]=0})),t.constant=0,e.props.onUpdateSidebar(e.props.sidebar)}});break;case"generators":t=r.a.createElement(ta,{view:this.props.sidebar.subtype,setView:function(t){e.props.sidebar.subtype=t,e.props.onUpdateSidebar(e.props.sidebar)}});break;case"reference":var a=[];this.props.library.forEach((function(e){e.monsters.forEach((function(e){return a.push(e)}))})),b.sort(a),t=r.a.createElement(ca,{view:this.props.sidebar.subtype,setView:function(t){e.props.sidebar.subtype=t,e.props.onUpdateSidebar(e.props.sidebar)},selectedPartyID:this.props.sidebar.selectedPartyID,parties:this.props.parties,selectPartyID:function(t){e.props.sidebar.selectedPartyID=t,e.props.onUpdateSidebar(e.props.sidebar)},selectedMonsterID:this.props.sidebar.selectedMonsterID,monsters:a,selectMonsterID:function(t){e.props.sidebar.selectedMonsterID=t,e.props.onUpdateSidebar(e.props.sidebar)}});break;case"session":t=r.a.createElement(Oa,null);break;case"search":t=r.a.createElement(la,{parties:this.props.parties,library:this.props.library,encounters:this.props.encounters,maps:this.props.maps,openParty:function(t){return e.props.selectParty(t)},openGroup:function(t){return e.props.selectMonsterGroup(t)},openEncounter:function(t){return e.props.selectEncounter(t)},openMap:function(t){return e.props.selectMap(t)}});break;case"about":t=r.a.createElement(_t,{parties:this.props.parties,library:this.props.library,maps:this.props.maps,combats:this.props.combats,resetAll:function(){return e.props.onResetAll()}})}return r.a.createElement("div",{className:"sidebar sidebar-right"},r.a.createElement("div",{className:"sidebar-icons"},r.a.createElement(Lt.a,{className:"tools"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"tools",onClick:function(){return e.props.onSelectSidebar("tools")}}),r.a.createElement(qt.a,{className:"generators"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"generators",onClick:function(){return e.props.onSelectSidebar("generators")}}),r.a.createElement(Ft.a,{className:"reference"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"reference",onClick:function(){return e.props.onSelectSidebar("reference")}}),r.a.createElement(Bt.a,{className:"session"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"session",onClick:function(){return e.props.onSelectSidebar("session")}}),r.a.createElement(Gt.a,{className:"search"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"search",onClick:function(){return e.props.onSelectSidebar("search")}}),r.a.createElement(Ht.a,{className:"about"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"about",onClick:function(){return e.props.onSelectSidebar("about")}})),t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ba=a(224),Ga=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"position"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"getPositionSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement(rt,{onClick:function(t){return e.props.move(e.props.item,t)}}),r.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},r.a.createElement(ne,{value:this.props.item.width+" sq",label:"width",downEnabled:this.props.item.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"width",t)}}),r.a.createElement(ne,{value:this.props.item.height+" sq",label:"height",downEnabled:this.props.item.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"height",t)}}))))}},{key:"getStyleSection",value:function(){var e=this,t=["overlay","token"].map((function(e){return{id:e,text:e}})),a=["square","rounded","circle"].map((function(e){return{id:e,text:e}}));return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"type"),r.a.createElement(re,{options:t,selectedID:this.props.item.type,onSelect:function(t){return e.props.changeValue(e.props.item,"type",t)}}),r.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"shape"),r.a.createElement(re,{options:a,selectedID:this.props.item.style,onSelect:function(t){return e.props.changeValue(e.props.item,"style",t)}}),r.a.createElement("div",{className:"subheading"},"color"),r.a.createElement("input",{type:"color",value:this.props.item.color,onChange:function(t){return e.props.changeValue(e.props.item,"color",t.target.value)}}),r.a.createElement("div",{className:"subheading"},"opacity"),r.a.createElement(L.a,{min:0,max:255,value:this.props.item.opacity,tooltipVisible:!1,onChange:function(t){return e.props.changeValue(e.props.item,"opacity",t)}})),r.a.createElement("div",{style:{display:"token"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(ne,{value:this.props.item.size,downEnabled:"tiny"!==this.props.item.size,upEnabled:"gargantuan"!==this.props.item.size,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"size",t)}})))}},{key:"render",value:function(){var e=this;try{var t=["position","style"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"position":a=this.getPositionSection();break;case"style":a=this.getStyleSection()}return r.a.createElement("div",{className:"card map",key:"selected"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map item")),r.a.createElement("div",{className:"card-content"},r.a.createElement(re,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),r.a.createElement("hr",null),a,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.remove(e.props.item)}},"remove from the map"))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ha=a(241),Wa=a(232),_a=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=[];return this.props.combatants.forEach((function(a){a.conditions.forEach((function(n){t.push(r.a.createElement(Ja,{key:n.id,condition:n,combatant:a,combatants:e.props.allCombatants,showCombatantName:e.props.combatants.length>1,nudgeConditionValue:function(t,a,n){return e.props.nudgeConditionValue(t,a,n)},editCondition:function(t){return e.props.editCondition(a,t)},removeCondition:function(t){return e.props.removeCondition(a,t)}}))}))})),r.a.createElement("div",{className:"section"},t,r.a.createElement("button",{onClick:function(){return e.props.addCondition()}},"add a condition"))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ja=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.condition.name||"condition";"exhaustion"===this.props.condition.name&&(t+=" ("+this.props.condition.level+")"),this.props.showCombatantName&&(t=this.props.combatant.displayName+": "+t);var a=null;null!==this.props.condition.duration&&(a=r.a.createElement("div",{className:"section"},r.a.createElement("i",null,k.conditionDurationText(this.props.condition,this.props.combatants))));var n=[];"exhaustion"===this.props.condition.name&&n.push(r.a.createElement("div",{key:"level",className:"section"},r.a.createElement(ne,{value:this.props.condition.level,label:"level",downEnabled:this.props.condition.level>1,upEnabled:this.props.condition.level<6,onNudgeValue:function(t){return e.props.nudgeConditionValue(e.props.condition,"level",t)}})));for(var s=k.conditionText(this.props.condition),i=0;i!==s.length;++i)n.push(r.a.createElement("div",{key:i,className:"section"},s[i]));return r.a.createElement("div",{className:"group-panel condition-panel"},r.a.createElement("div",{className:"condition-heading"},r.a.createElement("div",{className:"condition-name"},t),r.a.createElement("div",{className:"condition-buttons"},r.a.createElement(Ha.a,{title:"edit",onClick:function(){return e.props.editCondition(e.props.condition)}}),r.a.createElement(Wa.a,{title:"remove",onClick:function(){return e.props.removeCondition(e.props.condition)}}))),a,n)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ya=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:e.defaultTab,healingValue:0,damageValue:0,damageMultipliers:{}},n}return Object(c.a)(a,[{key:"nudgeHealing",value:function(e){this.setState({healingValue:Math.max(this.state.healingValue+e,0)})}},{key:"nudgeDamage",value:function(e){this.setState({damageValue:Math.max(this.state.damageValue+e,0)})}},{key:"setView",value:function(e){this.setState({view:e})}},{key:"setDamageMultiplier",value:function(e,t){var a=this.state.damageMultipliers;a[e]=t,this.setState({damageMultipliers:a})}},{key:"heal",value:function(){var e=this,t=this.state.healingValue;this.setState({healingValue:0},(function(){var a=[];e.props.combatants.forEach((function(e){var n,r,s,i=null!==(n=e.hpMax)&&void 0!==n?n:0,o=(null!==(r=e.hpCurrent)&&void 0!==r?r:0)+t;o=Math.min(o,i),a.push({id:e.id,hp:o,temp:null!==(s=e.hpTemp)&&void 0!==s?s:0,damage:0})})),e.props.changeHP(a)}))}},{key:"damage",value:function(){var e=this,t=this.state.damageValue;this.setState({damageValue:0},(function(){var a=[];e.props.combatants.forEach((function(n){var r,s,i,o=null!==(r=e.state.damageMultipliers[n.id])&&void 0!==r?r:1,c=null!==(s=n.hpCurrent)&&void 0!==s?s:0,l=null!==(i=n.hpTemp)&&void 0!==i?i:0,u=Math.floor(t*o),m=u,p=Math.min(m,l);l-=p,c-=m-=p,c=Math.max(c,0),a.push({id:n.id,hp:c,temp:l,damage:u})})),e.props.changeHP(a)}))}},{key:"getMainSection",value:function(){var e=this,t=[],a=[];if(this.props.combatants.every((function(e){return e.active}))){if(this.props.combatants.every((function(e){return e.current})))t.push(r.a.createElement("button",{key:"makeDefeated",onClick:function(){return e.props.makeDefeated(e.props.combatants)}},"mark as defeated and end turn"));else{if(1===this.props.combatants.length)!!this.props.allCombatants.find((function(t){return t.mountID===e.props.combatants[0].id}))||t.push(r.a.createElement("button",{key:"makeCurrent",onClick:function(){return e.props.makeCurrent(e.props.combatants[0])}},"start turn"));t.push(r.a.createElement("button",{key:"makeDefeated",onClick:function(){return e.props.makeDefeated(e.props.combatants)}},"mark as defeated"))}if(this.props.combatants.every((function(e){return"pc"!==e.type})))this.props.allCombatants.filter((function(e){return"pc"===e.type})).forEach((function(t){var n="engaged:"+t.displayName;a.push(r.a.createElement(F.a.CheckableTag,{key:t.id,checked:e.props.combatants.every((function(e){return e.tags.includes(n)})),onChange:function(){return e.props.toggleTag(e.props.combatants,n)}},t.displayName))}))}this.props.combatants.every((function(e){return e.defeated}))&&t.push(r.a.createElement("button",{key:"makeActive",onClick:function(){return e.props.makeActive(e.props.combatants)}},"mark as active"));var n=null;t.length>0&&(n=r.a.createElement("div",null,t,r.a.createElement("hr",null)));var s=null;return a.length>0&&(s=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"engaged with: "),a)),r.a.createElement("div",null,n,r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"quick tags: "),r.a.createElement(F.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("conc")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"conc")}},"concentrating"),r.a.createElement(F.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("bane")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"bane")}},"bane"),r.a.createElement(F.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("bless")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"bless")}},"bless"),r.a.createElement(F.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.conditions.some((function(e){return"prone"===e.name}))})),onChange:function(){return e.props.toggleCondition(e.props.combatants,"prone")}},"prone"),r.a.createElement(F.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.conditions.some((function(e){return"unconscious"===e.name}))})),onChange:function(){return e.props.toggleCondition(e.props.combatants,"unconscious")}},"unconscious"),r.a.createElement(F.a.CheckableTag,{checked:!this.props.combatants.every((function(e){return e.showOnMap})),onChange:function(){return e.props.toggleHidden(e.props.combatants)}},"hidden")),s)}},{key:"getHPSection",value:function(){var e=this;if(!this.props.combatants.every((function(e){return"monster"===e.type})))return null;var t=null;if(1===this.props.combatants.length){var a,n,s,i,o,c,l=this.props.combatants[0];t=r.a.createElement(Z,{text:"current hit points"},r.a.createElement(ne,{value:null!==(a=l.hpCurrent)&&void 0!==a?a:0,label:"hp",factors:[1,10],downEnabled:(null!==(n=l.hpCurrent)&&void 0!==n?n:0)>0,upEnabled:(null!==(s=l.hpCurrent)&&void 0!==s?s:0)<(null!==(i=l.hpMax)&&void 0!==i?i:0),onNudgeValue:function(t){return e.props.nudgeValue(l,"hpCurrent",t)}}),r.a.createElement(ne,{value:null!==(o=l.hpTemp)&&void 0!==o?o:0,label:"temp hp",factors:[1,10],downEnabled:(null!==(c=l.hpTemp)&&void 0!==c?c:0)>0,onNudgeValue:function(t){return e.props.nudgeValue(l,"hpTemp",t)}}))}var u=this.props.combatants.map((function(t){var a=t,n=null,s=null,i=null,o=null;return a.damage.resist&&(n=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"resistances")," ",a.damage.resist," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.damage.vulnerable&&(s=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"vulnerabilities")," ",a.damage.vulnerable," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.damage.immune&&(i=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"immunities")," ",a.damage.immune," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.tags.includes("conc")&&(o=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},a.displayName," is ",r.a.createElement("b",null,"concentrating"),", and will need to make a check if they take damage"))),n||s||i||o?r.a.createElement(Ne,{key:t.id},n,s,i,o):null})),m="apply damage";if(1===this.props.combatants.length){var p=this.state.damageMultipliers[this.props.combatants[0].id];.5===p&&(m="apply half damage"),2===p&&(m="apply double damage")}var f=[{id:"half",text:"half"},{id:"normal",text:"normal"},{id:"double",text:"double"}],v=this.props.combatants.map((function(t){var a,n="normal",s=null!==(a=e.state.damageMultipliers[t.id])&&void 0!==a?a:1;s<1&&(n="half"),s>1&&(n="double");var i=r.a.createElement(re,{options:f,selectedID:n,onSelect:function(a){var n=1;"half"===a&&(n=.5),"double"===a&&(n=2),e.setDamageMultiplier(t.id,n)}});return 1===e.props.combatants.length?r.a.createElement("div",{key:t.id},i):r.a.createElement(d.a,{key:t.id,align:"middle",justify:"center"},r.a.createElement(h.a,{span:8},r.a.createElement("div",null,t.displayName)),r.a.createElement(h.a,{span:16},i))})),g=null,b=this.props.combatants.filter((function(e){return null!=e.hpCurrent&&e.hpCurrent<=0}));if(b.length>0){var y=1===b.length&&b[0].current?"mark as defeated and end turn":"mark as defeated",E=null;this.props.combatants.length>1&&(E=r.a.createElement("ul",null,b.map((function(e){return r.a.createElement("li",{key:e.id},e.displayName)})))),g=r.a.createElement("button",{onClick:function(){return e.props.makeDefeated(b)}},y,E)}return r.a.createElement("div",null,u,r.a.createElement(ne,{value:this.state.damageValue,label:"damage",factors:[1,10],downEnabled:this.state.damageValue>0,onNudgeValue:function(t){return e.nudgeDamage(t)}}),r.a.createElement("button",{className:0===this.state.damageValue?"disabled":"",onClick:function(){return e.damage()}},m),v,g,r.a.createElement("hr",null),r.a.createElement(Z,{text:"healing"},r.a.createElement(ne,{value:this.state.healingValue,label:"healing",factors:[1,10],downEnabled:this.state.healingValue>0,onNudgeValue:function(t){return e.nudgeHealing(t)}}),r.a.createElement("button",{className:0===this.state.healingValue?"disabled":"",onClick:function(){return e.heal()}},"apply healing")),t)}},{key:"getConditionSection",value:function(){var e=this,t=this.props.combatants.map((function(t){if("monster"!==t.type)return null;var a=t;return a.conditionImmunities?r.a.createElement(Ne,{key:t.id},r.a.createElement("b",null,"immunities")," ",a.conditionImmunities," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null):null})),a=r.a.createElement(_a,{combatants:this.props.combatants,allCombatants:this.props.allCombatants,addCondition:function(){return e.props.addCondition(e.props.combatants)},editCondition:function(t,a){return e.props.editCondition(t,a)},removeCondition:function(t,a){return e.props.removeCondition(t,a)},nudgeConditionValue:function(t,a,n){return e.props.nudgeValue(t,a,n)}});return r.a.createElement("div",null,t,a)}},{key:"getMapSection",value:function(){var e=this;if(!this.props.map)return null;if(this.props.combatants.every((function(t){return e.props.map&&e.props.map.items.find((function(e){return e.id===t.id}))}))){var t=null,a=null;if(1===this.props.combatants.length){var n=this.props.combatants[0];t=r.a.createElement(ne,{value:n.altitude+" ft.",label:"altitude",onNudgeValue:function(t){return e.props.onChangeAltitude(n,n.altitude+5*t)}});var s=null;if(n.aura.radius>0){s=r.a.createElement("div",null,r.a.createElement(re,{options:[{id:"square",text:"square"},{id:"rounded",text:"rounded"},{id:"circle",text:"circle"}],selectedID:n.aura.style,onSelect:function(t){return e.props.changeValue(n.aura,"style",t)}}),r.a.createElement("input",{type:"color",value:n.aura.color,onChange:function(t){return e.props.changeValue(n.aura,"color",t.target.value)}}))}a=r.a.createElement(Z,{text:"aura"},r.a.createElement(ne,{value:n.aura.radius+" ft.",label:"size",downEnabled:n.aura.radius>0,onNudgeValue:function(t){return e.props.nudgeValue(n.aura,"radius",5*t)}}),s)}return r.a.createElement("div",null,r.a.createElement(rt,{onClick:function(t){return e.props.mapMove(e.props.combatants,t)}}),r.a.createElement("hr",null),t,a,r.a.createElement("button",{onClick:function(){return e.props.mapRemove(e.props.combatants)}},"remove from map"))}return 1===this.props.combatants.length?r.a.createElement("button",{key:"mapAdd",onClick:function(){return e.props.mapAdd(e.props.combatants[0])}},"add to map"):null}},{key:"getAdvancedSection",value:function(){var e=this,t=null;this.props.removeCombatants&&this.props.combatants.every((function(e){return!e.current}))&&(t=r.a.createElement(H,{text:"remove from encounter",onConfirm:function(){e.props.removeCombatants&&e.props.removeCombatants(e.props.combatants)}}));var a=null,n=null,s=null,i=null,o=null;if(1===this.props.combatants.length){var c,l=this.props.combatants[0];if(a=r.a.createElement(Z,{text:"change name"},r.a.createElement(J,{text:l.displayName,onChange:function(t){return e.props.changeValue(l,"displayName",t)}})),n=r.a.createElement(Z,{text:"change size"},r.a.createElement(ne,{value:l.displaySize,label:"size",downEnabled:"tiny"!==l.displaySize,upEnabled:"gargantuan"!==l.displaySize,onNudgeValue:function(t){return e.props.nudgeValue(l,"displaySize",t)}})),!l.pending)s=r.a.createElement(Z,{text:"change initiative score"},r.a.createElement(ne,{value:null!==(c=l.initiative)&&void 0!==c?c:0,label:"initiative",onNudgeValue:function(t){return e.props.nudgeValue(l,"initiative",t)}}));if(i=r.a.createElement(Z,{text:"change faction"},r.a.createElement(re,{options:["foe","neutral","ally"].map((function(e){return{id:e,text:e}})),selectedID:l.faction,onSelect:function(t){return e.props.changeValue(l,"faction",t)}})),!this.props.allCombatants.find((function(e){return e.mountID===l.id}))){var u=this.props.allCombatants.filter((function(e){return e.id!==l.id})).filter((function(e){return!!e.mountID})).map((function(e){return e.mountID})),m=this.props.allCombatants.filter((function(e){return e.id!==l.id})).filter((function(e){return"placeholder"!==e.type})).filter((function(e){return!e.mountID})).filter((function(e){return!u.includes(e.id)})).map((function(e){return{id:e.id,text:e.displayName}}));b.sort(m,[{field:"text",dir:"asc"}]);var p=null;p=m.length>0?r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mounted on:"),r.a.createElement(Y,{options:m,selectedID:l.mountID,onSelect:function(t){return e.props.changeValue(l,"mountID",t)},onClear:function(){return e.props.changeValue(l,"mountID",null)}})):r.a.createElement(Ne,null,"no mounts available");var d=null;if(l.mountID){var h=["controlled","independent"].map((function(e){return{id:e,text:e}}));d=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mount is:"),r.a.createElement(re,{options:h,selectedID:l.mountType,onSelect:function(t){return e.props.changeValue(l,"mountType",t)}}))}o=r.a.createElement(Z,{text:"mounted combat"},p,d)}}var f=[];this.props.combatants.filter((function(e){return"pc"===e.type})).forEach((function(t){t.companions.filter((function(t){return!e.props.allCombatants.find((function(e){return e.id===t.id}))})).forEach((function(t){f.push(r.a.createElement("button",{key:t.id,onClick:function(){return e.props.addCompanion(t)}},"add ",t.name))}))}));var v=null;if(1===this.props.combatants.length){var g=this.props.combatants[0];v=r.a.createElement(J,{text:g.note,placeholder:"notes",multiLine:!0,onChange:function(t){return e.props.changeValue(g,"note",t)}})}return r.a.createElement("div",null,t,a,n,s,i,o,f,v)}},{key:"render",value:function(){var e=this;try{var t=["main","hp","cond","map","adv"].map((function(e){return{id:e,text:e}})),a=this.props.allCombatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""}));this.props.map&&!this.props.combatants.some((function(e){return a.includes(e.id)}))||t.splice(3,1),this.props.combatants.every((function(e){return"monster"===e.type}))||t.splice(1,1);var n=this.state.view;t.find((function(e){return e.id===n}))||(n=t[0].id);var s=null;switch(n){case"main":s=this.getMainSection();break;case"hp":s=this.getHPSection();break;case"cond":s=this.getConditionSection();break;case"map":s=this.getMapSection();break;case"adv":s=this.getAdvancedSection()}return r.a.createElement("div",null,r.a.createElement(ht,{options:t,selectedID:n,onSelect:function(t){return e.setView(t)}}),s)}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ua=a(250),Xa=new de.a.Converter;Xa.setOption("tables",!0);var Ka=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getInformationTag",value:function(){return this.props.combatant.current?r.a.createElement(F.a,{className:"info"},"current turn"):this.props.selected?r.a.createElement(F.a,{className:"info"},"selected"):null}},{key:"onClick",value:function(e){e.stopPropagation(),this.props.select&&this.props.select(this.props.combatant,e.ctrlKey)}},{key:"getContent",value:function(){var e=this,t=[];if("monster"===this.props.combatant.type&&!this.props.minimal){var a,n,s=this.props.combatant,i=(null!==(a=this.props.combatant.hpCurrent)&&void 0!==a?a:0).toString();(null!==(n=this.props.combatant.hpTemp)&&void 0!==n?n:0)>0&&(i+="+"+this.props.combatant.hpTemp),t.push(r.a.createElement("div",{key:"stats"},r.a.createElement(d.a,{align:"middle"},r.a.createElement(h.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-label"},"ac"),r.a.createElement("div",{className:"statistic-value"},s.ac))),r.a.createElement(h.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-value"},i),r.a.createElement("div",{className:"statistic-label"},"hp")))),r.a.createElement(he,{combatant:this.props.combatant})))}if(this.props.combatant.mountID){var o=this.props.combat.combatants.find((function(t){return t.id===e.props.combatant.mountID}));if(o){var c=r.a.createElement("button",{className:"link",onClick:function(t){t.stopPropagation(),e.props.select(o,!1)}},o.displayName),l=null;"controlled"===this.props.combatant.mountType&&(l=r.a.createElement("div",{className:"note-details"},"your mount moves as directed; it can only take dash, disengage, or dodge actions")),t.push(r.a.createElement(Ne,{key:"mount"},r.a.createElement("div",null," mounted on: ",c),l,r.a.createElement("div",{className:"note-details"},"if you\u2019re knocked prone, or an effect moves your mount against its will, you must succeed on a dex save (dc 10) or land prone in a space within 5 feet of your mount"),r.a.createElement("div",{className:"note-details"},"if your mount is knocked prone, you can use your reaction to land on your feet; otherwise, you fall prone in a space within 5 feet of your mount")))}}var u=this.props.combat.combatants.find((function(t){return t.mountID===e.props.combatant.id}));if(u){var m=r.a.createElement("button",{className:"link",onClick:function(t){t.stopPropagation(),e.props.select(u,!1)}},u.displayName);t.push(r.a.createElement(Ne,{key:"rider"},r.a.createElement("div",null,"ridden by: ",m)))}var p=[];return this.props.combatant.tags.filter((function(e){return e.startsWith("engaged")})).forEach((function(e){p.push(k.getTagDescription(e))})),p.length>0&&t.push(r.a.createElement(Ne,{key:"engaged"},r.a.createElement("div",null,"engaged with: ",p.join(", ")))),this.props.combatant.tags.filter((function(e){return!e.startsWith("engaged")})).forEach((function(e){t.push(r.a.createElement(Ne,{key:e},r.a.createElement("div",{className:"note-heading"},k.getTagTitle(e)),r.a.createElement("div",{className:"note-details"},k.getTagDescription(e))))})),this.props.combat.map&&!this.props.combat.map.items.find((function(t){return t.id===e.props.combatant.id}))&&t.push(r.a.createElement(Ne,{key:"not-on-map"},r.a.createElement("span",null,"not on the map"),r.a.createElement(Ua.a,{className:"icon-button",onClick:function(){return e.props.addToMap(e.props.combatant)}}))),this.props.combatant.showOnMap||t.push(r.a.createElement(Ne,{key:"hidden"},"hidden")),this.props.combatant.conditions&&this.props.combatant.conditions.forEach((function(a){var n=a.name;"exhaustion"===a.name&&(n+=" ("+a.level+")"),a.duration&&(n+=" "+k.conditionDurationText(a,e.props.combat.combatants));for(var s=[],i=k.conditionText(a),o=0;o!==i.length;++o)s.push(r.a.createElement("div",{key:o,className:"note-details"},i[o]));t.push(r.a.createElement(Ne,{key:a.id},r.a.createElement("div",{className:"note-heading"},n),s))})),this.props.combatant.note&&t.push(r.a.createElement(Ne,{key:"text"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Xa.makeHtml(this.props.combatant.note)}}))),t}},{key:"render",value:function(){var e=this;try{var t="initiative-list-item clickable "+this.props.combatant.type;this.props.combatant.current&&(t+=" current"),this.props.selected&&(t+=" highlight"),this.props.combatant.defeated&&(t+=" defeated");var a=null,n=this.props.combatant;return n.portrait&&(a=r.a.createElement($,{source:n,inline:!0})),r.a.createElement("div",{className:t,onClick:function(t){return e.onClick(t)}},r.a.createElement("div",{className:"header"},a,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant"),this.getInformationTag()),r.a.createElement("div",{className:"init-entry-content"},this.getContent()))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Za=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"makeActive",value:function(e){e.stopPropagation(),this.props.makeActive(this.props.combatant)}},{key:"render",value:function(){var e=this;try{var t,a=null,n=this.props.combatant;return n.portrait&&(a=r.a.createElement($,{source:n,inline:!0})),r.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},r.a.createElement("div",{className:"header"},a,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),r.a.createElement("div",{className:"init-entry-content"},r.a.createElement(ne,{value:null!==(t=this.props.combatant.initiative)&&void 0!==t?t:10,onNudgeValue:function(t){return e.props.nudgeValue(e.props.combatant,"initiative",t)}}),r.a.createElement("button",{onClick:function(t){return e.makeActive(t)}},"add to encounter")))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Qa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null,a=this.props.combatant;return a.portrait&&(t=r.a.createElement($,{source:a,inline:!0})),r.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},r.a.createElement("div",{className:"header"},t,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),r.a.createElement("div",{className:"init-entry-content"},r.a.createElement("button",{onClick:function(){return e.props.addToMap()}},"place on map")))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),$a=new de.a.Converter;$a.setOption("tables",!0);var en=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={showOptions:!1,showDefeatedCombatants:!1,showRollButtons:!1,selectedItemIDs:[],selectedAreaID:null,addingToMapID:null,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null,playerView:{open:!1,showControls:!1},middleColumnWidth:8},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("beforeunload",(function(){e.setPlayerViewOpen(!1)}))}},{key:"toggleShowOptions",value:function(){this.setState({showOptions:!this.state.showOptions})}},{key:"toggleShowDefeatedCombatants",value:function(){this.setState({showDefeatedCombatants:!this.state.showDefeatedCombatants})}},{key:"toggleShowRollButtons",value:function(){this.setState({showRollButtons:!this.state.showRollButtons})}},{key:"setSelectedItemIDs",value:function(e){this.setState({selectedItemIDs:e})}},{key:"toggleItemSelection",value:function(e,t){if(e&&t){var a=this.state.selectedItemIDs;if(a.includes(e)){var n=a.indexOf(e);a.splice(n,1)}else a.push(e);this.setSelectedItemIDs(a)}else this.setSelectedItemIDs(e?[e]:[])}},{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"setAddingToMapID",value:function(e){this.setState({addingToMapID:e,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleAddingOverlay",value:function(){this.setState({addingOverlay:!this.state.addingOverlay,addingToMapID:null,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleEditFog",value:function(){this.setState({addingOverlay:!1,addingToMapID:null,editFog:!this.state.editFog,highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleHighlightMapSquare",value:function(){this.setState({addingOverlay:!1,addingToMapID:null,editFog:!1,highlightMapSquare:!this.state.highlightMapSquare,highlightedSquare:null})}},{key:"setHighlightedSquare",value:function(e,t){this.state.highlightMapSquare&&this.setState({highlightedSquare:{x:e,y:t}})}},{key:"fillFog",value:function(){if(this.props.combat.map){var e=[],t=T.mapDimensions(this.props.combat.map.items);if(t){for(var a=t.minX;a<=t.maxX;++a)for(var n=t.minY;n<=t.maxY;++n)e.push({x:a,y:n});this.props.setFog(e)}}}},{key:"clearFog",value:function(){this.props.setFog([])}},{key:"setPlayerViewOpen",value:function(e){var t=this.state.playerView;t.open=e,this.setState({playerView:t})}},{key:"setPlayerViewShowControls",value:function(e){var t=this.state.playerView;t.showControls=e,this.setState({playerView:t})}},{key:"nudgeMiddleColumnWidth",value:function(e){this.setState({middleColumnWidth:this.state.middleColumnWidth+e})}},{key:"nextTurn",value:function(){var e=this,t=this.props.combat.combatants.find((function(e){return e.current}));if(t)this.props.endTurn(t);else{var a=this.props.combat.combatants.filter((function(t){return"placeholder"!==t.type||P.combatHasLairActions(e.props.combat)})).find((function(e){return e.active}));a&&this.props.makeCurrent(a)}}},{key:"defeatCombatants",value:function(e){var t=this,a=e.map((function(e){return e.id}));this.setState({selectedItemIDs:this.state.selectedItemIDs.filter((function(e){return!a.includes(e)}))},(function(){t.props.makeDefeated(e)}))}},{key:"removeCombatants",value:function(e){var t=this,a=e.map((function(e){return e.id}));this.setState({selectedItemIDs:this.state.selectedItemIDs.filter((function(e){return!a.includes(e)}))},(function(){t.props.removeCombatants(e)}))}},{key:"gridSquareClicked",value:function(e,t){var a=this;if(this.state.addingToMapID){var n=this.props.combat.combatants.find((function(e){return e.id===a.state.addingToMapID}));n&&this.props.mapAdd(n,e,t),this.setAddingToMapID(null)}if(this.state.addingOverlay){var r=y.createMapItem();r.type="overlay",r.x=e,r.y=t,r.width=1,r.height=1,r.color="#005080",r.opacity=127,r.style="square",this.props.addOverlay(r),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[r.id]})}this.state.editFog&&this.toggleFog(e,t,e,t)}},{key:"toggleFog",value:function(e,t,a,n){if(this.state.editFog){for(var r=this.props.combat.fog,s=function(e){for(var a=function(t){var a=r.findIndex((function(a){return a.x===e&&a.y===t}));-1===a?r.push({x:e,y:t}):r.splice(a,1)},s=t;s<=n;++s)a(s)},i=e;i<=a;++i)s(i);this.props.setFog(r)}}},{key:"orderCombatants",value:function(e){var t=e.find((function(e){return e.current}));if(t){var a=e.indexOf(t);if(0!==a){var n=Object(E.a)(e);return n.splice(a).concat(["top of the round"]).concat(n)}}return e}},{key:"getMapViewport",value:function(){var e=this;if(this.props.combat.map&&this.state.selectedAreaID){var t=this.props.combat.map.areas.find((function(t){return t.id===e.state.selectedAreaID}));if(t)return{minX:t.x,minY:t.y,maxX:t.x+t.width-1,maxY:t.y+t.height-1}}return null}},{key:"getPlayerView",value:function(){var e=this;if(!this.state.playerView.open)return null;var t=this.props.combat.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),a=this.props.combat.combatants.filter((function(e){return"pc"===e.type||e.showOnMap})).filter((function(e){return!e.pending&&e.active&&!e.defeated})).filter((function(e){return!t.includes(e.id)})).filter((function(t){return"monster"!==t.type||!e.props.combat.map||!!e.props.combat.map.items.find((function(e){return e.id===t.id}))})).filter((function(t){return"placeholder"!==t.type||P.combatHasLairActions(e.props.combat)})),n=this.orderCombatants(a).map((function(t){return e.createCombatantRow(t,!0)}));if(this.props.combat.map){var s=null;if(this.props.combat.map&&this.state.playerView.showControls){var i=this.props.combat.combatants.filter((function(t){return null!==e.props.combat.map&&e.props.combat.map.items.find((function(e){return e.id===t.id}))})).filter((function(e){return e.showOnMap})).filter((function(t){return e.state.selectedItemIDs.includes(t.id)}));if(0===i.length&&(i=this.props.combat.combatants.filter((function(t){return null!==e.props.combat.map&&e.props.combat.map.items.find((function(e){return e.id===t.id}))})).filter((function(e){return e.showOnMap})).filter((function(e){return e.current}))),1===i.length){var o=i[0];s=r.a.createElement("div",null,r.a.createElement("div",{className:"heading lowercase"},o.displayName),r.a.createElement(rt,{onClick:function(t){return e.props.mapMove([o.id],t)}}),r.a.createElement("hr",null),r.a.createElement(ne,{key:"altitude",value:o.altitude+" ft.",label:"altitude",onNudgeValue:function(t){return e.props.nudgeValue(o,"altitude",5*t)}}),r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:8},r.a.createElement(A,{label:"conc.",display:"button",checked:o.tags.includes("conc"),onChecked:function(t){return e.props.toggleTag([o],"conc")}})),r.a.createElement(h.a,{span:8},r.a.createElement(A,{label:"bane",display:"button",checked:o.tags.includes("bane"),onChecked:function(t){return e.props.toggleTag([o],"bane")}})),r.a.createElement(h.a,{span:8},r.a.createElement(A,{label:"bless",display:"button",checked:o.tags.includes("bless"),onChecked:function(t){return e.props.toggleTag([o],"bless")}}))),r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:8},r.a.createElement(A,{label:"prone",display:"button",checked:o.conditions.some((function(e){return"prone"===e.name})),onChecked:function(t){return e.props.toggleCondition([o],"prone")}})),r.a.createElement(h.a,{span:8},r.a.createElement(A,{label:"uncon.",display:"button",checked:o.conditions.some((function(e){return"unconscious"===e.name})),onChecked:function(t){return e.props.toggleCondition([o],"unconscious")}})),r.a.createElement(h.a,{span:8},r.a.createElement(A,{label:"hidden",display:"button",checked:!o.showOnMap,onChecked:function(t){return e.props.changeValue([o],"showOnMap",!t)}}))))}i.length>1&&(s=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"multiple items selected")))}return r.a.createElement(ja,{title:"Encounter",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement(d.a,{className:"full-height full-width"},r.a.createElement(h.a,{xs:24,sm:24,md:12,lg:16,xl:18,className:"scrollable both-ways"},r.a.createElement(ve,{key:"map",map:this.props.combat.map,mode:"combat-player",viewport:this.getMapViewport(),combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,focussedSquare:this.state.highlightedSquare,itemSelected:function(t,a){return e.toggleItemSelection(t,a)}})),r.a.createElement(h.a,{xs:24,sm:24,md:12,lg:8,xl:6,className:"scrollable"},s,r.a.createElement("div",{className:"heading fixed-top"},"initiative order"),n)))}return r.a.createElement(ja,{title:"Encounter",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("div",{className:"scrollable full-width"},r.a.createElement("div",{className:"heading"},"initiative order"),n))}},{key:"getOptions",value:function(){var e=this;if(!this.state.showOptions)return null;var t=null;this.props.combat.encounter.notes&&(t=r.a.createElement(Z,{text:"encounter notes"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:$a.makeHtml(this.props.combat.encounter.notes)}})));var a=null;this.props.combat.map&&(a=r.a.createElement(H,{text:"end combat and continue exploration",onConfirm:function(){return e.props.endCombat(e.props.combat,!0)}}));var n=[];this.props.combat.combatants.filter((function(e){return"pc"===e.type})).forEach((function(t){var a=e.props.parties.find((function(e){return e.pcs.find((function(e){return e.id===t.id}))}));a&&!n.includes(a)&&n.push(a)}));var s=[];n.forEach((function(t){t.pcs.forEach((function(a){e.props.combat.combatants.find((function(e){return e.id===a.id}))||s.push(r.a.createElement("button",{key:a.id,onClick:function(){return e.props.addPC(t.id,a.id)}},a.name," (",t.name,")"))}))}));var i=null;s.length>0&&(i=r.a.createElement(Z,{text:"add pcs"},s));var o=null;this.props.combat.encounter&&this.props.combat.encounter.waves.length>0&&(o=r.a.createElement("button",{onClick:function(){return e.props.addWave()}},"add wave"));var c=null;this.props.combat.map&&this.state.playerView.open&&(c=r.a.createElement("div",null,r.a.createElement(A,{label:"show map controls",checked:this.state.playerView.showControls,onChecked:function(t){return e.setPlayerViewShowControls(t)}})));var l=null;if(this.props.combat.map){var u=null;this.props.combat.combatants.some((function(e){return"pc"===e.type}))&&(u=r.a.createElement("button",{onClick:function(){return e.props.scatterCombatants("pc",e.state.selectedAreaID)}},"scatter pcs"));var m=null;this.props.combat.combatants.some((function(e){return"monster"===e.type}))&&(m=r.a.createElement("button",{onClick:function(){return e.props.scatterCombatants("monster",e.state.selectedAreaID)}},"scatter monsters")),l=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"map"),u,m,r.a.createElement(A,{label:this.state.addingOverlay?"click on the map to add the item, or click here to cancel":"add token / overlay",display:"button",checked:this.state.addingOverlay,onChecked:function(){return e.toggleAddingOverlay()}}),r.a.createElement(A,{label:"highlight map square",checked:this.state.highlightMapSquare,onChecked:function(){return e.toggleHighlightMapSquare()}}),r.a.createElement(A,{label:"edit fog of war",checked:this.state.editFog,onChecked:function(){return e.toggleEditFog()}}),r.a.createElement("div",{style:{display:this.state.editFog?"":"none"}},r.a.createElement("button",{onClick:function(){return e.fillFog()}},"fill fog of war"),r.a.createElement("button",{className:0===this.props.combat.fog.length?"disabled":"",onClick:function(){return e.clearFog()}},"clear fog of war")))}return r.a.createElement(Fe,{heading:"options",content:[r.a.createElement("div",{key:"options"},r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"encounter"),t,r.a.createElement("button",{onClick:function(){return e.props.pauseCombat()}},"pause combat"),r.a.createElement(H,{text:"end combat",onConfirm:function(){return e.props.endCombat(e.props.combat,!1)}}),a),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"combatants"),r.a.createElement("button",{onClick:function(){return e.props.addCombatants()}},"add combatants"),i,o,r.a.createElement("button",{onClick:function(){return e.props.addCompanion(null)}},"add a companion")),l,r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"player view"),r.a.createElement(A,{label:"show player view",checked:this.state.playerView.open,onChecked:function(t){return e.setPlayerViewOpen(t)}}),c),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"layout"),r.a.createElement(A,{label:"show defeated combatants",checked:this.state.showDefeatedCombatants,onChecked:function(){return e.toggleShowDefeatedCombatants()}}),r.a.createElement(A,{label:"show monster die rolls",checked:this.state.showRollButtons,onChecked:function(){return e.toggleShowRollButtons()}}),r.a.createElement(ne,{value:"middle column size",downEnabled:this.state.middleColumnWidth>4,upEnabled:this.state.middleColumnWidth<14,onNudgeValue:function(t){return e.nudgeMiddleColumnWidth(2*t)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"tools"),r.a.createElement("button",{onClick:function(){return e.props.showLeaderboard()}},"show leaderboard")))],columns:1})}},{key:"getSelectedCombatant",value:function(){var e=this,t=this.state.selectedItemIDs.map((function(t){return e.props.combat.combatants.find((function(e){return e.id===t}))})).filter((function(e){return!!e}));b.sort(t,[{field:"displayName",dir:"asc"}]);var a=t.filter((function(e){return"placeholder"===e.type}));if(a.length>0)return r.a.createElement("div",null,this.createCard(a[0]));if(t.length>0&&t.every((function(e){return e.current})))return r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"you've selected the current initiative holder"));if(1===t.length)return r.a.createElement("div",null,this.createControls(t),r.a.createElement("hr",null),this.createCard(t[0]));if(t.length>1)return r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"multiple combatants are selected:"),t.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},t.displayName,r.a.createElement(R.a,{style:{float:"right",padding:"2px 0",fontSize:"14px"},onClick:function(){return e.toggleItemSelection(t.id,!0)}}))}))),this.createControls(t));if(this.props.combat.map){var n=this.props.combat.map.items.find((function(t){return t.id===e.state.selectedItemIDs[0]}));if(n)return r.a.createElement(Ga,{item:n,move:function(t,a){return e.props.mapMove([t.id],a)},remove:function(t){return e.props.mapRemove([t.id])},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.props.nudgeValue(t,a,n)}})}return r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"select a pc or monster from the ",r.a.createElement("b",null,"initiative order")," list (in the middle column) to see its details here"))}},{key:"createCombatantRow",value:function(e,t){var a=this;if("string"===typeof e)return r.a.createElement("div",{key:e,className:"section init-separator"},e);var n=this.state.selectedItemIDs.includes(e.id);return t&&!this.props.combat.map&&(n=!1),r.a.createElement(Ka,{key:e.id,combatant:e,combat:this.props.combat,selected:n,minimal:t,select:function(e,t){return a.toggleItemSelection(e.id,t)},addToMap:function(e){return a.setAddingToMapID(a.state.addingToMapID?null:e.id)},nudgeValue:function(e,t,n){return a.props.nudgeValue(e,t,n)},makeActive:function(e){return a.props.makeActive([e])}})}},{key:"createControls",value:function(e){var t=this;return e.some((function(e){return"placeholder"===e.type}))?null:r.a.createElement(Ya,{combatants:e,allCombatants:this.props.combat.combatants,map:this.props.combat.map,defaultTab:"main",makeCurrent:function(e){return t.props.makeCurrent(e)},makeActive:function(e){return t.props.makeActive(e)},makeDefeated:function(e){return t.defeatCombatants(e)},toggleTag:function(e,a){return t.props.toggleTag(e,a)},toggleCondition:function(e,a){return t.props.toggleCondition(e,a)},toggleHidden:function(e){return t.props.toggleHidden(e)},changeHP:function(e){return t.props.changeHP(e)},addCondition:function(e){return t.props.addCondition(e)},editCondition:function(e,a){return t.props.editCondition(e,a)},removeCondition:function(e,a){return t.props.removeCondition(e,a)},mapAdd:function(e){return t.setAddingToMapID(t.state.addingToMapID?null:e.id)},mapMove:function(e,a){return t.props.mapMove(e.map((function(e){return e.id})),a)},mapRemove:function(e){return t.props.mapRemove(e.map((function(e){return e.id})))},onChangeAltitude:function(e,a){return t.props.onChangeAltitude(e,a)},removeCombatants:function(e){return t.removeCombatants(e)},addCompanion:function(e){return t.props.addCompanion(e)},changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeValue:function(e,a,n){return t.props.nudgeValue(e,a,n)}})}},{key:"createCard",value:function(e){var t=this;switch(e.type){case"pc":return r.a.createElement(Xe,{pc:e});case"monster":return r.a.createElement(Ue,{monster:e,combat:!0,showRollButtons:this.state.showRollButtons,useTrait:function(a){return t.props.useTrait(e,a)},rechargeTrait:function(a){return t.props.rechargeTrait(e,a)},onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}});case"companion":var a=null,n=e;return n.monsterID&&this.props.library.forEach((function(e){var s=e.monsters.find((function(e){return e.id===n.monsterID}));s&&(a=r.a.createElement(Ue,{monster:s,showRollButtons:t.state.showRollButtons,onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}}))})),a;case"placeholder":var s=[];return this.props.combat.combatants.forEach((function(e){var a=e;a&&a.traits&&a.traits.some((function(e){return"lair"===e.type}))&&s.push(r.a.createElement("div",{className:"card monster",key:"lair "+a.id},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},a.name)),r.a.createElement("div",{className:"card-content"},r.a.createElement(Je,{combatant:a,mode:"lair",useTrait:function(e){return t.props.useTrait(a,e)},rechargeTrait:function(e){return t.props.rechargeTrait(a,e)}}))))})),s}return null}},{key:"render",value:function(){var e=this;try{var t=this.props.combat.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),a=null,n=[],s=[];this.props.combat.combatants.filter((function(e){return!t.includes(e.id)})).forEach((function(t){t.pending?n.push(r.a.createElement(Za,{key:t.id,combatant:t,nudgeValue:function(t,a,n){return e.props.nudgeValue(t,a,n)},makeActive:function(t){return e.props.makeActive([t])}})):(t.current&&(a=r.a.createElement("div",null,e.createControls([t]),e.createCard(t))),(t.active||t.defeated&&e.state.showDefeatedCombatants)&&s.push(t))})),0!==n.length&&n.unshift(r.a.createElement(Ne,{key:"pending-help"},r.a.createElement("div",{className:"section"},"these combatants are not yet part of the encounter"),r.a.createElement("div",{className:"section"},"set initiative on each of them, then add them to the encounter")));var i=s.filter((function(t){return"placeholder"!==t.type||P.combatHasLairActions(e.props.combat)})),o=this.orderCombatants(i).map((function(t){return e.createCombatantRow(t,!1)})),c=null;if(!a&&this.props.combat.map){var l=i.filter((function(t){return e.props.combat.map&&!e.props.combat.map.items.find((function(e){return e.id===t.id}))})).map((function(t){return r.a.createElement(Qa,{key:t.id,combatant:t,addToMap:function(){return e.setAddingToMapID(t.id)}})}));l.length>0&&(c=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"these combatants have not yet been placed on the map (which you'll find in the middle column)"),r.a.createElement("div",{className:"section"},"to place one on the map, click the ",r.a.createElement("b",null,"place on map")," button and then click on a map square")),l))}a||(o.unshift(r.a.createElement(Ne,{key:"init-help"},r.a.createElement("div",{className:"section"},"these are the combatants taking part in this encounter; you can select them to see their stat blocks (on the right)"),r.a.createElement("div",{className:"section"},"they are listed in initiative order (with the highest initiative score at the top of the list, and the lowest at the bottom)"))),a=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"when you're ready to begin the encounter, press the ",r.a.createElement("b",null,"start combat")," button (above)"),r.a.createElement("div",{className:"section"},"the current initiative holder will be displayed here")));var u=null;this.props.combat.notifications.length>0&&(u=r.a.createElement("div",{className:"notifications"},this.props.combat.notifications.map((function(t){return r.a.createElement(tn,{key:t.id,notification:t,close:function(t,a){return e.props.closeNotification(t,a)}})}))));var m=null;this.props.combat.map&&(m=r.a.createElement("div",{key:"map",className:"scrollable both-ways"},r.a.createElement(ve,{map:this.props.combat.map,mode:"combat",viewport:this.getMapViewport(),showGrid:null!==this.state.addingToMapID||this.state.addingOverlay||this.state.editFog||this.state.highlightMapSquare,combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,focussedSquare:this.state.highlightedSquare,itemSelected:function(t,a){return e.toggleItemSelection(t,a)},areaSelected:function(t){return e.setSelectedAreaID(t)},gridSquareEntered:function(t,a){return e.setHighlightedSquare(t,a)},gridSquareClicked:function(t,a){return e.gridSquareClicked(t,a)},gridRectangleSelected:function(t,a,n,r){return e.toggleFog(t,a,n,r)}})));var p=[];this.props.combat.combatants.filter((function(e){return!e.pending&&e.active&&!e.defeated})).forEach((function(t){var a=t;a&&a.traits&&a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&!a.current&&p.push(r.a.createElement("div",{className:"card monster",key:"leg "+a.id},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},a.name)),r.a.createElement("div",{className:"card-content"},r.a.createElement(Je,{combatant:a,mode:"legendary",useTrait:function(t){return e.props.useTrait(a,t)},rechargeTrait:function(t){return e.props.rechargeTrait(a,t)}}))))}));var f=this.state.middleColumnWidth,v=(24-f)/2;return r.a.createElement("div",{className:"full-height"},r.a.createElement(d.a,{align:"middle",className:"combat-top-row"},r.a.createElement(h.a,{span:v},r.a.createElement("div",{className:"action"},r.a.createElement("button",{onClick:function(){return e.nextTurn()}},this.props.combat.combatants.find((function(e){return e.current}))?"next turn":"start combat"))),r.a.createElement(h.a,{span:f},r.a.createElement(d.a,null,r.a.createElement(h.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-label"},"round"),r.a.createElement("div",{className:"statistic-value"},this.props.combat.round))),r.a.createElement(h.a,{span:12},r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-value"},P.getCombatXP(this.props.combat)),r.a.createElement("div",{className:"statistic-label"},"xp"))))),r.a.createElement(h.a,{span:v},r.a.createElement("div",{className:"menu"},this.state.showOptions?r.a.createElement(R.a,{title:"close options",onClick:function(){return e.toggleShowOptions()}}):r.a.createElement(Ba.a,{title:"options",onClick:function(){return e.toggleShowOptions()}})))),r.a.createElement(d.a,{className:"combat-main"},r.a.createElement(h.a,{span:v,className:"scrollable"},r.a.createElement(Fe,{heading:"initiative holder",content:[a],columns:1,showToggle:!1})),r.a.createElement(h.a,{span:f,className:"scrollable"},u,r.a.createElement(Fe,{heading:"waiting for intiative",content:n,columns:1,showToggle:!0}),r.a.createElement(Fe,{heading:"legendary actions",content:p,columns:1,showToggle:!0}),r.a.createElement(Fe,{heading:"encounter map",content:[m],columns:1,showToggle:!0}),r.a.createElement(Fe,{heading:"initiative order",content:o,columns:1,showToggle:!0})),r.a.createElement(h.a,{span:v,className:"scrollable"},this.getOptions(),r.a.createElement(Fe,{heading:"not on the map",content:[c],columns:1,showToggle:!0}),r.a.createElement(Fe,{heading:"selected combatant",content:[this.getSelectedCombatant()],columns:1}))),this.getPlayerView())}catch(g){return console.error(g),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),tn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"success",value:function(){switch(this.props.notification.type){case"condition-save":case"condition-end":var e=this.props.notification.data;e.duration&&("saves"!==e.duration.type&&"rounds"!==e.duration.type||(e.duration.count-=1,0===e.duration.count?this.close(!0):this.close()));break;case"trait-recharge":this.props.notification.data.uses=0,this.close()}}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.close(this.props.notification,e)}},{key:"render",value:function(){var e=this;try{var t=this.props.notification.combatant,a=this.props.notification.data,n=this.props.notification.data,s=t.displayName||t.name||"unnamed monster";switch(this.props.notification.type){case"condition-save":var i=a.duration,o=i.saveType.toString();return"death"!==o&&(o=o.toUpperCase()),r.a.createElement(Ne,{key:this.props.notification.id},r.a.createElement("div",{className:"section"},s," must make a ",o," save against dc ",i.saveDC),r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:12},r.a.createElement("button",{key:"success",onClick:function(){return e.success()}},"success")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{key:"close",onClick:function(){return e.close()}},"close"))));case"condition-end":return r.a.createElement(Ne,{key:this.props.notification.id},r.a.createElement("div",{className:"section"},s," is no longer affected by condition ",a.name),r.a.createElement("button",{onClick:function(){return e.close()}},"close"));case"trait-recharge":return r.a.createElement(Ne,{key:this.props.notification.id},r.a.createElement("div",{className:"section"},s," can attempt to recharge ",n.name," (",n.usage,")"),r.a.createElement(d.a,{gutter:10},r.a.createElement(h.a,{span:12},r.a.createElement("button",{key:"recharge",onClick:function(){return e.success()}},"recharge")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{key:"close",onClick:function(){return e.close()}},"close"))));default:return null}}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),an=a(251),nn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getValue",value:function(e){var t,a,n;switch(e.type){case"pc":return r.a.createElement("div",{className:"value"},"pc");case"monster":var s=null!==(t=e.hpCurrent)&&void 0!==t?t:0,i=null!==(a=e.hpMax)&&void 0!==a?a:0,o=null!==(n=e.hpTemp)&&void 0!==n?n:0,c=s.toString();return o>0&&(c+="+"+o),s<i&&(c+=" / "+i),r.a.createElement("div",{className:"value"},c," hp")}return null}},{key:"render",value:function(){var e=this;try{var t=null;this.props.combat.map&&(t=r.a.createElement("div",{className:"section"},r.a.createElement(ve,{map:this.props.combat.map,fog:this.props.combat.fog,combatants:this.props.combat.combatants})));var a=this.props.combat.combatants.filter((function(e){return e.active})).filter((function(e){return"placeholder"!==e.type})).map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)}},r.a.createElement($,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},t.displayName),e.getValue(t))}));return r.a.createElement("div",{className:"card encounter"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.combat.name||"unnamed combat")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement("div",{className:"section"},"paused at round ",this.props.combat.round),t,r.a.createElement("div",{className:"subheading"},"initiative order"),a),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.resume(e.props.combat)}},"resume combat"),r.a.createElement(H,{text:"delete combat",onConfirm:function(){return e.props.delete(e.props.combat)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),rn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={cloneName:e.encounter.name+" copy"},n}return Object(c.a)(a,[{key:"setCloneName",value:function(e){this.setState({cloneName:e})}},{key:"getText",value:function(e){var t=e.monsterName||e.roles.join(", ")||"unnamed monster";return r.a.createElement("div",{className:"name"},t)}},{key:"getValue",value:function(e){var t="";return e.count>1&&(t&&(t+=" "),t+="x"+e.count),"foe"!==e.faction&&(t&&(t+=" "),t+="("+e.faction+")"),t?r.a.createElement("div",{className:"value"},t):null}},{key:"getPortrait",value:function(e){var t=this.props.getMonster(e.monsterID);return t&&t.portrait?r.a.createElement($,{source:t,inline:!0}):null}},{key:"render",value:function(){var e=this;try{var t=this.props.encounter.slots.map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)}},e.getPortrait(t),e.getText(t),e.getValue(t))}));0===t.length&&t.push(r.a.createElement("div",{key:"empty",className:"section"},"no monsters")),this.props.encounter.waves.forEach((function(a){t.push(r.a.createElement("div",{key:"name "+a.id,className:"section subheading"},a.name||"unnamed wave")),a.slots.forEach((function(a){t.push(r.a.createElement("div",{key:a.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(a)}},e.getPortrait(a),e.getText(a),e.getValue(a)))})),0===t.length&&t.push(r.a.createElement("div",{key:"empty "+a.id,className:"section"},"no monsters"))}));var a=null;if(this.props.parties.length>0){var n=this.props.parties.map((function(e){return{id:e.id,text:e.name}}));a=r.a.createElement(Y,{options:n,placeholder:"start combat with...",onSelect:function(t){return e.props.run(e.props.encounter,t)}})}return r.a.createElement("div",{className:"card encounter"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.encounter.name||"unnamed encounter")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement("div",{className:"subheading"},"monsters"),t,r.a.createElement("div",{className:"subheading"},"xp"),P.getEncounterXP(this.props.encounter,null,this.props.getMonster)),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.view(e.props.encounter)}},"open encounter"),r.a.createElement("button",{onClick:function(){return e.props.edit(e.props.encounter)}},"edit encounter"),r.a.createElement(Z,{text:"copy encounter"},r.a.createElement(J,{text:this.state.cloneName,placeholder:"encounter name",onChange:function(t){return e.setCloneName(t)}}),r.a.createElement("button",{onClick:function(){return e.props.clone(e.props.encounter,e.state.cloneName)}},"create copy")),a,r.a.createElement(H,{text:"delete encounter",onConfirm:function(){return e.props.delete(e.props.encounter)}})))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),sn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"openStatBlock",value:function(e){var t=this.props.getMonster(e.monsterID);t&&this.props.openStatBlock(t)}},{key:"render",value:function(){var e=this;try{if(!this.props.hasMonsters)return r.a.createElement(d.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement(h.a,{xs:20,sm:18,md:16,lg:12,xl:10},r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"this screen is for building encounters, but before you can do that you need to do these things first:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("span",{className:this.props.hasMonsters?"strikethrough":""},"add some monsters in the ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.setView("library")}},"monsters screen")),this.props.hasMonsters?r.a.createElement(an.a,{title:"done",style:{marginLeft:"5px"}}):null)))));var t=this.props.combats;b.sort(t);var a=t.map((function(t){return r.a.createElement(nn,{key:t.id,combat:t,resume:function(t){return e.props.resumeCombat(t)},delete:function(t){return e.props.deleteCombat(t)},openStatBlock:function(t){return e.props.openStatBlock(t)}})})),n=this.props.encounters;b.sort(n);var s=n.map((function(t){return r.a.createElement(rn,{key:t.id,encounter:t,parties:e.props.parties,view:function(t){return e.props.viewEncounter(t)},edit:function(t){return e.props.editEncounter(t)},delete:function(t){return e.props.deleteEncounter(t)},clone:function(t,a){return e.props.cloneEncounter(t,a)},run:function(t,a){return e.props.runEncounter(t,a)},openStatBlock:function(t){return e.openStatBlock(t)},getMonster:function(t){return e.props.getMonster(t)}})}));return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"on this page you can set up encounters"),r.a.createElement("div",{className:"section"},"when you have created an encounter you can add monsters to it, then gauge its difficulty for a party of pcs"),r.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can then run the encounter"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see the encounters that you have created"),r.a.createElement("div",{className:"section"},"select an encounter from the list to add monsters to it"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start building an encounter, press the ",r.a.createElement("b",null,"create a new encounter")," button")),r.a.createElement("button",{onClick:function(){return e.props.addEncounter(null)}},"create a new encounter"),r.a.createElement(Z,{text:"use an encounter template"},r.a.createElement(Ve,{items:P.encounterTemplates().map((function(e){return{id:e.name,text:e.name}})),selectedItemID:null,onSelect:function(t){return e.props.addEncounter(t)}}))),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(Fe,{heading:"in progress",content:a}),r.a.createElement(Fe,{heading:"encounters",content:s})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),on=new de.a.Converter;on.setOption("tables",!0);var cn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getSlots",value:function(e,t,a){var n=this,s=a.filter((function(e){return""!==e.monsterName}));return 0===s.length?r.a.createElement(Ne,null,"no monsters"):r.a.createElement(Fe,{key:e,heading:t,columns:2,content:s.map((function(e){var t=n.props.getMonster(e.monsterID);if(t){var a=JSON.parse(JSON.stringify(t));return e.count>1&&(a.name+=" x"+e.count),"foe"!==e.faction&&(a.name+=" ("+e.faction+")"),r.a.createElement(Ue,{key:e.id,monster:a})}return null}))})}},{key:"render",value:function(){var e=this;try{var t;return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(ln,{encounter:this.props.encounter,parties:this.props.parties,edit:function(t){return e.props.edit(t)},delete:function(t){return e.props.delete(t)},run:function(t,a){return e.props.run(t,a)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},goBack:function(){return e.props.goBack()}})),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:on.makeHtml(this.props.encounter.notes)}}),this.getSlots(this.props.encounter.id,null!==(t=this.props.encounter.name)&&void 0!==t?t:"unnamed encounter",this.props.encounter.slots),this.props.encounter.waves.map((function(t){var a;return e.getSlots(t.id,null!==(a=t.name)&&void 0!==a?a:"wave",t.slots)}))))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ln=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;return this.props.parties.length>0&&(t=r.a.createElement(Y,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start combat with...",onSelect:function(t){return e.props.run(e.props.encounter,t)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"encounter name"),r.a.createElement(J,{text:this.props.encounter.name,placeholder:"encounter name",onChange:function(t){return e.props.changeValue(e.props.encounter,"name",t)}})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.edit(e.props.encounter)}},"edit encounter"),t,r.a.createElement(H,{text:"delete encounter",onConfirm:function(){return e.props.delete(e.props.encounter)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(Qe.a,{style:{fontSize:"10px"}})," back to the list")))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),un=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={playerViewOpen:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null,selectedCombatantIDs:[],selectedAreaID:null},n}return Object(c.a)(a,[{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"toggleEditFog",value:function(){this.setState({editFog:!this.state.editFog,selectedCombatantIDs:[],highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleHighlightMapSquare",value:function(){this.setState({editFog:!1,selectedCombatantIDs:[],highlightMapSquare:!this.state.highlightMapSquare,highlightedSquare:null})}},{key:"setHighlightedSquare",value:function(e,t,a){this.state.highlightMapSquare&&!a&&this.setState({highlightedSquare:{x:e,y:t}})}},{key:"setSelectedCombatantIDs",value:function(e){this.setState({editFog:!(e.length>0)&&this.state.editFog,selectedCombatantIDs:e})}},{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"addCompanion",value:function(e){var t=this;this.setState({selectedCombatantIDs:[e.id]},(function(){return t.props.addCompanion(e)}))}},{key:"toggleItemSelection",value:function(e,t){if(e&&t){var a=this.state.selectedCombatantIDs;if(a.includes(e)){var n=a.indexOf(e);a.splice(n,1)}else a.push(e);this.setSelectedCombatantIDs(a)}else this.setSelectedCombatantIDs(e?[e]:[])}},{key:"mapRemove",value:function(e){var t=this;this.setState({selectedCombatantIDs:[]},(function(){return t.props.mapRemove(e.map((function(e){return e.id})))}))}},{key:"nudgeValue",value:function(e,t,a){var n=null;switch(t){case"challenge":n=k.nudgeChallenge(e[t],a);break;case"size":case"displaySize":n=k.nudgeSize(e[t],a);break;default:n=e[t]+a}this.props.changeValue(e,t,n)}},{key:"gridSquareClicked",value:function(e,t,a){var n=this,r=this.props.exploration.combatants.find((function(e){return e.id===n.state.selectedCombatantIDs[0]})),s=this.props.exploration.map.items.find((function(e){return e.id===n.state.selectedCombatantIDs[0]}));r&&!s&&this.props.mapAdd(r,e,t),this.state.editFog&&!a&&this.props.toggleFog(e,t,e,t)}},{key:"getPlayerView",value:function(){var e=this;return this.state.playerViewOpen?r.a.createElement(ja,{title:"Map",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("div",{className:"scrollable both-ways"},this.getMap(!0))):null}},{key:"getMap",value:function(e){var t=this,a=1===this.state.selectedCombatantIDs.length&&!this.props.exploration.map.items.find((function(e){return e.id===t.state.selectedCombatantIDs[0]})),n=null;if(this.state.selectedAreaID){var s=this.props.exploration.map.areas.find((function(e){return e.id===t.state.selectedAreaID}));s&&(n={minX:s.x,minY:s.y,maxX:s.x+s.width-1,maxY:s.y+s.height-1})}return r.a.createElement(ve,{map:this.props.exploration.map,mode:e?"combat-player":"combat",viewport:n,combatants:this.props.exploration.combatants,showGrid:(a||this.state.editFog||this.state.highlightMapSquare)&&!e,selectedItemIDs:this.state.selectedCombatantIDs,fog:this.props.exploration.fog,focussedSquare:this.state.highlightedSquare,gridSquareEntered:function(a,n){return t.setHighlightedSquare(a,n,e)},gridSquareClicked:function(a,n){return t.gridSquareClicked(a,n,e)},gridRectangleSelected:function(e,a,n,r){return t.props.toggleFog(e,a,n,r)},itemSelected:function(e,a){return t.toggleItemSelection(e,a)},areaSelected:function(e){return t.setSelectedAreaID(e)}})}},{key:"render",value:function(){var e=this;try{var t=null;this.state.highlightMapSquare&&(t=r.a.createElement(Ne,null,r.a.createElement("p",null,"use your mouse to indicate a square on the map"),r.a.createElement("p",null,"that square will be highlighted on the player view map as well")));var a=null;this.state.editFog&&(a=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("p",null,"click on map squares to turn fog of war on and off"),r.a.createElement("p",null,"you can also click and drag to select an area")),r.a.createElement("button",{onClick:function(){return e.props.fillFog()}},"fill fog of war"),r.a.createElement("button",{className:0===this.props.exploration.fog.length?"disabled":"",onClick:function(){return e.props.clearFog()}},"clear fog of war")));var n=r.a.createElement("div",null,r.a.createElement(A,{label:"highlight map square",checked:this.state.highlightMapSquare,onChecked:function(){return e.toggleHighlightMapSquare()}}),t,r.a.createElement(A,{label:"edit fog of war",checked:this.state.editFog,onChecked:function(){return e.toggleEditFog()}}),a,r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.startCombat(e.props.exploration)}},"start combat"),r.a.createElement("button",{onClick:function(){return e.props.rotateMap()}},"rotate map"),r.a.createElement(A,{label:"show player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.pauseExploration()}},"pause exploration"),r.a.createElement(H,{text:"end exploration",onConfirm:function(){return e.props.endExploration(e.props.exploration)}}))),s=null,i=this.props.exploration.combatants.filter((function(t){return e.state.selectedCombatantIDs.includes(t.id)})),o=this.props.exploration.map.items.filter((function(t){return e.state.selectedCombatantIDs.includes(t.id)}));if(i.length>0&&o.length===i.length){var c=null;if(1===i.length)switch(i[0].type){case"pc":c=r.a.createElement(Xe,{pc:i[0]});break;case"companion":var l=i[0];if(l.monsterID){var u=this.props.getMonster(l.monsterID);u&&(c=r.a.createElement(Ue,{monster:u}))}}s=r.a.createElement("div",{className:"section"},r.a.createElement(Ya,{combatants:i,allCombatants:this.props.exploration.combatants,map:this.props.exploration.map,defaultTab:"map",makeCurrent:function(e){return null},makeActive:function(e){return null},makeDefeated:function(e){return null},toggleTag:function(t,a){return e.props.toggleTag(t,a)},toggleCondition:function(t,a){return e.props.toggleCondition(t,a)},toggleHidden:function(t){return e.props.toggleHidden(t)},changeHP:function(e){return null},addCondition:function(t){return e.props.addCondition(t)},editCondition:function(t,a){return e.props.editCondition(t,a)},removeCondition:function(t,a){return e.props.removeCondition(t,a)},mapAdd:function(e){return null},mapMove:function(t,a){return e.props.mapMove(t.map((function(e){return e.id})),a)},mapRemove:function(t){return e.mapRemove(t)},onChangeAltitude:function(t,a){return e.props.onChangeAltitude(t,a)},removeCombatants:null,addCompanion:function(t){return e.addCompanion(t)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}),c)}else{var m=this.props.exploration.combatants.filter((function(t){return!e.props.exploration.map.items.find((function(e){return e.id===t.id}))}));if(m.length){var p=m.map((function(t){return r.a.createElement(Qa,{key:t.id,combatant:t,addToMap:function(){return e.setSelectedCombatantIDs([t.id])}})})),f=r.a.createElement("div",null,r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"these pcs have not yet been placed on the map"),r.a.createElement("div",{className:"section"},"to place one on the map, click the ",r.a.createElement("b",null,"place on map")," button and then click on a map square")),p);s=r.a.createElement(Fe,{heading:"not on the map",columns:1,content:[f]})}else s=r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"select a map token to see its details here"))}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:24,sm:24,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},n),r.a.createElement(h.a,{xs:24,sm:24,md:8,lg:12,xl:16,className:"scrollable both-ways"},this.getMap(!1)),r.a.createElement(h.a,{xs:24,sm:24,md:8,lg:6,xl:4,className:"scrollable"},s),this.getPlayerView())}catch(v){return console.error(v),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),mn=a(216),pn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e=r.a.createElement(mn.a,{autoplay:!0,autoplaySpeed:1e4},r.a.createElement("div",{key:"prologue"},r.a.createElement("p",{className:"heading"},"welcome to ",r.a.createElement("span",{className:"app-name"},"dojo")),r.a.createElement("p",null,r.a.createElement("span",{className:"app-name"},"dojo")," is an app for dms of ",r.a.createElement("a",{href:"https://www.wizards.com/dnd",target:"_blank",rel:"noopener noreferrer"},"dungeons and dragons fifth edition")),r.a.createElement("p",null,"with ",r.a.createElement("span",{className:"app-name"},"dojo")," you can...")),r.a.createElement("div",{key:"monster"},r.a.createElement("p",{className:"heading"},"build unique, challenging monsters"),r.a.createElement("ul",null,r.a.createElement("li",null,"watch the stat block change as you design your monster"),r.a.createElement("li",null,"see a list of similar monsters to help kickstart your creativity (or show you typical stat values for the type of monster you're creating)"),r.a.createElement("li",null,"build an entirely random monster with a single click"),r.a.createElement("li",null,"easily import any monster from ",r.a.createElement("a",{href:"https://dnd.wizards.com/articles/features/basicrules",target:"_blank",rel:"noopener noreferrer"},"the basic rules")," or from ",r.a.createElement("a",{href:"https://www.dndbeyond.com",target:"_blank",rel:"noopener noreferrer"},"d&d beyond")),r.a.createElement("li",null,"supports legendary and mythic monsters"))),r.a.createElement("div",{key:"encounter"},r.a.createElement("p",{className:"heading"},"create rewarding encounters"),r.a.createElement("ul",null,r.a.createElement("li",null,"quickly add monsters to your encounter and see its xp value and difficulty level change"),r.a.createElement("li",null,"split your encounter into multiple waves"),r.a.createElement("li",null,"let ",r.a.createElement("span",{className:"app-name"},"dojo")," build a random encounter on the fly - or use one of its encounter templates to get started"))),r.a.createElement("div",{key:"map"},r.a.createElement("p",{className:"heading"},"design intricate tactical maps"),r.a.createElement("ul",null,r.a.createElement("li",null,"create a dungeon map by quickly adding rooms, doors, corridors, and stairs"),r.a.createElement("li",null,"for something a little more fancy, you can upload your own battlemap images - even animated images"),r.a.createElement("li",null,"generate an entire random dungeon map with one click"),r.a.createElement("li",null,"add fog of war and then show your maps to your players"))),r.a.createElement("div",{key:"combat"},r.a.createElement("p",{className:"heading"},"run combat without the book-keeping"),r.a.createElement("ul",null,r.a.createElement("li",null,"see the initiative list at a glance - and share it with players in a separate window"),r.a.createElement("li",null,"track monster hit points, rechargable actions, and legendary actions"),r.a.createElement("li",null,"track conditions, their durations, and the effects they impose"),r.a.createElement("li",null,"easily handle mounted combat"),r.a.createElement("li",null,"if you're using a tactical map, ",r.a.createElement("span",{className:"app-name"},"dojo")," keeps track of everyone's location"))),r.a.createElement("div",{key:"epilogue"},r.a.createElement("p",{className:"heading"},"to get started"),r.a.createElement("p",null,"use the buttons at the bottom of the screen to explore ",r.a.createElement("span",{className:"app-name"},"dojo"),"'s main features"),r.a.createElement("p",null,"the arrow at the top right gives you additional tools like a die roller, some useful random generators, and rules references")));return r.a.createElement(d.a,{align:"middle",justify:"center",className:"scrollable"},e)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),dn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.exploration.name||"unnamed exploration")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement(ve,{map:this.props.exploration.map,fog:this.props.exploration.fog,combatants:this.props.exploration.combatants})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.resume(e.props.exploration)}},"resume exploration"),r.a.createElement(H,{text:"delete exploration",onConfirm:function(){return e.props.delete(e.props.exploration)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),hn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={cloneName:e.map.name+" copy"},n}return Object(c.a)(a,[{key:"setCloneName",value:function(e){this.setState({cloneName:e})}},{key:"render",value:function(){var e=this;try{var t=null;if(this.props.parties.length>0){var a=this.props.parties.map((function(e){return{id:e.id,text:e.name}}));t=r.a.createElement(Y,{options:a,placeholder:"start exploration with...",onSelect:function(t){return e.props.explore(e.props.map,t)}})}return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.map.name||"unnamed map")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement(ve,{map:this.props.map,showAreaNames:!0})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.viewMap(e.props.map)}},"open map"),r.a.createElement("button",{onClick:function(){return e.props.editMap(e.props.map)}},"edit map"),r.a.createElement(Z,{text:"copy map"},r.a.createElement(J,{text:this.state.cloneName,placeholder:"map name",onChange:function(t){return e.setCloneName(t)}}),r.a.createElement("button",{onClick:function(){return e.props.cloneMap(e.props.map,e.state.cloneName)}},"create copy")),t,r.a.createElement(H,{text:"delete map",onConfirm:function(){return e.props.removeMap(e.props.map)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),fn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.explorations;b.sort(t);var a=t.map((function(t){return r.a.createElement(dn,{key:t.id,exploration:t,resume:function(t){return e.props.resumeExploration(t)},delete:function(t){return e.props.deleteExploration(t)}})})),n=this.props.maps;b.sort(n);var s=n.map((function(t){return r.a.createElement(hn,{key:t.id,map:t,parties:e.props.parties,viewMap:function(t){return e.props.viewMap(t)},editMap:function(t){return e.props.editMap(t)},cloneMap:function(t,a){return e.props.cloneMap(t,a)},removeMap:function(t){return e.props.deleteMap(t)},explore:function(t,a){return e.props.explore(t,a)}})}));return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"on this page you can set up tactical maps"),r.a.createElement("div",{className:"section"},"when you have created a map you can explore it with a party of pcs, or use it in the combat manager"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see the maps you have created"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to design a new map, press the ",r.a.createElement("b",null,"create a new map")," button")),r.a.createElement("button",{onClick:function(){return e.props.addMap()}},"create a new map"),r.a.createElement("button",{onClick:function(){return e.props.importMap()}},"import a map image"),r.a.createElement(Z,{text:"create a random map"},r.a.createElement("button",{onClick:function(){return e.props.generateMap("dungeon")}},"create a new dungeon map"),r.a.createElement("button",{onClick:function(){return e.props.generateMap("delve")}},"create a new delve map"))),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(Fe,{heading:"in progress",content:a}),r.a.createElement(Fe,{heading:"maps",content:s})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),vn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={selectedAreaID:null},n}return Object(c.a)(a,[{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"render",value:function(){var e=this;try{var t=null;if(this.state.selectedAreaID){var a=this.props.map.areas.find((function(t){return t.id===e.state.selectedAreaID}));a&&(t={minX:a.x,minY:a.y,maxX:a.x+a.width-1,maxY:a.y+a.height-1})}return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(J,{text:this.props.map.name,placeholder:"map name",onChange:function(t){return e.props.changeValue(e.props.map,"name",t)}})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.edit(e.props.map)}},"edit map"),r.a.createElement(Y,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start exploration with...",onSelect:function(t){return e.props.startExploration(e.props.map,t)}}),r.a.createElement(H,{text:"delete map",onConfirm:function(){return e.props.delete(e.props.map)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(Qe.a,{style:{fontSize:"10px"}})," back to the list"))),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable both-ways"},r.a.createElement(ve,{map:this.props.map,mode:"combat",viewport:t,showAreaNames:!0,areaSelected:function(t){return e.setSelectedAreaID(t)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),gn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getMonsters",value:function(){var e=this;return 0===this.props.group.monsters.length?r.a.createElement("div",{className:"section"},"no monsters"):this.props.group.monsters.map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)}},r.a.createElement($,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},t.name||"unnamed monster"),r.a.createElement("div",{className:"value"},"cr ",k.challenge(t.challenge)))}))}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.group.name||"unnamed group")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},this.getMonsters()),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.open(e.props.group)}},"open group"),r.a.createElement(H,{text:"delete group",onConfirm:function(){return e.props.delete(e.props.group)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),bn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{if(!this.props.hasMonsters)return r.a.createElement(d.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement(h.a,{xs:20,sm:18,md:16,lg:12,xl:10},r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"to kickstart your monster collection, let's import all the monsters from the ",r.a.createElement("a",{href:"http://dnd.wizards.com/articles/features/systems-reference-document-srd",target:"_blank",rel:"noopener noreferrer"},"d&d system reference document")),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.addOpenGameContent()}},"import monsters"))));var t=this.props.library;b.sort(t);var a=t.map((function(t){return r.a.createElement(gn,{key:t.id,group:t,open:function(t){return e.props.selectMonsterGroup(t)},delete:function(t){return e.props.deleteMonsterGroup(t)},openStatBlock:function(t){return e.props.openStatBlock(t)}})}));return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"you can maintain your menagerie of monsters here"),r.a.createElement("div",{className:"section"},"you can then use these monsters to design combat encounters in the encounter builder"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see your monster groups"),r.a.createElement("div",{className:"section"},"select a monster group from the list to see stat blocks for monsters in that group"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start adding monsters, press the ",r.a.createElement("b",null,"create a new monster group")," button")),r.a.createElement("button",{onClick:function(){return e.props.addMonsterGroup()}},"create a new monster group"),r.a.createElement("button",{onClick:function(){return e.props.importMonsterGroup()}},"import a monster group"),r.a.createElement("button",{onClick:function(){return e.props.openDemographics(null)}},"show demographics")),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(Fe,{heading:"monster groups",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),yn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"export",value:function(e){var t=e.name+".monster";b.saveFile(t,e)}},{key:"render",value:function(){var e=this;try{var t=[];return 0!==this.props.monsterGroup.monsters.length?this.props.monsterGroup.monsters.forEach((function(a){t.push(r.a.createElement(ee,{monster:a,mode:"editable",library:e.props.library,encounters:e.props.encounters,moveToGroup:function(t,a){return e.props.moveToGroup(t,a)},removeMonster:function(t){return e.props.removeMonster(t)},viewMonster:function(t){return e.props.viewMonster(t)},editMonster:function(t){return e.props.editMonster(t)},exportMonster:function(t){return e.export(t)},cloneMonster:function(t,a){return e.props.cloneMonster(t,a)}}))})):t.push(r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"there are no monsters in this group"))),r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(En,{monsterGroup:this.props.monsterGroup,library:this.props.library,goBack:function(){return e.props.goBack()},addMonster:function(t){return e.props.addMonster(t)},importMonster:function(){return e.props.importMonster()},changeValue:function(t,a){return e.props.changeValue(e.props.monsterGroup,t,a)},removeMonsterGroup:function(){return e.props.removeMonsterGroup()},openDemographics:function(){return e.props.openDemographics(e.props.monsterGroup)}})),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(Fe,{content:t,heading:this.props.monsterGroup.name||"unnamed group"})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),En=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={cr:1,type:null,size:null,role:null},n}return Object(c.a)(a,[{key:"getSummary",value:function(){if(0===this.props.monsterGroup.monsters.length)return r.a.createElement("div",{className:"section centered"},r.a.createElement("i",null,"no monsters"));var e={min:30,max:0};this.props.monsterGroup.monsters.forEach((function(t){e.min=Math.min(e.min,t.challenge),e.max=Math.max(e.max,t.challenge)}));var t=e.min===e.max?k.challenge(e.min):k.challenge(e.min)+" - "+k.challenge(e.max);return r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"monsters")),r.a.createElement("div",{className:"section"},this.props.monsterGroup.monsters.length),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"challenge rating")),r.a.createElement("div",{className:"section"},t))}},{key:"getGenerator",value:function(){var e=this,t=C.map((function(e){return{id:e,text:e}})),a=N.map((function(e){return{id:e,text:e}})),n=x.map((function(e){return{id:e,text:e}})),s=[];return this.props.library.forEach((function(t){t.monsters.forEach((function(t){var a=!0;t.challenge!==e.state.cr&&(a=!1),e.state.type&&t.category!==e.state.type&&(a=!1),e.state.size&&t.size!==e.state.size&&(a=!1),e.state.role&&t.role!==e.state.role&&(a=!1),a&&s.push(t)}))})),r.a.createElement(Z,{text:"create a random monster"},r.a.createElement(ne,{label:"cr",value:k.challenge(this.state.cr),onNudgeValue:function(t){return e.setState({cr:k.nudgeChallenge(e.state.cr,t)})}}),r.a.createElement(Y,{options:t,selectedID:this.state.type,placeholder:"any type",onSelect:function(t){return e.setState({type:t})},onClear:function(){return e.setState({type:null})}}),r.a.createElement(Y,{options:a,selectedID:this.state.size,placeholder:"any size",onSelect:function(t){return e.setState({size:t})},onClear:function(){return e.setState({size:null})}}),r.a.createElement(Y,{options:n,selectedID:this.state.role,placeholder:"any role",onSelect:function(t){return e.setState({role:t})},onClear:function(){return e.setState({role:null})}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(d.a,null,r.a.createElement(h.a,{span:16},"number of monsters:"),r.a.createElement(h.a,{span:8,className:"statistic-value"},s.length))),r.a.createElement("hr",null),r.a.createElement("button",{className:s.length>2?"":"disabled",onClick:function(){var t=y.createMonster();t.name=I.capitalise(I.generateName()),M.spliceMonsters(t,s),e.props.addMonster(t)}},"create monster"))}},{key:"export",value:function(){var e=this.props.monsterGroup.name+".monstergroup";b.saveFile(e,this.props.monsterGroup)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"monster group name"),r.a.createElement(J,{text:this.props.monsterGroup.name,placeholder:"monster group name",onChange:function(t){return e.props.changeValue("name",t)}})),r.a.createElement("hr",null),this.getSummary(),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.addMonster(null)}},"add a new monster"),r.a.createElement("button",{onClick:function(){return e.props.importMonster()}},"import a monster"),this.getGenerator(),r.a.createElement("button",{onClick:function(){return e.props.openDemographics()}},"show demographics"),r.a.createElement("button",{onClick:function(){return e.export()}},"export group"),r.a.createElement(H,{text:"delete group",onConfirm:function(){return e.props.removeMonsterGroup()}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(Qe.a,{style:{fontSize:"10px"}})," back to the list"))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),kn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getText",value:function(e){var t=e.name||"unnamed pc";return e.player&&(t+=" ("+e.player+")"),t}},{key:"getPCs",value:function(){var e=this;return 0===this.props.party.pcs.length?r.a.createElement("div",{className:"section"},"no pcs"):this.props.party.pcs.map((function(t){return r.a.createElement("div",{key:t.id,className:t.active?"combatant-row":"combatant-row inactive",onClick:function(){return e.props.openStatBlock(t)}},r.a.createElement($,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},e.getText(t)),r.a.createElement("div",{className:"value"},"lvl ",t.level))}))}},{key:"render",value:function(){var e=this;try{var t=null;if(this.props.encounters.length>0){var a=this.props.encounters.map((function(e){return{id:e.id,text:e.name}}));t=r.a.createElement(Y,{options:a,placeholder:"start combat...",onSelect:function(t){return e.props.runEncounter(e.props.party,t)}})}return r.a.createElement("div",{className:"card pc"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.party.name||"unnamed party")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},this.getPCs()),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.open(e.props.party)}},"open party"),t,r.a.createElement("button",{onClick:function(){return e.props.showReference(e.props.party)}},"show party reference"),r.a.createElement(H,{text:"delete party",onConfirm:function(){return e.props.delete(e.props.party)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),wn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.parties;b.sort(t);var a=t.map((function(t){return r.a.createElement(kn,{key:t.id,party:t,encounters:e.props.encounters,open:function(t){return e.props.selectParty(t)},delete:function(t){return e.props.deleteParty(t)},runEncounter:function(t,a){return e.props.runEncounter(t,a)},showReference:function(t){return e.props.showReference(t)},openStatBlock:function(t){return e.props.openStatBlock(t)}})}));return r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"this page is where you can tell dojo all about your pcs"),r.a.createElement("div",{className:"section"},"you can add a party for each of your gaming groups"),r.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can run the encounter in the combat manager"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see the parties that you have created"),r.a.createElement("div",{className:"section"},"select a party from the list to see pc details"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start adding a party, press the ",r.a.createElement("b",null,"create a new party")," button")),r.a.createElement("button",{onClick:function(){return e.props.addParty()}},"create a new party"),r.a.createElement("button",{onClick:function(){return e.props.importParty()}},"import a party")),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(Fe,{heading:"parties",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Nn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"export",value:function(e){var t=e.name+".pc";b.saveFile(t,e)}},{key:"render",value:function(){var e=this;try{var t=this.props.party.pcs.filter((function(e){return e.active})),a=[];t.forEach((function(t){a.push(r.a.createElement(Xe,{pc:t,mode:"edit",changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},editPC:function(t){return e.props.editPC(t)},updatePC:function(t){return e.props.updatePC(t)},exportPC:function(t){return e.export(t)},removePC:function(t){return e.props.removePC(t)}}))}));var n=this.props.party.pcs.filter((function(e){return!e.active})),s=[];return n.forEach((function(t){s.push(r.a.createElement(Xe,{pc:t,mode:"edit",changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},editPC:function(t){return e.props.editPC(t)},updatePC:function(t){return e.props.updatePC(t)},exportPC:function(t){return e.export(t)},removePC:function(t){return e.props.removePC(t)}}))})),0===t.length&&a.push(r.a.createElement(Ne,null,r.a.createElement("div",{className:"section"},"there are no pcs in this party"))),r.a.createElement(d.a,{className:"full-height"},r.a.createElement(h.a,{xs:12,sm:12,md:8,lg:6,xl:4,className:"scrollable sidebar sidebar-left"},r.a.createElement(Cn,{party:this.props.party,goBack:function(){return e.props.goBack()},addPC:function(){return e.props.addPC()},importPC:function(){return e.props.importPC()},changeValue:function(t,a){return e.props.changeValue(e.props.party,t,a)},removeParty:function(){return e.props.removeParty()}})),r.a.createElement(h.a,{xs:12,sm:12,md:16,lg:18,xl:20,className:"scrollable"},r.a.createElement(Fe,{content:a,heading:this.props.party.name||"unnamed party"}),r.a.createElement(Fe,{content:s,heading:"inactive pcs"})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Cn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"export",value:function(){var e=this.props.party.name+".party";b.saveFile(e,this.props.party)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"party name"),r.a.createElement(J,{text:this.props.party.name,placeholder:"party name",onChange:function(t){return e.props.changeValue("name",t)}})),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.addPC()}},"add a new pc"),r.a.createElement("button",{onClick:function(){return e.props.importPC()}},"import a pc"),r.a.createElement("button",{onClick:function(){return e.export()}},"export party"),r.a.createElement(H,{text:"delete party",onConfirm:function(){return e.props.removeParty()}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(Qe.a,{style:{fontSize:"10px"}})," back to the list")))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),xn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(o.a)(this,a),(n=t.call(this,e)).monsterIdToGroup={},n.saveAfterDelay=b.debounce((function(){return n.saveAll()}),5e3);var r=[];try{var s=window.localStorage.getItem("data-parties");s&&(r=JSON.parse(s))}catch(y){console.error("Could not parse JSON: ",y)}var i=[];try{var c=window.localStorage.getItem("data-library");c&&(i=JSON.parse(c)).forEach((function(e){e.monsters.forEach((function(e){if(void 0===e.acInfo&&(e.acInfo=""),void 0===e.legendaryActions){var t=e.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))?3:0;e.legendaryActions=t}e.role=M.getRole(e)}))}))}catch(y){console.error("Could not parse JSON: ",y)}var l=[];try{var u=window.localStorage.getItem("data-encounters");u&&(l=JSON.parse(u)).forEach((function(e){e.slots.forEach((function(e){if(void 0===e.monsterID){var t=i.find((function(t){return t.name===e.monsterGroupName}));if(t){var a=t.monsters.find((function(t){return t.name===e.monsterName}));a&&(e.monsterID=a.id)}}void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})),e.waves.forEach((function(e){e.slots.forEach((function(e){if(void 0===e.monsterID){var t=i.find((function(t){return t.name===e.monsterGroupName}));if(t){var a=t.monsters.find((function(t){return t.name===e.monsterName}));a&&(e.monsterID=a.id)}}void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}))}))}))}catch(y){console.error("Could not parse JSON: ",y)}var m=[];try{var p=window.localStorage.getItem("data-maps");p&&(m=JSON.parse(p)).forEach((function(e){void 0===e.areas&&(e.areas=[])}))}catch(y){console.error("Could not parse JSON: ",y)}var d=[];try{var h=window.localStorage.getItem("data-combats");h&&(d=JSON.parse(h)).forEach((function(e){e.combatants.forEach((function(e){if(void 0===e.faction)switch(e.type){case"pc":case"companion":e.faction="ally";break;case"monster":e.faction="foe";break;default:e.faction="neutral"}void 0===e.note&&(e.note=""),void 0===e.mountID&&(e.mountID=null),void 0===e.mountType&&(e.mountType="controlled")})),e.encounter&&(e.encounter.slots.forEach((function(e){if(void 0===e.monsterID){var t=i.find((function(t){return t.name===e.monsterGroupName}));if(t){var a=t.monsters.find((function(t){return t.name===e.monsterName}));a&&(e.monsterID=a.id)}}void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})),e.encounter.waves.forEach((function(e){e.slots.forEach((function(e){if(void 0===e.monsterID){var t=i.find((function(t){return t.name===e.monsterGroupName}));if(t){var a=t.monsters.find((function(t){return t.name===e.monsterName}));a&&(e.monsterID=a.id)}}void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}))}))),e.map&&void 0===e.map.areas&&(e.map.areas=[]),void 0===e.fog&&(e.fog=[]),void 0===e.report&&(e.report=[])}))}catch(y){console.error("Could not parse JSON: ",y)}var f=[];try{var v=window.localStorage.getItem("data-explorations");v&&(f=JSON.parse(v)).forEach((function(e){void 0===e.map.areas&&(e.map.areas=[])}))}catch(y){console.error("Could not parse JSON: ",y)}var g={};return[4,6,8,10,12,20,100].forEach((function(e){return g[e]=0})),g[20]=1,n.state={view:"home",drawer:null,sidebar:{visible:!1,type:"tools",subtype:"die",dice:g,constant:0,selectedPartyID:null,selectedMonsterID:null},parties:r,library:i,encounters:l,maps:m,combats:d,explorations:f,selectedPartyID:null,selectedMonsterGroupID:null,selectedEncounterID:null,selectedMapID:null,selectedCombatID:null,selectedExplorationID:null},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;g.a.bind("ctrl+f",(function(t){t.preventDefault(),e.setSidebar("search")}))}},{key:"componentWillUnmount",value:function(){g.a.unbind("ctrl+f")}},{key:"componentDidUpdate",value:function(){this.saveAfterDelay()}},{key:"setView",value:function(e){this.save(),this.setState({view:e})}},{key:"setSidebar",value:function(e){var t="";switch(e){case"tools":t="die";break;case"generators":t="name";break;case"reference":t="skills"}var a=this.state.sidebar;a.visible=!0,a.type=e,a.subtype=t,this.setState({sidebar:a})}},{key:"toggleSidebar",value:function(){var e=this.state.sidebar;e.visible=!e.visible,this.setState({sidebar:e})}},{key:"closeDrawer",value:function(){this.setState({drawer:null})}},{key:"selectParty",value:function(e){this.setState({selectedPartyID:e?e.id:null})}},{key:"selectMonsterGroup",value:function(e){this.setState({selectedMonsterGroupID:e?e.id:null})}},{key:"selectEncounter",value:function(e){this.setState({selectedEncounterID:e?e.id:null})}},{key:"selectMap",value:function(e){this.setState({selectedMapID:e?e.id:null})}},{key:"selectPartyByID",value:function(e){this.save(),this.setState({view:"parties",selectedPartyID:e})}},{key:"selectMonsterGroupByID",value:function(e){this.save(),this.setState({view:"library",selectedMonsterGroupID:e})}},{key:"selectEncounterByID",value:function(e){this.save(),this.setState({view:"encounters",selectedEncounterID:e,selectedCombatID:null})}},{key:"selectMapByID",value:function(e){this.save(),this.setState({view:"maps",selectedMapID:e,selectedExplorationID:null})}},{key:"selectCombatByID",value:function(e){this.save(),this.setState({view:"encounters",selectedEncounterID:null,selectedCombatID:e})}},{key:"selectExplorationByID",value:function(e){this.save(),this.setState({view:"maps",selectedMapID:null,selectedExplorationID:e})}},{key:"setDice",value:function(e,t,a){var n={};[4,6,8,10,12,20,100].forEach((function(e){return n[e]=0})),n[t]=e;var r=this.state.sidebar;r.visible=!0,r.type="tools",r.subtype="die",r.dice=n,r.constant=a,this.setState({sidebar:r})}},{key:"resetAll",value:function(){var e=this;this.setState({parties:[],library:[],encounters:[],maps:[],combats:[],selectedPartyID:null,selectedMonsterGroupID:null,selectedCombatID:null},(function(){e.saveAll();for(var t=0;t!==window.localStorage.length;++t){var a=window.localStorage.key(t);a&&window.localStorage.removeItem(a)}}))}},{key:"getMonster",value:function(e){var t=this.monsterIdToGroup[e];t||(t=this.state.library.reduce((function(e,t){return e.concat(t.monsters)}),[]).find((function(t){return t.id===e}))||null)&&(this.monsterIdToGroup[e]=t);return t}},{key:"changeValue",value:function(e,t,a){for(var n=this,r=t.split("."),s=e,i=0;i!==r.length;++i){var o=r[i];i===r.length-1?s[o]=a:s=s[o]}if(b.sort(this.state.parties),b.sort(this.state.library),b.sort(this.state.encounters),b.sort(this.state.maps),b.sort(this.state.combats),b.sort(this.state.explorations),"initiative"===t&&!e.pending){var c=this.state.combats.find((function(e){return e.id===n.state.selectedCombatID}));P.sortCombatants(c)}if("mountID"===t){var l=this.state.combats.find((function(e){return e.id===n.state.selectedCombatID}));l&&l.map&&this.setMountPositions(l.combatants,l.map)}this.setState({parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,combats:this.state.combats,explorations:this.state.explorations,selectedPartyID:this.state.selectedPartyID,selectedMonsterGroupID:this.state.selectedMonsterGroupID,selectedEncounterID:this.state.selectedEncounterID,selectedMapID:this.state.selectedMapID,selectedCombatID:this.state.selectedCombatID,selectedExplorationID:this.state.selectedExplorationID,drawer:this.state.drawer,sidebar:this.state.sidebar})}},{key:"nudgeValue",value:function(e,t,a){for(var n=t.split("."),r=e,s=0;s!==n.length;++s){var i=n[s];if(s===n.length-1){var o=null;switch(i){case"challenge":o=k.nudgeChallenge(r[i],a);break;case"size":case"displaySize":o=k.nudgeSize(r[i],a);break;default:o=r[i]+a}this.changeValue(e,t,o)}else r=r[i]}}},{key:"addParty",value:function(){var e=y.createParty();e.name="new party";var t=[].concat(this.state.parties,[e]);b.sort(t),this.setState({parties:t,selectedPartyID:e.id})}},{key:"removeCurrentParty",value:function(){var e=this,t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));t&&this.removeParty(t)}},{key:"removeParty",value:function(e){var t=this.state.parties.indexOf(e);this.state.parties.splice(t,1),this.setState({parties:this.state.parties,selectedPartyID:null})}},{key:"importParty",value:function(){this.setState({drawer:{type:"import-party",party:y.createParty()}})}},{key:"acceptImportedParty",value:function(){this.state.parties.push(this.state.drawer.party),this.setState({parties:this.state.parties,drawer:null})}},{key:"showPartyReference",value:function(e){var t=this.state.sidebar;t.visible=!0,t.type="reference",t.subtype="party",t.selectedPartyID=e.id,this.setState({sidebar:t})}},{key:"removePC",value:function(e){var t=this,a=this.state.parties.find((function(e){return e.id===t.state.selectedPartyID}));if(a){var n=a.pcs.indexOf(e);a.pcs.splice(n,1),this.setState({parties:this.state.parties})}}},{key:"editPC",value:function(e){e||((e=y.createPC()).name="new pc");var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"pc",pc:t}})}},{key:"importPC",value:function(){this.setState({drawer:{type:"import-pc",pc:y.createPC()}})}},{key:"acceptImportedPC",value:function(){var e=this,t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));t&&(t.pcs.push(this.state.drawer.pc),b.sort(t.pcs),this.setState({parties:this.state.parties,drawer:null}))}},{key:"updatePC",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"update-pc",pc:t}})}},{key:"savePC",value:function(){var e=this;b.sort(this.state.drawer.pc.companions);var t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));if(t){var a=t.pcs.find((function(t){return t.id===e.state.drawer.pc.id}));if(a){var n=t.pcs.indexOf(a);t.pcs[n]=this.state.drawer.pc}else t.pcs.push(this.state.drawer.pc);b.sort(t.pcs),this.setState({parties:this.state.parties,drawer:null})}}},{key:"addMonsterGroup",value:function(){var e=y.createMonsterGroup();e.name="new group";var t=[].concat(this.state.library,[e]);b.sort(t),this.setState({library:t,selectedMonsterGroupID:e.id})}},{key:"importMonsterGroup",value:function(){this.setState({drawer:{type:"import-group",group:y.createMonsterGroup()}})}},{key:"acceptImportedGroup",value:function(){this.state.library.push(this.state.drawer.group),this.setState({library:this.state.library,drawer:null})}},{key:"removeCurrentMonsterGroup",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));t&&this.removeMonsterGroup(t)}},{key:"removeMonsterGroup",value:function(e){var t=this.state.library.indexOf(e);this.state.library.splice(t,1),this.setState({library:this.state.library,selectedMonsterGroupID:null})}},{key:"removeMonster",value:function(e){var t=this,a=this.state.library.find((function(e){return e.id===t.state.selectedMonsterGroupID}));if(a){var n=a.monsters.indexOf(e);a.monsters.splice(n,1),this.setState({library:this.state.library})}}},{key:"importMonster",value:function(){this.setState({drawer:{type:"import-monster",monster:y.createMonster()}})}},{key:"acceptImportedMonster",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));t&&(t.monsters.push(this.state.drawer.monster),b.sort(t.monsters),this.setState({library:this.state.library,drawer:null}))}},{key:"moveToGroup",value:function(e,t){var a=this.state.library.find((function(t){return t.monsters.includes(e)}));if(a){var n=a.monsters.indexOf(e);a.monsters.splice(n,1);var r=this.state.library.find((function(e){return e.id===t}));r&&(r.monsters.push(e),b.sort(r.monsters),this.setState({library:this.state.library}))}}},{key:"addMonster",value:function(e){var t=this;if(e){var a=this.state.library.find((function(e){return e.id===t.state.selectedMonsterGroupID}));a&&(a.monsters.push(e),b.sort(a.monsters),this.setState({library:this.state.library,drawer:{type:"statblock",source:e}}))}else{(e=y.createMonster()).name="new monster";var n=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:n,showSidebar:!1}})}}},{key:"editMonster",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:t,showSidebar:!1}})}},{key:"saveMonster",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));if(t){var a=t.monsters.find((function(t){return t.id===e.state.drawer.monster.id}));if(a){var n=t.monsters.indexOf(a);t.monsters[n]=this.state.drawer.monster}else t.monsters.push(this.state.drawer.monster);b.sort(t.monsters),this.setState({library:this.state.library,drawer:null})}}},{key:"toggleShowSidebar",value:function(){var e=this.state.drawer;e.showSidebar=!e.showSidebar,this.setState({drawer:e})}},{key:"cloneMonster",value:function(e,t){var a=this.state.library.find((function(t){return t.monsters.includes(e)}));if(a){var n=JSON.parse(JSON.stringify(e));e.id=b.guid(),e.traits.forEach((function(e){return e.id=b.guid()})),e.name=t,a.monsters.push(n),b.sort(a.monsters),this.setState({library:this.state.library})}}},{key:"addOpenGameContent",value:function(){var e=this;fetch("/dojo/data/monsters.json").then((function(e){return e.json()})).then((function(t){t.forEach((function(t){try{if(t.name){var a=M.createFromJSON(t),n=a.tag||a.category;0===n.indexOf("swarm")&&(n="swarm"),"any race"===n&&(n="npc");var r=e.state.library.find((function(e){return e.name===n}));r||(r={id:b.guid(),name:n,monsters:[]},e.state.library.push(r)),r.monsters.push(a)}}catch(s){console.error(s)}})),b.sort(e.state.library),e.setState({library:e.state.library})}))}},{key:"openDemographics",value:function(e){this.setState({drawer:{type:"monster-demographics",group:e}})}},{key:"addEncounter",value:function(e){var t=y.createEncounter();if(t.name="new encounter",e){var a=P.encounterTemplates().find((function(t){return t.name===e}));a&&(t.name="new "+e+" encounter",t.slots=a.slots.map((function(e){var t=y.createEncounterSlot();return t.roles=e.roles,t.count=e.count,t})),t.waves=[])}var n=JSON.parse(JSON.stringify(t));this.setState({drawer:{type:"encounter-edit",encounter:n}})}},{key:"editEncounter",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"encounter-edit",encounter:t}})}},{key:"cloneEncounter",value:function(e,t){var a=JSON.parse(JSON.stringify(e));a.id=b.guid(),a.slots.forEach((function(e){return e.id=b.guid()})),a.waves.forEach((function(e){e.id=b.guid(),e.slots.forEach((function(e){return e.id=b.guid()}))})),a.name=t,this.state.encounters.push(a),b.sort(this.state.encounters),this.setState({encounters:this.state.encounters})}},{key:"saveEncounter",value:function(){var e=this,t=this.state.encounters,a=this.state.encounters.find((function(t){return t.id===e.state.drawer.encounter.id}));a?t[this.state.encounters.indexOf(a)]=this.state.drawer.encounter:t.push(this.state.drawer.encounter);b.sort(t),this.setState({encounters:t,drawer:null})}},{key:"removeEncounter",value:function(e){var t=this.state.encounters.indexOf(e);this.state.encounters.splice(t,1),this.setState({encounters:this.state.encounters,selectedEncounterID:null})}},{key:"generateMap",value:function(e){var t=y.createMap();t.name="new "+e,T.generate(e,t),this.state.maps.push(t),this.setState({maps:this.state.maps})}},{key:"editMap",value:function(e){e||((e=y.createMap()).name="new map");var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"map-edit",map:t}})}},{key:"cloneMap",value:function(e,t){var a=JSON.parse(JSON.stringify(e));a.id=b.guid(),a.items.forEach((function(e){return e.id=b.guid()})),a.areas.forEach((function(e){return e.id=b.guid()})),a.name=t,this.state.maps.push(a),b.sort(this.state.maps),this.setState({maps:this.state.maps})}},{key:"saveMap",value:function(){var e=this,t=this.state.maps,a=this.state.maps.find((function(t){return t.id===e.state.drawer.map.id}));a?t[this.state.maps.indexOf(a)]=this.state.drawer.map:t.push(this.state.drawer.map);b.sort(t),this.setState({maps:t,drawer:null})}},{key:"importMap",value:function(){var e=y.createMap();this.setState({drawer:{type:"import-map",map:e}})}},{key:"acceptImportedMap",value:function(){this.state.maps.push(this.state.drawer.map),this.setState({maps:this.state.maps,drawer:null})}},{key:"declineImportedMap",value:function(){if(this.state.drawer.map.items.length>0){var e=this.state.drawer.map.items[0].customBackground;window.localStorage.removeItem("image-"+e)}this.closeDrawer()}},{key:"removeMap",value:function(e){var t=this.state.maps.indexOf(e);this.state.maps.splice(t,1),this.setState({maps:this.state.maps,selectedMapID:null})}},{key:"startExploration",value:function(e,t){var a=this.state.parties.find((function(e){return e.id===t}));if(a){var n=JSON.parse(JSON.stringify(e)),r=y.createExploration();r.name=a.name+" in "+e.name,r.map=n,r.partyID=t,a.pcs.forEach((function(e){var t=P.convertPCToCombatant(e);r.combatants.push(t)})),this.state.explorations.push(r),this.setState({view:"maps",explorations:this.state.explorations,selectedExplorationID:r.id})}}},{key:"pauseExploration",value:function(){this.setState({selectedExplorationID:null})}},{key:"resumeExploration",value:function(e){this.setState({view:"maps",selectedExplorationID:e.id})}},{key:"endExploration",value:function(e){var t=this.state.explorations.indexOf(e);this.state.explorations.splice(t,1),this.setState({explorations:this.state.explorations,selectedExplorationID:null})}},{key:"fillFog",value:function(){var e=this,t=this.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));if(t){var a=[],n=T.mapDimensions(t.map.items);if(n){for(var r=n.minX;r<=n.maxX;++r)for(var s=n.minY;s<=n.maxY;++s)a.push({x:r,y:s});t.fog=a,this.setState({explorations:this.state.explorations})}}}},{key:"clearFog",value:function(){var e=this,t=this.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));t&&(t.fog=[],this.setState({explorations:this.state.explorations}))}},{key:"toggleFog",value:function(e,t,a,n){var r=this,s=this.state.explorations.find((function(e){return e.id===r.state.selectedExplorationID}));if(s){for(var i=function(e){for(var a=function(t){var a=s.fog.findIndex((function(a){return a.x===e&&a.y===t}));-1===a?s.fog.push({x:e,y:t}):s.fog.splice(a,1)},r=t;r<=n;++r)a(r)},o=e;o<=a;++o)i(o);this.setState({explorations:this.state.explorations})}}},{key:"addCompanionToExploration",value:function(e){var t=this,a=this.state.explorations.find((function(e){return e.id===t.state.selectedExplorationID}));a&&(a.combatants.push(P.convertCompanionToCombatant(e)),b.sort(a.combatants,[{field:"displayName",dir:"asc"}]),this.setState({explorations:this.state.explorations}))}},{key:"createCombat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=1===this.state.parties.length?this.state.parties[0]:null;if(t){var i=this.state.parties.find((function(e){return e.id===t}));i&&(s=i)}var o=1===this.state.encounters.length?this.state.encounters[0]:null;e&&(o=e);var c=y.createCombatSetup();c.party=JSON.parse(JSON.stringify(s)),c.encounter=JSON.parse(JSON.stringify(e)),o&&(c.slotInfo=k.getCombatSlotData(o,this.state.library)),a&&(c.map=a),c.fog=n,c.combatants=r,this.setState({drawer:{type:"combat-start",combatSetup:c}})}},{key:"startCombat",value:function(){var e=this,t=this.state.drawer.combatSetup;if(t.party&&t.encounter){var a=t.party.name||"unnamed party",n=t.encounter.name||"unnamed encounter",r=y.createCombat();r.name=a+" vs "+n,r.encounter=JSON.parse(JSON.stringify(t.encounter));var s=y.createCombatReportEntry();s.type="combat-start",r.report.push(s),t.combatants.forEach((function(e){r.combatants.push(e)})),t.party.pcs.filter((function(e){return e.active})).forEach((function(e){r.combatants.find((function(t){return t.id===e.id}))||r.combatants.push(P.convertPCToCombatant(e))})),r.encounter.slots.forEach((function(a){var n=e.getMonster(a.monsterID),s=t.slotInfo.find((function(e){return e.id===a.id}));n&&s?s.members.forEach((function(e){r.combatants.push(P.convertMonsterToCombatant(n,e.init,e.hp,e.name,a.faction))})):r.issues.push("unknown monster: "+a.monsterName+" in group "+a.monsterGroupName)})),r.combatants.push(P.convertPlaceholderToCombatant()),P.sortCombatants(r),t.map&&(r.map=JSON.parse(JSON.stringify(t.map)),r.fog=t.fog),this.setState({combats:[].concat(this.state.combats,[r]),selectedCombatID:r.id,drawer:null,view:"encounters"})}}},{key:"openAddWaveModal",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t){var a=y.createCombatSetup();a.encounter=t.encounter,a.slotInfo=k.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:{type:"combat-wave",combatSetup:a}})}}},{key:"addWaveToCombat",value:function(){var e=this,t=this.state.drawer.combatSetup,a=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t&&t.encounter&&a){var n=t.encounter.waves.find((function(e){return e.id===t.waveID}));n&&(n.slots.forEach((function(n){var r=e.getMonster(n.monsterID),s=t.slotInfo.find((function(e){return e.id===n.id}));r&&s?s.members.forEach((function(e){a.combatants.push(P.convertMonsterToCombatant(r,e.init,e.hp,e.name,n.faction))})):a.issues.push("unknown monster: "+n.monsterName+" in group "+n.monsterGroupName)})),P.sortCombatants(a),this.setState({combats:this.state.combats,drawer:null}))}}},{key:"openAddCombatantModal",value:function(){var e=this;if(this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}))){var t=y.createCombatSetup();t.encounter=y.createEncounter(),t.slotInfo=k.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:{type:"combat-add-combatants",combatSetup:t}})}}},{key:"addMonsterToAddCombatantsModal",value:function(e){var t=this.state.drawer.combatSetup;if(t&&t.encounter){var a=this.state.library.find((function(t){return t.monsters.find((function(t){return t.id===e.id}))}));if(a){var n=y.createEncounterSlot();n.monsterID=e.id,n.monsterName=e.name,n.monsterGroupName=a.name,t.encounter.slots.push(n),t.slotInfo=k.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:this.state.drawer})}}}},{key:"addCombatantsToCombat",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID})),a=this.state.drawer.combatSetup;t&&a&&a.encounter&&(a.encounter.slots.forEach((function(n){var r=e.getMonster(n.monsterID),s=a.slotInfo.find((function(e){return e.id===n.id}));r&&s?s.members.forEach((function(e){t.combatants.push(P.convertMonsterToCombatant(r,e.init,e.hp,e.name,n.faction))})):t.issues.push("unknown monster: "+n.monsterName+" in group "+n.monsterGroupName)})),P.sortCombatants(t),this.setState({combats:this.state.combats,drawer:null}))}},{key:"addPCToEncounter",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(n){var r=this.state.parties.find((function(t){return t.id===e}));if(r){var s=r.pcs.find((function(e){return e.id===t}));s&&(n.combatants.push(P.convertPCToCombatant(s)),this.setState({combats:this.state.combats}))}}}},{key:"addCompanionToEncounter",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(a.combatants.push(P.convertCompanionToCombatant(e)),this.setState({combats:this.state.combats}))}},{key:"pauseCombat",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t){var a=y.createCombatReportEntry();a.type="combat-pause",t.report.push(a),this.setState({selectedCombatID:null})}}},{key:"resumeCombat",value:function(e){var t=y.createCombatReportEntry();t.type="combat-resume",e.report.push(t),this.setState({view:"encounters",selectedCombatID:e.id})}},{key:"endCombat",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=y.createCombatReportEntry();n.type="combat-end",e.report.push(n);var r=this.state.combats.indexOf(e);this.state.combats.splice(r,1),this.setState({combats:this.state.combats,selectedCombatID:null},(function(){if(e&&e.map&&a){var n=e.combatants.filter((function(e){return"pc"===e.type||"companion"===e.type}));n.forEach((function(e){e.current=!1,e.pending=!0,e.active=!1,e.defeated=!1,e.initiative=10}));var r=null,s=n.filter((function(e){return"pc"===e.type}));if(s.length>0){var i=t.state.parties.find((function(e){return e.pcs.find((function(e){return e.id===s[0].id}))}));i&&(r=i.id,i.pcs.forEach((function(e){n.find((function(t){return t.id===e.id}))||n.push(P.convertPCToCombatant(e))})))}if(b.sort(n,[{field:"displayName",dir:"asc"}]),r){var o=e.map.id,c=t.state.explorations.find((function(e){return e.map.id===o&&e.partyID===r}));c||((c=y.createExploration()).name=e.name+"in "+e.map.name,c.partyID=r,t.state.explorations.push(c)),c.map=e.map,c.fog=e.fog,c.combatants=n,c.map.items=c.map.items.filter((function(e){return"tile"===e.type||"pc"===e.type||"companion"===e.type})),t.setState({view:"maps",explorations:t.state.explorations,selectedExplorationID:c.id})}}}))}},{key:"makeCurrent",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(n){if(n.combatants.filter((function(e){return e.conditions})).forEach((function(t){t.conditions.forEach((function(a){if(a.duration)switch(a.duration.type){case"saves":e&&t.id===e.id&&"start"===a.duration.point&&n.notifications.push({id:b.guid(),type:"condition-save",data:a,combatant:t});break;case"combatant":if(e&&(a.duration.combatantID===e.id||null===a.duration.combatantID)&&"start"===a.duration.point){var r=t.conditions.indexOf(a);t.conditions.splice(r,1),n.notifications.push({id:b.guid(),type:"condition-end",data:a,combatant:t})}break;case"rounds":if(e&&t.id===e.id&&(a.duration.count-=1),0===a.duration.count){var s=t.conditions.indexOf(a);t.conditions.splice(s,1),n&&n.notifications.push({id:b.guid(),type:"condition-end",data:a,combatant:t})}}}))})),e&&"monster"===e.type&&(e.traits.filter((function(e){return e.uses>0&&e.usage.toLowerCase().startsWith("recharge ")})).forEach((function(t){n.notifications.push({id:b.guid(),type:"trait-recharge",data:t,combatant:e})})),e.traits.filter((function(e){return"legendary"===e.type||"mythic"===e.type})).forEach((function(e){e.uses=0}))),n.combatants.forEach((function(e){e.current=!1})),e&&(e.current=!0,"pc"===e.type)){var r=y.createCombatReportEntry();r.type="turn-start",r.combatantID=e.id,n.report.push(r)}t&&(n.round+=1),this.setState({combats:this.state.combats})}}},{key:"makeActive",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=e.some((function(e){return e.pending}));e.forEach((function(e){e.pending=!1,e.active=!0,e.defeated=!1})),n&&P.sortCombatants(a),this.setState({combats:this.state.combats})}}},{key:"makeDefeated",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=a.combatants.find((function(e){return e.current}));e.forEach((function(e){if(e.pending=!1,e.active=!1,e.defeated=!0,e.mountID=null,e.mountType="controlled",a.combatants.forEach((function(t){t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")})),a.combatants.forEach((function(t){t.tags=t.tags.filter((function(t){return t!=="engaged:"+e.displayName}))})),a.map&&(a.map.items=a.map.items.filter((function(t){return t.id!==e.id}))),n&&"pc"===n.type&&"monster"===e.type){var t=y.createCombatReportEntry();t.type="kill",t.combatantID=n.id,a.report.push(t)}})),n&&e.find((function(e){return e.id===n.id}))?this.endTurn(n):this.setState({combats:this.state.combats})}}},{key:"useTrait",value:function(e,t){t.uses+=1,this.setState({combats:this.state.combats})}},{key:"rechargeTrait",value:function(e,t){t.uses=0,this.setState({combats:this.state.combats})}},{key:"removeCombatants",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(e.forEach((function(e){var t=a.combatants.indexOf(e);if(a.combatants.splice(t,1),a.combatants.forEach((function(t){t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")})),a.combatants.forEach((function(t){t.tags=t.tags.filter((function(t){return t!=="engaged:"+e.displayName}))})),a.map){var n=a.map.items.find((function(t){return t.id===e.id}));if(n){var r=a.map.items.indexOf(n);a.map.items.splice(r,1)}}})),this.setState({combats:this.state.combats}))}},{key:"endTurn",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){if("pc"===e.type){var n=y.createCombatReportEntry();n.type="turn-end",n.combatantID=e.id,a.report.push(n)}a.combatants.filter((function(e){return e.conditions})).forEach((function(t){t.conditions.forEach((function(n){if(n.duration)switch(n.duration.type){case"saves":if(t.id===e.id&&"end"===n.duration.point){var r=y.createNotification();r.type="condition-save",r.data=n,r.combatant=t,a.notifications.push(r)}break;case"combatant":if((n.duration.combatantID===e.id||null===n.duration.combatantID)&&"end"===n.duration.point){var s=t.conditions.indexOf(n);t.conditions.splice(s,1);var i=y.createNotification();i.type="condition-end",i.data=n,i.combatant=t,a.notifications.push(i)}}}))}));var r=a.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),s=a.combatants.filter((function(e){return!r.includes(e.id)})).filter((function(e){return e.current||!e.pending&&e.active&&!e.defeated})).filter((function(e){return"placeholder"!==e.type||P.combatHasLairActions(a)}));if(0===s.length)this.makeCurrent(null,!1);else if(1===s.length&&s[0].defeated)this.makeCurrent(null,!1);else{var i=s.indexOf(e)+1,o=!1;i>=s.length&&(i=0,o=!0),this.makeCurrent(s[i],o)}}}},{key:"changeHP",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(e.forEach((function(e){var t=a.combatants.find((function(t){return t.id===e.id}));t&&(t.hpCurrent=e.hp,t.hpTemp=e.temp);var n=a.combatants.find((function(e){return e.current}));if(n&&"pc"===n.type){var r=y.createCombatReportEntry();r.type="damage",r.combatantID=n.id,r.value=e.damage,a.report.push(r)}})),this.setState({combats:this.state.combats}))}},{key:"scatterCombatants",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));n&&n.map&&(T.scatterCombatants(n,e,t),this.setMountPositions(n.combatants,n.map),this.setState({combats:this.state.combats}))}},{key:"setFog",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(a.fog=e,this.setState({combats:this.state.combats}))}},{key:"addMapItem",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&a.map&&(a.map.items.push(e),this.setState({combats:this.state.combats}))}},{key:"closeNotification",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(n){var r=n.notifications.indexOf(e);if(n.notifications.splice(r,1),t&&e.combatant&&e.data){var s=e.combatant.conditions.indexOf(e.data);e.combatant.conditions.splice(s,1)}this.setState({combats:this.state.combats})}}},{key:"showLeaderboard",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));t&&this.setState({drawer:{type:"leaderboard",combat:t}})}},{key:"toggleTag",value:function(e,t){e.forEach((function(e){e.tags.includes(t)?e.tags=e.tags.filter((function(e){return e!==t})):e.tags.push(t)})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"toggleCondition",value:function(e,t){var a=this;e.forEach((function(e){var n=e.conditions.find((function(e){return e.name===t}));if(n)a.removeCondition(e,n);else{var r=y.createCondition();if(r.name=t,e.conditions.push(r),e.conditions=b.sort(e.conditions,[{field:"name",dir:"asc"}]),"encounters"===a.state.view){var s=a.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(s){var i=s.combatants.find((function(e){return e.current}));if(i&&"pc"===i.type){var o=y.createCombatReportEntry();o.type="condition-add",o.combatantID=i.id,s.report.push(o)}}}}})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"toggleHidden",value:function(e){e.forEach((function(e){e.showOnMap=!e.showOnMap})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"addCondition",value:function(e,t){var a=y.createCondition();a.name="blinded",this.setState({drawer:{type:"condition-add",condition:a,combatants:e,allCombatants:t}})}},{key:"addConditionFromModal",value:function(){var e=this;this.state.drawer.combatants.forEach((function(t){var a=JSON.parse(JSON.stringify(e.state.drawer.condition));if(a.id=b.guid(),t.conditions.push(a),b.sort(t.conditions,[{field:"name",dir:"asc"}]),"encounters"===e.state.view){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(n){var r=n.combatants.find((function(e){return e.current}));if(r&&"pc"===r.type){var s=y.createCombatReportEntry();s.type="condition-add",s.combatantID=r.id,n.report.push(s)}}}})),this.setState({combats:this.state.combats,explorations:this.state.explorations,drawer:null})}},{key:"editCondition",value:function(e,t,a){this.setState({drawer:{type:"condition-edit",condition:t,combatants:[e],allCombatants:a}})}},{key:"editConditionFromModal",value:function(){var e=this;this.state.drawer.combatants.forEach((function(t){var a=t.conditions.find((function(t){return t.id===e.state.drawer.condition.id}));if(a){var n=t.conditions.indexOf(a);t.conditions[n]=e.state.drawer.condition,b.sort(t.conditions,[{field:"name",dir:"asc"}])}})),this.setState({combats:this.state.combats,explorations:this.state.explorations,drawer:null})}},{key:"removeCondition",value:function(e,t){var a=this,n=e.conditions.indexOf(t);if(e.conditions.splice(n,1),"encounters"===this.state.view){var r=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(r){var s=r.combatants.find((function(e){return e.current}));if(s&&"pc"===s.type){var i=y.createCombatReportEntry();i.type="condition-remove",i.combatantID=s.id,r.report.push(i)}}}this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"rotateMap",value:function(e){T.rotateMap(e),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"mapAdd",value:function(e,t,a,n,r){var s=this.getMountsAndRiders([e.id],n);if(r){var i=s.map((function(e){return e.id}));r.items=r.items.filter((function(e){return!i.includes(e.id)}))}s.forEach((function(e){var n=y.createMapItem();n.id=e.id,n.type=e.type,n.x=t,n.y=a;var s=k.miniSize(e.displaySize);n.height=s,n.width=s,r&&r.items.push(n)})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"mapMove",value:function(e,t,a,n){var r=this,s=this.getMountsAndRiders(e,a).map((function(e){return e.id}));e.forEach((function(e){s.includes(e)||s.push(e)})),s.forEach((function(e){if(n){var a=n.items.find((function(t){return t.id===e}));if(a){switch(t){case"N":a.y-=1;break;case"NE":a.x+=1,a.y-=1;break;case"E":a.x+=1;break;case"SE":a.x+=1,a.y+=1;break;case"S":a.y+=1;break;case"SW":a.x-=1,a.y+=1;break;case"W":a.x-=1;break;case"NW":a.x-=1,a.y-=1}if("encounters"===r.state.view){var s=r.state.combats.find((function(e){return e.id===r.state.selectedCombatID}));if(s&&"pc"===a.type){var i=y.createCombatReportEntry();i.type="movement",i.combatantID=a.id,s.report.push(i)}}}}})),this.setMountPositions(a,n),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"mapRemove",value:function(e,t,a){var n=this.getMountsAndRiders(e,t).map((function(e){return e.id}));e.forEach((function(e){n.includes(e)||n.push(e)})),n.forEach((function(e){var t=a.items.find((function(t){return t.id===e}));if(t){var n=a.items.indexOf(t);a.items.splice(n,1)}})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"setAltitude",value:function(e,t,a){this.getMountsAndRiders([e.id],a).forEach((function(e){return e.altitude=t})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"getMountsAndRiders",value:function(e,t){var a=e.map((function(e){return t.find((function(t){return t.id===e}))})).filter((function(e){return void 0!==e})),n=a.map((function(e){return t.find((function(t){return t.id===e.mountID}))})).filter((function(e){return void 0!==e})),r=a.map((function(e){return t.find((function(t){return t.mountID===e.id}))})).filter((function(e){return void 0!==e}));return a.concat(n).concat(r)}},{key:"setMountPositions",value:function(e,t){e.forEach((function(e){if(e.mountID){var a=t.items.find((function(t){return t.id===e.id})),n=t.items.find((function(t){return t.id===e.mountID}));a&&n&&(n.x=a.x,n.y=a.y)}}))}},{key:"save",value:function(){switch(this.state.view){case"parties":this.saveKey(this.state.parties,"data-parties");break;case"library":this.saveKey(this.state.library,"data-library");break;case"encounters":this.saveKey(this.state.encounters,"data-encounters"),this.saveKey(this.state.combats,"data-combats");break;case"maps":this.saveKey(this.state.maps,"data-maps"),this.saveKey(this.state.explorations,"data-explorations")}}},{key:"saveAll",value:function(){this.saveKey(this.state.parties,"data-parties"),this.saveKey(this.state.library,"data-library"),this.saveKey(this.state.encounters,"data-encounters"),this.saveKey(this.state.maps,"data-maps"),this.saveKey(this.state.combats,"data-combats"),this.saveKey(this.state.explorations,"data-explorations")}},{key:"saveKey",value:function(e,t){try{var a=JSON.stringify(e);console.info("Saving ("+t+"): "+b.toData(a.length)),window.localStorage.setItem(t,a)}catch(n){console.error("Could not stringify data: ",n)}}},{key:"getBreadcrumbs",value:function(){var e=this,t=[];switch(t.push({id:"home",text:"dojo",onClick:function(){return e.setView("home")}}),this.state.view){case"parties":if(t.push({id:"parties",text:"pcs",onClick:function(){return e.selectPartyByID(null)}}),this.state.selectedPartyID){var a=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));t.push({id:a.id,text:a.name||"unnamed party",onClick:function(){return e.selectPartyByID(e.state.selectedPartyID)}})}break;case"library":if(t.push({id:"library",text:"monsters",onClick:function(){return e.selectMonsterGroupByID(null)}}),this.state.selectedMonsterGroupID){var n=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));t.push({id:n.id,text:n.name||"unnamed group",onClick:function(){return e.selectMonsterGroupByID(e.state.selectedMonsterGroupID)}})}break;case"encounters":if(t.push({id:"encounters",text:"encounters",onClick:function(){return e.selectEncounterByID(null)}}),this.state.selectedEncounterID){var r=this.state.encounters.find((function(t){return t.id===e.state.selectedEncounterID}));t.push({id:r.id,text:r.name||"unnamed encounter",onClick:function(){return e.selectEncounterByID(e.state.selectedEncounterID)}})}if(this.state.selectedCombatID){var s=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));t.push({id:s.id,text:s.name||"unnamed combat",onClick:function(){return e.selectCombatByID(e.state.selectedCombatID)}})}break;case"maps":if(t.push({id:"maps",text:"maps",onClick:function(){return e.selectMapByID(null)}}),this.state.selectedMapID){var i=this.state.maps.find((function(t){return t.id===e.state.selectedMapID}));t.push({id:i.id,text:i.name||"unnamed map",onClick:function(){return e.selectMapByID(e.state.selectedMapID)}})}if(this.state.selectedExplorationID){var o=this.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));t.push({id:o.id,text:o.name||"unnamed exploration",onClick:function(){return e.selectExplorationByID(e.state.selectedExplorationID)}})}}return t}},{key:"getContent",value:function(){var e=this,t=!1;this.state.parties.forEach((function(e){return t=t||e.pcs.length>0}));var a=!1;switch(this.state.library.forEach((function(e){return a=a||e.monsters.length>0})),this.state.view){case"home":return r.a.createElement(pn,null);case"parties":return this.state.selectedPartyID?r.a.createElement(Nn,{party:this.state.parties.find((function(t){return t.id===e.state.selectedPartyID})),goBack:function(){return e.selectParty(null)},removeParty:function(){return e.removeCurrentParty()},addPC:function(){return e.editPC(null)},importPC:function(){return e.importPC()},editPC:function(t){return e.editPC(t)},updatePC:function(t){return e.updatePC(t)},removePC:function(t){return e.removePC(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}):r.a.createElement(wn,{parties:this.state.parties,encounters:this.state.encounters,addParty:function(){return e.addParty()},importParty:function(){return e.importParty()},selectParty:function(t){return e.selectParty(t)},deleteParty:function(t){return e.removeParty(t)},runEncounter:function(t,a){var n=e.state.encounters.find((function(e){return e.id===a}));n&&e.createCombat(n,t.id)},showReference:function(t){return e.showPartyReference(t)},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})}});case"library":return this.state.selectedMonsterGroupID?r.a.createElement(yn,{monsterGroup:this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID})),library:this.state.library,encounters:this.state.encounters,goBack:function(){return e.selectMonsterGroup(null)},removeMonsterGroup:function(){return e.removeCurrentMonsterGroup()},openDemographics:function(t){return e.openDemographics(t)},addMonster:function(t){return e.addMonster(t)},importMonster:function(){return e.importMonster()},removeMonster:function(t){return e.removeMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},viewMonster:function(t){return e.setState({drawer:{type:"statblock",source:t}})},editMonster:function(t){return e.editMonster(t)},cloneMonster:function(t,a){return e.cloneMonster(t,a)},moveToGroup:function(t,a){return e.moveToGroup(t,a)}}):r.a.createElement(bn,{library:this.state.library,hasMonsters:a,addMonsterGroup:function(){return e.addMonsterGroup()},importMonsterGroup:function(){return e.importMonsterGroup()},selectMonsterGroup:function(t){return e.selectMonsterGroup(t)},deleteMonsterGroup:function(t){return e.removeMonsterGroup(t)},addOpenGameContent:function(){return e.addOpenGameContent()},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})},openDemographics:function(t){return e.openDemographics(t)}});case"encounters":return this.state.selectedCombatID?r.a.createElement(en,{combat:this.state.combats.find((function(t){return t.id===e.state.selectedCombatID})),parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,pauseCombat:function(){return e.pauseCombat()},endCombat:function(t,a){return e.endCombat(t,a)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},makeCurrent:function(t){return e.makeCurrent(t,!1)},makeActive:function(t){return e.makeActive(t)},makeDefeated:function(t){return e.makeDefeated(t)},useTrait:function(t,a){return e.useTrait(t,a)},rechargeTrait:function(t,a){return e.rechargeTrait(t,a)},removeCombatants:function(t){return e.removeCombatants(t)},addCombatants:function(){return e.openAddCombatantModal()},addCompanion:function(t){return e.addCompanionToEncounter(t)},addPC:function(t,a){return e.addPCToEncounter(t,a)},addWave:function(){return e.openAddWaveModal()},addCondition:function(t){var a=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.addCondition(t,a.combatants)},editCondition:function(t,a){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.editCondition(t,a,n.combatants)},removeCondition:function(t,a){return e.removeCondition(t,a)},mapAdd:function(t,a,n){var r=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.mapAdd(t,a,n,r.combatants,r.map)},mapMove:function(t,a){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.mapMove(t,a,n.combatants,n.map)},mapRemove:function(t){var a=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.mapRemove(t,a.combatants,a.map)},onChangeAltitude:function(t,a){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.setAltitude(t,a,n.combatants)},endTurn:function(t){return e.endTurn(t)},changeHP:function(t){return e.changeHP(t)},closeNotification:function(t,a){return e.closeNotification(t,a)},toggleTag:function(t,a){return e.toggleTag(t,a)},toggleCondition:function(t,a){return e.toggleCondition(t,a)},toggleHidden:function(t){return e.toggleHidden(t)},scatterCombatants:function(t,a){return e.scatterCombatants(t,a)},rotateMap:function(){var t=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.rotateMap(t.map)},setFog:function(t){return e.setFog(t)},addOverlay:function(t){return e.addMapItem(t)},showLeaderboard:function(){return e.showLeaderboard()},onRollDice:function(t,a,n){return e.setDice(t,a,n)}}):this.state.selectedEncounterID?r.a.createElement(cn,{encounter:this.state.encounters.find((function(t){return t.id===e.state.selectedEncounterID})),parties:this.state.parties,edit:function(t){return e.editEncounter(t)},delete:function(t){return e.removeEncounter(t)},run:function(t,a){return e.createCombat(t,a)},getMonster:function(t){return e.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},goBack:function(){return e.selectEncounter(null)}}):r.a.createElement(sn,{encounters:this.state.encounters,combats:this.state.combats,parties:this.state.parties,hasMonsters:a,addEncounter:function(t){return e.addEncounter(t)},viewEncounter:function(t){return e.selectEncounter(t)},editEncounter:function(t){return e.editEncounter(t)},cloneEncounter:function(t,a){return e.cloneEncounter(t,a)},deleteEncounter:function(t){return e.removeEncounter(t)},runEncounter:function(t,a){return e.createCombat(t,a)},getMonster:function(t){return e.getMonster(t)},setView:function(t){return e.setView(t)},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})},resumeCombat:function(t){return e.resumeCombat(t)},deleteCombat:function(t){return e.endCombat(t)}});case"maps":return this.state.selectedExplorationID?r.a.createElement(un,{exploration:this.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID})),startCombat:function(t){return e.createCombat(null,t.partyID,t.map,t.fog,t.combatants)},toggleTag:function(t,a){return e.toggleTag(t,a)},toggleCondition:function(t,a){return e.toggleCondition(t,a)},toggleHidden:function(t){return e.toggleHidden(t)},addCondition:function(t){var a=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.addCondition(t,a.combatants)},editCondition:function(t,a){var n=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.editCondition(t,a,n.combatants)},removeCondition:function(t,a){return e.removeCondition(t,a)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},fillFog:function(){return e.fillFog()},clearFog:function(){return e.clearFog()},toggleFog:function(t,a,n,r){return e.toggleFog(t,a,n,r)},addCompanion:function(t){return e.addCompanionToExploration(t)},mapAdd:function(t,a,n){var r=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.mapAdd(t,a,n,r.combatants,r.map)},mapMove:function(t,a){var n=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.mapMove(t,a,n.combatants,n.map)},mapRemove:function(t){var a=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.mapRemove(t,a.combatants,a.map)},onChangeAltitude:function(t,a){var n=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.setAltitude(t,a,n.combatants)},rotateMap:function(){var t=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.rotateMap(t.map)},getMonster:function(t){return e.getMonster(t)},pauseExploration:function(){return e.pauseExploration()},endExploration:function(t){return e.endExploration(t)}}):this.state.selectedMapID?r.a.createElement(vn,{map:this.state.maps.find((function(t){return t.id===e.state.selectedMapID})),parties:this.state.parties,edit:function(t){return e.editMap(t)},delete:function(t){return e.removeMap(t)},startExploration:function(t,a){return e.startExploration(t,a)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},goBack:function(){return e.selectMap(null)}}):r.a.createElement(fn,{maps:this.state.maps,parties:this.state.parties,explorations:this.state.explorations,addMap:function(){return e.editMap(null)},importMap:function(){return e.importMap()},generateMap:function(t){return e.generateMap(t)},viewMap:function(t){return e.selectMap(t)},editMap:function(t){return e.editMap(t)},cloneMap:function(t,a){return e.cloneMap(t,a)},deleteMap:function(t){return e.removeMap(t)},explore:function(t,a){return e.startExploration(t,a)},resumeExploration:function(t){return e.resumeExploration(t)},deleteExploration:function(t){return e.endExploration(t)}})}return null}},{key:"getDrawer",value:function(){var e=this,t=null,a=null,n=null,s="50%",i=!1;if(this.state.drawer)switch(this.state.drawer.type){case"statblock":t=r.a.createElement(Ke,{source:this.state.drawer.source}),a="statblock",i=!0;break;case"import-party":t=r.a.createElement(Dt,{party:this.state.drawer.party}),a="import party",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedParty()}},"accept party"),i=!0;break;case"pc":t=r.a.createElement(xt,{pc:this.state.drawer.pc,library:this.state.library}),a="pc editor",n=r.a.createElement(d.a,{gutter:20},r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.savePC()}},"save changes")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes")));break;case"import-pc":t=r.a.createElement(jt,{pc:this.state.drawer.pc}),a="import pc",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedPC()}},"accept pc"),i=!0;break;case"update-pc":t=r.a.createElement(jt,{pc:this.state.drawer.pc}),a="update pc",n=r.a.createElement("button",{onClick:function(){return e.savePC()}},"accept pc"),i=!0;break;case"import-group":t=r.a.createElement(Mt,{group:this.state.drawer.group}),a="import monster group",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedGroup()}},"accept group"),i=!0;break;case"monster":t=r.a.createElement(vt,{monster:this.state.drawer.monster,library:this.state.library,showSidebar:this.state.drawer.showSidebar}),a="monster editor",n=r.a.createElement(d.a,{gutter:20},r.a.createElement(h.a,{span:6},r.a.createElement("button",{onClick:function(){return e.saveMonster()}},"save changes")),r.a.createElement(h.a,{span:6},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes")),r.a.createElement(h.a,{span:12},r.a.createElement(A,{label:"advanced tools",checked:this.state.drawer.showSidebar,onChecked:function(){return e.toggleShowSidebar()}}))),s="85%";break;case"import-monster":t=r.a.createElement(It,{monster:this.state.drawer.monster}),a="import monster",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedMonster()}},"accept monster"),i=!0;break;case"monster-demographics":t=r.a.createElement(ze,{groups:this.state.drawer.group?[this.state.drawer.group]:this.state.library}),a="demographics",i=!0;break;case"encounter-edit":t=r.a.createElement(Ze,{encounter:this.state.drawer.encounter,parties:this.state.parties,library:this.state.library,getMonster:function(t){return e.getMonster(t)}}),a="encounter editor",n=r.a.createElement(d.a,{gutter:20},r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.saveEncounter()}},"save changes")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="75%";break;case"map-edit":t=r.a.createElement(mt,{map:this.state.drawer.map}),a="map editor",n=r.a.createElement(d.a,{gutter:20},r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.saveMap()}},"save changes")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="85%";break;case"import-map":t=r.a.createElement(St,{map:this.state.drawer.map}),a="import map",n=r.a.createElement(d.a,{gutter:20},r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.acceptImportedMap()}},"save changes")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.declineImportedMap()}},"discard changes"))),s="75%",i=!1;break;case"combat-start":t=r.a.createElement(Ce,{type:"start",combatSetup:this.state.drawer.combatSetup,parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,getMonster:function(t){return e.getMonster(t)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="start combat",n=r.a.createElement("button",{className:this.state.drawer.combatSetup.party&&this.state.drawer.combatSetup.encounter?"":"disabled",onClick:function(){return e.startCombat()}},"start combat"),s="75%",i=!0;break;case"combat-wave":t=r.a.createElement(Ce,{type:"add-wave",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:function(t){return e.getMonster(t)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="add a wave",n=r.a.createElement("button",{className:null!==this.state.drawer.combatSetup.waveID?"":"disabled",onClick:function(){return e.addWaveToCombat()}},"add wave"),s="75%",i=!0;break;case"combat-add-combatants":t=r.a.createElement(Ce,{type:"add-combatants",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:function(t){return e.getMonster(t)},addMonster:function(t){return e.addMonsterToAddCombatantsModal(t)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="add combatants",n=r.a.createElement("button",{className:null!==this.state.drawer.combatSetup.encounter?"":"disabled",onClick:function(){return e.addCombatantsToCombat()}},"add combatants"),s="75%",i=!0;break;case"condition-add":t=r.a.createElement(Ae,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="add a condition",n=r.a.createElement("button",{onClick:function(){return e.addConditionFromModal()}},"add"),s="75%",i=!0;break;case"condition-edit":t=r.a.createElement(Ae,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="edit condition",n=r.a.createElement(d.a,{gutter:20},r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.editConditionFromModal()}},"save changes")),r.a.createElement(h.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="75%";break;case"leaderboard":t=r.a.createElement(Tt,{combat:this.state.drawer.combat}),a="leaderboard",i=!0}return{content:t,header:a,footer:n,width:s,closable:i}}},{key:"render",value:function(){var e=this;try{var t=this.getDrawer(),a=this.getBreadcrumbs();return r.a.createElement("div",{className:"dojo"},r.a.createElement("div",{className:this.state.sidebar.visible?"app with-sidebar":"app"},r.a.createElement(Vt,null,r.a.createElement(zt,{breadcrumbs:a,sidebarVisible:this.state.sidebar.visible,onToggleSidebar:function(){return e.toggleSidebar()}})),r.a.createElement(Vt,null,r.a.createElement("div",{className:"page-content"},this.getContent())),r.a.createElement(Vt,null,r.a.createElement(Pt,{view:this.state.view,onSelectView:function(t){return e.setView(t)}}))),r.a.createElement(Vt,null,r.a.createElement(Fa,{sidebar:this.state.sidebar,parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,combats:this.state.combats,onSelectSidebar:function(t){return e.setSidebar(t)},onUpdateSidebar:function(t){return e.setState({sidebar:t})},onResetAll:function(){return e.resetAll()},selectParty:function(t){return e.selectPartyByID(t)},selectMonsterGroup:function(t){return e.selectMonsterGroupByID(t)},selectEncounter:function(t){return e.selectEncounterByID(t)},selectMap:function(t){return e.selectMapByID(t)}})),r.a.createElement(Vt,null,r.a.createElement(f.a,{closable:!1,maskClosable:t.closable,width:t.width,visible:null!==t.content,onClose:function(){return e.closeDrawer()}},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},t.header)),r.a.createElement("div",{className:"drawer-content"},t.content),r.a.createElement("div",{className:"drawer-footer"},t.footer))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Sn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{return r.a.createElement("div",{className:"dojo"},r.a.createElement("div",{className:"app"},r.a.createElement(Vt,null,r.a.createElement(zt,{breadcrumbs:[{id:"home",text:"dojo - player",onClick:function(){return null}}]})),r.a.createElement(Vt,null,r.a.createElement("div",{className:"page-content player"},r.a.createElement(wa,{type:"player"})))))}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Mn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(m.a,null,r.a.createElement(p.c,null,r.a.createElement(p.a,{path:"/player"},r.a.createElement(Sn,null)),r.a.createElement(p.a,null,r.a.createElement(xn,null))))}}]),a}(r.a.Component);fa.init(),i.a.render(r.a.createElement(Mn,null),document.getElementById("root"))}},[[130,1,2]]]);