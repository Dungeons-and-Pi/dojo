(this.webpackJsonpdojo=this.webpackJsonpdojo||[]).push([[0],{145:function(e){e.exports=JSON.parse('{"name":"dojo","version":"10.9.16","license":"MIT","repository":"https://github.com/andyaiken/dojo.git","homepage":"https://andyaiken.github.io/dojo/","dependencies":{"@ant-design/icons":"^4.2.2","antd":"^4.6.6","lz-string":"^1.4.4","mousetrap":"^1.6.5","peerjs":"^1.3.1","react":"^16.13.1","react-debounce-input":"^3.2.2","react-dom":"^16.13.1","react-movable":"^2.5.1","react-pdf":"^5.0.0","react-router-dom":"^5.2.0","recursive-diff":"^1.0.8","showdown":"^1.9.1","uuid":"^8.3.1"},"devDependencies":{"@types/lz-string":"^1.3.34","@types/mousetrap":"^1.6.4","@types/react":"^16.9.51","@types/react-dom":"^16.9.8","@types/react-pdf":"^4.0.6","@types/react-router-dom":"^5.1.6","@types/showdown":"^1.9.3","@types/uuid":"^8.3.0","gh-pages":"^2.2.0","node-sass":"^4.14.0","react-scripts":"^3.4.3","tslint":"^5.20.1","tslint-microsoft-contrib":"^6.2.0","tslint-react":"^3.6.0","typescript":"^3.9.7"},"scripts":{"update":"npm update && npm update --save-dev && npm audit fix","start":"react-scripts start --display-error-details","lint":"tslint --config tslint.json --format verbose \'src/**/*.{ts,tsx}\'","predeploy":"react-scripts build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":["eslint-recommended","react-app"]},"browserslist":[">0.2%","not dead","not ie <= 11","not op_mini all"]}')},155:function(e,t,a){e.exports=a(262)},160:function(e,t,a){},161:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=161},241:function(e,t){},242:function(e,t){},243:function(e,t){},244:function(e,t){},245:function(e,t){},262:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(21),o=a.n(s),i=(a(160),a(1)),c=a(2),l=a(4),u=a(3),d=a(150),m=a(29),p=a(298),h=a(269),f=a(272),v=a(296),g=a(271),y=a(101),b=a.n(y),E=a(270),k=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"guid",value:function(){return Object(E.a)()}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===t.length&&(t=[{field:"name",dir:"asc"}]);var a=function(e,t,a){if(void 0!==e[a]&&void 0!==t[a]){if(e[a]<t[a])return-1;if(e[a]>t[a])return 1}return 0};return e.sort((function(e,n){var r=0;return t.forEach((function(t){0===r&&(r=a(e,n,t.field)*("asc"===t.dir?1:-1))})),r})),e}},{key:"debounce",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){clearTimeout(t),t=setTimeout(e,a)}}},{key:"toData",value:function(e){var t=e/1073741824;if(t>=1)return t.toFixed(2)+" GB";var a=e/1048576;if(a>=1)return a.toFixed(2)+" MB";var n=e/1024;return n>=1?n.toFixed(2)+" KB":e+" B"}},{key:"saveFile",value:function(e,t){var a=JSON.stringify(t,null,"\t"),n=new Blob([a],{type:"application/json"}),r=document.createElement("a");r.download=e,r.href=window.URL.createObjectURL(n),r.click()}},{key:"randomNumber",value:function(e){return e<=0?0:Math.floor(Math.random()*e)}},{key:"randomBoolean",value:function(){return 0===e.randomNumber(2)}},{key:"randomDecimal",value:function(){return e.randomNumber(100)/100}}]),e}(),w=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"createParty",value:function(){return{id:k.guid(),name:"",pcs:[]}}},{key:"createPC",value:function(){return{id:k.guid(),type:"pc",active:!0,player:"",name:"",size:"medium",race:"",classes:"",level:1,languages:"Common",passiveInsight:10,passiveInvestigation:10,passivePerception:10,portrait:"",url:"",companions:[]}}},{key:"createCompanion",value:function(){return{id:k.guid(),name:"",monsterID:null}}},{key:"createMonsterGroup",value:function(){return{id:k.guid(),name:"",monsters:[]}}},{key:"createMonster",value:function(){return{id:k.guid(),type:"monster",name:"",size:"medium",role:"",category:"humanoid",tag:"",alignment:"",challenge:1,abilityScores:{str:10,dex:10,con:10,int:10,wis:10,cha:10},ac:10,acInfo:"",hitDice:1,damage:{resist:"",vulnerable:"",immune:""},savingThrows:"",speed:"",skills:"",senses:"",languages:"",equipment:"",traits:[],conditionImmunities:"",portrait:"",legendaryActions:0}}},{key:"createTrait",value:function(){return{id:k.guid(),name:"",usage:"",type:"action",text:"",uses:0}}},{key:"createEncounter",value:function(){return{id:k.guid(),name:"",slots:[],waves:[],notes:""}}},{key:"createEncounterSlot",value:function(){return{id:k.guid(),monsterID:"",roles:[],count:1,faction:"foe"}}},{key:"createEncounterWave",value:function(){return{id:k.guid(),name:"",slots:[]}}},{key:"createMonsterFilter",value:function(){return{name:"",challengeMin:0,challengeMax:5,category:"all types",size:"all sizes",role:"all roles"}}},{key:"createMap",value:function(){return{id:k.guid(),name:"",items:[],areas:[]}}},{key:"createMapItem",value:function(){return{id:k.guid(),type:"tile",x:0,y:0,width:4,height:4,terrain:"",customBackground:"",content:null,size:"medium",color:"",opacity:255,style:null}}},{key:"createMapArea",value:function(){return{id:k.guid(),name:"",text:"",x:0,y:0,width:1,height:1}}},{key:"createExploration",value:function(){return{id:k.guid(),name:"",map:this.createMap(),partyID:"",fog:[],combatants:[]}}},{key:"createCombatSetup",value:function(){return{party:null,encounter:null,waveID:null,map:null,fog:[],combatants:[],slotInfo:[]}}},{key:"createCombatSlotInfo",value:function(){return{id:"",useGroupHP:!0,useGroupInit:!0,hp:0,init:0,members:[]}}},{key:"createCombatSlotMember",value:function(){return{id:k.guid(),name:"",hp:0,init:0}}},{key:"createCombat",value:function(){return{id:k.guid(),name:"",encounter:e.createEncounter(),combatants:[],map:null,fog:[],round:1,issues:[]}}},{key:"createNotification",value:function(){return{id:k.guid(),type:"condition-save",data:null,combatant:null}}},{key:"createCondition",value:function(){return{id:k.guid(),name:"",level:1,text:"",duration:null}}},{key:"createConditionDurationSaves",value:function(){return{type:"saves",count:1,saveType:"str",saveDC:10,point:"start"}}},{key:"createConditionDurationCombatant",value:function(){return{type:"combatant",point:"start",combatantID:null}}},{key:"createConditionDurationRounds",value:function(){return{type:"rounds",count:1}}}]),e}(),N=a(28),C=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"modifierValue",value:function(e){return Math.floor((e-10)/2)}},{key:"modifier",value:function(e){var t=this.modifierValue(e),a=t.toString();return t>=0&&(a="+"+a),a}},{key:"dieRoll",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=0,n=0;n!==t;++n)a+=k.randomNumber(e)+1;return a}},{key:"rollDice",value:function(t,a,n){var r={id:k.guid(),rolls:[],constant:a,mode:n};return[4,6,8,10,12,20,100].forEach((function(a){for(var n=t[a],s=0;s!==n;++s){var o=e.dieRoll(a);switch(r.mode){case"advantage":o=Math.max(o,e.dieRoll(a));break;case"disadvantage":o=Math.min(o,e.dieRoll(a))}r.rolls.push({id:k.guid(),sides:a,value:o})}})),r}},{key:"miniSize",value:function(e){switch(e){case"tiny":return.4;case"small":return.6;case"medium":return 1;case"large":return 2;case"huge":return 3;case"gargantuan":return 4;default:return 1}}},{key:"hitDieType",value:function(e){switch(e){case"tiny":return 4;case"small":return 6;case"medium":return 8;case"large":return 10;case"huge":return 12;case"gargantuan":return 20;default:return 8}}},{key:"proficiency",value:function(e){return e<5?2:e<9?3:e<13?4:e<17?5:6}},{key:"challenge",value:function(e){switch(e){case.125:return"1/8";case.25:return"1/4";case.5:return"1/2";default:return e.toString()}}},{key:"parseChallenge",value:function(e){switch(e){case"1/8":return.125;case"1/4":return.25;case"1/2":return.5;default:return parseInt(e,10)}}},{key:"challengeDetails",value:function(){return[{cr:0,ac:13,hpMin:1,hpMax:6,attack:3,dmgMin:0,dmgMax:1,save:13},{cr:.125,ac:13,hpMin:7,hpMax:35,attack:3,dmgMin:2,dmgMax:3,save:13},{cr:.25,ac:13,hpMin:36,hpMax:49,attack:3,dmgMin:4,dmgMax:5,save:13},{cr:.5,ac:13,hpMin:50,hpMax:70,attack:3,dmgMin:6,dmgMax:8,save:13},{cr:1,ac:13,hpMin:71,hpMax:85,attack:3,dmgMin:9,dmgMax:14,save:13},{cr:2,ac:13,hpMin:86,hpMax:100,attack:3,dmgMin:15,dmgMax:20,save:13},{cr:3,ac:13,hpMin:101,hpMax:115,attack:4,dmgMin:21,dmgMax:26,save:13},{cr:4,ac:14,hpMin:116,hpMax:130,attack:5,dmgMin:27,dmgMax:32,save:14},{cr:5,ac:15,hpMin:131,hpMax:145,attack:6,dmgMin:33,dmgMax:38,save:15},{cr:6,ac:15,hpMin:146,hpMax:160,attack:6,dmgMin:39,dmgMax:44,save:15},{cr:7,ac:15,hpMin:161,hpMax:175,attack:6,dmgMin:45,dmgMax:50,save:15},{cr:8,ac:16,hpMin:176,hpMax:190,attack:7,dmgMin:51,dmgMax:56,save:16},{cr:9,ac:16,hpMin:191,hpMax:205,attack:7,dmgMin:57,dmgMax:62,save:16},{cr:10,ac:17,hpMin:206,hpMax:220,attack:7,dmgMin:63,dmgMax:68,save:16},{cr:11,ac:17,hpMin:221,hpMax:235,attack:8,dmgMin:69,dmgMax:74,save:17},{cr:12,ac:17,hpMin:236,hpMax:250,attack:8,dmgMin:75,dmgMax:80,save:17},{cr:13,ac:18,hpMin:251,hpMax:265,attack:8,dmgMin:81,dmgMax:86,save:18},{cr:14,ac:18,hpMin:266,hpMax:280,attack:8,dmgMin:87,dmgMax:92,save:18},{cr:15,ac:18,hpMin:281,hpMax:295,attack:8,dmgMin:93,dmgMax:98,save:18},{cr:16,ac:18,hpMin:296,hpMax:310,attack:9,dmgMin:99,dmgMax:104,save:18},{cr:17,ac:19,hpMin:311,hpMax:325,attack:10,dmgMin:105,dmgMax:110,save:19},{cr:18,ac:19,hpMin:326,hpMax:340,attack:10,dmgMin:111,dmgMax:116,save:19},{cr:19,ac:19,hpMin:341,hpMax:355,attack:10,dmgMin:117,dmgMax:122,save:19},{cr:20,ac:19,hpMin:356,hpMax:400,attack:10,dmgMin:123,dmgMax:140,save:19},{cr:21,ac:19,hpMin:401,hpMax:445,attack:11,dmgMin:141,dmgMax:158,save:20},{cr:22,ac:19,hpMin:446,hpMax:490,attack:11,dmgMin:159,dmgMax:176,save:20},{cr:23,ac:19,hpMin:491,hpMax:535,attack:11,dmgMin:177,dmgMax:194,save:20},{cr:24,ac:19,hpMin:536,hpMax:580,attack:12,dmgMin:195,dmgMax:212,save:21},{cr:25,ac:19,hpMin:581,hpMax:625,attack:12,dmgMin:213,dmgMax:230,save:21},{cr:26,ac:19,hpMin:626,hpMax:670,attack:12,dmgMin:231,dmgMax:248,save:21},{cr:27,ac:19,hpMin:671,hpMax:715,attack:13,dmgMin:249,dmgMax:266,save:22},{cr:28,ac:19,hpMin:716,hpMax:760,attack:13,dmgMin:267,dmgMax:284,save:22},{cr:29,ac:19,hpMin:761,hpMax:805,attack:13,dmgMin:285,dmgMax:302,save:22},{cr:30,ac:19,hpMin:806,hpMax:850,attack:14,dmgMin:303,dmgMax:320,save:23}]}},{key:"experience",value:function(e){switch(e){case 0:return 10;case.125:return 25;case.25:return 50;case.5:return 100;case 1:return 200;case 2:return 450;case 3:return 700;case 4:return 1100;case 5:return 1800;case 6:return 2300;case 7:return 2900;case 8:return 3900;case 9:return 5e3;case 10:return 5900;case 11:return 7200;case 12:return 8400;case 13:return 1e4;case 14:return 11500;case 15:return 13e3;case 16:return 15e3;case 17:return 18e3;case 18:return 2e4;case 19:return 22e3;case 20:return 25e3;case 21:return 33e3;case 22:return 41e3;case 23:return 5e4;case 24:return 62e3;case 30:return 155e3;default:return 0}}},{key:"experienceFactor",value:function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 1.5;case 3:case 4:case 5:case 6:return 2;case 7:case 8:case 9:case 10:return 2.5;case 11:case 12:case 13:case 14:return 3;default:return 4}}},{key:"pcExperience",value:function(e,t){switch(t){case"easy":switch(e){case 1:return 25;case 2:return 50;case 3:return 75;case 4:return 125;case 5:return 250;case 6:return 300;case 7:return 350;case 8:return 450;case 9:return 550;case 10:return 600;case 11:return 800;case 12:return 1e3;case 13:return 1100;case 14:return 1250;case 15:return 1400;case 16:return 1600;case 17:return 2e3;case 18:return 2100;case 19:return 2400;case 20:return 2800;default:return 0}case"medium":switch(e){case 1:return 50;case 2:return 100;case 3:return 150;case 4:return 250;case 5:return 500;case 6:return 600;case 7:return 750;case 8:return 900;case 9:return 1100;case 10:return 1200;case 11:return 1600;case 12:return 2e3;case 13:return 2200;case 14:return 2500;case 15:return 2800;case 16:return 3200;case 17:return 3900;case 18:return 4200;case 19:return 4900;case 20:return 5700;default:return 0}case"hard":switch(e){case 1:return 75;case 2:return 150;case 3:return 225;case 4:return 375;case 5:return 750;case 6:return 900;case 7:return 1100;case 8:return 1400;case 9:return 1600;case 10:return 1900;case 11:return 2400;case 12:return 3e3;case 13:return 3400;case 14:return 3800;case 15:return 4300;case 16:return 4800;case 17:return 5900;case 18:return 6300;case 19:return 7300;case 20:return 8500;default:return 0}case"deadly":switch(e){case 1:return 100;case 2:return 200;case 3:return 400;case 4:return 500;case 5:return 1100;case 6:return 1400;case 7:return 1700;case 8:return 2100;case 9:return 2400;case 10:return 2800;case 11:return 3600;case 12:return 4500;case 13:return 5100;case 14:return 5700;case 15:return 6400;case 16:return 7200;case 17:return 8800;case 18:return 9500;case 19:return 10900;case 20:return 12700;default:return 0}default:return 0}}},{key:"traitType",value:function(e,t){var a="";switch(e){case"trait":a="trait";break;case"action":a="action";break;case"reaction":a="reaction";break;default:a=e+" action"}return t&&(a+="s"),a}},{key:"nudgeChallenge",value:function(e,t){var a=0;switch(e){case 0:-1===t&&(a=0),1===t&&(a=.125);break;case.125:-1===t&&(a=0),1===t&&(a=.25);break;case.25:-1===t&&(a=.125),1===t&&(a=.5);break;case.5:-1===t&&(a=.25),1===t&&(a=1);break;case 1:-1===t&&(a=.5),1===t&&(a=2);break;default:a=e+t}return a}},{key:"nudgeSize",value:function(e,t){var a=["tiny","small","medium","large","huge","gargantuan"],n=a.indexOf(e)+t;return n<0&&(n=0),n>=a.length&&(n=a.length-1),a[n]}},{key:"nudgeDifficulty",value:function(e,t){var a=["easy","medium","hard","deadly"],n=a.indexOf(e)+t;return n<0&&(n=0),n>=a.length&&(n=a.length-1),a[n]}},{key:"conditionText",value:function(e){switch(e.name){case"blinded":return["a blinded creature can\u2019t see and automatically fails any ability check that requires sight","attack rolls against the creature have advantage, and the creature\u2019s attack rolls have disadvantage"];case"charmed":return["a charmed creature can\u2019t attack the charmer or target the charmer with harmful abilities or magical effects","the charmer has advantage on any ability check to interact socially with the creature"];case"deafened":return["a deafened creature can\u2019t hear and automatically fails any ability check that requires hearing."];case"exhaustion":switch(e.level){case 1:return["disadvantage on ability checks"];case 2:return["disadvantage on ability checks","speed halved"];case 3:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws"];case 4:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved"];case 5:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0"];case 6:return["disadvantage on ability checks","speed halved","disadvantage on attack rolls and saving throws","hit point maximum halved","speed reduced to 0","death"];default:return[]}case"frightened":return["a frightened creature has disadvantage on ability checks and attack rolls while the source of its fear is within line of sight","the creature can\u2019t willingly move closer to the source of its fear"];case"grappled":return["a grappled creature\u2019s speed becomes 0, and it can\u2019t benefit from any bonus to its speed","the condition ends if the grappler is incapacitated","the condition also ends if an effect removes the grappled creature from the reach of the grappler or grappling effect"];case"incapacitated":return["an incapacitated creature can\u2019t take actions or reactions","being incapacitated breaks concentration"];case"invisible":return["an invisible creature is impossible to see without the aid of magic or a special sense","for the purpose of hiding, the creature is heavily obscured","the creature\u2019s location can be detected by any noise it makes or any tracks it leaves","attack rolls against the creature have disadvantage, and the creature\u2019s attack rolls have advantage"];case"paralyzed":return["a paralyzed creature is incapacitated (can\u2019t take actions or reactions) and can\u2019t move or speak","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];case"petrified":return["a petrified creature is transformed, along with any nonmagical objects it is wearing or carrying, into a solid inanimate substance (usually stone)","its weight increases by a factor of ten, and it ceases aging","the creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move or speak, and is unaware of its surroundings","attack rolls against the creature have advantage","the creature automatically fails strength and dexterity saving throws","the creature has resistance to all damage","the creature is immune to poison and disease, although a poison or disease already in its system is suspended, not neutralized"];case"poisoned":return["a poisoned creature has disadvantage on attack rolls and ability checks"];case"prone":return["a prone creature\u2019s only movement option is to crawl, unless it stands up (using half its speed) and thereby ends the condition","the creature has disadvantage on attack rolls","an attack roll against the creature has advantage if the attacker is Within 5 feet of the creature; otherwise, the attack roll has disadvantage"];case"restrained":return["a restrained creature\u2019s speed becomes 0, and it can\u2019t benefit from any bonus to its speed","attack rolls against the creature have advantage, and the creature\u2019s attack rolls have disadvantage","the creature has disadvantage on dexterity saving throws"];case"stunned":return["a stunned creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move, and can speak only falteringly","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage"];case"unconscious":return["an unconscious creature is incapacitated (can\u2019t take actions or reactions), can\u2019t move or speak, and is unaware of its surroundings","the creature drops whatever its holding and falls prone","the creature automatically fails strength and dexterity saving throws","attack rolls against the creature have advantage","any attack that hits the creature is a critical hit if the attacker is within 5 feet of the creature"];case"custom":return[e.text];default:return[]}}},{key:"conditionDurationText",value:function(e,t){if(null!==e.duration)switch(e.duration.type){case"saves":var a=e.duration,n=a.saveType.toString();"death"!==n&&(n=n.toUpperCase());var r=a.count>1?"saves":"save";return"until they make "+a.count+" "+n+" "+r+" at dc "+a.saveDC;case"combatant":var s=e.duration,o=s.point,i=t.find((function(e){return e.id===s.combatantID}));return"until the "+o+" of "+(i?(i.displayName||i.name||"unnamed monster")+"'s":"their")+" next turn";case"rounds":var c=e.duration,l=c.count>1?"rounds":"round";return"for "+c.count+" "+l;default:return null}return null}},{key:"getCombatSlotData",value:function(e,t){var a=this,n=[];t.forEach((function(e){e.monsters.forEach((function(e){return n.push(e)}))}));var r=[];return e&&e.slots.forEach((function(e){var t=n.find((function(t){return t.id===e.monsterID}));if(t){var s=w.createCombatSlotInfo();s.id=e.id,s.init=a.dieRoll()+a.modifierValue(t.abilityScores.dex),s.hp=D.getTypicalHP(t);for(var o=0;o!==e.count;++o){var i=w.createCombatSlotMember();i.init=s.init,i.hp=s.hp,i.name=t.name,s.members.push(i)}if(e.count>1)for(var c=0;c!==e.count;++c)s.members[c].name=t.name+" "+(c+1);r.push(s)}})),r}},{key:"getTagTitle",value:function(e){if(e.startsWith("engaged"))return"engaged";switch(e){case"conc":return"concentrating";case"bane":return"affected by bane";case"bless":return"affected by bless";default:return e}}},{key:"getTagDescription",value:function(e){if(e.startsWith("engaged"))return e.split(":")[1];switch(e){case"conc":return"if damaged, must make con save (dc is half damage taken or 10, whichever is higher) or lose concentration";case"bane":return"subtract d4 from attack rolls and saving throws";case"bless":return"add d4 to attack rolls and saving throws";default:return e}}}]),e}(),S=["blinded","charmed","deafened","exhaustion","frightened","grappled","incapacitated","invisible","paralyzed","petrified","poisoned","prone","restrained","stunned","unconscious","custom"],x=["tiny","small","medium","large","huge","gargantuan"],I=["aberration","beast","celestial","construct","dragon","elemental","fey","fiend","giant","humanoid","monstrosity","ooze","plant","undead"],M=["artillery","boss","controller","skirmisher","sneak","soldier","tank"],O=["trait","action","bonus","reaction","legendary","mythic","lair"],D=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"getTypicalHP",value:function(e){var t=(C.hitDieType(e.size)+1)/2+C.modifierValue(e.abilityScores.con);return Math.floor(e.hitDice*t)}},{key:"getTypicalHPString",value:function(e){var t=C.hitDieType(e.size),a=C.modifierValue(e.abilityScores.con)*e.hitDice,n="";return a>0&&(n=" + "+a),a<0&&(n=" - "+Math.abs(a)),e.hitDice+"d"+t+n}},{key:"nudgeValue",value:function(t,a,n){var r,s=t,o=null,i=a.split(".");switch(i.forEach((function(e){e===i[i.length-1]?o=s[e]:s=s[e]})),a){case"challenge":r=C.nudgeChallenge(o,n);break;case"size":r=C.nudgeSize(o,n);break;default:r=(o||0)+n,r=Math.max(r,0)}e.changeValue(t,a,r)}},{key:"changeValue",value:function(e,t,a){var n=e,r=t.split(".");r.forEach((function(e){e===r[r.length-1]?n[e]=a:n=n[e]}))}},{key:"clear",value:function(e){e.name="",e.size="medium",e.role="",e.category="beast",e.tag="",e.alignment="",e.challenge=1,e.abilityScores.str=10,e.abilityScores.dex=10,e.abilityScores.con=10,e.abilityScores.int=10,e.abilityScores.wis=10,e.abilityScores.cha=10,e.ac=10,e.acInfo="",e.hitDice=1,e.damage.resist="",e.damage.vulnerable="",e.damage.immune="",e.savingThrows="",e.speed="",e.skills="",e.senses="",e.languages="",e.equipment="",e.traits=[],e.conditionImmunities="",e.portrait="",e.legendaryActions=0}},{key:"createFromJSON",value:function(e){var t=this,a=w.createMonster();a.type="monster",a.name=e.name,a.size=e.size.toLowerCase(),a.role="",a.category=e.type,a.tag=e.subtype,a.alignment=e.alignment,a.challenge=C.parseChallenge(e.challenge_rating),a.ac=e.armor_class,a.acInfo="",a.speed=e.speed,a.senses=e.senses,a.languages=e.languages;var n=e.hit_dice.indexOf("d");a.hitDice=parseInt(e.hit_dice.substring(0,n),10),a.abilityScores.str=e.strength,a.abilityScores.dex=e.dexterity,a.abilityScores.con=e.constitution,a.abilityScores.int=e.intelligence,a.abilityScores.wis=e.wisdom,a.abilityScores.cha=e.charisma,a.damage.resist=e.damage_resistances,a.damage.vulnerable=e.damage_vulnerabilities,a.damage.immune=e.damage_immunities,a.conditionImmunities=e.condition_immunities,a.legendaryActions=0;[{field:"strength_save",text:"Strength"},{field:"dexterity_save",text:"Dexterity"},{field:"constitution_save",text:"Constitution"},{field:"intelligence_save",text:"Intelligence"},{field:"wisdom_save",text:"Wisdom"},{field:"charisma_save",text:"Charisma"}].forEach((function(t){if(e[t.field]){var n=t.text+" "+e[t.field];a.savingThrows+=""===a.savingThrows?n:", "+n}}));return[{field:"acrobatics",text:"Acrobatics"},{field:"animal_handling",text:"Animal handling"},{field:"arcana",text:"Arcana"},{field:"athletics",text:"Athletics"},{field:"deception",text:"Deception"},{field:"history",text:"History"},{field:"insight",text:"Insight"},{field:"intimidation",text:"Intimidation"},{field:"investigation",text:"Investigation"},{field:"medicine",text:"Medicine"},{field:"nature",text:"Nature"},{field:"perception",text:"Perception"},{field:"performance",text:"Performance"},{field:"persuasion",text:"Persuasion"},{field:"religion",text:"Religion"},{field:"sleight_of_hand",text:"Sleight of hand"},{field:"stealth",text:"Stealth"},{field:"survival",text:"Survival"}].forEach((function(t){if(e[t.field]){var n=t.text+" "+e[t.field];a.skills+=""===a.skills?n:", "+n}})),e.special_abilities&&e.special_abilities.forEach((function(e){var n=t.buildTrait(e,"trait");a.traits.push(n)})),e.actions&&e.actions.forEach((function(e){var n=t.buildTrait(e,"action");a.traits.push(n)})),e.reactions&&e.reactions.forEach((function(e){var n=t.buildTrait(e,"reaction");a.traits.push(n)})),e.legendary_actions&&e.legendary_actions.forEach((function(e){var n=t.buildTrait(e,"legendary");a.traits.push(n)})),a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(a.legendaryActions=3),a.role=this.getRole(a),a}},{key:"buildTrait",value:function(e,t){var a="",n="",r=e.name.indexOf("(");if(-1===r)a=e.name;else{var s=e.name.indexOf(")");a=e.name.substring(0,r-1),n=e.name.substring(r+1,s).toLowerCase()}var o=e.desc.replace(/\u2022/g,"*"),i=t;return"Lair Actions"===a&&(i="lair"),0===o.indexOf("As a bonus action")&&(i="bonus"),{id:k.guid(),type:i,name:a,usage:n,text:o,uses:0}}},{key:"import",value:function(t,a){e.clear(a);var n=(new DOMParser).parseFromString(t,"text/html");try{a.name=n.getElementsByClassName("mon-stat-block__name")[0].innerText.trim();var r=n.getElementsByClassName("mon-stat-block__meta")[0].innerText.toLowerCase().trim(),s=r.indexOf(" ");a.size=r.substring(0,s).trim();var o=(r=r.substring(s+1).trim()).indexOf(",");a.alignment=r.substring(o+1).trim();var i=(r=r.substring(0,o).trim()).indexOf("("),c=r.indexOf(")");-1!==i&&-1!==c&&(a.tag=r.substring(i+1,c).trim(),r=r.substring(0,i).trim()),a.category=r}catch(B){console.error(B)}try{for(var l=n.getElementsByClassName("mon-stat-block__attribute"),u=0;u!==l.length;++u){var d=l[u],m=d.getElementsByClassName("mon-stat-block__attribute-label")[0].innerText.toLowerCase().trim(),p=d.getElementsByClassName("mon-stat-block__attribute-data-value")[0].innerText.toLowerCase().trim();switch(m){case"armor class":a.ac=Number.parseInt(p,10);var h=d.getElementsByClassName("mon-stat-block__attribute-data-extra")[0].innerText.toLowerCase().trim();h.startsWith("(")&&(h=h.substr(1,h.length-2)),a.acInfo=h;break;case"hit points":var f=d.getElementsByClassName("mon-stat-block__attribute-data-extra")[0].innerText.toLowerCase().trim();a.hitDice=Number.parseInt(f.substring(1,f.indexOf("d")),10);break;case"speed":a.speed=p}}}catch(B){console.error(B)}try{for(var v=n.getElementsByClassName("ability-block__stat"),g=0;g!==v.length;++g){var y=v[g],b=y.getElementsByClassName("ability-block__heading")[0].innerText.toLowerCase().trim(),E=y.getElementsByClassName("ability-block__score")[0].innerText.toLowerCase().trim(),k=Number.parseInt(E,10);a.abilityScores[b]=k}}catch(B){console.error(B)}try{for(var N=n.getElementsByClassName("mon-stat-block__tidbit"),C=0;C!==N.length;++C){var S=N[C],x=S.getElementsByClassName("mon-stat-block__tidbit-label")[0].innerText.toLowerCase().trim(),I=S.getElementsByClassName("mon-stat-block__tidbit-data")[0].innerText.toLowerCase().trim();switch(x){case"saving throws":a.savingThrows=I;break;case"skills":a.skills=I;break;case"damage vulnerabilities":a.damage.vulnerable=I;break;case"damage resistances":a.damage.resist=I;break;case"damage immunities":a.damage.immune=I;break;case"condition immunities":a.conditionImmunities=I;break;case"senses":a.senses=I;break;case"languages":a.languages=I;break;case"challenge":var M=I.indexOf(" ");a.challenge=Number.parseInt(I.substring(0,M),10)}}}catch(B){console.error(B)}try{for(var O=n.getElementsByClassName("mon-stat-block__description-block"),D=0;D!==O.length;++D){var j=O[D],T="trait",P=j.getElementsByClassName("mon-stat-block__description-block-heading");if(P.length>0)switch(P[0].innerText.toLowerCase().trim()){case"actions":T="action";break;case"bonus actions":T="bonus";break;case"reactions":T="reaction";break;case"legendary actions":T="legendary";break;case"mythic actions":T="mythic";break;case"lair actions":T="lair"}for(var V=j.getElementsByTagName("p"),A=0;A!==V.length;++A){var R=V[A].innerText.trim(),L=w.createTrait();L.type=T;var z=R.indexOf(".");L.text=R.substring(z+1).trim();var q=(R=R.substring(0,z)).indexOf("("),F=R.indexOf(")");if(-1!==q&&-1!==F&&(L.usage=R.substring(q+1,F).trim(),R=R.substring(0,q).trim()),L.name=R,L.name)a.traits.push(L);else{var G=a.traits[a.traits.length-1];G.text+="\n",G.text+=L.text}}}}catch(B){console.error(B)}a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(a.legendaryActions=3),a.role=this.getRole(a)}},{key:"copyTrait",value:function(e,t){var a=JSON.parse(JSON.stringify(t));a.id=k.guid(),a.name+=" copy",e.traits.push(a)}},{key:"addTrait",value:function(e,t){var a=w.createTrait();a.type=t,a.name="New "+C.traitType(t,!1).toLowerCase(),e.traits.push(a)}},{key:"moveTrait",value:function(e,t,a){var n,r=e.traits.splice(t,1);(n=e.traits).splice.apply(n,[a,0].concat(Object(N.a)(r)))}},{key:"removeTrait",value:function(e,t){var a=e.traits.indexOf(t);e.traits.splice(a,1)}},{key:"swapTraits",value:function(e,t,a){var n=e.traits.indexOf(t),r=e.traits.indexOf(a);e.traits[r]=t,e.traits[n]=a}},{key:"spliceMonsters",value:function(e,t){var a=this;["size","category","tag","alignment","challenge","speed","senses","languages","equipment","abilityScores.str","abilityScores.dex","abilityScores.con","abilityScores.int","abilityScores.wis","abilityScores.cha","savingThrows","skills","ac","acInfo","hitDice","damage.resist","damage.vulnerable","damage.immune","conditionImmunities"].forEach((function(n){a.setRandomValue(e,n,t)})),e.traits=[],O.forEach((function(n){var r=[];t.forEach((function(e){e.traits.filter((function(e){return e.type===n})).forEach((function(e){return r.push(e)}))}));var s=[];r.forEach((function(e){var t=s.find((function(t){return t.trait.name===e.name}));t?t.count+=1:s.push({trait:e,count:1})}));var o=[];s.filter((function(e){return e.count===t.length})).forEach((function(t){a.copyTrait(e,t.trait),o.push(t.trait.id)})),o.forEach((function(e){var t=s.findIndex((function(t){return t.trait.id===e}));s.splice(t,1)}));for(var i=r.length/t.length;e.traits.filter((function(e){return e.type===n})).length<i;){var c=k.randomNumber(s.length),l=s[c].trait;a.copyTrait(e,l),s.splice(c,1)}})),e.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&(e.legendaryActions=3),e.role=this.getRole(e)}},{key:"setRandomValue",value:function(e,t,a){var n=a[k.randomNumber(a.length)],r=null,s=t.split(".");s.forEach((function(e){e===s[s.length-1]?r=n[e]:n=n[e]})),this.changeValue(e,t,r)}},{key:"addRandomTrait",value:function(e,t,a){var n=[];a.forEach((function(e){e.traits.filter((function(e){return e.type===t})).forEach((function(e){n.push(e)}))}));var r=k.randomNumber(n.length),s=n[r];this.copyTrait(e,s)}},{key:"getToHitExpressions",value:function(e){return Array.from(e.text.matchAll(/([+-])\s*(\d+)\s*to hit/g)).map((function(e){var t=e[0],a=parseInt(e[2],10);return"-"===e[1]&&(a*=-1),{expression:t,bonus:a}}))}},{key:"getDiceExpressions",value:function(e){return Array.from(e.text.matchAll(/(\d*)[dD](\d+)\s*(([+-])\s*(\d*))?/g)).map((function(e){var t,a=e[0],n=null!==(t=parseInt(e[1],10))&&void 0!==t?t:1,r=parseInt(e[2],10),s=0;return e[3]&&e[4]&&e[5]&&(s=parseInt(e[5],10),"-"===e[4]&&(s*=-1)),{expression:a,count:n,sides:r,bonus:s}}))}},{key:"getSaveExpressions",value:function(e){return Array.from(e.text.matchAll(/(dc|DC)\s*(\d+)/g)).map((function(e){return{expression:e[0],dc:parseInt(e[2],10)}}))}},{key:"getRole",value:function(t){var a=this;if(t.legendaryActions>0)return"boss";if(t.traits.some((function(e){return e.text.toLowerCase().includes("teleport")})))return"skirmisher";var n=t.skills.toLowerCase();if(n.includes("deception")||n.includes("stealth"))return"sneak";if(t.traits.some((function(e){return e.text.toLowerCase().includes("indistinguishable")})))return"sneak";var r=C.challengeDetails().find((function(e){return e.cr===t.challenge}));if(r){if(e.getTypicalHP(t)>r.hpMax)return"tank";var s=t.traits.filter((function(e){var t=a.getToHitExpressions(e),n=a.getDiceExpressions(e).map((function(e){return e.count*(e.sides+1)/2+e.bonus})),s=a.getSaveExpressions(e);return t.some((function(e){return e.bonus>r.attack}))||n.some((function(e){return e>r.dmgMax}))||s.some((function(e){return e.dc>r.save}))}));if(s.length>0){var o=s.filter((function(e){var t=e.text.toLowerCase();return t.includes("ranged")&&t.includes("attack")})).length;return o>=s.length-o?"artillery":"soldier"}}var i=0;return S.forEach((function(e){"custom"!==e&&(t.traits.some((function(t){return t.text.toLowerCase().includes(e.toLowerCase())}))&&(i+=1))})),i>=2?"controller":"skirmisher"}}]),e}(),j=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"allImages",value:function(){for(var e=[],t=0;t!==window.localStorage.length;++t){var a=window.localStorage.key(t);if(a&&a.startsWith("image-")){var n=window.localStorage.getItem(a);if(n){var r=JSON.parse(n);e.push({id:r.id,name:r.name,data:r.data})}}}return k.sort(e,[{field:"name",dir:"asc"}])}},{key:"getImage",value:function(e){var t=null,a=window.localStorage.getItem("image-"+e);if(a){var n=JSON.parse(a);t={id:n.id,name:n.name,data:n.data}}return t}},{key:"saveImage",value:function(e,t,a){var n="image-"+e;if(null===window.localStorage.getItem(n)){var r={id:e,name:t,data:a};window.localStorage.setItem(n,JSON.stringify(r))}}},{key:"clearUnusedImages",value:function(t,a,n){e.allImages().forEach((function(e){var r=!1;t.forEach((function(t){t.items.find((function(t){return t.customBackground===e.id}))&&(r=!0)})),a.forEach((function(t){t.map&&t.map.items.find((function(t){return t.customBackground===e.id}))&&(r=!0)})),n.forEach((function(t){t.map.items.find((function(t){return t.customBackground===e.id}))&&(r=!0)})),r||window.localStorage.removeItem("image-"+e.id)}))}}]),e}(),T=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"initModel",value:function(t){var a=[],n=0;t.forEach((function(t){t.split(/\r?\n/).forEach((function(t){t&&(e.addLineToModel(t,a),n=Math.max(n,t.length))}))})),e.model=a,e.maxLength=n}},{key:"addLineToModel",value:function(e,t){e=String.fromCharCode(0,1)+e+String.fromCharCode(2);for(var a=function(a){var n=e.substr(a-2,2),r=e.substr(a,1),s=t.find((function(e){return e.prev===n}));s||(s={prev:n,freq:[]},t.push(s));var o=s.freq.find((function(e){return e.char===r}));o||(o={char:r,count:0},s.freq.push(o)),o.count+=1},n=2;n!==e.length;++n)a(n)}},{key:"generateLine",value:function(){var e=this.generateLines(1);return e.length>0?e[0]:""}},{key:"generateLines",value:function(t){for(var a=[],n=0;a.length<t&&n<100;){var r=e.extractLine();r&&!a.includes(r)&&r.length<=e.maxLength?a.push(r):n+=1}return a}},{key:"extractLine",value:function(){for(var t=String.fromCharCode(0,1),a=function(){var a=t.substr(t.length-2,2),n=e.model.find((function(e){return e.prev===a}));if(!n)return{v:null};var r="";n.freq.forEach((function(e){r+=e.char.repeat(e.count)}));var s=k.randomNumber(r.length),o=r[s];if(o===String.fromCharCode(2))return{v:t=t.substr(2)};if(1===C.dieRoll()){["bdg","ptk","sz","aeiouy","lr","ckq","vf"].forEach((function(e){if(e.includes(o)){var t=k.randomNumber(e.length);o=e[t]}}))}t+=o};;){var n=a();if("object"===typeof n)return n.v}}},{key:"getAllLanguages",value:function(){return["afrikaans","amharic","armenian","basque","belarusian","bulgarian","chichewa","chinese","croatian","czech","danish","dutch","english","finnish","french","german","greek","hawaiian","hindi","hungarian","icelandic","irish","italian","japanese","kannada","kazakh","korean","kyrgyz","latvian","lithuanian","macedonian","malay","maltese","maori","myanmar","nepali","norwegian","polish","portuguese","punjabi","romanian","russian","samoan","serbian","shona","somali","spanish","swahili","swedish","thai","turkish","welsh","yiddish","zulu"]}},{key:"generateTranslation",value:function(t){for(var a="abcdefghijklmnopqrstuvwxyz",n="",r=0;r!==t.length;++r){if(" "!==t.toLowerCase().charAt(r))n+=a[k.randomNumber(a.length)];else n+=" "}return e.shuffle(n)}},{key:"getSpokenLanguages",value:function(t){return t.map((function(e){return e.languages.toLowerCase()})).join(", ").split(/[,;:]+/).map((function(e){return e.trim()})).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]).sort((function(e,t){return"common"===e?-1:"common"===t?1:e.localeCompare(t)})).map((function(t){return e.capitalise(t)}))}},{key:"startsWithVowel",value:function(e){var t=!1;return["a","e","i","o","u"].forEach((function(a){e.toLowerCase().startsWith(a)&&(t=!0)})),t}},{key:"shuffle",value:function(e){for(var t=e.split(""),a=t.length-1;a>0;a--){var n=k.randomNumber(a+1),r=t[a];t[a]=t[n],t[n]=r}return t.join("")}},{key:"capitalise",value:function(e){return e.split(" ").map((function(e){return e[0].toUpperCase()+(e.length>1?e.substring(1):"")})).join(" ")}},{key:"generateName",value:function(){var e=["As Has Khe Zash Gl Ig Iv Kos Miv Pav Ser Dar Even Gor Rand Sto Tam Barer Keth Mum","Mar Burg Al Hel Wrayt S Eag Eath Joan Answ L Ot Ced At Tal Ham Jasm Mail Yash Row","Adr Alber Ba Bar Gar Kildr Kath Dies Eld Gurd Har Morg Or Rur Mar Vis Jen Torg Tak Thor End Ris Em Gunn","Ad All Aram Berri Car Enial Gann Im Per Sorvi Var Adr An Beth Bir Jelen Key Lesh Mer Mia Naiv Quel Sar Shan","Al An C Cor Eld Er Finn Gar Lin Mer Os Per Ros An Cal Cor Kith Lav Ned Pae Seraph T V Chen","Are Bala Bhar Don Gh Hesk Med Meh Nad Pand Patr Sham Shed Ak Bir Farid Fla Ka Ko Mish Thav Uad Eder Hener","Alu Stos Fa Ravay Leo Stok Vic El Yeng Car Ric Ar Guir Es My Pey"].join(" ").toLowerCase().split(" "),t=["Eir Eid Eed El Ar An Or Ef Al Vin Orn Dur Stag Elm Ur Us","Ik Ich Ern End Tor Nor In Rak Gen Sik Gran Linn Vok Brek Dal Gar","An Ar Il Rian Ric Is Dan Arai Meral Cian En Rion Ialis Ior Nan Kas","Ton Der Ade Rin Don Rich Nan Ret Al Born Coe By Fire Yas Dal Yle","Han Asar Ash Aar Esch An Rash En Arr Jed Rin Gar Ash Dinn Hun Rek","Orel Aadi Ahn Aver Eiros Kain Retor Lannan Pet Ikos","Er Ey A E Il Elia Ya Ed Eue Ild Oane Yne Orna Ie Ala Erri Ea Ia","Ber Tin Hild Dryn A Eth Runn Ellen Loda Dis Ja Lin Ra Tyrd De Rasa","Rie Aea Striana Inua Rynna Ilia Na Neth Leth Iel Lee Qui Astra Ia Ania Ynn","Dry Ree Lie Ora Emia Ian Ri Inia Ina Aena Ani Erna Lyse La Da Aela","Ra Ir Eh Ann Ilar Rinn Ann La Ra A Ina Va Hit Ederei Ere Eila","Ina Ceryn Vyn Ella Aella Vyre"].join(" ").toLowerCase().split(" "),a=k.randomNumber(e.length),n=k.randomNumber(t.length),r="";if(1===C.dieRoll(10)){var s=["-","'"," "];r=s[k.randomNumber(s.length)]}return e[a]+r+t[n]}},{key:"generatePotion",value:function(){var t="",a=e.potionColour(!0),n=e.potionLiquid(),r=e.potionAdjective(),s=e.potionFeature();switch(k.randomNumber(5)){case 0:t=a+" "+n;break;case 1:t=a+" "+n+" "+s;break;case 2:t=r+" "+a+" "+n;break;case 3:t=r+" "+a+" "+n+" "+s;break;case 4:t=r+" "+n+", "+a+" "+s}switch(t=(e.startsWithVowel(t)?"an":"a")+" "+t+" in "+e.potionContainer(),k.randomNumber(6)){case 0:t+="; it smells "+e.potionSmell();break;case 1:t+="; it tastes "+e.potionSmell();break;case 2:t+="; it smells "+e.potionSmell()+" but tastes "+e.potionSmell();break;case 3:t+="; it smells and tastes "+e.potionSmell()}return t}},{key:"generateBookTitle",value:function(){var t="",a=e.bookNounPhrase(k.randomBoolean(),k.randomBoolean());switch(k.randomNumber(5)){case 0:t=a+"'s "+e.bookNounPhrase(k.randomBoolean(),!1);break;case 1:t=a+" "+e.bookPreposition()+" "+e.bookNounPhrase(k.randomBoolean(),!0);break;case 2:t=e.bookGerund()+" "+e.bookNounPhrase(k.randomBoolean(),!0);break;case 3:t=e.bookAbout()+" "+a;break;case 4:t=a}if(0===k.randomNumber(10)&&(t+=": "+e.bookAbout()+" "+e.bookNounPhrase(k.randomBoolean(),k.randomBoolean())),0===k.randomNumber(10)){var n="";switch(k.randomNumber(3)){case 0:n="volume";break;case 1:n="part";break;case 2:n="book"}switch(k.randomNumber(5)){case 0:t+=", "+n+" one";break;case 1:t+=", "+n+" two";break;case 2:t+=", "+n+" three";break;case 3:t+=", "+n+" four";break;case 4:t+=", "+n+" five"}}return t}},{key:"generateNPCAge",value:function(){var e=["elderly","middle-aged","teenage","youthful","young","old"];return e[k.randomNumber(e.length)]}},{key:"generateNPCProfession",value:function(){var e=["apothecary","architect","armourer","arrowsmith","astrologer","baker","barber","lawyer","beggar","bellfounder","blacksmith","bookbinder","brewer","bricklayer","butcher","carpenter","carter","cartwright","chandler","peddler","clerk","clockmaker","cobbler","cook","cooper","merchant","embroiderer","engraver","fisherman","fishmonger","forester","furrier","gardener","gemcutter","glassblower","goldsmith","grocer","haberdasher","stableman","courtier","herbalist","innkeeper","ironmonger","labourer","painter","locksmith","mason","messenger","miller","miner","minstrel","ploughman","farmer","porter","sailor","scribe","seamstress","shepherd","shipwright","soapmaker","tailor","tinker","vintner","weaver"];return e[k.randomNumber(e.length)]}},{key:"generateNPCHeight",value:function(){var e=["gangly","gigantic","hulking","lanky","short","small","stumpy","tall","tiny","willowy"];return e[k.randomNumber(e.length)]}},{key:"generateNPCWeight",value:function(){var e=["broad-shouldered","fat","gaunt","heavy-set","obese","plump","pot-bellied","rotund","skinny","slender","slim","statuesque","stout","thin"];return e[k.randomNumber(e.length)]}},{key:"generateNPCHair",value:function(){var e=["short","cropped","long","braided","dreadlocked","shoulder-length","wiry","balding","receeding","curly","tightly-curled","straight","greasy","limp","sparse","thinning","wavy"],t=["black","brown","dark brown","light brown","red","ginger","strawberry blonde","blonde","ash blonde","graying","silver","white","gray","auburn"];return e[k.randomNumber(e.length)]+", "+t[k.randomNumber(t.length)]}},{key:"generateNPCPhysical",value:function(){var e=["bearded","buck-toothed","chiselled","doe-eyed","fine-featured","florid","gap-toothed","goggle-eyed","grizzled","jowly","jug-eared","pock-marked","broken nose","red-cheeked","scarred","squinting","thin-lipped","toothless","weather-beaten","wrinkled"];return e[k.randomNumber(e.length)]}},{key:"generateNPCMental",value:function(){var e=["hot-tempered","overbearing","antagonistic","haughty","elitist","proud","rude","aloof","mischievous","impulsive","lusty","irreverent","madcap","thoughtless","absent-minded","insensitive","brave","craven","shy","fearless","obsequious","inquisitive","prying","intellectual","perceptive","keen","perfectionist","stern","harsh","punctual","driven","trusting","kind-hearted","forgiving","easy-going","compassionate","miserly","hard-hearted","covetous","avaricious","thrifty","wastrel","spendthrift","extravagant","kind","charitable","gloomy","morose","compulsive","irritable","vengeful","honest","truthful","innocent","gullible","bigoted","biased","narrow-minded","cheerful","happy","diplomatic","pleasant","foolhardy","affable","fatalistic","depressing","cynical","sarcastic","realistic","secretive","retiring","practical","level-headed","dull","reverent","scheming","paranoid","cautious","deceitful","nervous","uncultured","boorish","barbaric","graceless","crude","cruel","sadistic","immoral","jealous","belligerent","argumentative","arrogant","careless","curious","exacting","friendly","greedy","generous","moody","naive","opinionated","optimistic","pessimistic","quiet","sober","suspicious","uncivilised","violent","peaceful"];return e[k.randomNumber(e.length)]}},{key:"generateNPCSpeech",value:function(){var e=["accented","articulate","garrulous","breathless","crisp","gutteral","high-pitched","lisping","loud","nasal","slow","fast","squeaky","stuttering","wheezy","whiny","whispery","soft-spoken","laconic","blustering"];return e[k.randomNumber(e.length)]}},{key:"generateNPCTrait",value:function(){var e=["I idolize a particular hero of my faith and constantly refer to that person's deeds and example.","I can find common ground between the fiercest enemies, empathizing with them and always working toward peace.","I see omens in every event and action. The gods try to speak to us, we just need to listen.","Nothing can shake my optimistic attitude.","I quote (or misquote) the sacred texts and proverbs in almost every situation.","I am tolerant (or intolerant) of other faiths and respect (or condemn) the worship of other gods.","I've enjoyed fine food, drink, and high society among my temple's elite. Rough living grates on me.","I've spent so long in the temple that I have little practical experience dealing with people in the outside world.","I fall in and out of love easily, and am always pursuing someone.","I have a joke for every occasion, especially occasions where humor is inappropriate.","Flattery is my preferred trick for getting what I want.","I'm a born gambler who can't resist taking a risk for a potential payoff.","I lie about almost everything, even when there's no good reason to.","Sarcasm and insults are my weapons of choice.","I keep multiple holy symbols on me and invoke whatever deity might come in useful at any given moment.","I pocket anything I see that might have some value.","I always have plan for what to do when things go wrong.","I am always calm, no matter what the situation. I never raise my voice or let my emotions control me.","The first thing I do in a new place is note the locations of everything valuable - or where such things could be hidden.","I would rather make a new friend than a new enemy.","I am incredibly slow to trust. Those who seem the fairest often have the most to hide.","I don't pay attention to the risks in a situation. Never tell me the odds.","The best way to get me to do something is to tell me I can't do it.","I blow up at the slightest insult.","I know a story relevant to almost every situation.","Whenever I come to a new place, I collect local rumors and spread gossip.","I'm a hopeless romantic, always searching for that 'special someone'.","Nobody stays angry at me or around me for long, since I can defuse any amount of tension.","I love a good insult, even one directed at me.","I get bitter if I'm not the center of attention.","I'll settle for nothing less than perfection.","I change my mood or my mind as quickly as I change key in a song.","I judge people by their actions, not their words.","If someone is in trouble, I'm always willing to lend help.","When I set my mind to something, I follow through no matter what gets in my way.","I have a strong sense of fair play and always try to find the most equitable solution to arguments.","I'm confident in my own abilities and do what I can to instill confidence in others.","Thinking is for other people. I prefer action.","I misuse long words in an attempt to sound smarter.","I get bored easily. When am I going to get on with my destiny?","I believe that everything worth doing is worth doing right. I can't help it - I'm a perfectionist.","I'm a snob who looks down on those who can't appreciate fine art.","I always want to know how things work and what makes people tick.","I'm full of witty aphorisms and have a proverb for every occasion.","I'm rude to people who lack my commitment to hard work and fair play.","I like to talk at length about my profession.","I don't part with my money easily and will haggle tirelessly to get the best deal possible.","I'm well known for my work, and I want to make sure everyone appreciates it. I'm always taken aback when people haven't heard of me.","I've been isolated for so long that I rarely speak, preferring gestures and the occasional grunt.","I am utterly serene, even in the face of disaster.","The leader of my community has something wise to say on every topic, and I am eager to share that wisdom.","I feel tremendous empathy for all who suffer.","I'm oblivious to etiquette and social expectations.","I connect everything that happens to me to a grand cosmic plan.","I often get lost in my own thoughts and contemplations, becoming oblivious to my surroundings.","I am working on a grand philosophical theory and love sharing my ideas.","My eloquent flattery makes everyone I talk to feel like the most wonderful and important person in the world.","The common folk love me for my kindness and generosity.","No one could doubt by looking at my regal bearing that I am a cut above the unwashed masses.","I take great pains to always look my best and follow the latest fashions.","I don't like to get my hands dirty, and I won't be caught dead in unsuitable accommodations.","Despite my birth, I do not place myself above other folk. We all have the same blood.","My favor, once lost, is lost forever.","If you do me an injury, I will crush you, ruin your name, and salt your fields.","I'm driven by a wanderlust that led me away from home.","I watch over my friends as if they were a litter of newborn pups.","I once ran twenty-five miles without stopping to warn my clan of an approaching orc horde. I'd do it again if I had to.","I have a lesson for every situation, drawn from observing nature.","I place no stock in wealthy or well-mannered folk. Money and manners won't save you from a hungry owlbear.","I'm always picking things up, absently fiddling with them, and sometimes accidentally breaking them.","I feel far more comfortable around animals than people.","I was, in fact, raised by wolves.","I use polysyllabic words to convey the impression of great erudition.","I've read every book in the world's greatest libraries - or like to boast that I have.","I'm used to helping out those who aren't as smart as I am, and I patiently explain anything and everything to others.","There's nothing I like more than a good mystery.","I'm willing to listen to every side of an argument before I make my own judgment.","I...speak...slowly...when talking...to idiots...which...almost...everyone...is...compared...to me.","I am horribly, horribly awkward in social situations.","I'm convinced that people are always trying to steal my secrets.","My friends know they can rely on me, no matter what.","I work hard so that I can play hard when the work is done.","I enjoy sailing into new ports and making new friends over a flagon of ale.","I stretch the truth for the sake of a good story.","To me, a tavern brawl is a nice way to get to know a new city.","I never pass up a friendly wager.","My language is as foul as an otyugh nest.","I like a job well done, especially if I can convince someone else to do it.","I'm always polite and respectful.","I'm haunted by memories of war. I can't get the images of violence out of my mind.","I've lost too many friends, and I'm slow to make new ones.","I'm full of inspiring and cautionary tales from my military experience relevant to almost every combat situation.","I can stare down a hellhound without flinching.","I enjoy being strong and like breaking things.","I have a crude sense of humor.","I face problems head-on. A simple direct solution is the best path to success.","I hide scraps of food and trinkets away in my pockets.","I ask a lot of questions.","I like to squeeze into small places where no one else can get to me.","I sleep with my back to a wall or tree, with everything I own wrapped in a bundle in my arms.","I eat like a pig and have bad manners.","I think anyone who's nice to me is hiding evil intent.","I don't like to bathe.","I bluntly say what other people are hinting or hiding."];return e[k.randomNumber(e.length)]}},{key:"generateNPCIdeal",value:function(){var e=["Faith. I trust that my deity will guide my actions. I have faith that if I work hard, things will go well. (Lawful)","Tradition. The ancient traditions of worship and sacrifice must be preserved and upheld. (Lawful)","Charity. I always try to help those in need, no matter what the personal cost. (Good)","Change. We must help bring about the changes the gods are constantly working in the world. (Chaotic)","Power. I hope to one day rise to the top of my faith's religious hierarchy. (Lawful)","Aspiration. I seek to prove my self worthy of my god's favor by matching my actions against his or her teachings. (Any)","Independence. I am a free spirit - no one tells me what to do. (Chaotic)","Fairness. I never target people who can't afford to lose a few coins. (Lawful)","Charity. I distribute money I acquire to the people who really need it. (Good)","Creativity. I never run the same con twice. (Chaotic)","Friendship. Material goods come and go. Bonds of friendship last forever. (Good)","Aspiration. I'm determined to make something of myself. (Any)","Honor. I don't steal from others in the trade. (Lawful)","Freedom. Chains are meant to be broken, as are those who would forge them. (Chaotic)","Charity. I steal from the wealthy so that I can help people in need. (Good)","Greed. I will do whatever it takes to become wealthy. (Evil)","People. I'm loyal to my friends, not to any ideals, and everyone else can take a trip down the Styx for all I care. (Neutral)","Redemption. There's a spark of good in everyone. (Good)","Beauty. When I perform, I make the world better than it was. (Good)","Tradition. The stories, legends, and songs of the past must never be forgotten. (Lawful)","Creativity. The world is in need of new ideas and bold action. (Chaotic)","Greed. I'm only in it for the money and fame. (Evil)","People. I like seeing the smiles on people's faces when I perform. That's all that matters. (Neutral)","Honesty. Art should reflect the soul; it should come from within and reveal who we really are. (Any)","Respect. People deserve to be treated with dignity and respect. (Good)","Fairness. No one should get preferential treatment before the law, and no one is above the law. (Lawful)","Freedom. Tyrants must not be allowed to oppress the people. (Chaotic)","Might. If I become strong, I can take what I want - what I deserve. (Evil)","Sincerity. There's no good pretending to be something I'm not. (Neutral)","Destiny. Nothing and no one can steer me away from my higher calling. (Any)","Community. It is the duty of all civilized people to strengthen the bonds of community and the security of civilization. (Lawful)","Generosity. My talents were given to me so that I could use them to benefit the world. (Good)","Freedom. Everyone should be free to pursue his or her livelihood. (Chaotic)","Greed. I'm only in it for the money. (Evil)","People. I'm committed to the people I care about, not to ideals. (Neutral)","Aspiration. I work hard to be the best there is at my craft. (Any)","Greater Good. My gifts are meant to be shared with all, not used for my own benefit. (Good)","Logic. Emotions must not cloud our sense of what is right and true, or our logical thinking. (Lawful)","Free Thinking. Inquiry and curiosity are the pillars of progress. (Chaotic)","Power. Solitude and contemplation are paths toward mystical or magical power. (Evil)","Live and Let Live. Meddling in the affairs of others only causes trouble. (Neutral)","Self-Knowledge. If you know yourself, there're nothing left to know. (Any)","Respect. Respect is due to me because of my position, but all people regardless of station deserve to be treated with dignity. (Good)","Responsibility. It is my duty to respect the authority of those above me, just as those below me must respect mine. (Lawful)","Independence. I must prove that I can handle myself without the coddling of my family. (Chaotic)","Power. If I can attain more power, no one will tell me what to do. (Evil)","Family. Blood runs thicker than water. (Any)","Noble Obligation. It is my duty to protect and care for the people beneath me. (Good)","Change. Life is like the seasons, in constant change, and we must change with it. (Chaotic)","Greater Good. It is each person's responsibility to make the most happiness for the whole tribe. (Good)","Honor. If I dishonor myself, I dishonor my whole clan. (Lawful)","Might. The strongest are meant to rule. (Evil)","Nature. The natural world is more important than all the constructs of civilization. (Neutral)","Glory. I must earn glory in battle, for myself and my clan. (Any)","Knowledge. The path to power and self-improvement is through knowledge. (Neutral)","Beauty. What is beautiful points us beyond itself toward what is true. (Good)","Logic. Emotions must not cloud our logical thinking. (Lawful)","No Limits. Nothing should fetter the infinite possibility inherent in all existence. (Chaotic)","Power. Knowledge is the path to power and domination. (Evil)","Self-improvement. The goal of a life of study is the betterment of oneself.","Respect. The thing that keeps a ship together is mutual respect between captain and crew. (Good)","Fairness. We all do the work, so we all share in the rewards. (Lawful)","Freedom. The sea is freedom - the freedom to go anywhere and do anything. (Chaotic)","Master. I'm a predator, and the other ships on the sea are my prey. (Evil)","People. I'm committed to my crewmates, not to ideals. (Neutral)","Aspiration. Someday I'll own my own ship and chart my own destiny. (Any)","Greater Good. Our lot is to lay down our lives in defense of others. (Good)","Responsibility. I do what I must and obey just authority. (Lawful)","Independence. When people follow orders blindly they embrace a kind of tyranny. (Chaotic)","Might. In life as in war, the stronger force wins. (Evil)","Ideals aren't worth killing for or going to war for. (Neutral)","Nation. My city, nation, or people are all that matter. (Any)","Respect. All people, rich or poor, deserve respect. (Good)","Community. We have to take care of each other, because no one else is going to do it. (Lawful)","Change. The low are lifted up, and the high and mighty are brought down. Change is the nature of things. (Chaotic)","Retribution. The rich need to be shown what life and death are like in the gutters. (Evil)","People. I help people who help me - that's what keeps us alive. (Neutral)","Aspiration. I'm going to prove that I'm worthy of a better life. (Any)"];return e[k.randomNumber(e.length)]}},{key:"generateNPCBond",value:function(){var e=["I would die to recover an ancient artifact of my faith that was lost long ago.","I will someday get revenge on the corrupt temple hierarchy who branded me a heretic.","I owe me life to the priest who took me in when my parents died.","Everything I do is for the common people.","I will do anything to protect the temple where I served.","I seek to preserve a sacred text that my enemies consider heretical and seek to destroy.","I fleeced the wrong person and must work to ensure that this individual never crosses paths with me or those I care about.","I owe everything to my mentor - a horrible person who's probably rotting in jail somewhere.","Somewhere out there I have a child who doesn't know me. I'm making the world better for him or her.","I come from a noble family, and one day I'll reclaim my lands and title from those who stole them from me.","A powerful person killed someone I love. Some day soon, I'll have my revenge.","I swindled and ruined a person who didn't deserve it. I seek to atone for my misdeeds but might never be able to forgive myself.","I'm trying to pay off an old debt I owe to a generous benefactor.","My ill-gotten gains go to support my family.","Something important was taken from me, and I aim to steal it back.","I will become the greatest thief that ever lived.","I'm guilty of a terrible crime. I hope I can redeem myself for it.","Someone I loved died because of a mistake I made. That will never happen again.","My instrument is my most treasured possession, and it reminds me of someone I love.","Someone stole my precious instrument, and someday I'll get it back.","I want to be famous, whatever it takes.","I idolize a hero of the old tales and measure my deeds against that person's.","I will do anything to prove myself superior to me hated rival.","I would do anything for the other members of my old troupe.","I have a family, but I have no idea where they are. One day, I hope to see them again.","I worked the land, I love the land, and I will protect the land.","A proud noble once gave me a horrible beating, and I will take my revenge on any bully I encounter.","My tools are symbols of my past life, and I carry them so that I will never forget my roots.","I protect those who cannot protect themselves.","I wish my childhood sweetheart had come with me to pursue my destiny.","The workshop where I learned my trade is the most important place in the world to me.","I created a great work for someone, and then found them unworthy to receive it. I'm still looking for someone worthy.","I owe my guild a great debt for forging me into the person I am today.","I pursue wealth to secure someone's love.","One day I will return to my guild and prove that I am the greatest artisan of them all.","I will get revenge on the evil forces that destroyed my place of business and ruined my livelihood.","Nothing is more important than the other members of my hermitage, order, or association.","I entered seclusion to hide from the ones who might still be hunting me. I must someday confront them.","I'm still seeking the enlightenment I pursued in my seclusion, and it still eludes me.","I entered seclusion because I loved someone I could not have.","Should my discovery come to light, it could bring ruin to the world.","My isolation gave me great insight into a great evil that only I can destroy.","I will face any challenge to win the approval of my family.","My house's alliance with another noble family must be sustained at all costs.","Nothing is more important that the other members of my family.","I am in love with the heir of a family that my family despises.","My loyalty to my sovereign is unwavering.","The common folk must see me as a hero of the people.","My family, clan, or tribe is the most important thing in my life, even when they are far from me.","An injury to the unspoiled wilderness of my home is an injury to me.","I will bring terrible wrath down on the evildoers who destroyed my homeland.","I am the last of my tribe, and it is up to me to ensure their names enter legend.","I suffer awful visions of a coming disaster and will do anything to prevent it.","It is my duty to provide children to sustain my tribe.","It is my duty to protect my students.","I have an ancient text that holds terrible secrets that must not fall into the wrong hands.","I work to preserve a library, university, scriptorium, or monastery.","My life's work is a series of tomes related to a specific field of lore.","I've been searching my whole life for the answer to a certain question.","I sold my soul for knowledge. I hope to do great deeds and win it back.","I'm loyal to my captain first, everything else second.","The ship is most important - crewmates and captains come and go.","I'll always remember my first ship.","In a harbor town, I have a paramour whose eyes nearly stole me from the sea.","I was cheated of my fair share of the profits, and I want to get my due.","Ruthless pirates murdered my captain and crewmates, plundered our ship, and left me to die. Vengeance will be mine.","I would lay down my life for the people I served with.","Someone saved my life on the battlefield. To this day, I will never leave a friend behind.","My honor is my life.","I'll never forget the crushing defeat my company suffered or the enemies who dealt it.","Those who fight beside me are those worth dying for.","I fight for those who cannot fight for themselves.","My town or city is my home, and I'll fight to defend it.","I sponsor an orphanage to keep others from enduring what I was forced to endure.","I owe my survival to another urchin who taught me to live on the streets.","I owe a debt I can never repay to the person who took pity on me.","I escaped my life of poverty by robbing an important person, and I'm wanted for it.","No one else is going to have to endure the hardships I've been through."];return e[k.randomNumber(e.length)]}},{key:"generateNPCFlaw",value:function(){var e=["I judge others harshly, and myself even more severely.","I put too much trust in those who wield power within my temple's hierarchy.","My piety sometimes leads me to blindly trust those that profess faith in my god.","I am inflexible in my thinking.","I am suspicious of strangers and suspect the worst of them.","Once I pick a goal, I become obsessed with it to the detriment of everything else in my life.","I can't resist a pretty face.","I'm always in debt. I spend my ill-gotten gains on decadent luxuries faster than I bring them in.","I'm convinced that no one could ever fool me in the way I fool others.","I'm too greedy for my own good. I can't resist taking a risk if there's money involved.","I can't resist swindling people who are more powerful than me.","I hate to admit it and will hate myself for it, but I'll run and preserve my own hide if the going gets tough.","When I see something valuable, I can't think about anything but how to steal it.","When faced with a choice between money and my friends, I usually choose the money.","If there's a plan, I'll forget it. If I don't forget it, I'll ignore it.","I have a 'tell' that reveals when I'm lying.","I turn tail and run when things go bad.","An innocent person is in prison for a crime that I committed. I'm okay with that.","I'll do anything to win fame and renown.","I'm a sucker for a pretty face.","A scandal prevents me from ever going home again. That kind of trouble seems to follow me around.","I once satirized a noble who still wants my head. It was a mistake that I will likely repeat.","I have trouble keeping my true feelings hidden. My sharp tongue lands me in trouble.","Despite my best efforts, I am unreliable to my friends.","The tyrant who rules my land will stop at nothing to see me killed.","I'm convinced of the significance of my destiny, and blind to my shortcomings and the risk of failure.","The people who knew me when I was young know my shameful secret, so I can never go home again.","I have a weakness for the vices of the city, especially hard drink.","Secretly, I believe that things would be better if I were a tyrant lording over the land.","I have trouble trusting in my allies.","I'll do anything to get my hands on something rare or priceless.","I'm quick to assume that someone is trying to cheat me.","No one must ever learn that I once stole money from guild coffers.","I'm never satisfied with what I have - I always want more.","I would kill to acquire a noble title.","I'm horribly jealous of anyone who outshines my handiwork. Everywhere I go, I'm surrounded by rivals.","Now that I've returned to the world, I enjoy its delights a little too much.","I harbor dark bloodthirsty thoughts that my isolation failed to quell.","I am dogmatic in my thoughts and philosophy.","I let my need to win arguments overshadow friendships and harmony.","I'd risk too much to uncover a lost bit of knowledge.","I like keeping secrets and won't share them with anyone.","I secretly believe that everyone is beneath me.","I hide a truly scandalous secret that could ruin my family forever.","I too often hear veiled insults and threats in every word addressed to me, and I'm quick to anger.","I have an insatiable desire for carnal pleasures.","In fact, the world does revolve around me.","By my words and actions, I often bring shame to my family.","I am too enamored of ale, wine, and other intoxicants.","There's no room for caution in a life lived to the fullest.","I remember every insult I've received and nurse a silent resentment toward anyone who's ever wronged me.","I am slow to trust members of other races","Violence is my answer to almost any challenge.","Don't expect me to save those who can't save themselves. It is nature's way that the strong thrive and the weak perish.","I am easily distracted by the promise of information.","Most people scream and run when they see a demon. I stop and take notes on its anatomy.","Unlocking an ancient mystery is worth the price of a civilization.","I overlook obvious solutions in favor of complicated ones.","I speak without really thinking through my words, invariably insulting others.","I can't keep a secret to save my life, or anyone else's.","I follow orders, even if I think they're wrong.","I'll say anything to avoid having to do extra work.","Once someone questions my courage, I never back down no matter how dangerous the situation.","Once I start drinking, it's hard for me to stop.","I can't help but pocket loose coins and other trinkets I come across.","My pride will probably lead to my destruction","The monstrous enemy we faced in battle still leaves me quivering with fear.","I have little respect for anyone who is not a proven warrior.","I made a terrible mistake in battle that cost many lives - and I would do anything to keep that mistake secret.","My hatred of my enemies is blind and unreasoning.","I obey the law, even if the law causes misery.","I'd rather eat my armor than admit when I'm wrong.","If I'm outnumbered, I always run away from a fight.","Gold seems like a lot of money to me, and I'll do just about anything for more of it.","I will never fully trust anyone other than myself.","I'd rather kill someone in their sleep than fight fair.","It's not stealing if I need it more than someone else.","People who don't take care of themselves get what they deserve."];return e[k.randomNumber(e.length)]}},{key:"generateTreasure",value:function(){var t="",a=["diamond","ruby","sapphire","emerald","amethyst","garnet","topaz","pearl","black pearl","opal","fire opal","amber","coral","agate","carnelian","jade","peridot","moonstone","alexandrite","aquamarine","jacinth","marble"];switch(k.randomNumber(12)){case 0:case 1:case 2:var n=a[k.randomNumber(a.length)];switch(k.randomBoolean()){case!0:n+=" gemstone";break;case!1:n="piece of "+n}switch(k.randomNumber(12)){case 0:n="well cut "+n;break;case 1:n="rough-cut "+n;break;case 2:n="poorly cut "+n;break;case 3:n="small "+n;break;case 4:n="large "+n;break;case 5:n="oddly shaped "+n;break;case 6:n="highly polished "+n}t=n;break;case 3:case 4:case 5:var r=["medal","statuette","sculpture","idol","chalice","goblet","dish","bowl"],s=r[k.randomNumber(r.length)],o=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];t=o[k.randomNumber(o.length)]+" "+s;break;case 6:case 7:case 8:var i=["ring","necklace","crown","circlet","bracelet","anklet","torc","brooch","pendant","locket","diadem","tiara","earring"],c=i[k.randomNumber(i.length)],l=["gold","silver","bronze","platinum","electrum","mithral","orium","adamantine"];switch(t=l[k.randomNumber(l.length)]+" "+c,k.randomNumber(5)){case 0:t=(k.randomBoolean()?"enamelled":"laquered")+" "+t;break;case 1:t=l[k.randomNumber(l.length)]+"-"+(k.randomBoolean()?"plated":"filigreed")+" "+t}switch(k.randomNumber(10)){case 0:t="delicate "+t;break;case 1:t="intricate "+t;break;case 2:t="elegant "+t;break;case 3:t="simple "+t;break;case 4:t="plain "+t}break;case 9:case 10:var u="";switch(k.randomBoolean()){case!0:switch(u="painting",k.randomBoolean()){case!0:u="oil "+u;break;case!1:u="watercolour "+u}break;case!1:switch(u="drawing",k.randomNumber(3)){case 0:u="pencil "+u;break;case 1:u="charcoal "+u;break;case 2:u="pastel "+u}}var d=["small","large","delicate","fragile","elegant","detailed"],m=["canvas","paper","parchment","wood panels","fabric"];t=d[k.randomNumber(d.length)]+" "+u+" on "+m[k.randomNumber(m.length)];break;case 11:var p=["lute","lyre","mandolin","violin","drum","flute","clarinet","accordion","banjo","bodhran","ocarina","zither","djembe","shawm"],h=p[k.randomNumber(p.length)],f=["small","large","light","heavy","delicate","fragile","masterwork","elegant"];t=f[k.randomNumber(f.length)]+" "+h}switch(k.randomNumber(5)){case 0:var v=["feywild","shadowfell","elemental chaos","astral plane","abyss","distant north","distant east","distant west","distant south"];t+=" from the "+v[k.randomNumber(v.length)];break;case 1:var g=["decorated with","inscribed with","engraved with","embossed with","carved with"],y=["indecipherable","ancient","curious","unusual","dwarven","eladrin","elven","draconic","gith"],b=["script","designs","sigils","runes","glyphs","patterns"];t+=" "+g[k.randomNumber(g.length)]+" "+y[k.randomNumber(y.length)]+" "+b[k.randomNumber(b.length)];break;case 2:var E=["glowing with","suffused with","infused with","humming with","pulsing with"],w=["arcane","divine","primal","psionic","dark","shadow","elemental","ethereal","unknown"],N=["energy","power","magic"];t+=" "+E[k.randomNumber(E.length)]+" "+w[k.randomNumber(w.length)]+" "+N[k.randomNumber(N.length)];break;case 4:var C=a[k.randomNumber(a.length)];k.randomBoolean()?C+="s":C="a single "+C;var S=["set with","inlaid with","studded with","with shards of"];t+=" "+S[k.randomNumber(S.length)]+" "+C}return(e.startsWithVowel(t)?"an ":"a ")+t}},{key:"generateRoomName",value:function(){var e=["antechamber","arena","armoury","aviary","audience chamber","banquet hall","bath chamber","barracks","bedroom","boudoir","bestiary","burial chamber","cells","chamber","chantry","chapel","classroom","closet","court","crypt","dining room","dormitory","dressing room","dumping ground","entrance hall","gallery","game room","great hall","guard post","hall","harem","hoard","infirmary","kennels","kitchens","laboratory","lair","library","mausoleum","meditation room","museum","nursery","observatory","office","pantry","prison","quarters","reception room","refectory","ritual chamber","shrine","smithy","stable","storeroom","study","temple","throne room","torture chamber","trophy room","training area","treasury","waiting room","workroom","workshop","vault","vestibule"];return e[k.randomNumber(e.length)]}},{key:"potionColour",value:function(e){var t=["red","scarlet","crimson","carmine","vermillion","pink","blue","royal blue","sky blue","light blue","dark blue","midnight blue","indigo","yellow","lemon yellow","amber","green","light green","dark green","sea green","turquoise","aquamarine","emerald","purple","lavender","lilac","mauve","orange","brown","maroon","ochre","black","dark grey","grey","light grey","off-white","white","golden","silver"];if(e&&(t=t.concat(["blood red","cherry red","ruby-coloured","rose-coloured","sapphire-coloured","straw-coloured","olive-coloured","plum-coloured","mud-coloured","cream-coloured","ivory-coloured","bronze-coloured","colourless","clear","transparent"])),e&&0===k.randomNumber(5)){var a=k.randomNumber(t.length),n=k.randomNumber(t.length),r=[t[a],t[n]];return k.sort(r,[{field:"length",dir:"asc"}]),r[0]+" and "+r[1]}return t[k.randomNumber(t.length)]}},{key:"potionAdjective",value:function(){var e=["watery","syrupy","thick","viscous","gloopy","thin","runny","translucent","effervescent","fizzing","bubbling","foaming","volatile","smoking","fuming","vaporous","steaming","cold","icy cold","hot","sparkling","iridescent","cloudy","opalescent","luminous","phosphorescent","glowing"];return e[k.randomNumber(e.length)]}},{key:"potionFeature",value:function(){switch(k.randomNumber(6)){case 0:return"with "+this.potionColour(!0)+" specks";case 1:return"with flecks of "+this.potionColour(!1);case 2:var t=this.potionColour(!0);return"with "+(e.startsWithVowel(t)?"an":"a")+" "+t+" suspension";case 3:return"with a floating "+this.potionColour(!0)+" layer";case 4:return"with a ribbon of "+this.potionColour(!1);case 5:return"with "+this.potionColour(!0)+" marbling"}return""}},{key:"potionLiquid",value:function(){var e=["liquid","solution","draught","oil","elixir","potion"];return e[k.randomNumber(e.length)]}},{key:"potionContainer",value:function(){var t=["small","rounded","tall","square","irregularly-shaped","long-necked","cylindrical","round-bottomed"],a=["glass","metal","ceramic","crystal"],n=["vial","jar","bottle","flask"],r=t[k.randomNumber(t.length)],s=a[k.randomNumber(a.length)],o=n[k.randomNumber(n.length)];0===k.randomNumber(3)&&(s=this.potionColour(!0)+" "+s);var i="";switch(k.randomBoolean()){case!0:i=s+" "+o;break;case!1:i=r+" "+s+" "+o}return(e.startsWithVowel(i)?"an":"a")+" "+i}},{key:"potionSmell",value:function(){var e=["acidic","acrid","of ammonia","of apples","bitter","brackish","buttery","of cherries","delicious","earthy","of earwax","of fish","floral","of lavender","lemony","of honey","fruity","meaty","metallic","musty","of onions","of oranges","peppery","of perfume","rotten","salty","sickly sweet","starchy","sugary","smokey","sour","spicy","of sweat","sweet","unpleasant","vile","vinegary"];return e[k.randomNumber(e.length)]}},{key:"bookNounPhrase",value:function(t,a){var n=e.bookNoun(t),r=!1;(t&&0===k.randomNumber(5)&&(n+="s",r=!0),0===k.randomNumber(3))&&(n=e.bookAdjective()+" "+n);if(a&&k.randomBoolean())switch(k.randomBoolean()){case!0:n="the "+n;break;case!1:if(r)switch(k.randomNumber(6)){case 0:n="two "+n;break;case 1:n="three "+n;break;case 2:n="four "+n;break;case 3:n="five "+n;break;case 4:n="six "+n;break;case 5:n="seven "+n}else switch(k.randomBoolean()){case!0:n=(e.startsWithVowel(n)?"an":"a")+" "+n;break;case!1:n="one "+n}}return n}},{key:"bookNoun",value:function(e){var t=["elf","halfling","dwarf","gnome","tiefling","dragonborn","goliath","changeling","drow","minotaur","beast","orc","goblin","hobgoblin","dragon","demon","devil","angel","god","gith","night","day","eclipse","shadow","sky","sun","moon","star","void","battle","war","brawl","fist","blade","arrow","spell","prayer","eye","wing","army","legion","brigade","galleon","warship","frigate","potion","jewel","ring","amulet","cloak","sword","spear","helm","wizard","king","queen","prince","princess","warlock","barbarian","sorcerer","thief","mage","child","wayfarer","adventurer","pirate","spy","sage","assassin","mountain","forest","peak","cave","cavern","lake","swamp","marshland","island","shore","city","town","village","tower","arena","castle","citadel","bridge","game","wager","quest","challenge","rose","lily","thorn","leaf","word","snake","serpent","song","lament","dirge","elegy","storm","tempest"];return e||(t=t.concat(["darkness","light","dusk","twilight","revenge","vengeance","blood","earth","water","ice","wood","metal","lightning","thunder","mist","snow","flame","fire","wind","stone","destruction","life","death","time","end","danger","luck","chaos","truth","untruth","lie","deception","music","sound","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"])),t[k.randomNumber(t.length)]}},{key:"bookAdjective",value:function(){var e=["dark","bright","tyrannous","devout","noble","eldritch","mystical","magical","sorcerous","savage","silent","lonely","violent","peaceful","black","white","gold","silver","red","pale","dying","living","ascending","defiled","mythical","legendary","heroic","empty","mighty","despairing","spellbound","enchanted","soaring","falling","visionary","bold","perilous"];return e[k.randomNumber(e.length)]}},{key:"bookGerund",value:function(){var e=["killing","murdering","watching","examining","enchanting","destroying","defying","betraying","protecting","silencing","bearing","fighting"];return e[k.randomNumber(e.length)]}},{key:"bookPreposition",value:function(){var e=["and","in","of","with","against","for","to","towards"];return e[k.randomNumber(e.length)]}},{key:"bookAbout",value:function(){var t=["treatise","essay","monograph","discourse","dissertation","primer","history","enchiridion"],a=t[k.randomNumber(t.length)];k.randomBoolean()?a=(e.startsWithVowel(a)?"an ":"a ")+a:a+="s";var n=["about","on","concerning","regarding","on the subject of"];return a+" "+n[k.randomNumber(n.length)]}}]),e}();T.model=[],T.maxLength=0;var P=["default","cavern","dirt","flagstone","floorboard","grassland","pit","sand","snow","water","custom"],V=["single","double","arch","bars"],A=["stairs","spiral","ladder"],R=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"scatterCombatants",value:function(t,a,n){if(t.items=t.items.filter((function(e){return!a.map((function(e){return e.id})).includes(e.id)})),t.items.filter((function(e){return"tile"===e.type})).length>0){var r=null;if(n){var s=t.areas.find((function(e){return e.id===n}));s&&(r={minX:s.x,minY:s.y,maxX:s.x+s.width-1,maxY:s.y+s.height-1})}var o=r||e.mapDimensions(t.items);o&&a.forEach((function(a){for(var n=[],r=o.minX;r<=o.maxX;++r)for(var s=o.minY;s<=o.maxY;++s){e.canAddMonsterHere(t,a,r,s)&&n.push({x:r,y:s})}if(n.length>0){var i=n[k.randomNumber(n.length)],c=C.miniSize(a.displaySize),l=w.createMapItem();l.id=a.id,l.type=a.type,l.x=i.x,l.y=i.y,l.height=c,l.width=c,t.items.push(l)}}))}}},{key:"mapDimensions",value:function(e){var t=e.filter((function(e){return"tile"===e.type}));if(t.length>0){var a=t[0].x,n=t[0].y,r=t[0].x+t[0].width-1,s=t[0].y+t[0].height-1;return t.forEach((function(e){a=Math.min(a,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x+e.width-1),s=Math.max(s,e.y+e.height-1)})),{minX:a,minY:n,maxX:r,maxY:s}}return null}},{key:"canAddTileHere",value:function(t,a,n,r,s,o,i){for(var c=[],l=n-i,u=a+(r-1)+o,d=n+(s-1)+i,m=a-o;m<=u;++m)for(var p=l;p<=d;++p){var h=e.itemsAt(t,m,p).every((function(e){return"tile"!==e.type}));c.push(h)}return c.every((function(e){return e}))}},{key:"canAddMonsterHere",value:function(t,a,n,r){for(var s=[],o=C.miniSize(a.displaySize),i=n+Math.max(1,o)-1,c=r+Math.max(1,o)-1,l=n;l<=i;++l)for(var u=r;u<=c;++u){var d=e.itemsAt(t,l,u),m=d.length>0&&d.every((function(e){return"tile"===e.type}));s.push(m)}return s.every((function(e){return e}))}},{key:"itemsAt",value:function(e,t,a){return e.items.filter((function(e){var n=e.x,r=e.x+e.width-1,s=e.y,o=e.y+e.height-1;return t>=n&&t<=r&&a>=s&&a<=o}))}},{key:"rotateMap",value:function(e){e.items.forEach((function(e){var t=-1*(e.y+e.height-1),a=e.x,n=e.height,r=e.width;e.x=t,e.y=a,e.width=n,e.height=r,e.content&&(e.content.orientation="horizontal"===e.content.orientation?"vertical":"horizontal")})),e.areas.forEach((function(e){var t=-1*(e.y+e.height-1),a=e.x,n=e.height,r=e.width;e.x=t,e.y=a,e.width=n,e.height=r}))}},{key:"mapSize",value:function(t){return t.items.filter((function(e){return"tile"===e.type})).reduce((function(t,a){return t+e.mapTileSize(a)}),0)}},{key:"mapTileSize",value:function(e){return"tile"===e.type?e.width*e.height:0}},{key:"generate",value:function(t,a){switch(t){case"dungeon":for(var n=0;n<10;)e.addRoom(a)&&(n+=1);break;case"delve":for(var r=0;r<3;)e.addRoom(a)&&(r+=1);break;case"room":for(var s=!1;!s;)s=e.addRoom(a)}}},{key:"addRoom",value:function(t){var a=w.createMapItem();a.type="tile",a.terrain="default",a.style="square",a.width=C.dieRoll(6,2)+2,a.height=C.dieRoll(6,2)+2;var n=null,r=e.mapDimensions(t.items);if(r){r.minX-=a.width+2,r.minY-=a.height+2,r.maxX+=2,r.maxY+=2;for(var s=[],o=r.minX;o!==r.maxX;++o)for(var i=r.minY;i!==r.maxY;++i){e.canAddTileHere(t,o,i,a.width,a.height,1,1)&&s.push({x:o,y:i})}if(!(s.length>0))return!1;var c=k.randomNumber(s.length);a.x=s[c].x,a.y=s[c].y;var l=[];if(t.items.filter((function(e){return"tile"===e.type})).forEach((function(n){var r=Math.max(a.x,n.x),s=Math.min(a.x+a.width-1,n.x+n.width-1);if(s-r+1>=2)for(var o=Math.min(a.y+a.height-1,n.y+n.height-1)+1,i=Math.max(a.y,n.y)-1,c=r;c<=s-1;++c){var u=w.createMapItem();u.type="tile",u.terrain="default",u.style="square",u.x=c,u.y=o,u.width=2,u.height=i-o+1,e.canAddTileHere(t,u.x,u.y,u.width,u.height,1,0)&&l.push({tile:u,horizontal:!1})}var d=Math.max(a.y,n.y),m=Math.min(a.y+a.height-1,n.y+n.height-1);if(m-d+1>=2)for(var p=Math.min(a.x+a.width-1,n.x+n.width-1)+1,h=Math.max(a.x,n.x)-1,f=d;f<=m-1;++f){var v=w.createMapItem();v.type="tile",v.terrain="default",v.style="square",v.x=p,v.y=f,v.width=h-p+1,v.height=2,e.canAddTileHere(t,v.x,v.y,v.width,v.height,0,1)&&l.push({tile:v,horizontal:!0})}})),!(l.length>0))return!1;var u=k.randomNumber(l.length),d=l[u];if(!d.horizontal&&1===d.tile.height||d.horizontal&&1===d.tile.width)2===C.dieRoll(2)&&(d.tile.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:d.horizontal?"vertical":"horizontal"});else{if(!d.horizontal&&d.tile.height>=4||d.horizontal&&d.tile.width>=4){if(2===C.dieRoll(2)){var m=w.createMapItem();m.type="tile",m.terrain="default",m.style="square",m.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:""},d.horizontal?(m.x=d.tile.x,m.y=d.tile.y,m.width=1,m.height=2,m.content.orientation="vertical",d.tile.x+=1,d.tile.width-=1):(m.x=d.tile.x,m.y=d.tile.y,m.width=2,m.height=1,m.content.orientation="horizontal",d.tile.y+=1,d.tile.height-=1),t.items.push(m)}if(2===C.dieRoll(2)){var p=w.createMapItem();p.type="tile",p.terrain="default",p.style="square",p.content={type:"doorway",style:e.getRandomDoorwayStyle(),orientation:""},d.horizontal?(p.x=d.tile.x+d.tile.width-1,p.y=d.tile.y,p.width=1,p.height=2,p.content.orientation="vertical",d.tile.width-=1):(p.x=d.tile.x,p.y=d.tile.y+d.tile.height-1,p.width=2,p.height=1,p.content.orientation="horizontal",d.tile.height-=1),t.items.push(p)}}(!d.horizontal&&d.tile.height<=4||d.horizontal&&d.tile.width<=4)&&3===C.dieRoll(3)&&(d.tile.content={type:"stairway",style:"stairs",orientation:d.horizontal?"vertical":"horizontal"})}n=this.getRoomAdjunct(a,t),t.items.push(d.tile),t.items.push(a),n&&t.items.push(n)}else n=this.getRoomAdjunct(a,t),t.items.push(a),n&&t.items.push(n);var h=[a];n&&h.push(n);var f=this.mapDimensions(h);if(f){var v=w.createMapArea();v.name=T.capitalise(T.generateRoomName()),v.x=f.minX-1,v.y=f.minY-1,v.width=f.maxX-f.minX+3,v.height=f.maxY-f.minY+3,t.areas.push(v)}return!0}},{key:"getRoomAdjunct",value:function(t,a){if(k.randomBoolean())return null;var n=0,r=0,s=[];switch(k.randomNumber(2)){case 0:n=k.randomNumber(t.width-2)+2,r=C.dieRoll(4,2);for(var o=t.width-n,i=0;i!==o;++i){var c=t.x+i,l=t.y-r;e.canAddTileHere(a,c,l,n,r,1,1)&&s.push({x:c,y:l});var u=t.y+t.height;e.canAddTileHere(a,c,u,n,r,1,1)&&s.push({x:c,y:u})}break;case 1:n=C.dieRoll(4,2),r=k.randomNumber(t.height-2)+2;for(var d=t.height-r,m=0;m!==d;++m){var p=t.y+m,h=t.x-n;e.canAddTileHere(a,h,p,n,r,1,1)&&s.push({x:h,y:p});var f=t.x+t.width;e.canAddTileHere(a,f,p,n,r,1,1)&&s.push({x:f,y:p})}}if(s.length>0){var v=s[k.randomNumber(s.length)],g=w.createMapItem();return g.type="tile",g.terrain="default",g.style="square",g.x=v.x,g.y=v.y,g.width=n,g.height=r,g}return null}},{key:"getRandomDoorwayStyle",value:function(){var e=k.randomNumber(V.length);return V[e]}},{key:"getViewport",value:function(e,t){if(t){var a=e.areas.find((function(e){return e.id===t}));if(a)return{minX:a.x,minY:a.y,maxX:a.x+a.width-1,maxY:a.y+a.height-1}}return null}},{key:"add",value:function(e,t,a,n){var r=e.items.find((function(e){return e.id===t.id}));if(!r){(r=w.createMapItem()).id=t.id,r.type=t.type;var s=C.miniSize(t.displaySize);r.height=s,r.width=s,e.items.push(r)}r.x=a,r.y=n}},{key:"move",value:function(e,t,a){var n=e.items.find((function(e){return e.id===t}));if(n)switch(a){case"N":n.y-=1;break;case"NE":n.x+=1,n.y-=1;break;case"E":n.x+=1;break;case"SE":n.x+=1,n.y+=1;break;case"S":n.y+=1;break;case"SW":n.x-=1,n.y+=1;break;case"W":n.x-=1;break;case"NW":n.x-=1,n.y-=1}}},{key:"remove",value:function(e,t){var a=e.items.find((function(e){return e.id===t}));if(a){var n=e.items.indexOf(a);e.items.splice(n,1)}}}]),e}(),L=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"matchParty",value:function(t,a){return!!e.match(t,a.name)||a.pcs.some((function(a){return e.matchPC(t,a)}))}},{key:"matchPC",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.player)||(!!e.match(t,a.race)||(!!e.match(t,a.classes)||a.companions.some((function(a){return e.matchCompanion(t,a)})))))}},{key:"matchCompanion",value:function(t,a){return!!e.match(t,a.name)}},{key:"matchGroup",value:function(t,a){return!!e.match(t,a.name)||a.monsters.some((function(a){return e.matchMonster(t,a)}))}},{key:"matchMonster",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.category)||(!!e.match(t,a.tag)||(!!e.match(t,a.senses)||(!!e.match(t,a.languages)||(!!e.match(t,a.equipment)||a.traits.some((function(a){return e.matchTrait(t,a)})))))))}},{key:"matchTrait",value:function(t,a){return!!e.match(t,a.name)||(!!e.match(t,a.usage)||!!e.match(t,a.text))}},{key:"matchEncounter",value:function(t,a,n){return!!e.match(t,a.name)||(!!a.waves.some((function(a){return e.matchEncounterWave(t,a,(function(e){return n(e)}))}))||a.slots.some((function(a){return e.matchEncounterSlot(t,a,(function(e){return n(e)}))})))}},{key:"matchEncounterWave",value:function(t,a,n){return!!e.match(t,a.name)||a.slots.some((function(a){return e.matchEncounterSlot(t,a,(function(e){return n(e)}))}))}},{key:"matchEncounterSlot",value:function(t,a,n){var r=n(a.monsterID);return!(!r||!e.match(t,r.name))}},{key:"matchMap",value:function(t,a){return!!e.match(t,a.name)||a.areas.some((function(a){return e.matchMapArea(t,a)}))}},{key:"matchMapArea",value:function(t,a){return!!e.match(t,a.name)||!!e.match(t,a.text)}},{key:"match",value:function(e,t){if(!e)return!0;var a=!0;return e.toLowerCase().split(" ").forEach((function(e){-1===t.toLowerCase().indexOf(e)&&(a=!1)})),a}}]),e}(),z=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"getMonsterCount",value:function(e,t){var a=0,n=[];return null!==t&&t!==e.id||(n=n.concat(e.slots)),e.waves.forEach((function(e){null!==t&&t!==e.id||(n=n.concat(e.slots))})),n.filter((function(e){return"foe"===e.faction})).forEach((function(e){a+=e.count})),a}},{key:"getEncounterXP",value:function(e,t,a){var n=0,r=[];return null!==t&&t!==e.id||(r=r.concat(e.slots)),e.waves.forEach((function(e){null!==t&&t!==e.id||(r=r.concat(e.slots))})),r.filter((function(e){return"foe"===e.faction})).forEach((function(e){var t=a(e.monsterID);t&&(n+=C.experience(t.challenge)*e.count)})),n}},{key:"getAdjustedEncounterXP",value:function(e,t,a){var n=this.getMonsterCount(e,t);return this.getEncounterXP(e,t,a)*C.experienceFactor(n)}},{key:"getCombatXP",value:function(e){var t=0;return e.combatants.filter((function(e){return"monster"===e.type})).filter((function(e){return"foe"===e.faction})).forEach((function(e){var a=e;t+=C.experience(a.challenge)})),t}},{key:"getFilterDescription",value:function(e){var t="";"all sizes"!==e.size&&(t+=t?" "+e.size:e.size),"all types"!==e.category&&(t+=t?" "+e.category:e.category),"all roles"!==e.role&&(t+=t?" "+e.role:e.role);var a=C.challenge(e.challengeMin),n=C.challenge(e.challengeMax);return t+=" monsters of cr "+(e.challengeMin===e.challengeMax?a:a+" to "+n)}},{key:"buildEncounter",value:function(t,a,n,r,s){var o=[];for(r.forEach((function(t){t.monsters.filter((function(t){return e.matchMonster(t,n)})).forEach((function(e){return o.push({id:e.id,monsterName:e.name,groupName:t.name})}))}));e.getAdjustedEncounterXP(t,null,(function(e){return s(e)}))<a;)if(t.slots.length>0&&C.dieRoll(3)>1){var i=k.randomNumber(t.slots.length);t.slots[i].count+=1}else{var c=o.filter((function(e){return!t.slots.find((function(t){return t.monsterID===e.id}))}));if(c.length>0){var l=k.randomNumber(c.length),u=w.createEncounterSlot();u.monsterID=c[l].id,t.slots.push(u)}else if(0===t.slots.length)break}for(var d=function(){var e=k.randomNumber(t.slots.length),a=t.slots[e];t.slots=t.slots.filter((function(e){return e.id!==a.id}));var n=w.createEncounterWave();n.name="wave "+(t.waves.length+2),n.slots.push(a),t.waves.push(n)};t.slots.length>1&&10===C.dieRoll(10);)d()}},{key:"matchMonster",value:function(e,t){return!(e.challenge<t.challengeMin)&&(!(e.challenge>t.challengeMax)&&(!(""!==t.name&&!L.match(t.name,e.name))&&(("all types"===t.category||e.category===t.category)&&(("all sizes"===t.size||e.size===t.size)&&("all roles"===t.role||e.role===t.role)))))}},{key:"sortEncounter",value:function(t){e.sortEncounterSlots(t),t.waves.forEach((function(t){return e.sortEncounterSlots(t)}))}},{key:"sortEncounterSlots",value:function(e){var t=[];e.slots.forEach((function(e){var a=t.find((function(t){return t.monsterID===e.monsterID&&t.roles.join(",")===e.roles.join(",")}));a?a.count+=e.count:(a=e,t.push(e))})),e.slots=t,e.slots.sort((function(e,t){return e.monsterID<t.monsterID?-1:e.monsterID>t.monsterID?1:0}))}},{key:"sortCombatants",value:function(e){e.combatants.sort((function(e,t){return e.initiative&&t.initiative&&e.initiative<t.initiative?1:e.initiative&&t.initiative&&e.initiative>t.initiative||e.displayName<t.displayName?-1:e.displayName>t.displayName?1:0}))}},{key:"combatHasLairActions",value:function(e){var t=!1;return e.combatants.filter((function(e){return!e.pending&&e.active&&!e.defeated})).forEach((function(e){var a=e;a&&a.traits&&a.traits.some((function(e){return"lair"===e.type}))&&(t=!0)})),t}},{key:"encounterHasMonster",value:function(e,t){var a=e.slots.map((function(e){return e.monsterID}));return e.waves.forEach((function(e){a=a.concat(e.slots.map((function(e){return e.monsterID})))})),!!a.find((function(e){return e===t}))}},{key:"convertPCToCombatant",value:function(e){var t=JSON.parse(JSON.stringify(e));return t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e.name,t.displaySize=e.size,t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.altitude=0,t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t}},{key:"convertMonsterToCombatant",value:function(e,t,a,n,r){var s=JSON.parse(JSON.stringify(e));return s.id=k.guid(),s.current=!1,s.pending=!1,s.active=!0,s.defeated=!1,s.faction=r,s.displayName=n,s.displaySize=e.size,s.showOnMap=!0,s.initiative=t,s.hpMax=a,s.hpCurrent=a,s.hpTemp=0,s.conditions=[],s.tags=[],s.note="",s.altitude=0,s.aura={radius:0,style:"rounded",color:"#005080"},s.mountID=null,s.mountType="controlled",s}},{key:"convertCompanionToCombatant",value:function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return t.id=e?e.id:k.guid(),t.type="companion",t.current=!1,t.pending=!0,t.active=!1,t.defeated=!1,t.faction="ally",t.displayName=e?e.name:"companion",t.displaySize="medium",t.showOnMap=!0,t.initiative=10,t.hpMax=null,t.hpCurrent=null,t.hpTemp=null,t.conditions=[],t.tags=[],t.note="",t.altitude=0,t.aura={radius:0,style:"rounded",color:"#005080"},t.mountID=null,t.mountType="controlled",t}},{key:"convertPlaceholderToCombatant",value:function(){return{id:k.guid(),type:"placeholder",current:!1,pending:!1,active:!0,defeated:!1,faction:"neutral",displayName:"lair actions",displaySize:"medium",showOnMap:!0,initiative:20,hpMax:null,hpCurrent:null,hpTemp:null,conditions:[],tags:[],note:"",altitude:0,aura:{radius:0,style:"rounded",color:"#005080"},mountID:null,mountType:"controlled"}}},{key:"encounterTemplates",value:function(){return[{name:"battlefield control",slots:[{roles:["controller"],count:1},{roles:["skirmisher","sneak"],count:5}]},{name:"commander and troops",slots:[{roles:["controller","soldier"],count:1},{roles:["soldier","tank"],count:5}]},{name:"dragon's den",slots:[{roles:["boss"],count:1}]},{name:"double line",slots:[{roles:["soldier","tank"],count:3},{roles:["artillery","controller"],count:2}]},{name:"wolf pack",slots:[{roles:["skirmisher"],count:6}]}]}},{key:"getActiveCombatants",value:function(t,a,n){var r=t.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""}));return t.combatants.filter((function(e){return!r.includes(e.id)})).filter((function(e){return e.active||e.defeated&&n})).filter((function(e){return!a||"pc"===e.type||e.showOnMap})).filter((function(e){return!a||"monster"!==e.type||!t.map||!!t.map.items.find((function(t){return t.id===e.id}))})).filter((function(a){return"placeholder"!==a.type||e.combatHasLairActions(t)}))}},{key:"getMountsAndRiders",value:function(e,t){var a=e.map((function(e){return t.find((function(t){return t.id===e}))})).filter((function(e){return void 0!==e})),n=a.map((function(e){return t.find((function(t){return t.id===e.mountID}))})).filter((function(e){return void 0!==e})),r=a.map((function(e){return t.find((function(t){return t.mountID===e.id}))})).filter((function(e){return void 0!==e}));return a.concat(n).concat(r)}},{key:"setMountPositions",value:function(e,t){e.forEach((function(e){if(e.mountID){var a=t.items.find((function(t){return t.id===e.id})),n=t.items.find((function(t){return t.id===e.mountID}));a&&n&&(n.x=a.x,n.y=a.y)}}))}}]),e}(),q=a(102),F=a.n(q),G=a(103),B=a.n(G),U=a(78),H=a.n(U),W=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"getDefaultData",value:function(){return{people:[],messages:[],party:null,shared:{type:"nothing",data:null,images:[],additional:{}},options:{allowChat:!1,allowControls:!1}}}},{key:"getID",value:function(){return this.peer?this.peer.id:""}},{key:"getPartyID",value:function(){return this.data.party?this.data.party.id:""}},{key:"getName",value:function(e){var t=this.data.people.find((function(t){return t.id===e}));return t?t.name:"unknown person"}},{key:"getStatus",value:function(e){var t=this.data.people.find((function(t){return t.id===e}));return t?t.status:""}},{key:"getCharacterID",value:function(e){var t=this.data.people.find((function(t){return t.id===e}));return t?t.characterID:""}},{key:"getCurrentName",value:function(t){if(this.data.party){var a=this.data.people.find((function(e){return e.id===t}));if(a&&a.characterID){var n=this.data.party.pcs.find((function(e){return e.id===a.characterID}));if(n)return n.name}}return e.getName(t)}},{key:"getCombatant",value:function(t){var a;return null!==(a=e.getCombatants().find((function(e){return e.id===t})))&&void 0!==a?a:null}},{key:"getCombatants",value:function(){return"combat"===e.data.shared.type||"exploration"===e.data.shared.type?e.data.shared.data.combatants:[]}},{key:"getMap",value:function(){return"combat"===e.data.shared.type||"exploration"===e.data.shared.type?e.data.shared.data.map:null}},{key:"createTextPacket",value:function(t,a,n,r){return{type:"message",payload:{id:k.guid(),from:e.getID(),to:t,type:"text",data:{text:a,language:n,untranslated:r}}}}},{key:"createLinkPacket",value:function(t,a){return{type:"message",payload:{id:k.guid(),from:e.getID(),to:t,type:"link",data:{url:a}}}}},{key:"createImagePacket",value:function(t,a){return{type:"message",payload:{id:k.guid(),from:e.getID(),to:t,type:"image",data:{image:a}}}}},{key:"createRollPacket",value:function(t,a){return{type:"message",payload:{id:k.guid(),from:e.getID(),to:t,type:"roll",data:{roll:a}}}}},{key:"createCardPacket",value:function(t,a){return{type:"message",payload:{id:k.guid(),from:e.getID(),to:t,type:"card",data:{card:a}}}}},{key:"packetToString",value:function(e){var t=JSON.stringify(e);return F.a.compressToUTF16(t)}},{key:"stringToPacket",value:function(e){var t=F.a.decompressFromUTF16(e);return JSON.parse(t)}},{key:"processPacket",value:function(t){switch(t.type){case"update":if(t.payload.people&&(this.data.people=t.payload.people),t.payload.party&&(this.data.party=t.payload.party),t.payload.shared&&(this.data.shared=t.payload.shared,e.previousReceivedSharedState=JSON.parse(JSON.stringify(this.data.shared))),t.payload.sharedDiff){var a=t.payload.sharedDiff;H.a.applyDiff(e.data.shared,a),e.previousReceivedSharedState=JSON.parse(JSON.stringify(this.data.shared))}t.payload.options&&(this.data.options=t.payload.options);break;case"player-info":var n=t.payload.player,r=this.data.people.find((function(e){return e.id===n}));r&&(r.status=t.payload.status,r.characterID=t.payload.characterID);break;case"character-info":if(e.data.party){var s=t.payload.pc,o=e.data.party.pcs.find((function(e){return e.id===s.id}));if(o){var i=e.data.party.pcs.indexOf(o);-1!==i&&(e.data.party.pcs[i]=s)}else e.data.party.pcs.push(s);k.sort(e.data.party.pcs)}break;case"message":var c={id:t.payload.id,from:t.payload.from,to:t.payload.to,type:t.payload.type,data:t.payload.data};this.data.messages.push(c),c.from!==e.getID()&&(0===c.to.length||c.to.includes(e.getID()))&&this.onNewMessage&&this.onNewMessage(c);break;case"prompt":if(this.onPrompt){var l=t.payload.prompt,u=t.payload.characterID;this.onPrompt(l,u)}break;case"roll-result":if("initiative"===t.payload.roll){var d=t.payload.id,m=e.getCombatants().find((function(e){return e.id===d}));if(m&&(m.initiative=t.payload.result,m.pending=!1,m.active=!0),"combat"===e.data.shared.type){var p=e.data.shared.data;z.sortCombatants(p)}}break;case"player-shared-update":if(t.payload.shared&&(this.data.shared=t.payload.shared),t.payload.sharedDiff){var h=t.payload.sharedDiff;H.a.applyDiff(e.data.shared,h)}}}},{key:"finish",value:function(){e.peer&&(e.peer.destroy(),e.peer=null),e.data=this.getDefaultData()}}]),e}();W.peer=null,W.data=W.getDefaultData(),W.sentImageIDs=[],W.previousSentSharedState=null,W.previousReceivedSharedState=null,W.onNewMessage=void 0,W.onPrompt=void 0;var J=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"getState",value:function(){return this.state}},{key:"init",value:function(){var e=this;if("not started"===this.state){this.state="starting",this.onStateChanged&&this.onStateChanged();var t="dm-"+k.guid();W.peer=new B.a(t,{host:"dojoserver.herokuapp.com",port:443,secure:!0}),W.peer.on("open",(function(){setInterval((function(){return e.sendPulse()}),6e4),e.state="started",e.onStateChanged&&e.onStateChanged()})),W.peer.on("close",(function(){e.shutdown()})),W.peer.on("disconnected",(function(){e.shutdown()})),W.peer.on("error",(function(t){console.error(t),e.shutdown()})),W.peer.on("connection",(function(t){e.connections.push(t),t.on("open",(function(){e.sendPeopleUpdate(),e.sendPartyUpdate(t),e.sendSharedUpdate(t),e.sendOptionsUpdate(t),e.onNewConnection&&e.onNewConnection(t.label),e.onDataChanged&&e.onDataChanged()})),t.on("close",(function(){var a=e.connections.indexOf(t);-1!==a&&e.connections.splice(a,1),e.sendPeopleUpdate()})),t.on("error",(function(a){console.error(a),e.kick(t.peer)})),t.on("data",(function(t){var a=W.stringToPacket(t);e.onDataReceived(a)}))}))}}},{key:"shutdown",value:function(){this.connections.forEach((function(e){return e.close()})),this.connections=[],W.finish(),this.state="not started",this.onStateChanged&&this.onStateChanged()}},{key:"kick",value:function(e){var t=this.connections.filter((function(e){return e.open})).find((function(t){return t.peer===e}));if(t){t.close();var a=this.connections.indexOf(t);-1!==a&&this.connections.splice(a,1),this.sendPeopleUpdate()}}},{key:"setOption",value:function(e,t){W.data.options[e]=t,this.onDataChanged&&this.onDataChanged();var a={type:"update",payload:{options:W.data.options}};this.broadcast(a)}},{key:"sendPulse",value:function(){this.sendPeopleUpdate(),this.sendPartyUpdate(),this.sendSharedUpdate(),this.sendOptionsUpdate()}},{key:"sendPeopleUpdate",value:function(){var e=this.connections.filter((function(e){return e.open})).map((function(e){return{id:e.peer,name:e.label,status:W.getStatus(e.peer),characterID:W.getCharacterID(e.peer)}}));k.sort(e),e.unshift({id:W.getID(),name:"DM",status:"",characterID:""});var t={type:"update",payload:{people:e}};W.processPacket(t),this.broadcast(t)}},{key:"sendPartyUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={type:"update",payload:{party:W.data.party}};this.broadcast(t,e)}},{key:"sendSharedUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={type:"update",payload:{shared:W.data.shared}};this.broadcast(t,e),null===e&&(W.previousSentSharedState=JSON.parse(JSON.stringify(W.data.shared)))}},{key:"sendSharedDiffUpdate",value:function(){var e=this;k.debounce((function(){var t={type:"update",payload:{shared:W.data.shared}},a=!0;if(null!==W.previousSentSharedState){var n=H.a.getDiff(W.previousSentSharedState,W.data.shared);a=n.length>0,t.payload={sharedDiff:n}}a&&(e.broadcast(t),W.previousSentSharedState=JSON.parse(JSON.stringify(W.data.shared)))}),500)()}},{key:"sendOptionsUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={type:"update",payload:{options:W.data.options}};this.broadcast(t,e)}},{key:"sendMessage",value:function(e,t,a,n){this.onDataReceived(W.createTextPacket(e,t,a,n))}},{key:"sendLink",value:function(e,t){this.onDataReceived(W.createLinkPacket(e,t))}},{key:"sendImage",value:function(e,t){this.onDataReceived(W.createImagePacket(e,t))}},{key:"sendRoll",value:function(e,t){this.onDataReceived(W.createRollPacket(e,t))}},{key:"sendCard",value:function(e,t){this.onDataReceived(W.createCardPacket(e,t))}},{key:"setParty",value:function(e){W.data.party=e,this.onDataChanged&&this.onDataChanged(),this.sendPartyUpdate()}},{key:"shareNothing",value:function(){W.previousSentSharedState=null,W.previousReceivedSharedState=null,W.data.shared={type:"nothing",data:null,images:[],additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}},{key:"shareCombat",value:function(e){var t=[];e.map&&e.map.items.filter((function(e){return"custom"===e.terrain&&""!==e.customBackground})).forEach((function(e){var a=j.getImage(e.customBackground);a&&(W.sentImageIDs.includes(a.id)||t.push(a))})),W.previousSentSharedState=null,W.previousReceivedSharedState=null,W.data.shared={type:"combat",data:e,images:t,additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate(),t.forEach((function(e){return W.sentImageIDs.push(e.id)}))}},{key:"shareExploration",value:function(e){var t=[];e.map.items.filter((function(e){return"custom"===e.terrain&&""!==e.customBackground})).forEach((function(e){var a=j.getImage(e.customBackground);a&&(W.sentImageIDs.includes(a.id)||t.push(a))})),W.previousSentSharedState=null,W.previousReceivedSharedState=null,W.data.shared={type:"exploration",data:e,images:t,additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate(),t.forEach((function(e){return W.sentImageIDs.push(e.id)}))}},{key:"shareHandout",value:function(e){W.previousSentSharedState=null,W.previousReceivedSharedState=null,W.data.shared={type:"handout",data:e,images:[],additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}},{key:"shareMonster",value:function(e){W.previousSentSharedState=null,W.previousReceivedSharedState=null,W.data.shared={type:"monster",data:e,images:[],additional:{}},this.onDataChanged&&this.onDataChanged(),this.sendSharedUpdate()}},{key:"prompt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a={type:"prompt",payload:{prompt:e,characterID:t}};this.broadcast(a)}},{key:"onDataReceived",value:function(e){W.processPacket(e),this.onDataChanged&&this.onDataChanged(),"player-shared-update"===e.type?this.sendSharedDiffUpdate():this.broadcast(e)}},{key:"broadcast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=W.packetToString(e);t?t.send(a):this.connections.filter((function(e){return e.open})).forEach((function(e){return e.send(a)}))}}]),e}();J.connections=[],J.state="not started",J.onStateChanged=void 0,J.onDataChanged=void 0,J.onNewConnection=void 0;var _=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"getState",value:function(){return this.state}},{key:"connect",value:function(e,t){var a=this;if("not connected"===this.state){this.state="connecting",this.onStateChanged&&this.onStateChanged();var n="player-"+k.guid();W.peer=new B.a(n,{host:"dojoserver.herokuapp.com",port:443,secure:!0}),W.peer.on("open",(function(){if(W.peer){var n=W.peer.connect(e,{label:t,reliable:!0});a.connection=n,n.on("open",(function(){a.state="connected",a.onStateChanged&&a.onStateChanged()})),n.on("close",(function(){a.disconnect()})),n.on("error",(function(e){console.error(e),a.disconnect()})),n.on("data",(function(e){try{var t=W.stringToPacket(e);W.processPacket(t),a.onDataChanged&&a.onDataChanged()}catch(n){console.error(n)}}))}})),W.peer.on("close",(function(){a.disconnect()})),W.peer.on("disconnected",(function(){a.disconnect()})),W.peer.on("error",(function(e){console.error(e),a.disconnect()}))}}},{key:"disconnect",value:function(){this.connection&&(this.connection.close(),this.connection=null),W.finish(),this.state="not connected",this.onStateChanged&&this.onStateChanged()}},{key:"sendUpdate",value:function(e,t){this.sendPacket({type:"player-info",payload:{player:W.getID(),status:e,characterID:t}})}},{key:"sendMessage",value:function(e,t,a,n){this.sendPacket(W.createTextPacket(e,t,a,n))}},{key:"sendLink",value:function(e,t){this.sendPacket(W.createLinkPacket(e,t))}},{key:"sendImage",value:function(e,t){this.sendPacket(W.createImagePacket(e,t))}},{key:"sendRoll",value:function(e,t){this.sendPacket(W.createRollPacket(e,t))}},{key:"sendCard",value:function(e,t){this.sendPacket(W.createCardPacket(e,t))}},{key:"sendCharacter",value:function(e){this.sendPacket({type:"character-info",payload:{pc:e}})}},{key:"sendRollResult",value:function(e,t){this.sendPacket({type:"roll-result",payload:{id:W.getCharacterID(W.getID()),roll:e,result:t}})}},{key:"sendSharedUpdate",value:function(){var e=this;k.debounce((function(){var t={type:"update",payload:{shared:W.data.shared}},a=!0;if(null!==W.previousReceivedSharedState){var n=H.a.getDiff(W.previousReceivedSharedState,W.data.shared);a=n.length>0,t.payload={sharedDiff:n}}a&&(e.sendPacket(t),W.previousReceivedSharedState=JSON.parse(JSON.stringify(W.data.shared)))}),500)()}},{key:"sendPacket",value:function(e){this.connection&&this.connection.send(W.packetToString(e))}}]),e}();_.connection=null,_.state="not connected",_.onStateChanged=void 0,_.onDataChanged=void 0;var Y=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{for(var t=this.props.itemsPerRow?this.props.itemsPerRow:this.props.options.length,a=Math.ceil(this.props.options.length/t),n=[],s=0;s!==a;++s)n.push([]);this.props.options.forEach((function(a){var s=e.props.options.indexOf(a),o=Math.floor(s/t);n[o].push(r.a.createElement(X,{key:a.id,option:a,selected:a.id===e.props.selectedID,onSelect:function(t){return e.props.onSelect(t)}}))}));var o=n.map((function(e){var t=n.indexOf(e);return r.a.createElement("div",{key:t,className:"selector-row"},e)}));return r.a.createElement("div",{className:this.props.disabled?"selector disabled":"selector"},o)}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Y.defaultProps={itemsPerRow:null,disabled:!1};var X=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="option";return this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled"),r.a.createElement("div",{key:this.props.option.id,className:t,title:this.props.option.text,onClick:function(t){return e.click(t)},role:"button"},this.props.option.text)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),K=a(307),Z=a(267),Q=a(316),$=a(306),ee=a(315),te=a(266),ae=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(e){if(e.target){var a=e.target.result;t.props.setPortrait(a)}},a.readAsDataURL(e),!1}},{key:"getEditor",value:function(){var e=this,t=null,a=null;return""!==this.props.source.portrait?(t=r.a.createElement("img",{className:"circle",src:this.props.source.portrait,alt:"portrait"}),a=r.a.createElement(p.a,{className:"clear",onClick:function(){return e.props.clear()}})):t=r.a.createElement("div",null,r.a.createElement(te.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"),r.a.createElement("p",{className:"ant-upload-text"},"try to upload small images if possible"))),r.a.createElement("div",{className:"portrait editing"},r.a.createElement("div",{className:"section centered"},t,a))}},{key:"getDisplay",value:function(){if(""===this.props.source.portrait)return null;var e="portrait";return this.props.inline?e+=" inline":e+=" section centered",r.a.createElement("div",{className:e},r.a.createElement("img",{className:"circle",src:this.props.source.portrait,alt:"portrait"}))}},{key:"render",value:function(){try{return null!==this.props.setPortrait?this.getEditor():this.getDisplay()}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ae.defaultProps={inline:!1,setPortrait:null,clear:null};var ne=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getTags",value:function(){var e=[],t=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(t+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(r.a.createElement($.a,{key:"tag-main"},t)),this.props.monster.alignment&&e.push(r.a.createElement($.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(r.a.createElement($.a,{key:"tag-cr"},"cr ",C.challenge(this.props.monster.challenge))),e}},{key:"render",value:function(){var e=this;try{var t=this.props.monster.name||"unnamed monster";return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:t},t),r.a.createElement(Q.a,{onClick:function(){return e.props.selectMonster(e.props.monster)}})),r.a.createElement("div",{className:"card-content"},r.a.createElement(ae,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags())))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),re=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.onChecked(!this.props.checked)}},{key:"render",value:function(){var e=this;try{var t="checkbox "+this.props.display;this.props.checked&&(t+=" checked"),this.props.disabled&&(t+=" disabled");var a=null;return"switch"===this.props.display&&(a=r.a.createElement("div",{className:"toggle-container"},r.a.createElement("div",{className:"toggle"}))),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)},role:"button"},r.a.createElement("div",{className:"checkbox-label"},this.props.label),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);re.defaultProps={display:"switch",disabled:!1};var se=a(317),oe=a(104),ie=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"keyDown",value:function(e){"Enter"===e.key&&this.props.onPressEnter&&this.props.onPressEnter()}},{key:"render",value:function(){var e=this;try{var t="";return this.props.disabled&&(t="disabled"),this.props.noMargins&&(t+=" no-margins"),this.props.multiLine?r.a.createElement(oe.DebounceInput,{element:"textarea",minLength:this.props.minLength,debounceTimeout:this.props.debounce?500:100,className:t,value:this.props.text,placeholder:this.props.placeholder,rows:5,onChange:function(t){return e.props.onChange(t.target.value)}}):r.a.createElement(oe.DebounceInput,{minLength:this.props.minLength,debounceTimeout:this.props.debounce?500:100,className:t,value:this.props.text,placeholder:this.props.placeholder,onChange:function(t){return e.props.onChange(t.target.value)},onKeyDown:function(t){return e.keyDown(t)}})}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ie.defaultProps={placeholder:"",multiLine:!1,minLength:0,disabled:!1,debounce:!0,noMargins:!1,onPressEnter:null};var ce=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={open:!1,filterText:""},n}return Object(c.a)(a,[{key:"toggleOpen",value:function(e){e.stopPropagation(),this.setState({open:!this.state.open})}},{key:"setFilterText",value:function(e){this.setState({filterText:e})}},{key:"select",value:function(e){this.setState({open:!1}),this.props.onSelect(e)}},{key:"clear",value:function(e){e.stopPropagation(),this.props.onClear()}},{key:"render",value:function(){var e=this;try{if(0===this.props.options.length)return null;var t,a=this.props.disabled?"dropdown disabled":"dropdown",n=[];this.props.selectedID&&(t=this.props.options.find((function(t){return t.id===e.props.selectedID})));var s=t&&this.props.onClear;if(n.push(r.a.createElement("div",{key:"selection",className:"dropdown-top",title:t?t.text:this.props.placeholder},t?t.display:null,r.a.createElement("div",{className:"item-text"},t?t.text:this.props.placeholder),s?r.a.createElement(p.a,{onClick:function(t){return e.clear(t)}}):r.a.createElement(se.a,{className:"ellipsis"}))),this.state.open){a+=" open";var o=null;this.props.options.length>15&&(o=r.a.createElement("div",{className:"dropdown-filter",onClick:function(e){return e.stopPropagation()},role:"button"},r.a.createElement(ie,{text:this.state.filterText,placeholder:"search this list...",onChange:function(t){return e.setFilterText(t)}})));var i=this.props.options.map((function(t){return null===t.text?r.a.createElement("hr",{key:t.id}):L.match(e.state.filterText,t.text)?r.a.createElement(le,{key:t.id,option:t,selected:t.id===e.props.selectedID,select:function(t){return e.select(t)}}):null})).filter((function(e){return!!e}));n.push(r.a.createElement("div",{key:"options",className:"dropdown-options"},o,i))}return r.a.createElement("div",{className:a,onClick:function(t){return e.toggleOpen(t)},role:"button"},n)}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ce.defaultProps={selectedID:null,placeholder:"select...",disabled:!1,onClear:null,onDisplay:null};var le=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.select(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="dropdown-option";return this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled"),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)},role:"button"},this.props.option.display,this.props.option.text)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ue=a(314),de=a(268),me=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e="expander";return this.props.disabled&&(e+=" disabled"),r.a.createElement(de.a,{className:e,bordered:!1,defaultActiveKey:[],expandIcon:function(e){return r.a.createElement(ue.a,{rotate:e.isActive?-180:0})},expandIconPosition:"right"},r.a.createElement(de.a.Panel,{key:"one",header:r.a.createElement("div",{className:"collapse-header-text"},this.props.text)},this.props.children))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);me.defaultProps={disabled:!1};var pe=a(313),he=a(312),fe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e,t){e.stopPropagation(),this.props.onNudgeValue(t)}},{key:"touchEnd",value:function(e,t){e.preventDefault(),e.stopPropagation(),this.props.onNudgeValue(t)}},{key:"render",value:function(){var e=this;try{var t="info-value";0===this.props.value&&(t+=" disabled");var a=[],n=[],s=this.props.factors||[1];s.forEach((function(t){a.push(r.a.createElement("div",{key:"minus"+t,className:1===t?"spin-button":"spin-button multiple",onTouchEnd:function(a){return e.touchEnd(a,-1*t)},onClick:function(a){return e.click(a,-1*t)},role:"button"},1===t?r.a.createElement(pe.a,null):r.a.createElement("div",null,t))),n.push(r.a.createElement("div",{key:"plus"+t,className:1===t?"spin-button":"spin-button multiple",onTouchEnd:function(a){return e.touchEnd(a,1*t)},onClick:function(a){return e.click(a,1*t)},role:"button"},1===t?r.a.createElement(he.a,null):r.a.createElement("div",null,t)))})),a.reverse();var o="minus",i="plus";return this.props.downEnabled||(o+=" disabled"),this.props.upEnabled||(i+=" disabled"),r.a.createElement("div",{className:this.props.disabled?"number-spin disabled":"number-spin"},r.a.createElement("div",{className:o},a),r.a.createElement("div",{className:"info",style:{width:"calc(100% - "+60*s.length+"px)"}},r.a.createElement("div",{className:"info-label"},this.props.label),r.a.createElement("div",{className:t},this.props.value)),r.a.createElement("div",{className:i},n))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);fe.defaultProps={label:null,upEnabled:!0,downEnabled:!0,disabled:!1,factors:null};var ve=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={selectedPartyID:e.party?e.party.id:null,selectedWaveID:null,customPartySize:5,customPartyLevel:1},n}return Object(c.a)(a,[{key:"selectParty",value:function(e){this.setState({selectedPartyID:e})}},{key:"setWave",value:function(e){this.setState({selectedWaveID:e})}},{key:"render",value:function(){var e=this;try{var t=z.getMonsterCount(this.props.encounter,this.state.selectedWaveID),a=z.getEncounterXP(this.props.encounter,this.state.selectedWaveID,this.props.getMonster),n=z.getAdjustedEncounterXP(this.props.encounter,this.state.selectedWaveID,this.props.getMonster),s=null;if(this.props.encounter.waves.length>0){var o=[{id:this.props.encounter.id,text:"encounter"}];this.props.encounter.waves.forEach((function(e){o.push({id:e.id,text:e.name||"unnamed wave"})})),s=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(ce,{placeholder:"encounter plus all waves",options:o,selectedID:this.state.selectedWaveID,onSelect:function(t){return e.setWave(t)},onClear:function(){return e.setWave(null)}}))}var i,c,l=r.a.createElement("div",null,s,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"xp for these monsters"),r.a.createElement(v.a,{span:8,className:"right-value"},a," xp"))),r.a.createElement("div",{className:"section",style:{display:n===a?"none":""}},r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"effective xp for ",t," monster(s)"),r.a.createElement(v.a,{span:8,className:"right-value"},n," xp")))),u=this.props.party;if(null===u)if("custom"===this.state.selectedPartyID){u=w.createParty();for(var d=0;d!==this.state.customPartySize;++d){var m=w.createPC();m.level=this.state.customPartyLevel,u.pcs.push(m)}}else{var p;u=null!==(p=this.props.parties.find((function(t){return t.id===e.state.selectedPartyID})))&&void 0!==p?p:null}if(u){var h=0,g=0,y=0,b=0,E=u.pcs.filter((function(e){return e.active}));E.forEach((function(e){h+=C.pcExperience(e.level,"easy"),g+=C.pcExperience(e.level,"medium"),y+=C.pcExperience(e.level,"hard"),b+=C.pcExperience(e.level,"deadly")}));var k="trivial",N="trivial";if(n>0&&(n>=h&&(k="easy",N="easy"),n>=g&&(k="medium",N="medium"),n>=y&&(k="hard",N="hard"),n>=b&&(k="deadly",N="deadly"),b>0&&n>=10*b&&(k="tpk",N="tpk"),b>0&&n>=20*b&&(k="dm with a grudge",N="dm with a grudge"),b>0&&n>=30*b&&(k="now you're just being silly",N="now you're just being silly"),E.length<3||E.length>5)){var S=E.length<3;switch(k){case"trivial":N=S?"easy":"trivial";break;case"easy":N=S?"medium":"trivial";break;case"medium":N=S?"hard":"easy";break;case"hard":N=S?"deadly":"medium";break;case"deadly":N=S?"deadly":"hard";break;default:N=""}}i=r.a.createElement("div",{className:"table"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell easy"},r.a.createElement("b",null,"easy")),r.a.createElement("div",{className:"table-cell medium"},r.a.createElement("b",null,"medium")),r.a.createElement("div",{className:"table-cell hard"},r.a.createElement("b",null,"hard")),r.a.createElement("div",{className:"table-cell deadly"},r.a.createElement("b",null,"deadly"))),r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell"},h," xp"),r.a.createElement("div",{className:"table-cell"},g," xp"),r.a.createElement("div",{className:"table-cell"},y," xp"),r.a.createElement("div",{className:"table-cell"},b," xp")));var x=function(e){return 100*e/Math.max(n,1.2*b)},I=function(e){return 100-x(e)};c=r.a.createElement("div",null,r.a.createElement("div",{className:"difficulty-gauge"},r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar trivial",style:{left:"0",right:I(h)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar easy",style:{left:x(h)+"%",right:I(g)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar medium",style:{left:x(g)+"%",right:I(y)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar hard",style:{left:x(y)+"%",right:I(b)+"%"}})),r.a.createElement("div",{className:"bar-container"},r.a.createElement("div",{className:"bar deadly",style:{left:x(b)+"%",right:"0"}})),r.a.createElement("div",{className:"encounter-container"},r.a.createElement("div",{className:"encounter",style:{left:x(n)-.5+"%"}}))),l,r.a.createElement("div",{className:"section"},r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"difficulty for this party"),r.a.createElement(v.a,{span:8,className:"right-value"},k))),r.a.createElement("div",{className:"section",style:{display:N===k?"none":""}},r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"effective difficulty for ",E.length," pc(s)"),r.a.createElement(v.a,{span:8,className:"right-value"},N))))}else c=l;if(!this.props.party){var M=[];if(this.props.parties)for(var O=0;O!==this.props.parties.length;++O){var D=this.props.parties[O];M.push({id:D.id,text:D.name})}M.push({id:"custom",text:"custom party"});var j=null;return"custom"===this.state.selectedPartyID&&(j=r.a.createElement("div",null,r.a.createElement(fe,{value:this.state.customPartySize,label:"party size",downEnabled:this.state.customPartySize>1,onNudgeValue:function(t){return e.setState({customPartySize:e.state.customPartySize+t})}}),r.a.createElement(fe,{value:this.state.customPartyLevel,label:"party level",downEnabled:this.state.customPartyLevel>1,upEnabled:this.state.customPartyLevel<20,onNudgeValue:function(t){return e.setState({customPartyLevel:e.state.customPartyLevel+t})}}))),r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"subheading"},"difficulty"),r.a.createElement(ce,{options:M,placeholder:"select party...",selectedID:this.state.selectedPartyID?this.state.selectedPartyID:void 0,onSelect:function(t){return e.selectParty(t)},onClear:function(){return e.selectParty(null)}}),j,i,c)}return r.a.createElement("div",null,i,c)}catch(T){return console.error(T),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ve.defaultProps={parties:[],party:null};var ge=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=["all sizes"].concat(x).map((function(e){return{id:e,text:e}})),a=["all types"].concat(I).map((function(e){return{id:e,text:e}})),n=a.find((function(e){return"aberration"===e.id}));n&&(n.text="aberr.");var s=a.find((function(e){return"celestial"===e.id}));s&&(s.text="celest.");var o=a.find((function(e){return"construct"===e.id}));o&&(o.text="const.");var i=a.find((function(e){return"elemental"===e.id}));i&&(i.text="elem.");var c=a.find((function(e){return"humanoid"===e.id}));c&&(c.text="human.");var l=a.find((function(e){return"monstrosity"===e.id}));l&&(l.text="monst.");var u=null;this.props.showName&&(u=r.a.createElement(ie,{key:"search",text:this.props.filter.name,placeholder:"filter by name",noMargins:!0,onChange:function(t){return e.props.changeValue("name",t)}}));var d=null;if(this.props.showRoles){var m=["all roles"].concat(M).map((function(e){return{id:e,text:e}}));d=r.a.createElement(Y,{options:m,selectedID:this.props.filter.role,itemsPerRow:2,onSelect:function(t){return e.props.changeValue("role",t)}})}return r.a.createElement("div",null,u,r.a.createElement(me,{text:this.props.prefix+" "+z.getFilterDescription(this.props.filter)},r.a.createElement(Z.a,{range:!0,min:0,max:30,value:[this.props.filter.challengeMin,this.props.filter.challengeMax],onChange:function(t){return e.props.changeValue("challenge",t)}}),r.a.createElement(ce,{options:t,placeholder:"filter by size...",selectedID:this.props.filter.size,onSelect:function(t){return e.props.changeValue("size",t)}}),r.a.createElement(Y,{options:a,selectedID:this.props.filter.category,itemsPerRow:3,onSelect:function(t){return e.props.changeValue("category",t)}}),d,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.resetFilter()}},"clear filter"))))}catch(p){return console.error(p),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ge.defaultProps={prefix:"showing",showName:!0,showRoles:!0};var ye=a(310),be=a(309),Ee=a(308),ke=a(71),we=a(44),Ne=a.n(we),Ce=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e=this.props.combatant.hpCurrent||0,t=this.props.combatant.hpMax||0,a=this.props.combatant.hpTemp||0,n=t/2,s=100*Math.max(e,0)/(t+a),o="";o=e>=t?"bar unhurt":e<=n?"bar bloodied":"bar injured";var i=null;if(null!==this.props.combatant.hpTemp&&this.props.combatant.hpTemp>0){var c=100*Math.max(this.props.combatant.hpTemp,0)/(t+a);i=r.a.createElement("div",{className:"bar temp",style:{width:c+"%"}})}return r.a.createElement("div",{className:"hp-gauge"},r.a.createElement("div",{className:o,style:{width:s+"%"}}),i)}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Se=new Ne.a.Converter;Se.setOption("tables",!0);var xe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={size:"thumbnail"===e.mode?15:45,selectionStartSquare:null,selectionEndSquare:null},n}return Object(c.a)(a,[{key:"gridSquareMouseDown",value:function(e,t){this.setState({selectionStartSquare:{x:e,y:t},selectionEndSquare:null})}},{key:"gridSquareEntered",value:function(e,t){this.state.selectionStartSquare?this.setState({selectionEndSquare:{x:e,y:t}}):this.props.gridSquareEntered&&this.props.gridSquareEntered(e,t)}},{key:"gridSquareMouseUp",value:function(e,t){var a=this;if(this.state.selectionStartSquare){var n=this.state.selectionStartSquare.x,r=this.state.selectionStartSquare.y;this.setState({selectionStartSquare:null,selectionEndSquare:null},(function(){if(n===e&&r===t)a.props.gridSquareClicked&&a.props.gridSquareClicked(e,t);else if(a.props.gridRectangleSelected){var s=Math.min(n,e),o=Math.min(r,t),i=Math.max(n,e),c=Math.max(r,t);a.props.gridRectangleSelected(s,o,i,c)}}))}}},{key:"isSelected",value:function(e,t){if(this.state.selectionStartSquare&&this.state.selectionEndSquare){var a=Math.min(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),n=Math.min(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y),r=Math.max(this.state.selectionStartSquare.x,this.state.selectionEndSquare.x),s=Math.max(this.state.selectionStartSquare.y,this.state.selectionEndSquare.y);return e>=a&&e<=r&&t>=n&&t<=s}return!1}},{key:"getMapDimensions",value:function(){var e=this,t=this.props.viewport;t||(this.props.map.items.filter((function(t){return"edit"!==e.props.mode||"tile"===t.type})).forEach((function(e){t?(t.minX=Math.min(t.minX,e.x),t.maxX=Math.max(t.maxX,e.x+e.width-1),t.minY=Math.min(t.minY,e.y),t.maxY=Math.max(t.maxY,e.y+e.height-1)):t={minX:e.x,maxX:e.x+e.width-1,minY:e.y,maxY:e.y+e.height-1}})),this.props.map.areas.forEach((function(e){t&&(t.minX=Math.min(t.minX,e.x),t.maxX=Math.max(t.maxX,e.x+e.width-1),t.minY=Math.min(t.minY,e.y),t.maxY=Math.max(t.maxY,e.y+e.height-1))})),this.props.combatants.filter((function(e){return e.aura.radius>0})).forEach((function(a){var n=e.props.map.items.find((function(e){return e.id===a.id}));if(n){var r=a.aura.radius/5,s=1,o=a;o&&(s=Math.max(C.miniSize(o.size),1));var i=n.x-r,c=n.x+(s-1)+r,l=n.y-r,u=n.y+(s-1)+r;t&&(t.minX=Math.min(t.minX,i),t.maxX=Math.max(t.maxX,c),t.minY=Math.min(t.minY,l),t.maxY=Math.max(t.maxY,u))}})));if(!t){if("thumbnail"===this.props.mode)return null;t={minX:0,maxX:0,minY:0,maxY:0}}if("thumbnail"===this.props.mode||"combat-player"===this.props.mode){for(var a=[],n=function(n){for(var r=function(t){e.props.fog.find((function(e){return e.x===n&&e.y===t}))||a.push({x:n,y:t})},s=t.minY;s<=t.maxY;++s)r(s)},r=t.minX;r<=t.maxX;++r)n(r);if(a.length>0){var s=a.map((function(e){return e.x})),o=a.map((function(e){return e.y}));t={minX:Math.min.apply(Math,Object(N.a)(s)),maxX:Math.max.apply(Math,Object(N.a)(s)),minY:Math.min.apply(Math,Object(N.a)(o)),maxY:Math.max.apply(Math,Object(N.a)(o))}}}return t.minX-=this.props.paddingSquares,t.maxX+=this.props.paddingSquares,t.minY-=this.props.paddingSquares,t.maxY+=this.props.paddingSquares,t}},{key:"getStyle",value:function(e,t,a,n,r,s){var o=0,i=0;a<1&&(o=(1-a)/2),n<1&&(i=(1-n)/2);var c="0";switch(r){case"rounded":c=this.state.size+"px";break;case"circle":c="50%"}return{left:"calc("+this.state.size+"px * "+(e+o-s.minX)+")",top:"calc("+this.state.size+"px * "+(t+i-s.minY)+")",width:"calc(("+this.state.size+"px * "+a+") + 1px)",height:"calc(("+this.state.size+"px * "+n+") + 1px)",borderRadius:c,backgroundSize:this.state.size+"px"}}},{key:"render",value:function(){var e=this;try{var t=null;"thumbnail"!==this.props.mode&&(t=r.a.createElement(Ie,{mapSize:this.state.size,setMapSize:function(t){return e.setState({size:t})},showAreas:"combat"===this.props.mode&&this.props.map.areas.length>0,areas:this.props.map.areas,selectArea:function(t){return e.props.areaSelected(t)}}));var a=this.getMapDimensions();if(!a)return r.a.createElement("div",{className:"section centered"},"(blank map)");var n=[];"edit"!==this.props.mode&&"combat"!==this.props.mode||(n=this.props.map.areas.map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,"square",a);return r.a.createElement(Me,{key:t.id,style:n,selected:e.props.selectedItemIDs.includes(t.id)})})));var s=this.props.map.items.filter((function(e){return"tile"===e.type})).map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,t.style,a);return r.a.createElement(De,{key:t.id,tile:t,style:n,selectable:"edit"===e.props.mode,selected:e.props.selectedItemIDs.includes(t.id),select:function(t,a){return"edit"===e.props.mode?e.props.itemSelected(t,a):null}})})),o=[];this.props.showAreaNames&&(o=this.props.map.areas.map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,null,a);return r.a.createElement("div",{key:t.id+" name",className:"map-area-name",style:n},t.name)})));var i=[];"edit"!==this.props.mode&&(i=this.props.fog.map((function(t){var n=e.getStyle(t.x,t.y,1,1,"square",a);return r.a.createElement(Oe,{key:t.x+","+t.y,x:t.x,y:t.y,style:n,mode:"fog"})})));var c=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(c=this.props.map.items.filter((function(e){return"overlay"===e.type})).map((function(t){var n=e.getStyle(t.x,t.y,t.width,t.height,t.style,a);return n.backgroundColor=t.color+t.opacity.toString(16),r.a.createElement(je,{key:t.id,overlay:t,style:n,selected:e.props.selectedItemIDs.includes(t.id),select:function(t,a){return e.props.itemSelected(t,a)}})})));var l=[];"edit"!==this.props.mode&&"thumbnail"!==this.props.mode&&(l=this.props.combatants.filter((function(e){return e.aura.radius>0})).filter((function(t){return t.showOnMap||"combat-player"!==e.props.mode})).map((function(t){var n=e.props.map.items.find((function(e){return e.id===t.id}));if(n){var s=t.aura.radius/5,o=2*s+Math.max(C.miniSize(t.displaySize),1),i=e.getStyle(n.x-s,n.y-s,o,o,t.aura.style,a);return i.backgroundColor=t.aura.color,r.a.createElement("div",{key:t.id+" aura",className:"aura",style:i})}return null})).filter((function(e){return null!==e})));var u=[];if("edit"!==this.props.mode){var d=this.props.combatants.map((function(e){return e.mountID||""})).filter((function(e){return""!==e}));u=this.props.map.items.filter((function(e){return"monster"===e.type||"pc"===e.type||"companion"===e.type||"token"===e.type})).filter((function(e){return!d.includes(e.id)})).sort((function(t,a){var n=e.props.combatants.find((function(e){return e.id===t.id})),r=e.props.combatants.find((function(e){return e.id===a.id})),s=n?n.displaySize:t.size,o=r?r.displaySize:a.size;return C.miniSize(o)-C.miniSize(s)})).map((function(t){var n=C.miniSize(t.size),s=!1,o=e.props.combatants.find((function(e){return e.id===t.id}));if(o){var i=o.displaySize;if(o.mountID){var c=e.props.combatants.find((function(e){return e.id===o.mountID}));c&&(i=c.displaySize)}n=C.miniSize(i),s="pc"===o.type}var l=e.getStyle(t.x,t.y,n,n,"circle",a);return r.a.createElement(Te,{key:t.id,token:t,combatant:o||null,style:l,simple:"thumbnail"===e.props.mode,showGauge:"combat"===e.props.mode,showHidden:"combat"===e.props.mode||s,selectable:"combat"===e.props.mode||"combat-player"===e.props.mode,selected:e.props.selectedItemIDs.includes(t.id),select:function(t,a){return e.props.itemSelected(t,a)}})}))}var m=[];if(this.props.showGrid)for(var p=a.minY;p!==a.maxY+1;++p)for(var h=a.minX;h!==a.maxX+1;++h){var f=this.getStyle(h,p,1,1,"square",a);m.push(r.a.createElement(Oe,{key:h+","+p,x:h,y:p,style:f,mode:"cell",selected:this.isSelected(h,p),onMouseDown:function(t,a){return e.gridSquareMouseDown(t,a)},onMouseUp:function(t,a){return e.gridSquareMouseUp(t,a)},onMouseEnter:function(t,a){return e.gridSquareEntered(t,a)}}))}var v=null;if(this.props.focussedSquare){var g=this.getStyle(this.props.focussedSquare.x-1,this.props.focussedSquare.y-1,3,3,"circle",a);v=r.a.createElement("div",{className:"grid-focus",style:g})}var y="map-panel "+this.props.mode,b=1+a.maxX-a.minX,E=1+a.maxY-a.minY,k=this.state.size*b+2,w=this.state.size*E+2;return t&&(w+=42),r.a.createElement("div",{className:y,style:{width:k+"px",height:w+"px"},onClick:function(){return e.props.itemSelected?e.props.itemSelected(null,!1):null},role:"button"},t,r.a.createElement("div",{className:"grid"},n,s,o,i,c,l,u,m,v))}catch(N){return console.error(N),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);xe.defaultProps={mode:"thumbnail",viewport:null,paddingSquares:0,combatants:[],showGrid:!1,showAreaNames:!1,selectedItemIDs:[],fog:[],focussedSquare:null,itemSelected:null,areaSelected:null,gridSquareEntered:null,gridSquareClicked:null,gridRectangleUpdated:null,gridRectangleSelected:null};var Ie=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"nudgeSize",value:function(e){var t=Math.max(this.props.mapSize+e,3);this.props.setMapSize(t)}},{key:"render",value:function(){var e=this;try{var t=[];if(t.push(r.a.createElement(fe,{key:"zoom",value:"zoom",downEnabled:this.props.mapSize>3,onNudgeValue:function(t){return e.nudgeSize(3*t)}})),this.props.showAreas){var a=[{id:"",text:"whole map"}];this.props.areas.forEach((function(e){a.push({id:e.id,text:e.name})})),t.push(r.a.createElement(ce,{key:"areas",options:a,placeholder:"select a map area...",onSelect:function(t){return e.props.selectArea(t)}}))}return r.a.createElement("div",{className:"map-menu"},t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Me=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e="map-area";return this.props.selected&&(e+=" selected"),r.a.createElement("div",{className:e,style:this.props.style})}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Oe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"mouseDown",value:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(this.props.x,this.props.y)}},{key:"mouseUp",value:function(e){e.stopPropagation(),this.props.onMouseUp&&this.props.onMouseUp(this.props.x,this.props.y)}},{key:"mouseEnter",value:function(e){e.stopPropagation(),this.props.onMouseEnter&&this.props.onMouseEnter(this.props.x,this.props.y)}},{key:"doubleClick",value:function(e){e.stopPropagation(),this.props.onDoubleClick&&this.props.onDoubleClick(this.props.x,this.props.y)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"grid-square "+this.props.mode+(this.props.selected?" selected":""),style:this.props.style,onMouseDown:function(t){return e.mouseDown(t)},onMouseUp:function(t){return e.mouseUp(t)},onMouseEnter:function(t){return e.mouseEnter(t)},onDoubleClick:function(t){return e.doubleClick(t)},role:"button"})}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Oe.defaultProps={selected:!1,onMouseDown:null,onMouseUp:null,onMouseEnter:null,onDoubleClick:null};var De=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"select",value:function(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.tile.id,e.ctrlKey))}},{key:"render",value:function(){var e=this;try{var t="tile "+this.props.tile.terrain;this.props.selected&&(t+=" selected");var a=null;if("custom"===this.props.tile.terrain){var n=j.getImage(this.props.tile.customBackground);n&&(a=r.a.createElement("img",{className:"custom-image",alt:"map tile",src:n.data}))}var s=null;if(this.props.tile.content)switch(this.props.tile.content.type){case"doorway":switch(this.props.tile.content.style){case"single":switch(this.props.tile.content.orientation){case"horizontal":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}));break;case"vertical":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}))}break;case"double":switch(this.props.tile.content.orientation){case"horizontal":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("rect",{className:"thin outline",x:"10%",y:"25%",width:"80%",height:"50%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"25%",x2:"50%",y2:"75%"}));break;case"vertical":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("rect",{className:"thin outline",x:"25%",y:"10%",width:"50%",height:"80%"}),r.a.createElement("line",{className:"thin",x1:"25%",y1:"50%",x2:"75%",y2:"50%"}))}break;case"arch":switch(this.props.tile.content.orientation){case"horizontal":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"0",y1:"50%",x2:"20%",y2:"50%"}),r.a.createElement("line",{className:"thick",x1:"80%",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"20%",y2:"80%"}),r.a.createElement("line",{className:"medium",x1:"80%",y1:"20%",x2:"80%",y2:"80%"}));break;case"vertical":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thick",x1:"50%",y1:"0",x2:"50%",y2:"20%"}),r.a.createElement("line",{className:"thick",x1:"50%",y1:"80%",x2:"50%",y2:"100%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"20%",x2:"80%",y2:"20%"}),r.a.createElement("line",{className:"medium",x1:"20%",y1:"80%",x2:"80%",y2:"80%"}))}break;case"bars":switch(this.props.tile.content.orientation){case"horizontal":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"10%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"30%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"70%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"90%",cy:"50%",r:"5%"}));break;case"vertical":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"10%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"30%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"50%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"70%",r:"5%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"90%",r:"5%"}))}}break;case"stairway":switch(this.props.tile.content.style){case"stairs":switch(this.props.tile.content.orientation){case"horizontal":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thin",x1:"0",y1:"12.5%",x2:"100%",y2:"12.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"25%",x2:"100%",y2:"25%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"37.5%",x2:"100%",y2:"37.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"50%",x2:"100%",y2:"50%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"62.5%",x2:"100%",y2:"62.5%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"75%",x2:"100%",y2:"75%"}),r.a.createElement("line",{className:"thin",x1:"0",y1:"87.5%",x2:"100%",y2:"87.5%"}));break;case"vertical":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("line",{className:"thin",x1:"12.5%",y1:"0",x2:"12.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"25%",y1:"0",x2:"25%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"37.5%",y1:"0",x2:"37.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"0",x2:"50%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"62.5%",y1:"0",x2:"62.5%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"75%",y1:"0",x2:"75%",y2:"100%"}),r.a.createElement("line",{className:"thin",x1:"87.5%",y1:"0",x2:"87.5%",y2:"100%"}))}break;case"spiral":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("ellipse",{className:"thin outline",cx:"50%",cy:"50%",rx:"40%",ry:"40%"}),r.a.createElement("ellipse",{className:"thin filled",cx:"50%",cy:"50%",rx:"10%",ry:"10%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"10%",x2:"50%",y2:"90%"}),r.a.createElement("line",{className:"thin",x1:"10%",y1:"50%",x2:"90%",y2:"50%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"20%",x2:"80%",y2:"80%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"80%",x2:"80%",y2:"20%"}));break;case"ladder":switch(this.props.tile.content.orientation){case"horizontal":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"20%",cy:"50%",r:"7%"}),r.a.createElement("line",{className:"thin",x1:"20%",y1:"50%",x2:"80%",y2:"50%"}),r.a.createElement("circle",{className:"thin filled",cx:"80%",cy:"50%",r:"7%"}));break;case"vertical":s=r.a.createElement("svg",{className:"tile-content"},r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"20%",r:"7%"}),r.a.createElement("line",{className:"thin",x1:"50%",y1:"20%",x2:"50%",y2:"80%"}),r.a.createElement("circle",{className:"thin filled",cx:"50%",cy:"80%",r:"7%"}))}}}return r.a.createElement("div",{className:t,style:this.props.style,onClick:function(t){return e.select(t)},role:"button"},a,s)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),je=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"select",value:function(e){e.stopPropagation(),this.props.select(this.props.overlay.id,e.ctrlKey)}},{key:"render",value:function(){var e=this;try{var t="overlay";return this.props.selected&&(t+=" selected"),r.a.createElement("div",{className:t,style:this.props.style,onClick:function(t){return e.select(t)},role:"button"})}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Te=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"select",value:function(e){this.props.selectable&&(e.stopPropagation(),this.props.select(this.props.token.id,e.ctrlKey))}},{key:"getNoteText",value:function(){var e=this.props.combatant?"**"+this.props.combatant.displayName+"**":"";return this.props.combatant&&(this.props.combatant.showOnMap||(e+="\n\n",e+="**hidden**"),0!==this.props.combatant.altitude&&(e+="\n\n",e+="**altitude**: "+Math.abs(this.props.combatant.altitude)+" ft "+(this.props.combatant.altitude>0?"up":"down")),this.props.combatant.tags.forEach((function(t){e+="\n\n",e+="**"+C.getTagTitle(t)+"**",e+="\n\n",e+="* "+C.getTagDescription(t)})),this.props.combatant.conditions.forEach((function(t){"custom"===t.name?C.conditionText(t).forEach((function(t){e+="\n\n",e+="* "+t})):(e+="\n\n",e+="* "+t.name)})),this.props.combatant.note&&(e+="\n\n",e+=this.props.combatant.note)),e.trim()}},{key:"render",value:function(){var e=this;try{var t="token",a="token";if(this.props.selected&&(a+=" selected"),this.props.combatant&&(t=this.props.combatant.displayName||"combatant",a+=" "+this.props.combatant.faction,this.props.combatant.current&&(a+=" current"),!this.props.combatant.showOnMap)){if(!this.props.showHidden)return null;a+=" hidden"}var n=null,s=null,o=null,i=null;if(this.props.combatant&&!this.props.simple){var c=this.props.combatant;if(c&&c.portrait)n=r.a.createElement("img",{className:"portrait",src:c.portrait,alt:t});else{var l=t.toUpperCase().replace(/[^A-Z0-9 ]/,"").split(" ").map((function(e){return e[0]})).join("");n=r.a.createElement("div",{className:"initials"},l)}if("monster"===this.props.combatant.type&&this.props.showGauge)(this.props.combatant.hpCurrent||0)<(this.props.combatant.hpMax||0)&&(s=r.a.createElement(Ce,{combatant:this.props.combatant}));this.props.combatant.altitude>0&&(o=r.a.createElement("div",{className:"badge"},r.a.createElement(ye.a,{twoToneColor:"#3c78dc"}))),this.props.combatant.altitude<0&&(o=r.a.createElement("div",{className:"badge"},r.a.createElement(be.a,{twoToneColor:"#3c78dc"})));var u=0;this.props.combatant.conditions&&(u+=this.props.combatant.conditions.length),this.props.combatant.tags&&(u+=this.props.combatant.tags.filter((function(e){return!e.startsWith("engaged")})).length),u>0&&(i=r.a.createElement("div",{className:"conditions"},r.a.createElement(Ee.a,{twoToneColor:"#3c78dc"})))}var d=r.a.createElement("div",{className:a,style:this.props.style,onClick:function(t){return e.select(t)},role:"button"},n,s,o,i),m=this.getNoteText();return m?r.a.createElement(ke.a,{placement:"bottom",title:r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Se.makeHtml(m)}})},d):d}catch(p){return console.error(p),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Pe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e="note";return this.props.white&&(e+=" white"),r.a.createElement("div",{className:e},this.props.children)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Pe.defaultProps={white:!1};var Ve=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={combatSetup:e.combatSetup,encounterFixed:!!e.combatSetup.encounter,mapFixed:!!e.combatSetup.map},n}return Object(c.a)(a,[{key:"setEncounterID",value:function(e){var t=this,a=this.state.combatSetup,n=this.props.encounters.find((function(t){return t.id===e}));a.encounter=n?JSON.parse(JSON.stringify(n)):null,a.slotInfo=C.getCombatSlotData(a.encounter,this.props.library),this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"setMapID",value:function(e){var t=this.props.maps.find((function(t){return t.id===e})),a=this.state.combatSetup;a.map=t||null,this.setState({combatSetup:a})}},{key:"setWaveID",value:function(e){var t=this,a=this.state.combatSetup;if(a.waveID=e,a.encounter){var n=a.encounter.waves.find((function(t){return t.id===e}));n&&(a.slotInfo=C.getCombatSlotData(n,this.props.library))}this.setState({combatSetup:a},(function(){return t.props.notify()}))}},{key:"generateEncounter",value:function(e){var t=this,a=w.createEncounter();a.name="new encounter";var n=w.createMonsterFilter(),r=0,s=0;if(this.state.combatSetup.party){var o=this.state.combatSetup.party.pcs.filter((function(e){return e.active}));o.forEach((function(t){r+=C.pcExperience(t.level,e),s+=t.level}));var i=s/o.length;n.challengeMax=Math.max(i,5)}z.buildEncounter(a,r,n,this.props.library,this.props.getMonster);var c=this.state.combatSetup;c.encounter=a,c.slotInfo=C.getCombatSlotData(a,this.props.library),this.setState({combatSetup:c},(function(){return t.props.notify()}))}},{key:"generateMap",value:function(e){var t=this,a=w.createMap();a.name="new map",R.generate(e,a);var n=this.state.combatSetup;n.map=a,this.setState({combatSetup:n},(function(){return t.props.notify()}))}},{key:"changeValue",value:function(e,t,a){e[t]=a;var n=e;n.members&&("init"===t&&n.members.forEach((function(e){return e.init=a})),"hp"===t&&n.members.forEach((function(e){return e.hp=a}))),this.setState({combatSetup:this.state.combatSetup})}},{key:"nudgeValue",value:function(e,t,a){e[t]=e[t]+a;var n=this.state.combatSetup;if(n.encounter){if(n.waveID){var r=n.encounter.waves.find((function(e){return e.id===n.waveID}));r&&(n.slotInfo=C.getCombatSlotData(r,this.props.library))}else n.slotInfo=C.getCombatSlotData(n.encounter,this.props.library);this.setState({combatSetup:n})}}},{key:"render",value:function(){var e=this;try{var t=null,a=null;switch(this.props.type){case"start":var n=null;this.state.encounterFixed||(n=r.a.createElement(Ae,{combatSetup:this.state.combatSetup,encounters:this.props.encounters,fixed:this.state.encounterFixed,setEncounterID:function(t){return e.setEncounterID(t)},generateEncounter:function(t){return e.generateEncounter(t)},getMonster:function(t){return e.props.getMonster(t)}}));var s=null;this.state.mapFixed||(s=r.a.createElement(Re,{combatSetup:this.state.combatSetup,maps:this.props.maps,fixed:this.state.mapFixed,setMapID:function(t){return e.setMapID(t)},generateMap:function(t){return e.generateMap(t)}})),t=r.a.createElement("div",null,n,s),a=r.a.createElement("div",null,r.a.createElement(Fe,{type:this.props.type,combatSetup:this.state.combatSetup,getMonster:function(t){return e.props.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}));break;case"add-wave":t=r.a.createElement("div",null,r.a.createElement(Le,{combatSetup:this.state.combatSetup,setWaveID:function(t){return e.setWaveID(t)},getMonster:function(t){return e.props.getMonster(t)}})),a=r.a.createElement("div",null,r.a.createElement(Fe,{type:this.props.type,combatSetup:this.state.combatSetup,getMonster:function(t){return e.props.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}));break;case"add-combatants":t=r.a.createElement("div",null,r.a.createElement(qe,{combatSetup:this.state.combatSetup,library:this.props.library,addMonster:function(t){return e.props.addMonster(t)}})),a=r.a.createElement("div",null,r.a.createElement(ze,{encounter:this.state.combatSetup.encounter,nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},getMonster:function(t){return e.props.getMonster(t)}}),r.a.createElement(Fe,{type:this.props.type,combatSetup:this.state.combatSetup,getMonster:function(t){return e.props.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}))}return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable"},t),r.a.createElement(v.a,{span:12,className:"scrollable"},a))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ve.defaultProps={encounters:null,maps:null,addMonster:null};var Ae=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=null;if(!this.props.combatSetup.encounter){var a=null;if(this.props.encounters.length>0){var n=this.props.encounters.map((function(e){return{id:e.id,text:e.name||"unnamed encounter"}}));a=r.a.createElement(ce,{options:n,placeholder:"select an encounter",onSelect:function(t){return e.props.setEncounterID(t)}})}var s=null;this.props.combatSetup.party&&(s=r.a.createElement("button",{onClick:function(){return e.props.generateEncounter("medium")}},"generate a random encounter")),t=r.a.createElement("div",null,a,s)}var o=null;if(this.props.combatSetup.encounter){var i=this.props.combatSetup.encounter.slots.map((function(t){var a="",n=e.props.getMonster(t.monsterID);return n&&(a=n.name),a=a||"unnamed monster",t.count>1&&(a+=" (x"+t.count+")"),r.a.createElement("div",{key:t.id,className:"group-panel"},a)}));0===i.length&&i.push(r.a.createElement(Pe,{key:"empty"},"no monsters")),o=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"monsters"),i)}var c=null;this.props.combatSetup.encounter&&!this.props.fixed&&(c=r.a.createElement(p.a,{onClick:function(){return e.props.setEncounterID(null)}}));var l=null;return this.props.combatSetup.party&&this.props.combatSetup.encounter&&(l=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"difficulty"),r.a.createElement(ve,{party:this.props.combatSetup.party,encounter:this.props.combatSetup.encounter,getMonster:function(t){return e.props.getMonster(t)}}))),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"encounter",c),t,o,l)}}]),a}(r.a.Component),Re=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=null;if(!this.props.combatSetup.map){var a=null;if(this.props.maps.length>0){var n=this.props.maps.map((function(e){return{id:e.id,text:e.name||"unnamed map",display:r.a.createElement(xe,{map:e})}}));a=r.a.createElement(ce,{options:n,placeholder:"select a map",onSelect:function(t){return e.props.setMapID(t)}})}t=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("p",null,"this is optional - you don't have to use a map to run an encounter")),a,r.a.createElement("button",{onClick:function(){return e.props.generateMap("delve")}},"generate a random delve"))}var s=null;this.props.combatSetup.map&&(s=r.a.createElement("div",{className:"scrollable horizontal-only"},r.a.createElement(xe,{map:this.props.combatSetup.map,combatants:this.props.combatSetup.combatants})));var o=null;return this.props.combatSetup.map&&!this.props.fixed&&(o=r.a.createElement(p.a,{onClick:function(){return e.props.setMapID(null)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"map",o),t,s)}}]),a}(r.a.Component),Le=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;if(null===this.props.combatSetup.encounter)return r.a.createElement("div",{className:"section"},"you have not selected an encounter");if(0===this.props.combatSetup.encounter.waves.length)return r.a.createElement("div",{className:"section"},"you have not defined any waves");var t=this.props.combatSetup.encounter.waves.map((function(e){return{id:e.id,text:e.name||"unnamed wave"}})),a=null;if(this.props.combatSetup.waveID){var n=this.props.combatSetup.encounter.waves.find((function(t){return t.id===e.props.combatSetup.waveID}));if(n){var s=n.slots.map((function(t){var a="",n=e.props.getMonster(t.monsterID);return n&&(a=n.name),a=a||"unnamed monster",t.count>1&&(a+=" (x"+t.count+")"),r.a.createElement("div",{key:t.id,className:"group-panel"},a)}));0===s.length&&s.push(r.a.createElement(Pe,{key:"empty"},"no monsters")),a=r.a.createElement("div",null,s)}}return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"wave"),r.a.createElement(ce,{options:t,placeholder:"select wave",selectedID:this.props.combatSetup.waveID?this.props.combatSetup.waveID:void 0,onSelect:function(t){return e.props.setWaveID(t)},onClear:function(){return e.props.setWaveID(null)}}),a)}}]),a}(r.a.Component),ze=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.encounter.slots.map((function(t){var a="",n=e.props.getMonster(t.monsterID);return n&&(a=n.name),a=a||"unnamed monster",t.count>1&&(a+=" (x"+t.count+")"),r.a.createElement("div",{key:t.id,className:"group-panel"},a,r.a.createElement(fe,{value:"count: "+t.count,downEnabled:t.count>1,onNudgeValue:function(a){return e.props.nudgeValue(t,"count",a)}}))}));return 0===t.length&&t.push(r.a.createElement(Pe,{key:"empty"},"no monsters")),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"selected monsters"),t)}}]),a}(r.a.Component),qe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={filter:w.createMonsterFilter()},n}return Object(c.a)(a,[{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:w.createMonsterFilter()})}},{key:"matchMonster",value:function(e){return z.matchMonster(e,this.state.filter)}},{key:"render",value:function(){var e=this,t=[];this.props.library.forEach((function(a){a.monsters.forEach((function(a){e.matchMonster(a)&&t.push(a)}))})),t.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var a,n=[];this.props.combatSetup.encounter&&(n=null===(a=this.props.combatSetup.encounter)||void 0===a?void 0:a.slots.map((function(e){return e.monsterID})));var s=t.filter((function(e){return!n.includes(e.id)})).map((function(t){return r.a.createElement(ne,{key:t.id,monster:t,selectMonster:function(t){return e.props.addMonster(t)}})}));return 0===s.length&&(s=r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"there are no monsters that match the above criteria (or you have already selected them all)"))),r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"monsters"),r.a.createElement(ge,{filter:this.state.filter,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}}),s)}}]),a}(r.a.Component),Fe=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={standardInitOptions:!0,standardHPOptions:!0,view:"count"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"getSlots",value:function(e,t){var a=this;return this.props.combatSetup.slotInfo.map((function(n){var s=e.slots.find((function(e){return e.id===n.id}));if(!s)return null;var o=a.props.getMonster(s.monsterID);return o?r.a.createElement(Ge,{key:n.id,slotInfo:n,encounterSlot:s,monster:o,view:t,changeValue:function(e,t,n){return a.props.changeValue(e,t,n)},nudgeValue:function(e,t,n){return a.props.nudgeValue(e,t,n)}}):null}))}},{key:"render",value:function(){var e,t=this;if("start"===this.props.type&&!this.props.combatSetup.encounter)return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"options"),r.a.createElement("div",{className:"section"},"select an encounter to see monster information here."));if("add-wave"===this.props.type&&!this.props.combatSetup.waveID)return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"options"),r.a.createElement("div",{className:"section"},"select a wave to see monster information here."));if("add-combatants"===this.props.type&&0===(null===(e=this.props.combatSetup.encounter)||void 0===e?void 0:e.slots.length))return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"options"),r.a.createElement("div",{className:"section"},"add monsters to see their information here."));if(this.props.combatSetup.encounter){var a=this.props.combatSetup.encounter;if(this.props.combatSetup.waveID){var n=this.props.combatSetup.encounter.waves.find((function(e){return e.id===t.props.combatSetup.waveID}));n&&(a=n)}return 0===a.slots.length?null:r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},"options"),r.a.createElement(re,{checked:this.state.standardInitOptions,label:"roll initiative once for each different type of monster",onChecked:function(e){return t.setState({standardInitOptions:e})}}),this.state.standardInitOptions?null:this.getSlots(a,"initiative"),r.a.createElement(re,{checked:this.state.standardHPOptions,label:"use typical hp for each monster",onChecked:function(e){return t.setState({standardHPOptions:e})}}),this.state.standardHPOptions?null:this.getSlots(a,"hit points"),r.a.createElement("hr",null),r.a.createElement(me,{text:"advanced options"},r.a.createElement(Y,{options:["count","names","faction"].map((function(e){return{id:e,text:e}})),selectedID:this.state.view,onSelect:function(e){return t.setView(e)}}),r.a.createElement("hr",null),r.a.createElement("div",null,this.getSlots(a,this.state.view))))}return null}}]),a}(r.a.Component),Ge=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"rollInit",value:function(e){var t=C.dieRoll(),a=C.modifierValue(this.props.monster.abilityScores.dex);this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"init",t+a)}},{key:"rollHP",value:function(e){var t=C.hitDieType(this.props.monster.size),a=C.dieRoll(t,this.props.monster.hitDice),n=C.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice;this.props.changeValue(null!==e&&void 0!==e?e:this.props.slotInfo,"hp",a+n)}},{key:"getValueSection",value:function(e,t,a,n,s){var o=this;return r.a.createElement(f.a,{align:"middle"},r.a.createElement(v.a,{span:20},r.a.createElement(Z.a,{min:e,max:t,value:a[n],onChange:function(e){return o.props.changeValue(a,n,e)}})),r.a.createElement(v.a,{span:4},r.a.createElement("div",{className:"combatant-value"},a[n],r.a.createElement(K.a,{onClick:function(){return s()}}))))}},{key:"getInitSection",value:function(){var e=this,t=null;this.props.encounterSlot.count>1&&(t=r.a.createElement(re,{label:"roll initiative once for this group",checked:this.props.slotInfo.useGroupInit,onChecked:function(t){return e.props.changeValue(e.props.slotInfo,"useGroupInit",t)}}));var a=C.modifierValue(this.props.monster.abilityScores.dex),n=1+a,s=20+a,o=[];return this.props.slotInfo.useGroupInit?o.push(r.a.createElement("div",{key:"init"},this.getValueSection(n,s,this.props.slotInfo,"init",(function(){return e.rollInit(null)})))):this.props.slotInfo.members.forEach((function(t){o.push(r.a.createElement("div",{key:t.id},r.a.createElement("div",{className:"combatant-name"},t.name),e.getValueSection(n,s,t,"init",(function(){return e.rollInit(t)}))))})),r.a.createElement("div",null,t,o)}},{key:"getHPSection",value:function(){var e=this,t=null;this.props.encounterSlot.count>1&&(t=r.a.createElement(re,{label:"use the same hp for every monster in this group",checked:this.props.slotInfo.useGroupHP,onChecked:function(t){return e.props.changeValue(e.props.slotInfo,"useGroupHP",t)}}));var a=D.getTypicalHP(this.props.monster),n=C.modifierValue(this.props.monster.abilityScores.con)*this.props.monster.hitDice,s=this.props.monster.hitDice+n,o=this.props.monster.hitDice*C.hitDieType(this.props.monster.size)+n,i=[];return this.props.slotInfo.useGroupHP?i.push(r.a.createElement("div",{key:"hp"},this.getValueSection(s,o,this.props.slotInfo,"hp",(function(){return e.rollHP(null)})),r.a.createElement("button",{className:this.props.slotInfo.hp!==a?"":"disabled",onClick:function(){return e.props.changeValue(e.props.slotInfo,"hp",a)}},"reset to average hp"))):this.props.slotInfo.members.forEach((function(t){i.push(r.a.createElement("div",{key:t.id},r.a.createElement("div",{className:"combatant-name"},t.name),e.getValueSection(s,o,t,"hp",(function(){return e.rollHP(t)})),r.a.createElement("button",{className:t.hp!==a?"":"disabled",onClick:function(){return e.props.changeValue(t,"hp",a)}},"reset to average hp")))})),r.a.createElement("div",null,t,i)}},{key:"getCountSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(fe,{value:"count: "+this.props.encounterSlot.count,downEnabled:this.props.encounterSlot.count>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.encounterSlot,"count",t)}}))}},{key:"getNameSection",value:function(){var e=this;return this.props.slotInfo.members.map((function(t){return r.a.createElement(ie,{key:t.id,text:t.name,onChange:function(a){return e.props.changeValue(t,"name",a)}})}))}},{key:"getFactionSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(ce,{options:["foe","neutral","ally"].map((function(e){return{id:e,text:"faction: "+e}})),selectedID:this.props.encounterSlot.faction,onSelect:function(t){return e.props.changeValue(e.props.encounterSlot,"faction",t)}}))}},{key:"render",value:function(){var e=this.props.monster.name||"unnamed monster",t=null;switch(this.props.view){case"initiative":e+=" (1d20 "+C.modifier(this.props.monster.abilityScores.dex)+")",t=this.getInitSection();break;case"hit points":e+=" ("+D.getTypicalHPString(this.props.monster)+")",t=this.getHPSection();break;case"count":t=this.getCountSection();break;case"names":t=this.getNameSection();break;case"faction":t=this.getFactionSection()}return r.a.createElement("div",{className:"group-panel combatant-setup"},r.a.createElement("div",{className:"subheading"},e),t)}}]),a}(r.a.Component),Be=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.items.map((function(t){return r.a.createElement(Ue,{key:t.id,item:t,selected:e.props.selectedItemID===t.id,onSelect:function(t){return e.props.onSelect(t)}})}));return r.a.createElement("div",{className:"radio-group"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ue=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.onSelect(this.props.item.id)}},{key:"render",value:function(){var e=this;try{var t="radio-item",a=null;return this.props.selected&&(t+=" selected",this.props.item.details&&(a=r.a.createElement("div",{className:"radio-item-details"},this.props.item.details))),this.props.item.disabled&&(t+=" disabled"),r.a.createElement("div",{className:t,onClick:function(t){return e.click(t)},role:"button"},r.a.createElement("div",{className:"radio-item-top"},r.a.createElement("div",{className:"radio-item-text"},this.props.item.text),r.a.createElement("div",{className:"radio-item-info"},this.props.item.info)),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),He=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={condition:e.condition},n}return Object(c.a)(a,[{key:"setCondition",value:function(e){if(this.state.condition.name!==e){var t=this.state.condition;t.name=e,t.level=1,t.text="",this.setState({condition:t})}}},{key:"setCustomText",value:function(e){var t=this.state.condition;t.text=e,this.setState({condition:t})}},{key:"setDuration",value:function(e){var t=null;switch(e){case"saves":t=w.createConditionDurationSaves();break;case"combatant":t=w.createConditionDurationCombatant();break;case"rounds":t=w.createConditionDurationRounds()}var a=this.state.condition;a.duration=t,this.setState({condition:a})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({condition:this.state.condition})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t]+a;"level"===t&&(n=Math.max(n,1),n=Math.min(n,6)),"count"===t&&(n=Math.max(n,1)),"saveDC"===t&&(n=Math.max(n,0)),e[t]=n,this.setState({condition:this.state.condition})}},{key:"render",value:function(){var e=this;try{var t=S.map((function(t){var a=null,n=[];if(t===e.state.condition.name&&("exhaustion"===t&&(a=r.a.createElement(fe,{value:e.props.condition.level,label:"exhaustion",downEnabled:e.props.condition.level>1,upEnabled:e.props.condition.level<6,onNudgeValue:function(t){return e.nudgeValue(e.props.condition,"level",t)}})),"custom"===t&&(a=r.a.createElement(ie,{text:e.state.condition.text,placeholder:"",onChange:function(t){return e.setCustomText(t)}})),"custom"!==e.state.condition.name))for(var s=C.conditionText(e.state.condition),o=0;o!==s.length;++o)n.push(r.a.createElement("li",{key:o,className:"section"},s[o]));var i=e.props.combatants.filter((function(e){return"monster"===e.type})).some((function(e){return!!e&&-1!==e.conditionImmunities.indexOf(t)}));return{id:t,text:t,details:r.a.createElement("div",{key:t},a,r.a.createElement("ul",null,n)),disabled:i}})),a=["str","dex","con","int","wis","cha","death"].map((function(e){return{id:e,text:e}})),n=[{id:"start",text:"start of turn"},{id:"end",text:"end of turn"}],s=this.props.allCombatants.filter((function(e){return"placeholder"!==e.type})).map((function(e){var t=e;return{id:t.id,text:t.displayName||t.name||"unnamed monster"}}));k.sort(s,[{field:"text",dir:"asc"}]);var o=[{id:"none",text:"until removed (default)",details:r.a.createElement("div",{className:"section"},r.a.createElement("div",null,"the condition persists until it is manually removed"))},{id:"saves",text:"until a successful save",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"number of saves required"),r.a.createElement(fe,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"count",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"save dc"),r.a.createElement(fe,{value:this.props.condition.duration?"dc "+this.props.condition.duration.saveDC:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.saveDC>0,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"saveDC",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"type of save"),r.a.createElement(Y,{options:a,selectedID:this.props.condition.duration?this.props.condition.duration.saveType:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"saveType",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"make the save at the start or end of the turn"),r.a.createElement(Y,{options:n,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"point",t)}})))},{id:"combatant",text:"until someone's next turn",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"start or end of the turn"),r.a.createElement(Y,{options:n,selectedID:this.props.condition.duration?this.props.condition.duration.point:null,onSelect:function(t){return e.changeValue(e.props.condition.duration,"point",t)}})),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"combatant"),r.a.createElement(ce,{options:s,selectedID:this.props.condition.duration&&this.props.condition.duration.combatantID||void 0,onSelect:function(t){return e.changeValue(e.props.condition.duration,"combatantID",t)}})))},{id:"rounds",text:"for a number of rounds",details:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"number of rounds"),r.a.createElement(fe,{value:this.props.condition.duration?this.props.condition.duration.count:"",downEnabled:!!this.props.condition.duration&&this.props.condition.duration.count>1,onNudgeValue:function(t){return e.nudgeValue(e.props.condition.duration,"count",t)}})))}];return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"heading"},"condition"),r.a.createElement(Be,{items:t,selectedItemID:this.state.condition.name,onSelect:function(t){return e.setCondition(t)}})),r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement("div",{className:"heading"},"duration"),r.a.createElement(Be,{items:o,selectedItemID:this.state.condition.duration?this.state.condition.duration.type:"none",onSelect:function(t){return e.setDuration(t)}})))}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),We=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{if(0===this.props.data.length)return null;var t,a=Math.max.apply(Math,Object(N.a)(this.props.data.map((function(e){return e.value}))));if(this.props.collapse)t=this.props.data.filter((function(e){return e.value>0}));else{var n=this.props.data.find((function(e){return e.value>0}));this.props.data.reverse();var s=this.props.data.find((function(e){return e.value>0}));this.props.data.reverse();var o=n?this.props.data.indexOf(n):0,i=s?this.props.data.indexOf(s):this.props.data.length-1;t=this.props.data.slice(o,i+1)}var c=t.map((function(t){return r.a.createElement("div",{key:t.text,className:"bar-container"},r.a.createElement("div",{className:"bar",style:{width:"calc((100% - 1px) * "+t.value+" / "+a+")"}},r.a.createElement("div",{className:"label"},t.text,": ",e.props.onFormatValue(t.value))))}));return r.a.createElement("div",{className:"plot"},c)}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);We.defaultProps={collapse:!1,onFormatValue:function(e){return e.toString()}};var Je=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={chart:"challenge"},n}return Object(c.a)(a,[{key:"selectChart",value:function(e){this.setState({chart:e})}},{key:"render",value:function(){var e=this;try{var t=[];if(this.props.groups.forEach((function(e){return e.monsters.forEach((function(e){return t.push(e)}))})),0===t.length)return null;var a=[];switch(this.state.chart){case"challenge":a=[0,.125,.25,.5,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30].map((function(e){return{text:"cr "+C.challenge(e),value:t.filter((function(t){return t.challenge===e})).length}}));break;case"size":a=x.map((function(e){return{text:e,value:t.filter((function(t){return t.size===e})).length}}));break;case"type":a=I.map((function(e){return{text:e,value:t.filter((function(t){return t.category===e})).length}}))}return r.a.createElement("div",{className:"scrollable padded"},r.a.createElement(Y,{options:[{id:"challenge",text:"challenge rating"},{id:"size",text:"size"},{id:"type",text:"type"}],selectedID:this.state.chart,onSelect:function(t){return e.selectChart(t)}}),r.a.createElement(We,{data:a}))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),_e=a(294),Ye=a(274),Xe=a(302),Ke=a(301),Ze=a(300),Qe=a(299),$e=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e,t){e.stopPropagation(),this.props.onClick(t)}},{key:"render",value:function(){var e=this;try{var t="radial "+this.props.mode;this.props.disabled&&(t+=" disabled");var a="eight"===this.props.mode;return r.a.createElement("div",{className:t},r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"NW")},role:"button"},r.a.createElement(Xe.a,{rotate:-45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow vertical",onClick:function(t){return e.click(t,"N")},role:"button"},r.a.createElement(Xe.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"NE")},role:"button"},r.a.createElement(Xe.a,{rotate:45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow horizontal",onClick:function(t){return e.click(t,"W")},role:"button"},r.a.createElement(Ke.a,null))),r.a.createElement("div",{className:"cell"}),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow horizontal",onClick:function(t){return e.click(t,"E")},role:"button"},r.a.createElement(Ze.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"SW")},role:"button"},r.a.createElement(Qe.a,{rotate:45}))),r.a.createElement("div",{className:"cell"},r.a.createElement("div",{className:"arrow vertical",onClick:function(t){return e.click(t,"S")},role:"button"},r.a.createElement(Qe.a,null))),r.a.createElement("div",{className:"cell",style:{display:a?"none":"inline-block"}}),r.a.createElement("div",{className:"cell",style:{display:a?"inline-block":"none"}},r.a.createElement("div",{className:"arrow diag",onClick:function(t){return e.click(t,"SE")},role:"button"},r.a.createElement(Qe.a,{rotate:-45}))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);$e.defaultProps={mode:"eight",disabled:!1};var et=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"randomName",value:function(){var e=T.capitalise(T.generateRoomName());this.props.changeValue(this.props.area,"name",e)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map area")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"section subheading"},"area name"),r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(ie,{text:this.props.area.name,onChange:function(t){return e.props.changeValue(e.props.area,"name",t)}}),r.a.createElement("div",{className:"icons"},r.a.createElement(Ye.a,{onClick:function(){return e.randomName()},title:"generate a random name"}))),r.a.createElement("div",{className:"section subheading"},"notes"),r.a.createElement(ie,{text:this.props.area.text,multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.area,"text",t)}}),r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement($e,{onClick:function(t){return e.props.moveMapArea(e.props.area,t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},5*this.props.area.width," ft x ",5*this.props.area.height," ft"),r.a.createElement("div",{className:"section"},r.a.createElement(fe,{value:this.props.area.width+" sq",label:"width",downEnabled:this.props.area.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.area,"width",t)}}),r.a.createElement(fe,{value:this.props.area.height+" sq",label:"height",downEnabled:this.props.area.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.area,"height",t)}})),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.deleteMapArea(e.props.area)}},"remove area"))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),tt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:"position"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"getPositionSection",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement($e,{onClick:function(t){return e.props.moveMapTile(e.props.tile,t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},5*this.props.tile.width," ft x ",5*this.props.tile.height," ft"),r.a.createElement("div",{className:"section"},r.a.createElement(fe,{value:this.props.tile.width+" sq",label:"width",downEnabled:this.props.tile.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.tile,"width",t)}}),r.a.createElement(fe,{value:this.props.tile.height+" sq",label:"height",downEnabled:this.props.tile.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.tile,"height",t)}})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.bringToFront(e.props.tile)}},"bring to front"),r.a.createElement("button",{onClick:function(){return e.props.sendToBack(e.props.tile)}},"send to back"))}},{key:"getStyleSection",value:function(){var e=this,t=P.map((function(e){return{id:e,text:e}})),a=null;"custom"===this.props.tile.terrain&&(a=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"custom image"),r.a.createElement("button",{onClick:function(){return e.props.toggleImageSelection()}},"select image"),r.a.createElement("button",{onClick:function(){return e.props.changeValue(e.props.tile,"customBackground","")}},"clear image")));var n=["square","rounded","circle"].map((function(e){return{id:e,text:e}}));return r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"terrain"),r.a.createElement(ce,{options:t,placeholder:"select terrain",selectedID:this.props.tile.terrain?this.props.tile.terrain:void 0,onSelect:function(t){return e.props.changeValue(e.props.tile,"terrain",t)}}),a,r.a.createElement("div",{className:"subheading"},"shape"),r.a.createElement(Y,{options:n,selectedID:this.props.tile.style,onSelect:function(t){return e.props.changeValue(e.props.tile,"style",t)}}),r.a.createElement("div",{className:"subheading"},"content"),r.a.createElement(Be,{items:[{id:"none",text:"none"},{id:"doorway",text:"doorway",details:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,"style")),r.a.createElement(Y,{options:V.map((function(e){return{id:e,text:e}})),itemsPerRow:2,selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"style",t)}}),r.a.createElement("div",null,r.a.createElement("b",null,"orientation")),r.a.createElement(Y,{options:["horizontal","vertical"].map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"orientation",t)}}))},{id:"stairway",text:"stairway",details:r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,"style")),r.a.createElement(Y,{options:A.map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.style:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"style",t)}}),r.a.createElement("div",null,r.a.createElement("b",null,"orientation")),r.a.createElement(Y,{options:["horizontal","vertical"].map((function(e){return{id:e,text:e}})),selectedID:this.props.tile.content?this.props.tile.content.orientation:null,onSelect:function(t){return e.props.changeValue(e.props.tile.content,"orientation",t)}}))}],selectedItemID:this.props.tile.content?this.props.tile.content.type:"none",onSelect:function(t){var a=null;if("none"!==t){var n="";switch(t){case"doorway":n=V[0];break;case"stairway":n=A[0]}a={type:t,orientation:"horizontal",style:n}}e.props.changeValue(e.props.tile,"content",a)}}))}},{key:"render",value:function(){var e=this;try{var t=["position","style"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"position":a=this.getPositionSection();break;case"style":a=this.getStyleSection()}return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map tile")),r.a.createElement("div",{className:"card-content"},r.a.createElement(Y,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),r.a.createElement("hr",null),a,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.rotateMapTile(e.props.tile)}},"rotate tile"),r.a.createElement("button",{onClick:function(){return e.props.cloneMapTile(e.props.tile)}},"clone tile"),r.a.createElement("button",{onClick:function(){return e.props.deleteMapTile(e.props.tile)}},"remove tile"))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),at=a(295),nt=a(297),rt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={visible:!1},n}return Object(c.a)(a,[{key:"onClick",value:function(e){e.stopPropagation(),this.setState({visible:!0})}},{key:"onClose",value:function(e,t){e.stopPropagation(),t&&this.props.onConfirm(),this.setState({visible:!1})}},{key:"render",value:function(){var e=this;try{return r.a.createElement(nt.a,{content:r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement(at.a,{style:{color:"red"}}),r.a.createElement("span",{style:{marginLeft:"10px"}},this.props.prompt)),this.props.info,r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(t){return e.onClose(t,!0)}},"confirm"),r.a.createElement("button",{onClick:function(t){return e.onClose(t,!1)}},"cancel")),trigger:"click",visible:this.state.visible},r.a.createElement("button",{className:this.props.disabled?"danger disabled":"danger",onClick:function(t){return e.onClick(t)}},this.props.text))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);rt.defaultProps={prompt:"are you sure you want to do this?",info:null,disabled:!1};var st=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={images:j.allImages(),filter:""},n}return Object(c.a)(a,[{key:"setFilter",value:function(e){this.setState({filter:e})}},{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target)try{var n=a.target.result;j.saveImage(k.guid(),e.name,n),t.setState({images:j.allImages()})}catch(s){h.a.open({message:"can't upload this image",description:"not enough storage space; try reducing the resolution or removing unused images",closeIcon:r.a.createElement(p.a,null),duration:5})}},a.readAsDataURL(e),!1}},{key:"render",value:function(){var e=this;try{var t=this.state.images.filter((function(t){return L.match(e.state.filter,t.name)})).map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"subheading"},t.name),r.a.createElement("img",{className:"section selectable-image",src:t.data,alt:t.name,onClick:function(){return e.props.select?e.props.select(t.id):null}}))}));return 0===t.length&&t.push(r.a.createElement(Pe,{key:"empty"},"no images")),this.state.images.length>0&&t.unshift(r.a.createElement(ie,{key:"search",text:this.state.filter,placeholder:"search for an image",onChange:function(t){return e.setFilter(t)}})),r.a.createElement("div",{className:"full-height"},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},"select image")),r.a.createElement("div",{className:"drawer-content"},r.a.createElement("div",{className:"scrollable"},r.a.createElement("div",null,r.a.createElement(te.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"),r.a.createElement("p",{className:"ant-upload-text"},"try to upload small images if possible"))),t)),r.a.createElement("div",{className:"drawer-footer"},r.a.createElement("button",{onClick:function(){return e.props.cancel?e.props.cancel():null}},"cancel")))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ot=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={map:e.map,selectedTileID:null,selectedAreaID:null,addingTile:!1,addingArea:!1,showImageSelection:!1},n}return Object(c.a)(a,[{key:"setSelectedTileID",value:function(e){this.setState({selectedTileID:e})}},{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"toggleAddingTile",value:function(){this.setState({addingTile:!this.state.addingTile,addingArea:!1})}},{key:"toggleAddingArea",value:function(){this.setState({addingTile:!1,addingArea:!this.state.addingArea})}},{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"rectangleSelected",value:function(e,t,a,n){if(this.state.addingTile){var r=w.createMapItem();r.x=e,r.y=t,r.width=a-e+1,r.height=n-t+1,r.terrain="default",this.state.map.items.push(r),this.setState({map:this.state.map,selectedTileID:r.id,selectedAreaID:null,addingTile:!1,addingArea:!1})}if(this.state.addingArea){var s=w.createMapArea();s.name="new area",s.x=e,s.y=t,s.width=a-e+1,s.height=n-t+1,this.state.map.areas.push(s),k.sort(this.state.map.areas),this.setState({map:this.state.map,selectedTileID:null,selectedAreaID:s.id,addingTile:!1,addingArea:!1})}}},{key:"moveMapItem",value:function(e,t){switch(t){case"N":e.y-=1;break;case"NE":e.x+=1,e.y-=1;break;case"E":e.x+=1;break;case"SE":e.x+=1,e.y+=1;break;case"S":e.y+=1;break;case"SW":e.x-=1,e.y+=1;break;case"W":e.x-=1;break;case"NW":e.x-=1,e.y-=1}this.setState({map:this.state.map})}},{key:"rotateMapItem",value:function(e){var t=e.width;e.width=e.height,e.height=t;var a=Math.floor((e.width-e.height)/2);e.x-=a,e.y+=a,e.content&&(e.content.orientation="horizontal"===e.content.orientation?"vertical":"horizontal"),this.setState({map:this.state.map,addingTile:this.state.addingTile})}},{key:"sendToBack",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.state.map.items.unshift(e),this.setState({map:this.state.map})}},{key:"bringToFront",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.state.map.items.push(e),this.setState({map:this.state.map})}},{key:"cloneMapItem",value:function(e){var t=JSON.parse(JSON.stringify(e));t.id=k.guid(),t.x+=1,t.y+=1,this.state.map.items.push(t),this.setState({map:this.state.map,selectedTileID:t.id})}},{key:"deleteMapItem",value:function(e){var t=this.state.map.items.indexOf(e);this.state.map.items.splice(t,1),this.setState({map:this.state.map,selectedTileID:null})}},{key:"deleteMapArea",value:function(e){var t=this.state.map.areas.indexOf(e);this.state.map.areas.splice(t,1),this.setState({map:this.state.map,selectedAreaID:null})}},{key:"setCustomImage",value:function(e){var t=this,a=this.state.map.items.find((function(e){return e.id===t.state.selectedTileID}));a&&this.changeValue(a,"customBackground",e)}},{key:"rotateMap",value:function(){R.rotateMap(this.state.map),this.setState({map:this.state.map,addingTile:!1})}},{key:"clearMapTiles",value:function(){var e=this.state.map;e.items=[],this.setState({map:e,selectedTileID:null,addingTile:!1})}},{key:"clearMapAreas",value:function(){var e=this.state.map;e.areas=[],this.setState({map:e,selectedAreaID:null,addingArea:!1})}},{key:"generate",value:function(e){R.generate(e,this.state.map),this.setState({map:this.state.map,addingTile:!1})}},{key:"changeValue",value:function(e,t,a){e[t]=a,k.sort(this.state.map.areas),this.setState({map:this.state.map,showImageSelection:!1})}},{key:"nudgeValue",value:function(e,t,a){var n=e[t];n+=a,"width"!==t&&"height"!==t||(n=Math.max(n,1)),this.changeValue(e,t,n)}},{key:"render",value:function(){var e=this;try{var t=null;if(this.state.selectedTileID){var a=this.state.map.items.find((function(t){return t.id===e.state.selectedTileID}));a&&(t=r.a.createElement("div",null,r.a.createElement(tt,{tile:a,toggleImageSelection:function(){return e.toggleImageSelection()},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},moveMapTile:function(t,a){return e.moveMapItem(t,a)},cloneMapTile:function(t){return e.cloneMapItem(t)},deleteMapTile:function(t){return e.deleteMapItem(t)},rotateMapTile:function(t){return e.rotateMapItem(t)},sendToBack:function(t){return e.sendToBack(t)},bringToFront:function(t){return e.bringToFront(t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.setSelectedTileID(null)}},r.a.createElement(_e.a,{style:{fontSize:"10px"}})," back to the editor")))}if(this.state.selectedAreaID){var n=this.state.map.areas.find((function(t){return t.id===e.state.selectedAreaID}));n&&(t=r.a.createElement("div",null,r.a.createElement(et,{area:n,changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},moveMapArea:function(t,a){return e.moveMapItem(t,a)},deleteMapArea:function(t){return e.deleteMapArea(t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.setSelectedAreaID(null)}},r.a.createElement(_e.a,{style:{fontSize:"10px"}})," back to the editor")))}if(!t){var s=null;if(this.state.addingTile)s=r.a.createElement("button",{onClick:function(){return e.toggleAddingTile()}},"click and drag on the map to create a tile, or click here to cancel");else if(this.state.addingArea)s=r.a.createElement("button",{onClick:function(){return e.toggleAddingArea()}},"click and drag on the map to create a map area, or click here to cancel");else{var o=this.state.map.areas.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel clickable",onClick:function(){return e.setSelectedAreaID(t.id)},role:"button"},t.name)}));s=r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.toggleAddingTile()}},"add a map tile"),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.generate("room")}},"add a random room"),r.a.createElement("button",{onClick:function(){return e.rotateMap()}},"rotate the map"),r.a.createElement(rt,{text:"clear all tiles",onConfirm:function(){return e.clearMapTiles()}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"areas"),o,r.a.createElement("button",{onClick:function(){return e.toggleAddingArea()}},"add a map area"),r.a.createElement(rt,{text:"clear all areas",onConfirm:function(){return e.clearMapAreas()}}))}t=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(ie,{text:this.state.map.name,placeholder:"map name",onChange:function(t){return e.changeValue(e.state.map,"name",t)}}),r.a.createElement("hr",null),r.a.createElement(Pe,null,r.a.createElement("p",null,"to add a new tile to the map, click on ",r.a.createElement("b",null,"add a map tile")," below"),r.a.createElement("p",null,"to edit an existing tile, click on it to select it")),r.a.createElement("hr",null),s)}var i=[];return this.state.selectedTileID&&i.push(this.state.selectedTileID),this.state.selectedAreaID&&i.push(this.state.selectedAreaID),r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},t),r.a.createElement(v.a,{span:18,className:"scrollable both-ways"},r.a.createElement(xe,{map:this.state.map,mode:"edit",paddingSquares:5,selectedItemIDs:i,showGrid:this.state.addingTile||this.state.addingArea,showAreaNames:!0,itemSelected:function(t,a){e.setSelectedTileID(t),e.setSelectedAreaID(null)},areaSelected:function(t){return e.setSelectedAreaID(t)},gridRectangleSelected:function(t,a,n,r){return e.rectangleSelected(t,a,n,r)}})),r.a.createElement(g.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(st,{select:function(t){return e.setCustomImage(t)},cancel:function(){return e.toggleImageSelection()}})))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),it=a(290),ct=a(144),lt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={showAbilityScores:!1},n}return Object(c.a)(a,[{key:"toggleAbilityScores",value:function(){this.setState({showAbilityScores:!this.state.showAbilityScores})}},{key:"roll",value:function(e,t){e.stopPropagation();var a=this.props.combatant.abilityScores[t],n=C.modifierValue(a);this.props.onRollDice(1,20,n)}},{key:"getAbilityScore",value:function(e){var t=this,a=this.props.combatant.abilityScores[e],n=C.modifier(a),s=r.a.createElement("div",null,r.a.createElement("div",{className:"ability-heading"},e),r.a.createElement("div",{className:"ability-value"},r.a.createElement("div",null,this.state.showAbilityScores?a:n)));return this.props.showRollButtons?r.a.createElement("div",{className:"ability-score link",onClick:function(a){return t.roll(a,e)},role:"button"},s):r.a.createElement("div",{className:"ability-score"},s)}},{key:"render",value:function(){var e=this;try{return this.props.edit?r.a.createElement("div",null,r.a.createElement(fe,{value:this.props.combatant.abilityScores.str,label:"strength",downEnabled:this.props.combatant.abilityScores.str>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.str",t)}}),r.a.createElement(fe,{value:this.props.combatant.abilityScores.dex,label:"dexterity",downEnabled:this.props.combatant.abilityScores.dex>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.dex",t)}}),r.a.createElement(fe,{value:this.props.combatant.abilityScores.con,label:"constitution",downEnabled:this.props.combatant.abilityScores.con>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.con",t)}}),r.a.createElement(fe,{value:this.props.combatant.abilityScores.int,label:"intelligence",downEnabled:this.props.combatant.abilityScores.int>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.int",t)}}),r.a.createElement(fe,{value:this.props.combatant.abilityScores.wis,label:"wisdom",downEnabled:this.props.combatant.abilityScores.wis>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.wis",t)}}),r.a.createElement(fe,{value:this.props.combatant.abilityScores.cha,label:"charisma",downEnabled:this.props.combatant.abilityScores.cha>0,onNudgeValue:function(t){return e.props.onNudgeValue(e.props.combatant,"abilityScores.cha",t)}})):r.a.createElement("div",{className:"ability-scores",onClick:function(){return e.toggleAbilityScores()},role:"button"},this.getAbilityScore("str"),this.getAbilityScore("dex"),this.getAbilityScore("con"),this.getAbilityScore("int"),this.getAbilityScore("wis"),this.getAbilityScore("cha"))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);lt.defaultProps={edit:!1,showRollButtons:!1,onNudgeValue:null,onRollDice:null};var ut=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{return r.a.createElement("div",{className:"statistic"},r.a.createElement("div",{className:"statistic-prefix"},this.props.prefix),r.a.createElement("div",{className:"statistic-label"},this.props.label),r.a.createElement("div",{className:"statistic-value"},this.props.value),r.a.createElement("div",{className:"statistic-suffix"},this.props.suffix))}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ut.defaultProps={prefix:null,suffix:null};var dt=a(293),mt=a(292),pt=new Ne.a.Converter;pt.setOption("tables",!0);var ht=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"createSection",value:function(e,t){var a=e[t];if(0===a.length)return null;var n=null;if("legendary"===this.props.mode||"lair"===this.props.mode)switch(t){case"legendary":case"mythic":var s=null,o=null;if(this.props.combatant.legendaryActions>0&&(s=r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round"),r.a.createElement("hr",null)),"legendary"===this.props.mode)){var i=0;this.props.combatant.traits.filter((function(e){return("legendary"===e.type||"mythic"===e.type)&&e.uses>0})).forEach((function(e){var t=1;if(e.usage){var a=e.usage.toLowerCase().match(/\D*(\d*)\D*/);a&&(t=parseInt(a[1],10))}i+=t})),i=Math.min(i,this.props.combatant.legendaryActions);for(var c=Math.max(this.props.combatant.legendaryActions-i,0),l=[],u=0;u!==i;++u)l.push(r.a.createElement(dt.a,{key:"used "+u}));for(var d=0;d!==c;++d)l.push(r.a.createElement(mt.a,{key:"unused "+d}));o=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section centered legendary-usage"},l))}"legendary"===t&&(n=r.a.createElement(Pe,{white:!0},s,r.a.createElement("div",null,"one legendary action can be used at the end of each other combatant's turn; spent actions are refreshed at the start of the monster's turn"),o)),"mythic"===t&&(n=r.a.createElement(Pe,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));break;case"lair":n=r.a.createElement(Pe,{white:!0},"one lair action can be taken each round on initiative 20")}else"legendary"===t&&(n=r.a.createElement(Pe,{white:!0},r.a.createElement("b",null,this.props.combatant.legendaryActions)," legendary actions per round")),"mythic"===t&&(n=r.a.createElement(Pe,{white:!0},"while the monster's mythic trait is active, the following can be used as legendary actions"));return r.a.createElement("div",null,r.a.createElement("div",{className:"section subheading"},C.traitType(t,!0)),n,a)}},{key:"render",value:function(){var e=this;try{var t={};return O.forEach((function(a){t[a]=e.props.combatant.traits.filter((function(e){return e.type===a})).map((function(t){return r.a.createElement(ft,{key:t.id,trait:t,mode:e.props.mode,showRollButtons:e.props.showRollButtons,copyTrait:function(t){return e.props.copyTrait(t)},useTrait:function(t){return e.props.useTrait(t)},rechargeTrait:function(t){return e.props.rechargeTrait(t)},onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}})}))})),0===this.props.combatant.traits.length?r.a.createElement("div",null,r.a.createElement("i",null,"no traits or actions")):"combat"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"trait"),this.createSection(t,"action"),this.createSection(t,"bonus"),this.createSection(t,"reaction")):"legendary"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"legendary"),this.createSection(t,"mythic")):"lair"===this.props.mode?r.a.createElement("div",null,this.createSection(t,"lair")):r.a.createElement("div",null,this.createSection(t,"trait"),this.createSection(t,"action"),this.createSection(t,"bonus"),this.createSection(t,"reaction"),this.createSection(t,"legendary"),this.createSection(t,"mythic"),this.createSection(t,"lair"))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);ht.defaultProps={mode:"view",showRollButtons:!1,copyTrait:null,useTrait:null,rechargeTrait:null,onRollDice:null};var ft=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=0,a=this.props.trait.name||"unnamed "+C.traitType(this.props.trait.type,!1);if(this.props.trait.usage){var n="";this.props.trait.usage.toLowerCase().startsWith("recharge ")&&(t=1,this.props.trait.uses>0&&(n="; used"));var s=this.props.trait.usage.toLowerCase().match(/(\d+)\s*\/\s*day/);s&&(t=parseInt(s[1],10),this.props.trait.uses>0&&(n="; used "+this.props.trait.uses)),a+=" *("+this.props.trait.usage+n+")*"}"legendary"!==this.props.trait.type&&"mythic"!==this.props.trait.type||(t=1,this.props.trait.uses>0&&(a+=" *(used)*"));var o="**"+a+"** "+this.props.trait.text;switch(this.props.mode){case"view":return r.a.createElement("div",{key:this.props.trait.id,className:"section trait"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:pt.makeHtml(o)}}));case"template":return r.a.createElement("div",{key:this.props.trait.id,className:"section trait trait-template",onClick:function(){return e.props.copyTrait(e.props.trait)},role:"button"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:pt.makeHtml(o)}}));case"combat":case"legendary":case"lair":var i="",c=[];t>0&&(this.props.trait.uses>=t?(i="strikethrough",c.push(r.a.createElement("button",{key:"use",className:"link",onClick:function(){return e.props.rechargeTrait(e.props.trait)}},"recharge"))):c.push(r.a.createElement("button",{key:"use",className:"link",onClick:function(){return e.props.useTrait(e.props.trait)}},"use"))),this.props.showRollButtons&&(D.getToHitExpressions(this.props.trait).forEach((function(t){c.push(r.a.createElement("button",{key:t.expression,className:"link",onClick:function(){return e.props.onRollDice(1,20,t.bonus)}},t.expression))})),D.getDiceExpressions(this.props.trait).forEach((function(t){c.push(r.a.createElement("button",{key:t.expression,className:"link",onClick:function(){return e.props.onRollDice(t.count,t.sides,t.bonus)}},t.expression))})));var l=null;return c.length>0&&(l=r.a.createElement("div",{className:"trait-buttons"},c)),r.a.createElement("div",{key:this.props.trait.id,className:"section trait"},r.a.createElement("div",{className:i,dangerouslySetInnerHTML:{__html:pt.makeHtml(o)}}),l)}}catch(u){return console.error(u),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),vt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getAC",value:function(){var e=this.props.monster.ac.toString();return this.props.monster.acInfo&&(e+=" ("+this.props.monster.acInfo+")"),e}},{key:"getHP",value:function(){return D.getTypicalHP(this.props.monster)+" ("+D.getTypicalHPString(this.props.monster)+")"}},{key:"statSection",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return null;var s=!0,o=null;if(n){var i=t,c=[];Array.from(t.matchAll(/([^,;:/]*)\s+([+-]?)\s*(\d+)/g)).forEach((function(e){var t=e[0],n=e[2]||"+",s=parseInt(e[3],10)*("+"===n?1:-1);c.push(r.a.createElement("button",{key:t,className:"link",onClick:function(){return a.props.onRollDice(1,20,s)}},t)),i=i.replace(t,"")})),s=!!i.match(/[a-zA-Z]/),o=r.a.createElement("div",{className:"roll-buttons"},c)}return r.a.createElement("div",{className:"section"},r.a.createElement("b",null,e)," ",s?t:null,o)}},{key:"getTags",value:function(){var e=[],t=this.props.monster.size,a=this.props.monster;a&&(t=a.displaySize||t);var n=(t+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(n+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(r.a.createElement($.a,{key:"tag-main"},n)),this.props.monster.alignment&&e.push(r.a.createElement($.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(r.a.createElement($.a,{key:"tag-cr"},"cr ",C.challenge(this.props.monster.challenge))),e}},{key:"getStats",value:function(){var e=this,t=null,a=this.props.monster;if(null!==a.hpCurrent&&void 0!==a.hpCurrent){var n,s,o=null!==(n=a.hpCurrent)&&void 0!==n?n:0,i=null!==(s=a.hpTemp)&&void 0!==s?s:0,c=o.toString();i>0&&(c+="+"+i),t=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(v.a,{span:12},r.a.createElement(ut,{label:"armor class",value:this.props.monster.ac})),r.a.createElement(v.a,{span:12},r.a.createElement(ut,{label:"hit points",value:c}))))}return r.a.createElement("div",{className:"stats"},r.a.createElement(ae,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),t,r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(lt,{combatant:this.props.monster,showRollButtons:this.props.showRollButtons,onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}})),this.statSection("ac",this.getAC()),this.statSection("hp",this.getHP()),this.statSection("saving throws",this.props.monster.savingThrows,this.props.showRollButtons),this.statSection("skills",this.props.monster.skills,this.props.showRollButtons),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment),r.a.createElement("hr",null),r.a.createElement(ht,{combatant:this.props.monster,mode:this.props.combat?"combat":"view",showRollButtons:this.props.showRollButtons,useTrait:function(t){return e.props.useTrait(t)},rechargeTrait:function(t){return e.props.rechargeTrait(t)},onRollDice:function(t,a,n){return e.props.onRollDice(t,a,n)}}))}},{key:"render",value:function(){try{var e=(this.props.monster?this.props.monster.displayName:null)||this.props.monster.name||"unnamed monster";return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:e},e)),r.a.createElement("div",{className:"card-content"},this.getStats()))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);vt.defaultProps={combat:!1,showRollButtons:!1,useTrait:null,rechargeTrait:null,onRollDice:null};var gt=a(291),yt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getAC",value:function(){var e=this.props.monster.ac.toString();return this.props.monster.acInfo&&(e+=" ("+this.props.monster.acInfo+")"),e}},{key:"getHP",value:function(){return D.getTypicalHP(this.props.monster)+" ("+D.getTypicalHPString(this.props.monster)+")"}},{key:"statSection",value:function(e,t){return t?r.a.createElement("div",{className:"section"},r.a.createElement("b",null,e)," ",t):null}},{key:"getTags",value:function(){var e=[],t=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(t+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(r.a.createElement($.a,{key:"tag-main"},t)),this.props.monster.alignment&&e.push(r.a.createElement($.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(r.a.createElement($.a,{key:"tag-cr"},"cr ",C.challenge(this.props.monster.challenge))),e}},{key:"getStats",value:function(){var e=this;switch(this.props.section){case"overview":return r.a.createElement("div",{className:"stats"},r.a.createElement(ae,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),r.a.createElement("hr",null),this.statSection("speed",this.props.monster.speed),this.statSection("senses",this.props.monster.senses),this.statSection("languages",this.props.monster.languages),this.statSection("equipment",this.props.monster.equipment));case"abilities":return r.a.createElement("div",{className:"stats"},r.a.createElement("div",{className:"section"},r.a.createElement(lt,{combatant:this.props.monster})),this.statSection("saving throws",this.props.monster.savingThrows),this.statSection("skills",this.props.monster.skills));case"cbt-stats":return r.a.createElement("div",{className:"stats"},this.statSection("ac",this.getAC()),this.statSection("hp",this.getHP()),this.statSection("damage resistances",this.props.monster.damage.resist),this.statSection("damage vulnerabilities",this.props.monster.damage.vulnerable),this.statSection("damage immunities",this.props.monster.damage.immune),this.statSection("condition immunities",this.props.monster.conditionImmunities));case"actions":return r.a.createElement(ht,{combatant:this.props.monster,mode:"template",copyTrait:function(t){return e.props.copyTrait(t)}})}}},{key:"render",value:function(){var e=this,t=this.props.monster.name||"unnamed monster";try{return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:t},t),r.a.createElement(gt.a,{onClick:function(){return e.props.deselectMonster(e.props.monster)}})),r.a.createElement("div",{className:"card-content"},this.getStats()))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),bt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.options.map((function(t){return r.a.createElement(Et,{key:t.id,option:t,selected:t.id===e.props.selectedID,onSelect:function(t){return e.props.onSelect(t)}})}));return r.a.createElement("div",{className:this.props.disabled?"tabs disabled":"tabs"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);bt.defaultProps={disabled:!1};var Et=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"click",value:function(e){e.stopPropagation(),this.props.option.disabled||this.props.onSelect(this.props.option.id)}},{key:"render",value:function(){var e=this;try{var t="tab";this.props.selected&&(t+=" selected"),this.props.option.disabled&&(t+=" disabled");var a=null;return a=this.props.option.display?this.props.option.display:r.a.createElement("div",null,this.props.option.text),r.a.createElement("div",{key:this.props.option.id,className:t,title:this.props.option.text,onClick:function(t){return e.click(t)},role:"button"},a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),kt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={monster:e.monster,page:"overview",showFilter:!1,helpSection:"speed",sidebar:"similar",similarFilter:{size:!0,type:!0,subtype:!1,role:!1,alignment:!1,challenge:!0},scratchpadFilter:w.createMonsterFilter(),scratchpadList:[]},n}return Object(c.a)(a,[{key:"setPage",value:function(e){var t=this.getHelpOptionsForPage(e);this.setState({page:e,helpSection:t[0]})}},{key:"setHelpSection",value:function(e){this.setState({helpSection:e})}},{key:"toggleMatch",value:function(e){var t=this.state.similarFilter;t[e]=!t[e],this.setState({similarFilter:t})}},{key:"addToScratchpad",value:function(e){var t=this.state.scratchpadList;t.push(e),k.sort(t),this.setState({scratchpadList:t})}},{key:"removeFromScratchpad",value:function(e){var t=this.state.scratchpadList.indexOf(e);this.state.scratchpadList.splice(t,1),this.setState({scratchpadList:this.state.scratchpadList})}},{key:"addAllToScratchpad",value:function(e){var t=this.state.scratchpadList;e.forEach((function(e){return t.push(e)})),k.sort(t),this.setState({scratchpadList:t})}},{key:"clearScratchpad",value:function(){this.setState({scratchpadList:[]})}},{key:"getHelpOptionsForPage",value:function(e){switch(e){case"overview":return["speed","senses","languages","equipment"];case"abilities":return["str","dex","con","int","wis","cha","saves","skills"];case"cbt-stats":return["armor class","hit dice","resist","vulnerable","immune","conditions"];case"actions":return["actions"];default:return[]}}},{key:"getSimilarMonsters",value:function(){var e=this,t=[];return this.props.library.forEach((function(a){a.monsters.forEach((function(a){var n=!0;e.state.monster.id===a.id&&(n=!1),e.state.similarFilter.size&&e.state.monster.size!==a.size&&(n=!1),e.state.similarFilter.type&&e.state.monster.category!==a.category&&(n=!1),e.state.similarFilter.subtype&&e.state.monster.tag!==a.tag&&(n=!1),e.state.similarFilter.role&&e.state.monster.role!==a.role&&(n=!1),e.state.similarFilter.alignment&&e.state.monster.alignment!==a.alignment&&(n=!1),e.state.similarFilter.challenge&&e.state.monster.challenge!==a.challenge&&(n=!1),n&&t.push(a)}))})),t}},{key:"recalculateRole",value:function(){var e=this.state.monster;e.role=D.getRole(e)}},{key:"setRandomValue",value:function(e,t){D.setRandomValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"spliceMonsters",value:function(e){D.spliceMonsters(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"addTrait",value:function(e){D.addTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"addRandomTrait",value:function(e,t){D.addRandomTrait(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"moveTrait",value:function(e,t){var a=this.state.monster.traits.indexOf(e),n=this.state.monster.traits.indexOf(t);D.moveTrait(this.state.monster,a,n),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"removeTrait",value:function(e){D.removeTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"copyTrait",value:function(e){D.copyTrait(this.state.monster,e),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"changeTrait",value:function(e,t,a){e[t]=a,this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"nudgeValue",value:function(e,t){D.nudgeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"changeValue",value:function(e,t){D.changeValue(this.state.monster,e,t),this.recalculateRole(),this.setState({monster:this.state.monster})}},{key:"changeFilterValue",value:function(e,t){var a=this.state.scratchpadFilter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({scratchpadFilter:a})}},{key:"resetFilter",value:function(){this.setState({scratchpadFilter:w.createMonsterFilter()})}},{key:"matchMonster",value:function(e){return z.matchMonster(e,this.state.scratchpadFilter)}},{key:"getHelpSection",value:function(e){switch(this.state.helpSection){case"speed":return this.getValueSection("speed","text",e);case"senses":return this.getValueSection("senses","text",e);case"languages":return this.getValueSection("languages","text",e);case"equipment":return this.getValueSection("equipment","text",e);case"str":return this.getValueSection("abilityScores.str","number",e);case"dex":return this.getValueSection("abilityScores.dex","number",e);case"con":return this.getValueSection("abilityScores.con","number",e);case"int":return this.getValueSection("abilityScores.int","number",e);case"wis":return this.getValueSection("abilityScores.wis","number",e);case"cha":return this.getValueSection("abilityScores.cha","number",e);case"saves":return this.getValueSection("savingThrows","text",e);case"skills":return this.getValueSection("skills","text",e);case"armor class":return this.getValueSection("ac","number",e);case"hit dice":return this.getValueSection("hitDice","number",e);case"resist":return this.getValueSection("damage.resist","text",e);case"vulnerable":return this.getValueSection("damage.vulnerable","text",e);case"immune":return this.getValueSection("damage.immune","text",e);case"conditions":return this.getValueSection("conditionImmunities","text",e);case"actions":return this.getActionsSection(e);default:return null}}},{key:"getValueSection",value:function(e,t,a){var n=this,s=a.map((function(a){var n=e.split("."),r=a,s=null;return n.forEach((function(e){e===n[n.length-1]?s=r[e]:r=r[e]})),"text"===t&&""===s&&(s=null),s})).filter((function(e){return null!==e})),o=[];if("number"===t){var i=null,c=null;if(s.forEach((function(e){(null===i||e<i)&&(i=e),(null===c||e>c)&&(c=e)})),null!==i&&null!==c)for(var l=i;l<=c;++l)o.push({value:l,count:0})}switch(s.forEach((function(e){var t=o.find((function(t){return t.value===e}));t?t.count+=1:o.push({value:e,count:1})})),t){case"number":k.sort(o,[{field:"value",dir:"asc"}]);break;case"text":k.sort(o,[{field:"count",dir:"desc"},{field:"value",dir:"asc"}])}"text"===t&&(0!==a.length-s.length&&o.push({value:"",count:a.length-s.length}));var u=o.map((function(t){var s=100*t.count/a.length;return r.a.createElement(f.a,{gutter:10,className:"value-list",key:o.indexOf(t)},r.a.createElement(v.a,{span:8,className:"text-container"},t.value||"(none specified)"),r.a.createElement(v.a,{span:8,className:"bar-container"},r.a.createElement("div",{className:"bar",style:{width:s+"%"}})),r.a.createElement(v.a,{span:8},r.a.createElement("button",{onClick:function(){return n.changeValue(e,t.value)}},"use this value")))}));return r.a.createElement("div",null,u,r.a.createElement("button",{onClick:function(){return n.setRandomValue(e,a)}},"select random value"))}},{key:"getActionsSection",value:function(e){var t=this,a=[];return a.push(r.a.createElement(f.a,{gutter:10,className:"value-list",key:"header"},r.a.createElement(v.a,{span:8,className:"text-container"},r.a.createElement("b",null,"type")),r.a.createElement(v.a,{span:4,className:"text-container number"},r.a.createElement("b",null,"avg")),r.a.createElement(v.a,{span:4,className:"text-container number"},r.a.createElement("b",null,"min - max")))),O.forEach((function(n){var s=null,o=null,i=0;e.forEach((function(e){var t=e.traits.filter((function(e){return e.type===n})).length;(null===s||t<s)&&(s=t),(null===o||t>o)&&(o=t),i+=t}));var c=Math.round(i/e.length);a.push(r.a.createElement(f.a,{gutter:10,className:"value-list",key:n},r.a.createElement(v.a,{span:8,className:0===i?"text-container disabled":"text-container"},C.traitType(n,!0)),r.a.createElement(v.a,{span:4,className:0===i?"text-container number disabled":"text-container number"},c),r.a.createElement(v.a,{span:4,className:0===i?"text-container number disabled":"text-container number"},s," - ",o),r.a.createElement(v.a,{span:8},r.a.createElement("button",{className:0===i?"disabled":"",onClick:function(){return t.addRandomTrait(n,e)}},"add random"))))})),r.a.createElement("div",null,a)}},{key:"getSidebar",value:function(){var e=this,t=null;switch(this.props.sidebar){case"statblock":t=r.a.createElement(v.a,{span:12,className:"scrollable sidebar sidebar-right",style:{padding:"5px 10px"}},r.a.createElement(vt,{monster:this.state.monster}));break;case"guidelines":t=r.a.createElement(v.a,{span:12,className:"scrollable sidebar sidebar-right"},r.a.createElement(Mt,{monster:this.state.monster}));break;case"advanced":var a=[];switch(this.state.sidebar){case"similar":a=this.getSimilarMonsters();break;case"all":this.props.library.forEach((function(t){t.monsters.forEach((function(t){!a.includes(t)&&e.matchMonster(t)&&a.push(t)}))}))}a=a.filter((function(t){return!e.state.scratchpadList.find((function(e){return e.id===t.id}))})),k.sort(a);var n=null;switch(this.state.sidebar){case"similar":n=r.a.createElement(me,{text:"similarity criteria"},r.a.createElement(re,{label:"size "+this.state.monster.size,checked:this.state.similarFilter.size,onChecked:function(t){return e.toggleMatch("size")}}),r.a.createElement(re,{label:"type "+this.state.monster.category,checked:this.state.similarFilter.type,onChecked:function(t){return e.toggleMatch("type")}}),r.a.createElement(re,{label:this.state.monster.tag?"subtype "+this.state.monster.tag:"subtype",checked:this.state.similarFilter.subtype,disabled:!this.state.monster.tag,onChecked:function(t){return e.toggleMatch("subtype")}}),r.a.createElement(re,{label:this.state.monster.role?"role "+this.state.monster.role:"role",checked:this.state.similarFilter.role,disabled:!this.state.monster.role,onChecked:function(t){return e.toggleMatch("role")}}),r.a.createElement(re,{label:this.state.monster.alignment?"alignment "+this.state.monster.alignment:"alignment",checked:this.state.similarFilter.alignment,disabled:!this.state.monster.alignment,onChecked:function(t){return e.toggleMatch("alignment")}}),r.a.createElement(re,{label:"challenge rating "+C.challenge(this.state.monster.challenge),checked:this.state.similarFilter.challenge,onChecked:function(t){return e.toggleMatch("challenge")}}));break;case"all":n=r.a.createElement(ge,{filter:this.state.scratchpadFilter,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}})}var s=null;0===this.state.scratchpadList.length&&(s=r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"this is your ",r.a.createElement("b",null,"scratchpad")," list; you can add monsters to it from the list to the right"),r.a.createElement("div",{className:"section"},"when there are monsters in this list, their combined stats will be shown on the left"),r.a.createElement("div",{className:"section"},"you might find this useful if you're creating a monster and want it to have similar abilities to other monsters"),r.a.createElement("div",{className:"section"},"you can also quickly blend together all the monters in this list to create a new monster by clicking the ",r.a.createElement("b",null,"generate hybrid monster")," button above")));var o=null;0===a.length&&(o=r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"there are no monsters in your library which match the above criteria (or they are all in your scratchpad already)"))),t=r.a.createElement(v.a,{span:12,className:"scrollable sidebar sidebar-right"},r.a.createElement(f.a,{gutter:5},r.a.createElement(v.a,{span:12},r.a.createElement(bt,{options:[{id:"scratch",text:"scratchpad"}],selectedID:"scratch",onSelect:function(){return null}}),r.a.createElement("button",{className:this.state.scratchpadList.length<2?"disabled":"",onClick:function(){return e.spliceMonsters(e.state.scratchpadList)}},"generate hybrid monster"),r.a.createElement("button",{className:0===this.state.scratchpadList.length?"disabled":"",onClick:function(){return e.clearScratchpad()}},"clear scratchpad"),r.a.createElement("hr",null),this.getMonsterCards(this.state.scratchpadList,!0),s),r.a.createElement(v.a,{span:12},r.a.createElement(bt,{options:[{id:"similar",text:"similar"},{id:"all",text:"all"}],selectedID:this.state.sidebar,onSelect:function(t){return e.setState({sidebar:t})}}),n,r.a.createElement("button",{className:0===a.length?"disabled":"",onClick:function(){return e.addAllToScratchpad(a)}},"add all to scratchpad"),r.a.createElement("hr",null),this.getMonsterCards(a,!1),o)))}return t}},{key:"getMonsterCards",value:function(e,t){var a=this;return k.sort(e).map((function(e){return t?r.a.createElement("div",{className:"section",key:e.id},r.a.createElement(yt,{monster:e,section:a.state.page,copyTrait:function(e){return a.copyTrait(e)},deselectMonster:function(e){return a.removeFromScratchpad(e)}})):r.a.createElement("div",{className:"section",key:e.id},r.a.createElement(ne,{monster:e,selectMonster:function(e){return a.addToScratchpad(e)}}))})).filter((function(e){return!!e}))}},{key:"render",value:function(){var e=this;try{var t=null;switch(this.state.page){case"overview":t=r.a.createElement(wt,{monster:this.state.monster,changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"abilities":t=r.a.createElement(Nt,{monster:this.state.monster,changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"cbt-stats":t=r.a.createElement(Ct,{monster:this.state.monster,changeValue:function(t,a){return e.changeValue(t,a)},nudgeValue:function(t,a){return e.nudgeValue(t,a)}});break;case"actions":t=r.a.createElement(St,{monster:this.state.monster,addTrait:function(t){return e.addTrait(t)},copyTrait:function(t){return e.copyTrait(t)},moveTrait:function(t,a){return e.moveTrait(t,a)},removeTrait:function(t){return e.removeTrait(t)},changeValue:function(t,a,n){return e.changeTrait(t,a,n)}})}var a=null;if("advanced"===this.props.sidebar&&this.state.scratchpadList.length>0){var n=null;if(this.getHelpOptionsForPage(this.state.page).length>1){var s=this.getHelpOptionsForPage(this.state.page).map((function(e){return{id:e,text:e}}));n=r.a.createElement(Y,{options:s,selectedID:this.state.helpSection,onSelect:function(t){return e.setHelpSection(t)}})}a=r.a.createElement("div",{className:"monster-help group-panel"},r.a.createElement("div",{className:"heading"},"information from scratchpad monsters"),n,this.getHelpSection(this.state.scratchpadList))}return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement(bt,{options:[{id:"overview",text:"overview"},{id:"abilities",text:"abilities"},{id:"cbt-stats",text:"combat"},{id:"actions",text:"actions"}],selectedID:this.state.page,onSelect:function(t){return e.setPage(t)}}),t,a),this.getSidebar())}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),wt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"randomName",value:function(){var e=T.capitalise(T.generateName());this.props.changeValue("name",e)}},{key:"render",value:function(){var e=this;try{var t=I.map((function(e){return{id:e,text:e}}));return r.a.createElement(f.a,{gutter:10,key:"overview"},r.a.createElement(v.a,{span:24},r.a.createElement("div",{className:"subheading"},"name"),r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(ie,{text:this.props.monster.name,onChange:function(t){return e.props.changeValue("name",t)}}),r.a.createElement("div",{className:"icons"},r.a.createElement(Ye.a,{onClick:function(){return e.randomName()},title:"generate a random name"})))),r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"subheading"},"type"),r.a.createElement(ce,{options:t,selectedID:this.props.monster.category,onSelect:function(t){return e.props.changeValue("category",t)}}),r.a.createElement("div",{className:"subheading"},"subtype"),r.a.createElement(ie,{text:this.props.monster.tag,placeholder:"none",onChange:function(t){return e.props.changeValue("tag",t)}}),r.a.createElement("div",{className:"subheading"},"alignment"),r.a.createElement(ie,{text:this.props.monster.alignment,onChange:function(t){return e.props.changeValue("alignment",t)}}),r.a.createElement("div",{className:"subheading"},"challenge rating"),r.a.createElement(fe,{value:C.challenge(this.props.monster.challenge),downEnabled:this.props.monster.challenge>0,onNudgeValue:function(t){return e.props.nudgeValue("challenge",t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(fe,{value:this.props.monster.size,downEnabled:"tiny"!==this.props.monster.size,upEnabled:"gargantuan"!==this.props.monster.size,onNudgeValue:function(t){return e.props.nudgeValue("size",t)}})),r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"subheading"},"speed"),r.a.createElement(ie,{text:this.props.monster.speed,onChange:function(t){return e.props.changeValue("speed",t)}}),r.a.createElement("div",{className:"subheading"},"senses"),r.a.createElement(ie,{text:this.props.monster.senses,onChange:function(t){return e.props.changeValue("senses",t)}}),r.a.createElement("div",{className:"subheading"},"languages"),r.a.createElement(ie,{text:this.props.monster.languages,onChange:function(t){return e.props.changeValue("languages",t)}}),r.a.createElement("div",{className:"subheading"},"equipment"),r.a.createElement(ie,{text:this.props.monster.equipment,onChange:function(t){return e.props.changeValue("equipment",t)}}),r.a.createElement("div",{className:"subheading"},"portrait"),r.a.createElement(ae,{source:this.props.monster,setPortrait:function(t){return e.props.changeValue("portrait",t)},clear:function(){return e.props.changeValue("portrait","")}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Nt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement(f.a,{gutter:10,key:"abilities"},r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"subheading"},"ability scores"),r.a.createElement(lt,{edit:!0,combatant:this.props.monster,onNudgeValue:function(t,a,n){return e.props.nudgeValue(a,n)}})),r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"subheading"},"saving throws"),r.a.createElement(ie,{text:this.props.monster.savingThrows,onChange:function(t){return e.props.changeValue("savingThrows",t)}}),r.a.createElement("div",{className:"subheading"},"skills"),r.a.createElement(ie,{text:this.props.monster.skills,onChange:function(t){return e.props.changeValue("skills",t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ct=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement(f.a,{gutter:10,key:"cbt-stats"},r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"subheading"},"armor class"),r.a.createElement(fe,{value:this.props.monster.ac,downEnabled:this.props.monster.ac>0,onNudgeValue:function(t){return e.props.nudgeValue("ac",t)}}),r.a.createElement("div",{className:"subheading"},"armor type"),r.a.createElement(ie,{text:this.props.monster.acInfo,onChange:function(t){return e.props.changeValue("acInfo",t)}}),r.a.createElement("div",{className:"subheading"},"hit dice"),r.a.createElement(fe,{value:this.props.monster.hitDice,downEnabled:this.props.monster.hitDice>1,onNudgeValue:function(t){return e.props.nudgeValue("hitDice",t)}}),r.a.createElement("div",{className:"subheading"},"hit points"),r.a.createElement(Pe,null,r.a.createElement("p",null,"to calculate hit points, the die type is based on the monster's size, and the die roll is modified by the monster's constitution modifier")),r.a.createElement("div",{className:"hp-value"},D.getTypicalHP(this.props.monster)+" hp ("+D.getTypicalHPString(this.props.monster)+")")),r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"subheading"},"damage resistances"),r.a.createElement(ie,{text:this.props.monster.damage.resist,onChange:function(t){return e.props.changeValue("damage.resist",t)}}),r.a.createElement("div",{className:"subheading"},"damage vulnerabilities"),r.a.createElement(ie,{text:this.props.monster.damage.vulnerable,onChange:function(t){return e.props.changeValue("damage.vulnerable",t)}}),r.a.createElement("div",{className:"subheading"},"damage immunities"),r.a.createElement(ie,{text:this.props.monster.damage.immune,onChange:function(t){return e.props.changeValue("damage.immune",t)}}),r.a.createElement("div",{className:"subheading"},"condition immunities"),r.a.createElement(ie,{text:this.props.monster.conditionImmunities,onChange:function(t){return e.props.changeValue("conditionImmunities",t)}}),r.a.createElement("div",{className:"subheading"},"legendary actions"),r.a.createElement(fe,{value:this.props.monster.legendaryActions,downEnabled:this.props.monster.legendaryActions>0,onNudgeValue:function(t){return e.props.nudgeValue("legendaryActions",t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),St=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={selectedTraitID:null},n}return Object(c.a)(a,[{key:"setSelectedTraitID",value:function(e){this.setState({selectedTraitID:e})}},{key:"createSection",value:function(e,t){var a=this,n=e[t];return r.a.createElement("div",null,r.a.createElement("div",{className:"trait-header-bar"},r.a.createElement("div",{className:"subheading"},C.traitType(t,!0)),r.a.createElement(Q.a,{title:"add",onClick:function(){return a.props.addTrait(t)}})),r.a.createElement(ct.List,{values:n,lockVertically:!0,onChange:function(e){var t=e.oldIndex,r=e.newIndex;return a.props.moveTrait(n[t],n[r])},renderList:function(e){var t=e.children,a=e.props;return r.a.createElement("div",a,t)},renderItem:function(e){var t=e.value,n=e.props,s=e.isDragged;return r.a.createElement("div",Object.assign({},n,{className:s?"dragged":""}),r.a.createElement(xt,{key:t.id,trait:t,isSelected:t.id===a.state.selectedTraitID,select:function(e){return a.setSelectedTraitID(e)}}))}}))}},{key:"render",value:function(){var e=this;try{var t=[],a={};O.forEach((function(n){t.push({id:n,text:C.traitType(n,!1)}),a[n]=e.props.monster.traits.filter((function(e){return e.type===n}))}));var n=this.props.monster.traits.find((function(t){return t.id===e.state.selectedTraitID})),s=null;return s=n?r.a.createElement(It,{trait:n,copyTrait:function(t){return e.props.copyTrait(t)},removeTrait:function(t){return e.props.removeTrait(t)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)}}):r.a.createElement(Pe,null,"select one of the traits or actions from the column to the left to edit its details here"),r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:8},this.createSection(a,"trait"),this.createSection(a,"action"),this.createSection(a,"bonus"),this.createSection(a,"reaction"),this.createSection(a,"legendary"),this.createSection(a,"mythic"),this.createSection(a,"lair")),r.a.createElement(v.a,{span:16},s))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),xt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:this.props.isSelected?"trait-bar selected":"trait-bar",onClick:function(){return e.props.select(e.props.trait.id)},role:"button"},r.a.createElement(it.a,{className:"grabber","data-movable-handle":!0}),r.a.createElement("div",{className:"name"},this.props.trait.name||"unnamed "+C.traitType(this.props.trait.type,!1)))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),It=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{key:this.props.trait.id,className:"section"},r.a.createElement("div",{className:"subheading"},"trait name"),r.a.createElement(ie,{text:this.props.trait.name,onChange:function(t){return e.props.changeValue(e.props.trait,"name",t)}}),r.a.createElement("div",{className:"subheading"},"usage"),r.a.createElement(ie,{text:this.props.trait.usage,onChange:function(t){return e.props.changeValue(e.props.trait,"usage",t)}}),r.a.createElement("div",{className:"subheading"},"details"),r.a.createElement(ie,{text:this.props.trait.text,placeholder:"details",multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.trait,"text",t)}}),r.a.createElement("hr",null),r.a.createElement(ce,{placeholder:"change trait type...",options:O.map((function(e){return{id:e,text:e}})),onSelect:function(t){return e.props.changeValue(e.props.trait,"type",t)}}),r.a.createElement("button",{onClick:function(){return e.props.copyTrait(e.props.trait)}},"create a copy of this trait"),r.a.createElement(rt,{text:"remove this trait",onConfirm:function(){return e.props.removeTrait(e.props.trait)}}))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Mt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=C.challengeDetails(),a=1;this.props.monster.damage.immune?a=this.props.monster.challenge<11?2:this.props.monster.challenge<17?1.5:1.25:this.props.monster.damage.resist&&(a=this.props.monster.challenge<5?2:this.props.monster.challenge<11?1.5:this.props.monster.challenge<17?1.25:1);var n=D.getTypicalHP(this.props.monster)*a,s=[],o=[];this.props.monster.traits.forEach((function(e){o=o.concat(D.getToHitExpressions(e).map((function(e){return e.bonus}))),s=s.concat(D.getSaveExpressions(e).map((function(e){return e.dc})))}));var i=Math.min.apply(Math,Object(N.a)(o)),c=Math.max.apply(Math,Object(N.a)(o)),l=Math.min.apply(Math,Object(N.a)(s)),u=Math.max.apply(Math,Object(N.a)(s));return r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("p",null,"this table shows typical values for certain stats (ac, hp, etc) for a given challenge rating"),r.a.createElement("p",null,"to gauge a monster's cr, take the average of its defensive cr (from ac and hp) and offensive cr (from attack bonus, save dc, and damage per round)")),r.a.createElement("div",{className:"table alternating"},r.a.createElement(f.a,{className:"table-row table-row-header"},r.a.createElement(v.a,{span:4,className:"table-cell"},"cr"),r.a.createElement(v.a,{span:4,className:"table-cell"},"ac"),r.a.createElement(v.a,{span:4,className:"table-cell"},"effective hp"),r.a.createElement(v.a,{span:4,className:"table-cell"},"attack bonus"),r.a.createElement(v.a,{span:4,className:"table-cell"},"save dc"),r.a.createElement(v.a,{span:4,className:"table-cell"},"dmg / rnd")),t.map((function(t){var a=t.cr===e.props.monster.challenge,s=t.ac===e.props.monster.ac,o=t.hpMin<=n&&t.hpMax>=n,d=i<=t.attack&&c>=t.attack,m=l<=t.save&&u>=t.save;return r.a.createElement(f.a,{key:t.cr,className:"table-row"},r.a.createElement(v.a,{span:4,className:a?"table-cell table-cell-highlight":"table-cell"},C.challenge(t.cr)),r.a.createElement(v.a,{span:4,className:s?"table-cell table-cell-highlight":"table-cell"},t.ac),r.a.createElement(v.a,{span:4,className:o?"table-cell table-cell-highlight":"table-cell"},t.hpMin," - ",t.hpMax),r.a.createElement(v.a,{span:4,className:d?"table-cell table-cell-highlight":"table-cell"},"+",t.attack),r.a.createElement(v.a,{span:4,className:m?"table-cell table-cell-highlight":"table-cell"},t.save),r.a.createElement(v.a,{span:4,className:"table-cell"},t.dmgMin," - ",t.dmgMax))}))))}catch(d){return console.error(d),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ot=a(289),Dt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={pc:e.pc,showImageSelection:!1},n}return Object(c.a)(a,[{key:"toggleImageSelection",value:function(){this.setState({showImageSelection:!this.state.showImageSelection})}},{key:"addCompanion",value:function(){var e=w.createCompanion();e.name="new companion",this.state.pc.companions.push(e),this.setState({pc:this.state.pc})}},{key:"removeCompanion",value:function(e){var t=this.state.pc;t.companions=this.state.pc.companions.filter((function(t){return t.id!==e})),this.setState({pc:t})}},{key:"changeValue",value:function(e,t,a){e[t]=a,this.setState({pc:this.state.pc,showImageSelection:!1})}},{key:"nudgeValue",value:function(e,t,a){var n,r=e[t];switch(t){case"size":n=C.nudgeSize(r,a);break;default:n=(r||0)+a}this.changeValue(e,t,n)}},{key:"render",value:function(){var e=this;try{var t=[];this.props.library.forEach((function(e){e.monsters.forEach((function(e){t.push({id:e.id,text:e.name})}))})),k.sort(t,[{field:"text",dir:"asc"}]);var a=this.state.pc.companions.map((function(a){return r.a.createElement("div",{className:"group-panel companion-list-item",key:a.id},r.a.createElement("div",{className:"companion-fields"},r.a.createElement(ie,{text:a.name,onChange:function(t){return e.changeValue(a,"name",t)}}),r.a.createElement(ce,{options:t,placeholder:"select a stat block",selectedID:a.monsterID||void 0,onSelect:function(t){return e.changeValue(a,"monsterID",t)},onClear:function(){return e.changeValue(a,"monsterID",null)}})),r.a.createElement("div",{className:"companion-actions"},r.a.createElement(Ot.a,{onClick:function(){return e.removeCompanion(a.id)}})))}));return 0===a.length&&a.push(r.a.createElement("div",{className:"section",key:"empty"},r.a.createElement("i",null,"no companions (pets, retainers, mounts, etc)"))),r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable padded"},r.a.createElement("div",{className:"subheading"},"character name:"),r.a.createElement(ie,{text:this.state.pc.name,onChange:function(t){return e.changeValue(e.state.pc,"name",t)}}),r.a.createElement("div",{className:"subheading"},"player name:"),r.a.createElement(ie,{text:this.state.pc.player,onChange:function(t){return e.changeValue(e.state.pc,"player",t)}}),r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(fe,{value:this.state.pc.size,downEnabled:"tiny"!==this.state.pc.size,upEnabled:"gargantuan"!==this.state.pc.size,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"size",t)}}),r.a.createElement("div",{className:"subheading"},"race:"),r.a.createElement(ie,{text:this.state.pc.race,onChange:function(t){return e.changeValue(e.state.pc,"race",t)}}),r.a.createElement("div",{className:"subheading"},"class:"),r.a.createElement(ie,{text:this.state.pc.classes,onChange:function(t){return e.changeValue(e.state.pc,"classes",t)}}),r.a.createElement("div",{className:"subheading"},"level:"),r.a.createElement(fe,{value:this.state.pc.level,downEnabled:this.state.pc.level>1,upEnabled:this.state.pc.level<20,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"level",t)}}),r.a.createElement("div",{className:"subheading"},"passive skills"),r.a.createElement(fe,{value:this.state.pc.passiveInsight,label:"insight",downEnabled:this.state.pc.passiveInsight>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passiveInsight",t)}}),r.a.createElement(fe,{value:this.state.pc.passiveInvestigation,label:"investigation",downEnabled:this.state.pc.passiveInvestigation>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passiveInvestigation",t)}}),r.a.createElement(fe,{value:this.state.pc.passivePerception,label:"perception",downEnabled:this.state.pc.passivePerception>0,onNudgeValue:function(t){return e.nudgeValue(e.state.pc,"passivePerception",t)}})),r.a.createElement(v.a,{span:12,className:"scrollable padded"},r.a.createElement("div",{className:"subheading"},"languages:"),r.a.createElement(ie,{text:this.state.pc.languages,onChange:function(t){return e.changeValue(e.state.pc,"languages",t)}}),r.a.createElement("div",{className:"subheading"},"d&d beyond link:"),r.a.createElement(ie,{text:this.state.pc.url,placeholder:"https://ddb.ac/characters/...",onChange:function(t){return e.changeValue(e.state.pc,"url",t)}}),r.a.createElement("div",{className:"subheading"},"portrait"),r.a.createElement(ae,{source:this.state.pc,setPortrait:function(t){return e.changeValue(e.state.pc,"portrait",t)},clear:function(){return e.changeValue(e.state.pc,"portrait","")}}),r.a.createElement("div",{className:"subheading"},"companions:"),a,r.a.createElement("button",{onClick:function(){return e.addCompanion()}},"add a new companion")),r.a.createElement(g.a,{visible:this.state.showImageSelection,closable:!1,onClose:function(){return e.toggleImageSelection()}},r.a.createElement(st,{select:function(t){return e.changeValue(e.state.pc,"portrait",t)},cancel:function(){return e.toggleImageSelection()}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),jt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={map:e.map,imageID:null,size:0,square:0,imageDimensions:{width:0,height:0},mapDimensions:{width:0,height:0}},n}return Object(c.a)(a,[{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){if(a.target){var n=a.target.result;t.state.imageID&&window.localStorage.removeItem("image-"+t.state.imageID);try{var s={id:k.guid(),name:e.name,data:n},o=JSON.stringify(s);window.localStorage.setItem("image-"+s.id,o);var i=new Image;i.onload=function(){var e=Math.round(Math.min(i.width,i.height)/10);t.setState({imageID:s.id,size:n.length,square:e,imageDimensions:{width:i.width,height:i.height},mapDimensions:{width:Math.round(i.width/e),height:Math.round(i.height/e)}},(function(){t.updateMap(s.name)}))},i.src=n}catch(c){h.a.open({message:"can't upload this image",description:"not enough storage space for this image ("+k.toData(n.length)+"); try reducing the resolution or removing unused images",closeIcon:r.a.createElement(p.a,null),duration:5})}}},a.readAsDataURL(e),!1}},{key:"nudgeSquare",value:function(e){var t=this,a=Math.max(0,this.state.square+e);this.setState({square:a,mapDimensions:{width:Math.round(this.state.imageDimensions.width/a),height:Math.round(this.state.imageDimensions.height/a)}},(function(){t.updateMap(null)}))}},{key:"nudgeWidth",value:function(e){var t=this,a=Math.max(0,this.state.mapDimensions.width+e);this.setState({mapDimensions:{width:a,height:this.state.mapDimensions.height}},(function(){t.updateMap(null)}))}},{key:"nudgeHeight",value:function(e){var t=this,a=Math.max(0,this.state.mapDimensions.height+e);this.setState({mapDimensions:{width:this.state.mapDimensions.width,height:a}},(function(){t.updateMap(null)}))}},{key:"updateMap",value:function(e){var t=this.state.map;if(e&&(t.name=e),this.state.imageID){var a=w.createMapItem();a.type="tile",a.terrain="custom",a.customBackground=this.state.imageID,a.width=this.state.mapDimensions.width,a.height=this.state.mapDimensions.height,t.items=[a]}else t.items=[];this.setState({map:t})}},{key:"render",value:function(){var e=this;try{var t=null;return t=this.state.imageID&&this.state.imageDimensions?r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"this image is ",k.toData(this.state.size)),r.a.createElement("div",{className:"section"},"set the name and dimensions of this map image"),r.a.createElement("div",{className:"section"},"changing the size of a map square, in pixels, will change the map's dimensions"),r.a.createElement("div",{className:"section"},"you can then fine-tune the exact width and height of the map")),r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(ie,{text:this.state.map.name,placeholder:"map name",onChange:function(t){return e.updateMap(t)}}),r.a.createElement("div",{className:"subheading"},"map square size"),r.a.createElement(fe,{value:this.state.square+" px",label:"square size",factors:[1,10],downEnabled:this.state.square>1,onNudgeValue:function(t){return e.nudgeSquare(t)}}),r.a.createElement("div",{className:"subheading"},"map dimensions"),r.a.createElement(fe,{value:this.state.mapDimensions.width+" sq",label:"width",downEnabled:this.state.mapDimensions.width>1,onNudgeValue:function(t){return e.nudgeWidth(t)}}),r.a.createElement(fe,{value:this.state.mapDimensions.height+" sq",label:"height",downEnabled:this.state.mapDimensions.height>1,onNudgeValue:function(t){return e.nudgeHeight(t)}})):r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(te.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"),r.a.createElement("p",{className:"ant-upload-text"},"try to upload small images if possible"))),r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:8,className:"scrollable"},t),r.a.createElement(v.a,{span:16,className:"scrollable both-ways"},r.a.createElement(xe,{map:this.state.map,mode:"edit",showGrid:!0,gridSquareClicked:function(e,t){return null}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Tt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={showContent:!0},n}return Object(c.a)(a,[{key:"toggleContentVisible",value:function(){this.setState({showContent:!this.state.showContent})}},{key:"render",value:function(){var e=this;try{var t=this.props.content.filter((function(e){return!!e}));if(0===t.length)return null;var a=null;if(this.props.heading){var n=null;this.props.showToggle&&(n=r.a.createElement(ue.a,{className:this.state.showContent?"rotate":"",onClick:function(){return e.toggleContentVisible()}})),a=r.a.createElement("div",{className:"heading fixed-top"},r.a.createElement("div",{className:"title"},this.props.heading),n)}var s=null;if(this.state.showContent){var o=6;switch(this.props.columns){case 1:o=24;break;case 2:o=12;break;case 3:o=8}s=r.a.createElement(f.a,{align:"top",gutter:10},t.map((function(e){return r.a.createElement(v.a,{key:t.indexOf(e),span:o},e)})))}return r.a.createElement("div",{className:"grid-panel"},a,s)}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Tt.defaultProps={columns:0,heading:null,showToggle:!1};var Pt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={group:e.group},n}return Object(c.a)(a,[{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e){var n=a[e];t.state.group[e]=n}})),t.state.group.monsters.forEach((function(e){e.id=k.guid(),e.portrait=""})),t.setState({group:t.state.group})})),!1}},{key:"render",value:function(){var e=this;try{return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(te.a.Dragger,{accept:".monstergroup",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))),r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement(Tt,{heading:this.props.group.name,columns:1,content:this.props.group.monsters.map((function(e){return r.a.createElement(vt,{key:e.id,monster:e})}))})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Vt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",monster:e.monster},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){D.import(this.state.source,this.state.monster),this.setState({monster:this.state.monster})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e&&"portrait"!==e){var n=a[e];t.state.monster[e]=n}})),t.setState({monster:t.state.monster})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":a=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"go to the following link to find the monster you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/monsters",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/monsters")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),r.a.createElement(ie,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(te.a.Dragger,{accept:".monster",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement(bt,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(v.a,{span:12,className:"scrollable",style:{padding:"5px"}},r.a.createElement(vt,{monster:this.state.monster})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),At=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"importParty",value:function(t,a){a.name="",a.pcs=[];var n=(new DOMParser).parseFromString(t,"text/html");try{a.name=n.getElementsByClassName("page-title")[0].innerText.trim()}catch(u){console.error(u)}try{for(var r=n.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-active")[0].getElementsByClassName("ddb-campaigns-character-card"),s=0;s!==r.length;++s){var o=r[s];a.pcs.push(e.getCharacter(o,!0))}}catch(u){console.error(u)}try{for(var i=n.getElementsByClassName("ddb-campaigns-detail-body-listing ddb-campaigns-detail-body-listing-inactive")[0].getElementsByClassName("ddb-campaigns-character-card"),c=0;c!==i.length;++c){var l=i[c];a.pcs.push(e.getCharacter(l,!1))}}catch(u){console.error(u)}}},{key:"getCharacter",value:function(e,t){var a=w.createPC();a.name=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-primary")[0].innerText.trim(),a.player=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[1].innerText.trim().substring(8),a.active=t;var n=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[0].innerText.trim().split("|");a.level=Number.parseInt(n[0].substring(4).trim(),10),a.race=n[1].trim(),a.classes=n[2].trim();var r=e.getElementsByClassName("ddb-campaigns-character-card-header-upper-details-link")[0];return a.url="https://www.dndbeyond.com"+r.getAttribute("href"),a}},{key:"importPC",value:function(e,t){try{var a=JSON.parse(e);t.name=a.character.name,t.size=a.character.race.size,t.race=a.character.race.fullName;var n=0,r="";a.character.classes.forEach((function(e){n+=e.level,""!==r&&(r+=" / "),r+=e.definition.name,e.subclassDefinition&&(r+=" ("+e.subclassDefinition.name+")")})),t.classes=r,t.level=n;var s=[].concat(a.character.modifiers.race).concat(a.character.modifiers.class).concat(a.character.modifiers.background).concat(a.character.modifiers.item).concat(a.character.modifiers.feat).concat(a.character.modifiers.condition),o=s.filter((function(e){return"language"===e.type})).map((function(e){return e.friendlySubtypeName}));t.languages=o.join(", ");var i=C.proficiency(n),c=a.character.stats[3].value,l=a.character.stats[4].value;s.filter((function(e){return"bonus"===e.type&&"intelligence-score"===e.subType})).forEach((function(e){return c+=e.value})),s.filter((function(e){return"bonus"===e.type&&"wisdom-score"===e.subType})).forEach((function(e){return l+=e.value}));var u=0,d=0,m=0,p=s.filter((function(e){return"insight"===e.subType||"wisdom-ability-checks"===e.subType})).map((function(e){return e.type}));p.includes("expertise")?u=2:p.includes("proficiency")?u=1:p.includes("half-proficiency-round-up")&&(u=.5);var h=s.filter((function(e){return"investigation"===e.subType||"intelligence-ability-checks"===e.subType})).map((function(e){return e.type}));h.includes("expertise")?d=2:h.includes("proficiency")?d=1:p.includes("half-proficiency-round-up")&&(d=.5);var f=s.filter((function(e){return"perception"===e.subType||"wisdom-ability-checks"===e.subType})).map((function(e){return e.type}));f.includes("expertise")?m=2:f.includes("proficiency")?m=1:p.includes("half-proficiency-round-up")&&(m=.5),t.passiveInsight=10+C.modifierValue(l)+Math.floor(i*u),t.passiveInvestigation=10+C.modifierValue(c)+Math.floor(i*d),t.passivePerception=10+C.modifierValue(l)+Math.floor(i*m),t.companions=[],a.character.creatures.forEach((function(e){var a=w.createCompanion();a.name=e.name,t.companions.push(a)}))}catch(v){console.error(v)}}}]),e}(),Rt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e=null;this.props.pc.companions.length>0&&(e=this.props.pc.companions.map((function(e){return r.a.createElement("div",{key:e.id},e.name)})));var t=(this.props.pc?this.props.pc.displayName:null)||this.props.pc.name||"unnamed pc";return r.a.createElement("div",{className:"card pc"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:t},t)),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"stats"},r.a.createElement(ae,{source:this.props.pc}),r.a.createElement("div",{className:"section centered lowercase"},r.a.createElement($.a,null,this.props.pc.race||"unknown race"),r.a.createElement($.a,null,this.props.pc.classes||"unknown class"),r.a.createElement($.a,null,"level "+this.props.pc.level)),r.a.createElement("div",{className:"section centered",style:{display:this.props.pc.url?"":"none"}},r.a.createElement("a",{href:this.props.pc.url,target:"_blank",rel:"noopener noreferrer"},"d&d beyond sheet")),r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"size"),r.a.createElement("div",{className:"section"},this.props.pc.size),r.a.createElement("div",{className:"section subheading"},"languages"),r.a.createElement("div",{className:"section"},this.props.pc.languages||"-"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(v.a,{span:8},r.a.createElement(ut,{prefix:"passive",label:"insight",value:this.props.pc.passiveInsight})),r.a.createElement(v.a,{span:8},r.a.createElement(ut,{prefix:"passive",label:"investigation",value:this.props.pc.passiveInvestigation})),r.a.createElement(v.a,{span:8},r.a.createElement(ut,{prefix:"passive",label:"perception",value:this.props.pc.passivePerception}))),r.a.createElement("div",{style:{display:this.props.pc.companions.length>0?"":"none"}},r.a.createElement("div",{className:"section subheading"},"companions"),r.a.createElement("div",{className:"section"},e)))))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Lt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",party:e.party},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){At.importParty(this.state.source,this.state.party),this.setState({party:this.state.party})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e){var n=a[e];t.state.party[e]=n}})),t.state.party.pcs.forEach((function(e){e.id=k.guid(),e.portrait=""})),t.setState({party:t.state.party})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":a=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"go to the following link to find the party you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/my-campaigns",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/my-campaigns")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),r.a.createElement(ie,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(te.a.Dragger,{accept:".party",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement(bt,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement(Tt,{heading:this.props.party.name,columns:1,content:this.props.party.pcs.map((function(e){return r.a.createElement(Rt,{key:e.id,pc:e})}))})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),zt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:"paste",source:"",pc:e.pc},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"setSource",value:function(e){this.setState({source:e})}},{key:"analyse",value:function(){At.importPC(this.state.source,this.state.pc),this.setState({pc:this.state.pc})}},{key:"readFile",value:function(e){var t=this;return e.text().then((function(e){var a=JSON.parse(e);Object.keys(a).forEach((function(e){if("id"!==e&&"portrait"!==e){var n=a[e];t.state.pc[e]=n}})),t.setState({pc:t.state.pc})})),!1}},{key:"render",value:function(){var e=this;try{var t=["paste","upload"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"paste":var n=null,s=this.state.pc.url;""!==s?(s.endsWith("/")||(s+="/"),s+="json",n=r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"go to the following link"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},s)),r.a.createElement("div",{className:"section"},"copy the data into the clipboard, paste it into the box below, and press the analyse button"))):n=r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"go to the following link to find the pc you want to import"),r.a.createElement("div",{className:"section"},r.a.createElement("a",{href:"https://www.dndbeyond.com/",target:"_blank",rel:"noopener noreferrer"},"https://www.dndbeyond.com/")),r.a.createElement("div",{className:"section"},"then right-click on the page and select ",r.a.createElement("b",null,"view page source")),r.a.createElement("div",{className:"section"},"copy the entire page source into the clipboard, paste it into the box below, and press the analyse button")),a=r.a.createElement("div",null,n,r.a.createElement(ie,{text:this.state.source,placeholder:"paste page source here",multiLine:!0,onChange:function(t){return e.setSource(t)}}),r.a.createElement("button",{onClick:function(){return e.analyse()}},"analyse"));break;case"upload":a=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"select the file you want to upload")),r.a.createElement(te.a.Dragger,{accept:".pc",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")))}return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement(bt,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),a),r.a.createElement(v.a,{span:12,className:"scrollable"},r.a.createElement(Rt,{pc:this.state.pc})))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),qt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={filter:w.createMonsterFilter()},n}return Object(c.a)(a,[{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:w.createMonsterFilter()})}},{key:"render",value:function(){var e=this;try{var t=[],a=this.props.wave?this.props.wave.slots:this.props.encounter.slots;this.props.library.forEach((function(n){n.monsters.forEach((function(n){var r=z.matchMonster(n,e.state.filter),s=!e.props.slot||e.props.slot.roles.includes(n.role),o=a.some((function(e){return e.monsterID===n.id}));r&&s&&!o&&t.push(n)}))})),t.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var n=!!this.props.slot&&this.props.slot.roles.length>0,s=r.a.createElement(Be,{items:t.map((function(e){return{id:e.id,text:e.name,info:"cr "+C.challenge(e.challenge)}})),selectedItemID:this.props.monster?this.props.monster.id:null,onSelect:function(a){var n;return e.props.setMonster(null!==(n=t.find((function(e){return e.id===a})))&&void 0!==n?n:null)}});if(0===t.length){var o=z.getFilterDescription(this.state.filter);s=r.a.createElement(Pe,{key:"empty"},"there are no monsters that meet the criteria ",r.a.createElement("i",null,o)," (or they are all already part of the encounter)")}var i=r.a.createElement(Pe,null,"select a monster from the list at the left to see its statblock here");return this.props.monster&&(i=r.a.createElement(vt,{monster:this.props.monster})),r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:8,className:"scrollable"},r.a.createElement("div",{className:"section"},r.a.createElement(ge,{filter:this.state.filter,showRoles:!n,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}})),r.a.createElement("hr",null),s),r.a.createElement(v.a,{span:16,className:"scrollable"},i))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ft=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{if(!this.props.source)return null;var e=null;switch(this.props.source.type){case"pc":e=r.a.createElement(Rt,{pc:this.props.source});break;case"monster":e=r.a.createElement(vt,{monster:this.props.source})}return r.a.createElement("div",{className:"scrollable padded"},e)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Gt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"success",value:function(){switch(this.props.notification.type){case"condition-save":case"condition-end":var e=this.props.notification.data;e.duration&&("saves"!==e.duration.type&&"rounds"!==e.duration.type||(e.duration.count-=1,this.close(0===e.duration.count)));break;case"trait-recharge":this.props.notification.data.uses=0,this.close(!1)}}},{key:"close",value:function(e){this.props.close(this.props.notification,e)}},{key:"render",value:function(){var e=this;try{var t=this.props.notification.combatant,a=t.displayName||t.name||"unnamed monster";switch(this.props.notification.type){case"condition-save":var n=this.props.notification.data,s="custom"===n.name?n.text:n.name,o=n.duration,i=o.saveType.toString();return"death"!==i&&(i=i.toUpperCase()),r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("b",null,a)," (",r.a.createElement("i",null,s),") must make a ",i," save against dc ",o.saveDC),r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.success()}},"success")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.close(!1)}},"failure"))));case"condition-end":var c=this.props.notification.data,l="custom"===c.name?c.text:c.name;return r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("b",null,a)," is no longer affected by condition ",r.a.createElement("b",null,l),r.a.createElement("button",{onClick:function(){return e.close(!1)}},"close")));case"trait-recharge":var u=this.props.notification.data;return r.a.createElement("div",null,r.a.createElement("div",{className:"section"},r.a.createElement("b",null,a)," can attempt to recharge ",r.a.createElement("b",null,u.name)),r.a.createElement("div",{className:"section"},u.usage),r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.success()}},"recharge")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.close(!1)}},"close"))))}}catch(d){return console.error(d),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Bt=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={hasError:!1},n}return Object(c.a)(a,[{key:"componentDidCatch",value:function(e,t){console.error(e.name),console.error(e.message),console.error(e.stack),console.error(t.componentStack)}},{key:"render",value:function(){return this.state.hasError?r.a.createElement("div",{className:"render-error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),a}(r.a.Component),Ut=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.tabs.map((function(t){return r.a.createElement("div",{key:t.id,className:t.selected?"navigator-item selected":"navigator-item",onClick:function(){return e.props.onSelectView(t.id)},role:"button"},t.text)}));return r.a.createElement("div",{className:"page-footer"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ut.defaultProps={tabs:[],onSelectView:null};var Ht=a(288),Wt=a(321),Jt=a(287),_t=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.breadcrumbs.map((function(e){return r.a.createElement("div",{key:e.id,className:"breadcrumb",onClick:function(){return e.onClick()},role:"button"},e.text)})),a=null;return this.props.onToggleSidebar&&(a=r.a.createElement(Ht.a,{className:"toggle",title:"show sidebar",onClick:function(){return e.props.onToggleSidebar()}}),this.props.sidebarVisible&&(a=r.a.createElement(Wt.a,{className:"toggle",title:"hide sidebar",onClick:function(){return e.props.onToggleSidebar()}}))),this.props.onToggleSettings&&(a=r.a.createElement(Jt.a,{className:"toggle",title:"settings",onClick:function(){return e.props.onToggleSettings()}})),r.a.createElement("div",{className:"page-header"},r.a.createElement("div",{className:"app-title"},t),a)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);_t.defaultProps={sidebarVisible:!1,onToggleSidebar:null,onToggleSettings:null};var Yt=a(276),Xt=a(275),Kt=a(320),Zt=a(319),Qt=a(318),$t=a(311),ea=a(305),ta=a(304),aa=a(145),na=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:"dojo"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"clearImages",value:function(){j.clearUnusedImages(this.props.maps,this.props.combats,this.props.explorations),this.setState({view:this.state.view})}},{key:"render",value:function(){var e=this;try{var t=["dojo","settings","ogl"].map((function(e){return{id:e,text:e}})),a=null;switch(this.state.view){case"dojo":a=r.a.createElement("div",null,r.a.createElement("div",{className:"section"},"designed by ",r.a.createElement("a",{href:"mailto:andy.aiken@live.co.uk"},"andy aiken")),r.a.createElement("div",{className:"section"},"version ",r.a.createElement("b",null,aa.version)),r.a.createElement("div",{className:"section"},"if you would like to raise a bug or request a new feature, you can do so here: ",r.a.createElement("a",{href:"https://github.com/andyaiken/dojo",target:"_blank",rel:"noopener noreferrer"},"repository")),r.a.createElement("div",{className:"section"},"the roadmap for planned new features can be found here: ",r.a.createElement("a",{href:"https://github.com/andyaiken/dojo/projects/8?fullscreen=true",target:"_blank",rel:"noopener noreferrer"},"roadmap")));break;case"settings":for(var n=0,s=0,o=0;o!==window.localStorage.length;++o){var i=window.localStorage.key(o);if(i){var c=window.localStorage.getItem(i);c&&(i.startsWith("data")&&(n+=c.length),i.startsWith("image")&&(s+=c.length))}}a=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"turn this setting on to add die roll buttons to monster stat blocks")),r.a.createElement(re,{label:"show monster die rolls",checked:this.props.options.showMonsterDieRolls,onChecked:function(t){return e.props.setOption("showMonsterDieRolls",t)}}),r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"the browser has a limited amount of image storage space"),r.a.createElement("div",{className:"section"},"use this button to delete anything that isn't currently being used")),r.a.createElement("button",{onClick:function(){return e.clearImages()}},"remove unused images"),r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"data"),r.a.createElement("div",{className:"section"},r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"total"),r.a.createElement(v.a,{span:8,className:"right-value"},k.toData(n+s))),r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"data"),r.a.createElement(v.a,{span:8,className:"right-value"},k.toData(n))),r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"images"),r.a.createElement(v.a,{span:8,className:"right-value"},k.toData(s)))));break;case"ogl":a=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"open game license"),r.a.createElement("div",{className:"section"},"The following text is the property of Wizards of the Coast, Inc. and is Copyright 2000 Wizards of the Coast, Inc ('Wizards'). All Rights Reserved."),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("b",null,"Definitions"),": (a)'Contributors' means the copyright and/or trademark owners who have contributed Open Game Content; (b)'Derivative Material' means copyrighted material including derivative works and translations (including into other computer languages), potation, modification, correction, addition, extension, upgrade, improvement, compilation, abridgment or other form in which an existing work may be recast, transformed or adapted; (c) 'Distribute' means to reproduce, license, rent, lease, sell, broadcast, publicly display, transmit or otherwise distribute; (d)'Open Game Content' means the game mechanic and includes the methods, procedures, processes and routines to the extent such content does not embody the Product Identity and is an enhancement over the prior art and any additional content clearly identified as Open Game Content by the Contributor, and means any work covered by this License, including translations and derivative works under copyright law, but specifically excludes Product Identity. (e) 'Product Identity' means product and product line names, logos and identifying marks including trade dress; artifacts; creatures characters; stories, storylines, plots, thematic elements, dialogue, incidents, language, artwork, symbols, designs, depictions, likenesses, formats, poses, concepts, themes and graphic, photographic and other visual or audio representations; names and descriptions of characters, spells, enchantments, personalities, teams, personas, likenesses and special abilities; places, locations, environments, creatures, equipment, magical or supernatural abilities or effects, logos, symbols, or graphic designs; and any other trademark or registered trademark clearly identified as Product identity by the owner of the Product Identity, and which specifically excludes the Open Game Content; (f) 'Trademark' means the logos, names, mark, sign, motto, designs that are used by a Contributor to identify itself or its products or the associated products contributed to the Open Game License by the Contributor (g) 'Use', 'Used' or 'Using' means to use, Distribute, copy, edit, format, modify, translate and otherwise create Derivative Material of Open Game Content. (h) 'You' or 'Your' means the licensee in terms of this agreement."),r.a.createElement("li",null,r.a.createElement("b",null,"The License"),": This License applies to any Open Game Content that contains a notice indicating that the Open Game Content may only be Used under and in terms of this License. You must affix such a notice to any Open Game Content that you Use. No terms may be added to or subtracted from this License except as described by the License itself. No other terms or conditions may be applied to any Open Game Content distributed using this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Offer and Acceptance"),": By Using the Open Game Content You indicate Your acceptance of the terms of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Grant and Consideration"),": In consideration for agreeing to use this License, the Contributors grant You a perpetual, worldwide, royalty-free, non-exclusive license with the exact terms of this License to Use, the Open Game Content."),r.a.createElement("li",null,r.a.createElement("b",null,"Representation of Authority to Contribute"),": If You are contributing original material as Open Game Content, You represent that Your Contributions are Your original creation and/or You have sufficient rights to grant the rights conveyed by this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Notice of License Copyright"),": You must update the COPYRIGHT NOTICE portion of this License to include the exact text of the COPYRIGHT NOTICE of any Open Game Content You are copying, modifying or distributing, and You must add the title, the copyright date, and the copyright holder's name to the COPYRIGHT NOTICE of any original Open Game Content you Distribute."),r.a.createElement("li",null,r.a.createElement("b",null,"Use of Product Identity"),": You agree not to Use any Product Identity, including as an indication as to compatibility, except as expressly licensed in another, independent Agreement with the owner of each element of that Product Identity. You agree not to indicate compatibility or co-adaptability with any Trademark or Registered Trademark in conjunction with a work containing Open Game Content except as expressly licensed in another, independent Agreement with the owner of such Trademark or Registered Trademark. The use of any Product Identity in Open Game Content does not constitute a challenge to the ownership of that Product Identity. The owner of any Product Identity used in Open Game Content shall retain all rights, title and interest in and to that Product Identity."),r.a.createElement("li",null,r.a.createElement("b",null,"Identification"),": If you distribute Open Game Content You must clearly indicate which portions of the work that you are distributing are Open Game Content."),r.a.createElement("li",null,r.a.createElement("b",null,"Updating the License"),": Wizards or its designated Agents may publish updated versions of this License. You may use any authorized version of this License to copy, modify and distribute any Open Game Content originally distributed under any version of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Copy of this License"),": You MUST include a copy of this License with every copy of the Open Game Content You Distribute."),r.a.createElement("li",null,r.a.createElement("b",null,"Use of Contributor Credits"),": You may not market or advertise the Open Game Content using the name of any Contributor unless You have written permission from the Contributor to do so."),r.a.createElement("li",null,r.a.createElement("b",null,"Inability to Comply"),": If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Open Game Content due to statute, judicial order, or governmental regulation then You may not Use any Open Game Material so affected."),r.a.createElement("li",null,r.a.createElement("b",null,"Termination"),": This License will terminate automatically if You fail to comply with all terms herein and fail to cure such breach within 30 days of becoming aware of the breach. All sublicenses shall survive the termination of this License."),r.a.createElement("li",null,r.a.createElement("b",null,"Reformation"),": If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable."),r.a.createElement("li",null,r.a.createElement("b",null,"COPYRIGHT NOTICE")," Open Game License v 1.0 Copyright 2000, Wizards of the Coast, Inc.")))}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"about"),r.a.createElement(Y,{options:t,selectedID:this.state.view,onSelect:function(t){return e.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},a))}catch(l){return console.error(l),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ra=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;return this.props.npc&&(t=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"age:")," ",this.props.npc.age),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"profession:")," ",this.props.npc.profession),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"height:")," ",this.props.npc.height),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"weight:")," ",this.props.npc.weight),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"hair:")," ",this.props.npc.hair),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"physical:")," ",this.props.npc.physical),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"personality:")," ",this.props.npc.mental),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"speech:")," ",this.props.npc.speech),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"trait:")," ",this.props.npc.trait),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"ideal:")," ",this.props.npc.ideal),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"bond:")," ",this.props.npc.bond),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"flaw:")," ",this.props.npc.flaw)))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.generateNPC()}},"generate"),t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),sa=a(42),oa=a.n(sa),ia=a(57),ca=a(286),la=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={values:[]},n}return Object(c.a)(a,[{key:"generate",value:function(){var e=Object(ia.a)(oa.a.mark((function e(){var t,a,n;return oa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/dojo/data/places.txt");case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,T.initModel([a]),n=T.generateLines(10),this.setState({values:n});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;try{for(var t=[],a=0;a!==this.state.values.length;++a)t.push(r.a.createElement(ua,{key:a,text:this.state.values[a]}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t.length>0?r.a.createElement("hr",null):null,t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ua=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement(ca.a,{title:"copy to clipboard",onClick:function(t){return e.copy(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),da=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={values:[]},n}return Object(c.a)(a,[{key:"generate",value:function(){for(var e=[];e.length<10;){var t="";switch(this.props.type){case"book":t=T.generateBookTitle();break;case"name":t=T.generateName();break;case"potion":t=T.generatePotion();break;case"treasure":t=T.generateTreasure()}e.includes(t)||e.push(t)}e.sort(),this.setState({values:e})}},{key:"render",value:function(){var e=this;try{for(var t=[],a=0;a!==this.state.values.length;++a)t.push(r.a.createElement(ma,{key:a,text:this.state.values[a]}));return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.generate()}},"generate"),t.length>0?r.a.createElement("hr",null):null,t)}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ma=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement(ca.a,{title:"copy to clipboard",onClick:function(t){return e.copy(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),pa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"name":t=r.a.createElement(da,{key:"name",type:"name"});break;case"book":t=r.a.createElement(da,{key:"book",type:"book"});break;case"potion":t=r.a.createElement(da,{key:"potion",type:"potion"});break;case"treasure":t=r.a.createElement(da,{key:"treasure",type:"treasure"});break;case"place":t=r.a.createElement(la,null);break;case"npc":t=r.a.createElement(ra,{npc:this.props.npc,generateNPC:function(){return e.props.generateNPC()}})}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"generators"),r.a.createElement(Y,{options:[{id:"name",text:"names"},{id:"book",text:"book titles"},{id:"potion",text:"potions"},{id:"treasure",text:"treasures"},{id:"place",text:"place names"},{id:"npc",text:"npc"}],selectedID:this.props.view,itemsPerRow:3,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ha=a(285),fa=a(264),va=new Ne.a.Converter;va.setOption("tables",!0);var ga=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={source:null},n}return Object(c.a)(a,[{key:"fetchData",value:function(){var e=Object(ia.a)(oa.a.mark((function e(){var t,a;return oa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.props.filename);case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,this.setState({source:a});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){try{return this.state.source||this.fetchData(),r.a.createElement(fa.a,{spinning:null===this.state.source,indicator:r.a.createElement(ha.a,{style:{fontSize:20,marginTop:100}})},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:va.makeHtml(this.state.source||"")}}))}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ya=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={externalWindow:null,containerElement:null},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=window.open("","","width=800, height=500, left=200, top=200"),a=null;t&&((a=t.document.createElement("div")).className="dojo popout",t.document.body.appendChild(a),Array.from(document.styleSheets).forEach((function(e){var a=e;if(e.href){var n=document.createElement("link");n.rel="stylesheet",n.href=e.href,t.document.head.appendChild(n)}else if(a&&a.cssRules&&a.cssRules.length>0){var r=document.createElement("style");Array.from(a.cssRules).forEach((function(e){r.appendChild(document.createTextNode(e.cssText))})),t.document.head.appendChild(r)}})),t.document.title=this.props.title,t.addEventListener("beforeunload",(function(){e.props.onCloseWindow()})));this.setState({externalWindow:t,containerElement:a})}},{key:"componentWillUnmount",value:function(){this.state.externalWindow&&this.state.externalWindow.close()}},{key:"render",value:function(){try{return this.state.containerElement?o.a.createPortal(this.props.children,this.state.containerElement):null}catch(e){return console.error(e),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ba=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={playerViewOpen:!1},n}return Object(c.a)(a,[{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"clear",value:function(){var e=this;"monster"===W.data.shared.type&&J.shareNothing(),this.setState({playerViewOpen:!1},(function(){e.props.selectMonsterID(null)}))}},{key:"getPlayerView",value:function(){var e=this,t=this.props.monsters.find((function(t){return t.id===e.props.selectedMonsterID}));return this.state.playerViewOpen&&t?r.a.createElement(ya,{title:"Monster",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("div",{className:"scrollable"},r.a.createElement(vt,{monster:t}))):null}},{key:"render",value:function(){var e=this;try{var t=this.props.monsters.find((function(t){return t.id===e.props.selectedMonsterID})),a=null;return t&&(a=r.a.createElement("div",null,r.a.createElement(re,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}}),r.a.createElement(re,{label:"share in session",disabled:"started"!==J.getState(),checked:"monster"===W.data.shared.type,onChecked:function(e){return e?J.shareMonster(t):J.shareNothing()}}),r.a.createElement("hr",null),r.a.createElement(vt,{monster:t}))),r.a.createElement("div",null,r.a.createElement(ce,{options:this.props.monsters.map((function(e){return{id:e.id,text:e.name}})),placeholder:"select a monster...",selectedID:this.props.selectedMonsterID,onSelect:function(t){return e.props.selectMonsterID(t)},onClear:function(){return e.clear()}}),a,this.getPlayerView())}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ea=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getSummary",value:function(){var e=this,t=this.props.parties.find((function(t){return t.id===e.props.selectedPartyID}));if(!t)return null;var a=t.pcs.filter((function(e){return e.active}));if(0===a.length)return r.a.createElement("div",{className:"section centered"},r.a.createElement("i",null,"no pcs"));var n=Math.round(a.reduce((function(e,t){return e+t.level}),0)/a.length),s=T.getSpokenLanguages(a).map((function(e){var t=a.filter((function(t){return t.languages.toLowerCase().includes(e.toLowerCase())})),n=t.length===a.length?"all pcs":t.map((function(e){return e.name})).join(", "),s=T.capitalise(e);return r.a.createElement("div",{key:s,className:"table-row"},r.a.createElement("div",{className:"table-cell l"},s),r.a.createElement("div",{className:"table-cell l"},n))})),o={min:Number.MAX_VALUE,max:Number.MIN_VALUE},i={min:Number.MAX_VALUE,max:Number.MIN_VALUE},c={min:Number.MAX_VALUE,max:Number.MIN_VALUE};a.forEach((function(e){o.min=Math.min(o.min,e.passiveInsight),o.max=Math.max(o.max,e.passiveInsight),i.min=Math.min(i.min,e.passiveInvestigation),i.max=Math.max(i.max,e.passiveInvestigation),c.min=Math.min(c.min,e.passivePerception),c.max=Math.max(c.max,e.passivePerception)}));for(var l=Math.min(o.min,i.min,c.min),u=Math.max(o.max,i.max,c.max),d=[],m=function(e){var t=a.filter((function(t){return t.passiveInsight===e})).map((function(e){return e.name})).join(", "),n=a.filter((function(t){return t.passiveInvestigation===e})).map((function(e){return e.name})).join(", "),s=a.filter((function(t){return t.passivePerception===e})).map((function(e){return e.name})).join(", ");d.push(r.a.createElement("div",{key:e,className:"table-row"},r.a.createElement("div",{className:"table-cell l small"},e),r.a.createElement("div",{className:"table-cell l"},t),r.a.createElement("div",{className:"table-cell l"},n),r.a.createElement("div",{className:"table-cell l"},s)))},p=u;p>=l;--p)m(p);return r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"section subheading"},"languages"),r.a.createElement("div",{className:"table alternating"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"language")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"spoken by"))),s),r.a.createElement("div",{className:"section subheading"},"passive skills"),r.a.createElement("div",{className:"table alternating"},r.a.createElement("div",{className:"table-row"},r.a.createElement("div",{className:"table-cell l small"}),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"insight")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"investigation")),r.a.createElement("div",{className:"table-cell l"},r.a.createElement("b",null,"perception"))),d),r.a.createElement(Pe,null,r.a.createElement("p",null,"remember that advantage / disadvantage grants +/- 5 to passive rolls")),r.a.createElement("div",{className:"section subheading"},"average level"),r.a.createElement("div",{className:"section"},n))}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement(ce,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"select a party...",selectedID:this.props.selectedPartyID,onSelect:function(t){return e.props.selectPartyID(t)},onClear:function(){return e.props.selectPartyID(null)}}),this.getSummary())}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ka=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=[{id:"skills",text:"skills"},{id:"conditions",text:"conditions"},{id:"actions",text:"actions"}];this.props.parties.length>0&&t.push({id:"party",text:"party"}),this.props.monsters.length>0&&t.push({id:"monster",text:"monster"});var a=null;switch(this.props.view){case"skills":a=r.a.createElement(ga,{key:"skills",filename:"/dojo/data/skills.md"});break;case"conditions":a=r.a.createElement(ga,{key:"conditions",filename:"/dojo/data/conditions.md"});break;case"actions":a=r.a.createElement(ga,{key:"actions",filename:"/dojo/data/actions.md"});break;case"party":a=r.a.createElement(Ea,{selectedPartyID:this.props.selectedPartyID,parties:this.props.parties,selectPartyID:function(t){return e.props.selectPartyID(t)}});break;case"monster":a=r.a.createElement(ba,{selectedMonsterID:this.props.selectedMonsterID,monsters:this.props.monsters,selectMonsterID:function(t){return e.props.selectMonsterID(t)}})}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"reference"),r.a.createElement(Y,{options:t,selectedID:this.props.view,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},a))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),wa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={text:""},n}return Object(c.a)(a,[{key:"setSearchTerm",value:function(e){this.setState({text:e})}},{key:"render",value:function(){var e=this;try{var t=[];return this.state.text.length>2&&(this.props.parties.filter((function(t){return L.matchParty(e.state.text,t)})).forEach((function(a){var n=[];a.pcs.filter((function(t){return L.matchPC(e.state.text,t)})).forEach((function(t){var a=[];t.companions.filter((function(t){return L.matchCompanion(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.name)))})),n.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openParty(a.id)},role:"button"},r.a.createElement("div",{className:"section"},a.name),n))})),this.props.library.filter((function(t){return L.matchGroup(e.state.text,t)})).forEach((function(a){var n=[];a.monsters.filter((function(t){return L.matchMonster(e.state.text,t)})).forEach((function(t){var a=[];t.traits.filter((function(t){return L.matchTrait(e.state.text,t)})).forEach((function(e){a.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},e.name)))})),n.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openGroup(a.id)},role:"button"},r.a.createElement("div",{className:"section"},a.name),n))})),this.props.encounters.filter((function(t){return L.matchEncounter(e.state.text,t,(function(t){return e.props.getMonster(t)}))})).forEach((function(a){var n=[];a.slots.filter((function(t){return L.matchEncounterSlot(e.state.text,t,(function(t){return e.props.getMonster(t)}))})).forEach((function(t){var a=e.props.getMonster(t.monsterID);n.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},a?a.name:"monster")))}));var s=[];a.waves.filter((function(t){return L.matchEncounterWave(e.state.text,t,(function(t){return e.props.getMonster(t)}))})).forEach((function(t){var a=[];t.slots.filter((function(t){return L.matchEncounterSlot(e.state.text,t,(function(t){return e.props.getMonster(t)}))})).forEach((function(t){var n=e.props.getMonster(t.monsterID);a.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},n?n.name:"monster")))})),s.push(r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement("div",{className:"section"},t.name),a))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openEncounter(a.id)},role:"button"},r.a.createElement("div",{className:"section"},a.name),n,s))})),this.props.maps.filter((function(t){return L.matchMap(e.state.text,t)})).forEach((function(a){var n=[];a.areas.filter((function(t){return L.matchMapArea(e.state.text,t)})).forEach((function(e){n.push(r.a.createElement("div",{key:e.id,className:"group-panel"},r.a.createElement("div",{className:"section"},"map area")))})),t.push(r.a.createElement("div",{key:a.id,className:"group-panel clickable",onClick:function(){return e.props.openMap(a.id)},role:"button"},r.a.createElement("div",{className:"section"},a.name),n))})),0===t.length&&t.push(r.a.createElement(Pe,{key:"empty"},"nothing found"))),r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"search"),r.a.createElement(ie,{text:this.state.text,placeholder:"enter your search term here",minLength:3,onChange:function(t){return e.setSearchTerm(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Na=a(283),Ca=a(282),Sa=a(281),xa=a(280),Ia=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"getTarotDeck",value:function(){return[].concat(e.getTarotMinorArcana()).concat(e.getTarotMajorArcana())}},{key:"getTarotMajorArcana",value:function(){return[this.createMajorArcana(0,"the fool","innocence, new beginnings, free spirit","recklessness, taken advantage of, inconsideration"),this.createMajorArcana(1,"the magician","willpower, desire, creation, manifestation","trickery, illusions, out of touch"),this.createMajorArcana(2,"the high priestess","intuitive, unconscious, inner voice","lack of center, lost inner voice, repressed feelings"),this.createMajorArcana(3,"the empress","motherhood, fertility, nature","dependence, smothering, emptiness, nosiness"),this.createMajorArcana(4,"the emperor","authority, structure, control, fatherhood","tyranny, rigidity, coldness"),this.createMajorArcana(5,"the hierophant","tradition, conformity, morality, ethics","rebellion, subversiveness, new approaches"),this.createMajorArcana(6,"the lovers","partnerships, duality, union","loss of balance, one-sidedness, disharmony"),this.createMajorArcana(7,"the chariot","direction, control, willpower","lack of control, lack of direction, aggression"),this.createMajorArcana(8,"justice","cause and effect, clarity, truth","dishonesty, unaccountability, unfairness"),this.createMajorArcana(9,"the hermit","contemplation, search for truth, inner guidance","loneliness, isolation, lost your way"),this.createMajorArcana(10,"the wheel of fortune","change, cycles, inevitable fate","no control, clinging to control, bad luck"),this.createMajorArcana(11,"strength","inner strength, bravery, compassion, focus","self doubt, weakness, insecurity"),this.createMajorArcana(12,"the hanged man","sacrifice, release, martyrdom","stalling, needless sacrifice, fear of sacrifice"),this.createMajorArcana(13,"death","end of cycle, beginnings, change, metamorphosis","fear of change, holding on, stagnation, decay"),this.createMajorArcana(14,"temperance","middle path, patience, finding meaning","extremes, excess, lack of balance"),this.createMajorArcana(15,"the devil","addiction, materialism, playfulness","freedom, release, restoring control"),this.createMajorArcana(16,"the tower","sudden upheaval, broken pride, disaster","disaster avoided, delayed disaster, fear of suffering"),this.createMajorArcana(17,"the star","hope, faith, rejuvenation","faithlessness, discouragement, insecurity"),this.createMajorArcana(18,"the moon","unconscious, illusions, intuition","confusion, fear, misinterpretation"),this.createMajorArcana(19,"the sun","joy, success, celebration, positivity","negativity, depression, sadness"),this.createMajorArcana(20,"judgement","reflection, reckoning, awakening","lack of self awareness, doubt, self loathing"),this.createMajorArcana(21,"the world","fulfillment, harmony, completion","incompletion, no closure")]}},{key:"getTarotMinorArcana",value:function(){return[this.createMinorArcana("ace","swords","breakthrough, clarity, sharp mind","confusion, brutality, chaos"),this.createMinorArcana(2,"swords","difficult choices, indecision, stalemate","lesser of two evils, no right choice, confusion"),this.createMinorArcana(3,"swords","heartbreak, suffering, grief","recovery, forgiveness, moving on"),this.createMinorArcana(4,"swords","rest, restoration, contemplation","restlessness, burnout, stress"),this.createMinorArcana(5,"swords","unbridled ambition, win at all costs, sneakiness","lingering resentment, desire to reconcile, forgiveness"),this.createMinorArcana(6,"swords","transition, leaving behind, moving on","emotional baggage, unresolved issues, resisting transition"),this.createMinorArcana(7,"swords","deception, trickery, tactics and strategy","coming clean, rethinking approach, deception"),this.createMinorArcana(8,"swords","imprisonment, entrapment, self-victimization","self acceptance, new perspective, freedom"),this.createMinorArcana(9,"swords","anxiety, hopelessness, trauma","hope, reaching out, despair"),this.createMinorArcana(10,"swords","failure, collapse, defeat","can't get worse, only upwards, inevitable end"),this.createMinorArcana("page","swords","curiosity, restlessness, mental energy","deception, manipulation, all talk"),this.createMinorArcana("knight","swords","action, impulsiveness, defending beliefs","no direction, disregard for consequences, unpredictability"),this.createMinorArcana("queen","swords","complexity, perceptiveness, clear mindedness","cold hearted, cruel, bitterness"),this.createMinorArcana("king","swords","head over heart, discipline, truth","manipulative, cruel, weakness"),this.createMinorArcana("ace","wands","creation, willpower, inspiration, desire","lack of energy, lack of passion, boredom"),this.createMinorArcana(2,"wands","planning, making decisions, leaving home","fear of change, playing safe, bad planning"),this.createMinorArcana(3,"wands","looking ahead, expansion, rapid growth","obstacles, delays, frustration"),this.createMinorArcana(4,"wands","community, home, celebration","lack of support, transience, home conflicts"),this.createMinorArcana(5,"wands","competition, rivalry, conflict","avoiding conflict, respecting differences"),this.createMinorArcana(6,"wands","victory, success, public reward","excess pride, lack of recognition, punishment"),this.createMinorArcana(7,"wands","perseverance, defensive, maintaining control","give up, destroyed confidence, overwhelmed"),this.createMinorArcana(8,"wands","rapid action, movement, quick decisions","panic, waiting, slowdown"),this.createMinorArcana(9,"wands","resilience, grit, last stand","exhaustion, fatigue, questioning motivations"),this.createMinorArcana(10,"wands","accomplishment, responsibility, burden","inability to delegate, overstressed, burnt out"),this.createMinorArcana("page","wands","exploration, excitement, freedom","lack of direction, procrastination, creating conflict"),this.createMinorArcana("knight","wands","action, adventure, fearlessness","anger, impulsiveness, recklessness"),this.createMinorArcana("queen","wands","courage, determination, joy","selfishness, jealousy, insecurities"),this.createMinorArcana("king","wands","big picture, leader, overcoming challenges","impulsive, overbearing, unachievable expectations"),this.createMinorArcana("ace","cups","new feelings, spirituality, intuition","emotional loss, blocked creativity, emptiness"),this.createMinorArcana(2,"cups","unity, partnership, connection","imbalance, broken communication, tension"),this.createMinorArcana(3,"cups","friendship, community, happiness","overindulgence, gossip, isolation"),this.createMinorArcana(4,"cups","apathy, contemplation, disconnectedness","sudden awareness, choosing happiness, acceptance"),this.createMinorArcana(5,"cups","loss, grief, self-pity","acceptance, moving on, finding peace"),this.createMinorArcana(6,"cups","familiarity, happy memories, healing","moving forward, leaving home, independence"),this.createMinorArcana(7,"cups","searching for purpose, choices, daydreaming","lack of purpose, diversion, confusion"),this.createMinorArcana(8,"cups","walking away, disillusionment, leaving behind","avoidance, fear of change, fear of loss"),this.createMinorArcana(9,"cups","satisfaction, emotional stability, luxury","lack of inner joy, smugness, dissatisfaction"),this.createMinorArcana(10,"cups","inner happiness, fulfillment, dreams coming true","shattered dreams, broken family, domestic disharmony"),this.createMinorArcana("page","cups","happy surprise, dreamer, sensitivity","emotional immaturity, insecurity, disappointment"),this.createMinorArcana("knight","cups","following the heart, idealist, romantic","moodiness, disappointment"),this.createMinorArcana("queen","cups","compassion, calm, comfort","martyrdom, insecurity, dependence"),this.createMinorArcana("king","cups","compassion, control, balance","coldness, moodiness, bad advice"),this.createMinorArcana("ace","pentacles","opportunity, prosperity, new venture","lost opportunity, missed chance, bad investment"),this.createMinorArcana(2,"pentacles","balancing decisions, priorities, adapting to change","loss of balance, disorganized, overwhelmed"),this.createMinorArcana(3,"pentacles","teamwork, collaboration, building","lack of teamwork, disorganized, group conflict"),this.createMinorArcana(4,"pentacles","conservation, frugality, security","greediness, stinginess, possessiveness"),this.createMinorArcana(5,"pentacles","need, poverty, insecurity","recovery, charity, improvement"),this.createMinorArcana(6,"pentacles","charity, generosity, sharing","strings attached, stinginess, power and domination"),this.createMinorArcana(7,"pentacles","hard work, perseverance, diligence","work without results, distractions, lack of rewards"),this.createMinorArcana(8,"pentacles","apprenticeship, passion, high standards","lack of passion, uninspired, no motivation"),this.createMinorArcana(9,"pentacles","fruits of labor, rewards, luxury","reckless spending, living beyond means, false success"),this.createMinorArcana(10,"pentacles","legacy, culmination, inheritance","fleeting success, lack of stability, lack of resources"),this.createMinorArcana("page","pentacles","ambition, desire, diligence","lack of commitment, greediness, laziness"),this.createMinorArcana("knight","pentacles","efficiency, hard work, responsibility","laziness, obsessiveness, work without reward"),this.createMinorArcana("queen","pentacles","practicality, creature comforts, financial security","self-centeredness, jealousy, smothering"),this.createMinorArcana("king","pentacles","abundance, prosperity, security","greed, indulgence, sensuality")]}},{key:"createMinorArcana",value:function(e,t,a,n){return{id:k.guid(),value:e,suit:t,name:e+" of "+t,meanings:{upright:a,reversed:n}}}},{key:"createMajorArcana",value:function(e,t,a,n){return{id:k.guid(),value:e,suit:null,name:t,meanings:{upright:a,reversed:n}}}},{key:"getStandardDeck",value:function(){var t=[];return["hearts","diamonds","spades","clubs"].forEach((function(a){["ace",2,3,4,5,6,7,8,9,10,"jack","queen","king"].forEach((function(n){t.push(e.createCard(n,a))}))})),t}},{key:"getStandardDeckWithJokers",value:function(){var t=e.getStandardDeck();return t.push(e.createJoker()),t.push(e.createJoker()),t}},{key:"createCard",value:function(e,t){return{id:k.guid(),value:e,suit:t,name:e+" of "+t,meanings:null}}},{key:"createJoker",value:function(){return{id:k.guid(),value:"",suit:null,name:"joker",meanings:null}}},{key:"getDeckOfManyThings",value:function(){return[e.createManyThingsCard("vizier"),e.createManyThingsCard("sun"),e.createManyThingsCard("moon"),e.createManyThingsCard("star"),e.createManyThingsCard("comet"),e.createManyThingsCard("the fates"),e.createManyThingsCard("throne"),e.createManyThingsCard("key"),e.createManyThingsCard("knight"),e.createManyThingsCard("gem"),e.createManyThingsCard("talons"),e.createManyThingsCard("the void"),e.createManyThingsCard("flames"),e.createManyThingsCard("skull"),e.createManyThingsCard("idiot"),e.createManyThingsCard("donjon"),e.createManyThingsCard("ruin"),e.createManyThingsCard("euryale"),e.createManyThingsCard("rogue"),e.createManyThingsCard("balance"),e.createManyThingsCard("fool"),e.createManyThingsCard("jester")]}},{key:"getDeckOfManyThingsSmall",value:function(){return[e.createManyThingsCard("sun"),e.createManyThingsCard("moon"),e.createManyThingsCard("star"),e.createManyThingsCard("throne"),e.createManyThingsCard("key"),e.createManyThingsCard("knight"),e.createManyThingsCard("the void"),e.createManyThingsCard("flames"),e.createManyThingsCard("skull"),e.createManyThingsCard("ruin"),e.createManyThingsCard("euryale"),e.createManyThingsCard("rogue"),e.createManyThingsCard("jester")]}},{key:"createManyThingsCard",value:function(e){return{id:k.guid(),value:"",suit:null,name:e,meanings:null}}}]),e}(),Ma=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getDieTypeBox",value:function(e){var t=this,a=this.props.dice[e];return r.a.createElement("div",{className:a>0?"die-type":"die-type none",onClick:function(a){return t.dieTypeClicked(a,e,!a.ctrlKey)},onContextMenu:function(a){return t.dieTypeClicked(a,e,!1)},role:"button"},r.a.createElement("div",{className:"die-type-name"},"d",100===e?"%":e),r.a.createElement("div",{className:"die-type-value"},a))}},{key:"getConstantBox",value:function(){var e=this,t=this.props.constant;return r.a.createElement("div",{className:t>0?"die-type":"die-type none",onClick:function(t){return e.dieTypeClicked(t,0,!t.ctrlKey)},onContextMenu:function(t){return e.dieTypeClicked(t,0,!1)},role:"button"},r.a.createElement("div",{className:"die-type-name"},"+/-"),r.a.createElement("div",{className:"die-type-value"},t))}},{key:"dieTypeClicked",value:function(e,t,a){if(e.preventDefault(),0===t){var n=this.props.constant+(a?1:-1);this.props.setConstant(n)}else{var r=Math.max(this.props.dice[t]+(a?1:-1),0);this.props.setDie(t,r)}}},{key:"render",value:function(){var e=this,t=this.props.dice[4]+this.props.dice[6]+this.props.dice[8]+this.props.dice[10]+this.props.dice[12]+this.props.dice[20]+this.props.dice[100],a="";[100,20,12,10,8,6,4].forEach((function(t){0!==e.props.dice[t]&&(a&&(a+=" + "),a+=e.props.dice[t]+"d"+t)})),0!==this.props.constant&&(a&&(this.props.constant>0?a+=" + ":a+=" - "),a+=Math.abs(this.props.constant));var n=null;return n=1===t&&1===this.props.dice[20]?r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.rollDice("")}},"roll ",a)),r.a.createElement(v.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.rollDice("advantage")}},"advantage")),r.a.createElement(v.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.rollDice("disadvantage")}},"disadvantage"))):r.a.createElement("div",null,r.a.createElement("button",{className:t>0?"":"disabled",onClick:function(){return e.props.rollDice("")}},"roll ",a)),r.a.createElement("div",{className:"die-roll-panel"},r.a.createElement("div",{className:"die-types"},this.getDieTypeBox(4),this.getDieTypeBox(6),this.getDieTypeBox(8),this.getDieTypeBox(10),this.getDieTypeBox(12),this.getDieTypeBox(20),this.getDieTypeBox(100),this.getConstantBox()),r.a.createElement("hr",null),r.a.createElement(f.a,{gutter:10,align:"middle"},r.a.createElement(v.a,{span:22},n),r.a.createElement(v.a,{span:2,className:"section centered"},r.a.createElement(p.a,{className:t>0?"die-reset-button":"die-reset-button disabled",title:"reset dice",onClick:function(){return e.props.resetDice()}}))))}}]),a}(r.a.Component),Oa=a(284),Da=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=[],t=0;if(this.props.result.rolls.forEach((function(a){var n="";20===a.sides&&(1===a.value&&(n="nat1"),20===a.value&&(n="nat20")),e.push(r.a.createElement($.a,{key:a.id,className:n},"d",a.sides,": ",r.a.createElement("b",null,a.value))),t+=a.value})),0!==this.props.result.constant){var a=this.props.result.constant>0?"+":"-";e.push(r.a.createElement($.a,{key:"constant"},a," ",r.a.createElement("b",null,Math.abs(this.props.result.constant)))),t+=this.props.result.constant}var n=""===this.props.result.mode?null:r.a.createElement(Oa.a,{className:"roll-icon "+this.props.result.mode,title:this.props.result.mode});return r.a.createElement("div",{className:"die-roll-result group-panel"},r.a.createElement("div",{className:"rolls"},e,n),r.a.createElement("div",{className:"sum"},t))}}]),a}(r.a.Component),ja=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={flipped:!1},n}return Object(c.a)(a,[{key:"flip",value:function(){this.setState({flipped:!this.state.flipped})}},{key:"render",value:function(){var e=this;try{var t="",a="";return this.props.card.meanings&&(t=this.props.reversed?this.props.card.meanings.reversed:this.props.card.meanings.upright,a=this.props.reversed?"(reversed)":""),r.a.createElement("div",{className:this.state.flipped?"oracle-card flipped":"oracle-card",onClick:function(){return e.flip()},role:"button"},r.a.createElement("div",{className:"oracle-card-inner"},r.a.createElement("div",{className:"oracle-card-front"},"?"),r.a.createElement("div",{className:"oracle-card-back"},r.a.createElement("div",{className:"oracle-card-name"},r.a.createElement("div",null,this.props.card.name)),r.a.createElement("div",{className:"oracle-card-meaning scrollable"},r.a.createElement("div",null,t)),r.a.createElement("div",{className:"oracle-card-footer"},r.a.createElement("div",null,a),r.a.createElement("div",null,r.a.createElement("b",null,"number"===typeof this.props.card.value?this.props.card.value:""))))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ta=new Ne.a.Converter;Ta.setOption("tables",!0);var Pa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{if(this.props.people.length<2)return r.a.createElement(Pe,{key:"empty"},r.a.createElement("p",null,"no-one else is currently connected"));var t=this.props.people.map((function(t){var a=null;return"dm"===e.props.user&&t.id!==W.getID()&&(a=r.a.createElement(p.a,{title:"kick",onClick:function(){return e.props.kick(t.id)}})),r.a.createElement("div",{key:t.id,className:"group-panel person"},r.a.createElement("div",{className:"person-details"},r.a.createElement(za,{person:t}),r.a.createElement("div",{className:"status"},t.status)),r.a.createElement("div",{className:"person-icon"},a))}));return r.a.createElement("div",{className:"connections-panel"},t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Va=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={status:"",characterID:W.getCharacterID(W.getID())},n}return Object(c.a)(a,[{key:"setStatus",value:function(e){this.setState({status:e})}},{key:"setPC",value:function(e){var t=this;this.setState({characterID:e},(function(){t.sendPlayerUpdate()}))}},{key:"sendPlayerUpdate",value:function(){_.sendUpdate(this.state.status,this.state.characterID)}},{key:"render",value:function(){var e=this,t=null;return W.data.party&&(t=""===this.state.characterID?r.a.createElement(ce,{options:W.data.party.pcs.map((function(e){var t=W.data.people.some((function(t){return t.characterID===e.id}));return{id:e.id,text:e.name,disabled:t}})),placeholder:"select your character...",onSelect:function(t){return e.setPC(t)}}):r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.editPC(e.state.characterID)}},"update character stats"))),r.a.createElement("div",{className:"player-status-panel"},r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(ie,{placeholder:"update your status",debounce:!1,text:this.state.status,onChange:function(t){return e.setStatus(t)},onPressEnter:function(){return e.sendPlayerUpdate()}}),r.a.createElement("div",{className:"icons"},r.a.createElement(Na.a,{onClick:function(){return e.sendPlayerUpdate()},title:"update status"}))),t,r.a.createElement(rt,{text:"disconnect",onConfirm:function(){return _.disconnect()}}))}}]),a}(r.a.Component),Aa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).bottom=r.a.createRef(),e.scrollToBottom=function(){e.bottom&&e.bottom.current&&e.bottom.current.scrollIntoView({behavior:"smooth"})},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"showMessage",value:function(e){var t=W.getID();return e.from===t||0===e.to.length||e.to.includes(t)}},{key:"render",value:function(){var e=this;try{var t=this.props.messages.filter((function(t){return e.showMessage(t)})).map((function(t){return r.a.createElement(Ra,{key:t.id,user:e.props.user,message:t,openImage:function(t){return e.props.openImage(t)}})}));return 0===t.length&&t.push(r.a.createElement(Pe,{key:"empty"},r.a.createElement("p",null,"no messages yet"))),r.a.createElement("div",{className:"messages-panel"},t,r.a.createElement("div",{ref:this.bottom}))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ra=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=W.getCurrentName(this.props.message.from),a="message",n="message-byline",s=null;this.props.message.from===W.getID()?a+=" from-me":a+=" to-me";var o=null;switch(this.props.message.type){case"text":var i=this.props.message.data.text,c=this.props.message.data.language,l=this.props.message.data.untranslated;if("player"===this.props.user&&""!==c){var u=!1;if(W.data.party){var d=W.getCharacterID(W.getID()),m=W.data.party.pcs.find((function(e){return e.id===d}));m&&(u=-1!==m.languages.toLowerCase().indexOf(c.toLowerCase()))}u||(o=r.a.createElement("div",{className:"text"},r.a.createElement("div",{className:"text untranslated"},l),r.a.createElement("div",{className:"language"},"in an unknown language")))}o||(o=i.startsWith("/")?r.a.createElement("div",{className:"emote"},W.getName(this.props.message.from)+" "+i.substr(1)):r.a.createElement("div",{className:"text"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Ta.makeHtml(i)}}),""!==c?r.a.createElement("div",{className:"language"},"in ",c):null));break;case"link":var p=this.props.message.data.url;o=r.a.createElement("a",{className:"link",href:p,target:"_blank",rel:"noopener noreferrer"},p);break;case"image":var h=this.props.message.data.image;o=r.a.createElement("img",{className:"selectable-image",src:h,alt:"shared",onClick:function(){return e.props.openImage(h)}});break;case"roll":var g=this.props.message.data.roll;o=r.a.createElement(Da,{result:g});break;case"card":var y=this.props.message.data.card;o=r.a.createElement(f.a,{justify:"space-around"},r.a.createElement(v.a,{span:10},r.a.createElement(ja,{card:y.card,reversed:y.reversed})))}return 0!==this.props.message.to.length&&(t+=" to "+this.props.message.to.map((function(e){return W.getCurrentName(e)})).join(", "),n+=" private",s=r.a.createElement(Ca.a,{title:"private message"})),r.a.createElement("div",{className:a},r.a.createElement("div",{className:n},t,s),r.a.createElement("div",{className:"message-content"},o))}catch(b){return console.error(b),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),La=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(i.a)(this,a),n=t.call(this,e);var r={};return[4,6,8,10,12,20,100].forEach((function(e){return r[e]=0})),r[20]=1,n.state={type:"text",message:"",language:"",multiline:!1,url:"",image:"",dice:r,constant:0,deck:"tarot deck",mode:"public",recipients:[]},n}return Object(c.a)(a,[{key:"setType",value:function(e){this.setState({type:e})}},{key:"setMessage",value:function(e){this.setState({message:e})}},{key:"setLanguage",value:function(e){this.setState({language:e})}},{key:"toggleMultiline",value:function(){this.setState({multiline:!this.state.multiline})}},{key:"setURL",value:function(e){this.setState({url:e})}},{key:"setImage",value:function(e){this.setState({image:e})}},{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(e){if(e.target){var a=e.target.result;t.setImage(a)}},a.readAsDataURL(e),!1}},{key:"setDie",value:function(e,t){var a=this.state.dice;a[e]=t,this.setState({dice:a})}},{key:"setConstant",value:function(e){this.setState({constant:e})}},{key:"setDeck",value:function(e){this.setState({deck:e})}},{key:"resetDice",value:function(){var e=this.state.dice;[4,6,8,10,12,20,100].forEach((function(t){return e[t]=0})),this.setState({dice:e,constant:0})}},{key:"setMode",value:function(e){this.setState({mode:e,recipients:"public"===e?[]:this.state.recipients})}},{key:"addRecipient",value:function(e){var t=this.state.recipients;t.push(e),this.setState({recipients:t})}},{key:"removeRecipient",value:function(e){var t=this.state.recipients,a=t.indexOf(e);t.splice(a,1),this.setState({recipients:t})}},{key:"canSend",value:function(){var e=!1;switch(this.state.mode){case"public":e=!0;break;case"private":e=this.state.recipients.length>0}var t=!1;switch(this.state.type){case"text":t=""!==this.state.message;break;case"link":t=""!==this.state.url;break;case"image":t=""!==this.state.image;break;case"roll":case"card":t=!0}return e&&t}},{key:"sendMessage",value:function(){var e=Object(ia.a)(oa.a.mark((function e(){var t,a,n,r,s=this;return oa.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.canSend()&&(t=Object(N.a)(this.state.recipients),a=this.state.message.split("\n").join("\n\n"),n=this.state.language,r=""===n?"":T.generateTranslation(a),this.setState({message:""},(function(){s.props.sendMessage(t,a,n,r)})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendLink",value:function(){var e=this;if(this.canSend()){var t=Object(N.a)(this.state.recipients),a=this.state.url;this.setState({url:""},(function(){e.props.sendLink(t,a)}))}}},{key:"sendImage",value:function(){var e=this;if(this.canSend()){var t=Object(N.a)(this.state.recipients),a=this.state.image;this.setState({image:""},(function(){e.props.sendImage(t,a)}))}}},{key:"sendRoll",value:function(e){if(this.canSend()){var t=Object(N.a)(this.state.recipients),a=C.rollDice(this.state.dice,this.state.constant,e);this.props.sendRoll(t,a)}}},{key:"sendCard",value:function(){if(this.canSend()){var e=Object(N.a)(this.state.recipients),t=[];switch(this.state.deck){case"tarot deck":t=Ia.getTarotDeck();break;case"tarot deck (major arcana)":t=Ia.getTarotMajorArcana();break;case"tarot deck (minor arcana)":t=Ia.getTarotMinorArcana();break;case"standard deck":t=Ia.getStandardDeck();break;case"standard deck (with jokers)":t=Ia.getStandardDeckWithJokers();break;case"deck of many things":t=Ia.getDeckOfManyThings();break;case"deck of many things (13 cards)":t=Ia.getDeckOfManyThingsSmall()}var a=t[k.randomNumber(t.length)],n={id:k.guid(),card:a,reversed:k.randomBoolean()};this.props.sendCard(e,n)}}},{key:"getMessageSection",value:function(){var e=this;switch(this.state.type){case"text":var t=null;if(W.data.party){var a=[];if("dm"===this.props.user)(a=T.getSpokenLanguages(W.data.party.pcs)).push("(some other language)");else{var n=W.getCharacterID(W.getID()),s=W.data.party.pcs.find((function(e){return e.id===n}));s&&(a=T.getSpokenLanguages([s]))}t=r.a.createElement(ce,{placeholder:"(no language specified)",options:a.map((function(e){return{id:e,text:e}})),selectedID:this.state.language,onSelect:function(t){return e.setLanguage(t)},onClear:function(){return e.setLanguage("")}})}return r.a.createElement("div",null,r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(ie,{placeholder:"send a message",multiLine:this.state.multiline,debounce:!1,text:this.state.message,onChange:function(t){return e.setMessage(t)},onPressEnter:function(){return e.sendMessage()}}),r.a.createElement("div",{className:"icons"},r.a.createElement(Sa.a,{onClick:function(){return e.toggleMultiline()},title:"expand",className:this.state.multiline?"active":""}),r.a.createElement(Na.a,{onClick:function(){return e.sendMessage()},title:"send message",className:this.canSend()?"":"disabled"}))),t);case"link":return r.a.createElement("div",{className:"control-with-icons"},r.a.createElement(ie,{placeholder:"send a link",debounce:!1,text:this.state.url,onChange:function(t){return e.setURL(t)},onPressEnter:function(){return e.sendLink()}}),r.a.createElement("div",{className:"icons"},r.a.createElement(Na.a,{onClick:function(){return e.sendLink()},title:"send link",className:this.canSend()?"":"disabled"})));case"image":return""!==this.state.image?r.a.createElement("div",null,r.a.createElement("img",{className:"nonselectable-image",src:this.state.image,alt:"shared"}),r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.setImage("")}},"clear")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{className:this.canSend()?"":"disabled",onClick:function(){return e.sendImage()}},"send")))):r.a.createElement("div",null,r.a.createElement(te.a.Dragger,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it")));case"roll":return r.a.createElement(Ma,{dice:this.state.dice,constant:this.state.constant,setDie:function(t,a){return e.setDie(t,a)},setConstant:function(t){return e.setConstant(t)},resetDice:function(){return e.resetDice()},rollDice:function(t){return e.sendRoll(t)}});case"card":return r.a.createElement("div",null,r.a.createElement(ce,{options:["tarot deck","tarot deck (major arcana)","tarot deck (minor arcana)","standard deck","standard deck (with jokers)","deck of many things","deck of many things (13 cards)"].map((function(e){return{id:e,text:e}})),selectedID:this.state.deck,onSelect:function(t){return e.setDeck(t)}}),r.a.createElement("button",{onClick:function(){return e.sendCard()}},"draw a card"));case"settings":return this.getSettingsSection()}return null}},{key:"getSettingsSection",value:function(){var e=this,t=null;if("private"===this.state.mode){var a=W.data.people.filter((function(e){return e.id!==W.getID()})).map((function(t){return r.a.createElement(re,{key:t.id,label:W.getCurrentName(t.id),checked:e.state.recipients.includes(t.id),display:"switch",onChecked:function(a){return a?e.addRecipient(t.id):e.removeRecipient(t.id)}})})),n=null;0===this.state.recipients.length&&(n=r.a.createElement(Pe,null,r.a.createElement("p",null,"for a private message, you must select at least one person"))),t=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"choose who to send your message to"),a,n)}return r.a.createElement("div",null,r.a.createElement(Y,{options:["public","private"].map((function(e){return{id:e,text:e}})),selectedID:this.state.mode,onSelect:function(t){return e.setMode(t)}}),t)}},{key:"render",value:function(){var e=this;try{if(W.data.people.length<2)return null;var t=null;return t="public"===this.state.mode?r.a.createElement(xa.a,{title:"message is public",onClick:function(){return e.setType("settings")}}):r.a.createElement(Ca.a,{title:"message is private",onClick:function(){return e.setType("settings")}}),r.a.createElement("div",{className:"send-message-panel"},r.a.createElement("div",{className:"message-controls"},r.a.createElement(Y,{options:["text","link","image","roll","card"].map((function(e){return{id:e,text:e}})),selectedID:this.state.type,onSelect:function(t){return e.setType(t)}}),t),this.getMessageSection())}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),za=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){if(!this.props.person)return null;if(null!==W.data.party){var e=this.props.person.characterID,t=W.data.party.pcs.find((function(t){return t.id===e}));if(t)return r.a.createElement("div",{className:"character-panel"},r.a.createElement(ae,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},t.name))}return r.a.createElement("div",{className:"character-panel"},r.a.createElement("div",{className:"name"},this.props.person.name))}}]),a}(r.a.Component),qa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getContent",value:function(){var e=this;return"connected"===_.getState()?r.a.createElement(Aa,{user:"player",messages:W.data.messages,openImage:function(t){return e.props.openImage(t)}}):null}},{key:"getFooter",value:function(){return"connected"===_.getState()?r.a.createElement("div",{className:"sidebar-footer"},r.a.createElement(La,{user:"player",sendMessage:function(e,t,a,n){return _.sendMessage(e,t,a,n)},sendLink:function(e,t){return _.sendLink(e,t)},sendImage:function(e,t){return _.sendImage(e,t)},sendRoll:function(e,t){return _.sendRoll(e,t)},sendCard:function(e,t){return _.sendCard(e,t)}})):null}},{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"chat")),r.a.createElement("div",{className:"sidebar-content"},this.getContent()),this.getFooter())}}]),a}(r.a.Component),Fa=a(279),Ga=a(278),Ba=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=[];return this.props.combatants.forEach((function(a){a.conditions.forEach((function(n){t.push(r.a.createElement(Ua,{key:n.id,condition:n,combatant:a,combatants:e.props.allCombatants,showCombatantName:e.props.combatants.length>1,nudgeConditionValue:function(t,a,n){return e.props.nudgeConditionValue(t,a,n)},editCondition:function(t){return e.props.editCondition(a,t)},deleteCondition:function(t){return e.props.deleteCondition(a,t)}}))}))})),r.a.createElement("div",{className:"section"},t,r.a.createElement("button",{onClick:function(){return e.props.addCondition()}},"add a condition"))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ua=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.condition.name||"condition";"custom"===t&&(t=this.props.condition.text||"custom condition"),"exhaustion"===this.props.condition.name&&(t+=" ("+this.props.condition.level+")"),this.props.showCombatantName&&(t=this.props.combatant.displayName+": "+t);var a=null;null!==this.props.condition.duration&&(a=r.a.createElement("div",{className:"section"},r.a.createElement("i",null,C.conditionDurationText(this.props.condition,this.props.combatants))));var n=[];if("exhaustion"===this.props.condition.name&&n.push(r.a.createElement("div",{key:"level",className:"section"},r.a.createElement(fe,{value:this.props.condition.level,label:"level",downEnabled:this.props.condition.level>1,upEnabled:this.props.condition.level<6,onNudgeValue:function(t){return e.props.nudgeConditionValue(e.props.condition,"level",t)}}))),"custom"!==this.props.condition.name)for(var s=C.conditionText(this.props.condition),o=0;o!==s.length;++o)n.push(r.a.createElement("div",{key:o,className:"section"},s[o]));return r.a.createElement("div",{className:"group-panel condition-panel"},r.a.createElement("div",{className:"condition-heading"},r.a.createElement("div",{className:"condition-name"},t),r.a.createElement("div",{className:"condition-buttons"},r.a.createElement(Fa.a,{title:"edit",onClick:function(){return e.props.editCondition(e.props.condition)}}),r.a.createElement(Ga.a,{title:"remove",onClick:function(){return e.props.deleteCondition(e.props.condition)}}))),a,n)}catch(i){return console.error(i),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Ha=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:e.defaultTab,healingValue:0,damageValue:0,damageMultipliers:{}},n}return Object(c.a)(a,[{key:"nudgeHealing",value:function(e){this.setState({healingValue:Math.max(this.state.healingValue+e,0)})}},{key:"nudgeDamage",value:function(e){this.setState({damageValue:Math.max(this.state.damageValue+e,0)})}},{key:"setView",value:function(e){this.setState({view:e})}},{key:"setDamageMultiplier",value:function(e,t){var a=this.state.damageMultipliers;a[e]=t,this.setState({damageMultipliers:a})}},{key:"heal",value:function(){var e=this;if(null!==this.props.changeHP){var t=this.state.healingValue;this.setState({healingValue:0},(function(){var a=[];e.props.combatants.forEach((function(e){var n,r,s,o=null!==(n=e.hpMax)&&void 0!==n?n:0,i=(null!==(r=e.hpCurrent)&&void 0!==r?r:0)+t;i=Math.min(i,o),a.push({id:e.id,hp:i,temp:null!==(s=e.hpTemp)&&void 0!==s?s:0,damage:0})})),e.props.changeHP(a)}))}}},{key:"damage",value:function(){var e=this;if(null!==this.props.changeHP){var t=this.state.damageValue;this.setState({damageValue:0},(function(){var a=[];e.props.combatants.forEach((function(n){var r,s,o,i=null!==(r=e.state.damageMultipliers[n.id])&&void 0!==r?r:1,c=null!==(s=n.hpCurrent)&&void 0!==s?s:0,l=null!==(o=n.hpTemp)&&void 0!==o?o:0,u=Math.floor(t*i),d=u,m=Math.min(d,l);l-=m,c-=d-=m,c=Math.max(c,0),a.push({id:n.id,hp:c,temp:l,damage:u})})),e.props.changeHP(a)}))}}},{key:"getMainSection",value:function(){var e=this,t=[],a=[];if(this.props.combatants.every((function(e){return e.active}))){if(this.props.makeCurrent&&this.props.makeDefeated)if(this.props.combatants.every((function(e){return e.current})))t.push(r.a.createElement("button",{key:"makeDefeated",onClick:function(){return e.props.makeDefeated(e.props.combatants)}},"mark as defeated and end turn"));else{if(1===this.props.combatants.length)!!this.props.allCombatants.find((function(t){return t.mountID===e.props.combatants[0].id}))||t.push(r.a.createElement("button",{key:"makeCurrent",onClick:function(){return e.props.makeCurrent(e.props.combatants[0])}},"start turn"));t.push(r.a.createElement("button",{key:"makeDefeated",onClick:function(){return e.props.makeDefeated(e.props.combatants)}},"mark as defeated"))}if(this.props.combatants.every((function(e){return"pc"!==e.type})))this.props.allCombatants.filter((function(e){return"pc"===e.type})).forEach((function(t){var n="engaged:"+t.displayName;a.push(r.a.createElement($.a.CheckableTag,{key:t.id,checked:e.props.combatants.every((function(e){return e.tags.includes(n)})),onChange:function(){return e.props.toggleTag(e.props.combatants,n)}},t.displayName))}))}this.props.makeActive&&this.props.combatants.every((function(e){return e.defeated}))&&t.push(r.a.createElement("button",{key:"makeActive",onClick:function(){return e.props.makeActive(e.props.combatants)}},"mark as active"));var n=null;t.length>0&&(n=r.a.createElement("div",null,t,r.a.createElement("hr",null)));var s=null;return a.length>0&&(s=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"engaged with: "),a)),r.a.createElement("div",null,n,r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"quick tags: "),r.a.createElement($.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("conc")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"conc")}},"concentrating"),r.a.createElement($.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("bane")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"bane")}},"bane"),r.a.createElement($.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.tags.includes("bless")})),onChange:function(){return e.props.toggleTag(e.props.combatants,"bless")}},"bless"),r.a.createElement($.a.CheckableTag,{checked:!this.props.combatants.every((function(e){return e.showOnMap})),onChange:function(){return e.props.toggleHidden(e.props.combatants)}},"hidden")),r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"quick conditions: "),r.a.createElement($.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.conditions.some((function(e){return"prone"===e.name}))})),onChange:function(){return e.props.toggleCondition(e.props.combatants,"prone")}},"prone"),r.a.createElement($.a.CheckableTag,{checked:this.props.combatants.every((function(e){return e.conditions.some((function(e){return"unconscious"===e.name}))})),onChange:function(){return e.props.toggleCondition(e.props.combatants,"unconscious")}},"unconscious")),s)}},{key:"getHPSection",value:function(){var e=this;if(!this.props.combatants.every((function(e){return"monster"===e.type})))return null;var t=null;if(1===this.props.combatants.length){var a,n,s,o,i,c,l=this.props.combatants[0];t=r.a.createElement(me,{text:"current hit points"},r.a.createElement(fe,{value:null!==(a=l.hpCurrent)&&void 0!==a?a:0,label:"hp",factors:[1,10],downEnabled:(null!==(n=l.hpCurrent)&&void 0!==n?n:0)>0,upEnabled:(null!==(s=l.hpCurrent)&&void 0!==s?s:0)<(null!==(o=l.hpMax)&&void 0!==o?o:0),onNudgeValue:function(t){return e.props.nudgeValue(l,"hpCurrent",t)}}),r.a.createElement(fe,{value:null!==(i=l.hpTemp)&&void 0!==i?i:0,label:"temp hp",factors:[1,10],downEnabled:(null!==(c=l.hpTemp)&&void 0!==c?c:0)>0,onNudgeValue:function(t){return e.props.nudgeValue(l,"hpTemp",t)}}))}var u=this.props.combatants.map((function(t){var a=t,n=null,s=null,o=null,i=null;return a.damage.resist&&(n=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"resistances")," ",a.damage.resist," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.damage.vulnerable&&(s=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"vulnerabilities")," ",a.damage.vulnerable," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.damage.immune&&(o=r.a.createElement("div",{className:"section"},r.a.createElement("b",null,"immunities")," ",a.damage.immune," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null)),a.tags.includes("conc")&&(i=r.a.createElement("div",{className:"section"},a.displayName," is ",r.a.createElement("b",null,"concentrating"),", and will need to make a check if they take damage")),n||s||o||i?r.a.createElement(Pe,{key:t.id},n,s,o,i):null})),d="apply damage";if(1===this.props.combatants.length){var m=this.state.damageMultipliers[this.props.combatants[0].id];.5===m&&(d="apply half damage"),2===m&&(d="apply double damage")}var p=[{id:"half",text:"half"},{id:"normal",text:"normal"},{id:"double",text:"double"}],h=this.props.combatants.map((function(t){var a,n="normal",s=null!==(a=e.state.damageMultipliers[t.id])&&void 0!==a?a:1;s<1&&(n="half"),s>1&&(n="double");var o=r.a.createElement(Y,{options:p,selectedID:n,onSelect:function(a){var n=1;"half"===a&&(n=.5),"double"===a&&(n=2),e.setDamageMultiplier(t.id,n)}});return 1===e.props.combatants.length?r.a.createElement("div",{key:t.id},o):r.a.createElement(f.a,{key:t.id,align:"middle",justify:"center"},r.a.createElement(v.a,{span:8},r.a.createElement("div",null,t.displayName)),r.a.createElement(v.a,{span:16},o))})),g=null,y=this.props.combatants.filter((function(e){return null!=e.hpCurrent&&e.hpCurrent<=0}));if(y.length>0){var b=1===y.length&&y[0].current?"mark as defeated and end turn":"mark as defeated",E=null;this.props.combatants.length>1&&(E=r.a.createElement("ul",null,y.map((function(e){return r.a.createElement("li",{key:e.id},e.displayName)})))),g=r.a.createElement("button",{onClick:function(){return e.props.makeDefeated(y)}},b,E)}return r.a.createElement("div",null,u,r.a.createElement(fe,{value:this.state.damageValue,label:"damage",factors:[1,10],downEnabled:this.state.damageValue>0,onNudgeValue:function(t){return e.nudgeDamage(t)}}),r.a.createElement("button",{className:0===this.state.damageValue?"disabled":"",onClick:function(){return e.damage()}},d),h,g,r.a.createElement("hr",null),r.a.createElement(me,{text:"healing"},r.a.createElement(fe,{value:this.state.healingValue,label:"healing",factors:[1,10],downEnabled:this.state.healingValue>0,onNudgeValue:function(t){return e.nudgeHealing(t)}}),r.a.createElement("button",{className:0===this.state.healingValue?"disabled":"",onClick:function(){return e.heal()}},"apply healing")),t)}},{key:"getConditionSection",value:function(){var e=this,t=this.props.combatants.map((function(t){if("monster"!==t.type)return null;var a=t;return a.conditionImmunities?r.a.createElement(Pe,{key:t.id},r.a.createElement("b",null,"immunities")," ",a.conditionImmunities," ",e.props.combatants.length>1?r.a.createElement("i",null," - ",t.displayName):null):null})),a=r.a.createElement(Ba,{combatants:this.props.combatants,allCombatants:this.props.allCombatants,addCondition:function(){return e.props.addCondition(e.props.combatants)},editCondition:function(t,a){return e.props.editCondition(t,a)},deleteCondition:function(t,a){return e.props.deleteCondition(t,a)},nudgeConditionValue:function(t,a,n){return e.props.nudgeValue(t,a,n)}});return r.a.createElement("div",null,t,a)}},{key:"getMapSection",value:function(){var e=this;if(!this.props.map)return null;if(this.props.combatants.every((function(t){return e.props.map&&e.props.map.items.find((function(e){return e.id===t.id}))}))){var t=null,a=null,n=null;if(1===this.props.combatants.length){var s=this.props.combatants[0];t=r.a.createElement(fe,{value:s.altitude+" ft.",label:"altitude",onNudgeValue:function(t){return e.props.onChangeAltitude(s,s.altitude+5*t)}});var o=null;if(s.aura.radius>0){o=r.a.createElement("div",null,r.a.createElement(Y,{options:[{id:"square",text:"square"},{id:"rounded",text:"rounded"},{id:"circle",text:"circle"}],selectedID:s.aura.style,onSelect:function(t){return e.props.changeValue(s.aura,"style",t)}}),r.a.createElement("input",{type:"color",value:s.aura.color,onChange:function(t){return e.props.changeValue(s.aura,"color",t.target.value)}}),r.a.createElement("button",{onClick:function(){return e.props.changeValue(s.aura,"radius",0)}},"remove aura"))}a=r.a.createElement(me,{text:"aura"},r.a.createElement(fe,{value:s.aura.radius+" ft.",label:"radius",downEnabled:s.aura.radius>0,onNudgeValue:function(t){return e.props.nudgeValue(s.aura,"radius",5*t)}}),o),n=r.a.createElement("button",{key:"mapPlace",onClick:function(){return e.props.mapAdd(s)}},"place on a different square")}return r.a.createElement("div",null,r.a.createElement($e,{onClick:function(t){return e.props.mapMove(e.props.combatants,t)}}),r.a.createElement("hr",null),t,a,n,r.a.createElement("button",{onClick:function(){return e.props.mapRemove(e.props.combatants)}},"remove from map"))}return 1===this.props.combatants.length?r.a.createElement("button",{key:"mapAdd",onClick:function(){return e.props.mapAdd(e.props.combatants[0])}},"add to map"):null}},{key:"getAdvancedSection",value:function(){var e=this,t=null;this.props.removeCombatants&&this.props.combatants.every((function(e){return!e.current}))&&(t=r.a.createElement(rt,{text:"remove from encounter",onConfirm:function(){e.props.removeCombatants&&e.props.removeCombatants(e.props.combatants)}}));var a=null,n=null,s=null,o=null,i=null,c=null;if(1===this.props.combatants.length){var l,u=this.props.combatants[0];if(a=r.a.createElement(me,{text:"change name"},r.a.createElement(ie,{text:u.displayName,onChange:function(t){return e.props.changeValue(u,"displayName",t)}})),n=r.a.createElement(me,{text:"change size"},r.a.createElement(fe,{value:u.displaySize,label:"size",downEnabled:"tiny"!==u.displaySize,upEnabled:"gargantuan"!==u.displaySize,onNudgeValue:function(t){return e.props.nudgeValue(u,"displaySize",t)}})),!u.pending)s=r.a.createElement(me,{text:"change initiative score"},r.a.createElement(fe,{value:null!==(l=u.initiative)&&void 0!==l?l:0,label:"initiative",onNudgeValue:function(t){return e.props.nudgeValue(u,"initiative",t)}}));if(o=r.a.createElement(me,{text:"change faction"},r.a.createElement(Y,{options:["foe","neutral","ally"].map((function(e){return{id:e,text:e}})),selectedID:u.faction,onSelect:function(t){return e.props.changeValue(u,"faction",t)}})),!this.props.allCombatants.find((function(e){return e.mountID===u.id}))){var d=this.props.allCombatants.filter((function(e){return e.id!==u.id})).filter((function(e){return!!e.mountID})).map((function(e){return e.mountID})),m=this.props.allCombatants.filter((function(e){return e.id!==u.id})).filter((function(e){return"placeholder"!==e.type})).filter((function(e){return!e.mountID})).filter((function(e){return!d.includes(e.id)})).map((function(e){return{id:e.id,text:e.displayName}}));k.sort(m,[{field:"text",dir:"asc"}]);var p=null;p=m.length>0?r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mounted on:"),r.a.createElement(ce,{options:m,selectedID:u.mountID,onSelect:function(t){return e.props.changeValue(u,"mountID",t)},onClear:function(){return e.props.changeValue(u,"mountID",null)}})):r.a.createElement(Pe,null,"no mounts available");var h=null;if(u.mountID){var f=["controlled","independent"].map((function(e){return{id:e,text:e}}));h=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"mount is:"),r.a.createElement(Y,{options:f,selectedID:u.mountType,onSelect:function(t){return e.props.changeValue(u,"mountType",t)}}))}i=r.a.createElement(me,{text:"mounted combat"},p,h)}c=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(ie,{text:u.note,placeholder:"notes",multiLine:!0,onChange:function(t){return e.props.changeValue(u,"note",t)}}))}var v=[];return this.props.combatants.filter((function(e){return"pc"===e.type})).forEach((function(t){t.companions.filter((function(t){return!e.props.allCombatants.find((function(e){return e.id===t.id}))})).forEach((function(t){v.push(r.a.createElement("button",{key:t.id,onClick:function(){return e.props.addCompanion(t)}},"add ",t.name))}))})),r.a.createElement("div",null,t,a,n,s,o,i,v,c)}},{key:"render",value:function(){var e=this;try{var t=["main","hp","cond","map","adv"],a=this.props.allCombatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""}));if(this.props.map&&!this.props.combatants.some((function(e){return a.includes(e.id)}))||t.splice(3,1),this.props.combatants.every((function(e){return"monster"===e.type}))||t.splice(1,1),!this.props.showTabs)return r.a.createElement("div",null,t.includes("main")?this.getMainSection():null,t.includes("hp")?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"hit points"),this.getHPSection()):null,t.includes("cond")?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"conditions"),this.getConditionSection()):null,t.includes("map")?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"map"),this.getMapSection()):null,t.includes("adv")?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement(me,{text:"advanced controls"},this.getAdvancedSection())):null);var n=this.state.view;t.includes(n)||(n=t[0]);var s=null;switch(n){case"main":s=this.getMainSection();break;case"hp":s=this.getHPSection();break;case"cond":s=this.getConditionSection();break;case"map":s=this.getMapSection();break;case"adv":s=this.getAdvancedSection()}return r.a.createElement("div",null,r.a.createElement(bt,{options:t.map((function(e){return{id:e,text:e}})),selectedID:n,onSelect:function(t){return e.setView(t)}}),s)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);Ha.defaultProps={showTabs:!0,defaultTab:"main",makeCurrent:null,makeActive:null,makeDefeated:null,changeHP:null,removeCombatants:null};var Wa=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getContent",value:function(){var e=this;if("connected"===_.getState()){var t=[],a=null;if("combat"===W.data.shared.type){var n=W.data.shared.data;t=n.combatants,a=n.map}if("exploration"===W.data.shared.type){var s=W.data.shared.data;t=s.combatants,a=s.map}var o=W.getCharacterID(W.getID()),i=t.find((function(e){return e.id===o}));return i?r.a.createElement(Ha,{combatants:[i],allCombatants:t,map:a,showTabs:!1,toggleTag:function(t,a){t.forEach((function(e){e.tags.includes(a)?e.tags=e.tags.filter((function(e){return e!==a})):e.tags.push(a)})),_.sendSharedUpdate(),e.props.onUpdated()},toggleCondition:function(t,a){t.forEach((function(e){if(e.conditions.some((function(e){return e.name===a})))e.conditions=e.conditions.filter((function(e){return e.name!==a}));else{var t=w.createCondition();t.name=a,e.conditions.push(t),e.conditions=k.sort(e.conditions,[{field:"name",dir:"asc"}])}})),_.sendSharedUpdate(),e.props.onUpdated()},toggleHidden:function(t){t.forEach((function(e){return e.showOnMap=!e.showOnMap})),_.sendSharedUpdate(),e.props.onUpdated()},addCondition:function(a){return e.props.addCondition(a,t)},editCondition:function(a,n){return e.props.editCondition(a,n,t)},deleteCondition:function(t,a){t.conditions=t.conditions.filter((function(e){return e.name!==a.name})),_.sendSharedUpdate(),e.props.onUpdated()},mapAdd:function(t){return e.props.toggleAddingToMap()},mapMove:function(n,r){var s=n.map((function(e){return e.id})),o=z.getMountsAndRiders(s,t).map((function(e){return e.id}));s.forEach((function(e){o.includes(e)||o.push(e)})),o.forEach((function(e){return R.move(a,e,r)})),z.setMountPositions(t,a),_.sendSharedUpdate(),e.props.onUpdated()},mapRemove:function(n){var r=n.map((function(e){return e.id})),s=z.getMountsAndRiders(r,t).map((function(e){return e.id}));r.forEach((function(e){s.includes(e)||s.push(e)})),s.forEach((function(e){return R.remove(a,e)})),_.sendSharedUpdate(),e.props.onUpdated()},onChangeAltitude:function(a,n){z.getMountsAndRiders([a.id],t).forEach((function(e){return e.altitude=n})),_.sendSharedUpdate(),e.props.onUpdated()},addCompanion:function(a){t.push(z.convertCompanionToCombatant(a)),k.sort(t,[{field:"displayName",dir:"asc"}]),_.sendSharedUpdate(),e.props.onUpdated()},changeValue:function(t,a,n){t[a]=n,_.sendSharedUpdate(),e.props.onUpdated()},nudgeValue:function(t,a,n){var r=null;switch(a){case"displaySize":r=C.nudgeSize(t.displaySize,n);break;default:r=t[a]+n}if(t[a]=r,"combat"===W.data.shared.type){var s=W.data.shared.data;z.sortCombatants(s)}_.sendSharedUpdate(),e.props.onUpdated()}}):r.a.createElement(Pe,null,r.a.createElement("p",null,"when you choose your character, you will be able to control it here"))}return null}},{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"controls")),r.a.createElement("div",{className:"sidebar-content"},this.getContent()))}}]),a}(r.a.Component),Ja=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getContent",value:function(){var e=this;return"connected"===_.getState()?r.a.createElement("div",null,r.a.createElement(Va,{editPC:function(t){return e.props.editPC(t)}}),r.a.createElement("hr",null),r.a.createElement(Pa,{user:"player",people:W.data.people,kick:function(e){return null}})):null}},{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"session")),r.a.createElement("div",{className:"sidebar-content"},this.getContent()))}}]),a}(r.a.Component),_a=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getContent",value:function(){switch(J.getState()){case"not started":return this.getNotStartedContent();case"starting":return this.getStartingContent();case"started":return this.getStartedContent()}}},{key:"getNotStartedContent",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("p",null,"select a party, then click the 'start' button to allow your players to connect to the game session"),r.a.createElement("p",null,"you can then send messages and share content such as handouts, combat encounters, and map explorations")),r.a.createElement(ce,{placeholder:"select a party...",options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),selectedID:W.getPartyID(),onSelect:function(t){var a=e.props.parties.find((function(e){return e.id===t}));J.setParty(null!==a&&void 0!==a?a:null)}}),r.a.createElement("button",{className:""===W.getPartyID()?"disabled":"",onClick:function(){return J.init()}},"start the session"))}},{key:"getStartingContent",value:function(){return r.a.createElement(Pe,null,r.a.createElement("p",null,"starting session..."))}},{key:"getStartedContent",value:function(){var e=this,t=window.location+(window.location.toString().endsWith("/")?"":"/")+"player";switch(this.props.view){case"messages":return r.a.createElement(Aa,{user:"dm",messages:W.data.messages,openImage:function(t){return e.props.openImage(t)}});case"people":return r.a.createElement(Pa,{user:"dm",people:W.data.people,kick:function(t){J.kick(t),e.forceUpdate()}});case"management":var a=null;switch(W.data.shared.type){case"nothing":a="(nothing)";break;case"combat":a="encounter ("+W.data.shared.data.encounter.name+")";break;case"exploration":a="map ("+W.data.shared.data.map.name+")";break;case"handout":a="handout ("+W.data.shared.data.title+")";break;case"monster":a="monster ("+W.data.shared.data.name+")"}var n=null;return"nothing"!==W.data.shared.type&&(n=r.a.createElement(rt,{text:"stop sharing",onConfirm:function(){return J.shareNothing()}})),r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("p",null,"give your dm code to your players, and ask them to open the player app in their browser")),r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},r.a.createElement("p",{className:"smallest"},"your dm code for this session:"),r.a.createElement("p",{className:"smallest strong"},W.getID())),r.a.createElement("div",{className:"icon-section"},r.a.createElement(ca.a,{title:"copy to clipboard",onClick:function(e){return navigator.clipboard.writeText(W.getID())}}))),r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},r.a.createElement("p",{className:"smallest"},"player app url:"),r.a.createElement("p",{className:"smallest strong"},t)),r.a.createElement("div",{className:"icon-section"},r.a.createElement(ca.a,{title:"copy to clipboard",onClick:function(e){return navigator.clipboard.writeText(t)}}))),r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"currently sharing"),r.a.createElement("div",{className:"section"},a),n,r.a.createElement("hr",null),r.a.createElement("div",{className:"subheading"},"options"),r.a.createElement(re,{label:"allow chat",checked:W.data.options.allowChat,onChecked:function(e){return J.setOption("allowChat",e)}}),r.a.createElement(re,{label:"allow players to control their characters",checked:W.data.options.allowControls,onChecked:function(e){return J.setOption("allowControls",e)}}),r.a.createElement(rt,{text:"end the session",onConfirm:function(){return J.shutdown()}}))}return null}},{key:"getViewSelector",value:function(){var e=this;if("started"!==J.getState())return null;var t=[];return t.push("management"),t.push("people"),W.data.options.allowChat&&t.push("messages"),r.a.createElement(Y,{options:t.map((function(e){return{id:e,text:e}})),selectedID:this.props.view,onSelect:function(t){return e.props.setView(t)}})}},{key:"getFooter",value:function(){return"started"===J.getState()&&"messages"===this.props.view?r.a.createElement("div",{className:"sidebar-footer"},r.a.createElement(La,{user:"dm",sendMessage:function(e,t,a,n){return J.sendMessage(e,t,a,n)},sendLink:function(e,t){return J.sendLink(e,t)},sendImage:function(e,t){return J.sendImage(e,t)},sendRoll:function(e,t){return J.sendRoll(e,t)},sendCard:function(e,t){return J.sendCard(e,t)}})):null}},{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"session"),this.getViewSelector()),r.a.createElement("div",{className:"sidebar-content"},this.getContent()),this.getFooter())}}]),a}(r.a.Component),Ya=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.dieRolls.map((function(e){return r.a.createElement(Da,{key:e.id,result:e})}));return r.a.createElement("div",null,r.a.createElement(Ma,{dice:this.props.dice,constant:this.props.constant,setDie:function(t,a){return e.props.setDie(t,a)},setConstant:function(t){return e.props.setConstant(t)},resetDice:function(){return e.props.resetDice()},rollDice:function(t){return e.props.rollDice(t)}}),r.a.createElement("hr",null),t)}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Xa=a(79);Xa.c.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Xa.c.version,"/pdf.worker.js");var Ka=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={pageCount:1,page:1},n}return Object(c.a)(a,[{key:"setPageCount",value:function(e){this.setState({pageCount:e})}},{key:"nudgePage",value:function(e){var t=Math.max(1,this.state.page+e);t=Math.min(this.state.pageCount,t),this.setState({page:t})}},{key:"render",value:function(){var e=this,t=null;return this.state.pageCount>1&&(t=r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:6},r.a.createElement("div",{className:"section centered"},r.a.createElement(Ht.a,{style:{fontSize:"16px"},onClick:function(){return e.nudgePage(-1)}}))),r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"section centered"},this.state.page," / ",this.state.pageCount)),r.a.createElement(v.a,{span:6},r.a.createElement("div",{className:"section centered"},r.a.createElement(Wt.a,{style:{fontSize:"16px"},onClick:function(){return e.nudgePage(1)}}))))),r.a.createElement("div",null,r.a.createElement(Xa.a,{className:"pdf-document",file:this.props.src,onLoadSuccess:function(t){var a=t.numPages;return e.setPageCount(a)}},r.a.createElement(Xa.b,{pageNumber:this.state.page})),t)}}]),a}(r.a.Component),Za=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={mode:"image",playerViewOpen:!1},n}return Object(c.a)(a,[{key:"setMode",value:function(e){var t=this;this.setState({mode:e},(function(){t.props.setHandout(null)}))}},{key:"readFile",value:function(e){var t=this,a=new FileReader;return a.onload=function(a){a.target&&t.props.setHandout({type:t.state.mode,filename:e.name,src:a.target.result})},a.readAsDataURL(e),!1}},{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"clear",value:function(){var e=this;"handout"===W.data.shared.type&&J.shareNothing(),this.setState({playerViewOpen:!1},(function(){e.props.setHandout(null)}))}},{key:"getAccept",value:function(){switch(this.state.mode){case"image":return"image/*";case"audio":return"audio/*";case"video":return"video/*";case"pdf":return".pdf"}}},{key:"getDisplay",value:function(){if(!this.props.handout)return null;switch(this.props.handout.type){case"image":return r.a.createElement("img",{className:"nonselectable-image",src:this.props.handout.src||"",alt:this.props.handout.filename||""});case"audio":return r.a.createElement("audio",{controls:!0},r.a.createElement("source",{src:this.props.handout.src||""}));case"video":return r.a.createElement("video",{controls:!0},r.a.createElement("source",{src:this.props.handout.src||""}));case"pdf":return r.a.createElement(Ka,{src:this.props.handout.src||""})}return null}},{key:"getPlayerView",value:function(){var e=this;return this.state.playerViewOpen?r.a.createElement(ya,{title:"Handout",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},this.getDisplay()):null}},{key:"render",value:function(){var e=this;try{var t=null;return t=this.props.handout?r.a.createElement("div",null,this.getDisplay(),r.a.createElement("hr",null),r.a.createElement(re,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}}),r.a.createElement(re,{label:"share in session",disabled:"started"!==J.getState(),checked:"handout"===W.data.shared.type,onChecked:function(t){return t?J.shareHandout(e.props.handout):J.shareNothing()}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.clear()}},"change handout")):r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("p",null,"you can use this tool to select a file and show it to your players")),r.a.createElement(Y,{options:["image","audio","video","pdf"].map((function(e){return{id:e,text:e}})),selectedID:this.state.mode,onSelect:function(t){return e.setMode(t)}}),r.a.createElement(te.a.Dragger,{accept:this.getAccept(),showUploadList:!1,beforeUpload:function(t){return e.readFile(t)}},r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ee.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"click here, or drag a file here, to upload it"))),r.a.createElement("div",null,t,this.getPlayerView())}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Qa=a(277),$a=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"say",value:function(){var t=Object(ia.a)(oa.a.mark((function t(a,n){var r;return oa.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.speechSynthesis.cancel(),r=new SpeechSynthesisUtterance(a),t.next=4,e.chooseVoice(n);case 4:r.voice=t.sent,r.rate=e.randomValue(.5,1.5),r.pitch=e.randomValue(.5,1.5),window.speechSynthesis.speak(r);case 8:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},{key:"chooseVoice",value:function(){var t=Object(ia.a)(oa.a.mark((function t(a){var n,r,s,o;return oa.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getVoices();case 2:return n=t.sent,r=a.map((function(t){return e.getLanguageCode(t)})),0===(s=n.filter((function(e){return r.includes(e.lang.substr(0,2))}))).length&&(s=n.filter((function(e){return e.default}))),0===s.length&&(s=n),o=k.randomNumber(s.length),t.abrupt("return",s[o]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getVoices",value:function(){return new Promise((function(e){var t=window.speechSynthesis.getVoices();t.length>0?e(t):speechSynthesis.onvoiceschanged=function(){t=window.speechSynthesis.getVoices(),e(t)}}))}},{key:"getLanguageCode",value:function(e){switch(e){case"armenian":return"hy";case"basque":return"eu";case"bulgarian":return"bg";case"chichewa":return"ny";case"chinese":return"zh";case"croatian":return"hr";case"czech":return"cs";case"dutch":return"nl";case"german":return"de";case"greek":return"el";case"icelandic":return"is";case"irish":return"ga";case"kannada":return"kn";case"kazakh":return"kk";case"latvian":return"lv";case"lithuanian":return"lt";case"macedonian":return"mk";case"malay":return"ms";case"maltese":return"mt";case"maori":return"mi";case"polish":return"pl";case"portuguese":return"pt";case"punjabi":return"pa";case"samoan":return"sm";case"serbian":return"sr";case"shona":return"sn";case"spanish":return"es";case"swedish":return"sv";case"turkish":return"tr";case"welsh":return"cy";default:return e.substr(0,2)}}},{key:"randomValue",value:function(e,t){return e+(k.randomDecimal()+k.randomDecimal()+k.randomDecimal())/3*(t-e)}}]),e}(),en=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=["draconic","dwarvish","elvish","goblin","orc","custom"].map((function(e){return{id:e,text:e}})),a=this.props.selectedLanguages.length>0,n=null;if("custom"===this.props.languagePreset){var s=this.props.selectedLanguages.join(", ");""===s&&(s="none");var o=T.getAllLanguages().map((function(t){var a=e.props.selectedLanguages.includes(t);return r.a.createElement(re,{key:t,label:t,checked:a,display:"button",onChecked:function(a){return a?e.props.addLanguage(t):e.props.removeLanguage(t)}})})),i=a||this.props.output.length>0;n=r.a.createElement("div",{className:"group-panel"},r.a.createElement(me,{text:"selected languages: "+s},r.a.createElement("div",{className:"language-options"},r.a.createElement(Tt,{columns:3,content:o}))),r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.props.selectRandomLanguages()}},"random languages")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{className:i?"":"disabled",onClick:function(){return e.props.resetLanguages()}},"reset"))))}var c=[];this.props.output.length>0&&c.push(r.a.createElement("hr",{key:"div"}));for(var l=0;l!==this.props.output.length;++l)c.push(r.a.createElement(tn,{key:l,text:this.props.output[l],languages:this.props.selectedLanguages}));return r.a.createElement("div",null,r.a.createElement(Y,{options:t,selectedID:this.props.languagePreset,itemsPerRow:3,onSelect:function(t){return e.props.selectLanguagePreset(t)}}),n,r.a.createElement("hr",null),r.a.createElement("button",{className:a?"":"disabled",onClick:function(){return e.props.generateLanguage()}},"generate text"),c)}catch(u){return console.error(u),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),tn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"copy",value:function(e){e.stopPropagation(),navigator.clipboard.writeText(this.props.text)}},{key:"say",value:function(e){e.stopPropagation(),$a.say(this.props.text,this.props.languages)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"generated-item group-panel"},r.a.createElement("div",{className:"text-section"},this.props.text.toLowerCase()),r.a.createElement("div",{className:"icon-section"},r.a.createElement("div",null,r.a.createElement(ca.a,{title:"copy to clipboard",onClick:function(t){return e.copy(t)}})),r.a.createElement("div",null,r.a.createElement(Qa.a,{title:"say (experimental)",onClick:function(t){return e.say(t)}}))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),an=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={deck:"tarot deck"},n}return Object(c.a)(a,[{key:"draw",value:function(e){var t=[];switch(this.state.deck){case"tarot deck":t=Ia.getTarotDeck();break;case"tarot deck (major arcana)":t=Ia.getTarotMajorArcana();break;case"tarot deck (minor arcana)":t=Ia.getTarotMinorArcana();break;case"standard deck":t=Ia.getStandardDeck();break;case"standard deck (with jokers)":t=Ia.getStandardDeckWithJokers();break;case"deck of many things":t=Ia.getDeckOfManyThings();break;case"deck of many things (13 cards)":t=Ia.getDeckOfManyThingsSmall()}this.props.drawCards(e,t)}},{key:"render",value:function(){var e=this;try{if(0===this.props.draws.length)return r.a.createElement("div",null,r.a.createElement(ce,{options:["tarot deck","tarot deck (major arcana)","tarot deck (minor arcana)","standard deck","standard deck (with jokers)","deck of many things","deck of many things (13 cards)"].map((function(e){return{id:e,text:e}})),selectedID:this.state.deck,onSelect:function(t){return e.setState({deck:t})}}),r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.draw(1)}},"draw a card")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.draw(3)}},"draw three cards"))));var t=this.props.draws.map((function(e){return r.a.createElement(v.a,{span:8,key:e.id},r.a.createElement(ja,{card:e.card,reversed:e.reversed}))}));return r.a.createElement("div",null,r.a.createElement(f.a,{gutter:10,justify:"space-around"},t),r.a.createElement("button",{onClick:function(){return e.props.resetDraw()}},"reset"))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),nn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null;switch(this.props.view){case"die":t=r.a.createElement(Ya,{dice:this.props.dice,constant:this.props.constant,dieRolls:this.props.dieRolls,setDie:function(t,a){return e.props.setDie(t,a)},setConstant:function(t){return e.props.setConstant(t)},rollDice:function(t){return e.props.rollDice(t)},resetDice:function(){return e.props.resetDice()}});break;case"handout":t=r.a.createElement(Za,{handout:this.props.handout,setHandout:function(t){return e.props.setHandout(t)}});break;case"language":t=r.a.createElement(en,{languagePreset:this.props.languagePreset,selectedLanguages:this.props.selectedLanguages,output:this.props.languageOutput,selectLanguagePreset:function(t){return e.props.selectLanguagePreset(t)},addLanguage:function(t){return e.props.addLanguage(t)},removeLanguage:function(t){return e.props.removeLanguage(t)},selectRandomLanguages:function(){return e.props.selectRandomLanguages()},resetLanguages:function(){return e.props.resetLanguages()},generateLanguage:function(){return e.props.generateLanguage()}});break;case"oracle":t=r.a.createElement(an,{draws:this.props.draws,drawCards:function(t,a){return e.props.drawCards(t,a)},resetDraw:function(){return e.props.resetDraw()}})}return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{className:"heading"},"tools"),r.a.createElement(Y,{options:[{id:"die",text:"die roller"},{id:"handout",text:"handout"},{id:"language",text:"language"},{id:"oracle",text:"oracle"}],selectedID:this.props.view,onSelect:function(t){return e.props.setView(t)}})),r.a.createElement("div",{className:"sidebar-content"},t))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),rn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{if(!this.props.sidebar.visible)return null;var t=[];switch(this.props.user){case"dm":t.push(r.a.createElement(Yt.a,{key:"tools",className:"tools"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"tools",onClick:function(){return e.props.onSelectSidebar("tools")}})),t.push(r.a.createElement(Xt.a,{key:"generators",className:"generators"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"generators",onClick:function(){return e.props.onSelectSidebar("generators")}})),t.push(r.a.createElement(Kt.a,{key:"reference",className:"reference"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"reference",onClick:function(){return e.props.onSelectSidebar("reference")}})),t.push(r.a.createElement(Zt.a,{key:"session",className:"session"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"session",onClick:function(){return e.props.onSelectSidebar("session")}})),t.push(r.a.createElement(Qt.a,{key:"search",className:"search"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"search",onClick:function(){return e.props.onSelectSidebar("search")}})),t.push(r.a.createElement($t.a,{key:"about",className:"about"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"about",onClick:function(){return e.props.onSelectSidebar("about")}}));break;case"player":if(t.push(r.a.createElement(Kt.a,{key:"reference",className:"reference"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"reference",onClick:function(){return e.props.onSelectSidebar("reference")}})),"connected"===_.getState()){if(W.data.options.allowChat&&t.push(r.a.createElement(ea.a,{key:"session-chat",className:"session-chat"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"chat",onClick:function(){return e.props.onSelectSidebar("session-chat")}})),W.data.options.allowControls){var a=!1;switch(W.data.shared.type){case"combat":case"exploration":a=!0}a&&t.push(r.a.createElement(ta.a,{key:"session-controls",className:"session-controls"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"controls",onClick:function(){return e.props.onSelectSidebar("session-controls")}}))}t.push(r.a.createElement(Zt.a,{key:"session-player",className:"session-player"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"session",onClick:function(){return e.props.onSelectSidebar("session-player")}}))}t.push(r.a.createElement($t.a,{key:"about",className:"about"===this.props.sidebar.type?"sidebar-icon selected":"sidebar-icon",title:"about",onClick:function(){return e.props.onSelectSidebar("about")}}))}var n=null;switch(this.props.sidebar.type){case"tools":n=r.a.createElement(nn,{view:this.props.sidebar.subtype,setView:function(t){var a=e.props.sidebar;a.subtype=t,e.props.onUpdateSidebar(a)},dice:this.props.sidebar.dice,constant:this.props.sidebar.constant,dieRolls:this.props.sidebar.dieRolls,setDie:function(t,a){var n=e.props.sidebar;n.dice[t]=a,e.props.onUpdateSidebar(n)},setConstant:function(t){var a=e.props.sidebar;a.constant=t,e.props.onUpdateSidebar(a)},rollDice:function(t){var a=e.props.sidebar,n=C.rollDice(a.dice,a.constant,t);a.dieRolls.unshift(n),e.props.onUpdateSidebar(a)},resetDice:function(){var t=e.props.sidebar;[4,6,8,10,12,20,100].forEach((function(e){return t.dice[e]=0})),t.constant=0,e.props.onUpdateSidebar(t)},handout:this.props.sidebar.handout,setHandout:function(t){var a=e.props.sidebar;a.handout=t,e.props.onUpdateSidebar(a)},languagePreset:this.props.sidebar.languagePreset,selectedLanguages:this.props.sidebar.selectedLanguages,languageOutput:this.props.sidebar.languageOutput,selectLanguagePreset:function(t){var a=e.props.sidebar;switch(a.languagePreset=t,t){case"draconic":a.selectedLanguages=["armenian","irish","maltese"];break;case"dwarvish":a.selectedLanguages=["czech","german","yiddish"];break;case"elvish":a.selectedLanguages=["finnish","spanish","welsh"];break;case"goblin":a.selectedLanguages=["hawaiian","kyrgyz","somali"];break;case"orc":a.selectedLanguages=["macedonian","russian","turkish"]}a.languageOutput=[],e.props.onUpdateSidebar(a)},addLanguage:function(t){var a=e.props.sidebar;a.selectedLanguages.push(t),e.props.onUpdateSidebar(a)},removeLanguage:function(t){var a=e.props.sidebar,n=a.selectedLanguages.indexOf(t);a.selectedLanguages.splice(n,1),e.props.onUpdateSidebar(a)},selectRandomLanguages:function(){var t=T.getAllLanguages(),a=e.props.sidebar;for(a.selectedLanguages=[];3!==a.selectedLanguages.length;){var n=t[k.randomNumber(t.length)];a.selectedLanguages.includes(n)||a.selectedLanguages.push(n)}e.props.onUpdateSidebar(a)},resetLanguages:function(){var t=e.props.sidebar;t.languagePreset=null,t.selectedLanguages=[],t.languageOutput=[],e.props.onUpdateSidebar(t)},generateLanguage:function(){var t=e.props.sidebar,a=t.selectedLanguages.map((function(e){return fetch("/dojo/data/langs/"+e+".txt")}));Promise.all(a).then((function(a){var n=a.map((function(e){return e.text()}));Promise.all(n).then((function(a){T.initModel(a),t.languageOutput=T.generateLines(5),e.props.onUpdateSidebar(t)}))}))},draws:this.props.sidebar.draws,drawCards:function(t,a){var n=e.props.sidebar;n.draws=[];for(var r=function(){var e=k.randomNumber(a.length),t=a[e];n.draws.find((function(e){return e.card.id===t.id}))||n.draws.push({id:k.guid(),card:t,reversed:k.randomBoolean()})};n.draws.length<t;)r();e.props.onUpdateSidebar(n)},resetDraw:function(){var t=e.props.sidebar;t.draws=[],e.props.onUpdateSidebar(t)}});break;case"generators":n=r.a.createElement(pa,{view:this.props.sidebar.subtype,npc:this.props.sidebar.npc,setView:function(t){var a=e.props.sidebar;a.subtype=t,e.props.onUpdateSidebar(a)},generateNPC:function(){var t=e.props.sidebar;t.npc={age:T.generateNPCAge(),profession:T.generateNPCProfession(),height:T.generateNPCHeight(),weight:T.generateNPCWeight(),hair:T.generateNPCHair(),physical:T.generateNPCPhysical(),mental:T.generateNPCMental(),speech:T.generateNPCSpeech(),trait:T.generateNPCTrait(),ideal:T.generateNPCIdeal(),bond:T.generateNPCBond(),flaw:T.generateNPCFlaw()},e.props.onUpdateSidebar(t)}});break;case"reference":var s=[];this.props.library.forEach((function(e){e.monsters.forEach((function(e){return s.push(e)}))})),k.sort(s),n=r.a.createElement(ka,{view:this.props.sidebar.subtype,setView:function(t){var a=e.props.sidebar;a.subtype=t,e.props.onUpdateSidebar(a)},selectedPartyID:this.props.sidebar.selectedPartyID,parties:this.props.parties,selectPartyID:function(t){var a=e.props.sidebar;a.selectedPartyID=t,e.props.onUpdateSidebar(a)},selectedMonsterID:this.props.sidebar.selectedMonsterID,monsters:s,selectMonsterID:function(t){var a=e.props.sidebar;a.selectedMonsterID=t,e.props.onUpdateSidebar(a)}});break;case"session":n=r.a.createElement(_a,{view:this.props.sidebar.subtype,setView:function(t){var a=e.props.sidebar;a.subtype=t,e.props.onUpdateSidebar(a)},parties:this.props.parties,openImage:function(t){return e.props.openImage(t)}});break;case"session-player":n=r.a.createElement(Ja,{editPC:function(t){return e.props.editPC(t)}});break;case"session-chat":n=r.a.createElement(qa,{openImage:function(t){return e.props.openImage(t)}});break;case"session-controls":n=r.a.createElement(Wa,{addCondition:function(t,a){return e.props.addCondition(t,a)},editCondition:function(t,a,n){return e.props.editCondition(t,a,n)},toggleAddingToMap:function(){return e.props.toggleAddingToMap()},onUpdated:function(){return e.props.onUpdated()}});break;case"search":n=r.a.createElement(wa,{parties:this.props.parties,library:this.props.library,encounters:this.props.encounters,maps:this.props.maps,openParty:function(t){return e.props.selectParty(t)},openGroup:function(t){return e.props.selectMonsterGroup(t)},openEncounter:function(t){return e.props.selectEncounter(t)},openMap:function(t){return e.props.selectMap(t)},getMonster:function(t){return e.props.getMonster(t)}});break;case"about":n=r.a.createElement(na,{parties:this.props.parties,library:this.props.library,maps:this.props.maps,combats:this.props.combats,explorations:this.props.explorations,options:this.props.options,setOption:function(t,a){return e.props.setOption(t,a)}})}return r.a.createElement("div",{className:"sidebar sidebar-right"},r.a.createElement("div",{className:"sidebar-icons"},t),n)}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);rn.defaultProps={parties:[],library:[],encounters:[],maps:[],combats:[],explorations:[],currentCombat:null,currentExploration:null,selectParty:null,selectMonsterGroup:null,selectEncounter:null,selectMap:null,openImage:null,openStatBlock:null,editPC:null,addCondition:null,editCondition:null,toggleAddingToMap:null,onUpdated:null,getMonster:null};var sn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=["overlay","token"].map((function(e){return{id:e,text:e}})),a=["square","rounded","circle"].map((function(e){return{id:e,text:e}}));return r.a.createElement("div",{className:"card map",key:"selected"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},"map item")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"subheading"},"type"),r.a.createElement(Y,{options:t,selectedID:this.props.item.type,onSelect:function(t){return e.props.changeValue(e.props.item,"type",t)}}),r.a.createElement("div",{className:"subheading"},"move"),r.a.createElement($e,{onClick:function(t){return e.props.moveMapItem(e.props.item,t)}}),r.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement("div",{className:"section"},r.a.createElement(fe,{value:this.props.item.width+" sq",label:"width",downEnabled:this.props.item.width>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"width",t)}}),r.a.createElement(fe,{value:this.props.item.height+" sq",label:"height",downEnabled:this.props.item.height>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"height",t)}}))),r.a.createElement("div",{style:{display:"overlay"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"shape"),r.a.createElement(Y,{options:a,selectedID:this.props.item.style,onSelect:function(t){return e.props.changeValue(e.props.item,"style",t)}}),r.a.createElement("div",{className:"subheading"},"color"),r.a.createElement("input",{type:"color",value:this.props.item.color,onChange:function(t){return e.props.changeValue(e.props.item,"color",t.target.value)}}),r.a.createElement("div",{className:"subheading"},"opacity"),r.a.createElement(Z.a,{min:0,max:255,value:this.props.item.opacity,tooltipVisible:!1,onChange:function(t){return e.props.changeValue(e.props.item,"opacity",t)}})),r.a.createElement("div",{style:{display:"token"===this.props.item.type?"block":"none"}},r.a.createElement("div",{className:"subheading"},"size"),r.a.createElement(fe,{value:this.props.item.size,downEnabled:"tiny"!==this.props.item.size,upEnabled:"gargantuan"!==this.props.item.size,onNudgeValue:function(t){return e.props.nudgeValue(e.props.item,"size",t)}})),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("button",{onClick:function(){return e.props.deleteMapItem(e.props.item)}},"remove from the map"))))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),on=new Ne.a.Converter;on.setOption("tables",!0);var cn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getInformationTag",value:function(){return this.props.combatant.current?r.a.createElement($.a,{className:"info"},"current turn"):this.props.selected?r.a.createElement($.a,{className:"info"},"selected"):null}},{key:"onClick",value:function(e){e.stopPropagation(),this.props.select&&this.props.select(this.props.combatant,e.ctrlKey)}},{key:"getContent",value:function(){var e=this,t=[];if("monster"===this.props.combatant.type&&!this.props.minimal){var a,n,s=this.props.combatant,o=(null!==(a=this.props.combatant.hpCurrent)&&void 0!==a?a:0).toString();(null!==(n=this.props.combatant.hpTemp)&&void 0!==n?n:0)>0&&(o+="+"+this.props.combatant.hpTemp),t.push(r.a.createElement("div",{key:"stats"},r.a.createElement(f.a,{align:"middle"},r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"information"},r.a.createElement("div",null,"ac"),r.a.createElement("div",{className:"information-value"},s.ac))),r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"information"},r.a.createElement("div",{className:"information-value"},o),r.a.createElement("div",null,"hp")))),r.a.createElement(Ce,{combatant:this.props.combatant})))}if(this.props.combatant.mountID){var i=this.props.combat.combatants.find((function(t){return t.id===e.props.combatant.mountID}));if(i){var c=r.a.createElement("button",{className:"link",onClick:function(t){t.stopPropagation(),e.props.select(i,!1)}},i.displayName),l=null;"controlled"===this.props.combatant.mountType&&(l=r.a.createElement("div",{className:"note-details"},"your mount moves as directed; it can only take dash, disengage, or dodge actions")),t.push(r.a.createElement(Pe,{key:"mount"},r.a.createElement("div",null," mounted on: ",c),l,r.a.createElement("div",{className:"note-details"},"if you\u2019re knocked prone, or an effect moves your mount against its will, you must succeed on a dex save (dc 10) or land prone in a space within 5 feet of your mount"),r.a.createElement("div",{className:"note-details"},"if your mount is knocked prone, you can use your reaction to land on your feet; otherwise, you fall prone in a space within 5 feet of your mount")))}}var u=this.props.combat.combatants.find((function(t){return t.mountID===e.props.combatant.id}));if(u){var d=r.a.createElement("button",{className:"link",onClick:function(t){t.stopPropagation(),e.props.select(u,!1)}},u.displayName);t.push(r.a.createElement(Pe,{key:"rider"},r.a.createElement("div",null,"ridden by: ",d)))}var m=[];return this.props.combatant.tags.filter((function(e){return e.startsWith("engaged")})).forEach((function(e){m.push(C.getTagDescription(e))})),m.length>0&&t.push(r.a.createElement(Pe,{key:"engaged"},r.a.createElement("div",null,"engaged with: ",m.join(", ")))),this.props.combatant.tags.filter((function(e){return!e.startsWith("engaged")})).forEach((function(e){t.push(r.a.createElement(Pe,{key:e},r.a.createElement("div",{className:"note-heading"},C.getTagTitle(e)),r.a.createElement("div",{className:"note-details"},C.getTagDescription(e))))})),this.props.combat.map&&!this.props.combat.map.items.find((function(t){return t.id===e.props.combatant.id}))&&t.push(r.a.createElement(Pe,{key:"not-on-map"},r.a.createElement("p",null,"not on the map"))),this.props.combatant.showOnMap||t.push(r.a.createElement(Pe,{key:"hidden"},"hidden")),this.props.combatant.conditions&&this.props.combatant.conditions.forEach((function(a){var n=a.name;"exhaustion"===a.name&&(n+=" ("+a.level+")"),a.duration&&(n+=" "+C.conditionDurationText(a,e.props.combat.combatants));var s=null;"custom"!==a.name&&(s=r.a.createElement("div",{className:"note-heading"},n));for(var o=[],i=C.conditionText(a),c=0;c!==i.length;++c)o.push(r.a.createElement("div",{key:c,className:"note-details"},i[c]));t.push(r.a.createElement(Pe,{key:a.id},s,o))})),this.props.combatant.note&&t.push(r.a.createElement(Pe,{key:"text"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:on.makeHtml(this.props.combatant.note)}}))),t}},{key:"render",value:function(){var e=this;try{var t="initiative-list-item clickable "+this.props.combatant.type;this.props.combatant.current&&(t+=" current"),this.props.selected&&(t+=" highlight"),this.props.combatant.defeated&&(t+=" defeated");var a=null,n=this.props.combatant;return n.portrait&&(a=r.a.createElement(ae,{source:n,inline:!0})),r.a.createElement("div",{className:t,onClick:function(t){return e.onClick(t)},role:"button"},r.a.createElement("div",{className:"header"},a,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant"),this.getInformationTag()),r.a.createElement("div",{className:"init-entry-content"},this.getContent()))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),ln=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"makeActive",value:function(e){e.stopPropagation(),this.props.makeActive(this.props.combatant)}},{key:"render",value:function(){var e=this;try{var t,a=null,n=this.props.combatant;return n.portrait&&(a=r.a.createElement(ae,{source:n,inline:!0})),r.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},r.a.createElement("div",{className:"header"},a,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),r.a.createElement("div",{className:"init-entry-content"},r.a.createElement(fe,{value:null!==(t=this.props.combatant.initiative)&&void 0!==t?t:10,onNudgeValue:function(t){return e.props.nudgeValue(e.props.combatant,"initiative",t)}}),r.a.createElement("button",{onClick:function(t){return e.makeActive(t)}},"add to encounter")))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),un=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=null,a=this.props.combatant;return a.portrait&&(t=r.a.createElement(ae,{source:a,inline:!0})),r.a.createElement("div",{className:"initiative-list-item "+this.props.combatant.type},r.a.createElement("div",{className:"header"},t,r.a.createElement("div",{className:"name"},this.props.combatant.displayName||"combatant")),r.a.createElement("div",{className:"init-entry-content"},r.a.createElement("button",{onClick:function(){return e.props.addToMap()}},"place on map")))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),dn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"orderCombatants",value:function(e){var t=e.find((function(e){return e.current}));if(t){var a=e.indexOf(t);if(0!==a){var n=Object(N.a)(e);return n.splice(a).concat(["top of the round"]).concat(n)}}return e}},{key:"createCombatantRow",value:function(e){var t=this;if("string"===typeof e)return r.a.createElement("div",{key:e,className:"section init-separator"},e);var a=this.props.selectedItemIDs.includes(e.id);return this.props.playerView&&!this.props.combat.map&&(a=!1),r.a.createElement(cn,{key:e.id,combatant:e,combat:this.props.combat,selected:a,minimal:this.props.playerView,select:function(e,a){return t.props.toggleItemSelection(e.id,a)}})}},{key:"render",value:function(){var e=this,t=z.getActiveCombatants(this.props.combat,this.props.playerView,this.props.showDefeated),a=this.orderCombatants(t).map((function(t){return e.createCombatantRow(t)}));return r.a.createElement("div",null,this.props.help,a)}}]),a}(r.a.Component),mn=new Ne.a.Converter;mn.setOption("tables",!0);var pn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={showOptions:!1,showDefeatedCombatants:!1,selectedItemIDs:[],selectedAreaID:null,addingToMapID:null,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null,playerViewOpen:!1,middleColumnWidth:8},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("beforeunload",(function(){e.setPlayerViewOpen(!1)}))}},{key:"componentDidUpdate",value:function(){"combat"===W.data.shared.type&&(W.data.shared.additional={selectedAreaID:this.state.selectedAreaID,highlightedSquare:this.state.highlightedSquare},J.sendSharedDiffUpdate())}},{key:"toggleShowOptions",value:function(){this.setState({showOptions:!this.state.showOptions})}},{key:"toggleShowDefeatedCombatants",value:function(){this.setState({showDefeatedCombatants:!this.state.showDefeatedCombatants})}},{key:"setSelectedItemIDs",value:function(e){this.setState({selectedItemIDs:e})}},{key:"toggleItemSelection",value:function(e,t){if(e&&t){var a=this.state.selectedItemIDs;if(a.includes(e)){var n=a.indexOf(e);a.splice(n,1)}else a.push(e);this.setSelectedItemIDs(a)}else this.setSelectedItemIDs(e?[e]:[])}},{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"setAddingToMapID",value:function(e){this.setState({addingToMapID:e,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleAddingOverlay",value:function(){this.setState({addingOverlay:!this.state.addingOverlay,addingToMapID:null,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleEditFog",value:function(){this.setState({addingOverlay:!1,addingToMapID:null,editFog:!this.state.editFog,highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleHighlightMapSquare",value:function(){this.setState({addingOverlay:!1,addingToMapID:null,editFog:!1,highlightMapSquare:!this.state.highlightMapSquare,highlightedSquare:null})}},{key:"setHighlightedSquare",value:function(e,t){this.state.highlightMapSquare&&this.setState({highlightedSquare:{x:e,y:t}})}},{key:"fillFog",value:function(){if(this.props.combat.map){var e=[],t=R.mapDimensions(this.props.combat.map.items);if(t){for(var a=t.minX;a<=t.maxX;++a)for(var n=t.minY;n<=t.maxY;++n)e.push({x:a,y:n});this.props.setFog(e)}}}},{key:"clearFog",value:function(){this.props.setFog([])}},{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"nudgeMiddleColumnWidth",value:function(e){this.setState({middleColumnWidth:this.state.middleColumnWidth+e})}},{key:"nextTurn",value:function(){var e=this,t=this.props.combat.combatants.find((function(e){return e.current}));if(t)this.props.endTurn(t);else{var a=this.props.combat.combatants.filter((function(t){return"placeholder"!==t.type||z.combatHasLairActions(e.props.combat)})).find((function(e){return e.active}));a&&this.props.makeCurrent(a)}}},{key:"defeatCombatants",value:function(e){var t=this,a=e.map((function(e){return e.id}));this.setState({selectedItemIDs:this.state.selectedItemIDs.filter((function(e){return!a.includes(e)}))},(function(){t.props.makeDefeated(e)}))}},{key:"removeCombatants",value:function(e){var t=this,a=e.map((function(e){return e.id}));this.setState({selectedItemIDs:this.state.selectedItemIDs.filter((function(e){return!a.includes(e)}))},(function(){t.props.removeCombatants(e)}))}},{key:"gridSquareClicked",value:function(e,t){var a=this;if(this.state.addingToMapID){var n=this.props.combat.combatants.find((function(e){return e.id===a.state.addingToMapID}));n&&this.props.mapAdd(n,e,t),this.setAddingToMapID(null)}if(this.state.addingOverlay){var r=w.createMapItem();r.type="token",r.x=e,r.y=t,r.width=1,r.height=1,r.color="#005080",r.opacity=127,r.style="square",this.props.addOverlay(r),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[r.id]})}this.state.editFog&&this.gridRectangleSelected(e,t,e,t)}},{key:"gridRectangleSelected",value:function(e,t,a,n){if(this.state.addingOverlay){var r=w.createMapItem();r.type="overlay",r.x=e,r.y=t,r.width=a-e+1,r.height=n-t+1,r.color="#005080",r.opacity=127,r.style="square",this.props.addOverlay(r),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[r.id]})}if(this.state.editFog){for(var s=this.props.combat.fog,o=function(e){for(var a=function(t){var a=s.findIndex((function(a){return a.x===e&&a.y===t}));-1===a?s.push({x:e,y:t}):s.splice(a,1)},r=t;r<=n;++r)a(r)},i=e;i<=a;++i)o(i);this.props.setFog(s)}}},{key:"getPlayerView",value:function(){var e=this;if(!this.state.playerViewOpen)return null;var t=r.a.createElement(dn,{combat:this.props.combat,playerView:!0,showDefeated:!1,help:null,selectedItemIDs:this.state.selectedItemIDs,toggleItemSelection:function(e,t){return null}});return this.props.combat.map?r.a.createElement(ya,{title:"Encounter",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement(f.a,{className:"full-height full-width"},r.a.createElement(v.a,{span:18,className:"scrollable both-ways"},r.a.createElement(xe,{key:"map",map:this.props.combat.map,mode:"combat-player",viewport:R.getViewport(this.props.combat.map,this.state.selectedAreaID),combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,focussedSquare:this.state.highlightedSquare,itemSelected:function(t,a){return e.toggleItemSelection(t,a)}})),r.a.createElement(v.a,{span:6,className:"scrollable"},r.a.createElement("div",{className:"heading fixed-top"},"initiative order"),t))):r.a.createElement(ya,{title:"Encounter",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("div",{className:"scrollable full-width"},r.a.createElement("div",{className:"heading"},"initiative order"),t))}},{key:"getOptions",value:function(){var e=this;if(!this.state.showOptions)return null;var t=null;this.props.combat.encounter.notes&&(t=r.a.createElement(me,{text:"encounter notes"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:mn.makeHtml(this.props.combat.encounter.notes)}})));var a=null;this.props.combat.map&&(a=r.a.createElement(rt,{text:"end combat and start exploring",onConfirm:function(){return e.props.endCombat(e.props.combat,!0)}}));var n=[];this.props.combat.combatants.filter((function(e){return"pc"===e.type})).forEach((function(t){var a=e.props.parties.find((function(e){return e.pcs.find((function(e){return e.id===t.id}))}));a&&!n.includes(a)&&n.push(a)}));var s=[];n.forEach((function(t){t.pcs.forEach((function(a){e.props.combat.combatants.find((function(e){return e.id===a.id}))||s.push(r.a.createElement("button",{key:a.id,onClick:function(){return e.props.addPC(t.id,a.id)}},a.name," (",t.name,")"))}))}));var o=null;s.length>0&&(o=r.a.createElement(me,{text:"add pcs"},s));var i=null;this.props.combat.encounter&&this.props.combat.encounter.waves.length>0&&(i=r.a.createElement("button",{onClick:function(){return e.props.addWave()}},"add wave"));var c=null;this.props.combat.map&&(c=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"map"),r.a.createElement(re,{label:"add token / overlay",checked:this.state.addingOverlay,onChecked:function(){return e.toggleAddingOverlay()}}),r.a.createElement("div",{className:"group-panel",style:{display:this.state.addingOverlay?"":"none"}},r.a.createElement(Pe,null,r.a.createElement("p",null,"click on a map square to add a token, or select a rectangle to add an overlay"))),r.a.createElement(re,{label:"highlight map square",checked:this.state.highlightMapSquare,onChecked:function(){return e.toggleHighlightMapSquare()}}),r.a.createElement("div",{className:"group-panel",style:{display:this.state.highlightMapSquare?"":"none"}},r.a.createElement(Pe,null,r.a.createElement("p",null,"use your mouse to indicate a square on the map"),r.a.createElement("p",null,"that square will be highlighted on the shared map as well"))),r.a.createElement(re,{label:"edit fog of war",checked:this.state.editFog,onChecked:function(){return e.toggleEditFog()}}),r.a.createElement("div",{style:{display:this.state.editFog?"":"none"}},r.a.createElement(Pe,null,r.a.createElement("p",null,"click on map squares to turn fog of war on and off"),r.a.createElement("p",null,"you can also click and drag to select an area")),r.a.createElement("button",{onClick:function(){return e.fillFog()}},"fill fog of war"),r.a.createElement("button",{className:0===this.props.combat.fog.length?"disabled":"",onClick:function(){return e.clearFog()}},"clear fog of war")),r.a.createElement("button",{onClick:function(){return e.props.rotateMap()}},"rotate map")));var l=r.a.createElement("div",{key:"options"},r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"encounter"),t,r.a.createElement("button",{onClick:function(){return e.props.pauseCombat()}},"pause combat"),r.a.createElement(rt,{text:"end combat",onConfirm:function(){return e.props.endCombat(e.props.combat,!1)}}),a),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"combatants"),r.a.createElement("button",{onClick:function(){return e.props.addCombatants()}},"add combatants"),o,i,r.a.createElement("button",{onClick:function(){return e.props.addCompanion(null)}},"add a companion")),c,r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"sharing"),r.a.createElement(re,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}}),r.a.createElement(re,{label:"share in session",disabled:"started"!==J.getState(),checked:"combat"===W.data.shared.type,onChecked:function(t){return t?J.shareCombat(e.props.combat):J.shareNothing()}})),r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"layout"),r.a.createElement(re,{label:"show defeated combatants",checked:this.state.showDefeatedCombatants,onChecked:function(){return e.toggleShowDefeatedCombatants()}}),r.a.createElement(fe,{value:"middle column size",downEnabled:this.state.middleColumnWidth>4,upEnabled:this.state.middleColumnWidth<14,onNudgeValue:function(t){return e.nudgeMiddleColumnWidth(2*t)}})));return r.a.createElement(Tt,{heading:"options",content:[l],columns:1})}},{key:"getSelectedCombatants",value:function(){var e=this,t=this.state.selectedItemIDs.map((function(t){return e.props.combat.combatants.find((function(e){return e.id===t}))})).filter((function(e){return!!e}));k.sort(t,[{field:"displayName",dir:"asc"}]);var a=t.filter((function(e){return"placeholder"===e.type}));if(a.length>0)return r.a.createElement("div",null,this.createCard(a[0]));if(t.length>0&&t.every((function(e){return e.current})))return r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"you've selected the current initiative holder"));if(1===t.length)return r.a.createElement("div",null,this.createControls(t),r.a.createElement("hr",null),this.createCard(t[0]));if(t.length>1)return r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"multiple combatants are selected:"),t.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},t.displayName,r.a.createElement(p.a,{style:{float:"right",padding:"2px 0",fontSize:"14px"},onClick:function(){return e.toggleItemSelection(t.id,!0)}}))}))),this.createControls(t));if(this.props.combat.map){var n=this.props.combat.map.items.find((function(t){return t.id===e.state.selectedItemIDs[0]}));if(n)return r.a.createElement(sn,{item:n,moveMapItem:function(t,a){return e.props.mapMove([t.id],a)},deleteMapItem:function(t){return e.props.mapRemove([t.id])},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.props.nudgeValue(t,a,n)}})}return r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"select a pc or monster from the ",r.a.createElement("b",null,"initiative order")," list (in the middle column) to see its details here"))}},{key:"createControls",value:function(e){var t=this;return e.some((function(e){return"placeholder"===e.type}))?null:r.a.createElement(Ha,{combatants:e,allCombatants:this.props.combat.combatants,map:this.props.combat.map,makeCurrent:function(e){return t.props.makeCurrent(e)},makeActive:function(e){return t.props.makeActive(e)},makeDefeated:function(e){return t.defeatCombatants(e)},toggleTag:function(e,a){return t.props.toggleTag(e,a)},toggleCondition:function(e,a){return t.props.toggleCondition(e,a)},toggleHidden:function(e){return t.props.toggleHidden(e)},changeHP:function(e){return t.props.changeHP(e)},addCondition:function(e){return t.props.addCondition(e)},editCondition:function(e,a){return t.props.editCondition(e,a)},deleteCondition:function(e,a){return t.props.deleteCondition(e,a)},mapAdd:function(e){return t.setAddingToMapID(t.state.addingToMapID?null:e.id)},mapMove:function(e,a){return t.props.mapMove(e.map((function(e){return e.id})),a)},mapRemove:function(e){return t.props.mapRemove(e.map((function(e){return e.id})))},onChangeAltitude:function(e,a){return t.props.onChangeAltitude(e,a)},removeCombatants:function(e){return t.removeCombatants(e)},addCompanion:function(e){return t.props.addCompanion(e)},changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeValue:function(e,a,n){return t.props.nudgeValue(e,a,n)}})}},{key:"createCard",value:function(e){var t=this;switch(e.type){case"pc":return r.a.createElement(Rt,{pc:e});case"monster":return r.a.createElement(vt,{monster:e,combat:!0,showRollButtons:this.props.options.showMonsterDieRolls,useTrait:function(e){return t.props.useTrait(e)},rechargeTrait:function(e){return t.props.rechargeTrait(e)},onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}});case"companion":var a=null,n=e;return n.monsterID&&this.props.library.forEach((function(e){var s=e.monsters.find((function(e){return e.id===n.monsterID}));s&&(a=r.a.createElement(vt,{monster:s,combat:!0,showRollButtons:t.props.options.showMonsterDieRolls,useTrait:function(e){return t.props.useTrait(e)},rechargeTrait:function(e){return t.props.rechargeTrait(e)},onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}}))})),a;case"placeholder":var s=[];return this.props.combat.combatants.forEach((function(e){var a=e;a&&a.traits&&a.traits.some((function(e){return"lair"===e.type}))&&s.push(r.a.createElement("div",{className:"card monster",key:"lair "+a.id},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},a.name)),r.a.createElement("div",{className:"card-content"},r.a.createElement(ht,{combatant:a,mode:"lair",useTrait:function(e){return t.props.useTrait(e)},rechargeTrait:function(e){return t.props.rechargeTrait(e)}}))))})),s}return null}},{key:"render",value:function(){var e=this;try{var t=this.props.combat.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),a=this.props.combat.combatants.filter((function(e){return!t.includes(e.id)})).find((function(e){return e.current})),n=this.props.combat.combatants.filter((function(e){return!t.includes(e.id)})).filter((function(e){return e.pending})),s=n.map((function(t){return r.a.createElement(ln,{key:t.id,combatant:t,nudgeValue:function(t,a,n){return e.props.nudgeValue(t,a,n)},makeActive:function(t){return e.props.makeActive([t])}})}));if(0!==n.length){var o=null;"started"===J.getState()&&"combat"===W.data.shared.type&&W.data.people.some((function(e){return""!==e.characterID}))&&(o=r.a.createElement("button",{onClick:function(){return J.prompt("initiative")}},"ask for initiative rolls")),s.unshift(r.a.createElement(Pe,{key:"pending-help"},r.a.createElement("div",{className:"section"},"these combatants are not yet part of the encounter"),r.a.createElement("div",{className:"section"},"set initiative on each of them, then add them to the encounter"),o))}var i=null;a||(i=r.a.createElement(Pe,{key:"init-help"},r.a.createElement("div",{className:"section"},"these are the combatants taking part in this encounter; you can select them to see their stat blocks (on the right)"),r.a.createElement("div",{className:"section"},"they are listed in initiative order (with the highest initiative score at the top of the list, and the lowest at the bottom)")));var c=r.a.createElement(dn,{combat:this.props.combat,playerView:!1,showDefeated:this.state.showDefeatedCombatants,help:i,selectedItemIDs:this.state.selectedItemIDs,toggleItemSelection:function(t,a){return e.toggleItemSelection(t,a)}}),l=null;this.state.showOptions||(l=a?r.a.createElement("div",null,this.createControls([a]),r.a.createElement("hr",null),this.createCard(a)):r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"when you're ready to begin the encounter, press the ",r.a.createElement("b",null,"start combat")," button"),r.a.createElement("div",{className:"section"},"the current initiative holder will be displayed here"),r.a.createElement("button",{onClick:function(){return e.nextTurn()}},"start combat")));var u=null;if(this.props.combat.map){var d=z.getActiveCombatants(this.props.combat,!1,this.state.showDefeatedCombatants).filter((function(t){return e.props.combat.map&&!e.props.combat.map.items.find((function(e){return e.id===t.id}))}));d.length>0&&(u=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"these combatants are in the initiative order, but have not yet been placed on the map (which you'll find in the middle column)"),r.a.createElement("div",{className:"section"},"to place one on the map, click the ",r.a.createElement("b",null,"place on map")," button and then click on a map square"),r.a.createElement("div",{className:"section"},"or click ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.scatterCombatants(d,e.state.selectedAreaID)}},"here")," to scatter them randomly")),d.map((function(t){return r.a.createElement(un,{key:t.id,combatant:t,addToMap:function(){return e.setAddingToMapID(t.id)}})}))))}var m=null;this.props.combat.map&&(m=r.a.createElement("div",{key:"map",className:"scrollable horizontal-only"},r.a.createElement(xe,{map:this.props.combat.map,mode:"combat",viewport:R.getViewport(this.props.combat.map,this.state.selectedAreaID),showGrid:null!==this.state.addingToMapID||this.state.addingOverlay||this.state.editFog||this.state.highlightMapSquare,combatants:this.props.combat.combatants,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.combat.fog,focussedSquare:this.state.highlightedSquare,itemSelected:function(t,a){return e.toggleItemSelection(t,a)},areaSelected:function(t){return e.setSelectedAreaID(t)},gridSquareEntered:function(t,a){return e.setHighlightedSquare(t,a)},gridSquareClicked:function(t,a){return e.gridSquareClicked(t,a)},gridRectangleSelected:function(t,a,n,r){return e.gridRectangleSelected(t,a,n,r)}})));var p=[];this.props.combat.combatants.filter((function(e){return!e.pending&&e.active&&!e.defeated})).forEach((function(t){var a=t;a&&a.traits&&a.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))&&!a.current&&p.push(r.a.createElement("div",{className:"card monster",key:"leg "+a.id},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},a.name)),r.a.createElement("div",{className:"card-content"},r.a.createElement(ht,{combatant:a,mode:"legendary",useTrait:function(t){return e.props.useTrait(t)},rechargeTrait:function(t){return e.props.rechargeTrait(t)}}))))}));var h=this.state.middleColumnWidth,g=(24-h)/2;return r.a.createElement("div",{className:"full-height"},r.a.createElement(f.a,{align:"middle",className:"combat-top-row"},r.a.createElement(v.a,{span:g},r.a.createElement("div",{className:"menu",onClick:function(){return e.toggleShowOptions()},role:"button"},r.a.createElement(Jt.a,{title:"options"}),r.a.createElement("span",null,"options"))),r.a.createElement(v.a,{span:h},this.props.combat.combatants.find((function(e){return e.current}))?r.a.createElement("div",{className:"action"},r.a.createElement("button",{onClick:function(){return e.nextTurn()}},"next turn")):null),r.a.createElement(v.a,{span:g},r.a.createElement(f.a,null,r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"information"},r.a.createElement("div",null,"round"),r.a.createElement("div",{className:"information-value"},this.props.combat.round))),r.a.createElement(v.a,{span:12},r.a.createElement("div",{className:"information"},r.a.createElement("div",{className:"information-value"},z.getCombatXP(this.props.combat)),r.a.createElement("div",null,"xp")))))),r.a.createElement(f.a,{className:"combat-main"},r.a.createElement(v.a,{span:g,className:"scrollable"},this.getOptions(),r.a.createElement(Tt,{heading:"initiative holder",content:[l],columns:1,showToggle:!1})),r.a.createElement(v.a,{span:h,className:"scrollable"},r.a.createElement(Tt,{heading:"waiting for intiative",content:s,columns:1,showToggle:!0}),r.a.createElement(Tt,{heading:"legendary actions",content:p,columns:1,showToggle:!0}),r.a.createElement(Tt,{heading:"encounter map",content:[m],columns:1,showToggle:!0}),r.a.createElement(Tt,{heading:"initiative order",content:[c],columns:1,showToggle:!0})),r.a.createElement(v.a,{span:g,className:"scrollable"},r.a.createElement(Tt,{heading:"not on the map",content:[u],columns:1,showToggle:!0}),r.a.createElement(Tt,{heading:"selected",content:[this.getSelectedCombatants()],columns:1}))),this.getPlayerView())}catch(y){return console.error(y),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),hn=a(303),fn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.resumeCombat(e.props.combat)}},"resume combat"),r.a.createElement(rt,{text:"delete combat",onConfirm:function(){return e.props.deleteCombat(e.props.combat)}}))}}]),a}(r.a.Component),vn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getValue",value:function(e){var t,a,n;switch(e.type){case"pc":return r.a.createElement("div",{className:"value"},"pc");case"monster":var s=null!==(t=e.hpCurrent)&&void 0!==t?t:0,o=null!==(a=e.hpMax)&&void 0!==a?a:0,i=null!==(n=e.hpTemp)&&void 0!==n?n:0,c=s.toString();return i>0&&(c+="+"+i),s<o&&(c+=" / "+o),r.a.createElement("div",{className:"value"},c," hp")}return null}},{key:"render",value:function(){var e=this;try{var t=null;this.props.combat.map&&(t=r.a.createElement("div",{className:"section"},r.a.createElement(xe,{map:this.props.combat.map,fog:this.props.combat.fog,combatants:this.props.combat.combatants})));var a=this.props.combat.combatants.filter((function(e){return e.active})).filter((function(e){return"placeholder"!==e.type})).map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)},role:"button"},r.a.createElement(ae,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},t.displayName),e.getValue(t))}));return r.a.createElement("div",{className:"card encounter"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.combat.name||"unnamed combat")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement("div",{className:"section"},"paused at round ",this.props.combat.round),t,r.a.createElement("div",{className:"subheading"},"initiative order"),a),r.a.createElement("hr",null),r.a.createElement(fn,{combat:this.props.combat,resumeCombat:function(t){return e.props.resumeCombat(t)},deleteCombat:function(t){return e.props.deleteCombat(t)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),gn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={cloneName:e.encounter.name+" copy"},n}return Object(c.a)(a,[{key:"setCloneName",value:function(e){this.setState({cloneName:e})}},{key:"render",value:function(){var e=this;try{var t=null;return this.props.parties.length>0&&(t=r.a.createElement(ce,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start combat with...",onSelect:function(t){return e.props.startEncounter(t,e.props.encounter.id)}})),r.a.createElement("div",null,r.a.createElement(me,{text:"copy encounter"},r.a.createElement(ie,{text:this.state.cloneName,placeholder:"encounter name",onChange:function(t){return e.setCloneName(t)}}),r.a.createElement("button",{onClick:function(){return e.props.cloneEncounter(e.props.encounter,e.state.cloneName)}},"create copy")),t,r.a.createElement(rt,{text:"delete encounter",onConfirm:function(){return e.props.deleteEncounter(e.props.encounter)}}))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),yn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getText",value:function(e){var t="";if(""!==e.monsterID){var a=this.props.getMonster(e.monsterID);a&&(t=a.name),t=t||"unnamed monster"}else t=e.roles.join(", ");return r.a.createElement("div",{className:"name"},t)}},{key:"getValue",value:function(e){var t="";return e.count>1&&(t&&(t+=" "),t+="x"+e.count),"foe"!==e.faction&&(t&&(t+=" "),t+="("+e.faction+")"),t?r.a.createElement("div",{className:"value"},t):null}},{key:"getPortrait",value:function(e){var t=this.props.getMonster(e.monsterID);return t&&t.portrait?r.a.createElement(ae,{source:t,inline:!0}):null}},{key:"render",value:function(){var e=this;try{var t=this.props.encounter.slots.map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)},role:"button"},e.getPortrait(t),e.getText(t),e.getValue(t))}));return 0===t.length&&t.push(r.a.createElement("div",{key:"empty",className:"section"},"no monsters")),this.props.encounter.waves.forEach((function(a){t.push(r.a.createElement("div",{key:"name "+a.id,className:"section subheading"},a.name||"unnamed wave")),a.slots.forEach((function(a){t.push(r.a.createElement("div",{key:a.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(a)},role:"button"},e.getPortrait(a),e.getText(a),e.getValue(a)))})),0===t.length&&t.push(r.a.createElement("div",{key:"empty "+a.id,className:"section"},"no monsters"))})),r.a.createElement("div",{className:"card encounter"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.encounter.name||"unnamed encounter")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement("div",{className:"subheading"},"monsters"),t,r.a.createElement("div",{className:"subheading"},"xp"),z.getEncounterXP(this.props.encounter,null,this.props.getMonster)),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.openEncounter(e.props.encounter)}},"open encounter"),r.a.createElement(me,{text:"more options"},r.a.createElement(gn,{encounter:this.props.encounter,parties:this.props.parties,cloneEncounter:function(t,a){return e.props.cloneEncounter(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},deleteEncounter:function(t){return e.props.deleteEncounter(t)}}))))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),bn=a(273),En=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={xp:1e3,filter:w.createMonsterFilter()},n}return Object(c.a)(a,[{key:"setXP",value:function(e){this.setState({xp:Math.max(0,e)})}},{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:w.createMonsterFilter()})}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addEncounter(null)}},"add a new encounter"),r.a.createElement(me,{text:"create a random encounter"},r.a.createElement("p",null,"add random monsters to this encounter until its (effective) xp value is at least the following value"),r.a.createElement(bn.a,{value:this.state.xp,min:0,step:1e3,onChange:function(t){var a=parseInt((null!==t&&void 0!==t?t:0).toString(),10);e.setXP(a)}}),r.a.createElement("hr",null),r.a.createElement(ge,{filter:this.state.filter,prefix:"use",showName:!1,showRoles:!1,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.createEncounter(e.state.xp,e.state.filter)}},"build encounter")),r.a.createElement(me,{text:"use an encounter template"},r.a.createElement(Be,{items:z.encounterTemplates().map((function(e){return{id:e.name,text:e.name}})),selectedItemID:null,onSelect:function(t){return e.props.addEncounter(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),kn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"openStatBlock",value:function(e){var t=this.props.getMonster(e.monsterID);t&&this.props.openStatBlock(t)}},{key:"render",value:function(){var e=this;try{if(!this.props.hasMonsters)return r.a.createElement(f.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement("div",{style:{width:"400px"}},r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"this screen is for building encounters, but before you can do that you need to do these things first:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("span",{className:this.props.hasMonsters?"strikethrough":""},"add some monsters in the ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.setView("library")}},"monsters screen")),this.props.hasMonsters?r.a.createElement(hn.a,{title:"done",style:{marginLeft:"5px"}}):null)))));var t=this.props.combats;k.sort(t);var a=t.map((function(t){return r.a.createElement(vn,{key:t.id,combat:t,resumeCombat:function(t){return e.props.resumeCombat(t)},deleteCombat:function(t){return e.props.deleteCombat(t)},openStatBlock:function(t){return e.props.openStatBlock(t)}})})),n=this.props.encounters;k.sort(n);var s=n.map((function(t){return r.a.createElement(yn,{key:t.id,encounter:t,parties:e.props.parties,openEncounter:function(t){return e.props.openEncounter(t)},deleteEncounter:function(t){return e.props.deleteEncounter(t)},cloneEncounter:function(t,a){return e.props.cloneEncounter(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},openStatBlock:function(t){return e.openStatBlock(t)},getMonster:function(t){return e.props.getMonster(t)}})}));return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"on this page you can set up encounters"),r.a.createElement("div",{className:"section"},"when you have created an encounter you can add monsters to it, then gauge its difficulty for a party of pcs"),r.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can then run the encounter"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see the encounters that you have created"),r.a.createElement("div",{className:"section"},"select an encounter from the list to add monsters to it"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start building an encounter, press the ",r.a.createElement("b",null,"add a new encounter")," button")),r.a.createElement(En,{createEncounter:function(t,a){return e.props.createEncounter(t,a)},addEncounter:function(t){return e.props.addEncounter(t)}})),r.a.createElement(v.a,{span:18,className:"scrollable"},r.a.createElement(Tt,{heading:"in progress",content:a}),r.a.createElement(Tt,{heading:"encounters",content:s})))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),wn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t="monster",a=null,n=[];if(this.props.monster){t=this.props.monster.name;var s=[],o=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();this.props.monster.tag&&(o+=" ("+this.props.monster.tag.toLowerCase()+")"),s.push(r.a.createElement($.a,{key:"tag-main"},o)),this.props.monster.alignment&&s.push(r.a.createElement($.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),s.push(r.a.createElement($.a,{key:"tag-cr"},"cr ",C.challenge(this.props.monster.challenge))),a=r.a.createElement("div",{className:"stats"},r.a.createElement(ae,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},s)),n.push(r.a.createElement("button",{key:"view",onClick:function(){return e.props.showStatblock(e.props.monster)}},"statblock"))}else a=r.a.createElement(Pe,{white:!0},r.a.createElement("div",{className:"section"},"this empty slot has been added because you are creating an encounter from a template"),r.a.createElement("div",{className:"section"},"when you press ",r.a.createElement("b",null,"choose a monster")," you will be able to select a monster of this type:"),r.a.createElement("div",{className:"section centered"},r.a.createElement("b",null,this.props.slot.roles.join(", ")))),n.push(r.a.createElement("button",{key:"select",onClick:function(){return e.props.chooseMonster(e.props.slot)}},"choose a monster"));if(this.props.encounter.waves.length>0){var i=[];this.props.encounter.slots.includes(this.props.slot)||i.push({id:"",text:"main encounter"}),this.props.encounter.waves.forEach((function(t){t.slots.includes(e.props.slot)||i.push({id:t.id,text:t.name})})),n.push(r.a.createElement(ce,{key:"move",placeholder:"move to...",options:i,onSelect:function(t){var a=e.props.encounter.waves.find((function(e){return e.id===t}))||null;e.props.moveToWave(e.props.slot,a)}}))}return r.a.createElement("div",{className:"card "+this.props.slot.faction},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},t)),r.a.createElement("div",{className:"card-content"},a,r.a.createElement("hr",null),r.a.createElement(fe,{value:this.props.slot.count,label:"count",downEnabled:this.props.slot.count>1,onNudgeValue:function(t){return e.props.nudgeValue(e.props.slot,"count",t)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},n,r.a.createElement(ce,{options:["foe","neutral","ally"].map((function(e){return{id:e,text:e}})),selectedID:this.props.slot.faction,onSelect:function(t){return e.props.changeValue(e.props.slot,"faction",t)}}),r.a.createElement(rt,{text:"remove",onConfirm:function(){return e.props.deleteEncounterSlot(e.props.slot)}}))))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component);(new Ne.a.Converter).setOption("tables",!0);var Nn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:"monsters"},n}return Object(c.a)(a,[{key:"setView",value:function(e){this.setState({view:e})}},{key:"getMonsterCards",value:function(e){var t=this,a=[],n=e?e.slots:this.props.encounter.slots;return n.forEach((function(n){a.push(r.a.createElement(wn,{slot:n,monster:t.props.getMonster(n.monsterID),encounter:t.props.encounter,changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeValue:function(e,a,n){return t.props.nudgeValue(e,a,n)},chooseMonster:function(a){return t.props.chooseMonster(t.props.encounter,a,e)},deleteEncounterSlot:function(a){return t.props.deleteEncounterSlot(t.props.encounter,a,e)},moveToWave:function(a,n){return t.props.moveEncounterSlot(t.props.encounter,a,e,n)},showStatblock:function(e){return t.props.showStatblock(e)}}))})),0===n.length&&(e?a.push(r.a.createElement(Pe,null,"there are no monsters in this wave")):a.push(r.a.createElement(Pe,null,r.a.createElement("p",null,"there are no monsters in this encounter"),r.a.createElement("p",null,"click the button below to add monsters")))),a}},{key:"render",value:function(){var e=this;try{var t=this.props.encounter.waves.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},r.a.createElement(ie,{text:t.name,placeholder:"wave name",onChange:function(a){return e.props.changeValue(t,"name",a)}}),r.a.createElement(rt,{text:"delete wave",onConfirm:function(){return e.props.deleteWave(e.props.encounter,t)}}))})),a=null;this.props.encounter.slots.some((function(e){return e.roles.length>0&&""===e.monsterID}))&&(a=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.populateEncounter(e.props.encounter)}},"choose monsters")));var n=this.props.encounter.waves.map((function(t){return r.a.createElement("div",{key:t.id},r.a.createElement(Tt,{heading:t.name||"unnamed wave",content:e.getMonsterCards(t),columns:3}),r.a.createElement(f.a,null,r.a.createElement(v.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.chooseMonster(e.props.encounter,null,t)}},"add monsters to this wave"))))})),s=null;switch(this.state.view){case"monsters":s=r.a.createElement("div",null,r.a.createElement(Tt,{heading:"encounter",content:this.getMonsterCards(null),columns:3}),r.a.createElement(f.a,null,r.a.createElement(v.a,{span:8},r.a.createElement("button",{onClick:function(){return e.props.chooseMonster(e.props.encounter,null,null)}},"add monsters to the encounter"))),n);break;case"notes":s=r.a.createElement("div",null,r.a.createElement(Tt,{columns:1,content:[r.a.createElement(ie,{key:"notes",text:this.props.encounter.notes,placeholder:"notes",multiLine:!0,onChange:function(t){return e.props.changeValue(e.props.encounter,"notes",t)}})],heading:"notes"}))}return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"encounter name"),r.a.createElement(ie,{text:this.props.encounter.name,placeholder:"encounter name",onChange:function(t){return e.props.changeValue(e.props.encounter,"name",t)}})),r.a.createElement("hr",null),r.a.createElement(Y,{options:["monsters","notes"].map((function(e){return{id:e,text:e}})),selectedID:this.state.view,onSelect:function(t){return e.setView(t)}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"waves"),t,r.a.createElement("button",{onClick:function(){return e.props.addWave(e.props.encounter)}},"add a new wave")),r.a.createElement("hr",null),r.a.createElement(ve,{encounter:this.props.encounter,parties:this.props.parties,getMonster:function(t){return e.props.getMonster(t)}}),r.a.createElement("hr",null),r.a.createElement(gn,{encounter:this.props.encounter,parties:this.props.parties,cloneEncounter:function(t,a){return e.props.cloneEncounter(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},deleteEncounter:function(t){return e.props.deleteEncounter(t)}}),a,r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(_e.a,{style:{fontSize:"10px"}})," back to the list")),r.a.createElement(v.a,{span:18,className:"scrollable"},s))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Cn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={showOptions:!1,playerViewOpen:!1,addingToMapID:null,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null,selectedItemIDs:[],selectedAreaID:null},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("beforeunload",(function(){e.setPlayerViewOpen(!1)}))}},{key:"componentDidUpdate",value:function(){"exploration"===W.data.shared.type&&(W.data.shared.additional={selectedAreaID:this.state.selectedAreaID,highlightedSquare:this.state.highlightedSquare},J.sendSharedDiffUpdate())}},{key:"toggleShowOptions",value:function(){this.setState({showOptions:!this.state.showOptions})}},{key:"setPlayerViewOpen",value:function(e){this.setState({playerViewOpen:e})}},{key:"setAddingToMapID",value:function(e){this.setState({addingToMapID:e,addingOverlay:!1,editFog:!1,highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleEditFog",value:function(){this.setState({addingOverlay:!1,editFog:!this.state.editFog,selectedItemIDs:[],highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleAddingOverlay",value:function(){this.setState({addingOverlay:!this.state.addingOverlay,editFog:!1,selectedItemIDs:[],highlightMapSquare:!1,highlightedSquare:null})}},{key:"toggleHighlightMapSquare",value:function(){this.setState({addingOverlay:!1,editFog:!1,selectedItemIDs:[],highlightMapSquare:!this.state.highlightMapSquare,highlightedSquare:null})}},{key:"setHighlightedSquare",value:function(e,t,a){this.state.highlightMapSquare&&!a&&this.setState({highlightedSquare:{x:e,y:t}})}},{key:"setSelectedItemIDs",value:function(e){this.setState({editFog:!(e.length>0)&&this.state.editFog,selectedItemIDs:e})}},{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"addCompanion",value:function(e){var t=this;this.setState({selectedItemIDs:[e.id]},(function(){return t.props.addCompanion(e)}))}},{key:"toggleItemSelection",value:function(e,t){if(e&&t){var a=this.state.selectedItemIDs;if(a.includes(e)){var n=a.indexOf(e);a.splice(n,1)}else a.push(e);this.setSelectedItemIDs(a)}else this.setSelectedItemIDs(e?[e]:[])}},{key:"mapRemove",value:function(e){var t=this;this.setState({selectedItemIDs:[]},(function(){return t.props.mapRemove(e.map((function(e){return e.id})))}))}},{key:"nudgeValue",value:function(e,t,a){var n=null;switch(t){case"challenge":n=C.nudgeChallenge(e[t],a);break;case"size":case"displaySize":n=C.nudgeSize(e[t],a);break;default:n=e[t]+a}this.props.changeValue(e,t,n)}},{key:"fillFog",value:function(){if(this.props.exploration.map){var e=[],t=R.mapDimensions(this.props.exploration.map.items);if(t){for(var a=t.minX;a<=t.maxX;++a)for(var n=t.minY;n<=t.maxY;++n)e.push({x:a,y:n});this.props.setFog(e)}}}},{key:"clearFog",value:function(){this.props.setFog([])}},{key:"gridSquareClicked",value:function(e,t,a){var n=this;if(this.state.addingToMapID){var r=this.props.exploration.combatants.find((function(e){return e.id===n.state.addingToMapID}));r&&this.props.mapAdd(r,e,t),this.setAddingToMapID(null)}if(this.state.addingOverlay){var s=w.createMapItem();s.type="token",s.x=e,s.y=t,s.width=1,s.height=1,s.color="#005080",s.opacity=127,s.style="square",this.props.addOverlay(s),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[s.id]})}this.state.editFog&&!a&&this.gridRectangleSelected(e,t,e,t)}},{key:"gridRectangleSelected",value:function(e,t,a,n){if(this.state.addingOverlay){var r=w.createMapItem();r.type="overlay",r.x=e,r.y=t,r.width=a-e+1,r.height=n-t+1,r.color="#005080",r.opacity=127,r.style="square",this.props.addOverlay(r),this.setState({addingOverlay:!1,addingToMapID:null,selectedItemIDs:[r.id]})}if(this.state.editFog){for(var s=this.props.exploration.fog,o=function(e){for(var a=function(t){var a=s.findIndex((function(a){return a.x===e&&a.y===t}));-1===a?s.push({x:e,y:t}):s.splice(a,1)},r=t;r<=n;++r)a(r)},i=e;i<=a;++i)o(i);this.props.setFog(s)}}},{key:"getPlayerView",value:function(){var e=this;return this.state.playerViewOpen?r.a.createElement(ya,{title:"Map",onCloseWindow:function(){return e.setPlayerViewOpen(!1)}},r.a.createElement("div",{className:"scrollable both-ways"},this.getMap(!0))):null}},{key:"getOptions",value:function(){var e=this;if(!this.state.showOptions)return null;var t=r.a.createElement("div",null,r.a.createElement("div",{className:"subheading"},"exploration"),r.a.createElement("button",{onClick:function(){return e.props.startCombat(e.props.exploration)}},"stop exploring and start combat"),r.a.createElement("button",{onClick:function(){return e.props.pauseExploration()}},"pause exploration"),r.a.createElement(rt,{text:"end exploration",onConfirm:function(){return e.props.endExploration(e.props.exploration)}}),r.a.createElement("div",{className:"subheading"},"map"),r.a.createElement(re,{label:"add token / overlay",checked:this.state.addingOverlay,onChecked:function(){return e.toggleAddingOverlay()}}),r.a.createElement("div",{className:"group-panel",style:{display:this.state.addingOverlay?"":"none"}},r.a.createElement(Pe,null,r.a.createElement("p",null,"click on a map square to add a token, or select a rectangle to add an overlay"))),r.a.createElement(re,{label:"highlight map square",checked:this.state.highlightMapSquare,onChecked:function(){return e.toggleHighlightMapSquare()}}),r.a.createElement("div",{className:"group-panel",style:{display:this.state.highlightMapSquare?"":"none"}},r.a.createElement(Pe,null,r.a.createElement("p",null,"use your mouse to indicate a square on the map"),r.a.createElement("p",null,"that square will be highlighted on the shared map as well"))),r.a.createElement(re,{label:"edit fog of war",checked:this.state.editFog,onChecked:function(){return e.toggleEditFog()}}),r.a.createElement("div",{className:"group-panel",style:{display:this.state.editFog?"":"none"}},r.a.createElement(Pe,null,r.a.createElement("p",null,"click on map squares to turn fog of war on and off"),r.a.createElement("p",null,"you can also click and drag to select an area")),r.a.createElement("button",{onClick:function(){return e.fillFog()}},"fill fog of war"),r.a.createElement("button",{className:0===this.props.exploration.fog.length?"disabled":"",onClick:function(){return e.clearFog()}},"clear fog of war")),r.a.createElement("button",{onClick:function(){return e.props.rotateMap()}},"rotate map"),r.a.createElement("div",{className:"subheading"},"sharing"),r.a.createElement(re,{label:"share in player view",checked:this.state.playerViewOpen,onChecked:function(t){return e.setPlayerViewOpen(t)}}),r.a.createElement(re,{label:"share in session",disabled:"started"!==J.getState(),checked:"exploration"===W.data.shared.type,onChecked:function(t){return t?J.shareExploration(e.props.exploration):J.shareNothing()}}));return r.a.createElement(Tt,{heading:"options",content:[t],columns:1})}},{key:"getMap",value:function(e){var t=this;return r.a.createElement(xe,{map:this.props.exploration.map,mode:e?"combat-player":"combat",viewport:R.getViewport(this.props.exploration.map,this.state.selectedAreaID),combatants:this.props.exploration.combatants,showGrid:(null!==this.state.addingToMapID||this.state.addingOverlay||this.state.editFog||this.state.highlightMapSquare)&&!e,selectedItemIDs:this.state.selectedItemIDs,fog:this.props.exploration.fog,focussedSquare:this.state.highlightedSquare,gridSquareEntered:function(a,n){return t.setHighlightedSquare(a,n,e)},gridSquareClicked:function(a,n){return t.gridSquareClicked(a,n,e)},gridRectangleSelected:function(e,a,n,r){return t.gridRectangleSelected(e,a,n,r)},itemSelected:function(e,a){return t.toggleItemSelection(e,a)},areaSelected:function(e){return t.setSelectedAreaID(e)}})}},{key:"getSelectedCombatants",value:function(){var e=this,t=this.state.selectedItemIDs.map((function(t){return e.props.exploration.combatants.find((function(e){return e.id===t}))})).filter((function(e){return!!e}));k.sort(t,[{field:"displayName",dir:"asc"}]);var a=t.filter((function(e){return"placeholder"===e.type}));if(a.length>0)return r.a.createElement("div",null,this.createCard(a[0]));if(t.length>0&&t.every((function(e){return e.current})))return r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"you've selected the current initiative holder"));if(1===t.length)return r.a.createElement("div",null,this.createControls(t),r.a.createElement("hr",null),this.createCard(t[0]));if(t.length>1)return r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"multiple combatants are selected:"),t.map((function(t){return r.a.createElement("div",{key:t.id,className:"group-panel"},t.displayName,r.a.createElement(p.a,{style:{float:"right",padding:"2px 0",fontSize:"14px"},onClick:function(){return e.toggleItemSelection(t.id,!0)}}))}))),this.createControls(t));if(this.props.exploration.map){var n=this.props.exploration.map.items.find((function(t){return t.id===e.state.selectedItemIDs[0]}));if(n)return r.a.createElement(sn,{item:n,moveMapItem:function(t,a){return e.props.mapMove([t.id],a)},deleteMapItem:function(t){return e.props.mapRemove([t.id])},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}})}return r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"select a map token to see its details here"))}},{key:"createControls",value:function(e){var t=this;return e.some((function(e){return"placeholder"===e.type}))?null:r.a.createElement(Ha,{combatants:e,allCombatants:this.props.exploration.combatants,map:this.props.exploration.map,defaultTab:"map",makeCurrent:function(e){return null},makeActive:function(e){return null},makeDefeated:function(e){return null},toggleTag:function(e,a){return t.props.toggleTag(e,a)},toggleCondition:function(e,a){return t.props.toggleCondition(e,a)},toggleHidden:function(e){return t.props.toggleHidden(e)},changeHP:function(e){return null},addCondition:function(e){return t.props.addCondition(e)},editCondition:function(e,a){return t.props.editCondition(e,a)},deleteCondition:function(e,a){return t.props.deleteCondition(e,a)},mapAdd:function(e){return t.setAddingToMapID(t.state.addingToMapID?null:e.id)},mapMove:function(e,a){return t.props.mapMove(e.map((function(e){return e.id})),a)},mapRemove:function(e){return t.mapRemove(e)},onChangeAltitude:function(e,a){return t.props.onChangeAltitude(e,a)},removeCombatants:null,addCompanion:function(e){return t.addCompanion(e)},changeValue:function(e,a,n){return t.props.changeValue(e,a,n)},nudgeValue:function(e,a,n){return t.nudgeValue(e,a,n)}})}},{key:"createCard",value:function(e){var t=this;switch(e.type){case"pc":return r.a.createElement(Rt,{pc:e});case"monster":return r.a.createElement(vt,{monster:e,combat:!0,showRollButtons:this.props.options.showMonsterDieRolls,useTrait:function(e){return t.props.useTrait(e)},rechargeTrait:function(e){return t.props.rechargeTrait(e)},onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}});case"companion":var a=null,n=e;return n.monsterID&&this.props.library.forEach((function(e){var s=e.monsters.find((function(e){return e.id===n.monsterID}));s&&(a=r.a.createElement(vt,{monster:s,combat:!0,showRollButtons:t.props.options.showMonsterDieRolls,useTrait:function(e){return t.props.useTrait(e)},rechargeTrait:function(e){return t.props.rechargeTrait(e)},onRollDice:function(e,a,n){return t.props.onRollDice(e,a,n)}}))})),a;case"placeholder":var s=[];return this.props.exploration.combatants.forEach((function(e){var a=e;a&&a.traits&&a.traits.some((function(e){return"lair"===e.type}))&&s.push(r.a.createElement("div",{className:"card monster",key:"lair "+a.id},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},a.name)),r.a.createElement("div",{className:"card-content"},r.a.createElement(ht,{combatant:a,mode:"lair",useTrait:function(e){return t.props.useTrait(e)},rechargeTrait:function(e){return t.props.rechargeTrait(e)}}))))})),s}return null}},{key:"render",value:function(){var e=this;try{var t=null,a=this.props.exploration.combatants.filter((function(t){return!e.props.exploration.map.items.find((function(e){return e.id===t.id}))}));a.length>0&&(t=r.a.createElement("div",null,r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"these pcs have not yet been placed on the map"),r.a.createElement("div",{className:"section"},"to place one on the map, click the ",r.a.createElement("b",null,"place on map")," button and then click on a map square"),r.a.createElement("div",{className:"section"},"or click ",r.a.createElement("button",{className:"link",onClick:function(){return e.props.scatterCombatants(a,e.state.selectedAreaID)}},"here")," to scatter them randomly")),a.map((function(t){return r.a.createElement(un,{key:t.id,combatant:t,addToMap:function(){return e.setAddingToMapID(t.id)}})}))));var n=null;return this.state.showOptions&&(n=r.a.createElement(v.a,{span:6,className:"scrollable"},this.getOptions())),r.a.createElement("div",{className:"full-height"},r.a.createElement(f.a,{align:"middle",className:"combat-top-row"},r.a.createElement(v.a,{span:6},r.a.createElement("div",{className:"menu",onClick:function(){return e.toggleShowOptions()},role:"button"},r.a.createElement(Jt.a,{title:"options"}),r.a.createElement("span",null,"options"))),r.a.createElement(v.a,{span:18})),r.a.createElement(f.a,{className:"combat-main"},n,r.a.createElement(v.a,{span:this.state.showOptions?12:18,className:"scrollable both-ways"},this.getMap(!1)),r.a.createElement(v.a,{span:6,className:"scrollable"},r.a.createElement(Tt,{heading:"not on the map",content:[t],columns:1,showToggle:!0}),r.a.createElement(Tt,{heading:"selected",content:[this.getSelectedCombatants()],columns:1})),this.getPlayerView()))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Sn=a(265),xn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){try{var e=r.a.createElement(Sn.a,{autoplay:!0,autoplaySpeed:1e4},r.a.createElement("div",{key:"prologue"},r.a.createElement("p",{className:"heading"},"welcome to ",r.a.createElement("span",{className:"app-name"},"dojo")),r.a.createElement("p",null,r.a.createElement("span",{className:"app-name"},"dojo")," is an app for dms of ",r.a.createElement("a",{href:"https://www.wizards.com/dnd",target:"_blank",rel:"noopener noreferrer"},"dungeons and dragons fifth edition")),r.a.createElement("p",null,"with ",r.a.createElement("span",{className:"app-name"},"dojo")," you can...")),r.a.createElement("div",{key:"monster"},r.a.createElement("p",{className:"heading"},"build unique, challenging monsters"),r.a.createElement("ul",null,r.a.createElement("li",null,"watch the stat block change as you design your monster"),r.a.createElement("li",null,"see a list of similar monsters to help kickstart your creativity (or show you typical stat values for the type of monster you're creating)"),r.a.createElement("li",null,"build an entirely random monster with a single click"),r.a.createElement("li",null,"easily import any monster from ",r.a.createElement("a",{href:"https://dnd.wizards.com/articles/features/basicrules",target:"_blank",rel:"noopener noreferrer"},"the basic rules")," or from ",r.a.createElement("a",{href:"https://www.dndbeyond.com",target:"_blank",rel:"noopener noreferrer"},"d&d beyond")),r.a.createElement("li",null,"supports legendary and mythic monsters"))),r.a.createElement("div",{key:"encounter"},r.a.createElement("p",{className:"heading"},"create rewarding encounters"),r.a.createElement("ul",null,r.a.createElement("li",null,"quickly add monsters to your encounter and see its xp value and difficulty level change"),r.a.createElement("li",null,"split your encounter into multiple waves"),r.a.createElement("li",null,"let ",r.a.createElement("span",{className:"app-name"},"dojo")," build a random encounter on the fly - or use one of its encounter templates to get started"))),r.a.createElement("div",{key:"map"},r.a.createElement("p",{className:"heading"},"design intricate tactical maps"),r.a.createElement("ul",null,r.a.createElement("li",null,"create a dungeon map by quickly adding rooms, doors, corridors, and stairs"),r.a.createElement("li",null,"for something a little more fancy, you can upload your own battlemap images - even animated images"),r.a.createElement("li",null,"generate an entire random dungeon map with one click"),r.a.createElement("li",null,"add fog of war and then show your maps to your players"))),r.a.createElement("div",{key:"combat"},r.a.createElement("p",{className:"heading"},"run combat without the book-keeping"),r.a.createElement("ul",null,r.a.createElement("li",null,"see the initiative list at a glance - and share it with players in a separate window"),r.a.createElement("li",null,"track monster hit points, rechargable actions, and legendary actions"),r.a.createElement("li",null,"track conditions, their durations, and the effects they impose"),r.a.createElement("li",null,"easily handle mounted combat"),r.a.createElement("li",null,"if you're using a tactical map, ",r.a.createElement("span",{className:"app-name"},"dojo")," keeps track of everyone's location"))),r.a.createElement("div",{key:"session"},r.a.createElement("p",{className:"heading"},"connect with your players"),r.a.createElement("ul",null,r.a.createElement("li",null,"use a dedicated player app to share information with your group"),r.a.createElement("li",null,"send messages (or links, or images, or die rolls) to the whole table - or whisper them to just one player"),r.a.createElement("li",null,"during combat, show the initiative order and the encounter map to your players, and let them control their own characters"),r.a.createElement("li",null,"each player can update their character's stats, so you don't have to"))),r.a.createElement("div",{key:"epilogue"},r.a.createElement("p",{className:"heading"},"to get started"),r.a.createElement("p",null,"use the buttons at the bottom of the screen to explore ",r.a.createElement("span",{className:"app-name"},"dojo"),"'s main features"),r.a.createElement("p",null,"the arrow at the top right gives you additional tools like a die roller, some useful random generators, and rules references")));return r.a.createElement(f.a,{align:"middle",justify:"center",className:"full-height"},e)}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),In=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.resumeExploration(e.props.exploration)}},"resume exploration"),r.a.createElement(rt,{text:"delete exploration",onConfirm:function(){return e.props.deleteExploration(e.props.exploration)}}))}}]),a}(r.a.Component),Mn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.exploration.name||"unnamed exploration")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement(xe,{map:this.props.exploration.map,fog:this.props.exploration.fog,combatants:this.props.exploration.combatants})),r.a.createElement("hr",null),r.a.createElement(In,{exploration:this.props.exploration,resumeExploration:function(t){return e.props.resumeExploration(t)},deleteExploration:function(t){return e.props.deleteExploration(t)}})))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),On=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={cloneName:e.map.name+" copy"},n}return Object(c.a)(a,[{key:"setCloneName",value:function(e){this.setState({cloneName:e})}},{key:"render",value:function(){var e=this;try{var t=null,a=null;return this.props.parties.length>0&&(t=r.a.createElement(ce,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start combat with...",onSelect:function(t){return e.props.startEncounter(t,e.props.map.id)}}),a=r.a.createElement(ce,{options:this.props.parties.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start exploration with...",onSelect:function(t){return e.props.startExploration(t,e.props.map.id)}})),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.editMap(e.props.map)}},"edit map"),r.a.createElement(me,{text:"copy map"},r.a.createElement(ie,{text:this.state.cloneName,placeholder:"map name",onChange:function(t){return e.setCloneName(t)}}),r.a.createElement("button",{onClick:function(){return e.props.cloneMap(e.props.map,e.state.cloneName)}},"create copy")),t,a,r.a.createElement(rt,{text:"delete map",onConfirm:function(){return e.props.deleteMap(e.props.map)}}))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Dn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card map"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.map.name||"unnamed map")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},r.a.createElement(xe,{map:this.props.map,showAreaNames:!0})),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.openMap(e.props.map)}},"open map"),r.a.createElement(me,{text:"more options"},r.a.createElement(On,{map:this.props.map,parties:this.props.parties,editMap:function(t){return e.props.editMap(t)},cloneMap:function(t,a){return e.props.cloneMap(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},startExploration:function(t,a){return e.props.startExploration(t,a)},deleteMap:function(t){return e.props.deleteMap(t)}}))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),jn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addMap()}},"add a new map"),r.a.createElement("button",{onClick:function(){return e.props.importMap()}},"import a map image"),r.a.createElement(me,{text:"create a random map"},r.a.createElement("button",{onClick:function(){return e.props.generateMap("dungeon")}},"create a dungeon map"),r.a.createElement("button",{onClick:function(){return e.props.generateMap("delve")}},"create a delve map")))}}]),a}(r.a.Component),Tn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.explorations;k.sort(t);var a=t.map((function(t){return r.a.createElement(Mn,{key:t.id,exploration:t,resumeExploration:function(t){return e.props.resumeExploration(t)},deleteExploration:function(t){return e.props.deleteExploration(t)}})})),n=this.props.maps;k.sort(n);var s=n.map((function(t){return r.a.createElement(Dn,{key:t.id,map:t,parties:e.props.parties,openMap:function(t){return e.props.openMap(t)},editMap:function(t){return e.props.editMap(t)},cloneMap:function(t,a){return e.props.cloneMap(t,a)},deleteMap:function(t){return e.props.deleteMap(t)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},startExploration:function(t,a){return e.props.startExploration(t,a)}})}));return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"on this page you can set up tactical maps"),r.a.createElement("div",{className:"section"},"when you have created a map you can explore it with a party of pcs, or use it in the combat manager"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see the maps you have created"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to design a new map, press the ",r.a.createElement("b",null,"add a new map")," button")),r.a.createElement(jn,{addMap:function(){return e.props.addMap()},importMap:function(){return e.props.importMap()},generateMap:function(t){return e.props.generateMap(t)}})),r.a.createElement(v.a,{span:18,className:"scrollable"},r.a.createElement(Tt,{heading:"in progress",content:a}),r.a.createElement(Tt,{heading:"maps",content:s})))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Pn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={selectedAreaID:null},n}return Object(c.a)(a,[{key:"setSelectedAreaID",value:function(e){this.setState({selectedAreaID:e})}},{key:"render",value:function(){var e=this;try{var t=null;if(this.state.selectedAreaID){var a=this.props.map.areas.find((function(t){return t.id===e.state.selectedAreaID}));a&&(t={minX:a.x,minY:a.y,maxX:a.x+a.width-1,maxY:a.y+a.height-1})}return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"map name"),r.a.createElement(ie,{text:this.props.map.name,placeholder:"map name",onChange:function(t){return e.props.changeValue(e.props.map,"name",t)}})),r.a.createElement("hr",null),r.a.createElement(On,{map:this.props.map,parties:this.props.parties,editMap:function(t){return e.props.editMap(t)},cloneMap:function(t,a){return e.props.cloneMap(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},startExploration:function(t,a){return e.props.startExploration(t,a)},deleteMap:function(t){return e.props.deleteMap(t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(_e.a,{style:{fontSize:"10px"}})," back to the list")),r.a.createElement(v.a,{span:18,className:"scrollable both-ways"},r.a.createElement(xe,{map:this.props.map,mode:"combat",viewport:t,showAreaNames:!0,areaSelected:function(t){return e.setSelectedAreaID(t)}})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Vn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(i.a)(this,a),n=t.call(this,e);var r=Math.round(e.monsterGroup.monsters.map((function(e){return e.challenge})).reduce((function(e,t){return e+t}),0)/e.monsterGroup.monsters.length),s=e.monsterGroup.monsters.map((function(e){return e.size})).filter((function(e,t,a){return a.indexOf(e)===t})),o=e.monsterGroup.monsters.map((function(e){return e.category})).filter((function(e,t,a){return a.indexOf(e)===t})),c=e.monsterGroup.monsters.map((function(e){return e.role})).filter((function(e,t,a){return a.indexOf(e)===t}));return n.state={cr:r,size:1===s.length?s[0]:null,type:1===o.length?o[0]:null,role:1===c.length?c[0]:null},n}return Object(c.a)(a,[{key:"getGenerator",value:function(){var e=this,t=x.map((function(e){return{id:e,text:e}})),a=I.map((function(e){return{id:e,text:e}})),n=M.map((function(e){return{id:e,text:e}})),s=[];return this.props.library.forEach((function(t){t.monsters.forEach((function(t){var a=!0;Math.abs(t.challenge-e.state.cr)>1&&(a=!1),e.state.size&&t.size!==e.state.size&&(a=!1),e.state.type&&t.category!==e.state.type&&(a=!1),e.state.role&&t.role!==e.state.role&&(a=!1),a&&s.push(t)}))})),r.a.createElement(me,{text:"create a random monster"},r.a.createElement(Pe,null,r.a.createElement("p",null,"create a random monster using existing monsters as templates"),r.a.createElement("p",null,"use the parameters below to specify the sort of monster you want to create")),r.a.createElement(fe,{label:"cr",value:C.challenge(this.state.cr),onNudgeValue:function(t){return e.setState({cr:C.nudgeChallenge(e.state.cr,t)})}}),r.a.createElement(ce,{options:t,selectedID:this.state.size,placeholder:"any size",onSelect:function(t){return e.setState({size:t})},onClear:function(){return e.setState({size:null})}}),r.a.createElement(ce,{options:a,selectedID:this.state.type,placeholder:"any type",onSelect:function(t){return e.setState({type:t})},onClear:function(){return e.setState({type:null})}}),r.a.createElement(ce,{options:n,selectedID:this.state.role,placeholder:"any role",onSelect:function(t){return e.setState({role:t})},onClear:function(){return e.setState({role:null})}}),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},r.a.createElement(f.a,null,r.a.createElement(v.a,{span:16},"number of monsters:"),r.a.createElement(v.a,{span:8,className:"right-value"},s.length))),r.a.createElement("hr",null),r.a.createElement("button",{className:s.length>2?"":"disabled",onClick:function(){var t=w.createMonster();t.name=T.capitalise(T.generateName()),D.spliceMonsters(t,s),e.props.addMonster(t)}},"create monster"))}},{key:"export",value:function(){var e=this.props.monsterGroup.name+".monstergroup";k.saveFile(e,this.props.monsterGroup)}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addMonster(null)}},"add a new monster"),r.a.createElement("button",{onClick:function(){return e.props.importMonster()}},"import a monster"),this.getGenerator(),r.a.createElement("button",{onClick:function(){return e.props.openDemographics(e.props.monsterGroup)}},"show demographics"),r.a.createElement("button",{onClick:function(){return e.export()}},"export group"),r.a.createElement(rt,{text:"delete group",onConfirm:function(){return e.props.deleteMonsterGroup(e.props.monsterGroup)}}))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),An=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getMonsters",value:function(){var e=this;return 0===this.props.group.monsters.length?r.a.createElement("div",{className:"section"},"no monsters"):this.props.group.monsters.map((function(t){return r.a.createElement("div",{key:t.id,className:"combatant-row",onClick:function(){return e.props.openStatBlock(t)},role:"button"},r.a.createElement(ae,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},t.name||"unnamed monster"),r.a.createElement("div",{className:"value"},"cr ",C.challenge(t.challenge)))}))}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.group.name||"unnamed group")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},this.getMonsters()),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.openMonsterGroup(e.props.group)}},"open group"),r.a.createElement(me,{text:"more options"},r.a.createElement(Vn,{monsterGroup:this.props.group,library:this.props.library,addMonster:function(t){return e.props.addMonster(t)},importMonster:function(){return e.props.importMonster()},openDemographics:function(t){return e.props.openDemographics(t)},deleteMonsterGroup:function(t){return e.props.deleteMonsterGroup(t)}}))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Rn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addMonsterGroup()}},"add a new monster group"),r.a.createElement("button",{onClick:function(){return e.props.importMonsterGroup()}},"import a monster group"),r.a.createElement("button",{onClick:function(){return e.props.openDemographics()}},"show demographics"))}}]),a}(r.a.Component),Ln=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{if(!this.props.hasMonsters)return r.a.createElement(f.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement("div",{style:{width:"400px"}},r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"to kickstart your monster collection, let's import all the monsters from the ",r.a.createElement("a",{href:"https://dnd.wizards.com/articles/features/systems-reference-document-srd",target:"_blank",rel:"noopener noreferrer"},"d&d system reference document")),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.addOpenGameContent()}},"import monsters"))));var t=this.props.library;k.sort(t);var a=t.map((function(t){return r.a.createElement(An,{key:t.id,group:t,library:e.props.library,openMonsterGroup:function(t){return e.props.openMonsterGroup(t)},addMonster:function(t){return e.props.addMonster(t)},importMonster:function(){return e.props.importMonster()},openDemographics:function(t){return e.props.openDemographics(t)},deleteMonsterGroup:function(t){return e.props.deleteMonsterGroup(t)},openStatBlock:function(t){return e.props.openStatBlock(t)}})}));return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"you can maintain your menagerie of monsters here"),r.a.createElement("div",{className:"section"},"you can then use these monsters to design combat encounters in the encounter builder"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see your monster groups"),r.a.createElement("div",{className:"section"},"select a monster group from the list to see stat blocks for monsters in that group"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start adding monsters, press the ",r.a.createElement("b",null,"add a new monster group")," button")),r.a.createElement(Rn,{addMonsterGroup:function(){return e.props.addMonsterGroup()},importMonsterGroup:function(){return e.props.importMonsterGroup()},openDemographics:function(){return e.props.openDemographics(null)}})),r.a.createElement(v.a,{span:18,className:"scrollable"},r.a.createElement(Tt,{heading:"monster groups",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),zn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={cloneName:e.monster.name+" copy"},n}return Object(c.a)(a,[{key:"setCloneName",value:function(e){this.setState({cloneName:e})}},{key:"export",value:function(){var e=this.props.monster.name+".monster";k.saveFile(e,this.props.monster)}},{key:"render",value:function(){var e=this;try{var t=[];return this.props.library.forEach((function(a){-1===a.monsters.indexOf(e.props.monster)&&t.push({id:a.id,text:a.name})})),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.viewMonster(e.props.monster)}},"statblock"),r.a.createElement("button",{onClick:function(){return e.props.editMonster(e.props.monster)}},"edit monster"),r.a.createElement("button",{onClick:function(){return e.export()}},"export monster"),r.a.createElement(me,{text:"copy monster"},r.a.createElement(ie,{text:this.state.cloneName,placeholder:"monster name",onChange:function(t){return e.setCloneName(t)}}),r.a.createElement("button",{onClick:function(){return e.props.cloneMonster(e.props.monster,e.state.cloneName)}},"create copy")),r.a.createElement(ce,{options:t,placeholder:"move to group...",onSelect:function(t){return e.props.moveToGroup(e.props.monster,t)}}),r.a.createElement(rt,{text:"delete monster",disabled:this.props.encounters.some((function(t){return z.encounterHasMonster(t,e.props.monster.id)})),onConfirm:function(){return e.props.deleteMonster(e.props.monster)}}))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),qn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getTags",value:function(){var e=[],t=(this.props.monster.size+" "+this.props.monster.category).toLowerCase();return this.props.monster.tag&&(t+=" ("+this.props.monster.tag.toLowerCase()+")"),e.push(r.a.createElement($.a,{key:"tag-main"},t)),this.props.monster.alignment&&e.push(r.a.createElement($.a,{key:"tag-align"},this.props.monster.alignment.toLowerCase())),e.push(r.a.createElement($.a,{key:"tag-cr"},"cr ",C.challenge(this.props.monster.challenge))),e}},{key:"render",value:function(){var e=this;try{var t=this.props.monster.name||"unnamed monster";return r.a.createElement("div",{className:"card monster"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:t},t)),r.a.createElement("div",{className:"card-content"},r.a.createElement(ae,{source:this.props.monster}),r.a.createElement("div",{className:"section centered"},this.getTags()),r.a.createElement("hr",null),r.a.createElement(zn,{monster:this.props.monster,library:this.props.library,encounters:this.props.encounters,viewMonster:function(t){return e.props.viewMonster(t)},editMonster:function(t){return e.props.editMonster(t)},deleteMonster:function(t){return e.props.deleteMonster(t)},cloneMonster:function(t,a){return e.props.cloneMonster(t,a)},moveToGroup:function(t,a){return e.props.moveToGroup(t,a)}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Fn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getSummary",value:function(){if(0===this.props.monsterGroup.monsters.length)return r.a.createElement("div",{className:"section centered"},r.a.createElement("i",null,"no monsters"));var e={min:30,max:0};this.props.monsterGroup.monsters.forEach((function(t){e.min=Math.min(e.min,t.challenge),e.max=Math.max(e.max,t.challenge)}));var t=e.min===e.max?C.challenge(e.min):C.challenge(e.min)+" - "+C.challenge(e.max);return r.a.createElement("div",{className:"group-panel"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"monsters")),r.a.createElement("div",{className:"section"},this.props.monsterGroup.monsters.length),r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"challenge rating")),r.a.createElement("div",{className:"section"},t))}},{key:"render",value:function(){var e=this;try{var t=[];return 0!==this.props.monsterGroup.monsters.length?this.props.monsterGroup.monsters.forEach((function(a){t.push(r.a.createElement(qn,{monster:a,library:e.props.library,encounters:e.props.encounters,moveToGroup:function(t,a){return e.props.moveToGroup(t,a)},deleteMonster:function(t){return e.props.deleteMonster(t)},viewMonster:function(t){return e.props.viewMonster(t)},editMonster:function(t){return e.props.editMonster(t)},cloneMonster:function(t,a){return e.props.cloneMonster(t,a)}}))})):t.push(r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"there are no monsters in this group"))),r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"monster group name"),r.a.createElement(ie,{text:this.props.monsterGroup.name,placeholder:"monster group name",onChange:function(t){return e.props.changeValue(e.props.monsterGroup,"name",t)}})),r.a.createElement("hr",null),this.getSummary(),r.a.createElement("hr",null),r.a.createElement(Vn,{monsterGroup:this.props.monsterGroup,library:this.props.library,addMonster:function(t){return e.props.addMonster(t)},importMonster:function(){return e.props.importMonster()},openDemographics:function(t){return e.props.openDemographics(t)},deleteMonsterGroup:function(t){return e.props.deleteMonsterGroup(t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(_e.a,{style:{fontSize:"10px"}})," back to the list")),r.a.createElement(v.a,{span:18,className:"scrollable"},r.a.createElement(Tt,{content:t,heading:this.props.monsterGroup.name||"unnamed group"})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Gn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={difficulty:"medium",filter:w.createMonsterFilter()},n}return Object(c.a)(a,[{key:"setDifficulty",value:function(e){this.setState({difficulty:e})}},{key:"export",value:function(){var e=this.props.party.name+".party";k.saveFile(e,this.props.party)}},{key:"changeFilterValue",value:function(e,t){var a=this.state.filter;"challenge"===e?(a.challengeMin=t[0],a.challengeMax=t[1]):a[e]=t,this.setState({filter:a})}},{key:"resetFilter",value:function(){this.setState({filter:w.createMonsterFilter()})}},{key:"getXP",value:function(){var e=this,t=0;return this.props.party.pcs.filter((function(e){return e.active})).forEach((function(a){t+=C.pcExperience(a.level,e.state.difficulty)})),t}},{key:"render",value:function(){var e=this;try{var t=null;this.props.encounters.length>0&&(t=r.a.createElement(ce,{options:this.props.encounters.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start combat...",onSelect:function(t){return e.props.startEncounter(e.props.party.id,t)}}));var a=null;this.props.maps.length>0&&(a=r.a.createElement(ce,{options:this.props.maps.map((function(e){return{id:e.id,text:e.name}})),placeholder:"start exploration...",onSelect:function(t){return e.props.startExploration(e.props.party.id,t)}}));var n=null;return this.props.party.pcs.length>0&&(n=r.a.createElement(me,{text:"create a random encounter"},r.a.createElement("p",null,"create a random encounter for this party"),r.a.createElement(fe,{label:"difficulty",value:this.state.difficulty,downEnabled:"easy"!==this.state.difficulty,upEnabled:"deadly"!==this.state.difficulty,onNudgeValue:function(t){return e.setDifficulty(C.nudgeDifficulty(e.state.difficulty,t))}}),r.a.createElement("hr",null),r.a.createElement(ge,{filter:this.state.filter,prefix:"use",showName:!1,showRoles:!1,changeValue:function(t,a){return e.changeFilterValue(t,a)},resetFilter:function(){return e.resetFilter()}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.createEncounter(e.getXP(),e.state.filter)}},"build encounter"))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addPC()}},"add a new pc"),r.a.createElement("button",{onClick:function(){return e.props.importPC()}},"import a pc"),r.a.createElement("button",{onClick:function(){return e.export()}},"export party"),t,a,n,r.a.createElement("button",{onClick:function(){return e.props.showReference(e.props.party)}},"show party reference"),r.a.createElement(rt,{text:"delete party",onConfirm:function(){return e.props.deleteParty(e.props.party)}}))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Bn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"getText",value:function(e){var t=e.name||"unnamed pc";return e.player&&(t+=" ("+e.player+")"),t}},{key:"getPCs",value:function(){var e=this;return 0===this.props.party.pcs.length?r.a.createElement("div",{className:"section"},"no pcs"):this.props.party.pcs.map((function(t){return r.a.createElement("div",{key:t.id,className:t.active?"combatant-row":"combatant-row inactive",onClick:function(){return e.props.openStatBlock(t)},role:"button"},r.a.createElement(ae,{source:t,inline:!0}),r.a.createElement("div",{className:"name"},e.getText(t)),r.a.createElement("div",{className:"value"},"lvl ",t.level))}))}},{key:"render",value:function(){var e=this;try{return r.a.createElement("div",{className:"card pc"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title"},this.props.party.name||"unnamed party")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"fixed-height"},this.getPCs()),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.openParty(e.props.party)}},"open party"),r.a.createElement(me,{text:"more options"},r.a.createElement(Gn,{party:this.props.party,encounters:this.props.encounters,maps:this.props.maps,addPC:function(){return e.props.addPC()},importPC:function(){return e.props.importPC()},createEncounter:function(t,a){return e.props.createEncounter(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},startExploration:function(t,a){return e.props.startExploration(t,a)},showReference:function(t){return e.props.showReference(t)},deleteParty:function(t){return e.props.deleteParty(t)}}))))}catch(t){return console.error(t),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Un=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.addParty()}},"add a new party"),r.a.createElement("button",{onClick:function(){return e.props.importParty()}},"import a party"))}}]),a}(r.a.Component),Hn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=this.props.parties;k.sort(t);var a=t.map((function(t){return r.a.createElement(Bn,{key:t.id,party:t,encounters:e.props.encounters,maps:e.props.maps,openParty:function(t){return e.props.openParty(t)},addPC:function(){return e.props.addPC()},importPC:function(){return e.props.importPC()},createEncounter:function(t,a){return e.props.createEncounter(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},startExploration:function(t,a){return e.props.startExploration(t,a)},showReference:function(t){return e.props.showReference(t)},openStatBlock:function(t){return e.props.openStatBlock(t)},deleteParty:function(t){return e.props.deleteParty(t)}})}));return r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"this page is where you can tell dojo all about your pcs"),r.a.createElement("div",{className:"section"},"you can add a party for each of your gaming groups"),r.a.createElement("div",{className:"section"},"when you have set up a party and an encounter you can run the encounter in the combat manager"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"on the right you will see the parties that you have created"),r.a.createElement("div",{className:"section"},"select a party from the list to see pc details"),r.a.createElement("hr",null),r.a.createElement("div",{className:"section"},"to start adding a party, press the ",r.a.createElement("b",null,"add a new party")," button")),r.a.createElement(Un,{addParty:function(){return e.props.addParty()},importParty:function(){return e.props.importParty()}})),r.a.createElement(v.a,{span:18,className:"scrollable"},r.a.createElement(Tt,{heading:"parties",content:a})))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Wn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"export",value:function(e){var t=e.name+".pc";k.saveFile(t,e)}},{key:"render",value:function(){var e=this;try{var t=null;this.props.pc.url&&(t=r.a.createElement("button",{onClick:function(){return e.props.updatePC(e.props.pc)}},"update pc from d&d beyond"));var a=null;return a=this.props.pc.active?r.a.createElement("button",{key:"toggle-active",onClick:function(){return e.props.changeValue(e.props.pc,"active",!1)}},"mark pc as inactive"):r.a.createElement("button",{key:"toggle-active",onClick:function(){return e.props.changeValue(e.props.pc,"active",!0)}},"mark pc as active"),r.a.createElement("div",null,r.a.createElement("button",{key:"edit",onClick:function(){return e.props.editPC(e.props.pc)}},"edit pc"),t,r.a.createElement("button",{key:"export",onClick:function(){return e.export(e.props.pc)}},"export pc"),a,r.a.createElement(rt,{key:"remove",text:"delete pc",onConfirm:function(){return e.props.removePC(e.props.pc)}}))}catch(n){return console.error(n),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Jn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;try{var t=(this.props.pc?this.props.pc.displayName:null)||this.props.pc.name||"unnamed pc";return r.a.createElement("div",{className:"card pc"},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{className:"title",title:t},t)),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"stats"},r.a.createElement(ae,{source:this.props.pc}),r.a.createElement("div",{className:"section centered lowercase"},r.a.createElement($.a,null,this.props.pc.race||"unknown race"),r.a.createElement($.a,null,this.props.pc.classes||"unknown class"),r.a.createElement($.a,null,"level "+this.props.pc.level)),r.a.createElement("div",{className:"section centered",style:{display:this.props.pc.url?"":"none"}},r.a.createElement("a",{href:this.props.pc.url,target:"_blank",rel:"noopener noreferrer"},"d&d beyond sheet"))),r.a.createElement("hr",null),r.a.createElement(Wn,{pc:this.props.pc,editPC:function(t){return e.props.editPC(t)},updatePC:function(t){return e.props.updatePC(t)},removePC:function(t){return e.props.deletePC(t)},changeValue:function(t,a,n){return e.props.changeValue(t,a,n)}})))}catch(a){return console.error(a),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),_n=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"componentDidUpdate",value:function(){W.data.party&&J.sendPartyUpdate()}},{key:"render",value:function(){var e=this;try{var t=this.props.party.pcs.filter((function(e){return e.active})),a=[];t.forEach((function(t){a.push(r.a.createElement(Jn,{pc:t,changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},editPC:function(t){return e.props.editPC(t)},updatePC:function(t){return e.props.updatePC(t)},deletePC:function(t){return e.props.deletePC(t)}}))}));var n=this.props.party.pcs.filter((function(e){return!e.active})),s=[];return n.forEach((function(t){s.push(r.a.createElement(Jn,{pc:t,changeValue:function(t,a,n){return e.props.changeValue(t,a,n)},editPC:function(t){return e.props.editPC(t)},updatePC:function(t){return e.props.updatePC(t)},deletePC:function(t){return e.props.deletePC(t)}}))})),0===t.length&&a.push(r.a.createElement(Pe,null,r.a.createElement("div",{className:"section"},"there are no pcs in this party"))),r.a.createElement(f.a,{className:"full-height"},r.a.createElement(v.a,{span:6,className:"scrollable sidebar sidebar-left"},r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"subheading"},"party name"),r.a.createElement(ie,{text:this.props.party.name,placeholder:"party name",onChange:function(t){return e.props.changeValue(e.props.party,"name",t)}})),r.a.createElement("hr",null),r.a.createElement(Gn,{party:this.props.party,encounters:this.props.encounters,maps:this.props.maps,addPC:function(){return e.props.addPC()},importPC:function(){return e.props.importPC()},createEncounter:function(t,a){return e.props.createEncounter(t,a)},startEncounter:function(t,a){return e.props.startEncounter(t,a)},startExploration:function(t,a){return e.props.startExploration(t,a)},showReference:function(t){return e.props.showReference(t)},deleteParty:function(t){return e.props.deleteParty(t)}}),r.a.createElement("hr",null),r.a.createElement("button",{onClick:function(){return e.props.goBack()}},r.a.createElement(_e.a,{style:{fontSize:"10px"}})," back to the list")),r.a.createElement(v.a,{span:18,className:"scrollable"},r.a.createElement(Tt,{content:a,heading:this.props.party.name||"unnamed party"}),r.a.createElement(Tt,{content:s,heading:"inactive pcs"})))}catch(o){return console.error(o),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Yn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(i.a)(this,a),(n=t.call(this,e)).monsterIdToGroup={},n.saveAfterDelay=k.debounce((function(){return n.saveAll()}),5e3);var r=[];try{var s=window.localStorage.getItem("data-parties");s&&(r=JSON.parse(s))}catch(E){console.error("Could not parse JSON: ",E)}var o=[];try{var c=window.localStorage.getItem("data-library");c&&(o=JSON.parse(c)).forEach((function(e){e.monsters.forEach((function(e){if(void 0===e.acInfo&&(e.acInfo=""),void 0===e.legendaryActions){var t=e.traits.some((function(e){return"legendary"===e.type||"mythic"===e.type}))?3:0;e.legendaryActions=t}e.role=D.getRole(e)}))}))}catch(E){console.error("Could not parse JSON: ",E)}var l=[];try{var u=window.localStorage.getItem("data-encounters");u&&(l=JSON.parse(u)).forEach((function(e){e.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})),e.waves.forEach((function(e){e.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}))}))}))}catch(E){console.error("Could not parse JSON: ",E)}var d=[];try{var m=window.localStorage.getItem("data-maps");m&&(d=JSON.parse(m)).forEach((function(e){void 0===e.areas&&(e.areas=[])}))}catch(E){console.error("Could not parse JSON: ",E)}var p=[];try{var h=window.localStorage.getItem("data-combats");h&&(p=JSON.parse(h)).forEach((function(e){e.combatants.forEach((function(e){if(void 0===e.faction)switch(e.type){case"pc":case"companion":e.faction="ally";break;case"monster":e.faction="foe";break;default:e.faction="neutral"}void 0===e.note&&(e.note=""),void 0===e.mountID&&(e.mountID=null),void 0===e.mountType&&(e.mountType="controlled")})),e.encounter&&(e.encounter.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")})),e.encounter.waves.forEach((function(e){e.slots.forEach((function(e){void 0===e.roles&&(e.roles=[]),void 0===e.faction&&(e.faction="foe")}))}))),e.map&&void 0===e.map.areas&&(e.map.areas=[]),void 0===e.fog&&(e.fog=[])}))}catch(E){console.error("Could not parse JSON: ",E)}var f=[];try{var v=window.localStorage.getItem("data-explorations");v&&(f=JSON.parse(v)).forEach((function(e){void 0===e.map.areas&&(e.map.areas=[])}))}catch(E){console.error("Could not parse JSON: ",E)}var g={showMonsterDieRolls:!1};try{var y=window.localStorage.getItem("data-options");y&&(g=JSON.parse(y))}catch(E){console.error("Could not parse JSON: ",E)}var b={};return[4,6,8,10,12,20,100].forEach((function(e){return b[e]=0})),b[20]=1,n.state={view:"home",drawer:null,sidebar:{visible:!1,type:"tools",subtype:"die",dice:b,constant:0,dieRolls:[],handout:null,languagePreset:null,selectedLanguages:[],languageOutput:[],draws:[],npc:null,selectedPartyID:null,selectedMonsterID:null},parties:r,library:o,encounters:l,maps:d,combats:p,explorations:f,options:g,selectedPartyID:null,selectedMonsterGroupID:null,selectedEncounterID:null,selectedMapID:null,selectedCombatID:null,selectedExplorationID:null},j.clearUnusedImages(d,p,f),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;b.a.bind("ctrl+f",(function(t){t.preventDefault(),e.setSidebar("search")})),J.onStateChanged=function(){return e.setState(e.state)},J.onDataChanged=function(){return e.setState(e.state)},J.onNewConnection=function(t){e.state.sidebar.visible&&"session"===e.state.sidebar.type&&"people"===e.state.sidebar.subtype||h.a.open({message:r.a.createElement("p",null,r.a.createElement("b",null,t)," has joined"),closeIcon:r.a.createElement(p.a,null),duration:5})},W.onNewMessage=function(t){e.state.sidebar.visible&&"session"===e.state.sidebar.type&&"messages"===e.state.sidebar.subtype||h.a.open({message:r.a.createElement(Ra,{user:"dm",message:t,openImage:function(t){return e.setState({drawer:{type:"image",data:t}})}}),closeIcon:r.a.createElement(p.a,null),duration:5})}}},{key:"componentWillUnmount",value:function(){b.a.unbind("ctrl+f"),J.onStateChanged=null,J.onDataChanged=null,J.onNewConnection=null,W.onNewMessage=null,J.shutdown()}},{key:"componentDidUpdate",value:function(){this.saveAfterDelay()}},{key:"setView",value:function(e){this.save(),this.setState({view:e})}},{key:"setSidebar",value:function(e){var t="";switch(e){case"tools":t="die";break;case"generators":t="name";break;case"reference":t="skills";break;case"session":t="management";break;case"about":t="dojo"}var a=this.state.sidebar;a.visible=!0,a.type=e,a.subtype=t,this.setState({sidebar:a})}},{key:"toggleSidebar",value:function(){var e=this.state.sidebar;e.visible=!e.visible,this.setState({sidebar:e})}},{key:"closeDrawer",value:function(){this.setState({drawer:null})}},{key:"selectParty",value:function(e){this.setState({selectedPartyID:e?e.id:null})}},{key:"selectMonsterGroup",value:function(e){this.setState({selectedMonsterGroupID:e?e.id:null})}},{key:"selectEncounter",value:function(e){this.setState({selectedEncounterID:e?e.id:null})}},{key:"selectMap",value:function(e){this.setState({selectedMapID:e?e.id:null})}},{key:"selectPartyByID",value:function(e){this.save(),this.setState({view:"parties",selectedPartyID:e})}},{key:"selectMonsterGroupByID",value:function(e){this.save(),this.setState({view:"library",selectedMonsterGroupID:e})}},{key:"selectEncounterByID",value:function(e){this.save(),this.setState({view:"encounters",selectedEncounterID:e,selectedCombatID:null})}},{key:"selectMapByID",value:function(e){this.save(),this.setState({view:"maps",selectedMapID:e,selectedExplorationID:null})}},{key:"selectCombatByID",value:function(e){this.save(),this.setState({view:"encounters",selectedEncounterID:null,selectedCombatID:e})}},{key:"selectExplorationByID",value:function(e){this.save(),this.setState({view:"maps",selectedMapID:null,selectedExplorationID:e})}},{key:"setDice",value:function(e,t,a){var n={};[4,6,8,10,12,20,100].forEach((function(e){return n[e]=0})),n[t]=e;var r=this.state.sidebar;r.visible=!0,r.type="tools",r.subtype="die",r.dice=n,r.constant=a,this.setState({sidebar:r})}},{key:"getMonster",value:function(e){var t=this.monsterIdToGroup[e];t||(t=this.state.library.reduce((function(e,t){return e.concat(t.monsters)}),[]).find((function(t){return t.id===e}))||null)&&(this.monsterIdToGroup[e]=t);return t}},{key:"changeValue",value:function(e,t,a){for(var n=this,r=t.split("."),s=e,o=0;o!==r.length;++o){var i=r[o];o===r.length-1?s[i]=a:s=s[i]}if(k.sort(this.state.parties),k.sort(this.state.library),k.sort(this.state.encounters),k.sort(this.state.maps),k.sort(this.state.combats),k.sort(this.state.explorations),"initiative"===t&&!e.pending){var c=this.state.combats.find((function(e){return e.id===n.state.selectedCombatID}));z.sortCombatants(c)}if("hpCurrent"===t){var l=e;l.hpCurrent=Math.min(l.hpCurrent||0,l.hpMax||0),l.hpCurrent=Math.max(l.hpCurrent||0,0)}if("hpTemp"===t){var u=e;u.hpTemp=Math.max(u.hpTemp||0,0)}if("mountID"===t){var d=this.state.combats.find((function(e){return e.id===n.state.selectedCombatID}));d&&d.map&&z.setMountPositions(d.combatants,d.map)}this.setState({parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,combats:this.state.combats,explorations:this.state.explorations,selectedPartyID:this.state.selectedPartyID,selectedMonsterGroupID:this.state.selectedMonsterGroupID,selectedEncounterID:this.state.selectedEncounterID,selectedMapID:this.state.selectedMapID,selectedCombatID:this.state.selectedCombatID,selectedExplorationID:this.state.selectedExplorationID,drawer:this.state.drawer,sidebar:this.state.sidebar})}},{key:"nudgeValue",value:function(e,t,a){for(var n=t.split("."),r=e,s=0;s!==n.length;++s){var o=n[s];if(s===n.length-1){var i=null;switch(o){case"challenge":i=C.nudgeChallenge(r[o],a);break;case"size":case"displaySize":i=C.nudgeSize(r[o],a);break;default:i=r[o]+a}this.changeValue(e,t,i)}else r=r[o]}}},{key:"addParty",value:function(){var e=w.createParty();e.name="new party";var t=[].concat(this.state.parties,[e]);k.sort(t),this.setState({parties:t,selectedPartyID:e.id})}},{key:"deleteParty",value:function(e){var t=this.state.parties.indexOf(e);this.state.parties.splice(t,1),this.setState({parties:this.state.parties,selectedPartyID:null})}},{key:"importParty",value:function(){this.setState({drawer:{type:"import-party",party:w.createParty()}})}},{key:"acceptImportedParty",value:function(){this.state.parties.push(this.state.drawer.party),this.setState({parties:this.state.parties,drawer:null})}},{key:"showPartyReference",value:function(e){var t=this.state.sidebar;t.visible=!0,t.type="reference",t.subtype="party",t.selectedPartyID=e.id,this.setState({sidebar:t})}},{key:"deletePC",value:function(e){var t=this,a=this.state.parties.find((function(e){return e.id===t.state.selectedPartyID}));if(a){var n=a.pcs.indexOf(e);a.pcs.splice(n,1),this.setState({parties:this.state.parties})}}},{key:"editPC",value:function(e){e||((e=w.createPC()).name="new pc");var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"pc",pc:t}})}},{key:"importPC",value:function(){this.setState({drawer:{type:"import-pc",pc:w.createPC()}})}},{key:"acceptImportedPC",value:function(){var e=this,t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));t&&(t.pcs.push(this.state.drawer.pc),k.sort(t.pcs),this.setState({parties:this.state.parties,drawer:null}))}},{key:"updatePC",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"update-pc",pc:t}})}},{key:"savePC",value:function(){var e=this;k.sort(this.state.drawer.pc.companions);var t=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));if(t){var a=t.pcs.find((function(t){return t.id===e.state.drawer.pc.id}));if(a){var n=t.pcs.indexOf(a);t.pcs[n]=this.state.drawer.pc}else t.pcs.push(this.state.drawer.pc);k.sort(t.pcs),this.setState({parties:this.state.parties,drawer:null})}}},{key:"addMonsterGroup",value:function(){var e=w.createMonsterGroup();e.name="new group";var t=[].concat(this.state.library,[e]);k.sort(t),this.setState({library:t,selectedMonsterGroupID:e.id})}},{key:"importMonsterGroup",value:function(){this.setState({drawer:{type:"import-group",group:w.createMonsterGroup()}})}},{key:"acceptImportedGroup",value:function(){this.state.library.push(this.state.drawer.group),this.setState({library:this.state.library,drawer:null})}},{key:"deleteMonsterGroup",value:function(e){var t=this.state.library.indexOf(e);this.state.library.splice(t,1),this.setState({library:this.state.library,selectedMonsterGroupID:null})}},{key:"deleteMonster",value:function(e){var t=this,a=this.state.library.find((function(e){return e.id===t.state.selectedMonsterGroupID}));if(a){var n=a.monsters.indexOf(e);a.monsters.splice(n,1),this.setState({library:this.state.library})}}},{key:"importMonster",value:function(){this.setState({drawer:{type:"import-monster",monster:w.createMonster()}})}},{key:"acceptImportedMonster",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));t&&(t.monsters.push(this.state.drawer.monster),k.sort(t.monsters),this.setState({library:this.state.library,drawer:null}))}},{key:"moveToGroup",value:function(e,t){var a=this.state.library.find((function(t){return t.monsters.includes(e)}));if(a){var n=a.monsters.indexOf(e);a.monsters.splice(n,1);var r=this.state.library.find((function(e){return e.id===t}));r&&(r.monsters.push(e),k.sort(r.monsters),this.setState({library:this.state.library}))}}},{key:"addMonster",value:function(e){var t=this;if(e){var a=this.state.library.find((function(e){return e.id===t.state.selectedMonsterGroupID}));a&&(a.monsters.push(e),k.sort(a.monsters),this.setState({library:this.state.library,drawer:{type:"statblock",source:e}}))}else{(e=w.createMonster()).name="new monster";var n=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:n,monsterEditorSidebar:"sidebar"}})}}},{key:"editMonster",value:function(e){var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"monster",monster:t,monsterEditorSidebar:"statblock"}})}},{key:"saveMonster",value:function(){var e=this,t=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));if(t){var a=t.monsters.find((function(t){return t.id===e.state.drawer.monster.id}));if(a){var n=t.monsters.indexOf(a);t.monsters[n]=this.state.drawer.monster}else t.monsters.push(this.state.drawer.monster);k.sort(t.monsters),this.setState({library:this.state.library,drawer:null})}}},{key:"setMonsterEditorSidebar",value:function(e){var t=this.state.drawer;t.monsterEditorSidebar=e,this.setState({drawer:t})}},{key:"cloneMonster",value:function(e,t){var a=this.state.library.find((function(t){return t.monsters.includes(e)}));if(a){var n=JSON.parse(JSON.stringify(e));e.id=k.guid(),e.traits.forEach((function(e){return e.id=k.guid()})),e.name=t,a.monsters.push(n),k.sort(a.monsters),this.setState({library:this.state.library})}}},{key:"addOpenGameContent",value:function(){var e=this;fetch("/dojo/data/monsters.json").then((function(e){return e.json()})).then((function(t){t.forEach((function(t){try{if(t.name){var a=D.createFromJSON(t),n=a.tag||a.category;0===n.indexOf("swarm")&&(n="swarm"),"any race"===n&&(n="npc");var r=e.state.library.find((function(e){return e.name===n}));r||(r={id:k.guid(),name:n,monsters:[]},e.state.library.push(r)),r.monsters.push(a)}}catch(s){console.error(s)}})),k.sort(e.state.library),e.setState({library:e.state.library})}))}},{key:"openDemographics",value:function(e){this.setState({drawer:{type:"monster-demographics",group:e}})}},{key:"addEncounter",value:function(e){var t=w.createEncounter();if(t.name="new encounter",e){var a=z.encounterTemplates().find((function(t){return t.name===e}));a&&(t.name="new "+e+" encounter",t.slots=a.slots.map((function(e){var t=w.createEncounterSlot();return t.roles=e.roles,t.count=e.count,t})),t.waves=[])}var n=[].concat(this.state.encounters,[t]);k.sort(n),this.setState({view:"encounters",encounters:n,selectedEncounterID:t.id})}},{key:"createEncounter",value:function(e,t){var a=this,n=w.createEncounter();n.name="new encounter",z.buildEncounter(n,e,t,this.state.library,(function(e){return a.getMonster(e)})),z.sortEncounter(n);var r=[].concat(this.state.encounters,[n]);k.sort(r),this.setState({view:"encounters",encounters:r,selectedEncounterID:n.id})}},{key:"cloneEncounter",value:function(e,t){var a=JSON.parse(JSON.stringify(e));a.id=k.guid(),a.slots.forEach((function(e){return e.id=k.guid()})),a.waves.forEach((function(e){e.id=k.guid(),e.slots.forEach((function(e){return e.id=k.guid()}))})),a.name=t,this.state.encounters.push(a),k.sort(this.state.encounters),this.setState({encounters:this.state.encounters})}},{key:"deleteEncounter",value:function(e){var t=this.state.encounters.indexOf(e);this.state.encounters.splice(t,1),this.setState({encounters:this.state.encounters,selectedEncounterID:null})}},{key:"addToEncounterSlot",value:function(e,t,a,n,r){var s=t?t.slots:e.slots;if(a||(a=w.createEncounterSlot(),s.push(a)),this.state.library.find((function(e){return e.monsters.includes(n)}))){a.monsterID=n.id,z.sortEncounter(e);var o=this.state.drawer;r?o=null:o.monster=null,this.setState({encounters:this.state.encounters,drawer:o})}}},{key:"generateMap",value:function(e){var t=w.createMap();t.name="new "+e,R.generate(e,t),this.state.maps.push(t),this.setState({maps:this.state.maps})}},{key:"editMap",value:function(e){e||((e=w.createMap()).name="new map");var t=JSON.parse(JSON.stringify(e));this.setState({drawer:{type:"map-edit",map:t}})}},{key:"cloneMap",value:function(e,t){var a=JSON.parse(JSON.stringify(e));a.id=k.guid(),a.items.forEach((function(e){return e.id=k.guid()})),a.areas.forEach((function(e){return e.id=k.guid()})),a.name=t,this.state.maps.push(a),k.sort(this.state.maps),this.setState({maps:this.state.maps})}},{key:"saveMap",value:function(){var e=this,t=this.state.maps,a=this.state.maps.find((function(t){return t.id===e.state.drawer.map.id}));a?t[this.state.maps.indexOf(a)]=this.state.drawer.map:t.push(this.state.drawer.map);k.sort(t),this.setState({maps:t,drawer:null})}},{key:"importMap",value:function(){var e=w.createMap();this.setState({drawer:{type:"import-map",map:e}})}},{key:"acceptImportedMap",value:function(){this.state.maps.push(this.state.drawer.map),this.setState({maps:this.state.maps,drawer:null})}},{key:"declineImportedMap",value:function(){if(this.state.drawer.map.items.length>0){var e=this.state.drawer.map.items[0].customBackground;window.localStorage.removeItem("image-"+e)}this.closeDrawer()}},{key:"deleteMap",value:function(e){var t=this.state.maps.indexOf(e);this.state.maps.splice(t,1),this.setState({maps:this.state.maps,selectedMapID:null})}},{key:"startExploration",value:function(e,t){var a=this.state.parties.find((function(e){return e.id===t}));if(a){var n=JSON.parse(JSON.stringify(e)),r=w.createExploration();r.name=a.name+" in "+e.name,r.map=n,r.partyID=t,a.pcs.forEach((function(e){var t=z.convertPCToCombatant(e);r.combatants.push(t)})),this.state.explorations.push(r),this.setState({view:"maps",explorations:this.state.explorations,selectedExplorationID:r.id})}}},{key:"pauseExploration",value:function(){"exploration"===W.data.shared.type&&J.shareNothing(),this.setState({selectedExplorationID:null})}},{key:"resumeExploration",value:function(e){this.setState({view:"maps",selectedExplorationID:e.id})}},{key:"endExploration",value:function(e){"exploration"===W.data.shared.type&&J.shareNothing();var t=this.state.explorations.indexOf(e);this.state.explorations.splice(t,1),this.setState({explorations:this.state.explorations,selectedExplorationID:null})}},{key:"addCompanionToExploration",value:function(e){var t=this,a=this.state.explorations.find((function(e){return e.id===t.state.selectedExplorationID}));a&&(a.combatants.push(z.convertCompanionToCombatant(e)),k.sort(a.combatants,[{field:"displayName",dir:"asc"}]),this.setState({explorations:this.state.explorations}))}},{key:"createCombat",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=1===this.state.parties.length?this.state.parties[0]:null;if(e){var o=this.state.parties.find((function(t){return t.id===e}));o&&(s=o)}var i=1===this.state.encounters.length?this.state.encounters[0]:null;t&&(i=t);var c=w.createCombatSetup();c.party=JSON.parse(JSON.stringify(s)),c.encounter=JSON.parse(JSON.stringify(t)),i&&(c.slotInfo=C.getCombatSlotData(i,this.state.library)),a&&(c.map=a),c.fog=n,c.combatants=r,this.setState({drawer:{type:"combat-start",combatSetup:c}})}},{key:"startCombat",value:function(){var e=this,t=this.state.drawer.combatSetup;if(t.party&&t.encounter){var a=t.party.name||"unnamed party",n=t.encounter.name||"unnamed encounter",r=w.createCombat();r.name=a+" vs "+n,r.encounter=JSON.parse(JSON.stringify(t.encounter)),t.combatants.forEach((function(e){r.combatants.push(e)})),t.party.pcs.filter((function(e){return e.active})).forEach((function(e){r.combatants.find((function(t){return t.id===e.id}))||r.combatants.push(z.convertPCToCombatant(e))})),r.encounter.slots.forEach((function(a){var n=e.getMonster(a.monsterID),s=t.slotInfo.find((function(e){return e.id===a.id}));n&&s?s.members.forEach((function(e){r.combatants.push(z.convertMonsterToCombatant(n,e.init,e.hp,e.name,a.faction))})):r.issues.push("unknown monster")})),r.combatants.push(z.convertPlaceholderToCombatant()),z.sortCombatants(r),t.map&&(r.map=JSON.parse(JSON.stringify(t.map)),r.fog=t.fog),this.setState({combats:[].concat(this.state.combats,[r]),selectedCombatID:r.id,drawer:null,view:"encounters"})}}},{key:"openAddWaveModal",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t){var a=w.createCombatSetup();a.encounter=t.encounter,a.slotInfo=C.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:{type:"combat-wave",combatSetup:a}})}}},{key:"addWaveToCombat",value:function(){var e=this,t=this.state.drawer.combatSetup,a=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));if(t&&t.encounter&&a){var n=t.encounter.waves.find((function(e){return e.id===t.waveID}));n&&(n.slots.forEach((function(n){var r=e.getMonster(n.monsterID),s=t.slotInfo.find((function(e){return e.id===n.id}));r&&s?s.members.forEach((function(e){a.combatants.push(z.convertMonsterToCombatant(r,e.init,e.hp,e.name,n.faction))})):a.issues.push("unknown monster")})),z.sortCombatants(a),this.setState({combats:this.state.combats,drawer:null}))}}},{key:"openAddCombatantModal",value:function(){var e=this;if(this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}))){var t=w.createCombatSetup();t.encounter=w.createEncounter(),t.slotInfo=C.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:{type:"combat-add-combatants",combatSetup:t}})}}},{key:"addMonsterToAddCombatantsModal",value:function(e){var t=this.state.drawer.combatSetup;if(t&&t.encounter&&this.state.library.find((function(t){return t.monsters.find((function(t){return t.id===e.id}))}))){var a=w.createEncounterSlot();a.monsterID=e.id,t.encounter.slots.push(a),t.slotInfo=C.getCombatSlotData(t.encounter,this.state.library),this.setState({drawer:this.state.drawer})}}},{key:"addCombatantsToCombat",value:function(){var e=this,t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID})),a=this.state.drawer.combatSetup;t&&a&&a.encounter&&(a.encounter.slots.forEach((function(n){var r=e.getMonster(n.monsterID),s=a.slotInfo.find((function(e){return e.id===n.id}));r&&s?s.members.forEach((function(e){t.combatants.push(z.convertMonsterToCombatant(r,e.init,e.hp,e.name,n.faction))})):t.issues.push("unknown monster")})),z.sortCombatants(t),this.setState({combats:this.state.combats,drawer:null}))}},{key:"addPCToEncounter",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));if(n){var r=this.state.parties.find((function(t){return t.id===e}));if(r){var s=r.pcs.find((function(e){return e.id===t}));s&&(n.combatants.push(z.convertPCToCombatant(s)),this.setState({combats:this.state.combats}))}}}},{key:"addCompanionToEncounter",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(a.combatants.push(z.convertCompanionToCombatant(e)),k.sort(a.combatants,[{field:"displayName",dir:"asc"}]),this.setState({combats:this.state.combats}))}},{key:"pauseCombat",value:function(){var e=this;"combat"===W.data.shared.type&&J.shareNothing(),this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}))&&this.setState({selectedCombatID:null})}},{key:"resumeCombat",value:function(e){this.setState({view:"encounters",selectedCombatID:e.id})}},{key:"endCombat",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"combat"===W.data.shared.type&&J.shareNothing();var n=this.state.combats.indexOf(e);this.state.combats.splice(n,1),this.setState({combats:this.state.combats,selectedCombatID:null},(function(){if(e&&e.map&&a){var n=e.combatants.filter((function(e){return"pc"===e.type||"companion"===e.type}));n.forEach((function(e){e.current=!1,e.pending=!0,e.active=!1,e.defeated=!1,e.initiative=10}));var r=null,s=n.filter((function(e){return"pc"===e.type}));if(s.length>0){var o=t.state.parties.find((function(e){return e.pcs.find((function(e){return e.id===s[0].id}))}));o&&(r=o.id,o.pcs.forEach((function(e){n.find((function(t){return t.id===e.id}))||n.push(z.convertPCToCombatant(e))})))}if(k.sort(n,[{field:"displayName",dir:"asc"}]),r){var i=e.map.id,c=t.state.explorations.find((function(e){return e.map.id===i&&e.partyID===r}));c||((c=w.createExploration()).name=e.name+"in "+e.map.name,c.partyID=r,t.state.explorations.push(c)),c.map=e.map,c.fog=e.fog,c.combatants=n,c.map.items=c.map.items.filter((function(e){return"tile"===e.type||"pc"===e.type||"companion"===e.type})),t.setState({view:"maps",explorations:t.state.explorations,selectedExplorationID:c.id})}}}))}},{key:"makeCurrent",value:function(e,t){var a=this,n=this.state.combats.find((function(e){return e.id===a.state.selectedCombatID}));n&&(n.combatants.filter((function(e){return e.conditions})).forEach((function(t){t.conditions.forEach((function(s){if(s.duration)switch(s.duration.type){case"saves":if(e&&t.id===e.id&&"start"===s.duration.point){var o={id:k.guid(),type:"condition-save",data:s,combatant:t};h.a.open({key:o.id,message:r.a.createElement(Gt,{notification:o,close:function(e,t){return a.closeNotification(e,t)}}),closeIcon:r.a.createElement(p.a,null),duration:null})}break;case"combatant":if(e&&(s.duration.combatantID===e.id||null===s.duration.combatantID)&&"start"===s.duration.point){var i=t.conditions.indexOf(s);t.conditions.splice(i,1);var c={id:k.guid(),type:"condition-end",data:s,combatant:t};h.a.open({key:c.id,message:r.a.createElement(Gt,{notification:c,close:function(e,t){return a.closeNotification(e,t)}}),closeIcon:r.a.createElement(p.a,null),duration:null})}break;case"rounds":if(e&&t.id===e.id&&(s.duration.count-=1),0===s.duration.count){var l=t.conditions.indexOf(s);if(t.conditions.splice(l,1),n){var u={id:k.guid(),type:"condition-end",data:s,combatant:t};h.a.open({key:u.id,message:r.a.createElement(Gt,{notification:u,close:function(e,t){return a.closeNotification(e,t)}}),closeIcon:r.a.createElement(p.a,null),duration:null})}}}}))})),e&&"monster"===e.type&&(e.traits.filter((function(e){return e.uses>0&&e.usage.toLowerCase().startsWith("recharge ")})).forEach((function(t){var n={id:k.guid(),type:"trait-recharge",data:t,combatant:e};h.a.open({key:n.id,message:r.a.createElement(Gt,{notification:n,close:function(e,t){return a.closeNotification(e,t)}}),closeIcon:r.a.createElement(p.a,null),duration:null})})),e.traits.filter((function(e){return"legendary"===e.type||"mythic"===e.type})).forEach((function(e){e.uses=0}))),n.combatants.forEach((function(e){e.current=!1})),e&&(e.current=!0),t&&(n.round+=1),this.setState({combats:this.state.combats}))}},{key:"makeActive",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=e.some((function(e){return e.pending}));e.forEach((function(e){e.pending=!1,e.active=!0,e.defeated=!1})),n&&z.sortCombatants(a),this.setState({combats:this.state.combats})}}},{key:"makeDefeated",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){var n=a.combatants.find((function(e){return e.current}));e.forEach((function(e){e.pending=!1,e.active=!1,e.defeated=!0,e.mountID=null,e.mountType="controlled",a.combatants.forEach((function(t){t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")})),a.combatants.forEach((function(t){t.tags=t.tags.filter((function(t){return t!=="engaged:"+e.displayName}))})),a.map&&(a.map.items=a.map.items.filter((function(t){return t.id!==e.id})))})),n&&e.find((function(e){return e.id===n.id}))?this.endTurn(n):this.setState({combats:this.state.combats})}}},{key:"removeCombatants",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(e.forEach((function(e){var t=a.combatants.indexOf(e);if(a.combatants.splice(t,1),a.combatants.forEach((function(t){t.mountID===e.id&&(t.mountID=null,t.mountType="controlled")})),a.combatants.forEach((function(t){t.tags=t.tags.filter((function(t){return t!=="engaged:"+e.displayName}))})),a.map){var n=a.map.items.find((function(t){return t.id===e.id}));if(n){var r=a.map.items.indexOf(n);a.map.items.splice(r,1)}}})),this.setState({combats:this.state.combats}))}},{key:"endTurn",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));if(a){a.combatants.filter((function(e){return e.conditions})).forEach((function(a){a.conditions.forEach((function(n){if(n.duration)switch(n.duration.type){case"saves":if(a.id===e.id&&"end"===n.duration.point){var s=w.createNotification();s.type="condition-save",s.data=n,s.combatant=a,h.a.open({key:s.id,message:r.a.createElement(Gt,{notification:s,close:function(e,a){return t.closeNotification(e,a)}}),closeIcon:r.a.createElement(p.a,null),duration:null})}break;case"combatant":if((n.duration.combatantID===e.id||null===n.duration.combatantID)&&"end"===n.duration.point){var o=a.conditions.indexOf(n);a.conditions.splice(o,1);var i=w.createNotification();i.type="condition-end",i.data=n,i.combatant=a,h.a.open({key:i.id,message:r.a.createElement(Gt,{notification:i,close:function(e,a){return t.closeNotification(e,a)}}),closeIcon:r.a.createElement(p.a,null),duration:null})}}}))}));var n=a.combatants.filter((function(e){return!!e.mountID&&"controlled"===e.mountType})).map((function(e){return e.mountID||""})),s=a.combatants.filter((function(e){return!n.includes(e.id)})).filter((function(e){return e.current||!e.pending&&e.active&&!e.defeated})).filter((function(e){return"placeholder"!==e.type||z.combatHasLairActions(a)}));if(0===s.length)this.makeCurrent(null,!1);else if(1===s.length&&s[0].defeated)this.makeCurrent(null,!1);else{var o=s.indexOf(e)+1,i=!1;o>=s.length&&(o=0,i=!0),this.makeCurrent(s[o],i)}}}},{key:"changeHP",value:function(e){var t=this,a=this.state.combats.find((function(e){return e.id===t.state.selectedCombatID}));a&&(e.forEach((function(e){var t=a.combatants.find((function(t){return t.id===e.id}));t&&(t.hpCurrent=e.hp,t.hpTemp=e.temp)})),this.setState({combats:this.state.combats}))}},{key:"closeNotification",value:function(e,t){if(h.a.close(e.id),t&&e.combatant&&e.data){var a=e.combatant.conditions.indexOf(e.data);e.combatant.conditions.splice(a,1)}this.setState({combats:this.state.combats})}},{key:"toggleTag",value:function(e,t){e.forEach((function(e){e.tags.includes(t)?e.tags=e.tags.filter((function(e){return e!==t})):e.tags.push(t)})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"toggleCondition",value:function(e,t){e.forEach((function(e){if(e.conditions.some((function(e){return e.name===t})))e.conditions=e.conditions.filter((function(e){return e.name!==t}));else{var a=w.createCondition();a.name=t,e.conditions.push(a),e.conditions=k.sort(e.conditions,[{field:"name",dir:"asc"}])}})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"toggleHidden",value:function(e){e.forEach((function(e){return e.showOnMap=!e.showOnMap})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"addCondition",value:function(e,t){var a=w.createCondition();a.name="blinded",this.setState({drawer:{type:"condition-add",condition:a,combatants:e,allCombatants:t}})}},{key:"addConditionFromModal",value:function(){var e=this;this.state.drawer.combatants.forEach((function(t){var a=JSON.parse(JSON.stringify(e.state.drawer.condition));a.id=k.guid(),t.conditions.push(a),k.sort(t.conditions,[{field:"name",dir:"asc"}])})),this.setState({combats:this.state.combats,explorations:this.state.explorations,drawer:null})}},{key:"editCondition",value:function(e,t,a){this.setState({drawer:{type:"condition-edit",condition:t,combatants:[e],allCombatants:a}})}},{key:"editConditionFromModal",value:function(){var e=this;this.state.drawer.combatants.forEach((function(t){var a=t.conditions.find((function(t){return t.id===e.state.drawer.condition.id}));if(a){var n=t.conditions.indexOf(a);t.conditions[n]=e.state.drawer.condition,k.sort(t.conditions,[{field:"name",dir:"asc"}])}})),this.setState({combats:this.state.combats,explorations:this.state.explorations,drawer:null})}},{key:"deleteCondition",value:function(e,t){e.conditions=e.conditions.filter((function(e){return e.name!==t.name})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"scatterCombatants",value:function(e,t,a,n){R.scatterCombatants(a,e,n),z.setMountPositions(t,a),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"rotateMap",value:function(e){R.rotateMap(e),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"mapAdd",value:function(e,t,a,n,r){z.getMountsAndRiders([e.id],n).forEach((function(e){return R.add(r,e,t,a)})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"mapMove",value:function(e,t,a,n){var r=z.getMountsAndRiders(e,a).map((function(e){return e.id}));e.forEach((function(e){r.includes(e)||r.push(e)})),r.forEach((function(e){return R.move(n,e,t)})),z.setMountPositions(a,n),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"mapRemove",value:function(e,t,a){var n=z.getMountsAndRiders(e,t).map((function(e){return e.id}));e.forEach((function(e){n.includes(e)||n.push(e)})),n.forEach((function(e){return R.remove(a,e)})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"setAltitude",value:function(e,t,a){z.getMountsAndRiders([e.id],a).forEach((function(e){return e.altitude=t})),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"addMapItem",value:function(e,t){t.items.push(e),this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"useTrait",value:function(e){e.uses+=1,this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"rechargeTrait",value:function(e){e.uses=0,this.setState({combats:this.state.combats,explorations:this.state.explorations})}},{key:"save",value:function(){switch(this.state.view){case"parties":this.saveKey(this.state.parties,"data-parties");break;case"library":this.saveKey(this.state.library,"data-library");break;case"encounters":this.saveKey(this.state.encounters,"data-encounters"),this.saveKey(this.state.combats,"data-combats");break;case"maps":this.saveKey(this.state.maps,"data-maps"),this.saveKey(this.state.explorations,"data-explorations")}this.saveKey(this.state.options,"data-options")}},{key:"saveAll",value:function(){this.saveKey(this.state.parties,"data-parties"),this.saveKey(this.state.library,"data-library"),this.saveKey(this.state.encounters,"data-encounters"),this.saveKey(this.state.maps,"data-maps"),this.saveKey(this.state.combats,"data-combats"),this.saveKey(this.state.explorations,"data-explorations"),this.saveKey(this.state.options,"data-options")}},{key:"saveKey",value:function(e,t){try{var a=JSON.stringify(e);window.localStorage.setItem(t,a)}catch(n){console.error("Could not stringify data: ",n)}}},{key:"getBreadcrumbs",value:function(){var e=this,t=[];switch(t.push({id:"home",text:"dojo",onClick:function(){return e.setView("home")}}),this.state.view){case"parties":if(t.push({id:"parties",text:"pcs",onClick:function(){return e.selectPartyByID(null)}}),this.state.selectedPartyID){var a=this.state.parties.find((function(t){return t.id===e.state.selectedPartyID}));t.push({id:a.id,text:a.name||"unnamed party",onClick:function(){return e.selectPartyByID(e.state.selectedPartyID)}})}break;case"library":if(t.push({id:"library",text:"monsters",onClick:function(){return e.selectMonsterGroupByID(null)}}),this.state.selectedMonsterGroupID){var n=this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID}));t.push({id:n.id,text:n.name||"unnamed group",onClick:function(){return e.selectMonsterGroupByID(e.state.selectedMonsterGroupID)}})}break;case"encounters":if(t.push({id:"encounters",text:"encounters",onClick:function(){return e.selectEncounterByID(null)}}),this.state.selectedEncounterID){var r=this.state.encounters.find((function(t){return t.id===e.state.selectedEncounterID}));t.push({id:r.id,text:r.name||"unnamed encounter",onClick:function(){return e.selectEncounterByID(e.state.selectedEncounterID)}})}if(this.state.selectedCombatID){var s=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));t.push({id:s.id,text:s.name||"unnamed combat",onClick:function(){return e.selectCombatByID(e.state.selectedCombatID)}})}break;case"maps":if(t.push({id:"maps",text:"maps",onClick:function(){return e.selectMapByID(null)}}),this.state.selectedMapID){var o=this.state.maps.find((function(t){return t.id===e.state.selectedMapID}));t.push({id:o.id,text:o.name||"unnamed map",onClick:function(){return e.selectMapByID(e.state.selectedMapID)}})}if(this.state.selectedExplorationID){var i=this.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));t.push({id:i.id,text:i.name||"unnamed exploration",onClick:function(){return e.selectExplorationByID(e.state.selectedExplorationID)}})}}return t}},{key:"getContent",value:function(){var e=this,t=!1;this.state.parties.forEach((function(e){return t=t||e.pcs.length>0}));var a=!1;switch(this.state.library.forEach((function(e){return a=a||e.monsters.length>0})),this.state.view){case"home":return r.a.createElement(xn,null);case"parties":return this.state.selectedPartyID?r.a.createElement(_n,{party:this.state.parties.find((function(t){return t.id===e.state.selectedPartyID})),encounters:this.state.encounters,maps:this.state.maps,goBack:function(){return e.selectParty(null)},deleteParty:function(t){return e.deleteParty(t)},addPC:function(){return e.editPC(null)},importPC:function(){return e.importPC()},editPC:function(t){return e.editPC(t)},updatePC:function(t){return e.updatePC(t)},deletePC:function(t){return e.deletePC(t)},createEncounter:function(t,a){return e.createEncounter(t,a)},startEncounter:function(t,a){var n=e.state.encounters.find((function(e){return e.id===a}));e.createCombat(t,n)},startExploration:function(t,a){var n=e.state.maps.find((function(e){return e.id===a}));e.startExploration(n,t)},showReference:function(t){return e.showPartyReference(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)}}):r.a.createElement(Hn,{parties:this.state.parties,encounters:this.state.encounters,maps:this.state.maps,addParty:function(){return e.addParty()},importParty:function(){return e.importParty()},openParty:function(t){return e.selectParty(t)},addPC:function(){return e.editPC(null)},importPC:function(){return e.importPC()},createEncounter:function(t,a){return e.createEncounter(t,a)},startEncounter:function(t,a){var n=e.state.encounters.find((function(e){return e.id===a}));e.createCombat(t,n)},startExploration:function(t,a){var n=e.state.maps.find((function(e){return e.id===a}));e.startExploration(n,t)},showReference:function(t){return e.showPartyReference(t)},deleteParty:function(t){return e.deleteParty(t)},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})}});case"library":return this.state.selectedMonsterGroupID?r.a.createElement(Fn,{monsterGroup:this.state.library.find((function(t){return t.id===e.state.selectedMonsterGroupID})),library:this.state.library,encounters:this.state.encounters,goBack:function(){return e.selectMonsterGroup(null)},deleteMonsterGroup:function(t){return e.deleteMonsterGroup(t)},openDemographics:function(t){return e.openDemographics(t)},addMonster:function(t){return e.addMonster(t)},importMonster:function(){return e.importMonster()},deleteMonster:function(t){return e.deleteMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},viewMonster:function(t){return e.setState({drawer:{type:"statblock",source:t}})},editMonster:function(t){return e.editMonster(t)},cloneMonster:function(t,a){return e.cloneMonster(t,a)},moveToGroup:function(t,a){return e.moveToGroup(t,a)}}):r.a.createElement(Ln,{library:this.state.library,hasMonsters:a,addMonsterGroup:function(){return e.addMonsterGroup()},importMonsterGroup:function(){return e.importMonsterGroup()},openMonsterGroup:function(t){return e.selectMonsterGroup(t)},deleteMonsterGroup:function(t){return e.deleteMonsterGroup(t)},addOpenGameContent:function(){return e.addOpenGameContent()},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})},openDemographics:function(t){return e.openDemographics(t)},addMonster:function(t){return e.addMonster(t)},importMonster:function(){return e.importMonster()}});case"encounters":return this.state.selectedCombatID?r.a.createElement(pn,{combat:this.state.combats.find((function(t){return t.id===e.state.selectedCombatID})),parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,options:this.state.options,pauseCombat:function(){return e.pauseCombat()},endCombat:function(t,a){return e.endCombat(t,a)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},makeCurrent:function(t){return e.makeCurrent(t,!1)},makeActive:function(t){return e.makeActive(t)},makeDefeated:function(t){return e.makeDefeated(t)},useTrait:function(t){return e.useTrait(t)},rechargeTrait:function(t){return e.rechargeTrait(t)},removeCombatants:function(t){return e.removeCombatants(t)},addCombatants:function(){return e.openAddCombatantModal()},addCompanion:function(t){return e.addCompanionToEncounter(t)},addPC:function(t,a){return e.addPCToEncounter(t,a)},addWave:function(){return e.openAddWaveModal()},addCondition:function(t){var a=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.addCondition(t,a.combatants)},editCondition:function(t,a){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.editCondition(t,a,n.combatants)},deleteCondition:function(t,a){return e.deleteCondition(t,a)},mapAdd:function(t,a,n){var r=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.mapAdd(t,a,n,r.combatants,r.map)},mapMove:function(t,a){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.mapMove(t,a,n.combatants,n.map)},mapRemove:function(t){var a=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.mapRemove(t,a.combatants,a.map)},onChangeAltitude:function(t,a){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.setAltitude(t,a,n.combatants)},endTurn:function(t){return e.endTurn(t)},changeHP:function(t){return e.changeHP(t)},toggleTag:function(t,a){return e.toggleTag(t,a)},toggleCondition:function(t,a){return e.toggleCondition(t,a)},toggleHidden:function(t){return e.toggleHidden(t)},scatterCombatants:function(t,a){var n=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.scatterCombatants(t,n.combatants,n.map,a)},rotateMap:function(){var t=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.rotateMap(t.map)},setFog:function(t){e.state.combats.find((function(t){return t.id===e.state.selectedCombatID})).fog=t,e.setState({combats:e.state.combats})},addOverlay:function(t){var a=e.state.combats.find((function(t){return t.id===e.state.selectedCombatID}));e.addMapItem(t,a.map)},onRollDice:function(t,a,n){return e.setDice(t,a,n)}}):this.state.selectedEncounterID?r.a.createElement(Nn,{encounter:this.state.encounters.find((function(t){return t.id===e.state.selectedEncounterID})),parties:this.state.parties,cloneEncounter:function(t,a){return e.cloneEncounter(t,a)},deleteEncounter:function(t){return e.deleteEncounter(t)},startEncounter:function(t,a){var n=e.state.encounters.find((function(e){return e.id===a}));e.createCombat(t,n)},populateEncounter:function(t){var a=[];e.state.library.forEach((function(e){e.monsters.forEach((function(e){t.slots.some((function(t){return t.monsterID===e.id}))||a.push(e)}))})),t.slots.filter((function(e){return e.roles.length>0})).forEach((function(t){var n=a.filter((function(e){return t.roles.includes(e.role)}));if(n.length>0){var r=n[k.randomNumber(n.length)];e.state.library.find((function(e){return e.monsters.includes(r)}))&&(t.monsterID=r.id)}})),z.sortEncounter(t),e.setState({encounters:e.state.encounters})},addWave:function(t){var a=w.createEncounterWave();a.name="wave "+(t.waves.length+2),t.waves.push(a),e.setState({encounters:e.state.encounters})},deleteWave:function(t,a){var n=t.waves.indexOf(a);t.waves.splice(n,1),e.setState({encounters:e.state.encounters})},moveEncounterSlot:function(t,a,n,r){if(n){var s=n.slots.indexOf(a);n.slots.splice(s,1)}else{var o=t.slots.indexOf(a);t.slots.splice(o,1)}r?r.slots.push(a):t.slots.push(a),z.sortEncounter(t),e.setState({encounters:e.state.encounters})},deleteEncounterSlot:function(t,a,n){if(n){var r=n.slots.indexOf(a);n.slots.splice(r,1)}else{var s=t.slots.indexOf(a);t.slots.splice(s,1)}e.setState({encounters:e.state.encounters})},chooseMonster:function(t,a,n){a?e.setState({drawer:{type:"encounter-slot-template",encounter:t,slot:a,wave:n,monster:null}}):e.setState({drawer:{type:"encounter-slot",encounter:t,slot:a,wave:n,monster:null}})},showStatblock:function(t){return e.setState({drawer:{type:"statblock",source:t}})},getMonster:function(t){return e.getMonster(t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},nudgeValue:function(t,a,n){return e.nudgeValue(t,a,n)},goBack:function(){return e.selectEncounter(null)}}):r.a.createElement(kn,{encounters:this.state.encounters,combats:this.state.combats,parties:this.state.parties,hasMonsters:a,createEncounter:function(t,a){return e.createEncounter(t,a)},addEncounter:function(t){return e.addEncounter(t)},openEncounter:function(t){return e.selectEncounter(t)},cloneEncounter:function(t,a){return e.cloneEncounter(t,a)},deleteEncounter:function(t){return e.deleteEncounter(t)},startEncounter:function(t,a){var n=e.state.encounters.find((function(e){return e.id===a}));e.createCombat(t,n)},getMonster:function(t){return e.getMonster(t)},setView:function(t){return e.setView(t)},openStatBlock:function(t){return e.setState({drawer:{type:"statblock",source:t}})},resumeCombat:function(t){return e.resumeCombat(t)},deleteCombat:function(t){return e.endCombat(t)}});case"maps":return this.state.selectedExplorationID?r.a.createElement(Cn,{exploration:this.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID})),library:this.state.library,options:this.state.options,startCombat:function(t){return e.createCombat(t.partyID,null,t.map,t.fog,t.combatants)},toggleTag:function(t,a){return e.toggleTag(t,a)},toggleCondition:function(t,a){return e.toggleCondition(t,a)},toggleHidden:function(t){return e.toggleHidden(t)},addCondition:function(t){var a=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.addCondition(t,a.combatants)},editCondition:function(t,a){var n=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.editCondition(t,a,n.combatants)},deleteCondition:function(t,a){return e.deleteCondition(t,a)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},addCompanion:function(t){return e.addCompanionToExploration(t)},mapAdd:function(t,a,n){var r=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.mapAdd(t,a,n,r.combatants,r.map)},mapMove:function(t,a){var n=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.mapMove(t,a,n.combatants,n.map)},mapRemove:function(t){var a=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.mapRemove(t,a.combatants,a.map)},onChangeAltitude:function(t,a){var n=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.setAltitude(t,a,n.combatants)},scatterCombatants:function(t,a){var n=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.scatterCombatants(t,n.combatants,n.map,a)},rotateMap:function(){var t=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.rotateMap(t.map)},getMonster:function(t){return e.getMonster(t)},useTrait:function(t){return e.useTrait(t)},rechargeTrait:function(t){return e.rechargeTrait(t)},setFog:function(t){e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID})).fog=t,e.setState({explorations:e.state.explorations})},addOverlay:function(t){var a=e.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID}));e.addMapItem(t,a.map)},onRollDice:function(t,a,n){return e.setDice(t,a,n)},pauseExploration:function(){return e.pauseExploration()},endExploration:function(t){return e.endExploration(t)}}):this.state.selectedMapID?r.a.createElement(Pn,{map:this.state.maps.find((function(t){return t.id===e.state.selectedMapID})),parties:this.state.parties,editMap:function(t){return e.editMap(t)},cloneMap:function(t,a){return e.cloneMap(t,a)},deleteMap:function(t){return e.deleteMap(t)},startEncounter:function(t,a){var n=e.state.maps.find((function(e){return e.id===a}));e.createCombat(t,null,n)},startExploration:function(t,a){var n=e.state.maps.find((function(e){return e.id===a}));e.startExploration(n,t)},changeValue:function(t,a,n){return e.changeValue(t,a,n)},goBack:function(){return e.selectMap(null)}}):r.a.createElement(Tn,{maps:this.state.maps,parties:this.state.parties,explorations:this.state.explorations,addMap:function(){return e.editMap(null)},importMap:function(){return e.importMap()},generateMap:function(t){return e.generateMap(t)},openMap:function(t){return e.selectMap(t)},editMap:function(t){return e.editMap(t)},cloneMap:function(t,a){return e.cloneMap(t,a)},deleteMap:function(t){return e.deleteMap(t)},startEncounter:function(t,a){var n=e.state.maps.find((function(e){return e.id===a}));e.createCombat(t,null,n)},startExploration:function(t,a){var n=e.state.maps.find((function(e){return e.id===a}));e.startExploration(n,t)},resumeExploration:function(t){return e.resumeExploration(t)},deleteExploration:function(t){return e.endExploration(t)}})}return null}},{key:"getTabs",value:function(){return[{id:"parties",text:"pcs",selected:"parties"===this.state.view},{id:"library",text:"monsters",selected:"library"===this.state.view},{id:"encounters",text:"encounters",selected:"encounters"===this.state.view},{id:"maps",text:"maps",selected:"maps"===this.state.view}]}},{key:"getDrawer",value:function(){var e=this,t=null,a=null,n=null,s="50%",o=!1;if(this.state.drawer)switch(this.state.drawer.type){case"statblock":t=r.a.createElement(Ft,{source:this.state.drawer.source}),a="statblock",o=!0;break;case"image":t=r.a.createElement("img",{className:"nonselectable-image",src:this.state.drawer.data,alt:"shared"}),a="image",o=!0;break;case"import-party":t=r.a.createElement(Lt,{party:this.state.drawer.party}),a="import party",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedParty()}},"accept party"),o=!0;break;case"pc":t=r.a.createElement(Dt,{pc:this.state.drawer.pc,library:this.state.library}),a="pc editor",n=r.a.createElement(f.a,{gutter:20},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.savePC()}},"save changes")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes")));break;case"import-pc":t=r.a.createElement(zt,{pc:this.state.drawer.pc}),a="import pc",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedPC()}},"accept pc"),o=!0;break;case"update-pc":t=r.a.createElement(zt,{pc:this.state.drawer.pc}),a="update pc",n=r.a.createElement("button",{onClick:function(){return e.savePC()}},"accept pc"),o=!0;break;case"import-group":t=r.a.createElement(Pt,{group:this.state.drawer.group}),a="import monster group",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedGroup()}},"accept group"),o=!0;break;case"monster":t=r.a.createElement(kt,{monster:this.state.drawer.monster,library:this.state.library,sidebar:this.state.drawer.monsterEditorSidebar}),a="monster editor",n=r.a.createElement(f.a,{gutter:20},r.a.createElement(v.a,{span:6},r.a.createElement("button",{onClick:function(){return e.saveMonster()}},"save changes")),r.a.createElement(v.a,{span:6},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes")),r.a.createElement(v.a,{span:12},r.a.createElement(Y,{options:["statblock","guidelines","advanced"].map((function(e){return{id:e,text:e}})),selectedID:this.state.drawer.monsterEditorSidebar,onSelect:function(t){return e.setMonsterEditorSidebar(t)}}))),s="85%";break;case"import-monster":t=r.a.createElement(Vt,{monster:this.state.drawer.monster}),a="import monster",n=r.a.createElement("button",{onClick:function(){return e.acceptImportedMonster()}},"accept monster"),o=!0;break;case"monster-demographics":t=r.a.createElement(Je,{groups:this.state.drawer.group?[this.state.drawer.group]:this.state.library}),a="demographics",o=!0;break;case"encounter-slot":t=r.a.createElement(qt,{encounter:this.state.drawer.encounter,wave:this.state.drawer.wave,slot:this.state.drawer.slot,monster:this.state.drawer.monster,library:this.state.library,setMonster:function(t){var a=e.state.drawer;a.monster=t,e.setState({encounters:e.state.encounters,drawer:a})}}),a="choose a monster",n=r.a.createElement(f.a,{gutter:10},r.a.createElement(v.a,{span:12},r.a.createElement("button",{className:this.state.drawer.monster?"":"disabled",onClick:function(){return e.addToEncounterSlot(e.state.drawer.encounter,e.state.drawer.wave,e.state.drawer.slot,e.state.drawer.monster,!1)}},"add this monster to the encounter")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"close"))),s="75%";break;case"encounter-slot-template":t=r.a.createElement(qt,{encounter:this.state.drawer.encounter,wave:this.state.drawer.wave,slot:this.state.drawer.slot,monster:this.state.drawer.monster,library:this.state.library,setMonster:function(t){var a=e.state.drawer;a.monster=t,e.setState({encounters:e.state.encounters,drawer:a})}}),a="choose a monster",n=r.a.createElement("button",{className:this.state.drawer.monster?"":"disabled",onClick:function(){return e.addToEncounterSlot(e.state.drawer.encounter,e.state.drawer.wave,e.state.drawer.slot,e.state.drawer.monster,!0)}},"add this monster to the encounter"),s="75%";break;case"map-edit":t=r.a.createElement(ot,{map:this.state.drawer.map}),a="map editor",n=r.a.createElement(f.a,{gutter:20},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.saveMap()}},"save changes")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="85%";break;case"import-map":t=r.a.createElement(jt,{map:this.state.drawer.map}),a="import map",n=r.a.createElement(f.a,{gutter:20},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.acceptImportedMap()}},"save changes")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.declineImportedMap()}},"discard changes"))),s="75%",o=!1;break;case"combat-start":t=r.a.createElement(Ve,{type:"start",combatSetup:this.state.drawer.combatSetup,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,getMonster:function(t){return e.getMonster(t)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="start combat",n=r.a.createElement("button",{className:this.state.drawer.combatSetup.party&&this.state.drawer.combatSetup.encounter?"":"disabled",onClick:function(){return e.startCombat()}},"start combat"),o=!0;break;case"combat-wave":t=r.a.createElement(Ve,{type:"add-wave",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:function(t){return e.getMonster(t)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="add a wave",n=r.a.createElement("button",{className:null!==this.state.drawer.combatSetup.waveID?"":"disabled",onClick:function(){return e.addWaveToCombat()}},"add wave"),o=!0;break;case"combat-add-combatants":t=r.a.createElement(Ve,{type:"add-combatants",combatSetup:this.state.drawer.combatSetup,library:this.state.library,getMonster:function(t){return e.getMonster(t)},addMonster:function(t){return e.addMonsterToAddCombatantsModal(t)},notify:function(){return e.setState({drawer:e.state.drawer})}}),a="add combatants",n=r.a.createElement("button",{className:null!==this.state.drawer.combatSetup.encounter?"":"disabled",onClick:function(){return e.addCombatantsToCombat()}},"add combatants"),o=!0;break;case"condition-add":t=r.a.createElement(He,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="add a condition",n=r.a.createElement("button",{onClick:function(){return e.addConditionFromModal()}},"add"),s="75%",o=!0;break;case"condition-edit":t=r.a.createElement(He,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="edit condition",n=r.a.createElement(f.a,{gutter:20},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.editConditionFromModal()}},"save changes")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="75%"}return{content:t,header:a,footer:n,width:s,closable:o}}},{key:"render",value:function(){var e=this;try{var t,a,n=this.getBreadcrumbs(),s=this.getContent(),o=this.getTabs(),i=this.getDrawer();return r.a.createElement("div",{className:"dojo"},r.a.createElement("div",{className:this.state.sidebar.visible?"app with-sidebar":"app"},r.a.createElement(Bt,null,r.a.createElement(_t,{breadcrumbs:n,sidebarVisible:this.state.sidebar.visible,onToggleSidebar:function(){return e.toggleSidebar()}})),r.a.createElement(Bt,null,r.a.createElement("div",{className:"page-content"},s)),r.a.createElement(Bt,null,r.a.createElement(Ut,{tabs:o,onSelectView:function(t){return e.setView(t)}}))),r.a.createElement(Bt,null,r.a.createElement(rn,{sidebar:this.state.sidebar,user:"dm",parties:this.state.parties,library:this.state.library,encounters:this.state.encounters,maps:this.state.maps,combats:this.state.combats,explorations:this.state.explorations,options:this.state.options,currentCombat:null!==(t=this.state.combats.find((function(t){return t.id===e.state.selectedCombatID})))&&void 0!==t?t:null,currentExploration:null!==(a=this.state.explorations.find((function(t){return t.id===e.state.selectedExplorationID})))&&void 0!==a?a:null,onSelectSidebar:function(t){return e.setSidebar(t)},onUpdateSidebar:function(t){return e.setState({sidebar:t})},selectParty:function(t){return e.selectPartyByID(t)},selectMonsterGroup:function(t){return e.selectMonsterGroupByID(t)},selectEncounter:function(t){return e.selectEncounterByID(t)},selectMap:function(t){return e.selectMapByID(t)},openImage:function(t){return e.setState({drawer:{type:"image",data:t}})},setOption:function(t,a){var n=e.state.options;n[t]=a,e.setState({options:n})},getMonster:function(t){return e.getMonster(t)}})),r.a.createElement(Bt,null,r.a.createElement(g.a,{closable:!1,maskClosable:i.closable,width:i.width,visible:null!==i.content,onClose:function(){return e.closeDrawer()}},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},i.header)),r.a.createElement("div",{className:"drawer-content"},i.content),r.a.createElement("div",{className:"drawer-footer"},i.footer))))}catch(c){return console.error(c),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Xn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(i.a)(this,a),n=t.call(this,e);var r={showMonsterDieRolls:!1};try{var s=window.localStorage.getItem("data-options");s&&(r=JSON.parse(s))}catch(h){console.error("Could not parse JSON: ",h)}var o={};[4,6,8,10,12,20,100].forEach((function(e){return o[e]=0})),o[20]=1,n.state={addingToMap:!1,drawer:null,sidebar:{visible:!1,type:"reference",subtype:"skills",dice:o,constant:0,dieRolls:[],handout:null,languagePreset:null,selectedLanguages:[],languageOutput:[],draws:[],npc:null,selectedPartyID:null,selectedMonsterID:null},options:r};var c=[],l=[],u=[];try{var d=window.localStorage.getItem("data-maps");d&&(c=JSON.parse(d));var m=window.localStorage.getItem("data-combats");m&&(l=JSON.parse(m));var p=window.localStorage.getItem("data-explorations");p&&(u=JSON.parse(p)),j.clearUnusedImages(c,l,u)}catch(h){console.error("Could not parse JSON: ",h)}return n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;_.onStateChanged=function(){return e.forceUpdate()},_.onDataChanged=function(){W.data.shared.images.forEach((function(e){return j.saveImage(e.id,e.name,e.data)})),e.forceUpdate()},W.onPrompt=function(e,t){switch(e){case"initiative":if("combat"===W.data.shared.type){if(""===W.getCharacterID(W.getID()))return;var a=k.guid();h.a.open({key:a,message:r.a.createElement(Zn,{type:"initiative",notificationKey:a}),closeIcon:r.a.createElement(p.a,null),duration:null})}}},W.onNewMessage=function(t){e.state.sidebar.visible&&"session-chat"===e.state.sidebar.type||h.a.open({key:t.id,message:r.a.createElement(Ra,{user:"player",message:t,openImage:function(t){return e.setState({drawer:{type:"image",data:t}})}}),closeIcon:r.a.createElement(p.a,null),duration:5})}}},{key:"componentWillUnmount",value:function(){_.onStateChanged=null,_.onDataChanged=null,W.onPrompt=null,_.disconnect()}},{key:"setAddingToMap",value:function(e){this.setState({addingToMap:e})}},{key:"setSidebar",value:function(e){var t="";switch(e){case"reference":t="skills";break;case"about":t="dojo"}var a=this.state.sidebar;a.visible=!0,a.type=e,a.subtype=t,this.setState({sidebar:a})}},{key:"toggleSidebar",value:function(){var e=this.state.sidebar;e.visible=!e.visible,this.setState({sidebar:e})}},{key:"closeDrawer",value:function(){this.setState({drawer:null})}},{key:"editPC",value:function(e){if(W.data.party){var t=W.data.party.pcs.find((function(t){return t.id===e}));if(t){var a=JSON.parse(JSON.stringify(t));this.setState({drawer:{type:"pc",pc:a}})}}}},{key:"newPC",value:function(){var e=w.createPC();e.player=W.getName(W.getID()),this.setState({drawer:{type:"pc",pc:e}})}},{key:"savePC",value:function(){_.sendCharacter(this.state.drawer.pc),this.setState({drawer:null})}},{key:"addCondition",value:function(e,t){var a=w.createCondition();a.name="blinded",this.setState({drawer:{type:"condition-add",condition:a,combatants:e,allCombatants:t}})}},{key:"addConditionFromModal",value:function(){var e=this;this.state.drawer.combatants.forEach((function(t){var a=JSON.parse(JSON.stringify(e.state.drawer.condition));a.id=k.guid(),t.conditions.push(a),k.sort(t.conditions,[{field:"name",dir:"asc"}])})),this.setState({drawer:null},(function(){_.sendSharedUpdate(),e.forceUpdate()}))}},{key:"editCondition",value:function(e,t,a){this.setState({drawer:{type:"condition-edit",condition:t,combatants:[e],allCombatants:a}})}},{key:"editConditionFromModal",value:function(){var e=this;this.state.drawer.combatants.forEach((function(t){var a=t.conditions.find((function(t){return t.id===e.state.drawer.condition.id}));if(a){var n=t.conditions.indexOf(a);t.conditions[n]=e.state.drawer.condition,k.sort(t.conditions,[{field:"name",dir:"asc"}])}})),this.setState({drawer:null},(function(){_.sendSharedUpdate(),e.forceUpdate()}))}},{key:"getNothingSection",value:function(){var e=this,t=null;if(""===W.getCharacterID(W.getID())&&null!==W.data.party){var a=[];W.data.party.pcs.forEach((function(e){W.data.people.some((function(t){return t.characterID===e.id}))||a.push(r.a.createElement("button",{key:e.id,onClick:function(){return _.sendUpdate("",e.id)}},r.a.createElement("div",{className:"section"},r.a.createElement(ae,{source:e,inline:!0}),e.name),r.a.createElement("div",{className:"section small"},"level "+e.level+" "+e.race+" "+e.classes)))})),t=r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("p",null,"in the meantime, please select your character:"),a,r.a.createElement("p",null,"or, create a new character ",r.a.createElement("button",{className:"link",onClick:function(){return e.newPC()}},"here")))}return r.a.createElement(f.a,{align:"middle",justify:"center",className:"scrollable"},r.a.createElement(Pe,null,r.a.createElement("p",null,"the dm is not currently sharing anything with you; when they do, you'll see it here"),t))}},{key:"getCombatSection",value:function(e,t){var a,n,s=this,o=W.getCharacterID(W.getID()),i=null!==(a=t.selectedAreaID)&&void 0!==a?a:"",c=null!==(n=t.highlightedSquare)&&void 0!==n?n:null,l=null,u=e.combatants.find((function(e){return e.current}));u&&u.id===o&&(l=r.a.createElement(Pe,null,r.a.createElement("p",null,"you are the current initiative holder")));var d=r.a.createElement(dn,{combat:e,playerView:!0,showDefeated:!1,help:null,selectedItemIDs:[o],toggleItemSelection:function(e,t){return null}}),m=null;return e.map&&(m=r.a.createElement("div",{className:"scrollable horizontal-only"},r.a.createElement(xe,{map:e.map,mode:"combat-player",viewport:R.getViewport(e.map,i),showGrid:this.state.addingToMap,combatants:e.combatants,selectedItemIDs:[o],fog:e.fog,focussedSquare:c,itemSelected:function(e,t){return null},gridSquareClicked:function(t,a){s.state.addingToMap&&(z.getMountsAndRiders([o],e.combatants).forEach((function(n){return R.add(e.map,n,t,a)})),s.setAddingToMap(!1),_.sendSharedUpdate(),s.forceUpdate())}}))),r.a.createElement("div",{className:"scrollable"},l,r.a.createElement(Tt,{heading:"encounter map",content:[m],columns:1,showToggle:!0}),r.a.createElement(Tt,{heading:"initiative order",content:[d],columns:1,showToggle:!0}))}},{key:"getExplorationSection",value:function(e,t){var a,n,s=this,o=W.getCharacterID(W.getID()),i=null!==(a=t.selectedAreaID)&&void 0!==a?a:"",c=null!==(n=t.highlightedSquare)&&void 0!==n?n:null;return r.a.createElement("div",{className:"scrollable both-ways"},r.a.createElement(xe,{map:e.map,mode:"combat-player",viewport:R.getViewport(e.map,i),showGrid:this.state.addingToMap,combatants:e.combatants,selectedItemIDs:[o],fog:e.fog,focussedSquare:c,itemSelected:function(e,t){return null},gridSquareClicked:function(t,a){s.state.addingToMap&&(z.getMountsAndRiders([o],e.combatants).forEach((function(n){return R.add(e.map,n,t,a)})),s.setAddingToMap(!1),_.sendSharedUpdate(),s.forceUpdate())}}))}},{key:"getHandoutSection",value:function(e){switch(e.type){case"image":return r.a.createElement("img",{className:"nonselectable-image borderless",src:e.src,alt:"handout"});case"audio":return r.a.createElement("audio",{controls:!0},r.a.createElement("source",{src:e.src}));case"video":return r.a.createElement("video",{controls:!0},r.a.createElement("source",{src:e.src}));case"pdf":return r.a.createElement("div",{className:"scrollable"},r.a.createElement(Ka,{src:e.src}))}return null}},{key:"getMonsterSection",value:function(e){return r.a.createElement("div",{className:"scrollable"},r.a.createElement(vt,{monster:e}))}},{key:"getBeadcrumbs",value:function(){return[{id:"home",text:"dojo - player",onClick:function(){return null}}]}},{key:"getContent",value:function(){switch(_.getState()){case"not connected":return r.a.createElement(f.a,{align:"middle",justify:"center",className:"full-height"},r.a.createElement(Kn,null));case"connecting":return r.a.createElement(f.a,{align:"middle",justify:"center",className:"full-height"},r.a.createElement("div",{className:"connection-panel"},r.a.createElement(Pe,null,r.a.createElement("p",null,"connecting to ",r.a.createElement("span",{className:"app-name"},"dojo"),"..."))));case"connected":var e=null;if("nothing"===W.data.shared.type&&(e=this.getNothingSection()),"combat"===W.data.shared.type){var t=W.data.shared.data,a=W.data.shared.additional;e=this.getCombatSection(t,a)}if("exploration"===W.data.shared.type){var n=W.data.shared.data,s=W.data.shared.additional;e=this.getExplorationSection(n,s)}if("handout"===W.data.shared.type){var o=W.data.shared.data;e=this.getHandoutSection(o)}if("monster"===W.data.shared.type){var i=W.data.shared.data;e=this.getMonsterSection(i)}return r.a.createElement("div",{className:"full-height"},e)}}},{key:"getDrawer",value:function(){var e=this,t=null,a=null,n=null,s="50%",o=!1;if(this.state.drawer)switch(this.state.drawer.type){case"statblock":t=r.a.createElement(Ft,{source:this.state.drawer.source}),a="statblock",o=!0;break;case"image":t=r.a.createElement("img",{className:"nonselectable-image",src:this.state.drawer.data,alt:"shared"}),a="image",o=!0;break;case"pc":t=r.a.createElement(Dt,{pc:this.state.drawer.pc,library:[]}),a="pc editor",n=r.a.createElement(f.a,{gutter:20},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.savePC()}},"save changes")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes")));break;case"condition-add":t=r.a.createElement(He,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="add a condition",n=r.a.createElement("button",{onClick:function(){return e.addConditionFromModal()}},"add"),s="75%",o=!0;break;case"condition-edit":t=r.a.createElement(He,{condition:this.state.drawer.condition,combatants:this.state.drawer.combatants,allCombatants:this.state.drawer.allCombatants}),a="edit condition",n=r.a.createElement(f.a,{gutter:20},r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.editConditionFromModal()}},"save changes")),r.a.createElement(v.a,{span:12},r.a.createElement("button",{onClick:function(){return e.closeDrawer()}},"discard changes"))),s="75%"}return{content:t,header:a,footer:n,width:s,closable:o}}},{key:"render",value:function(){var e=this;try{var t=this.getBeadcrumbs(),a=this.getContent(),n=this.getDrawer();return r.a.createElement("div",{className:"dojo"},r.a.createElement("div",{className:this.state.sidebar.visible?"app with-sidebar":"app"},r.a.createElement(Bt,null,r.a.createElement(_t,{breadcrumbs:t,sidebarVisible:this.state.sidebar.visible,onToggleSidebar:function(){return e.toggleSidebar()}})),r.a.createElement(Bt,null,r.a.createElement("div",{className:"page-content no-footer"},a))),r.a.createElement(Bt,null,r.a.createElement(rn,{sidebar:this.state.sidebar,user:"player",options:this.state.options,onSelectSidebar:function(t){return e.setSidebar(t)},onUpdateSidebar:function(t){return e.setState({sidebar:t})},editPC:function(t){return e.editPC(t)},addCondition:function(t,a){return e.addCondition(t,a)},editCondition:function(t,a,n){return e.editCondition(t,a,n)},toggleAddingToMap:function(){return e.setAddingToMap(!e.state.addingToMap)},onUpdated:function(){return e.forceUpdate()},setOption:function(t,a){var n=e.state.options;n[t]=a,e.setState({options:n})}})),r.a.createElement(Bt,null,r.a.createElement(g.a,{closable:!1,maskClosable:n.closable,width:n.width,visible:null!==n.content,onClose:function(){return e.closeDrawer()}},r.a.createElement("div",{className:"drawer-header"},r.a.createElement("div",{className:"app-title"},n.header)),r.a.createElement("div",{className:"drawer-content"},n.content),r.a.createElement("div",{className:"drawer-footer"},n.footer))))}catch(s){return console.error(s),r.a.createElement("div",{className:"render-error"})}}}]),a}(r.a.Component),Kn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={code:"",name:""},n}return Object(c.a)(a,[{key:"setCode",value:function(e){this.setState({code:e})}},{key:"setName",value:function(e){this.setState({name:e})}},{key:"canConnect",value:function(){return""!==this.state.code&&""!==this.state.name}},{key:"connect",value:function(){this.canConnect()&&_.connect(this.state.code,this.state.name)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"connection-panel"},r.a.createElement("div",{className:"heading"},"connect"),r.a.createElement(ie,{placeholder:"dm code",debounce:!1,text:this.state.code,onChange:function(t){return e.setCode(t)}}),r.a.createElement(ie,{placeholder:"your name",debounce:!1,text:this.state.name,onChange:function(t){return e.setName(t)}}),r.a.createElement("button",{className:this.canConnect()?"":"disabled",onClick:function(){return e.connect()}},"connect"))}}]),a}(r.a.Component),Zn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(i.a)(this,a),n=t.call(this,e);var r={};return[4,6,8,10,12,20,100].forEach((function(e){return r[e]=0})),r[20]=1,n.state={mode:"roll",dice:r,constant:0,result:null,entry:10},n}return Object(c.a)(a,[{key:"setMode",value:function(e){this.setState({mode:e})}},{key:"setDie",value:function(e,t){var a=this.state.dice;a[e]=t,this.setState({dice:a})}},{key:"setConstant",value:function(e){this.setState({constant:e})}},{key:"resetDice",value:function(){var e=this.state.dice;[4,6,8,10,12,20,100].forEach((function(t){return e[t]=0})),this.setState({dice:e,constant:0})}},{key:"setEntry",value:function(e){this.setState({entry:e})}},{key:"roll",value:function(e){var t=C.rollDice(this.state.dice,this.state.constant,e);this.setState({result:t})}},{key:"sendRoll",value:function(){var e=this.state.entry;"roll"===this.state.mode&&null!==this.state.result&&(e=this.state.result.constant,this.state.result.rolls.forEach((function(t){e+=t.value}))),_.sendRollResult(this.props.type,e),h.a.close(this.props.notificationKey)}},{key:"render",value:function(){var e=this,t=null;switch(this.state.mode){case"roll":t=null===this.state.result?r.a.createElement("div",null,r.a.createElement(Ma,{dice:this.state.dice,constant:this.state.constant,setDie:function(t,a){return e.setDie(t,a)},setConstant:function(t){return e.setConstant(t)},resetDice:function(){return e.resetDice()},rollDice:function(t){return e.roll(t)}})):r.a.createElement("div",null,r.a.createElement(Da,{result:this.state.result}),r.a.createElement("button",{onClick:function(){return e.sendRoll()}},"send"));break;case"enter":t=r.a.createElement("div",null,r.a.createElement(fe,{value:this.state.entry,label:this.props.type,onNudgeValue:function(t){return e.setEntry(e.state.entry+t)}}),r.a.createElement("button",{onClick:function(){return e.sendRoll()}},"send"))}return r.a.createElement("div",null,r.a.createElement("div",{className:"heading"},this.props.type),r.a.createElement(Y,{options:["roll","enter"].map((function(e){return{id:e,text:e}})),selectedID:this.state.mode,onSelect:function(t){return e.setMode(t)}}),r.a.createElement("hr",null),t)}}]),a}(r.a.Component),Qn=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"testNotification",value:function(){h.a.open({message:r.a.createElement("div",{className:"section large"},r.a.createElement(Oa.a,{style:{paddingRight:"5px"}})," your turn"),closeIcon:r.a.createElement(p.a,null),duration:null})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"dojo"},r.a.createElement("div",{className:"app"},r.a.createElement(Bt,null,r.a.createElement(_t,{breadcrumbs:[{id:"home",text:"dojo - test",onClick:function(){return null}}]})),r.a.createElement(Bt,null,r.a.createElement("div",{className:"page-content no-footer scrollable"},r.a.createElement("p",null,"this is a test page"),r.a.createElement("button",{onClick:function(){return e.testNotification()}},"test notification")))))}}]),a}(r.a.Component),$n=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(d.a,null,r.a.createElement(m.c,null,r.a.createElement(m.a,{path:"/player"},r.a.createElement(Xn,null)),r.a.createElement(m.a,{path:"/test"},r.a.createElement(Qn,null)),r.a.createElement(m.a,null,r.a.createElement(Yn,null))))}}]),a}(r.a.Component);o.a.render(r.a.createElement($n,null),document.getElementById("root"))}},[[155,1,2]]]);